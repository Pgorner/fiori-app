<mvc:View
  controllerName="my.fiori.app.controller.App"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns:m="sap.m"
  xmlns:viz="sap.viz.ui5.controls"
  xmlns:vizdata="sap.viz.ui5.data"
  xmlns:feeds="sap.viz.ui5.controls.common.feeds"
  displayBlock="true">

  <!-- VBox with extra margins/padding for a cleaner layout -->
  <m:VBox class="sapUiLargeMargin sapUiContentPadding">

    <!-- Row 1 of tiles -->
    <m:HBox renderType="Bare" justifyContent="SpaceAround" class="sapUiSmallMargin">

      <!-- (1) Cancellations Trend -->
      <m:GenericTile
        id="cancellationTrendTile"
        header="Cancellations Trend"
        subheader="Last vs Current Month"
        frameType="TwoByOne"
        class="sapUiSmallMargin myStylishTile">
        <m:tileContent>
          <m:TileContent>
            <m:NumericContent
              value="{/cancellationTrend/value}"
              visible="{= ${/cancellationTrend/value} !== null &amp;&amp; ${/cancellationTrend/indicator} !== '' }"
              scale="%"
              indicator="{/cancellationTrend/indicator}"
              valueColor="{
                = ${/cancellationTrend/value} === 0 
                  ? 'Neutral' 
                  : (${/cancellationTrend/indicator} === 'Up' 
                     ? 'Error' 
                     : (${/cancellationTrend/indicator} === 'Down' ? 'Good' : 'Neutral'))
              }"
            />
          </m:TileContent>
        </m:tileContent>
      </m:GenericTile>

      <!-- (2) Cancellations per Day (Line Chart) -->
      <m:GenericTile
        id="cancellationsPerDayTile"
        header="Cancellations per Day"
        subheader="This Month"
        frameType="TwoByOne"
        class="sapUiSmallMargin myStylishTile">
        <m:tileContent>
          <m:TileContent>
            <viz:VizFrame
              id="cancellationChart"
              uiConfig="{applicationSet:'fiori'}"
              vizType="line"
              width="100%"
              height="100%">
              <viz:dataset>
                <vizdata:FlattenedDataset data="{/lineChartData}">
                  <vizdata:dimensions>
                    <vizdata:DimensionDefinition name="Date" value="{date}" />
                  </vizdata:dimensions>
                  <vizdata:measures>
                    <vizdata:MeasureDefinition name="Cancellations" value="{cancellations}" />
                  </vizdata:measures>
                </vizdata:FlattenedDataset>
              </viz:dataset>
              <viz:feeds>
                <feeds:FeedItem uid="primaryValues" type="Measure" values="Cancellations" />
                <feeds:FeedItem uid="axisLabels" type="Dimension" values="Date" />
              </viz:feeds>
            </viz:VizFrame>
          </m:TileContent>
        </m:tileContent>
      </m:GenericTile>

      <!-- (3) In-Progress Cancellations -->
      <m:GenericTile
        id="inProgressTile"
        header="In-Progress Cancellations"
        subheader="Pending Approvals"
        frameType="TwoByOne"
        class="sapUiSmallMargin myStylishTile">
        <m:tileContent>
          <m:TileContent>
            <m:NumericContent value="{/inProgressCount}" />
          </m:TileContent>
        </m:tileContent>
      </m:GenericTile>

    </m:HBox>


    <!-- Row 2 of tiles -->
    <m:HBox renderType="Bare" justifyContent="SpaceAround" class="sapUiSmallMargin">

      <!-- (4) Cancellation Status (Bar Chart) -->
      <m:GenericTile
        id="cancellationStatusTile"
        header="Cancellation Status"
        subheader="Last Month"
        frameType="TwoByOne"
        class="sapUiSmallMargin myStylishTile">
        <m:tileContent>
          <m:TileContent>
            <m:VBox>
              <viz:VizFrame
                id="cancellationStatusChart"
                uiConfig="{applicationSet:'fiori'}"
                vizType="column"
                width="100%"
                height="100%">
                <viz:dataset>
                  <vizdata:FlattenedDataset data="{/comparisonChartData}">
                    <vizdata:dimensions>
                      <vizdata:DimensionDefinition name="Status" value="{status}" />
                    </vizdata:dimensions>
                    <vizdata:measures>
                      <vizdata:MeasureDefinition name="Value" value="{value}" />
                    </vizdata:measures>
                  </vizdata:FlattenedDataset>
                </viz:dataset>
                <viz:feeds>
                  <feeds:FeedItem uid="primaryValues" type="Measure" values="Value" />
                  <feeds:FeedItem uid="axisLabels" type="Dimension" values="Status" />
                </viz:feeds>
              </viz:VizFrame>
              <m:Text text="{/cancellationStatusRate}" wrapping="true" />
              <m:Text text="{/cancellationStatusSuccessful}" wrapping="true" />
              <m:Text text="{/cancellationStatusFailed}" wrapping="true" />
            </m:VBox>
          </m:TileContent>
        </m:tileContent>
      </m:GenericTile>

      <!-- (5) Average Processing Time -->
      <m:GenericTile
        id="avgProcessingTimeTile"
        header="Avg Processing Time"
        subheader="Days to Complete"
        frameType="TwoByOne"
        class="sapUiSmallMargin myStylishTile">
        <m:tileContent>
          <m:TileContent>
            <m:NumericContent
              value="{/avgProcessingTime}"
              scale="days"
              valueColor="Neutral" />
          </m:TileContent>
        </m:tileContent>
      </m:GenericTile>

      <!-- (6) Top Cancellation Reasons (Donut Chart) -->
      <m:GenericTile
        id="cancellationReasonsTile"
        header="Top Cancellation Reasons"
        subheader="This Month"
        frameType="TwoByOne"
        class="sapUiSmallMargin myStylishTile myTileContainerClass">
        <m:tileContent>
          <m:TileContent>
            <viz:VizFrame
              id="cancellationReasonsChart"
              uiConfig="{applicationSet:'fiori'}"
              vizType="donut"
              width="100%"
              height="100%"
              vizProperties="{
                'legend': { 'visible': true },
                'title': { 'text': 'Cancellation Reasons' },
                'plotArea': {
                  'dataLabel': { 'visible': false }
                },
                'tooltip': {
                  'visible': true,
                  'formatString': 'n'
                }
              }">
              <viz:dataset>
                <vizdata:FlattenedDataset data="{/donutChartData}">
                  <vizdata:dimensions>
                    <vizdata:DimensionDefinition name="Reason" value="{reason}" />
                  </vizdata:dimensions>
                  <vizdata:measures>
                    <vizdata:MeasureDefinition name="Value" value="{value}" />
                  </vizdata:measures>
                </vizdata:FlattenedDataset>
              </viz:dataset>
              <viz:feeds>
                <feeds:FeedItem uid="size" type="Measure" values="Value" />
                <feeds:FeedItem uid="color" type="Dimension" values="Reason" />
              </viz:feeds>
            </viz:VizFrame>
          </m:TileContent>
        </m:tileContent>
      </m:GenericTile>

    </m:HBox>


    <!-- Row 3 (7) Pending Approvals -->
    <m:HBox renderType="Bare" justifyContent="SpaceAround" class="sapUiSmallMargin">
      <m:GenericTile
        id="pendingApprovalsTile"
        header="Pending Approvals Breakdown"
        subheader="By Stage"
        frameType="TwoByOne"
        class="sapUiSmallMargin myStylishTile">
        <m:tileContent>
          <m:TileContent>
            <viz:VizFrame
              id="pendingApprovalsChart"
              uiConfig="{applicationSet:'fiori'}"
              vizType="column"
              width="100%"
              height="100%">
              <viz:dataset>
                <vizdata:FlattenedDataset data="{/pendingChartData}">
                  <vizdata:dimensions>
                    <vizdata:DimensionDefinition name="Stage" value="{stage}" />
                  </vizdata:dimensions>
                  <vizdata:measures>
                    <vizdata:MeasureDefinition name="Value" value="{value}" />
                  </vizdata:measures>
                </vizdata:FlattenedDataset>
              </viz:dataset>
              <viz:feeds>
                <feeds:FeedItem uid="primaryValues" type="Measure" values="Value" />
                <feeds:FeedItem uid="axisLabels" type="Dimension" values="Stage" />
              </viz:feeds>
            </viz:VizFrame>
          </m:TileContent>
        </m:tileContent>
      </m:GenericTile>
    </m:HBox>

    <!-- A single card-like detail panel at the bottom -->
    <m:Panel
      id="globalDetailPanel"
      class="myDetailCard"
      headerText="{/detailHeader}"
      visible="{/detailVisible}">
      <m:List
        id="globalDetailList"
        items="{/detailData}">
        <m:StandardListItem title="{title}" description="{description}" />
      </m:List>
    </m:Panel>

  </m:VBox>
</mvc:View>
