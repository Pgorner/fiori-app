sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return e.extend("app.controller.App",{onInit:function(){var e={activeTile:null,detailVisible:false,detailHeader:"",detailData:[],cancellationTrend:{value:10,indicator:"Up"},trendDetails:[{title:"January 2025",description:"180 cancellations"},{title:"February 2025",description:"200 cancellations"}],lineChartData:[{date:"Feb 20, 2025",cancellations:10},{date:"Feb 21, 2025",cancellations:20},{date:"Feb 22, 2025",cancellations:15}],lineChartDetails:[{title:"Feb 23, 2025",description:"12 cancellations"},{title:"Feb 24, 2025",description:"18 cancellations"},{title:"Feb 25, 2025",description:"9 cancellations"}],inProgressCount:5,inProgressDetails:[{title:"Request #101",description:"Manager Review"},{title:"Request #102",description:"Final Approval"},{title:"Request #103",description:"Initial Review"},{title:"Request #104",description:"Manager Review"},{title:"Request #105",description:"Waiting on Customer"}],comparisonChartData:[{status:"Successful",value:4123},{status:"Failed",value:623}],cancellationStatusDetails:[{title:"Successful",description:"4123 cancellations"},{title:"Failed",description:"623 cancellations"}],cancellationStatusRate:"",cancellationStatusSuccessful:"",cancellationStatusFailed:"",avgProcessingTime:3,processingTimeDetails:[{title:"Sales Dept",description:"2.5 days"},{title:"Support Dept",description:"3.8 days"},{title:"Billing Dept",description:"2.9 days"}],donutChartData:[{reason:"Better Offer",value:40},{reason:"Service Issues",value:35},{reason:"Not Needed",value:25}],donutDetails:[{title:"Better Offer",description:"40 instances"},{title:"Service Issues",description:"35 instances"},{title:"Not Needed",description:"25 instances"}],pendingChartData:[{stage:"Initial Review",value:10},{stage:"Manager Approval",value:8},{stage:"Finalization",value:5}],pendingApprovalsDetails:[{title:"Initial Review",description:"10 approvals"},{title:"Manager Approval",description:"8 approvals"},{title:"Finalization",description:"5 approvals"}],tooltipContent:"Custom tooltip details go here."};var a=e.comparisonChartData;if(a&&a.length>=2){var i=a[0].value;var o=a[1].value;var r=i+o;var l=r>0?Math.round(i/r*100):0;e.cancellationStatusRate=l+"% Success Rate";e.cancellationStatusSuccessful=i+" Successful";e.cancellationStatusFailed=o+" Failed"}var n=new t(e);this.getView().setModel(n)},onAfterRendering:function(){this._attachDblClick("cancellationTrendTile");this._attachDblClick("cancellationsPerDayTile");this._attachDblClick("inProgressTile");this._attachDblClick("cancellationStatusTile");this._attachDblClick("avgProcessingTimeTile");this._attachDblClick("pendingApprovalsTile");var e=this.byId("cancellationReasonsChart");if(e){e.attachBrowserEvent("mouseover",this.onCustomTooltipMouseOver,this);e.attachBrowserEvent("mouseout",this.onCustomTooltipMouseOut,this)}var t=this.byId("cancellationChart");if(t){t.attachBrowserEvent("mouseover",this.onCustomTooltipMouseOver,this);t.attachBrowserEvent("mouseout",this.onCustomTooltipMouseOut,this)}var a=this.byId("pendingApprovalsChart");if(a){a.attachBrowserEvent("mouseover",this.onCustomTooltipMouseOver,this);a.attachBrowserEvent("mouseout",this.onCustomTooltipMouseOut,this)}},_attachDblClick:function(e){var t=this.byId(e);if(t){t.attachBrowserEvent("dblclick",this._onTileDoubleClick.bind(this,e))}},_onTileDoubleClick:function(e){var t=this.getView().getModel();var a=t.getProperty("/activeTile");var i=t.getProperty("/detailVisible");if(e===a){t.setProperty("/detailVisible",!i);return}t.setProperty("/activeTile",e);t.setProperty("/detailVisible",true);switch(e){case"cancellationTrendTile":t.setProperty("/detailHeader","Trend Details (Last vs Current Month)");t.setProperty("/detailData",t.getProperty("/trendDetails"));break;case"cancellationsPerDayTile":t.setProperty("/detailHeader","Cancellations per Day (Additional)");t.setProperty("/detailData",t.getProperty("/lineChartDetails"));break;case"inProgressTile":t.setProperty("/detailHeader","In-Progress Cancellations");t.setProperty("/detailData",t.getProperty("/inProgressDetails"));break;case"cancellationStatusTile":t.setProperty("/detailHeader","Cancellation Status Details");t.setProperty("/detailData",t.getProperty("/cancellationStatusDetails"));break;case"avgProcessingTimeTile":t.setProperty("/detailHeader","Average Processing Time (By Dept)");t.setProperty("/detailData",t.getProperty("/processingTimeDetails"));break;case"pendingApprovalsTile":t.setProperty("/detailHeader","Pending Approvals (By Stage)");t.setProperty("/detailData",t.getProperty("/pendingApprovalsDetails"));break;default:t.setProperty("/detailHeader","");t.setProperty("/detailData",[])}},onCustomTooltipMouseOver:function(e){if(!this._oTooltipPopover){this._oTooltipPopover=new sap.m.Popover({placement:"Auto",showHeader:false,content:new sap.m.Text({text:""})});this.getView().addDependent(this._oTooltipPopover)}var t=e.currentTarget.id;var a=this.byId("cancellationReasonsChart");var i=this.byId("cancellationChart");var o=this.byId("pendingApprovalsChart");if(t.indexOf("cancellationReasonsChart")!==-1){var r=a;var l=r.getDomRef();if(l){var n=l.getBoundingClientRect();var s=n.left+n.width/2;var c=n.top+n.height/2;var d=e.clientX-s;var p=e.clientY-c;var v=Math.sqrt(d*d+p*p);var u=Math.min(n.width,n.height)/2;var h=u*.3;if(v<h||v>u){if(this._oTooltipPopover&&this._oTooltipPopover.close){this._oTooltipPopover.close()}return}var g=Math.atan2(p,d);var f=g*(180/Math.PI);if(f<0){f+=360}var y=this.getView().getModel().getProperty("/donutChartData");if(y&&y.length>0){var P=y.reduce(function(e,t){return e+t.value},0);var T=0;var b=null;for(var D=0;D<y.length;D++){var C=y[D].value/P*360;if(f>=T&&f<T+C){b=y[D];break}T+=C}if(b){var m="Reason: "+b.reason+"\nValue: "+b.value;this._oTooltipPopover.getContent()[0].setText(m)}}}}else if(t.indexOf("cancellationChart")!==-1){var w=i;var l=w.getDomRef();if(l){var n=l.getBoundingClientRect();var M=e.clientX-n.left;var R=n.width;var y=this.getView().getModel().getProperty("/lineChartData");if(y&&y.length>0){var S=Math.floor(M/R*y.length);if(S<0){S=0}if(S>=y.length){S=y.length-1}var _=y[S];var m="Date: "+_.date+"\nCancellations: "+_.cancellations;this._oTooltipPopover.getContent()[0].setText(m)}}}else if(t.indexOf("pendingApprovalsChart")!==-1){var l=o.getDomRef();if(l){var n=l.getBoundingClientRect();var M=e.clientX-n.left;var R=n.width;var y=this.getView().getModel().getProperty("/pendingChartData");if(y&&y.length>0){var S=Math.floor(M/R*y.length);if(S<0){S=0}if(S>=y.length){S=y.length-1}var _=y[S];var m="Stage: "+_.stage+"\nValue: "+_.value;this._oTooltipPopover.getContent()[0].setText(m)}}}else{var F=this.getView().getModel().getProperty("/tooltipContent");this._oTooltipPopover.getContent()[0].setText(F)}this._oTooltipPopover.openBy(e.currentTarget)},onCustomTooltipMouseOut:function(e){if(this._oTooltipPopover&&this._oTooltipPopover.close){this._oTooltipPopover.close()}},formatValueColor:function(e){if(!e){return"Neutral"}if(e.value===0){return"Neutral"}else if(e.indicator==="Up"){return"Error"}else if(e.indicator==="Down"){return"Good"}return"Neutral"},onSearch:function(e){var t=e.getParameter("query");var a=[];if(t&&t.length>0){a.push(new sap.ui.model.Filter("title",sap.ui.model.FilterOperator.Contains,t));a.push(new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t))}var i=new sap.ui.model.Filter({filters:a,and:false});var o=this.byId("globalDetailTable");var r=o.getBinding("rows");r.filter(t?[i]:[])},onPrintPress:function(){var e=this.byId("globalDetailTable");var t=e.getSelectedIndices();var a=this.getView().getModel();var i=[];if(t&&t.length>0){t.forEach(function(t){var a=e.getContextByIndex(t);if(a){i.push(a.getObject())}})}else{i=a.getProperty("/detailData")}var o="<table border='1' style='width:100%; border-collapse:collapse;'>";o+="<thead><tr><th>Title</th><th>Description</th></tr></thead>";o+="<tbody>";if(i&&i.length>0){i.forEach(function(e){o+="<tr><td>"+e.title+"</td><td>"+e.description+"</td></tr>"})}else{o+="<tr><td colspan='2'>No data</td></tr>"}o+="</tbody></table>";var r="<style>"+"table { width: 100%; border-collapse: collapse; }"+"th, td { border: 1px solid #000; padding: 5px; text-align: left; }"+"</style>";var l="<html><head><title>Print Table</title>"+r+"</head><body>"+o+"</body></html>";var n=window.open("","_blank");n.document.open();n.document.write(l);n.document.close();n.focus();n.print();n.close()},onExportPress:function(e){var t=this.getView().getModel();var a=t.getProperty("/detailData");if(!a||!a.length){sap.m.MessageToast.show("No data available for export.");return}var i="Title,Description\n";a.forEach(function(e){i+='"'+e.title+'","'+e.description+'"\n'});var o=new Blob([i],{type:"text/csv;charset=utf-8;"});var r=URL.createObjectURL(o);var l=document.createElement("a");l.href=r;l.download="DetailData.csv";l.style.display="none";document.body.appendChild(l);l.click();document.body.removeChild(l)}})});
//# sourceMappingURL=App.controller.js.map