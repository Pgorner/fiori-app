/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define([], function () {
  "use strict";

  const ChildEntity = {
    //fun calculateTotalAmount = function(parentID: number): void {
    async onAfterUpdateEntry(keyValues, updatedData, odataRequest) {
      const entries = await this.base?.getAllEntries(odataRequest);
      const parentKey = {
        ID: updatedData.Parent_ID
      };

      // fetch parent
      const parent = await this.base?.getParentEntityInterface();
      if (parent) {
        const parentRoot = (await parent.fetchEntries(parentKey, odataRequest))[0];
        //side effect sample 4: filter on parent entries and calculate total amount
        parentRoot.totalAmount = entries.filter(x => x.Parent_ID === updatedData.Parent_ID).reduce((sum, current) => sum + parseFloat(current.price.toString()), 0);
        //update parent item
        await parent.updateEntry?.(parentKey, parentRoot, parentRoot, odataRequest);
      }
    },
    async removeEntry(keyValues, odataRequest) {
      //get parent before child item is deleted
      const currentEntry = (await this.base.fetchEntries(keyValues, odataRequest))[0];
      const parentID = currentEntry.Parent_ID;
      const parentKey = {
        ID: parentID
      };
      await this.base?.removeEntry(keyValues, odataRequest);
      const entries = await this.base.getAllEntries(odataRequest);
      const parent = await this.base?.getParentEntityInterface();
      // fetch parent
      if (parent) {
        const parentRoot = (await parent.fetchEntries(parentKey, odataRequest))[0];
        if (entries.length > 0) {
          //side effect sample 4: filter on parent entries and calculate total amount
          parentRoot.totalAmount = entries.filter(x => x.Parent_ID === parentID).reduce((sum, current) => sum + parseFloat(current.price.toString()), 0);
          //update parent item
        } else {
          parentRoot.totalAmount = 0;
        }
        await parent.updateEntry(parentKey, parentRoot, parentRoot, odataRequest);
      }
    }
  };
  return ChildEntity;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJDaGlsZEVudGl0eSIsIm9uQWZ0ZXJVcGRhdGVFbnRyeSIsImtleVZhbHVlcyIsInVwZGF0ZWREYXRhIiwib2RhdGFSZXF1ZXN0IiwiZW50cmllcyIsImJhc2UiLCJnZXRBbGxFbnRyaWVzIiwicGFyZW50S2V5IiwiSUQiLCJQYXJlbnRfSUQiLCJwYXJlbnQiLCJnZXRQYXJlbnRFbnRpdHlJbnRlcmZhY2UiLCJwYXJlbnRSb290IiwiZmV0Y2hFbnRyaWVzIiwidG90YWxBbW91bnQiLCJmaWx0ZXIiLCJ4IiwicmVkdWNlIiwic3VtIiwiY3VycmVudCIsInBhcnNlRmxvYXQiLCJwcmljZSIsInRvU3RyaW5nIiwidXBkYXRlRW50cnkiLCJyZW1vdmVFbnRyeSIsImN1cnJlbnRFbnRyeSIsInBhcmVudElEIiwibGVuZ3RoIl0sInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyJDaGlsZEVudGl0eS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE1vY2tEYXRhQ29udHJpYnV0b3IgfSBmcm9tIFwiQHNhcC11eC91aTUtbWlkZGxld2FyZS1mZS1tb2Nrc2VydmVyXCI7XG5pbXBvcnQgdHlwZSB7IENoaWxkRW50aXR5VHlwZSwgUm9vdEVudGl0eVR5cGUgfSBmcm9tIFwiLi90eXBlc1wiO1xuY29uc3QgQ2hpbGRFbnRpdHk6IE1vY2tEYXRhQ29udHJpYnV0b3I8b2JqZWN0PiA9IHtcblx0Ly9mdW4gY2FsY3VsYXRlVG90YWxBbW91bnQgPSBmdW5jdGlvbihwYXJlbnRJRDogbnVtYmVyKTogdm9pZCB7XG5cdGFzeW5jIG9uQWZ0ZXJVcGRhdGVFbnRyeShrZXlWYWx1ZXMsIHVwZGF0ZWREYXRhOiBDaGlsZEVudGl0eVR5cGUsIG9kYXRhUmVxdWVzdDogYW55KSB7XG5cdFx0Y29uc3QgZW50cmllczogQXJyYXk8Q2hpbGRFbnRpdHlUeXBlPiA9IChhd2FpdCB0aGlzLmJhc2U/LmdldEFsbEVudHJpZXMob2RhdGFSZXF1ZXN0KSkgYXMgQXJyYXk8Q2hpbGRFbnRpdHlUeXBlPjtcblx0XHRjb25zdCBwYXJlbnRLZXk6IGFueSA9IHsgSUQ6IHVwZGF0ZWREYXRhLlBhcmVudF9JRCB9O1xuXG5cdFx0Ly8gZmV0Y2ggcGFyZW50XG5cdFx0Y29uc3QgcGFyZW50ID0gYXdhaXQgdGhpcy5iYXNlPy5nZXRQYXJlbnRFbnRpdHlJbnRlcmZhY2UoKTtcblx0XHRpZiAocGFyZW50KSB7XG5cdFx0XHRjb25zdCBwYXJlbnRSb290ID0gKGF3YWl0IHBhcmVudC5mZXRjaEVudHJpZXMocGFyZW50S2V5LCBvZGF0YVJlcXVlc3QpKVswXSBhcyBSb290RW50aXR5VHlwZTtcblx0XHRcdC8vc2lkZSBlZmZlY3Qgc2FtcGxlIDQ6IGZpbHRlciBvbiBwYXJlbnQgZW50cmllcyBhbmQgY2FsY3VsYXRlIHRvdGFsIGFtb3VudFxuXHRcdFx0cGFyZW50Um9vdC50b3RhbEFtb3VudCA9IGVudHJpZXNcblx0XHRcdFx0LmZpbHRlcigoeCkgPT4geC5QYXJlbnRfSUQgPT09IHVwZGF0ZWREYXRhLlBhcmVudF9JRClcblx0XHRcdFx0LnJlZHVjZSgoc3VtLCBjdXJyZW50KSA9PiBzdW0gKyBwYXJzZUZsb2F0KGN1cnJlbnQucHJpY2UudG9TdHJpbmcoKSksIDApO1xuXHRcdFx0Ly91cGRhdGUgcGFyZW50IGl0ZW1cblx0XHRcdGF3YWl0IHBhcmVudC51cGRhdGVFbnRyeT8uKHBhcmVudEtleSwgcGFyZW50Um9vdCwgcGFyZW50Um9vdCwgb2RhdGFSZXF1ZXN0KTtcblx0XHR9XG5cdH0sXG5cdGFzeW5jIHJlbW92ZUVudHJ5KGtleVZhbHVlcywgb2RhdGFSZXF1ZXN0KSB7XG5cdFx0Ly9nZXQgcGFyZW50IGJlZm9yZSBjaGlsZCBpdGVtIGlzIGRlbGV0ZWRcblx0XHRjb25zdCBjdXJyZW50RW50cnkgPSAoYXdhaXQgdGhpcy5iYXNlIS5mZXRjaEVudHJpZXMoa2V5VmFsdWVzLCBvZGF0YVJlcXVlc3QpKVswXSBhcyBDaGlsZEVudGl0eVR5cGU7XG5cdFx0Y29uc3QgcGFyZW50SUQgPSBjdXJyZW50RW50cnkuUGFyZW50X0lEO1xuXHRcdGNvbnN0IHBhcmVudEtleTogYW55ID0geyBJRDogcGFyZW50SUQgfTtcblx0XHRhd2FpdCB0aGlzLmJhc2U/LnJlbW92ZUVudHJ5KGtleVZhbHVlcywgb2RhdGFSZXF1ZXN0KTtcblx0XHRjb25zdCBlbnRyaWVzOiBBcnJheTxDaGlsZEVudGl0eVR5cGU+ID0gKGF3YWl0IHRoaXMuYmFzZSEuZ2V0QWxsRW50cmllcyhvZGF0YVJlcXVlc3QpKSBhcyBBcnJheTxDaGlsZEVudGl0eVR5cGU+O1xuXHRcdGNvbnN0IHBhcmVudCA9IGF3YWl0IHRoaXMuYmFzZT8uZ2V0UGFyZW50RW50aXR5SW50ZXJmYWNlKCk7XG5cdFx0Ly8gZmV0Y2ggcGFyZW50XG5cdFx0aWYgKHBhcmVudCkge1xuXHRcdFx0Y29uc3QgcGFyZW50Um9vdCA9IChhd2FpdCBwYXJlbnQuZmV0Y2hFbnRyaWVzKHBhcmVudEtleSwgb2RhdGFSZXF1ZXN0KSlbMF0gYXMgUm9vdEVudGl0eVR5cGU7XG5cdFx0XHRpZiAoZW50cmllcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdC8vc2lkZSBlZmZlY3Qgc2FtcGxlIDQ6IGZpbHRlciBvbiBwYXJlbnQgZW50cmllcyBhbmQgY2FsY3VsYXRlIHRvdGFsIGFtb3VudFxuXHRcdFx0XHRwYXJlbnRSb290LnRvdGFsQW1vdW50ID0gZW50cmllc1xuXHRcdFx0XHRcdC5maWx0ZXIoKHgpID0+IHguUGFyZW50X0lEID09PSBwYXJlbnRJRClcblx0XHRcdFx0XHQucmVkdWNlKChzdW0sIGN1cnJlbnQpID0+IHN1bSArIHBhcnNlRmxvYXQoY3VycmVudC5wcmljZS50b1N0cmluZygpKSwgMCk7XG5cdFx0XHRcdC8vdXBkYXRlIHBhcmVudCBpdGVtXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRwYXJlbnRSb290LnRvdGFsQW1vdW50ID0gMDtcblx0XHRcdH1cblx0XHRcdGF3YWl0IHBhcmVudC51cGRhdGVFbnRyeShwYXJlbnRLZXksIHBhcmVudFJvb3QsIHBhcmVudFJvb3QsIG9kYXRhUmVxdWVzdCk7XG5cdFx0fVxuXHR9XG59O1xuZXhwb3J0IGRlZmF1bHQgQ2hpbGRFbnRpdHk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7RUFFQSxNQUFNQSxXQUF3QyxHQUFHO0lBQ2hEO0lBQ0EsTUFBTUMsa0JBQWtCQSxDQUFDQyxTQUFTLEVBQUVDLFdBQTRCLEVBQUVDLFlBQWlCLEVBQUU7TUFDcEYsTUFBTUMsT0FBK0IsR0FBSSxNQUFNLElBQUksQ0FBQ0MsSUFBSSxFQUFFQyxhQUFhLENBQUNILFlBQVksQ0FBNEI7TUFDaEgsTUFBTUksU0FBYyxHQUFHO1FBQUVDLEVBQUUsRUFBRU4sV0FBVyxDQUFDTztNQUFVLENBQUM7O01BRXBEO01BQ0EsTUFBTUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDTCxJQUFJLEVBQUVNLHdCQUF3QixDQUFDLENBQUM7TUFDMUQsSUFBSUQsTUFBTSxFQUFFO1FBQ1gsTUFBTUUsVUFBVSxHQUFHLENBQUMsTUFBTUYsTUFBTSxDQUFDRyxZQUFZLENBQUNOLFNBQVMsRUFBRUosWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFtQjtRQUM1RjtRQUNBUyxVQUFVLENBQUNFLFdBQVcsR0FBR1YsT0FBTyxDQUM5QlcsTUFBTSxDQUFFQyxDQUFDLElBQUtBLENBQUMsQ0FBQ1AsU0FBUyxLQUFLUCxXQUFXLENBQUNPLFNBQVMsQ0FBQyxDQUNwRFEsTUFBTSxDQUFDLENBQUNDLEdBQUcsRUFBRUMsT0FBTyxLQUFLRCxHQUFHLEdBQUdFLFVBQVUsQ0FBQ0QsT0FBTyxDQUFDRSxLQUFLLENBQUNDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDekU7UUFDQSxNQUFNWixNQUFNLENBQUNhLFdBQVcsR0FBR2hCLFNBQVMsRUFBRUssVUFBVSxFQUFFQSxVQUFVLEVBQUVULFlBQVksQ0FBQztNQUM1RTtJQUNELENBQUM7SUFDRCxNQUFNcUIsV0FBV0EsQ0FBQ3ZCLFNBQVMsRUFBRUUsWUFBWSxFQUFFO01BQzFDO01BQ0EsTUFBTXNCLFlBQVksR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDcEIsSUFBSSxDQUFFUSxZQUFZLENBQUNaLFNBQVMsRUFBRUUsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFvQjtNQUNuRyxNQUFNdUIsUUFBUSxHQUFHRCxZQUFZLENBQUNoQixTQUFTO01BQ3ZDLE1BQU1GLFNBQWMsR0FBRztRQUFFQyxFQUFFLEVBQUVrQjtNQUFTLENBQUM7TUFDdkMsTUFBTSxJQUFJLENBQUNyQixJQUFJLEVBQUVtQixXQUFXLENBQUN2QixTQUFTLEVBQUVFLFlBQVksQ0FBQztNQUNyRCxNQUFNQyxPQUErQixHQUFJLE1BQU0sSUFBSSxDQUFDQyxJQUFJLENBQUVDLGFBQWEsQ0FBQ0gsWUFBWSxDQUE0QjtNQUNoSCxNQUFNTyxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUNMLElBQUksRUFBRU0sd0JBQXdCLENBQUMsQ0FBQztNQUMxRDtNQUNBLElBQUlELE1BQU0sRUFBRTtRQUNYLE1BQU1FLFVBQVUsR0FBRyxDQUFDLE1BQU1GLE1BQU0sQ0FBQ0csWUFBWSxDQUFDTixTQUFTLEVBQUVKLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBbUI7UUFDNUYsSUFBSUMsT0FBTyxDQUFDdUIsTUFBTSxHQUFHLENBQUMsRUFBRTtVQUN2QjtVQUNBZixVQUFVLENBQUNFLFdBQVcsR0FBR1YsT0FBTyxDQUM5QlcsTUFBTSxDQUFFQyxDQUFDLElBQUtBLENBQUMsQ0FBQ1AsU0FBUyxLQUFLaUIsUUFBUSxDQUFDLENBQ3ZDVCxNQUFNLENBQUMsQ0FBQ0MsR0FBRyxFQUFFQyxPQUFPLEtBQUtELEdBQUcsR0FBR0UsVUFBVSxDQUFDRCxPQUFPLENBQUNFLEtBQUssQ0FBQ0MsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztVQUN6RTtRQUNELENBQUMsTUFBTTtVQUNOVixVQUFVLENBQUNFLFdBQVcsR0FBRyxDQUFDO1FBQzNCO1FBQ0EsTUFBTUosTUFBTSxDQUFDYSxXQUFXLENBQUNoQixTQUFTLEVBQUVLLFVBQVUsRUFBRUEsVUFBVSxFQUFFVCxZQUFZLENBQUM7TUFDMUU7SUFDRDtFQUNELENBQUM7RUFBQyxPQUNhSixXQUFXO0FBQUEiLCJpZ25vcmVMaXN0IjpbXX0=