<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>SmartField FieldGroupIDs</title>

	<script id="sap-ui-bootstrap"
			data-sap-ui-async="true"
			data-sap-ui-compat-version="edge"
			data-sap-ui-libs="sap.m, sap.ui.comp"
			src="../../../../../../../../../resources/sap-ui-core.js">
	</script>

	<script id="mainView" type="text/xml">
		<mvc:View
				viewName="myView"
				xmlns:mvc="sap.ui.core.mvc"
				controllerName="mainView.controller"
				xmlns="sap.m"
				xmlns:smartForm="sap.ui.comp.smartform"
				xmlns:smartField="sap.ui.comp.smartfield"
				height="100%">

			<App>
				<Page id="page" title="SmartField navigation properties">
					<smartForm:SmartForm id="smartForm" binding="{/Products('001')}" editable="true" title="FE Api" validateFieldGroup=".handleValidate">
						<smartForm:Group>
							<smartForm:GroupElement label="FG from service metadata">

								<smartField:SmartField id="FGSM" value="{Description}"/>

							</smartForm:GroupElement>
							<smartForm:GroupElement label="No Field Group IDs">

								<smartField:SmartField id="NOFG" value="{to_ProductCategories/Description}"/>
								<Button id="applyFieldGroupIDs" text="Apply FieldGroupIDs" press=".recalculateFieldGroupIDs"/>

							</smartForm:GroupElement>
							<smartForm:GroupElement label="FG precedence">

								<smartField:SmartField id="FGP" value="{Description}"/>

							</smartForm:GroupElement>
						</smartForm:Group>

					</smartForm:SmartForm>
				</Page>
			</App>
		</mvc:View>
	</script>

	<script id="metadata" type="text/xml"><?xml version="1.0" encoding="utf-8"?>
		<edmx:Edmx Version="1.0"
				   xmlns:edmx="http://schemas.microsoft.com/ado/2007/06/edmx"
				   xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
				   xmlns:sap="http://www.sap.com/Protocols/SAPData">
			<edmx:DataServices m:DataServiceVersion="2.0">
				<Schema Namespace="smartfield.TextInEditModeSource" sap:schema-version="1"
						xmlns="http://schemas.microsoft.com/ado/2008/09/edm">

					<EntityType Name="Product" sap:content-version="1">
						<Key>
							<PropertyRef Name="ID"/>
						</Key>
						<Property Name="ID" Type="Edm.String" Nullable="false" MaxLength="20" sap:label="Product ID" sap:creatable="false" sap:updatable="true" sap:sortable="false"/>
						<Property Name="CategoryID" Type="Edm.String" Nullable="true" MaxLength="3" sap:label="Category" sap:creatable="false" sap:updatable="true" sap:sortable="false"/>
						<Property Name="Description"
								  Type="Edm.String"
								  MaxLength="30"
								  sap:label="Local property"
								  sap:creatable="true"
								  sap:updatable="true"
								  sap:quickinfo="Property annotation DataFieldWithUrl"
								  sap:sortable="true"
						/>
						<Property Name="Description_fc"
								  Type="Edm.Byte"
								  Nullable="false"
								  MaxLength="30"
								  sap:label="Name"
								  sap:creatable="true"
								  sap:updatable="true"
								  sap:sortable="false"/>

						<Property Name="Data_mc"
								  Type="Edm.Boolean"/>

						<NavigationProperty Name="to_ProductCategories"
											Relationship="smartfield.TextInEditModeSource.ProductCategory"
											FromRole="FromRole_ProductCategory"
											ToRole="ToRole_ProductCategory"/>
					</EntityType>

					<EntityType Name="Category" sap:content-version="1" >
						<Key>
							<PropertyRef Name="ID"/>
						</Key>
						<Property Name="ID" Type="Edm.String" Nullable="true" MaxLength="3" sap:label="Category" sap:creatable="true" sap:updatable="true" sap:sortable="false"/>
						<Property Name="Description"
								  Type="Edm.String"
								  MaxLength="30"
								  sap:label="Foreign property"
								  sap:creatable="true"
								  sap:updatable="true"
								  sap:sortable="false"/>
						<Property Name="Update_mc" Type="Edm.Boolean" sap:label="Dyn. Method Control" sap:creatable="true" sap:updatable="true" sap:sortable="false" sap:filterable="false"/>
					</EntityType>

					<Association Name="ProductCategory" sap:content-version="1">
						<End Type="smartfield.TextInEditModeSource.Product" Multiplicity="*" Role="FromRole_ProductCategory"/>
						<End Type="smartfield.TextInEditModeSource.Category" Multiplicity="0..1" Role="ToRole_ProductCategory"/>
						<ReferentialConstraint>
							<Principal Role="ToRole_ProductCategory">
								<PropertyRef Name="ID"/>
							</Principal>
							<Dependent Role="FromRole_ProductCategory">
								<PropertyRef Name="CategoryID"/>
							</Dependent>
						</ReferentialConstraint>
					</Association>

					<EntityContainer Name="smartfield.TextInEditModeSource_Entities" m:IsDefaultEntityContainer="true" sap:supported-formats="atom json xlsx">
						<EntitySet Name="Products"
								   EntityType="smartfield.TextInEditModeSource.Product"
								   sap:creatable="true"
								   sap:updatable="true"
								   sap:deletable="false"
								   sap:pageable="false"
								   sap:content-version="1"
						/>
						<EntitySet Name="Categories"
								   EntityType="smartfield.TextInEditModeSource.Category"
								   sap:creatable="true"
								   sap:deletable="true"
								   sap:pageable="false"
								   sap:content-version="1"
						/>
						<AssociationSet Name="ProductCategoriesSet" Association="smartfield.TextInEditModeSource.ProductCategory" sap:creatable="false" sap:updatable="false" sap:deletable="false" sap:content-version="1">
							<End EntitySet="Products" Role="FromRole_ProductCategory"/>
							<End EntitySet="Categories" Role="ToRole_ProductCategory"/>
						</AssociationSet>
					</EntityContainer>

					<Annotations Target="smartfield.TextInEditModeSource.Product"
								 xmlns="http://docs.oasis-open.org/odata/ns/edm">

						<Annotation Term="com.sap.vocabularies.Common.v1.SideEffects" Qualifier="BusinessPartnerChanged">
							<Record>
								<PropertyValue Property="SourceProperties">
									<Collection>
										<PropertyPath>Description</PropertyPath>
									</Collection>
								</PropertyValue>
								<PropertyValue Property="TargetProperties">
									<Collection>
										<!-- '*' fetches all the field's values of the entity on which the side effect is annotated -->
										<String>*</String>
									</Collection>
								</PropertyValue>
							</Record>
						</Annotation>
					</Annotations>

				</Schema>
			</edmx:DataServices>
		</edmx:Edmx>
	</script>

	<script id="products" type="application/json">
		{"d": {
			"__count": "5",
			"results":
			[
				{
					"__metadata": {
						"id": "Products('001')",
						"uri": "Products('001')",
						"type": "smartfield.TextInEditModeSource.Products"
					},
					"ID": "001",
					"CategoryID": "PR",
					"Description": "Power Projector 4713",
					"Description_fc": 3,
					"SupplierID": "DL",
					"Data_mc": true,
					"SupplierIDNoValidation": "DL",
					"ProductRating": 1,
					"to_ProductCategories": {
						"__metadata": {
							"id": "Categories('LT')",
							"uri": "Categories('LT')",
							"type": "smartfield.TextInEditModeSource.Categories"
						},
						"ID": "LT",
						"Update_mc": true,
						"Description": "Laptop"
					}
				}
			]
		}}
	</script>

</head>

<script src="./FieldGroupIDs.js"></script>

<body class='sapUiBody'>
	<div id='content'></div>
</body>
</html>
