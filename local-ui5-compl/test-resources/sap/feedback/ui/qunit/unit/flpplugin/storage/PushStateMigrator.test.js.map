{"version":3,"file":"PushStateMigrator.test.js","names":["executePushStateMigratorTests","debugLogStub","QUnit","module","beforeEach","sinon","stub","Log","afterEach","restore","test","assert","getUserStateStub","LocalStorageHandler","returns","undefined","setUserStateStub","PushStateMigrator","migrate","notOk","called","timedPushDate","appPushDate","appPushStates","version","ok","calledWith","Constants","DEBUG","NO_OLD_PUSH_STATE","COMPONENT","PUSH_STATE_MIGRATOR","oldUserState","currentTheme","lastTheme","featurePushStates","inAppPushDate","newUserState","dynamicPushDate","areaId","executedCount","lastChanged","triggerName","triggerType","triggeredCount"],"sourceRoot":".","sources":["PushStateMigrator.test.ts"],"sourcesContent":["import Log from 'sap/base/Log';\nimport Constants from 'sap/feedback/ui/flpplugin/common/Constants';\nimport LocalStorageHandler from 'sap/feedback/ui/flpplugin/storage/LocalStorageHandler';\nimport PushStateMigrator from 'sap/feedback/ui/flpplugin/storage/PushStateMigrator';\n// eslint-disable-next-line import/no-unresolved\nimport * as sinon from 'sinon';\n\nexport default function executePushStateMigratorTests() {\n\tlet debugLogStub: sinon.SinonStub<any[], any>;\n\tQUnit.module('PushStateMigrator unit tests', {\n\t\tbeforeEach: function () {\n\t\t\tdebugLogStub = sinon.stub(Log, 'debug');\n\t\t},\n\n\t\tafterEach: function () {\n\t\t\tdebugLogStub.restore();\n\t\t}\n\t});\n\n\tQUnit.test('migrate - shall not do anything when userState is not found', (assert) => {\n\t\tconst getUserStateStub = sinon.stub(LocalStorageHandler, 'getUserState').returns(undefined);\n\t\tconst setUserStateStub = sinon.stub(LocalStorageHandler, 'updateUserState');\n\n\t\tPushStateMigrator.migrate();\n\n\t\tassert.notOk(setUserStateStub.called);\n\n\t\tgetUserStateStub.restore();\n\t\tsetUserStateStub.restore();\n\t});\n\n\tQUnit.test('migrate - shall not migrate the push state when there is no OLD push state found', (assert) => {\n\t\tconst getUserStateStub = sinon.stub(LocalStorageHandler, 'getUserState').returns({\n\t\t\ttimedPushDate: 1675242558195,\n\t\t\tappPushDate: 1675242558195,\n\t\t\tappPushStates: {},\n\t\t\tversion: 0\n\t\t});\n\t\tconst setUserStateStub = sinon.stub(LocalStorageHandler, 'updateUserState');\n\n\t\tPushStateMigrator.migrate();\n\n\t\tassert.notOk(setUserStateStub.called);\n\t\tassert.ok(debugLogStub.calledWith(Constants.DEBUG.NO_OLD_PUSH_STATE, undefined, Constants.COMPONENT.PUSH_STATE_MIGRATOR));\n\n\t\tgetUserStateStub.restore();\n\t\tsetUserStateStub.restore();\n\t});\n\n\tQUnit.test('migrate - shall not update the Push state - without Push states', (assert) => {\n\t\tconst oldUserState = {\n\t\t\tcurrentTheme: 'my_theme',\n\t\t\tlastTheme: 'my_theme',\n\t\t\tversion: 1\n\t\t};\n\t\tconst getUserStateStub = sinon.stub(LocalStorageHandler, 'getUserState').returns(oldUserState);\n\t\tconst setUserStateStub = sinon.stub(LocalStorageHandler, 'updateUserState');\n\n\t\tPushStateMigrator.migrate();\n\n\t\tassert.notOk(setUserStateStub.called);\n\t\tassert.ok(debugLogStub.calledWith(Constants.DEBUG.NO_OLD_PUSH_STATE, undefined, Constants.COMPONENT.PUSH_STATE_MIGRATOR));\n\n\t\tgetUserStateStub.restore();\n\t\tsetUserStateStub.restore();\n\t});\n\n\tQUnit.test('migrate - shall update the Push state with new Keys - with App triggered', (assert) => {\n\t\tconst oldUserState = {\n\t\t\tcurrentTheme: 'my_theme',\n\t\t\tfeaturePushStates: {},\n\t\t\tinAppPushDate: 1675242558195,\n\t\t\tlastTheme: 'my_theme',\n\t\t\tversion: 1\n\t\t};\n\t\tconst newUserState = {\n\t\t\tcurrentTheme: 'my_theme',\n\t\t\tappPushStates: {},\n\t\t\tappPushDate: 1675242558195,\n\t\t\tlastTheme: 'my_theme',\n\t\t\tversion: 1\n\t\t};\n\t\tconst getUserStateStub = sinon.stub(LocalStorageHandler, 'getUserState').returns(oldUserState);\n\t\tconst setUserStateStub = sinon.stub(LocalStorageHandler, 'updateUserState');\n\n\t\tPushStateMigrator.migrate();\n\n\t\tassert.ok(setUserStateStub.calledWith(newUserState));\n\n\t\tgetUserStateStub.restore();\n\t\tsetUserStateStub.restore();\n\t});\n\n\tQUnit.test('migrate - shall update the Push state with new Keys - with Time controlled', (assert) => {\n\t\tconst oldUserState = {\n\t\t\tcurrentTheme: 'my_theme',\n\t\t\tdynamicPushDate: 1675242558195,\n\t\t\tlastTheme: 'my_theme',\n\t\t\tversion: 1\n\t\t};\n\t\tconst newUserState = {\n\t\t\tcurrentTheme: 'my_theme',\n\t\t\ttimedPushDate: 1675242558195,\n\t\t\tlastTheme: 'my_theme',\n\t\t\tversion: 1\n\t\t};\n\t\tconst getUserStateStub = sinon.stub(LocalStorageHandler, 'getUserState').returns(oldUserState);\n\t\tconst setUserStateStub = sinon.stub(LocalStorageHandler, 'updateUserState');\n\n\t\tPushStateMigrator.migrate();\n\n\t\tassert.ok(setUserStateStub.calledWith(newUserState));\n\n\t\tgetUserStateStub.restore();\n\t\tsetUserStateStub.restore();\n\t});\n\n\tQUnit.test('migrate - shall update the Push state with new Keys - with App push and Time controlled push', (assert) => {\n\t\tconst oldUserState = {\n\t\t\tcurrentTheme: 'my_theme',\n\t\t\tdynamicPushDate: 1675242558195,\n\t\t\tfeaturePushStates: {\n\t\t\t\t'002/poc': {\n\t\t\t\t\tareaId: '007',\n\t\t\t\t\texecutedCount: 1,\n\t\t\t\t\tlastChanged: 1675175919691,\n\t\t\t\t\ttriggerName: 'pocTrigger',\n\t\t\t\t\ttriggerType: 'recurring',\n\t\t\t\t\ttriggeredCount: 1\n\t\t\t\t}\n\t\t\t},\n\t\t\tinAppPushDate: 1675242558195,\n\t\t\tlastTheme: 'my_theme',\n\t\t\tversion: 1\n\t\t};\n\t\tconst newUserState = {\n\t\t\tcurrentTheme: 'my_theme',\n\t\t\ttimedPushDate: 1675242558195,\n\t\t\tappPushStates: {\n\t\t\t\t'002/poc': {\n\t\t\t\t\tareaId: '007',\n\t\t\t\t\texecutedCount: 1,\n\t\t\t\t\tlastChanged: 1675175919691,\n\t\t\t\t\ttriggerName: 'pocTrigger',\n\t\t\t\t\ttriggerType: 'recurring',\n\t\t\t\t\ttriggeredCount: 1\n\t\t\t\t}\n\t\t\t},\n\t\t\tappPushDate: 1675242558195,\n\t\t\tlastTheme: 'my_theme',\n\t\t\tversion: 1\n\t\t};\n\t\tconst getUserStateStub = sinon.stub(LocalStorageHandler, 'getUserState').returns(oldUserState);\n\t\tconst setUserStateStub = sinon.stub(LocalStorageHandler, 'updateUserState');\n\n\t\tPushStateMigrator.migrate();\n\n\t\tassert.ok(setUserStateStub.calledWith(newUserState));\n\n\t\tgetUserStateStub.restore();\n\t\tsetUserStateStub.restore();\n\t});\n}\n"],"mappings":"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","ignoreList":[]}