<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:build="sap.build"
    xmlns:ovp="sap.ovp.ui"
    xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
    template:require="{
		CardAnnotationhelper: 'sap/ovp/cards/AnnotationHelper'
	}"    
>
    <template:if test="{= ${ovpCardProperties>/disableTableCardFlexibility} === true}">
        <template:then>
    <template:with 
        path='ovpCardProperties>/annotationPath'
        helper="CardAnnotationhelper.resolveEntityTypePath" 
        var='lineItem'>
        <columns>
            <Column>
                <Text
                    text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.getFirstDataFieldName'}"
                    build:metadata="#pattern:GenericCard>Table;prop::FirstColumnTitle:\{lineItem>/0/Label\};"/>
            </Column>
            <Column>
                <Text
                    text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.getSecondDataFieldName'}"
                    build:metadata="#pattern:GenericCard>Table;prop::SecondColumnTitle:\{lineItem>/1/Label\};"/>
            </Column>
            <Column>
                <template:if test="{= ${path: 'lineItem>', formatter: 'CardAnnotationhelper.getDataPointsCount'} > 0}">
                    <template:then>
                        <Text 
                            class="textAlignRight displayBlock"
                            text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.getFirstDataPointName'}"
                            build:metadata="#pattern:GenericCard>Table;prop::ThirdColumnTitle:\{lineItem>/2/Target@@Title\};"/>
                    </template:then>
                    <template:else>
                        <Text text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.getThirdDataFieldName'}"/>
                    </template:else>
                </template:if>
            </Column>
        </columns>
        <items>
            <ColumnListItem
                core:require="{CardAnnotationhelper: 'sap/ovp/cards/AnnotationHelper'}"
                type="Active"
                press="onColumnListItemPress">
                <cells>
                    <Text 
                        class="{= ${ovpCardProperties>/webkitSupport} ? 'sapTableDataRow' : 'sapTableDataRowIE' }"
                        text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.formatFirstDataFieldValue'}"
                        build:metadata="#pattern:GenericCard>Table;prop::FirstAttribute:\{lineItem>/0/Value\}"/>
                    <Text
                        class="{= ${ovpCardProperties>/webkitSupport} ? 'sapTableDataRow' : 'sapTableDataRowIE' }"
                        text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.formatSecondDataFieldValue'}"
                        build:metadata="#pattern:GenericCard>Table;prop::SecondAttribute:\{lineItem>/1/Value\}"/>
                    <template:if test="{= ${path: 'lineItem>', formatter: 'CardAnnotationhelper.getDataPointsCount'} > 0}">
                        <template:then>
                            <template:if
                                test="{= ${path: 'lineItem>', formatter: 'CardAnnotationhelper.isFirstDataPointCriticality'} === true &amp;&amp; ${ovpCardProperties>/enableLocaleCurrencyFormatting} === false}">
                                <template:then>
                                    <ObjectStatus class="textAlignRight"
                                        text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.formatFirstDataPointValue'}" 
                                        state="{path: 'lineItem>', formatter: 'CardAnnotationhelper.formatFirstDataPointState'}"/>
                                </template:then>
                                <template:else>
                                    <ObjectNumber
                                        class="textAlignRight"
                                        number="{path: 'lineItem>', formatter: 'CardAnnotationhelper.formatFirstDataPointValue'}"
                                        state="{path: 'lineItem>', formatter: 'CardAnnotationhelper.formatFirstDataPointState'}"
                                        build:metadata="#pattern:GenericCard>Table;prop::Number:\{lineItem>/2/Target@@Value\};prop::NumberToleranceRangeLowValue:\{lineItem>2/Target@@CriticalityCalculation/ToleranceRangeLowValue\};prop::NumberDeviationRangeLowValue:\{lineItem>2/Target@@CriticalityCalculation/DeviationRangeLowValue\}"/>
                                </template:else>
                            </template:if>
                        </template:then>
                        <template:else>
                            <Text
                                class="{= ${ovpCardProperties>/webkitSupport} ? 'sapTableDataRow' : 'sapTableDataRowIE' }"
                                text="{path: 'lineItem>', formatter: 'CardAnnotationhelper.formatThirdDataFieldValue'}"/>
                        </template:else>
                    </template:if>

                </cells>
            </ColumnListItem>
        </items>
    </template:with>
    </template:then>
        <template:else>
            <core:Fragment fragmentName="sap.ovp.cards.table.TableDashBoardLayout" type="XML"/>
        </template:else>
    </template:if>
</core:FragmentDefinition>