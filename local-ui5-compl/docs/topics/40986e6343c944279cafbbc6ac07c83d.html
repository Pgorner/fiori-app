<html><head></head><body><div id="d4h5-main-container" class="dk-main"><section id="loio40986e6343c944279cafbbc6ac07c83d" class=" section topic"><div class="section-mdeditlink hidden">
				<a class="mdeditlink hidden" href="https://github.com/SAP-docs/sapui5/blob/main/docs/04_Essentials/draft-handling-with-the-odata-v4-model-40986e6.md">Edit on GitHub</a>
			</div><div class="collapsible-icon sap-icon innerTitle"><h2 class="title ">Draft Handling with the OData V4 Model</h2></div><div class="fig"><div class="topictitle1 title"><h2 class="title ">Draft Handling with the OData V4 Model</h2></div><div class="shortdesc">A draft is an interim version of a business entity that has not yet been explicitly saved. Drafts are saved automatically in the
		background whenever users add or change information within a business entity.</div><p>The SAP Fiori Design Guidelines specify how <a href="https://experience.sap.com/fiori-design-web/draft-handling/" title="https://experience.sap.com/fiori-design-web/draft-handling/" class="sap-doc">Draft Handling</a> works, and platforms like CAP (<a href="https://cap.cloud.sap/docs/java/fiori-drafts" title="https://cap.cloud.sap/docs/java/fiori-drafts" class="sap-doc">capire - Fiori Drafts
				(cloud.sap)</a>) and RAP (<a href="https://help.sap.com/viewer/923180ddb98240829d935862025004d6/Cloud/en-US/a81081f76c904b878443bcdaf7a4eb10.html" title="https://help.sap.com/viewer/923180ddb98240829d935862025004d6/Cloud/en-US/a81081f76c904b878443bcdaf7a4eb10.html" class="sap-doc">Draft - SAP Help Portal</a>) support this. SAPUI5's OData V4 model offers some features to support draft handling as
			well.</p><p>Suppose your application shows a list report of draft-enabled entities and an object page with more details. To switch between an active and a
			draft version in the object page and have this switch immediately reflected in the list report as well, you should create the operation
			binding for the corresponding<cite> edit</cite> or <cite>activation</cite> action relative to a row context of the list report's binding.
			Use <code>$$inheritExpandSelect</code> and pass the <code>bReplaceWithRVC</code> flag to the operation binding's
				<code>invoke</code> method. This will result in a single POST request which invokes the action and returns the desired projection
				(<code>$expand, $select</code>) as needed for the object page. Also, it replaces the row context <cite>in situ</cite> with the
			sibling entity returned by the action. For more information, see <a href="api/sap.ui.model.odata.v4.ODataContextBinding#methods/invoke" title="api/sap.ui.model.odata.v4.ODataContextBinding#methods/invoke" class="sap-doc" alt="api/sap.ui.model.odata.v4.ODataContextBinding#methods/invoke"><code>sap.ui.model.odata.v4.ODataContextBinding#invoke</code></a>.</p><section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">onEdit : function () {
    var oObjectPage = this.byId("objectPage"),
        oActiveContext = oObjectPage.getBindingContext(),
        that = this;
 
    oActiveContext.getModel().bindContext("namespace.EditAction(...)",
        oActiveContext, {$$inheritExpandSelect : true})
        .invoke("$auto", false, null, /*bReplaceWithRVC*/true)
        .then(function (oDraftContext) {
            that.oActiveContext = oActiveContext; // remember for cancel
            oObjectPage.setBindingContext(oDraftContext);
        });
}</pre></div></div></section><p>To support an efficient cancellation of editing, you should remember the current context of the active entity and have it kept alive (see <a href="api/sap.ui.model.odata.v4.Context#methods/setKeepAlive" title="api/sap.ui.model.odata.v4.Context#methods/setKeepAlive" class="sap-doc" alt="api/sap.ui.model.odata.v4.Context#methods/setKeepAlive"><code>sap.ui.model.odata.v4.Context#setKeepAlive</code></a>). Then you can call <a href="api/sap.ui.model.odata.v4.Context#methods/replaceWith" title="api/sap.ui.model.odata.v4.Context#methods/replaceWith" class="sap-doc" alt="api/sap.ui.model.odata.v4.Context#methods/replaceWith"><code>sap.ui.model.odata.v4.Context#replaceWith</code></a> on the draft entity's context in order to replace the draft with the active entity
				<cite>in situ</cite>. Afterwards, you should delete the draft entity without requesting a new count from the server. If the active
			entity is not known (anymore), you can use the <code>"SiblingEntity"</code> navigation property to go from draft to active entity. For
			this, it can be invoked quite like a function, including usage of <code>$$inheritExpandSelect</code> and
				<code>bReplaceWithRVC</code>.</p><section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">onCancel : function () {
    var oObjectPage = this.byId("objectPage"),
        oDraftContext = oObjectPage.getBindingContext();
 
    function gotoActiveContext(oActiveContext) {
        oObjectPage.setBindingContext(oActiveContext);
        that.oActiveContext = null; // not needed anymore
        oDraftContext.delete("$auto", /*bDoNotRequestCount*/true);
    }
 
    if (this.oActiveContext) {
        oDraftContext.replaceWith(this.oActiveContext);
        gotoActiveContext(this.oActiveContext);
    } else {
        oDraftContext.getModel().bindContext("SiblingEntity(...)", oDraftContext,
                {$$inheritExpandSelect : true})
            .invoke("$auto", false, null, /*bReplaceWithRVC*/true).then(gotoActiveContext);
    }
}</pre></div></div></section><p>While editing the draft version in the object page, all changes are sent to the server immediately using a <code>SubmitMode.Auto</code>
			update group. For additional information on batch groups, see <a href="topic/74142a38e3d4467c8d6a70b28764048f" title="OData V4 allows you to group multiple operations into a single HTTP request payload, as described in the official OData V4 specification Part 1, Batch Requests (see the link under Related Information for more details)." class="sap-doc">Batch Control</a>. For changing requests
			submitted in <code>auto</code> groups the model will automatically wait for the previous batch request to return before sending the
			current batch request. This way it is ensured that the up-to-date <code>ETag</code> is used.</p><p>Before calling the <cite>activation</cite> action to finish the editing and take over the changed data from the draft to the active version it is
			important that all changes are persisted in the server. Call <a href="api/sap.ui.model.odata.v4.ODataModel#methods/submitBatch" title="api/sap.ui.model.odata.v4.ODataModel#methods/submitBatch" class="sap-doc" alt="api/sap.ui.model.odata.v4.ODataModel#methods/submitBatch"><code>sap.ui.model.odata.v4.ODataModel#submitBatch</code></a> with the update group
			id to ensure that all changes are persisted. Note that this will also close the changeset. In case the <cite>activation</cite> action
				is<code> invoke</code>d directly afterwards, it will be sent in the same batch request, but in a subsequent changeset. In the same
			way <code>ODataModel#submitBatch</code> can be used to perform the <cite>preparation</cite> action before the <cite>activation</cite>
			action, and put each in a separate changeset. After successful activation, you should delete the context for the draft instance, but
			without sending a DELETE request to the server: Pass <code>null</code> as a group ID to <a href="api/sap.ui.model.odata.v4.Context#methods/delete" title="api/sap.ui.model.odata.v4.Context#methods/delete" class="sap-doc" alt="api/sap.ui.model.odata.v4.Context#methods/delete"><code>sap.ui.model.odata.v4.Context#delete</code></a>.</p><p>Changes might cause side effects calculated in the server. These can either be loaded implicitly with the PATCH or POST response, or explicitly
			with <a href="api/sap.ui.model.odata.v4.Context#methods/requestSideEffects" title="api/sap.ui.model.odata.v4.Context#methods/requestSideEffects" class="sap-doc" alt="api/sap.ui.model.odata.v4.Context#methods/requestSideEffects"><code>sap.ui.model.odata.v4.Context#requestSideEffects</code></a> as described in <a href="topic/fccfb2eb41414f0792c165e69a878717.html#loiofccfb2eb41414f0792c165e69a878717/section_SE" title="fccfb2eb41414f0792c165e69a878717.xml#loiofccfb2eb41414f0792c165e69a878717/section_SE" class="sap-doc">Side Effects</a>. The latter is particularly useful if the side effects
			also affect other entities, for example if the change of the quantity of an item also causes the overall price at the header level to be
			updated. Implicit loading of side effects should be avoided by using the <code>$$patchWithoutSideEffects</code> binding parameter if
			explicit loading is used. The <code>return=minimal</code> preference is used if the <code>$$patchWithoutSideEffects</code> binding
			parameter is set. For more information, see <a href="api/sap.ui.model.odata.v4.ODataModel#methods/bindContext" title="api/sap.ui.model.odata.v4.ODataModel#methods/bindContext" class="sap-doc" alt="api/sap.ui.model.odata.v4.ODataModel#methods/bindContext"><code>sap.ui.model.odata.v4.ODataModel#bindContext</code></a> and <a href="api/sap.ui.model.odata.v4.ODataModel#methods/bindList" title="api/sap.ui.model.odata.v4.ODataModel#methods/bindList" class="sap-doc" alt="api/sap.ui.model.odata.v4.ODataModel#methods/bindList"><code>sap.ui.model.odata.v4.ODataModel#bindList</code></a>.</p><p>For informing the user about the implicit saving, for example with an <a href="api/sap.m.DraftIndicator" title="api/sap.m.DraftIndicator" class="sap-doc" alt="api/sap.m.DraftIndicator"><code>sap.m.DraftIndicator</code></a>, the following events may be used:</p><ul class="ul ">
				<li class="li"><code>patchSent</code> and <code>patchCompleted</code> of <a href="api/sap.ui.model.odata.v4.ODataContextBinding" title="api/sap.ui.model.odata.v4.ODataContextBinding" class="sap-doc" alt="api/sap.ui.model.odata.v4.ODataContextBinding"><code>sap.ui.model.odata.v4.ODataContextBinding</code></a> and <a href="api/sap.ui.model.odata.v4.ODataListBinding" title="api/sap.ui.model.odata.v4.ODataListBinding" class="sap-doc" alt="api/sap.ui.model.odata.v4.ODataListBinding"><code>sap.ui.model.odata.v4.ODataListBinding</code></a>,</li>
				<li class="li"><code>createSent</code> and <code>createCompleted</code> of <a href="api/sap.ui.model.odata.v4.ODataListBinding" title="api/sap.ui.model.odata.v4.ODataListBinding" class="sap-doc" alt="api/sap.ui.model.odata.v4.ODataListBinding"><code>sap.ui.model.odata.v4.ODataListBinding</code></a>.</li>
			</ul><p></p><section class="contentInSection hidden"><h2>In this section:</h2></section><section class="familyLinks"><div class="parentLink hidden"><br><strong>Parent topic: </strong></div><div class="previousLink hidden"><br><strong>Previous: </strong></div><div class="nextLink hidden"><br><strong>Next: </strong></div></section><section class="hidden relatedLinks "><div class="collapsible-icon sap-icon title"><h2>Related information</h2></div><ul class="fig"></ul></section></div></section></div></body></html>