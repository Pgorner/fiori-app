<html><head></head><body><div id="d4h5-main-container" class="dk-main"><section id="loio0ddcc60b05ee40dea1a3be09e8fee8f7" class=" section topic"><div class="section-mdeditlink hidden">
				<a class="mdeditlink hidden" href="https://github.com/SAP-docs/sapui5/blob/main/docs/04_Essentials/cookbook-for-testing-controls-with-qunit-0ddcc60.md">Edit on GitHub</a>
			</div><div class="collapsible-icon sap-icon innerTitle"><h2 class="title ">Cookbook for Testing Controls with QUnit</h2></div><div class="fig"><div class="topictitle1 title"><h2 class="title ">Cookbook for Testing Controls with QUnit</h2></div><section>
            <h2 class="title ">Test Cases</h2>
            <p>You can use a factory function. To keep this pointer and have a descriptive message,
                you should use the test inside of the function and pass a test name to it.</p>
            <p>Internally, we prefer to pass an object to the test for retrieving the values - it
                makes the test cases readable.</p>
            <section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// "Bar" required from module "sap/m/Bar"
// "nextUIUpdate" required from module "sap/ui/test/utils/nextUIUpdate"
function renderBarInPageTestCase(sTestName, oOptions) {
    QUnit.test(sTestName, async(assert) =&gt; { 
        // System under Test
        const oBar = new Bar();

        oBar.placeAt("qunit-fixture");

        // Act
        oBar.applyTagAndContextClassFor(oOptions.context);

        await nextUIUpdate();

        // Assert
       assert.strictEqual(oBar.getDomRef().nodeName, oOptions.expectedTag.toUpperCase());
       assert.ok(oBar.$().hasClass(oOptions.expectedClass), "The bar has the context class: " + oOptions.expectedClass);

        // Cleanup
        oBar.destroy();
    });
};

renderBarInPageTestCase("Should render the header context", {
    context : "header",
    expectedTag : "header",
    expectedClass : "sapMHeader-CTX"
});

renderBarInPageTestCase("Should render the header context", {
    context : "subheader",
    expectedTag : "header",
    expectedClass : "sapMSubHeader-CTX"
});

renderBarInPageTestCase("Should render the header context", {
    context : "footer",
    expectedTag : "footer",
    expectedClass : "sapMFooter-CTX"
});</pre></div></div></section>
        </section><section>
            <h2 class="title ">Testing User Interactions</h2>
            <p>When testing user interactions, you can use <code>sap.ui.test.qunit</code> to
                trigger events.</p>
            <p>Here is an example for when a user presses <span class="keyWrap"><kbd class="key">Esc</kbd></span> on the select:</p>
            <section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// "Item" required from module "sap/ui/core/Item"
// "Select" required from module "sap/m/Select"
// "KeyCodes" required from module "sap/ui/events/KeyCodes"
// "nextUIUpdate" required from module "sap/ui/test/utils/nextUIUpdate"
// "QUnitUtils" required from module "sap/ui/qunit/QUnitUtils"
QUnit.test("Should close the popup menu if it is open and you press escape", async(assert) =&gt; {
    // Arrange
    const oConstructor = {
        items: [
        new Item({
            key: "0",
            text: "item 0"
        }),

        new Item({
            key: "1",
            text: "item 1"
        })
       ]
    };

    // System under test
    const oSelect = new Select(oConstructor);

    oSelect.placeAt("select-content");
    await nextUIUpdate();

    // Arrange after rendering
    oSelect.focus();
    const fnEscapeSpy = this.spy(oSelect, "onsapescape");
    const fnCloseSpy = this.spy(oSelect, "close");

    // Act
    QUnitUtils.triggerKeydown(oSelect.getDomRef(), KeyCodes.ESCAPE);

    // Assertion
    assert.strictEqual(fnEscapeSpy.callCount, 1, "onsapescape() method was called exactly once");
    assert.strictEqual(fnCloseSpy.callCount, 0, "close() method is not called");

    // Cleanup
    oSelect.destroy();
});</pre></div></div></section>
        </section><section id="section_REREN">
            <h2 class="title ">Rendering and Re-rendering Controls within Tests</h2>
            <p>In the rendering tests part, you have to place your control in the DOM. The best place to put it is the <code>qunit-fixture</code>
                div, since its content gets deleted after every test.</p>
            <p>Make sure you destroy your control, since SAPUI5 will keep a reference to
                it and may also rerender it.</p>
            <p>It's crucial that you wait for the Promise of <code>sap/ui/test/utils/nextUIUpdate</code> after each time you've caused a
                rerendering.</p>
            <p>Executing the module returns a Promise which resolves after rendering. If you don't wait for the Promise, the DOM won't be updated
                yet.</p>
            <p>You can use the following template to make sure that you remember to destroy your control:</p>
            <section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// "nextUIUpdate" required from module "sap/ui/test/utils/nextUIUpdate"
QUnit.test("Should do Something", async(assert) =&gt; {
    // Arrange
    const oConstructor = {

    };

    // System under Test
    const oMyControl = new nameSpace.myControl(oConstructor);
    oMyControl.placeAt("qunit-fixture");

    // Wait for the rendering before proceeding the test
    await nextUIUpdate();

    // Act

    // Assert

    // Cleanup
    oMyControl.destroy();
});</pre></div></div></section>
            <div class="note caution  "><div class="collapsible-icon sap-icon"><div class="title"><strong>
					Caution
				</strong></div></div><div class="fig"><p>
                </p><p>Using <code>nextUIUpdate</code> in combination with fake timers has some pitfalls. If fake timers are used, you need to pass
                    the <code>clock</code> of the fake timer to the <code>nextUIUpdate</code> function call.</p>
                <p>When working with a fake timer, keep in mind to either execute all timeouts before restoring the fake timer or to make sure that no
                    rendering is pending. Not executing the pending timeouts can lead to issues within the following tests, for example by interupting
                    the rendering lifecycle.</p>
            <p></p></div></div>
            <p>Example usage of <code>nextUIUpdate</code> in combination with a fake timer:</p>
            <section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// nextUIUpdate with fake timer
QUnit.test("Test with fake timers", async() =&gt; {
    this.clock = sinon.useFakeTimers();

    // Coding which requires rendering, e.g.
    const oButton = new Button();
    oButton.placeAt("qunit-fixture");

    await nextUIUpdate(this.clock);

    // Continue with your test

    // Release all timers at the end of the test
    // to avoid e.g. blocking the rendering within
    // following tests and to ensure that other
    // timeouts triggered through integration are
    // released
    oButton.destroy()
    this.clock.runAll();
    this.clock.restore();
}</pre></div></div></section>
            <p>In the example below, you will test to see whether the control fails to rerender. The control has overwritten the setter of the tooltip
                property to avoid triggering a re-rendering.</p>
            <p>To test this, we add an <code>eventDelegate</code> to see how often the rendering function is called. We need to make sure that we
                wait for the next rendering:</p>
            <section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// "Label" required from module "sap/m/Label"
// "nextUIUpdate" required from module "sap/ui/test/utils/nextUIUpdate"
QUnit.test("Should suppress rerendering when tooltip is set", async(assert) =&gt; { 
    // Arrange
    const oConstructor = {
        tooltip : "foo"
        };
    const oRerenderingSpy = this.spy();

    // System under Test
    const oLabel = new Label(oConstructor);
    oLabel.placeAt("qunit-fixture");

    // wait for rendering
    await nextUIUpdate();

    oLabel.addEventDelegate({
        onBeforeRendering : oRerenderingSpy
    });

    // Act
    oLabel.setTooltip("bar");

   // wait for rendering
    await nextUIUpdate();

    // Assert
    assert.strictEqual(oRerenderingSpy.callCount, 0, "Did not rerender");
    assert.strictEqual(oLabel.getTooltip(), "bar", "Tooltip property got set");
    assert.strictEqual(oLabel.$().attr("title"), "bar", "Tooltip got updated");

    // Cleanup
    oLabel.destroy();
});</pre></div></div></section>
        </section><section>
			<h2 class="title ">Testing with Server-Side Models</h2>
			<p>For bindable properties of your control, it should be possible to bind them to server-side models, i.e. models for which not all data is
                available on the client but is loaded asynchronously from a server. This is especially important for more complex controls, e.g. with
                an aggregation which may be bound to a collection loaded using paging. A typical example for server-side models are UI5's OData
                models. When testing with models, you need to make sure that you also set up/destroy the model itself inside your test. In the
                following, we will show an example using the OData V2 mock server:</p>
			<section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// "MockServer" required from module "sap/ui/core/util/MockServer"

function startMockServer(iRespondAfter) {
    // configure respond to requests delay
    MockServer.config({
        autoRespond : true,
        autoRespondAfter : iRespondAfter || 10
    });

    // create mockserver
    const oMockServer = new MockServer({
        rootUri : "http://sap.com/service/"
    });

    // start and return
    oMockServer.simulate("data/metadata.xml", "data");
    oMockServer.start();
    return oMockServer;
}

//Your test:
QUnit.test("Should do something with the model", function (assert) {
    //Arrange
    const oMockServer = startMockServer(0);
    
    // System under Test + Act

    //Cleanup
    oMockServer.stop();
});</pre></div></div></section>
			<p>When using the OData V2 mock server, you can use async tests since calling respond each time on the mock server does not help the
				readability of the test.</p>
			<p>After setting up the OData V2 mock server, we set up the model as follows:</p>
			<section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// "ODataModel" required from module "sap/ui/model/odata/v2/ODataModel"
// "jQuery" required from module "sap/ui/thirdparty/jquery"

function createODataModel(sURL, mSettings) {
    sURL = sURL || "http://sap.com/service/";
    const oModel = new ODataModel(sURL);
    
    mSettings = mSettings || {};
    jQuery.each(mSettings, function(sProperty, vValue) {
        sProperty = sProperty[0].toUpperCase() + sProperty.substring(1);
        oModel["set" + sProperty](vValue);
    });
    
    return oModel;
}

//Your test:
QUnit.test("Should do something with the model", function(assert) {
    // Arrange
    const oModel = createODataModel();
    const oMockServer = startMockServer(0);
    const done = assert.async();

    // System under Test + Act + call done();

    // Cleanup
    oModel.destroy();
    oMockServer.stop();
});</pre></div></div></section>
			<p>You can now bind your model against your control and test whatever you want.</p>
			<p>We use <code>clock.tick</code> to trigger the server response. If you didn't do this, the text of the label would still be
				empty:</p>
			<section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// "Label" required from module "sap/m/Label"
// "nextUIUpdate" required from module "sap/ui/test/utils/nextUIUpdate"

//Your test:
QUnit.test("Should do something with the model", async(assert) =&gt; {
    // Arrange
    const oModel = createODataModel();
    const oMockServer = startMockServer(50);

    // System under Test
    const oLabel = new Label({
        text : "{/myProperty}"
    });

    oLabel.placeAt("qunit-fixture");
    await nextUIUpdate();

    // Act - trigger the request
    sinon.clock.tick(50);

    // Assert
    assert.strictEqual("myExpected", oLabel.getText(), "The expected text was present");

    // Cleanup
    oModel.destroy();
    oMockServer.stop();
    sinon.clock.reset() 
});</pre></div></div></section>
		</section><section id="section_ljv_b3r_rzb">
            <h2 class="title ">Testing for a Theme Change</h2>
            <p>
                </p><section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">sap.ui.require(["sap/ui/core/Theming"], (Theming) =&gt; {
    QUnit.test("Check if theme change was done correctly", function(assert){
        const myTestFunction = () =&gt; {
            // Test changes are applied
            Theming.detachApplied(myTestFunction);
        }
        Theming.setTheme("myTestTheme");
        Theming.attachApplied(myTestFunction);
    });
});</pre></div></div></section>
            <p></p>
        </section><section class="contentInSection hidden"><h2>In this section:</h2></section><section class="familyLinks"><div class="parentLink hidden"><br><strong>Parent topic: </strong></div><div class="previousLink hidden"><br><strong>Previous: </strong></div><div class="nextLink hidden"><br><strong>Next: </strong></div></section><section class="hidden relatedLinks "><div class="collapsible-icon sap-icon title"><h2>Related information</h2></div><ul class="fig"></ul></section></div></section></div></body></html>