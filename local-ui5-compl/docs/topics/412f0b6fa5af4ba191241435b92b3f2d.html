<html><head></head><body><div id="d4h5-main-container" class="dk-main"><section id="loio412f0b6fa5af4ba191241435b92b3f2d" class=" section topic"><div class="section-mdeditlink hidden">
				<a class="mdeditlink hidden" href="https://github.com/SAP-docs/sapui5/blob/main/docs/03_Get-Started/step-28-integration-test-with-opa-typescript-412f0b6.md">Edit on GitHub</a>
			</div><div class="collapsible-icon sap-icon innerTitle"><h2 class="title ">Step 28: Integration Test with OPA (TypeScript)</h2></div><div class="fig"><div class="topictitle1 title"><h2 class="title ">Step 28: Integration Test with OPA (TypeScript)</h2></div><div class="shortdesc">If we want to test interaction patterns or more visual features of our app, we can
		also write an integration test. </div><p>We haven't thought about testing our interaction with the app yet, so in this step we
			will check if the dialog actually opens when we click the "Say Hello with Dialog"
			button. We can easily do this with OPA5, a feature of SAPUI5 that is easy to set
			up and is based on JavaScript and QUnit. Using integration and unit tests and running
			them consistently in a continuous integration (CI) environment, we can make sure that we
			don't accidentally break our app or introduce logical errors in existing code.</p><div class="note   "><div class="collapsible-icon sap-icon"><div class="title"><strong>
					Note
				</strong></div></div><div class="fig"><p>In this tutorial, we focus on a simple use case for the test implementation. If you
			want to learn more about OPA tests, have a look at our <a href="topic/291c9121e6044ab381e0b51716f97f52" title="In this tutorial we will test application functionality with the testing tools that are delivered with SAPUI5. At different steps of this tutorial you will write tests using QUnit, OPA5, and the OData V2 mock server. Additionally, you will learn about testing strategies, Test Driven Development (TDD), and much more." class="sap-doc">Testing Tutorial</a> tutorial, especially <a href="topic/1b47457cbe4941ee926317d827517acb" title="A bulletin board may contain many posts. We expect to have a high data load once it is officially released. Then, there might be performance issues and long loading times if we display all entries at the same time. Therefore we will introduce a feature that limits the initial display to 20 items. The user can then click on a more button to view more items. As with the unit test, we start by writing an integration test for this feature and then add the application functionality later." class="sap-doc">Step 6: A First OPA Test</a>.</p></div></div><section>
			<h2 class="title ">Preview</h2>
			<div><div class="fig"><img src="loio250d5b92921d44a4b432cc0fade88cc9_LowRes.png" title="The graphic has an explanatory text." alt="The graphic has an explanatory text." usemap="#"></div><span class="collapsible-icon sap-icon figcap title"><h2 class="title ">An OPA test opens the "Hello" dialog from step 16</h2></span></div>
		</section><section>
			<h2 class="title ">Coding</h2>
			<p>You can view all files at <a href="https://github.com/sap-samples/ui5-typescript-walkthrough/tree/main/steps/28" title="https://github.com/sap-samples/ui5-typescript-walkthrough/tree/main/steps/28" class="external-link" target="_blank" rel="noopener">OpenUI5 TypeScript Walkthrough - Step 28: Integration Test with OPA</a> and <a href="https://sap-samples.github.io/ui5-typescript-walkthrough/ui5-typescript-walkthrough-step-28.zip" title="https://sap-samples.github.io/ui5-typescript-walkthrough/ui5-typescript-walkthrough-step-28.zip" class="external-link" target="_blank" rel="noopener">download the solution as a zip file</a>.</p>
			<p>
				</p><div><div class="fig"><img src="loio27e84d5bd72a485498564b92894869b5_LowRes.png" title="The graphic has an explanatory text" alt="The graphic has an explanatory text" usemap="#"></div><span class="collapsible-icon sap-icon figcap title"><h2 class="title ">Folder Structure for this Step</h2></span></div>
			<p></p>
			<p>We add a new folder <code>integration</code> below the <code>test</code> folder, where we put our new test cases. Page objects that help
				structuring such integration tests are put in the <code>pages</code> subfolder that we also create now.</p>
		</section><section id="section_lbk_2l1_4zb">
			<h2 class="title ">webapp/test/integration/pages/HelloPanelPage.ts (New)</h2>
			<p>We create a new <code>HelloPanelPage.ts</code> file under <code>webapp/test/integration/pages</code> where the OPA test for the
				main page is implemented. We define here the OPA test for our <code>HelloPanel</code> view.</p>
			<p>A "page object" is a structuring element of OPA that encapsulates actions and assertions needed to describe the journey, which we'll
				come to in the next step. Typically, these are related to a view in the app, but there can also be stand-alone pages for browsers or
				common functionality. This page object relates to the <code>HelloPanel</code> view.</p>
			<p>The implementation of the page object holds the helper functions we will need in our <code>journey</code>. We import the
					<code>sap.ui.test.OPA5</code> library and define a page object out of it.</p>
			<p> In the actions section of the page object we define a function to click the "Hello" dialog button. This is done in OPA5 with a
					<code>waitFor</code> statement, it is basically a loop that checks for the conditions defined as parameters. If the conditions
				are met, the success callback is executed; if the test fails because the conditions have not been met, the text in the
					<code>errorMessage</code> property is displayed on the result page.</p>
			<p>In the assertions section we define a <code>waitFor</code> statement that checks if a <code>sap.m.Dialog</code> control is
				existing in the DOM of the app. When the dialog has been found, the test is successful and we can immediately confirm by calling an
					<code>ok</code> statement with a meaningful message.</p>
			<section class="lang-ts"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock"><span class="emphasis">import Opa5 from "sap/ui/test/Opa5";
import Press from "sap/ui/test/actions/Press";

const viewName = "ui5.walkthrough.view.HelloPanel";

export default class HelloPanelPage extends Opa5 {
	// Actions
	iPressTheSayHelloWithDialogButton() {
		return this.waitFor({
			id: "helloDialogButton",
			viewName,
			actions: new Press(),
			errorMessage: "Did not find the 'Say Hello With Dialog' button on the HelloPanel view"
		});
	}
	
	// Assertions
	iShouldSeeTheHelloDialog() {
		return this.waitFor({
			controlType: "sap.m.Dialog",
			success: function () {
				// we set the view busy, so we need to query the parent of the app
				Opa5.assert.ok(true, "The dialog is open");
			},
			errorMessage: "Did not find the dialog control"
		});
	}
};</span></pre></div></div></section>
		</section><section>
			<h2 class="title ">webapp/test/integration/NavigationJourney.ts (New)</h2>
			<p>We create a new <code>NavigationJourney.ts</code> file under <code>webapp/test/integration/</code>.</p>
			<p>A <code>journey</code> is another structuring element of OPA. It consists of a series of integration tests that belong to the same
				context, such as navigating through the app. Similar to the QUnit test implementation, OPA5 uses QUnit; that's why we first set up a
				QUnit module <code>Navigation</code> that will be displayed on our result page.</p>
			<p> The function <code>opaTest</code> is the main aspect for defining integration tests with OPA. Its parameters define a test name
				and a callback function that gets executed with the following OPA5 helper objects to write meaningful tests that read like a user
					story.</p><ul class="ul ">
					<li class="li">
						<p><code>Given</code></p>
						<p>On the given object we can call arrangement functions like <code>iStartMyUIComponent</code> to load our app component
							for integration testing.</p>
					</li>
					<li class="li">
						<p><code>When</code></p>
						<p>Contains custom actions that we can execute to get the application in a state where we can test the expected behavior.</p>
					</li>
					<li class="li">
						<p><code>Then</code></p>
						<p>Contains custom assertions that check a specific constellation in the application and the teardown function that removes
							our component again.</p>
					</li>
				</ul><p></p>
			<p>In our journey, we create a very simple test that starts the <code>MainPage</code> and loads our app. Then, we carry out the actions we
				defined in our <code>MainPage</code> and expect that they will be executed successfully. Finally, we shut down the page again by
				calling the function <code>iTeardownMyApp</code> on the <code>MainPage</code>.</p>
			<section class="lang-ts"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock"><span class="emphasis">import opaTest from "sap/ui/test/opaQunit";
import HelloPanelPage from "./pages/HelloPanelPage";

const onTheHelloPanelPage = new HelloPanelPage();

QUnit.module("Navigation");

opaTest("Should open the Hello dialog", function () {

	// Arrangements
	onTheHelloPanelPage.iStartMyUIComponent({
		componentConfig: {
			name: "ui5.walkthrough"
		}
	});
	
	// Actions
	onTheHelloPanelPage.iPressTheSayHelloWithDialogButton();
	
	// Assertions
	onTheHelloPanelPage.iShouldSeeTheHelloDialog();
	
	// Cleanup
	onTheHelloPanelPage.iTeardownMyApp();
});</span></pre></div></div></section>
			<p>As you can see, the test case reads like a user story; we actually do not need the implementation of the methods yet to understand the meaning
				of the test case. This approach is called "Behavior Driven Development" or simply BDD and is popular in "Agile Software
				Development".</p>
		</section><section id="section_trf_xpc_yfb">
			<h2 class="title ">webapp/test/integration/opaTests.qunit.ts (New)</h2>
			<p>We create a new <code>opaTests.qunit.ts</code> file under
					<code>webapp/test/integration/</code>. This module imports our
					<code>NavigationJourney</code> and is the entrypoint for all integration
				tests in the project.</p>
			<section class="lang-ts"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock"><span class="emphasis">import "./NavigationJourney";</span></pre></div></div></section>
		</section><section id="section_srf_xpc_yfb">
			<h2 class="title ">webapp/test/testsuite.qunit.ts</h2>
			<p>Finally we reference the new <code>integration/opaTests.qunit.ts</code> in
				the <code>testsuite.qunit.ts</code> file. The <code>.qunit.ts</code>
				extension is omitted and will be added automatically during runtime.</p>
			<section class="lang-ts"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock"><span class="emphasis">export default {
       // ...
	  tests: {
		    "unit/unitTests": {
			       title: "UI5 TypeScript Walkthrough - Unit Tests"
		    },
		    "integration/opaTests": {
			       title: "UI5 TypeScript Walkthrough - Integration Tests"
		    }
	  }
};</span></pre></div></div></section>
			<p>If we now open the <code>webapp/test/testsuite.qunit.html</code> file in the
				browser and select <code>integration/opaTests</code>, the QUnit layout
				should appear and a test "Should see the Hello dialog" will run immediately. This
				action will load the app component on the right side of the page. There you can see
				the operations the test is performing on the app. If everything works correctly, a
				button click will be triggered, then a dialog will be displayed and the test case
				will be green.</p>
		</section><section>
			<h2 class="title "> Conventions</h2>
			<ul class="ul ">
				<li class="li">
					<p>OPA tests are located in the <code>webapp/test/integration</code> folder
						of the application.</p>
				</li>
				<li class="li">
					<p>Use <code>page</code> objects and <code>journeys</code> for
						structuring OPA tests.</p>
				</li>
			</ul>
		</section><section class="contentInSection hidden"><h2>In this section:</h2></section><section class="familyLinks"><div class="parentLink"><br><strong>Parent topic: </strong><a href="topic/dad1905a07f849ce9c509721317d38d8">Walkthrough Tutorial (TypeScript)</a></div><div class="previousLink"><br><strong>Previous: </strong><a href="topic/750c8c1e2ec1479ea58a4aaf9ee2ab82">Step 27: Unit Test with QUnit (TypeScript)</a></div><div class="nextLink"><br><strong>Next: </strong><a href="topic/50990a077f964958a6e5cef1002e5316">Step 29: Debugging Tools (TypeScript)</a></div></section><section class="relatedLinks "><div class="collapsible-icon sap-icon title"><h2>Related information</h2></div><ul class="fig">
		<li><a href="topic/2696ab50faad458f9b4027ec2f9b884d" title="OPA5 is an API for SAPUI5 controls. It hides asynchronicity and eases access to SAPUI5 elements. This makes OPA especially helpful for testing user interactions, integration with SAPUI5, navigation, and data binding." class="sap-doc">Integration Testing with One Page Acceptance Tests (OPA5)</a></li>
		<li><a href="api/sap.ui.test.Opa5" title="api/sap.ui.test.Opa5" class="sap-doc" alt="api/sap.ui.test.Opa5">API Reference: sap.ui.test.Opa5</a></li>
		<li><a href="entity/sap.ui.test.Opa5" title="entity/sap.ui.test.Opa5" class="sap-doc" alt="entity/sap.ui.test.Opa5">Samples: sap.ui.test.Opa5
			</a></li>
		<li><a href="api/sap.ui.test.actions" title="api/sap.ui.test.actions" class="sap-doc" alt="api/sap.ui.test.actions">API Reference: sap.ui.test.actions</a></li>
		<li><a href="https://qunitjs.com" title="https://qunitjs.com" class="sap-doc">QUnit Home Page</a></li>
		<li><a href="topic/291c9121e6044ab381e0b51716f97f52" title="In this tutorial we will test application functionality with the testing tools that are delivered with SAPUI5. At different steps of this tutorial you will write tests using QUnit, OPA5, and the OData V2 mock server. Additionally, you will learn about testing strategies, Test Driven Development (TDD), and much more." class="sap-doc">Testing Tutorial</a></li>
	</ul></section></div></section></div></body></html>