<html><head></head><body><div id="d4h5-main-container" class="dk-main"><section id="loiof28025135e0e4527bdfb7c5441647391" class=" section topic"><div class="section-mdeditlink hidden">
				<a class="mdeditlink hidden" href="https://github.com/SAP-docs/sapui5/blob/main/docs/10_More_About_Controls/enablement-of-personalization-with-variant-management-f280251.md">Edit on GitHub</a>
			</div><div class="collapsible-icon sap-icon innerTitle"><h2 class="title ">Enablement of Personalization (With Variant
		Management)</h2></div><div class="fig"><div class="topictitle1 title"><h2 class="title ">Enablement of Personalization (With Variant
		Management)</h2></div><div class="shortdesc">The simple concept of
		personalization
		allows the user to personalize a
		control
		and to persist these settings using a <code>VariantManagement</code>
		control.</div><p></p><div class="note   "><div class="collapsible-icon sap-icon"><div class="title"><strong>
					Note
				</strong></div></div><div class="fig"><p>The code samples in this section reflect examples of possible use
				cases and might not always be suitable for your purposes. Therefore, we recommend
				that you do not copy and use them directly.</p></div></div><p>For more information
				about this control, see the <a href="api/sap.m.p13n.Engine" title="api/sap.m.p13n.Engine" class="sap-doc" alt="api/sap.m.p13n.Engine">API Reference</a> and the
				<a href="entity/sap.m.p13n.Engine" title="entity/sap.m.p13n.Engine" class="sap-doc" alt="entity/sap.m.p13n.Engine">sample</a>.</p><p>Personalization currently supports, for
			example,
			defining the order of columns in a table and their visibility, sorting, and grouping. To
			enable this, the
			personalization
			engine can be used. </p><section id="section_lfb_bsm_xwb">
			<h2 class="title ">Using the Engine</h2>
			<p>To use the personalization, the following artifacts are required:</p>
			<ul class="ul ">
				<li class="li">
					<p><code>sap.m.p13n.Engine</code></p>
					<p>Personalization engine that enables the personalization.</p>
				</li>
				<li class="li">
					<p><code>sap.m.p13n.SelectionController</code></p>
					<p>Creates personalization content that is relevant for selection and
						visibility. This controller initializes
							<code>sap.m.p13n.SelectionPanel</code>.</p>
				</li>
				<li class="li">
					<p><code>sap.m.p13n.SortController</code></p>
					<p>Creates personalization content that is relevant for sorting. This controller
						initializes <code>sap.m.p13n.SortPanel</code>.</p>
				</li>
				<li class="li">
					<p><code>sap.m.p13n.GroupController</code></p>
					<p>Creates personalization content that is relevant for grouping. This
						controller initializes <code>sap.m.p13n.GroupPanel</code>.</p>
				</li>
				<li class="li">
					<p><code>sap.m.p13n.MetadataHelper</code></p>
					<p>Provides service-related data for the personalization engine, for example, to
						display columns that do currently not exist in a table. </p>
				</li>
				<li class="li">
					<p><code>sap.ui.fl.variants.VariantManagement</code></p>
					<p>Provides a UI to manage the view settings.</p>
				</li>
			</ul>
		</section><section id="section_prf_hsm_xwb">
			<h2 class="title ">Registering a Control in the Engine</h2>
			<p>When enabling a control for personalization, you need to register the control once using the
					<code>sap.m.p13n.Engine#register</code> method.
					<code>sap.m.p13n.MetadataHelper</code> is required to provide
				metadata-relevant information for the personalization engine. It needs to be
				initialized with an array of objects that have to provide the following
				information:</p>
			<div class="tableWrapper "><div class="fig"><table border="1" id="table_x3k_c4v_1xb" class=" ">
					
					
					
					<thead>
						<tr>
							<th colspan="1" rowspan="1">Property</th>
							<th colspan="1" rowspan="1">Type</th>
							<th colspan="1" rowspan="1">Description</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>key</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>string</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p>The key associated to the item. The recommendation is to provide the ID of the related
									item to create an association between the metadata and the
									aggregation.</p>
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>label</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>string</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p>The text that is displayed in the personalization dialog.</p>
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>path</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>string</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p>The model path to create filters, groupings, and sorters.</p>
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>visible</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>boolean</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p>Default value is <code>true</code>. Hides an item from
										<code>SelectionPanel</code> in the personalization if
									set to <code>false</code>.</p>
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>sortable</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>boolean</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p>Default value is <code>true</code>. Hides an item from
										<code>SortPanel</code> in the personalization if set to
										<code>false</code>.</p>
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>groupable</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>boolean</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p>Default value is <code>true</code>. Hides an item from
										<code>GroupPanel</code> in the personalization if set to
										<code>false</code>.</p>
							</td>
						</tr>
					</tbody>
				</table></div></div>
			<div class="note   "><div class="collapsible-icon sap-icon"><div class="title"><strong>
					Note
				</strong></div></div><div class="fig"><p>
				</p><p>Since the engine is a singleton, make sure you access it using the
						<code>getInstance()</code> method.</p>
			<p></p></div></div>
			<section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">/* 
*  The MetadataHelper provides the metadata information for the control.
*  each object in the array represents one item associated to an item in the controls
*  aggregation. Looking at a table in this example, each entry represents one column.
*  This information will be necessary to display all the columns and provide metadata specific information
*  for the personalization Engine.
*
*  The key will be used for persistence. The convention is to give the according control (for example the column here)
*  the same id the key provided so the Engine can create a connection between the column and metadata item.
*/
this.oMetadataHelper = new MetadataHelper([
    {key: "firstName", label: "First Name", path: "firstName"},
    {key: "lastName", label: "Last Name", path: "lastName"},
    {key: "city", label: "City", path: "city"},
    {key: "size", label: "Size", path: "size"}
]);

/* 
*  The registration is a one time process that enables the given control instane for personalization.
*  The registration process requires a helper for metadata related information.
*  The controller setting is a map of arbitrary keys with the accoridng controller as value. Whenever
*  the Engine will be accessed, these controller keys need to be provided as per wording in the registration process.
*/
Engine.getInstance().register(oTable, {
    helper: this.oMetadataHelper,
    controller: {
        //The SelectionController requires a targetAggregation to be personalized.
        //Each controller also requires the according control instance to where the settings should be persisted to.
        Columns: new SelectionController({
            targetAggregation: "columns",
            control: oTable
        }),
        Sorter: new SortController({
            control: oTable
        }),
        Groups: new GroupController({
            control: oTable
        })
    }
});</pre></div></div></section>
		</section><section id="section_h42_r54_ywb">
			<h2 class="title ">Displaying a Personalization Popup</h2>
			<p>The personalization engine provides basic tools and functions to initialize and display a
					<code>sap.m.p13n.Popup</code> with the related panels for each registered
				controller.</p>
			<p>Once the registration process has been completed, the registered control instance can
				make use of the <code>sap.m.p13n.Engine#show</code> method. This method is easy
				to use and provides the complete process of initializing, opening, and creating the
				necessary delta output information for the developer.</p>
			<p>The method can be used in the following way: </p>
			<section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">// The control instance and an array of the desired keys to display for personalization needs to be provided. Optionally a map of settings
// such as the contentHeight and contentWidth can be provided to customize the defaults of the personalization dialog.
Engine.getInstance().show(oTable, ["Columns", "Sorter", "Groups"], {
    contentHeight: "35rem",
    contentWidth: "32rem"
});</pre></div></div></section>
		</section><section id="section_g15_cv4_ywb">
			<h2 class="title ">Handling of State Changes</h2>
			<p>Whenever a personalization state changes (most likely when the user creates changes in the
				personalization popup provided by <code>sap.m.p13n.Engine#show</code>), an event
				is triggered by the engine. This event can then be used to create
				application-specific implementations by registering via
					<code>sap.m.p13n.Engine#attachStateChange</code>. This event will provide an
				object of the state after the user created personalization changes. An exampe
				implementation for a table might look as follows:</p>
			<section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">//Registration of the event handler
Engine.getInstance().attachStateChange(function(){

    //The new control state after the personalization
    var oState = oEvt.getParameter("state");

    //--&gt; The following lines are meant to process the personalization state by toggling the table columns and recreating the binding and template.
	// this is just a demo implementation. The sorters and groupings can be created in a similar approach, also see the more detailed exmaple linked below.

    oTable.getColumns().forEach(function(oColumn, iIndex){
        oColumn.setVisible(false);
    });

    oState.Columns.forEach(function(oProp, iIndex){
        var oCol = this.byId(oProp.key);
        oCol.setVisible(true);

        oTable.removeColumn(oCol);
        oTable.insertColumn(oCol, iIndex);
    }.bind(this));

    var aCells = oState.Columns.map(function(oColumnState) {
        return new Text({
            text: "{" + oColumnState.key + "}"
        });
    });

    oTable.bindItems({
        templateShareable: false,
        path: '/items',
        sorter: aSorter,
        template: new ColumnListItem({
            cells: aCells
        })
    });
});</pre></div></div></section>
		</section><section id="section_lkw_wrp_ywb">
			<h2 class="title ">Programmatically Applying States</h2>
			<p>The personalization engine also provides capabilities to programmatically apply
				personalization. For example, if there are other personalization functions outside
				the control, such as a custom button for making a sort function available.</p>
			<p>In this case, the <code>sap.m.p13n.Engine#retrieveState</code> and
					<code>sap.m.p13n.Engine#applyState</code> methods can be used to modify and
				persist personalization changes without a personalization UI.</p>
			<div class="note   "><div class="collapsible-icon sap-icon"><div class="title"><strong>
					Note
				</strong></div></div><div class="fig"><p>
				</p><p>These changes are then also part of the currently selected variant.</p>
			<p></p></div></div>
			<p>
				</p><section class="lang-js"><div class="fig fig-codeblock"><div class="copyButton"><span style="display: none;">Hidden</span></div><div class="codeblock-wrapper"><pre class="codeblock">onSort: function(oEvt) {

    var oTable = this.byId("persoTable");
    var sAffectedProperty = oEvt.getParameter("column").getSortProperty();
    var sSortOrder = oEvt.getParameter("sortOrder");

    //Apply the state programatically on sorting through the column menu
    //1) Retrieve the current personalization state
    Engine.getInstance().retrieveState(oTable).then(function(oState){

        //2) Modify the existing personalization state
        oState.Sorter.forEach(function(oSorter){
            oSorter.sorted = false;
        });
        oState.Sorter.push({
            key: sAffectedProperty,
            descending:  sSortOrder === tableLibrary.SortOrder.Descending
        });

        //3) Apply the modified personalization state to persist it in the VariantManagement
        Engine.getInstance().applyState(oTable, oState);
    });
}</pre></div></div></section>
			<p></p>
			<p>Whenever a value is provided in the <code>applyState</code> method, this value is added to
				the existing state.</p>
			<p>The following properties can be used per controller to remove a state entry:</p>
			<div class="tableWrapper "><div class="fig"><table border="1" id="table_zdr_nyv_1xb" class=" ">
					
					
					
					<thead>
						<tr>
							<th colspan="1" rowspan="1">
								<p>Registered Controller Type</p>
							</th>
							<th colspan="1" rowspan="1">
								<p>Key</p>
							</th>
							<th colspan="1" rowspan="1">
								<p>Type</p>
							</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>SelectionController</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>visible</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>boolean</code></p>
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>SortController</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>sorted</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>boolean</code></p>
							</td>
						</tr>
						<tr>
							<td colspan="1" rowspan="1">
								<p><code>GroupController</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>grouped</code></p>
							</td>
							<td colspan="1" rowspan="1">
								<p><code>boolean</code></p>
							</td>
						</tr>
					</tbody>
				</table></div></div>
		</section><section id="section_t4w_bsp_ywb">
			<h2 class="title ">Persistence</h2>
			<p>Persistence is provided by using the <code>VariantManagement</code> control. When
				using the personalization engine, the engine will ensure that any related SAPUI5
				flexibility changes for persisting personalization changes are made. For more information, see <a href="topic/f1430c0337534d469da3a56307ff76af" title="Here's what you have to consider when developing apps that support UI adaptation." class="sap-doc">SAPUI5 Flexibility: Enable Your App for UI Adaptation</a>.</p>
		</section><section class="contentInSection hidden"><h2>In this section:</h2></section><section class="familyLinks"><div class="parentLink"><br><strong>Parent topic: </strong><a href="topic/75c08fdebf784575947927e052712bab">Personalization</a></div><div class="previousLink hidden"><br><strong>Previous: </strong></div><div class="nextLink hidden"><br><strong>Next: </strong></div></section><section class="relatedLinks"><div class="collapsible-icon sap-icon title"><h2>Related information</h2></div><ul class="fig"><li><a href="topic/a3c3c5eb54bc4cc38e6cfbd8e90c6a01">Personalization Dialog</a></li></ul></section></div></section></div></body></html>