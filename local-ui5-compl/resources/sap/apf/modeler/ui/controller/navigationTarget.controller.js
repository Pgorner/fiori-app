sap.ui.define(["sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/apf/modeler/ui/utils/textPoolHelper","sap/apf/modeler/ui/utils/viewValidator","sap/m/MessageBox","sap/ui/core/mvc/Controller","sap/ui/core/mvc/ViewType","sap/ui/thirdparty/jquery"],function(e,t,i,a,n,o,r,s,d,jQuery){"use strict";var g,c,l,u,f,v,p,m;var b;var I=n.TranslationFormatMap.NAVTARGET_TITLE;function T(e){e.byId("idNavigationTargetHeaderLabel").setText(c("basicData"));e.byId("idSemanticObjectLabel").setText(c("semanticObject"));e.byId("idActionLabel").setText(c("action"));e.byId("idDescriptionLabel").setText(c("navigationTargetTitle"));e.byId("idNavigationParametersHeaderLabel").setText(c("navigationParametersHeader"));e.byId("idNavigationTargetTypeHeaderLabel").setText(c("navigationTargetType"));e.byId("idNavigationTargetTypeLabel").setText(c("assignmentType"));e.byId("idAssignedStepsLabel").setText(c("assignedSteps"));e.byId("idContextMapping").setText(c("contextMapping"))}function y(e){var i;if(g&&g.arguments&&g.arguments.navTargetId){v=f.getNavigationTarget(g.arguments.navTargetId)}if(!t.checkIsNotUndefined(v)){i=f.createNavigationTarget();v=f.getNavigationTarget(i);O(e)}}function h(e){var t=v.getTitleKey()?c("navigationTargetTitle"):c("navigationTargetTitle")+" ("+c("default")+")";e.byId("idDescriptionLabel").setText(t);e.byId("idDescriptionLabel").setTooltip(t);e.byId("idUseDynamicParametersCheckBoxLabel").setText(c("useDynamicParametersLabel"))}function S(t){var i,a;var n={oTextReader:c,oConfigurationHandler:u,oConfigurationEditor:f,oParentObject:v,getCalatogServiceUri:t.getView().getViewData().getCalatogServiceUri,oCoreApi:t.getView().getViewData().oCoreApi};i=new sap.ui.controller("sap.apf.modeler.ui.controller.navTargetContextMapping");a=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.requestOptions",type:d.XML,id:t.createId("idContextMappingView"),viewData:n,controller:i});t.getView().attachEvent(e.events.UPDATESUBVIEWINSTANCESONRESET,a.getController().updateSubViewInstancesOnReset.bind(a.getController()));a.addStyleClass("formTopPadding");t.byId("idContextMappingVBox").insertItem(a);b=0;var o=v.getAllNavigationParameters();if(o.length>0){o.forEach(function(e){N(t,e)})}else{N(t)}}function N(e,t){var i=new sap.ui.controller("sap.apf.modeler.ui.controller.navigationTargetParameter");var a=new sap.ui.view({viewName:"sap.apf.modeler.ui.view.navigationTargetParameter",type:d.XML,id:e.createId("idNavigationTargetParameter"+b),viewData:{oTextReader:c,oParentController:e,oNavigationTarget:v,parameter:t,oConfigurationEditor:f},controller:i});e.byId("idNavigationParameterBox").addItem(a);b++;A(e)}function A(e){e.byId("idNavigationParameterBox").getItems().forEach(function(e){e.getController().checkVisibilityOfPlusMinus()})}function V(e){var a=jQuery.Deferred();m.getAllAvailableSemanticObjects(function(n,o){if(o===undefined){var r=i.prepareModel(n,n.length);e.byId("idSemanticObjectField").setModel(r);if(t.checkIsNotNullOrUndefinedOrBlank(v.getSemanticObject())){e.byId("idSemanticObjectField").setValue(v.getSemanticObject())}a.resolve()}else{F(e,o,"11504")}});return a.promise()}function x(e){var t,a;a=jQuery.Deferred();t=i.prepareModel([],0);e.byId("idActionField").setModel(t);D(undefined,e);C(e).then(function(e){a.resolve(e)});e.byId("idActionField").setValue(v.getAction());return a.promise()}function C(e){var a,n,o,r;r=new jQuery.Deferred;n=v.getSemanticObject();if(t.checkIsNotUndefined(n)){o=m.getSemanticActions(n);o.then(function(t){a=i.prepareModel(t.semanticActions,t.semanticActions.length);e.byId("idActionField").setModel(a);r.resolve(t)},function(t){F(e,t,"11505")})}return r.promise()}function D(e,i){var a,n,o;var r=v.getTitleKey();if(t.checkIsNotUndefined(r)){n=i.getView().getViewData().oConfigurationHandler.getTextPool().get(r).TextElementDescription;i.byId("idDescription").setValue(n)}else{var s=e?e:i.byId("idActionField").getModel().getData().Objects;if(s&&t.checkIsNotNullOrBlank(v.getAction())){for(o=0;o<s.length;o++){if(s[o].id===v.getAction()){a=s[o].text;break}}}n=a?a:v.getSemanticObject();i.byId("idDescription").setValue(n)}}function w(e){var t=new a(c,i);var n=t.getNavTargetTypeData();e.byId("idNavigationTargetTypeField").setModel(n);var o=v.isStepSpecific()?c("stepSpecific"):c("globalNavTargets");e.byId("idNavigationTargetTypeField").setSelectedKey(o)}function P(e){var t=v.isStepSpecific()?c("stepSpecific"):c("globalNavTargets");if(t===c("stepSpecific")){U(e,true);var a=[];var n=f.getSteps();var o,r;for(o=0;o<n.length;o++){r={};r.stepKey=n[o].getId();r.stepName=l.get(n[o].getTitleId()).TextElementDescription;a.push(r)}var s=i.prepareModel(a,a.length);e.byId("idAssignedStepsCombo").setModel(s);var d=f.getStepsAssignedToNavigationTarget(v.getId());e.byId("idAssignedStepsCombo").setSelectedKeys(d)}}function O(e){var t={id:v.getId(),icon:v.isGlobal()?"sap-icon://overview-chart":"sap-icon://pushpin-off"};if(e.byId("idDescription").getValue()){t.name=e.byId("idDescription").getValue()}m.updateSelectedNode(t)}function E(e){var t=c("navigationTarget")+": "+e.byId("idDescription").getValue();m.updateTitleAndBreadCrumb(t)}function M(e){var t={key:v.getId(),value:e.byId("idDescription").getValue()};m.setNavigationTargetName(t)}function U(e,t){e.byId("idAssignedStepsLabel").setVisible(t);e.byId("idAssignedStepsCombo").setVisible(t)}function F(e,t,i){var a=m.createMessageObject({code:i});a.setPrevious(t);m.putMessage(a)}function j(){var e=f.getStepsAssignedToNavigationTarget(v.getId());var t,i;for(t=0;t<e.length;t++){i=f.getStep(e[t]);i.removeNavigationTarget(v.getId())}}return s.extend("sap.apf.modeler.ui.controller.navigationTarget",{onInit:function(){var e=this;m=e.getView().getViewData();u=m.oConfigurationHandler;f=m.oConfigurationEditor;l=u.getTextPool();c=m.getText;g=m.oParams;if(!f){u.loadConfiguration(g.arguments.configId,function(e){f=e})}T(e);p=new o(e.getView());p.addFields(["idSemanticObjectField","idActionField"]);y(e);S(e);e.setDetailData()},onAfterRendering:function(){var e=this;if(e.getView().byId("idSemanticObjectField").getValue().length===0){e.getView().byId("idSemanticObjectField").focus()}},setDetailData:function(){var e=this;V(e).then(function(){x(e).then(function(t){D(t.semanticActions,e)})});h(e);w(e);P(e);var t=v.getUseDynamicParameters();if(t){this.getView().byId("idUseDynamicParametersCheckBox").setSelected(true)}else{this.getView().byId("idUseDynamicParametersCheckBox").setSelected(false)}},updateSubViewInstancesOnReset:function(t){var i=this;f=t;v=f.getNavigationTarget(v.getId());i.getView().fireEvent(e.events.UPDATESUBVIEWINSTANCESONRESET,{oConfigurationEditor:f,oParentObject:v})},handleChangeSemanticObjectValue:function(e){var i,a=this;i=e.getParameter("value").trim();v.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){v.setSemanticObject(i);C(a).then(function(e){if(e.semanticActions.length>0){v.setAction(a.byId("idActionField").getModel().getData().Objects[0].id);a.byId("idActionField").setSelectedKey(e.semanticActions[0].id)}else{a.byId("idActionField").setValue("")}D(e.semanticActions,a);h(a);O(a);E(a);M(a)})}f.setIsUnsaved()},handleChangeofAction:function(e){var i,a=this;i=e.getParameter("value");v.setTitleKey(undefined);if(t.checkIsNotNullOrBlank(i)){v.setAction(i)}D(undefined,a);h(a);O(a);E(a);M(a);f.setIsUnsaved()},handleChangeForTitleText:function(){var e=this,t;var i=e.byId("idDescription").getValue();if(i.trim().length===0){t=undefined;v.setTitleKey(t);D(undefined,e);h(e);O(e);E(e);M(e);f.setIsUnsaved()}else{e.getView().getViewData().oConfigurationHandler.getTextPool().setTextAsPromise(i,I).done(function(t){v.setTitleKey(t);h(e);e.byId("idDescription").setValue(i);O(e);E(e);M(e);f.setIsUnsaved()})}},handleSuggestions:function(e){var t=new n.SuggestionTextHandler(l);t.manageSuggestionTexts(e,I)},handleChangeOfNavigationTargetType:function(){var e=this;f.setIsUnsaved();var t=e.byId("idNavigationTargetTypeField").getSelectedKey();if(t===c("stepSpecific")){v.setStepSpecific();P(e)}else{v.setGlobal();U(e,false);e.byId("idAssignedStepsCombo").setSelectedKeys([]);j()}O(e,e.byId("idDescription").getValue())},handleChangeForAssignedSteps:function(){var e=this;f.setIsUnsaved();var t=e.byId("idAssignedStepsCombo").getSelectedKeys();var i=f.getStepsAssignedToNavigationTarget(v.getId());i.forEach(function(e){if(t.indexOf(e)===-1){var i=f.getStep(e);i.removeNavigationTarget(v.getId())}});t.forEach(function(e){if(i.indexOf(e)===-1){var t=f.getStep(e);t.addNavigationTarget(v.getId())}})},getValidationState:function(){var e=this;var t=true;e.byId("idNavigationParameterBox").getItems().forEach(function(e){if(!e.getController().validate()){t=false}});return p.getValidationState()&&e.byId("idContextMappingView").getController().getValidationState()&&t},getNavigationParameters:function(){return this.byId("idNavigationParameterBox").getItems()},addNavigationParameter:function(){N(this)},removeNavigationParameter:function(e){this.byId("idNavigationParameterBox").removeItem(e);A(this)},handleChangeForUseDynamicParameters:function(){var e=this.byId("idUseDynamicParametersCheckBox").getSelected();v.setUseDynamicParameters(e)},onExit:function(){var e=this;e.byId("idContextMappingView").destroy()},displayHelpAboutDynamicParameters:function(){var e=c("explanationOfDynamicParameters");var t=c("titleDynamicParameters");r.show(e,{icon:r.Icon.INFORMATION,title:t,actions:[r.Action.CLOSE]})}})});
//# sourceMappingURL=navigationTarget.controller.js.map