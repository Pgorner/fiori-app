/*!
* SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
*/
sap.ui.define("sap/sac/df/model/MemberFilter",["sap/ui/base/Object","sap/sac/df/firefly/library","sap/sac/df/types/MemberFilterOperator","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/sac/df/utils/ListHelper","sap/sac/df/thirdparty/lodash"],function(e,t,r,n,i,a,o){"use strict";function l(e,t,r){const n=e.getDimensionMember();const i=new s([n.getFieldValue(e.getDimension().getKeyField()).getString()],[t?n.getFieldValue(e.getDimension().getHierarchyDisplayKeyField()).getString():n.getFieldValue(e.getDimension().getDisplayKeyField()).getString()],[n.getText()]);if(t){const n=e.getChildren();if(n&&n.hasElements()){const e=a.arrayFromList(n).map(function(e){return this.transformValueHelpNode(e,t,r)}).filter(function(e){return e!==null});if(e.length!==0){i.Children=e}}}if(r&&!i.Children){if(!i.Key.includes(r)&&!i.Text.includes(r)){return null}}return i}var s=e.extend("sap.sac.df.model.MemberFilter",{constructor:function(e,t,r,n,a){Object.assign(this,Object.getPrototypeOf(this));return{InternalKey:e&&e,Key:t&&t,Text:r&&r,Operator:n?n:i.EQ,Hierarchy:a}}});s._createFFMemberFilter=function(e){const r=t.FilterDialogValueFactory.createValueExt(e.InternalKey&&e.InternalKey[0]?e.InternalKey[0]:null,e.Key&&e.Key[0]?e.Key[0]:null,e.Text&&e.Text[0]?e.Text[0]:null,e.Hierarchy?e.Hierarchy.name:null,this.getFFOperatorFromUI5Operator(e.Operator));if(e.Operator===i.BT||e.Operator===i.NB){const n=t.FilterDialogValueFactory.createValueExt(e.InternalKey&&e.InternalKey[1]?e.InternalKey[1]:null,e.Key&&e.Key[1]?e.Key[1]:null,e.Text&&e.Text[1]?e.Text[1]:null,e.Hierarchy?e.Hierarchy.name:null,this.getFFOperatorFromUI5Operator(e.Operator));return t.FilterDialogValueFactory.createRangeValue(r,n,e.Operator===i.NB)}return r};s.transformFromFilterToMemberFilter=function(e){return new s([e.getValue1(),e.getValue2()],[e.getValue1(),e.getValue2()],[],e.getOperator())};s.transformFromMemberFilterToFilter=function(e,t){return new n(t,e.Operator,e.Key[0],e.Key[1])};s._createFromFFFilter=function(e,t){const r=e.getDimension();const n=function(e,t){if(r.isMeasureStructure()){return}let n;if(e&&r&&r.getTextField()){n=e.getFlatOrHierarchicalTextSupplement(t)}if(!n){n=e.getString()}return n};const i=function(t,r){const n=e.getDimension();if(n.isMeasureStructure()){return}let i;if(t&&n){i=t.getFlatOrHierarchicalDisplayKeySupplement(r);if(!i){i=t.getString()}}return i};const a=r.getHierarchy();let o={};if(a&&a.getName()){o={name:a.getName(),version:e.getHierarchyVersion(),dueDate:e.getHierarchyDueDate(),levelOffset:e.getLevelOffset(),depth:e.getDepth()}}const l={Sign:e.getSetSign().getName?e.getSetSign().getName():e.getSetSign(),Operator:e.getComparisonOperator().getName()};let u=[e.getLow().getString()];let g=[i(e.getLow(),t)];let c=[n(e.getLow(),t)];if(e.getHigh()&&e.getHigh().getString()){u.push(e.getHigh().getString());g.push(i(e.getHigh(),t));c.push(n(e.getHigh(),t))}const p=new s(u,g,c,this.getUI5OperatorFromFFOperator(l),o);p.UniqueID=e.getUniqueId();return p};s.createFromFFMemberFilter=function(e){const t=[];o.forEach(e,e=>{const r=new s([e.Low,e.High].filter(Boolean),[e.Low,e.High].filter(Boolean),[e.Text].filter(Boolean),this.getUI5OperatorFromFFOperator({Sign:e.IsExcluding?"EXCLUDING":"INCLUDING",Operator:e.ComparisonOperator}),e.Hierarchy);const n=[e.LowExternal,e.HighExternal].filter(Boolean);if(n.length>0){r.KeyComponents=[];o.forEach(n,e=>{const t=[];r.KeyComponents.push(t);o.forEach(e,function(e){const r={};t.push(r);r.Dimension=e.Dimension;r.Member=e.Member})})}t.push(r)});return t};s.createFromFFValueHelpNode=function(e,t,r){const n=e.getIterator();const i=[];while(n.hasNext()){const e=n.next();if(t||e.getDisplayLevel()===0){const n=l(e,t,r);if(n){i.push(n)}}}return i};s._condenseDimensionMemberFilter=function(e,r,n){var i=t.XList.create();if(e&&e.length>0){const l=[];const s=[];o.forEach(e,e=>{e.UniqueID?l.push(e.UniqueID):s.push(e)});if(r&&a.arrayFromList(r).length>0){if(l.length>0){o.forEach(a.arrayFromList(r),e=>{if(!l.includes(e.m_uniqueId)){r.removeElement(e)}});if(a.arrayFromList(r).length>0){i=t.FilterDialogValueUtils.newSelectionFromFilter(n,r)}}}o.forEach(s,e=>{i.add(this._createFFMemberFilter(e))})}return i};s.getFFOperatorFromUI5Operator=function(e){return t.ComparisonOperator[r[e][0].Operator]};s.getUI5OperatorFromFFOperator=function(e){return o.findKey(r,t=>{if(t){return t.find(t=>t.Operator===e.Operator&&t.Sign===e.Sign)}})};return s});
//# sourceMappingURL=MemberFilter.js.map