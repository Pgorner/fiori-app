/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/model/Configuration",["sap/ui/base/Object","sap/sac/df/model/internal/ConfigurationMapping","sap/sac/df/utils/ConfigLoader","sap/sac/df/firefly/library","sap/sac/df/utils/MetaPathHelper","sap/sac/df/types/configuration/ContextMenuVariant","sap/sac/df/types/configuration/DimensionGrouping","sap/sac/df/types/configuration/StylingPanelItem","sap/sac/df/thirdparty/lodash"],function(t,e,i,o,n,r,a,l,u){"use strict";const g={Calculations:true,ContextMenuVariant:r.sapui5,Commenting:false,StylingPanelItems:[l.TableProperties,l.NumberFormatting]};const s=t.extend("sap.sac.df.model.Configuration",{metadata:{properties:{Calculations:{type:"boolean",defaultValue:true},Commenting:{type:"boolean",defaultValue:false},ContextMenuVariant:{type:"sap.sac.df.types.configuration.ContextMenuVariant",defaultValue:r.sapui5},StylingPanelItems:{type:"sap.sac.df.types.configuration.StylingPanelItem[]",defaultValue:[l.TableProperties,l.NumberFormatting]}}},constructor:function(t,e,i){Object.assign(this,Object.getPrototypeOf(this));this._Model=t;this._Configuration=e;this._ConfigurationURI=i},_loadConfiguration:function(t){if(t){return i.loadConfigFromFile(t).then(t=>t?.FeatureConfiguration)}else{return Promise.resolve()}},applyConfiguration:function(){const t=this._Model.getSession();const e=t.getKernel()?.getConfigurationManager();this.ConsolidatedConfig=o.PrFactory.createStructure();return Promise.resolve(this._applySAPUI5Configuration()).then(()=>this._applyProvidedConfiguration()).then(()=>{e.writePlatformConfiguration(this.ConsolidatedConfig)})},_applyProvidedConfiguration:function(){return Promise.resolve(this._Configuration?this._Configuration:this._loadConfiguration(this._ConfigurationURI)).then(t=>this._applyFeatureConfiguration(t)).then(()=>this._applyContextMenuConfiguration())},_applySAPUI5Configuration:function(){return Promise.resolve(this._applyTechnicalSAPUI5Configuration()).then(()=>this._applyFeatureConfiguration(g)).then(()=>this._applyContextMenuConfiguration())},_applyTechnicalSAPUI5Configuration:function(){if(this._Configuration?.FilterDialogVariant==="Fiori"){return this._setFioriFilterDialogConfig()}else{return this._setSAPUI5FilterDialogConfig()}},_setSAPUI5FilterDialogConfig:function(){const t=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_DIMENSION);t.putString(o.FilterDialog.PARAM_SELECTION_MODE,o.UiSelectionMode.MULTI_SELECT.getName());t.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_HIERARCHY_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_EXTENDED_SETTINGS,true);const e=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_VARIABLE);e.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);e.putBoolean(o.FilterDialog.PARAM_ALWAYS_SHOW_SELECTION_CONTAINER,true)},_setFioriFilterDialogConfig:function(){const t=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_DIMENSION);t.putString(o.FilterDialog.PARAM_SELECTION_MODE,o.UiSelectionMode.MULTI_SELECT.getName());t.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_READMODE_EXTENDED_SETTINGS,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_LIST_VIEW,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_RANGE_VIEW,true);t.putBoolean(o.FilterDialog.PARAM_SIMPLIFIED_SEARCH,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_EXCLUDE_ADVANCED,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_HIERARCHY_CHANGE,true);t.putBoolean(o.FilterDialog.PARAM_OFFER_DISPLAY_INFO_EXTENDED_SETTINGS,true);t.putString(o.FilterDialog.PARAM_DISPLAY_PATTERN_RANGE,"$1...$2");const e=this._getOrCreateProgramConfig(o.FilterDialog.DEFAULT_PROGRAM_NAME_VARIABLE);e.putString(o.FilterDialog.PARAM_DIMENSION_TEXT_USAGE_TYPE,o.FilterDialogTextUsageType.RESULTSET_TEXT);e.putBoolean(o.FilterDialog.PARAM_ALWAYS_SHOW_SELECTION_CONTAINER,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_LIST_VIEW,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_RANGE_VIEW,true);e.putBoolean(o.FilterDialog.PARAM_SIMPLIFIED_SEARCH,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_EXCLUDE_ADVANCED,true);e.putBoolean(o.FilterDialog.PARAM_OFFER_DISPLAY_INFO_EXTENDED_SETTINGS,true);e.putString(o.FilterDialog.PARAM_DISPLAY_PATTERN_RANGE,"$1...$2")},_applyFeatureConfiguration:function(t){if(t){u.map(t,(t,e)=>{if(e!=="ContextMenuVariant"){this._setConfigurationProperty(e,t);this.setProperty(e,t)}})}},_getOrCreateProgramConfig:function(t){let e=this.ConsolidatedConfig.getStructureByKey(t);if(!e){e=this.ConsolidatedConfig.putNewStructure(t)}return e},_applyContextMenuConfiguration:function(){let t=this._Configuration?.ContextMenuVariant||"sap-ui5";if(t){this.setProperty("ContextMenuVariant",t);const e=t?"sap/sac/df/fa/configs/"+t+"-config.json":"sap/sac/df/fa/configs/sap-ui5-config.json";return i.loadConfigFromFile(e).then(t=>{this._ContextMenuConfiguration=JSON.stringify(t?.QueryBuilder?.MenuSettings)})}},getContextMenuConfiguration:function(){return this._ContextMenuConfiguration},_setConfigurationProperty:function(t,i){if(!Object.hasOwn(e,t)){return}const n=e[t];const r=Array.isArray(n.Program)?u.map(n.Program,t=>this._getOrCreateProgramConfig(t)):[this._getOrCreateProgramConfig(n.Program)];switch(n.Type){case o.PrElementType.BOOLEAN:r.forEach(t=>{t.putBoolean(n.FFName,i)});break;case o.PrElementType.STRING:r.forEach(t=>{t.putString(n.FFName,i)});break;case o.PrElementType.LIST:r.forEach(t=>{let e=t.putNewList(n.FFName);i.forEach(t=>{e.addString(t)})});break}}});s.prototype.setProperty=function(t,e){return this._Model.setProperty(n.PathTo.Configuration+"/"+t,e)};s.prototype.getProperty=function(t){return this._Model.getProperty(n.PathTo.Configuration+"/"+t)};return s});
//# sourceMappingURL=Configuration.js.map