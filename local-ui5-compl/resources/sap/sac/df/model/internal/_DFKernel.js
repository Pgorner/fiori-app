/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/model/internal/_DFKernel",["sap/ui/base/Object","sap/base/Log","sap/sac/df/firefly/library"],function(e,t,s){"use strict";s.XLocalStorage.setInstance(null);const a=e.extend("sap.sac.df.model._DFKernel",{});a._enableToggles=function(e){const t=e.getKernelProcess().getSession();t.deactivateFeatureToggle(s.FeatureToggleOlap.FUSION_SERVICE);s.XStream.of(s.FeatureToggle.getAllFeatureToggles()).forEach(function(e){const a=e.getXVersion();if(a>s.FeatureToggleOlap.FUSION_SERVICE.getXVersion()&&a<=s.XVersion.MAX){t.activateFeatureToggle(e)}});t.activateFeatureToggle(s.FeatureToggleOlap.METADATA_CACHING);t.deactivateFeatureToggle(s.FeatureToggleOlap.MEMBER_VALUE_EXCEPTIONS);s.FeFeatureToggle.enable(s.FeFeatureToggle.SIMPLIFY);s.FeFeatureToggle.enable(s.FeFeatureToggle.SYNTAX_HIGHLIGHTING);s.FeFeatureToggle.enable(s.FeFeatureToggle.NEW_FUNCTIONS_PHASE1);s.FeFeatureToggle.enable(s.FeFeatureToggle.NEW_FUNCTIONS_PHASE2);s.FeFeatureToggle.enable(s.FeFeatureToggle.LIST_ITEMS_SEARCH);s.FeFeatureToggle.enable(s.FeFeatureToggle.LIST_FUNCTIONS_BY_CATEGORY);s.FeFeatureToggle.enable(s.FeFeatureToggle.TOKENIZATION);s.FeFeatureToggle.enable(s.FeFeatureToggle.HIERARCHICAL_OBJECTS);s.FeFeatureToggle.enable(s.FeFeatureToggle.DIALOG_NEW_LAYOUT);s.FeFeatureToggle.enable(s.FeFeatureToggle.MIN);s.FeFeatureToggle.enable(s.FeFeatureToggle.MAX);s.FeFeatureToggle.enable(s.FeFeatureToggle.DIMENSION_SUPPORT);s.FeFeatureToggle.enable(s.FeFeatureToggle.HIERARCHICAL_DIMENSIONS)};a._setEnvironment=function(e){this.initProgram.setEnvironmentVariable(s.XEnvironmentConstants.FIREFLY_LOG_SEVERITY,"Print");if(e.systemLandscape){if(e.systemLandscape.URI){let t=e.systemLandscape.URI;if(!t.startsWith("http")){t=window.location.protocol+"//";t+=window.location.hostname;t+=window.location.port?":"+window.location.port:"";t+=e.systemLandscape.URI}this.initProgram.setEnvironmentVariable("ff_system_landscape_uri",t)}else if(e.systemLandscape.Systems){this.aSystemLandscapes=[];const t=Object.keys(e.systemLandscape.Systems);t.forEach(function(t){const s=e.systemLandscape.Systems[t];this.aSystemLandscapes.push(s)}.bind(this))}}else if(e.systemType){this.masterSystemName=e.masterSystem||"local"+e.systemType;const t={systemName:this.masterSystemName,systemType:e.systemType,protocol:window.location.protocol==="http:"?"HTTP":"HTTPS",host:window.location.hostname,port:window.location.port,authentication:"NONE"};if(t.systemType=="DWC"){t.path="/lcs/dwc"}this.aSystemLandscapes=[t]}else{throw new Error("System Configuration is invalid")}this.masterSystemName=this.masterSystemName||e.masterSystem;if(!this.masterSystemName){throw new Error("System Configuration is invalid")}};a.init=function(e){const t=this;if(!t.initPromise){t.initPromise=s.ui.FFUi5Preloader.load().then(()=>new Promise(a=>{if(!t.kernelProgram){s.XLogger.getInstance().setLogFilterLevel(s.Severity.PRINT);t.initProgram=s.KernelBoot.createByName("DragonflyAppProgram");if(!s.XVersion.V186_DISP_HIERARCHY_FIX_IN_FILTER){throw new Error("XVersion V186_DISP_HIERARCHY_FIX_IN_FILTER is undefined.")}t.initProgram.setXVersion(s.XVersion.V186_DISP_HIERARCHY_FIX_IN_FILTER);t.initProgram.addProgramStartedListener(function(n,r){if(!t.kernelProgram){t.kernelProgram=r;if(t.aSystemLandscapes){t.addSystemLandscapes(e.systemSettings.keepAliveInterval)}t.kernelProgram.getProcess().getApplication().setClientInfo(null,e.systemSettings.clientIdentifier,null);t.kernelProgram.getSession().deactivateFeatureToggle(s.FeatureToggleOlap.FUSION_SERVICE);a(t.kernelProgram)}});t.initProgram.setEnvironmentVariable(s.XEnvironmentConstants.FIREFLY_USER_PROFILE_SERIALIZED,e.userProfile);t.initProgram.setEnvironmentVariable("ff_mount_30","/analyticalwidgets:${ff_network_root_dir}"+e.systemSettings.widgetCatalogPath);t._setEnvironment(e.systemSettings);t.initProgram.setKernelReadyConsumer(t._enableToggles);t.initProgram.runFull()}else{a(t.kernelProgram)}}))}return t.initPromise};a.getSession=function(){if(!this.kernelProgram){t.error("Kernel not initialized");return null}return this.kernelProgram.getSession()},a.getApplication=function(){if(!this.kernelProgram){t.error("Kernel not initialized");return null}return this.kernelProgram.getApplication()},a.addSystemLandscapes=function(e){const t=this.kernelProgram.getProcess().getKernel().getSubSystemContainer(s.SubSystemType.SYSTEM_LANDSCAPE);const a=t.getMainApi();const n=this.kernelProgram.getApplication();n.setSystemLandscape(a);this.aSystemLandscapes.forEach(function(t){const r=a.createSystem();r.setName(t.systemName);r.setTimeout(1e4);r.setAuthenticationType(s.AuthenticationType[t.authentication||"NONE"]);const o=s.SystemType[t.systemType];r.setSystemType(o);r.setProtocolType(s.ProtocolType[t.protocol]);r.setHost(t.host);r.setPort(t.port);r.setPath(t.path);if(t.language){r.setLanguage(t.language)}a.setSystemByDescription(r);if(o.isTypeOf(s.SystemType.BW)){r.setSessionCarrierType(s.SessionCarrierType.SAP_CONTEXT_ID_HEADER);n.getConnectionPool().setMaximumSharedConnections(t.systemName,10)}const i=t.keepAliveIntervalSec|e|0;r.setKeepAliveDelayMs(i*1e3);r.setKeepAliveIntervalMs(i*1e3)});a.setMasterSystemName(this.masterSystemName)};return a});
//# sourceMappingURL=_DFKernel.js.map