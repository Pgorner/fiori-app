/*! SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
   */
sap.ui.define("sap/sac/df/model/visualization/Grid",["sap/ui/base/Object","sap/sac/df/thirdparty/lodash","sap/sac/df/firefly/library","sap/sac/df/utils/SyncActionHelper","sap/sac/df/model/MemberFilter","sap/sac/df/types/Axis","sap/sac/df/model/visualization/Documents"],function(e,t,i,a,r,o,s){"use strict";var n=e.extend("sap.sac.df.model.visualization.Grid",{constructor:function(e){Object.assign(this,Object.getPrototypeOf(this));this._Visualization=e;this._DataProvider=e._DataProvider;this.Documents=new s(this._DataProvider);Object.assign(this);this._onVisualizationFilled=function(){return Promise.resolve(this._Visualization._getFFVisualization()).then(e=>{let t=e.getActiveTableContainer();if(i.notNull(t)){if(t.getData()&&t.getData().isValid()){let e=t.getVisualizationData();if(e){try{this.Cells=i.PivotTableExport.create(e,t)._export().convertToNative();this._DataProvider._Model.checkUpdate();this._DataProvider.fireDataUpdated()}catch(e){}}}else{this._DataProvider._addMessagesToModel(t.getData());this._DataProvider._Model.checkUpdate();this._DataProvider._Model.fireRequestFailed({infoObject:this._DataProvider.Name})}}})}}});n.prototype.getVisualizationData=function(){let e=this._Visualization._getFFVisualization().getActiveTableContainer();if(i.notNull(e)){if(e.getData()&&e.getData().isValid()){let t=e.getVisualizationData();if(t){try{return i.PivotTableExport.create(t,e)._export().convertToNative()}catch(e){}}}else{return e.getData()}}};n.prototype.getCellContext=function(e,o){var s=this;var n=i.PivotTableCellContextProvider.create(s._DataProvider._getQueryManager());var l=i.RsCellIndexInfo.create();l.initialize(e,o);return a.syncActionToPromise(n.getCellContext,n,l).then(function(e){var i=e?e.convertToNative():null;t.forEach(i,function(e){e.Filter=r.createFromFFMemberFilter(e.Filter)});return Promise.resolve(i)}).catch(function(e){s._DataProvider._addMessagesToModel(e.getMessages?e:[]);return Promise.reject(e)})};n.prototype.getRRITargets=function(e,a){var r=this._DataProvider._getQueryManager().getRriTargetManager();if(!r){return Promise.resolve([])}r.setResultSetContext(e,a);var o,s;function n(e,t){o=e;s=t}r.processRriTargetResolution(i.SyncType.NON_BLOCKING,{onRriTargetResolution:function(e){if(e.hasErrors()){s(e.getMessages())}else{let i;const a=sap.ui.require("sap/ushell/Container");if(a&&a.getServiceAsync){i=a.getServiceAsync("URLParsing").then(e=>e.isIntentUrl)}else{i=Promise.resolve(t.constant(false))}i.then(i=>{o(t.filter(e.getData().getListFromImplementation().map(function(e){return e.getParameters().getMapFromImplementation()}),function(e){return i(e.URL)||!!e.URL.match(/#/)}).map(function(e){e.URL=e.URL.split("#")[1];return e}))}).catch(s)}}});return new Promise(n)};n.prototype.activateStylingTemplate=function(e){return Promise.resolve(this._Visualization._getFFVisualization()).then(t=>{if(e){var a=this._DataProvider._Model.getGridStylingTemplateRegistry().getTemplate(e);if(a.getStyleForDataProvider&&this._DataProvider){a=a.getStyleForDataProvider(this._DataProvider)}const o=t.getQueryManager().getOlapEnv().getVisualizationTemplateManager();const s=o.getOrCreateTableTemplateList(i.OlapVisualizationConstants.TABLE_TEMPLATE_LINK);var r=s.getByKey(e);r.deserializeFromElementExt(i.QModelFormat.INA_REPOSITORY,new i.NativeJsonProxyElement(a));s.setActiveTemplate(r);t.getTemplateLinker().putLinkedDefinition(i.OlapVisualizationConstants.TABLE_TEMPLATE_LINK,r)}})};n.prototype.setAxesLayout=function(e){this._DataProvider._getQueryManager().stopEventing();t.forEach(t.map(this._DataProvider.Dimensions,"Name"),e=>{this._DataProvider._getQueryModel().getAxis(i.AxisType.FREE).add(this._DataProvider._getQueryModel().getDimensionByName(this._DataProvider.getDimension(e).TechName))});t.forEach(e[o.Rows],e=>{this._DataProvider.getDimension(e).toRows()});t.forEach(e[o.Columns],e=>{this._DataProvider.getDimension(e).toColumns()});this._DataProvider._getQueryManager().resumeEventing();this._DataProvider._executeModelOperation();return this};n.prototype.getAxesLayout=function(){return{Columns:t.map(t.sortBy(t.filter(this._DataProvider.Dimensions,{Axis:i.AxisType.COLUMNS.getName()}),"Position"),e=>e.Name),Rows:t.map(t.sortBy(t.filter(this._DataProvider.Dimensions,{Axis:i.AxisType.ROWS.getName()}),"Position"),e=>e.Name)}};n.M_PROPERTIES={Documents:"Documents"};return n});
//# sourceMappingURL=Grid.js.map