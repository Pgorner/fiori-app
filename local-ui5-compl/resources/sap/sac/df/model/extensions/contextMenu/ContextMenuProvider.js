/*
 * SAPUI5
    (c) Copyright 2009-2021 SAP SE. All rights reserved
  
 */
sap.ui.define("sap/sac/df/model/extensions/contextMenu/ContextMenuProvider",["sap/ui/base/Object","sap/base/Log","sap/sac/df/firefly/library","sap/sac/df/utils/ListHelper"],function(e,t,n,i){"use strict";const o="Gds.Qb.Table.ContextMenu";const r=e.extend("sap.sac.df.model.extensions.contextMenu.ContextMenuProvider",{actionExecution:{},constructor:function(e){this._Model=e;this.actions={}},isActionVisible:function(e,t){return true},isActionEnabled:function(e,t){return true},onActionTriggered:function(e,t){const n=this.actions[e]||r.actionExecution[e];if(n&&(!n.builtin||n.Type==="Submenu")){n.triggerAction(e,this.convertContextMenuContext(t))}},fireOnClickEvent:function(){},provideMenuConfig:function(e,i,s){r.actionExecution={};const c=n.PrFactory.createStructure();const u=[];if(Object.keys(this.actions).length>0&&e.getUiContext()===o){const t=c.putNewList("MenuExtensions");const n=this.convertContextMenuContext(e);const i=t.addNewStructure();i.putNewList("UiContext").addString(o);const s=i.putNewList("Extension");Object.keys(this.actions).forEach(e=>{const t=this.actions[e];const i=s.addNewStructure();const o=i.putNewList("Items");const c=o.addNewStructure();function a(e,i){return t.isActionVisible(e,n).then(e=>{i.putBoolean("Visible",e)})}function l(e,i){return t.isActionEnabled(e,n).then(e=>{i.putBoolean("Enabled",e)})}function d(e,o,s){return t.getActionDescription(e,n).then(n=>{if(n.InsertAfter){if(s){return Promise.reject(`Action ${e} is nested. InsertAfter is not allowed `)}i.putString("Operation","InsertAfter");i.putString("Reference",n.InsertAfter)}else if(n.InsertBefore){if(s){return Promise.reject(`Action ${e} is nested. InsertBefore is not allowed `)}i.putString("Operation","InsertBefore");i.putString("Reference",n.InsertBefore)}else if(!s){i.putString("Operation","AppendInto");i.putString("Reference","$Root")}if(!n.builtin){o.putString("Text",n.Text);if(n.Icon){o.putString("Icon",n.Icon)}}if(n.Type==="Submenu"){o.putString("Type","Submenu");if(n.OverflowIfMoreThanNItems){o.putString("OverflowIfMoreThanNItems",n.OverflowIfMoreThanNItems)}const e=n.NestedActions;const t=o.putNewList("Items");const i=[];e.forEach(e=>{const n=t.addNewStructure();i.push(d(e,n,true));i.push(l(e,n));i.push(a(e,n))});return i}else{o.putString("Action",e);r.actionExecution[e]=t}})}if(t.getActionDescription){u.push(d(e,c,false))}else{c.putString("Action",e);i.putString("Operation","AppendInto");i.putString("Reference","$Root")}if(!t.builtin){u.push(l(e,c));u.push(a(e,c))}})}Promise.all(u).then(function(){if(t.isLoggable()){t.debug(n.PrUtils.serialize(c))}i.onDynamicMenuConfigProvided(e,"flexAnalysisProvider",c,s)}).catch(o=>{t.error("Failed to provide custom context menu",o,"ContextMenuProvider");i.onDynamicMenuConfigProvided(e,"flexAnalysisProvider",n.PrFactory.createStructure(),s)})},registerAction:function(e,t){this.actions[e]=t},unregisterAction:function(e){delete this.actions[e]},isReleaseLocked:function(){return true},convertCellClickContext:function(e,t){const n={DataProvider:t,Grid:{SelectedCells:[],SelectedDataCells:[]}};const i=parseInt(e.getParameters().getByKey("column"));const o=parseInt(e.getParameters().getByKey("row"));if(i>=0&&o>=0){n.Grid.SelectedCells.push({rowIndex:o,columnIndex:i});this._setSelectedDataCells(n,o,i)}return n},convertContextMenuContext:function(e){var t=this;const n={DataProvider:this._getDataProvider(e).Name,Grid:{SelectedCells:[],SelectedDataCells:[]}};let o=i.arrayFromList(i.arrayFromList(e.getSubContexts("Selected.Cells"))[0].getSubContexts());o.forEach(function(e){const i=e.getCustomObject().getFirstObject().getInteger();const o=e.getCustomObject().getSecondObject().getInteger();if(i>=0&&o>=0){n.Grid.SelectedCells.push({rowIndex:o,columnIndex:i});t._setSelectedDataCells(n,o,i)}});return n},_setSelectedDataCells:function(e,t,n){if(n&&t){const i=this._Model.getDataProvider(e.DataProvider);const o=i.getGridVisualization()._getFFVisualization().getActiveTableContainer();const r=o.getColumnTupleIndex(n);const s=o.getRowTupleIndex(t);const c=o.getDocumentId(n,t);if(r>=0&&s>=0){e.Grid.SelectedDataCells.push({rowIndex:s,columnIndex:r,documentId:c})}}},_getDataProvider:function(e){let t=e.getSingleSubContext("Olap.DataProvider")?.getCustomObject();if(!t){t=e.getSingleSubContext("Document.QueryBuilder").getCustomObject().getDataProvider()}return t&&this._Model.getDataProvider(t.getName())}});return r});
//# sourceMappingURL=ContextMenuProvider.js.map