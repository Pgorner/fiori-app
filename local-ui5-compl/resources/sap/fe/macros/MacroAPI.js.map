{"version":3,"file":"MacroAPI.js","names":["MacroAPI","_dec","defineUI5Class","_dec2","implementInterface","_dec3","aggregation","type","multiple","isDefault","_dec4","property","_dec5","_class","_class2","_MacroAPI","_BuildingBlock","mSettings","others","_this","call","this","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","parentContextToBind","_inheritsLoose","_proto","prototype","applySettings","oScope","eventsKeys","Object","keys","getMetadata","getEvents","eventsKey","undefined","init","getModel","oPageModel","Component","getOwnerComponentFor","setModel","rerender","UIArea","rerenderControl","content","getController","getObject","setParentBindingContext","modelName","path","setParent","_len","arguments","length","args","Array","_key","forEach","getParent","bindObject","model","events","change","oBoundContext","getBoundContext","setProperty","BuildingBlock","namespace","macroName","fragment","hasValidation","getConverterContext","oDataModelPath","contextPath","oAppComponent","appComponent","viewData","models","getData","ConverterContext","createConverterContextForMacro","startingEntitySet","name","metaModel","getDiagnostics","merge","contextLocation","createBindingContext","oData","sContextPath","uid","converterContext","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./MacroAPI.ts"],"sourcesContent":["import merge from \"sap/base/util/merge\";\nimport uid from \"sap/base/util/uid\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { aggregation, defineUI5Class, implementInterface, property } from \"sap/fe/base/ClassSupport\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport type { TemplateProcessorSettings } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport type { $ManagedObjectSettings } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type Control from \"sap/ui/core/Control\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\nimport UIArea from \"sap/ui/core/UIArea\";\nimport type { IFormContent } from \"sap/ui/core/library\";\nimport type ClientContextBinding from \"sap/ui/model/ClientContextBinding\";\nimport type Context from \"sap/ui/model/Context\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\n\n/**\n * Base API control for building blocks.\n * @hideconstructor\n * @public\n */\n@defineUI5Class(\"sap.fe.macros.MacroAPI\")\nclass MacroAPI extends BuildingBlock implements IFormContent {\n\t@implementInterface(\"sap.ui.core.IFormContent\")\n\t__implements__sap_ui_core_IFormContent = true;\n\n\tstatic namespace = \"sap.fe.macros\";\n\n\tstatic macroName = \"Macro\";\n\n\tstatic fragment = \"sap.fe.macros.Macro\";\n\n\tstatic hasValidation = true;\n\n\t@aggregation({ type: \"sap.ui.core.Control\", multiple: false, isDefault: true })\n\tcontent!: Control;\n\n\tconstructor(mSettings?: $ControlSettings & PropertiesOf<MacroAPI>, others?: $ControlSettings) {\n\t\tsuper(mSettings, others);\n\t}\n\n\tapplySettings(mSettings: $ManagedObjectSettings, oScope?: object): this {\n\t\t// Cleanup events\n\t\tif (mSettings) {\n\t\t\tconst eventsKeys = Object.keys(this.getMetadata().getEvents());\n\t\t\tfor (const eventsKey of eventsKeys) {\n\t\t\t\tif (mSettings[eventsKey as keyof $ManagedObjectSettings] === undefined) {\n\t\t\t\t\tdelete mSettings[eventsKey as keyof $ManagedObjectSettings];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn super.applySettings(mSettings, oScope);\n\t}\n\n\tinit(): void {\n\t\tsuper.init();\n\t\tif (!this.getModel(\"_pageModel\")) {\n\t\t\tconst oPageModel = Component.getOwnerComponentFor(this)?.getModel(\"_pageModel\");\n\t\t\tif (oPageModel) {\n\t\t\t\tthis.setModel(oPageModel, \"_pageModel\");\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Defines the path of the context used in the current page or block.\n\t * This setting is defined by the framework.\n\t * @public\n\t */\n\t@property({ type: \"string\" })\n\tcontextPath!: string;\n\n\t/**\n\t * Defines the relative path of the property in the metamodel, based on the current contextPath.\n\t * @public\n\t */\n\t@property({ type: \"string\" })\n\tmetaPath!: string;\n\n\trerender(): void {\n\t\t(UIArea as unknown as { rerenderControl(control: Control): void }).rerenderControl(this.content);\n\t}\n\n\tgetController(): PageController {\n\t\treturn (this.getModel(\"$view\") as JSONModel)?.getObject(\"/\").getController() as PageController;\n\t}\n\n\t/**\n\t * Retrieve a Converter Context.\n\t * @param oDataModelPath\n\t * @param contextPath\n\t * @param mSettings\n\t * @returns A Converter Context\n\t */\n\tstatic getConverterContext = function (\n\t\toDataModelPath: DataModelObjectPath<unknown>,\n\t\tcontextPath: string,\n\t\tmSettings: TemplateProcessorSettings\n\t): ConverterContext {\n\t\tconst oAppComponent = mSettings.appComponent;\n\t\tconst viewData = mSettings.models.viewData && mSettings.models.viewData.getData();\n\t\treturn ConverterContext.createConverterContextForMacro(\n\t\t\toDataModelPath.startingEntitySet.name,\n\t\t\tmSettings.models.metaModel,\n\t\t\toAppComponent && oAppComponent.getDiagnostics(),\n\t\t\tmerge,\n\t\t\toDataModelPath.contextLocation,\n\t\t\tviewData\n\t\t);\n\t};\n\n\t/**\n\t * Create a Binding Context.\n\t * @param oData\n\t * @param mSettings\n\t * @returns The binding context\n\t */\n\tstatic createBindingContext = function (oData: object, mSettings: TemplateProcessorSettings): Context {\n\t\tconst sContextPath = `/uid--${uid()}`;\n\t\tmSettings.models.converterContext.setProperty(sContextPath, oData);\n\t\treturn mSettings.models.converterContext.createBindingContext(sContextPath)!;\n\t};\n\n\tparentContextToBind: Record<string, string> = {};\n\n\t/**\n\t * Keep track of a binding context that should be assigned to the parent of that control.\n\t * @param modelName The model name that the context will relate to\n\t * @param path The path of the binding context\n\t */\n\tsetParentBindingContext(modelName: string, path: string): void {\n\t\tthis.parentContextToBind[modelName] = path;\n\t}\n\n\tsetParent(...args: unknown[]): void {\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t// @ts-ignore\n\t\tsuper.setParent(...args);\n\t\tObject.keys(this.parentContextToBind).forEach((modelName) => {\n\t\t\tthis.getParent()!.bindObject({\n\t\t\t\tpath: this.parentContextToBind[modelName],\n\t\t\t\tmodel: modelName,\n\t\t\t\tevents: {\n\t\t\t\t\tchange: function (this: ClientContextBinding) {\n\t\t\t\t\t\tconst oBoundContext = this.getBoundContext() as InternalModelContext;\n\t\t\t\t\t\tif (oBoundContext && !oBoundContext.getObject()) {\n\t\t\t\t\t\t\toBoundContext.setProperty(\"\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport default MacroAPI;\n"],"mappings":"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","ignoreList":[]}