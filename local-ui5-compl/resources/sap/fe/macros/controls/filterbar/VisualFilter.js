/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/macros/CommonHelper","sap/fe/macros/controls/filterbar/utils/VisualFilterUtils","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/FilterHelper","sap/m/VBox","sap/ui/core/Lib"],function(e,t,r,n,i,a,o,s){"use strict";var l,c,u,p,f,g,h,d,m,_,I;var b=a.getFiltersConditionsFromSelectionVariant;var v=e.property;var y=e.implementInterface;var E=e.event;var P=e.defineUI5Class;function C(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function R(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,S(e,t)}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function T(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(e){a[e]=n[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function F(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let O=(l=P("sap.fe.macros.controls.filterbar.VisualFilter"),c=y("sap.ui.core.IFormContent"),u=v({type:"boolean"}),p=v({type:"string"}),f=E(),l(g=(h=function(e){function a(){var t;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++){n[i]=arguments[i]}t=e.call(this,...n)||this;C(t,"__implements__sap_ui_core_IFormContent",d,t);C(t,"showValueHelp",m,t);C(t,"valueHelpIconSrc",_,t);C(t,"valueHelpRequest",I,t);return t}R(a,e);var o=a.prototype;o.onAfterRendering=function e(){let t;const a=this.getInteractiveChart();const o=this.data("infoPath");const l=a.getBinding("segments")||a.getBinding("bars")||a.getBinding("points");const c=a.getBindingContext("internal");const u=s.getResourceBundleFor("sap.fe.macros");const p=a.data("showOverlayInitially");const f=a.data("selectionVariantAnnotation")?r.parseCustomData(a.data("selectionVariantAnnotation")):{SelectOptions:[]};const g=a.data("requiredProperties")?r.parseCustomData(a.data("requiredProperties")):[];const h=a.getModel().getMetaModel();const d=l?l.getPath():"";let m=this.getParent()?.getParent();if(m.getMetadata().getElementName()==="sap.ui.mdc.filterbar.p13n.AdaptationFilterBar"){m=m.getParent()?.getParent()}let _={};let I=[];let v;if(m.isA("sap.fe.macros.controls.FilterBar")){_=m.getConditions();I=i.getFilterPropertyInfo(m);v=m.data("entityType").split("/")[1]}const y=a.data("parameters")?a.data("parameters").customData:[];const E=b(d,h,f,n.getCustomConditions.bind(n));const P=n.convertFilterCondions(E);const C={};Object.keys(_).forEach(function(e){if(_[e].length){C[e]=_[e]}});Object.keys(P).forEach(function(e){if(!C[e]){C[e]=P[e]}});if(p==="true"){if(!Object.keys(f).length){if(g.length>1){c.setProperty(o,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF")})}else{t=h.getObject(`${d}/${g[0]}@com.sap.vocabularies.Common.v1.Label`)||g[0];c.setProperty(o,{showError:true,errorMessageTitle:u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"),errorMessage:u.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",t)})}}else{const e=[];const t=[];if(f.SelectOptions){f.SelectOptions.forEach(function(t){e.push(t.PropertyName.$PropertyPath)})}if(f.Parameters){f.Parameters.forEach(function(t){e.push(t.PropertyName.$PropertyPath)})}g.forEach(function(r){if(!e.includes(r)){t.push(r)}});const r=n.getErrorInfoForNoInitialOverlay(t,u,d,h);c.setProperty(o,r)}}if(!this._oChartBinding||this._oChartBinding!==l){if(this._oChartBinding){this.detachDataReceivedHandler(this._oChartBinding)}this.attachDataRecivedHandler(l);this._oChartBinding=l}const R=c.getProperty(o)&&c.getProperty(o).showError;const S=d!==""?d.split("/")[1].split("(")[0]:"";if(y&&y.length&&v===S){const e=i.getBindingPathForParameters(m,C,I,y);if(e){l.sPath=e}}if(l&&l.isSuspended()&&!R){l.resume()}};o.attachDataRecivedHandler=function e(t){if(t){t.attachEvent("dataReceived",{},this.onInternalDataReceived,this);this._oChartBinding=t}};o.detachDataReceivedHandler=function e(t){if(t){t.detachEvent("dataReceived",this.onInternalDataReceived,this);this._oChartBinding=undefined}};o.setShowValueHelp=function e(t){if(this.getItems().length>0){const e=this.getVisualFilterControl();e.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setVisible(t)}});this.setProperty("showValueHelp",t)}};o.setValueHelpIconSrc=function e(t){if(this.getItems().length>0){const e=this.getVisualFilterControl();e.getContent().some(function(e){if(e.isA("sap.m.Button")){e.setIcon(t)}});this.setProperty("valueHelpIconSrc",t)}};o.getVisualFilterControl=function e(){return this.getItems()[0].getItems()[0]};o.getInteractiveChart=function e(){return this.getItems()[1].getItems()[0]};o.onInternalDataReceived=function e(r){const i=this.getId();const a=t.getTargetView(this);const o=this.getInteractiveChart();const l=this.data("infoPath");const c=o.getBindingContext("internal");const u=s.getResourceBundleFor("sap.fe.macros");const p=o.data("uom");n.updateChartScaleFactorTitle(o,a,i,l);if(r.getParameter("error")){const e=u.getText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE");const t=u.getText("M_VISUAL_FILTERS_ERROR_DATA_TEXT");n.applyErrorMessageAndTitle(e,t,l,a)}else if(r.getParameter("data")){const e=r.getSource().getCurrentContexts();if(e&&e.length===0){n.setNoDataMessage(l,u,a)}else{c.setProperty(l,{})}n.setMultiUOMMessage(e,o,l,u,a)}if(p&&(p["ISOCurrency"]&&p["ISOCurrency"].$Path||p["Unit"]&&p["Unit"].$Path)){const e=r.getSource().getContexts();const t=e&&e[0].getObject();n.applyUOMToTitle(o,t,a,l)}};return a}(o),d=T(h.prototype,"__implements__sap_ui_core_IFormContent",[c],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),m=T(h.prototype,"showValueHelp",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),_=T(h.prototype,"valueHelpIconSrc",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),I=T(h.prototype,"valueHelpRequest",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),h))||g);return O},false);
//# sourceMappingURL=VisualFilter.js.map