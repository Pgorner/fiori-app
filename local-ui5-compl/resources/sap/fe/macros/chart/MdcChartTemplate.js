/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/util/merge","sap/base/util/uid","sap/fe/base/BindingToolkit","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor","sap/fe/core/controls/CommandExecution","sap/fe/core/converters/ConverterContext","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/helpers/FPMHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/CommonHelper","sap/m/Button","sap/m/FlexItemData","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/m/OverflowToolbarLayoutData","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/Device","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Popup","sap/ui/fl/variants/VariantManagement","sap/ui/mdc/Chart","sap/ui/mdc/actiontoolbar/ActionToolbarAction","sap/ui/mdc/chart/Item","sap/ui/mdc/p13n/PersistenceProvider","sap/ui/model/json/JSONModel","../internal/helpers/ActionHelper","../internal/helpers/DefaultActionHandler","./ChartHelper","sap/fe/base/jsx-runtime/jsx"],function(e,t,n,a,o,i,r,s,c,l,u,d,p,g,f,h,m,b,v,C,_,y,A,x,P,M,D,T,O,I,S,B,k,V,j,E,$,F,w,N,L,H,U,z,R){"use strict";var G={};var W=j.Dock;var q=v.getTargetObjectPath;var J=v.getContextRelativeTargetObjectPath;var K=b.isPathAnnotationExpression;var X=m.generate;var Y=g.AggregationHelper;var Q=p.getVisualizationsFromAnnotation;var Z=p.getDataVisualizationConfiguration;var ee=d.isDataModelObjectPathForActionWithDialog;var te=u.getInvolvedDataModelObjects;var ne=l.TemplateType;var ae=r.escapeXMLAttributeValue;var oe=o.resolveBindingString;var ie=o.pathInModel;var re=o.notEqual;const se={"com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis1":"axis1","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis2":"axis2","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis3":"axis3","com.sap.vocabularies.UI.v1.ChartMeasureRoleType/Axis4":"axis4"};var ce=function(e){e["Sort"]="Sort";e["Type"]="Type";e["Item"]="Item";e["Filter"]="Filter";return e}(ce||{});function le(e,t,n,a){let o=J(n);let i=[];if(e._metaPathContext?.getObject()?.$Type==="com.sap.vocabularies.UI.v1.PresentationVariantType"){i=e._metaPathContext.getObject().Visualizations}else if(e._metaPathContext?.getObject()?.$Type==="com.sap.vocabularies.UI.v1.SelectionPresentationVariantType"){i=e._metaPathContext.getObject().PresentationVariant?.Visualizations}if(i?.length&&!ue(i,a)){o=""}if(!o){o=`@${"com.sap.vocabularies.UI.v1.Chart"}`}const r=Z(o,t,{isCondensedTableLayoutCompliant:e.useCondensedLayout,isMacroOrMultipleView:true,shouldCreateTemplateChartVisualization:false});return r.visualizations[0]}function ue(e,t){return e.some(e=>t?.includes(e.$AnnotationPath))}function de(e){return`${e}-content`}function pe(e,t){const n={};const a={};if(e.actions){Object.values(e.actions)?.forEach(e=>{if(e.isA("sap.fe.macros.chart.ActionGroup")){a[e.key]=ge(e.key,e.text,null,false,true,{placement:e.placement,anchor:e.anchor},e.actions.map((t,n)=>e.key+"_Menu_"+n));e.actions?.forEach((t,n)=>{const o=e.key.concat("_Menu_",n);a[o]=ge(o,t.text,t.press,!!t.requiresSelection,t.enabled===null||t.enabled===undefined?true:t.enabled)})}else if(e.isA("sap.fe.macros.chart.Action")){a[e.key]=ge(e.key,e.text,e.press,!!e.requiresSelection,e.enabled===null||e.enabled==undefined?true:e.enabled,{placement:e.placement,anchor:e.anchor})}})}if(t&&e.actions){n[t]={actions:a}}return n}function ge(e,t,n,a,o,i,r){const s={key:e,text:t,__noWrap:true,press:n,requiresSelection:a,enabled:o};if(i){s.position=i}if(r){s.menu=r}return s}function fe(e){const t=`/${a()}`;const n=new L;n.setProperty(t,e);return n.createBindingContext(t)}function he(t,n){const a=t.chartDefinition.annotationPath.split("/");const o=a.filter(function(e,t){return a.indexOf(e)==t}).toString().replaceAll(",","/");const i=te(t._metaModel.createBindingContext(o),t._context).targetObject;const r=n.getAggregatedProperty();let s=[];const c=t._metaPathContext.getPath();const l=n.getAggregatedProperties();const u=i?.Measures?i.Measures:[];const d=i?.DynamicMeasures?i.DynamicMeasures:[];const p=l[0]?l[0].filter(function(e){return u.some(function(t){return e.Name===t.value})}):undefined;const g=c.replace(/@com.sap.vocabularies.UI.v1.(Chart|PresentationVariant|SelectionPresentationVariant).*/,"");const f=t.chartDefinition.transAgg;const h=t.chartDefinition.customAgg;if(r.length>0&&!d&&p&&p.length>0){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}const m=u.some(e=>{const t=Ce(h,e);return!!t});if(r.length>0&&!d?.length&&!m){throw new Error("Please configure DynamicMeasures for the chart")}if(r.length>0&&i){for(const e of d){s=ve(s,e,g,i,t)}}for(const e of u){const n=e.value;const a=Ce(h,e);const o={};if(a){s=me(s,o,a,n)}else if(r.length===0&&f[n]){s=be(s,o,f,n)}_e(t._chart.MeasureAttributes,g,o,t)}const b=new L(s);b.$$valueAsPromise=true;return b.createBindingContext("/")}function me(t,n,a,o){if(o.includes("/")){e.error(`$expand is not yet supported. Measure: ${o} from an association cannot be used`)}n.key=a.value;n.role="axis1";n.label=a.label;n.propertyPath=a.value;t.push(n);return t}function be(e,t,n,a){const o=n[a];t.key=o.name;t.role="axis1";t.propertyPath=a;t.aggregationMethod=o.aggregationMethod;t.label=o.label||t.label;e.push(t);return e}function ve(t,n,a,o,i){const r=n.value||"";const s=te(i._metaModel.createBindingContext(a+r),i._context).targetObject;if(r.includes("/")){e.error(`$expand is not yet supported. Measure: ${r} from an association cannot be used`)}else if(!s){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else if(n.value?.startsWith(`@${"com.sap.vocabularies.Analytics.v1.AggregatedProperty"}`)===null){throw new Error(`Please provide the right AnnotationPath to the Dynamic Measure ${n.value}`)}else{const e={key:s.Name.toString(),role:"axis1"};e.propertyPath=s.AggregatableProperty.value;e.aggregationMethod=s.AggregationMethod.toString();e.label=oe(s.annotations?.Common?.Label?.toString()??s.AggregatableProperty.$target?.annotations?.Common?.Label?.toString()??"");_e(o.MeasureAttributes,a,e,i);t.push(e)}return t}function Ce(e,t){if(t.value&&e[t.value]){t.label=e[t.value]?.label;return t}return null}function _e(e,t,n,a){if(e?.length){for(const o of e){ye(o,t,n,a)}}}function ye(e,t,n,a){const o=e.DynamicMeasure?e?.DynamicMeasure?.value:e?.Measure?.value;const i=e.DataPoint?e?.DataPoint?.value:null;const r=e.Role;const s=i?te(a._metaModel.createBindingContext(t+i),a._context).targetObject:undefined;if(n.key===o){Ie(n,r);Oe(n,s)}}function Ae(e){const t={};if(e.TargetValue){t.targetValue=e.TargetValue.$Path}if(e.ForecastValue){t.foreCastValue=e.ForecastValue.$Path}let n=null;if(e.Criticality){if(K(e.Criticality)&&e.Criticality.path){n={Calculated:e.Criticality.path}}else{n={Static:e.Criticality.$EnumMember.replace("com.sap.vocabularies.UI.v1.CriticalityType/","")}}}else if(e.CriticalityCalculation){const t={};const a=xe(t,e.CriticalityCalculation);if(a){n={ConstantThresholds:t}}else{n={DynamicThresholds:t}}}if(n){t.criticality=n}return t}function xe(e,t){const n=["AcceptanceRangeLowValue","AcceptanceRangeHighValue","ToleranceRangeLowValue","ToleranceRangeHighValue","DeviationRangeLowValue","DeviationRangeHighValue"];e.ImprovementDirection=t.ImprovementDirection?.$EnumMember.replace("com.sap.vocabularies.UI.v1.ImprovementDirectionType/","");const a={oneSupplied:false,usedMeasures:[]};const o={oneSupplied:false};Pe(n,a,o,t);Me(n,e,a,o,t);return!a.oneSupplied}function Pe(e,t,n,a){for(const o of e){t[o]=a[o]?a[o].$Path:undefined;t.oneSupplied=t.oneSupplied||t[o];if(!t.oneSupplied){n[o]=a[o];n.oneSupplied=n.oneSupplied||n[o]}else if(t[o]){t.usedMeasures.push(t[o])}}}function Me(e,t,n,a,o){if(n.oneSupplied){for(const a of e){if(n[a]){t[a]=n[a]}}t.usedMeasures=n.usedMeasures}else{t.AggregationLevels=[];De(e,t,a,o)}}function De(e,t,n,a){let o={};if(n.oneSupplied){o={VisibleDimensions:null};for(const t of e){if(n[t]){o[t]=n[t]}}t.AggregationLevels?.push(o)}Te(e,t,a,o)}function Te(e,t,n,a){if(n.ConstantThresholds&&n.ConstantThresholds.length>0){for(const o of n.ConstantThresholds){const n=o.AggregationLevel?[]:null;if(n&&o.AggregationLevel&&o.AggregationLevel.length>0){for(const e of o.AggregationLevel){n.push(e.$PropertyPath)}}a={VisibleDimensions:n};for(const t of e){const e=o[t];if(e){a[t]=e}}t.AggregationLevels?.push(a)}}}function Oe(e,t){if(t&&t.Value.$Path==e.key){e.dataPoint=z.formatJSONToString(Ae(t))||""}}function Ie(e,t){if(t!=null){const n=t.$EnumMember;e.role=se[n]}}function Se(e,t){if(e._commandActions.length>0){return e._commandActions.map(n=>Fe(n,t,e))}return""}function Be(e,t){if(e){if(e==="false"){t._personalization=undefined}else if(e==="true"){t._personalization=Object.values(ce).join(",")}else if(ke(e)===true){t._personalization=e}else{t._personalization=undefined}}}function ke(e){let t=true;const n=e.split(",");const a=Object.values(ce);n.forEach(e=>{if(!a.includes(e)){t=false}});return t}function Ve(e){const t=e.variantManagement?e.variantManagement:e.chartDefinition.variantManagement;return e.personalization===undefined?"None":t}function je(t){const n=t.personalization;if(n){const e=Ve(t);if(e==="Control"){return R(E,{id:X([t._blockId,"VM"]),for:[t._blockId],showSetAsDefault:true,headerLevel:t.headerLevel,select:e=>{t.fireVariantSelected?.(e)},save:e=>{t.fireVariantSaved?.(e)}})}else if(e==="None"||e==="Page"){return""}}else if(!n){e.warning("Variant Management cannot be enabled when personalization is disabled")}return""}function Ee(e){if(Ve(e)==="None"){return R(N,{id:X([e._blockId,"PersistenceProvider"]),for:e._blockId})}}function $e(e,t,n,a,o){if(t){const i={actionContext:e,onExecuteAction:z.getPressEventForDataFieldForActionButton(o._blockId,t,n||""),onExecuteIBN:C.getPressHandlerForDataFieldForIBN(t,`\${internal>selectedContexts}`,false),onExecuteManifest:C.buildActionWrapper(a,o),chartOperationAvailableMap:n};o._commandActions.push(i)}}function Fe(e,t,n){const a=e.actionContext.getObject();const o=a.annotationPath&&n._metaModel.createBindingContext(a.annotationPath);const i=o&&o.getObject();const r=n._metaModel.createBindingContext(a.annotationPath+"/Action");const c=C.getActionContext(r);const l=C.getPathToBoundActionOverload(r);const u=n._metaModel.createBindingContext(l).getObject();const d=ae(z.getOperationAvailableMap(t.getObject(),{context:t}));const p=a.enabled?a.enabled:z.isDataFieldForActionButtonEnabled(u&&u.$IsBound,i.Action,n._context,d||"",a.enableOnSelect||"");let g;if(a.enabled){g=a.enabled}else if(i.RequiresContext){g="{= %{internal>numberOfSelectedContexts} >= 1}"}let f;switch(a.type){case"ForAction":f=p??a.enabled;break;case"ForNavigation":f=g??a.enabled;break;default:f=a.enabled;break}const h=R(s,{execute:t=>we(t,a,n._blockId,e.chartOperationAvailableMap,i),enabled:f,visible:ct(o,n)??a.visible,command:a.command});if(a.type=="ForAction"&&(!u||u.IsBound!==true||c[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false)){return h}else if(a.type=="ForAction"){return""}else{return h}}function we(e,t,n,a,o){const r=i.getTargetView(e.getSource());const s=r?.getController();switch(t.type){case"ForAction":const i=t.InvocationGrouping&&t.InvocationGrouping.$EnumMember==="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated";const c={contexts:r.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:i,controlId:n,operationAvailableMap:a,model:r.getModel(),label:o.Label};s.editFlow.invokeAction(o.Action,c);break;case"ForNavigation":const l={navigationContexts:r.getBindingContext("internal")?.getProperty("selectedContexts")};if(o.Mapping){l.semanticObjectMapping=JSON.stringify(o.Mapping)}s._intentBasedNavigation.navigate(o.SemanticObject,o.Action,l);break;default:f.actionWrapper(e,t.handlerModule,t.handlerMethod,{contexts:r.getBindingContext("internal")?.getProperty("selectedContexts")});break}}function Ne(e){if(e._chart){const t=[];const n=[];if(e._chart.Dimensions){z.formatDimensions(e._chartContext).getObject().forEach(n=>{n.id=X([e.id,"dimension",n.key]);t.push(Le({id:n.id,key:n.key,label:n.label,role:n.role},"_fe_groupable_","groupable"))})}if(e.measures){z.formatMeasures(e.measures).forEach(t=>{t.id=X([e.id,"measure",t.key]);n.push(Le({id:t.id,key:t.key,label:t.label,role:t.role},"_fe_aggregatable_","aggregatable"))})}if(t.length&&n.length){return t.concat(n)}}return""}function Le(e,t,n){return R(w,{id:e.id,propertyKey:t+e.key,type:n,label:oe(e.label,"string"),role:e.role})}function He(e){const t=ze(e);if(e.chartDefinition?.onSegmentedButtonPressed){t.push(ot(e))}if(e.chartDefinition.isInsightsEnabled){t.push(Ue(e.chartDefinition.isInsightsEnabled,e.chartDefinition.isInsightsVisible,e._blockId,e))}if(t.length>0){return t}return[]}function Ue(e,t,n,a){return R(F,{visible:t,children:R(_,{id:X([n,"StandardAction::Insights"]),text:"{sap.fe.i18n>M_COMMON_INSIGHTS_CARD}",press:()=>{a.onAddCardToInsightsPressed()},enabled:e,children:{layoutData:R(O,{priority:"AlwaysOverflow"})}})})}function ze(e){const t=Re(e.chartActions??[]);return t.map(t=>{if(t.annotationPath||t.type==="Menu"&&!t.id?.startsWith("CustomAction")){return Je(t,e._chartContext,false,e)}else if(t.hasOwnProperty("noWrap")){return Ge(t,e._chartContext,e)}})}function Re(e){for(const t of e){if(t.menu){t.menu.forEach(t=>{const n=e.map(e=>e.key).indexOf(t.key);if(n!==-1){e.splice(n,1)}})}}return e}function Ge(e,t,n){let a=e.enabled;if((e.requiresSelection??false)&&e.enabled==="true"){a="{= %{internal>numberOfSelectedContexts} >= 1}"}if(e.type==="Default"){return Ye(e,{id:X([n._blockId,e.id]),unittestid:"DataFieldForActionButtonAction",label:e.text?e.text:"",ariaHasPopup:undefined,press:e.press?e.press:"",enabled:a,visible:e.visible?e.visible:false},false,n)}else if(e.type==="Menu"){return qe({id:X([n._blockId,e.id]),text:e.text,visible:e.visible,enabled:a,useDefaultActionOnly:U.getUseDefaultActionOnly(e),buttonMode:U.getButtonMode(e),defaultAction:undefined,actions:e},t,n)}}function We(e,t,n){let a;if(e.annotationPath){return Je(e,t,true,n)}if(e.command){a={"jsx:command":`cmd:${e.command}|press`}}else if(e.noWrap??false){a={press:t=>{const n=e.handlerMethod?.split(".")[1];const a={...i.getTargetView(t.getSource()).getController()};if(a[n])a[n](t)}}}else{a={press:t=>{const n=i.getTargetView(t.getSource()).getBindingContext("internal")?.getProperty("selectedContexts");f.actionWrapper(t,e.handlerModule,e.handlerMethod,{contexts:n})}}}return R(T,{text:e.text,...a,visible:e.visible,enabled:e.enabled})}function qe(e,t,n){const a=(e.actions?.menu).map(e=>We(e,t,n));return R(F,{children:R(D,{text:e.text,type:"Transparent",id:e.id,visible:e.visible,enabled:e.enabled,useDefaultActionOnly:e.useDefaultActionOnly,buttonMode:e.buttonMode,menuPosition:W.BeginBottom,defaultAction:"props.defaultAction",children:{menu:R(M,{children:a})}})})}function Je(e,t,n,a){const o=a._metaModel.createBindingContext(e.annotationPath??"");if(e.type==="ForNavigation"){return Ke(e,o,n,a)}else if(e.type==="ForAction"){return Xe(t,e,o,n,a)}else if(e.type==="Menu"){const n=e.menu?.map(e=>Je(e,t,true,a));return R(F,{children:R(D,{text:e.text,type:"Transparent",id:e.key,visible:e.visible,enabled:e.enabled,menuPosition:W.BeginBottom,children:{menu:R(M,{children:n})}})})}return undefined}function Ke(e,t,n,a){let o="true";const i=t.getObject();if(e.enabled!==undefined){o=e.enabled}else if(i.RequiresContext){o="{= %{internal>numberOfSelectedContexts} >= 1}"}return Ye(e,{id:undefined,unittestid:"DataFieldForIntentBasedNavigationButtonAction",label:i.Label,ariaHasPopup:undefined,press:C.getPressHandlerForDataFieldForIBN(i,`\${internal>selectedContexts}`,false),enabled:o,visible:ct(t,a)},n,a,i)}function Xe(e,t,n,a,o){const i=o._metaModel.createBindingContext(t.annotationPath+"/Action");const r=o._metaModel.createBindingContext(C.getActionContext(i));const s=r?.getObject();const c=C.getPathToBoundActionOverload(i);const l=o._metaModel.createBindingContext(c).getObject();const u=n.getObject();if(!l||l.$IsBound!==true||s[`@${"Org.OData.Core.V1.OperationAvailable"}`]!==false){const i=at(t,l,u,e,o._context);const r=te(o._metaModel.createBindingContext(t.annotationPath));const s=ee(r);const c=ae(z.getOperationAvailableMap(e.getObject(),{context:e}))||"";return Ye(t,{id:X([o._blockId,te(n)]),unittestid:"DataFieldForActionButtonAction",label:u.Label,ariaHasPopup:s,enabled:i,visible:ct(n,o)},a,o,u,c)}return undefined}function Ye(e,t,n,a,o,r){if(n){const n=e.command?{"jsx:command":`cmd:${e.command}|press`}:{press:t=>{const n=i.getTargetView(t.getSource());const s=n.getController();if(e.type==="ForAction"){const e={contexts:n.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:o?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:a._blockId,operationAvailableMap:r,model:n.getModel(),label:o?.Label};s.editFlow.invokeAction(o?.Action,e)}else if(e.type==="ForNavigation"){const e={navigationContexts:n.getBindingContext("internal")?.getProperty("selectedContexts")};if(o?.Mapping){e.semanticObjectMapping=JSON.stringify(o.Mapping)}s._intentBasedNavigation.navigate(o.SemanticObject,o.Action,e)}}};return R(T,{text:t.label,...n,enabled:t.enabled,visible:t.visible})}else{return Qe(e,t,a,o,r)}}function Qe(e,t,n,a,o){return R(F,{children:R(_,{id:t.id,text:t.label,ariaHasPopup:t.ariaHasPopup,...Ze(e,a,o,n),enabled:t.enabled,visible:t.visible})})}function Ze(e,t,n,a){let o={press:""};if(e.hasOwnProperty("noWrap")){if(e.command){o={"jsx:command":`cmd:${e.command}|press`}}else if(e.noWrap===true){o=et(e)}else if(!e.annotationPath){o=tt(e)}}else{o=e.command?{"jsx:command":`cmd:${e.command}|press`}:nt(e,t,a,n)}return o}function et(e){return{press:t=>{const n=e.handlerMethod?.split(".")[1];const a={...i.getTargetView(t.getSource()).getController()};if(a[n])a[n](t)}}}function tt(e){return{press:t=>{const n=t.getSource().getBindingContext("internal")?.getProperty("selectedContexts");f.actionWrapper(t,e.handlerModule,e.handlerMethod,{contexts:n})}}}function nt(e,t,n,a){return{press:o=>{const r=i.getTargetView(o.getSource());const s=r.getController();if(e.type==="ForAction"){const e={contexts:r.getBindingContext("internal")?.getProperty("selectedContexts"),invocationGrouping:t?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:n?._blockId,operationAvailableMap:a,model:r.getModel(),label:t?.Label};s.editFlow.invokeAction(t?.Action,e)}else if(e.type==="ForNavigation"){const e={navigationContexts:r.getBindingContext("internal")?.getProperty("selectedContexts")};if(t?.Mapping){e.semanticObjectMapping=JSON.stringify(t.Mapping)}s._intentBasedNavigation.navigate(t.SemanticObject,t.Action,e)}}}}function at(e,t,n,a,o){return e.enabled!==undefined?e.enabled:z.isDataFieldForActionButtonEnabled(t&&t.$IsBound,n.Action,o,z.getOperationAvailableMap(a.getObject(),{context:a}),e.enableOnSelect||"")}function ot(e){return R(F,{layoutInformation:{aggregationName:"end",alignment:"End"},children:R(I,{id:X([e._blockId,"SegmentedButton","TemplateContentView"]),selectionChange:t=>{e.fireSegmentedButtonPressed?.(n(t.getParameters(),{selectedKey:t.getSource().getSelectedKey()}))},visible:re(ie("alpContentView","pageInternal"),"Table"),selectedKey:ie("alpContentView","pageInternal"),children:{items:it()}})})}function it(){const e=[];if(C.isDesktop()){e.push(rt("{sap.fe.i18n>M_COMMON_HYBRID_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Hybrid","sap-icon://chart-table-view"))}e.push(rt("{sap.fe.i18n>M_COMMON_CHART_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Chart","sap-icon://bar-chart"));e.push(rt("{sap.fe.i18n>M_COMMON_TABLE_SEGMENTED_BUTTON_ITEM_TOOLTIP}","Table","sap-icon://table-view"));return e}function rt(e,t,n){return R(S,{tooltip:e,icon:n},t)}function st(t,n){const a=J(t);if(!a){e.error(`Missing metaPath parameter for Chart`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}if(t.targetObject?.term==="com.sap.vocabularies.UI.v1.Chart"){return a}const o=n.getEntityTypeAnnotation(a);let i=[];switch(t.targetObject?.term){case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":if(t.targetObject.PresentationVariant){i=Q(t.targetObject,a,o.converterContext,true)}break;case"com.sap.vocabularies.UI.v1.PresentationVariant":i=Q(t.targetObject,a,o.converterContext,true);break;default:break}const r=i.find(e=>e.visualization.term==="com.sap.vocabularies.UI.v1.Chart");if(r){return r.annotationPath}else{e.error(`Bad metaPath parameter for chart: ${t.targetObject?.term}`);return`@${"com.sap.vocabularies.UI.v1.Chart"}`}}function ct(e,t){const n=e.getObject();if(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]&&n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path){const a=t._metaModel.createBindingContext(e.getPath()+`/@${"com.sap.vocabularies.UI.v1.Hidden"}/$Path`,n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path);return z.getHiddenPathExpressionForTableActionsAndIBN(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`].$Path,{context:a})}else if(n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]){return!n[`@${"com.sap.vocabularies.UI.v1.Hidden"}`]}else{return true}}function lt(e,a,o,i,r){let s=Object.assign({},a);delete s.resourceModel;delete s.appComponent;s=t(s);let l={};const u=q(o.contextLocation??o);const d=o.contextLocation?.targetEntitySet?.name??o.targetEntitySet?.name;if(u===a?.contextPath||u===`/${a?.entitySet}`||d===a?.entitySet){l=s.controlConfiguration}s.controlConfiguration=n(l,r||{});return c.createConverterContextForMacro(o.startingEntitySet.name,e._metaModel,i,n,o.contextLocation,s)}function ut(e,t,n,a){const o=lt(e,t,n,a);const i=st(n,o);const r=pe(e,i);return lt(e,t,n,a,r)}function dt(e){if(e._applyIdToContent){e._blockId=e.id.replace(/::Chart$/,"");e._contentId=e._blockId}else{e._blockId=e.id;e._contentId=de(e.id)}}function pt(e,t,n,a){const o=e.getMetaPathObject(e.metaPath,e._resolvedContextPath);e._metaModel=e._getOwner()?.preprocessorContext?.models.metaModel;e._metaPathContext=e._metaModel.createBindingContext(o.getPath());e._context=e._metaModel.createBindingContext(e.contextPath??o?.getContextPath());const i=ut(e,t,a,n);const r=i.getManifestWrapper()?.getViewConfiguration();const s=r?.paths?.length>1;const c=i.getManifestWrapper()?.hasMultipleVisualizations()||i.getTemplateType()===ne.AnalyticalListPage;const l=new Y(i.getEntityType(),i,true);e._chartContext=z.getUiChart(e._metaPathContext);e._chart=e._chartContext.getObject();e._blockActions=[];e._commandActions=[];dt(e);if(e._chart){e.chartDefinition=le(e,i,a,e._chartContext.getPath());const t=e._metaModel.createBindingContext(e.chartDefinition.collection);e.navigationPath=e.chartDefinition.navigationPath;e.autoBindOnInit=e.chartDefinition.autoBindOnInit;e.vizProperties=e.chartDefinition.vizProperties;e.chartActions=e.chartDefinition.actions;e.filter=gt(e);const n=e._personalization||e.chartDefinition.personalization;Be(n,e);e.visible=e.chartDefinition.visible;let o=e._context.getPath();o=o[o.length-1]==="/"?o.slice(0,-1):o;e.draftSupported=h.isDraftSupported(e._metaModel,o);e._chartType=z.formatChartType(e._chart.ChartType);const r=z.getOperationAvailableMap(e._chart,{context:e._chartContext});if(Object.keys(e.chartDefinition?.commandActions).length>0){Object.keys(e.chartDefinition?.commandActions).forEach(t=>{const n=e.chartDefinition?.commandActions[t];const a=fe(n);const o=n.annotationPath&&e._metaModel.createBindingContext(n.annotationPath);const i=o&&o.getObject();const s=ae(r);$e(a,i,s,n,e)})}e.measures=he(e,l);const u=C.createPresentationPathContext(e._metaPathContext);e._sortConditions=z.getSortConditions(e._metaPathContext,e._metaPathContext.getObject(),u.getPath(),e.chartDefinition.applySupported);const d=e._metaModel.createBindingContext(e._chartContext.getPath()+"/Actions",e._chart.Actions);const p=C.getTargetCollectionPath(t);const g=e._metaModel.createBindingContext(p,t);const f=a.convertedTypes.resolvePath(d.getPath())?.target;e._customData={targetCollectionPath:e.chartDefinition.collection,entitySet:typeof g.getObject()==="string"?g.getObject():g.getObject("@sapui.name"),entityType:e.chartDefinition.collection+"/",operationAvailableMap:JSON.parse(r),multiSelectDisabledActions:H.getMultiSelectDisabledActions(f)+"",segmentedButtonId:X([e._blockId,"SegmentedButton","TemplateContentView"]),customAgg:e.chartDefinition?.customAgg,transAgg:e.chartDefinition?.transAgg,applySupported:e.chartDefinition?.applySupported,vizProperties:JSON.parse(e.vizProperties),draftSupported:e.draftSupported,multiViews:e.chartDefinition?.multiViews||!c&&s,selectionPresentationVariantPath:{data:e.chartDefinition?.selectionPresentationVariantPath}};if(e.chartDefinition.isParameterizedEntitySet){e._customData.entitySet=e.chartDefinition.collection.substring(1)}}else{e.autoBindOnInit=false;e.visible="true";e.navigationPath="";e._customData={targetCollectionPath:"",entitySet:"",entityType:"",operationAvailableMap:"",multiSelectDisabledActions:"",segmentedButtonId:"",customAgg:{},transAgg:{},applySupported:{},vizProperties:{}}}}function gt(e){const t=V.getElementById(e.filterBar);if(e.filterBar&&t?.isA("sap.fe.macros.filterBar.FilterBarAPI")){return de(e.filterBar)}else if(t?.isA("sap.fe.macros.controls.FilterBar")){return e.filterBar}else if(e.filterBar){return de(e.filterBar)}}function ft(e){return e.chartDelegate?e.chartDelegate:{name:"sap/fe/macros/chart/ChartDelegate",payload:{chartContextPath:e._customData.targetCollectionPath,parameters:{$$groupId:"$auto.Workers"},selectionMode:e.selectionMode.toUpperCase()}}}function ht(e){return[R(k,{value:e._customData.targetCollectionPath},"targetCollectionPath"),R(k,{value:e._customData.entitySet},"entitySet"),R(k,{value:e._customData.entityType},"entityType"),R(k,{value:e._customData.operationAvailableMap},"operationAvailableMap"),R(k,{value:e._customData.multiSelectDisabledActions},"multiSelectDisabledActions"),R(k,{value:e._customData.segmentedButtonId},"segmentedButtonId"),R(k,{value:e._customData.customAgg},"customAgg"),R(k,{value:e._customData.transAgg},"transAgg"),R(k,{value:e._customData.applySupported},"applySupported"),R(k,{value:e._customData.vizProperties},"vizProperties"),R(k,{value:e._customData.draftSupported},"draftSupported"),R(k,{value:e._customData.multiViews},"multiViews"),R(k,{value:e._customData.selectionPresentationVariantPath},"selectionPresentationVariantPath")]}function mt(e){if(e._customData.targetCollectionPath===""){return}return R(A,{illustrationSize:x.Auto,illustrationType:P.BeforeSearch,title:e.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TITLE_TEXT"),description:e.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TEXT"),enableDefaultTitleAndDescription:false,enableVerticalResponsiveness:true})}function bt(e,t,n,a){pt(e,t,n,a);e.layoutData=R(y,{growFactor:"1",shrinkFactor:"1"});return R($,{binding:{internal:"controls/"+e._blockId},id:e._contentId,chartType:e._chartType,sortConditions:e._sortConditions,header:e.header??e._chart?.Title?.toString()??"",headerVisible:e.headerVisible,minHeight:B.system.phone?"80vh":"400px",height:"100%",width:"100%",headerLevel:e.headerLevel,headerStyle:e.headerStyle,p13nMode:e._personalization?.split(","),filter:e.filter,noDataText:e._customData.targetCollectionPath===""?e.getTranslatedText("M_CHART_NO_ANNOTATION_SET_TEXT"):e.noDataText,autoBindOnInit:e.autoBindOnInit,delegate:ft(e),visible:e.visible,children:{customData:ht(e),dependents:[Se(e,e._chartContext),Ee(e)],items:Ne(e),actions:e.chartActions?He(e):e._blockActions,variant:je(e),noData:mt(e)}})}G.getMdcChartTemplate=bt;return G},false);
//# sourceMappingURL=MdcChartTemplate.js.map