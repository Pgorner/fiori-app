/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/core/controllerextensions/messageHandler/messageHandling","sap/fe/core/helpers/ResourceModelHelper","sap/fe/macros/messages/MessagePopover","sap/m/Button","sap/m/ColumnListItem","sap/m/FormattedText","sap/m/library","sap/ui/core/Core","sap/ui/core/CustomData","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/Messaging","sap/ui/core/message/MessageType","sap/ui/core/mvc/View","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/thirdparty/jquery","./MessageButtonHelper"],function(e,t,n,i,o,s,r,a,g,l,c,u,f,d,p,h,T,b,m,jQuery,_){"use strict";var I,C,E,P,y,M,S;var A=g.ButtonType;var w=i.getResourceModel;var x=t.event;var R=t.defineUI5Class;var O=t.aggregation;function B(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,L(e,t)}function L(e,t){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(e,t)}function G(e,t,n,i,o){var s={};return Object.keys(i).forEach(function(e){s[e]=i[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function N(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let F=(I=R("sap.fe.macros.messages.MessageButton"),C=O({type:"sap.fe.macros.messages.MessageFilter",multiple:true,singularName:"customFilter"}),E=x(),I(P=(y=function(t){function i(e,n){var i;i=t.call(this,e,n)||this;B(i,"customFilters",M,i);B(i,"messageChange",S,i);i.sGeneralGroupText="";i.sViewId="";i.sLastActionText="";return i}v(i,t);var g=i.prototype;g.init=function e(){s.prototype.init.apply(this);this.attachPress(this.handleMessagePopoverPress,this);this.oMessagePopover=new o;this.oItemBinding=this.oMessagePopover.getBinding("items");this.oItemBinding.attachChange(this._setMessageData,this);const t=this.getId();if(t){this.oMessagePopover.addCustomData(new c({key:"messageButtonId",value:t}))}this.attachModelContextChange(this._applyFiltersAndSort.bind(this));this.oMessagePopover.attachActiveTitlePress(this._activeTitlePress.bind(this))};g.handleMessagePopoverPress=function e(t){this.oMessagePopover.toggle(t.getSource())};g._applyGroupingAsync=async function t(i){const o=[];const s=i.getBindingContext();const r=e=>{const t=[];const i=this.oItemBinding.getContexts().map(function(e){return e.getObject()});const o=e.getBindingContext();if(o){const s=e.getContent()[0];n.getVisibleSectionsFromObjectPageLayout(s).forEach(function(e){e.getSubSections().forEach(function(e){e.findElements(true).forEach(function(n){if(n.isA("sap.ui.mdc.Table")){for(let s=0;s<i.length;s++){const r=n.getRowBinding();if(r){const r=`${o.getPath()}/${n.getRowBinding().getPath()}`;if(i[s].target.indexOf(r)===0){t.push({table:n,subsection:e});break}}}}})})})}return t};const a=r.bind(this)(i);a.forEach(function(e){const t=e.table,n=e.subsection;if(!t.getBindingContext()||t.getBindingContext()?.getPath()!==s?.getPath()){n.setBindingContext(s);if(!t.getRowBinding().isLengthFinal()){o.push(new Promise(function(e){t.getRowBinding().attachEventOnce("dataReceived",function(){e()})}))}}});const g=new Promise(e=>{setTimeout(()=>{this._applyGrouping();e()},0)});try{await Promise.all(o);i.getModel().checkMessages();await g}catch(t){e.error("Error while grouping the messages in the messagePopOver")}};g._applyGrouping=function e(){this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(!this.oObjectPageLayout){return}const t=this.oMessagePopover.getItems();const i=n.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);const o=this._checkControlIdInSections(t,false);if(o){this._fnEnableBindings(i)}const s=this._getViewId(this.getId());const r=u.getElementById(s);const a=r?.getModel("internal");a?.setProperty("/messageTargetProperty",undefined)};g._getTableRefErrorContext=function e(t){const n=t.getModel("internal");if(!t.getBindingContext("internal")?.getProperty("refError")){n.setProperty("refError",{},t.getBindingContext("internal"))}const i=t.getBindingContext("internal")?.getPath()+"/refError/"+t.getBindingContext()?.getPath().replace("/","$")+"$"+t.getRowBinding().getPath().replace("/","$");const o=n.getContext(i);if(!o.getProperty("")){n.setProperty("",{},o)}return o};g._updateInternalModel=function e(t,n,i,o,s,r){let a;if(r){a={rowIndex:"CreationRow",targetColProperty:i?i:""}}else{a={rowIndex:t?n:"",targetColProperty:i?i:""}}const g=o.getModel("internal"),l=this._getTableRefErrorContext(o);const c=d.getMessageModel().getData().map(function(e){return e.getId()});let u;if(l?.getProperty("")){u=Object.keys(l?.getProperty("")).filter(function(e){return c.indexOf(e)===-1});u.forEach(function(e){delete l?.getProperty("")[e]})}g?.setProperty(s.getId(),Object.assign({},l?.getProperty(s.getId())?l.getProperty(s.getId()):{},a),l)};g._setGroupLabelForTransientMsg=function e(t,n){this.sLastActionText=this.sLastActionText?this.sLastActionText:f.getResourceBundleFor("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_LAST_ACTION");t.setGroupName(`${this.sLastActionText}: ${n}`)};g._computeMessageGroupAndSubTitle=function e(t,i,o,s,r,a){const g=w(i);this.oItemBinding.detachChange(this._setMessageData,this);const l=t.getBindingContext("message")?.getObject();const c=true;let f,d,p={},h,T,b,m;const _=new RegExp("^/").test(l?.getTargets()[0]);if(_){for(h=0;h<s.length;h++){f=s[h];b=f;if(f.isA("sap.m.Table")||f.isA("sap.ui.table.Table")){d=f.getParent();const e=d.getRowBinding();const i=()=>{this._setGroupLabelForTransientMsg(t,a)};if(e&&e.isLengthFinal()&&d.getBindingContext()){const o=n.getTableColumnDataAndSetSubtile(l,d,f,e,a,c,i);p=o.oTargetTableInfo;if(o.subTitle){t.setSubtitle(o.subTitle)}t.setActiveTitle(!!p.oTableRowContext&&!p.oTableRowContext?.isInactive()&&p.oTableRowContext.getPath()!==t.getBindingContext("message")?.getProperty("target").replace(/\/$/,""));if(p.oTableRowContext&&!p.oTableRowContext.isInactive()){this._formatMessageDescription(t,p.oTableRowContext,p.sTableTargetColName,d)}T=p.oTableRowContext&&p.oTableRowContext.getIndex();this._updateInternalModel(p.oTableRowContext,T,p.sTableTargetColProperty,d,l)}}else{t.setActiveTitle(true);const e=n.bIsOrphanElement(b,s);if(e){t.setSubtitle("");break}}}}else{b=s[0];d=this._getMdcTable(b);p={};if(d){p.tableHeader=d.getHeader();const e=this._getTableColumnIndex(b);p.sTableTargetColProperty=e!==undefined&&e>-1?d.getColumns()[e].getPropertyKey():undefined;p.sTableTargetColName=p.sTableTargetColProperty&&e!==undefined&&e>-1?d.getColumns()[e].getHeader():undefined;m=this._getTableRow(b)?.isA("sap.ui.table.CreationRow")??false;if(!m){T=this._getTableRowIndex(b);p.oTableRowBindingContexts=d.getRowBinding().getCurrentContexts();p.oTableRowContext=T!==undefined?p.oTableRowBindingContexts[T]:undefined}const i=n.getMessageSubtitle(l,p.oTableRowBindingContexts,p.oTableRowContext,p.sTableTargetColName,d,m,e===0&&b.getValueState()==="Error"?b:undefined);if(i){t.setSubtitle(i)}t.setActiveTitle(!!p.oTableRowContext);if(p.oTableRowContext){this._formatMessageDescription(t,p.oTableRowContext,p.sTableTargetColName,d)}this._updateInternalModel(p.oTableRowContext,T,p.sTableTargetColProperty,d,l,m)}}if(c){const e=this._checkMergeLogicForMessageGrouping(i,o,r);const s=n.createSectionGroupName(i,o,r,p,g,e);t.setGroupName(s);const a=this._getViewId(this.getId());const c=u.getElementById(a);const f=l.getTargets()[0]&&l.getTargets()[0].split("/").pop();const d=c?.getModel("internal");if(d&&d.getProperty("/messageTargetProperty")&&f&&f===d.getProperty("/messageTargetProperty")){this.oMessagePopover.fireActiveTitlePress({item:t});d.setProperty("/messageTargetProperty",false)}}this.oItemBinding.attachChange(this._setMessageData,this);return b};g._checkMergeLogicForMessageGrouping=function e(t,n,i){const o=this._getViewId(this.getId());const s=o?u.getElementById(o):undefined;let r=true;const a=!i&&s?.getViewData()?.sectionLayout==="Page";const g=i&&s?.getViewData()?.sectionLayout==="Tabs";if(a){const e=n.getBlocks();const t=e.length===1?e[0].getAggregation("content"):undefined;if(t?.isA("sap.fe.macros.table.TableAPI")){r=false}}else if(g){let e;const t=n.getBlocks();if(t.length===1&&t[0]?.isA("sap.fe.templates.ObjectPage.controls.SubSectionBlock")){e=t[0].getAggregation("content");if(e?.isA("sap.fe.macros.table.TableAPI")){r=false}else if(e?.isA("sap.ui.layout.DynamicSideContent")){e=e.getMainContent instanceof Function&&e?.getMainContent();if(e&&e.length===1&&e[0]?.isA("sap.fe.macros.table.TableAPI")){r=false}}}}return r};g._checkControlIdInSections=function e(t,i){let o,s,r,a,g,l;this.sGeneralGroupText=this.sGeneralGroupText?this.sGeneralGroupText:f.getResourceBundleFor("sap.fe.core").getText("T_MESSAGE_BUTTON_SAPFE_MESSAGE_GROUP_GENERAL");const c=n.getVisibleSectionsFromObjectPageLayout(this.oObjectPageLayout);if(c){const e=this._getViewId(this.getId());const f=e?u.getElementById(e):undefined;const d=f?.getBindingContext("internal")?.getProperty("sActionName");if(d){(f?.getBindingContext("internal")).setProperty("sActionName",null)}for(a=t.length-1;a>=0;--a){r=t[a];let e=true;for(g=c.length-1;g>=0;--g){let t=false;o=c[g];s=o.getSubSections();for(l=s.length-1;l>=0;--l){const i=s[l];const a=r?.getBindingContext("message")?.getObject();const g=n.getControlFromMessageRelatingToSubSection(i,a);if(g.length>0){const n=this._computeMessageGroupAndSubTitle(r,o,i,g,s.length>1,d);e=false;if(n&&!n.isA("sap.m.Table")&&!n.isA("sap.ui.table.Table")){t=true;break}}}if(t){break}}if(e){const e=r.getBindingContext("message")?.getObject();r.setActiveTitle(false);if(e.persistent&&d){this._setGroupLabelForTransientMsg(r,d)}else{r.setGroupName(this.sGeneralGroupText)}}if(!i&&r.getGroupName()===this.sGeneralGroupText&&this._findTargetForMessage(r)){return true}}}};g._findTargetForMessage=function e(t){const n=t.getBindingContext("message")&&t.getBindingContext("message")?.getObject();if(n&&n.target){const e=this.oObjectPageLayout?.getModel()?.getMetaModel(),t=e&&e.getMetaPath(n.target),i=e&&e.getObject(t);if(i&&i.$kind==="Property"){return true}}return false};g._fnEnableSubSectionBinding=function e(t){t.getBlocks().forEach(e=>e.setBindingContext(undefined));t.getMoreBlocks().forEach(e=>e.setBindingContext(undefined));t.getActions().forEach(e=>e.setBindingContext(undefined))};g._fnEnableBindings=function e(t){for(let e=0;e<t.length;e++){const n=t[e];const i=n.getSubSections();for(let e=0;e<i.length;e++){const t=i[e];const n=t.getBlocks();if(n){this._fnEnableSubSectionBinding(t)}if(t.getBindingContext()){this._findMessageGroupAfterRebinding();t.getBindingContext().getBinding().attachDataReceived(this._findMessageGroupAfterRebinding.bind(this))}}}};g._findMessageGroupAfterRebinding=function e(){const t=this.oMessagePopover.getItems();this._checkControlIdInSections(t,true)};g._getViewId=function e(t){let n,i=u.getElementById(t);while(i){if(i instanceof h){n=i.getId();break}i=i.getParent()}return n};g._setLongtextUrlDescription=function t(n,i){this.oMessagePopover.setAsyncDescriptionHandler(function(t){const o=n;const s=t.item.getLongtextUrl();if(s){jQuery.ajax({type:"GET",url:s,success:function(e){const n=i.getHtmlText()+e;t.item.setDescription(`${o}${n}`);t.promise.resolve()},error:function(){t.item.setDescription(n);const i=`A request has failed for long text data. URL: ${s}`;e.error(i);t.promise.reject(i)}})}})};g.processTableColumnProperties=function e(t,i,o){let s="";const r=n.getTableColBindingContextForTextAnnotation(t,i,o);const a=r?r.getObject("$Path"):undefined;const g=a&&r?r.getObject("@com.sap.vocabularies.UI.v1.TextArrangement/$EnumMember"):undefined;const l=t.getParent()?.getTableColValue(i,a,g,o);s+=`${l}`;return s};g.computeColumnInfo=function e(t,i,o,s){const r=w(s);const a=t.getBindingContext("message")?.getObject();const g=n.fetchColumnInfo(a,s);let l="";if(i){l=`${r.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")}: ${i}`}else if(g){if(g.availability==="Hidden"){if(t.getType()==="Error"){l=o.length>0?`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR")} ${o.join(", ")}`+".":`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC_ERROR")}`+"."}else{l=o.length>0?`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC")} ${o.join(", ")}`+".":`${r.getText("T_COLUMN_AVAILABLE_DIAGNOSIS_MSGDESC")}`+"."}}else{if(!this._navigationConfigured(s)){t.setActiveTitle(false)}l=`${r.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_COLUMN")}: ${g.label} (${r.getText("T_COLUMN_INDICATOR_IN_TABLE_DEFINITION")})`}}return l};g._formatMessageDescription=function e(t,n,i,o){const s=w(o);const r=o.getParent()?.getTableColumnVisibilityInfo(n);const g=[];r?.forEach(e=>{let{key:t,visibility:i}=e;g.push(this.processTableColumnProperties(o,n,[{key:t,visibility:i}]))});const l=this.computeColumnInfo(t,i,g,o);const c=new a({htmlText:`<html><body><strong>${s.getText("T_FIELDS_AFFECTED_TITLE")}</strong></body></html><br>`});let u;if(Array.isArray(g)&&g.length>0){if(g.length===1){u=`${c.getHtmlText()}<br>${s.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${o.getHeader()}<br>${s.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW")}: ${g}<br>${l}<br>`}else{u=`${c.getHtmlText()}<br>${s.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${o.getHeader()}<br>${s.getText("T_MESSAGE_GROUP_DESCRIPTION_TABLE_ROW")}:<br>&emsp; ${g.join("<br>&emsp; ")}<br>${l}<br>`}}else if(l==""||!l){u=""}else{u=`${c.getHtmlText()}<br>${s.getText("T_MESSAGE_GROUP_TITLE_TABLE_DENOMINATOR")}: ${o.getHeader()}<br>${l}<br>`}const f=new a({htmlText:`<html><body><strong>${s.getText("T_DIAGNOSIS_TITLE")}</strong></body></html><br>`});const d=t.getBindingContext("message")?.getObject().description;t.setDescription(undefined);let p="";let h="";if(t.getLongtextUrl()){h=`${u}<br>`;this._setLongtextUrlDescription(h,f)}else if(d){p=`${f.getHtmlText()}<br>${d}`;h=`${u}<br>${p}`;t.setDescription(h)}else{t.setDescription(u)}};g.handleNoMessages=function e(){this.setVisible(false);this.fireEvent("messageChange",{iMessageLength:0});const t=u.getElementById(this.sViewId);if(t){t.getModel("internal").setProperty("/messageTargetProperty",undefined)}};g._setMessageData=function t(){clearTimeout(this._setMessageDataTimeout);this._setMessageDataTimeout=setTimeout(async()=>{const t="",n=this.oMessagePopover.getItems(),i={Error:0,Warning:0,Success:0,Information:0},o=f.getResourceBundleFor("sap.fe.core"),s=n.length;let r=A.Default,a="",g="",l="";if(s>0){for(let e=0;e<s;e++){if(!n[e].getType()||n[e].getType().toString()===""){++i["Information"]}else{++i[n[e].getType()]}}if(i[p.Error]>0){r=A.Negative}else if(i[p.Warning]>0){r=A.Critical}else if(i[p.Success]>0){r=A.Success}else if(i[p.Information]>0){r=A.Neutral}const c=i[p.Error]+i[p.Warning]+i[p.Success]+i[p.Information];this.setText(c.toString());if(i.Error===1){a="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_TITLE_ERROR"}else if(i.Error>1){a="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_MULTIPLE_ERROR_TOOLTIP"}else if(!i.Error&&i.Warning){a="C_COMMON_SAPFE_ERROR_MESSAGES_PAGE_WARNING_TOOLTIP"}else if(!i.Error&&!i.Warning&&i.Information){a="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_INFO"}else if(!i.Error&&!i.Warning&&!i.Information&&i.Success){a="C_MESSAGE_HANDLING_SAPFE_ERROR_MESSAGES_PAGE_TITLE_SUCCESS"}if(a){l=o.getText(a);g=i.Error?`${i.Error} ${l}`:l;this.setTooltip(g)}this.setIcon(t);this.setType(r);this.setVisible(true);const f=u.getElementById(this.sViewId);if(f){const t=f.getController().pageReady;try{await t.waitPageReady();await this._applyGroupingAsync(f)}catch(t){e.error("fail grouping messages")}this.fireEvent("messageChange",{iMessageLength:s})}if(s>1){this.oMessagePopover.navigateBack()}}else{this.handleNoMessages()}},100)};g._activeTitlePress=async function t(n){const i=this.getBindingContext("pageInternal");i.setProperty("errorNavigationSectionFlag",true);const o=n.getParameter("item"),s=o?.getBindingContext("message")?.getObject(),r=new RegExp("^/").test(s.getTargets()[0]),a=u.getElementById(this.sViewId);if(!o){return}let g,c;const f=function(e,t){const n={preventScroll:true,targetInfo:e};t.focus(n)};const d=s.controlIds.map(function(e){const t=u.getElementById(e);const n=t&&t.getParent();return n&&n.isA("sap.ui.mdc.Table")&&o.getGroupName().includes(n.getHeader())?n:null}).reduce(function(e,t){return t?t:e});if(d){if(r){c=o.getGroupName().split(", ")[0];try{await this._navigateFromMessageToSectionTableInIconTabBarMode(d,this.oObjectPageLayout,c);const t=this._getTableRefErrorContext(d);const n=t?.getProperty(o.getBindingContext("message")?.getObject().getId());const i=async(e,t)=>{const n=this._getMdcTableRows(e),i=this._getGridTable(e)?.getFirstVisibleRow()??0;if(n.length>0&&n[0]){const o=n[t-i],r=this.getTargetCell(o,s);if(r){this.setFocusToControl(r);return undefined}else{const t=s.getTargets()[0].split("/").pop();if(t){a.getModel("internal").setProperty("/messageTargetProperty",t)}if(this._navigationConfigured(e)){return a.getController()._routing.navigateForwardToContext(o.getBindingContext())}else{return false}}}return undefined};if(d.data("tableType")==="GridTable"&&n.rowIndex!==""){const t=this._getGridTable(d)?.getFirstVisibleRow()??0;try{await d.scrollToIndex(n.rowIndex);const e=this._getMdcTableRows(d);let o,r;if(e.length>0&&e[0]){o=e[0].getParent().getFirstVisibleRow()??0;r=t-o!==0}let a;if(r){a=new Promise(function(e){l.attachEvent("UIUpdated",e)})}else{a=Promise.resolve()}await a;setTimeout(async function(){const e=await i(d,n.rowIndex);if(e===false){f(s,d)}},0)}catch(t){e.error("Error while focusing on error")}}else if(d.data("tableType")==="ResponsiveTable"&&n){const e=await this.focusOnMessageTargetControl(a,s,d,n.rowIndex);if(e===false){f(s,d)}}else{this.focusOnMessageTargetControl(a,s)}}catch(t){e.error("Fail to navigate to Error control")}}else{g=u.getElementById(s.controlIds[0]);if(g){const e=this.oObjectPageLayout.getSections();const t=e.find(e=>e.findElements(true).includes(g));if(t){c=o.getGroupName().split(", ")[0];this._navigateFromMessageToSectionInIconTabBarMode(this.oObjectPageLayout,c)}}this.setFocusToControl(g)}}else{c=o.getGroupName().split(", ")[0];this._navigateFromMessageToSectionInIconTabBarMode(this.oObjectPageLayout,c);this.focusOnMessageTargetControl(a,s)}};g.getTargetCell=function e(t,n){const i=n.getControlIds();const o=i.some(e=>{const t=u.getElementById(e);return t?.isA("sap.ui.mdc.Field")&&t.getEditable&&!t.getEditable()});return i.length>0?i.map(function(e){const n=t.findElements(true,function(t){return t.getId()===e});if(n.length>0){const t=u.getElementById(e);if(o){if(t?.isA("sap.ui.mdc.Field")){if(t.getEditable&&!t.getEditable()){return null}return t}}else{return t}}return null}).reduce(function(e,t){return t?t:e},null):null};g.focusOnMessageTargetControl=async function e(t,n,i,o){const s=t.findElements(true);const a=n.getControlIds().filter(function(e){return s.some(function(t){return t.getId()===e&&t.getDomRef()})}).map(function(e){return u.getElementById(e)});const g=a.filter(function(e){return!e?.isA("sap.m.Table")&&!e?.isA("sap.ui.table.Table")});if(g.length>0){this.setFocusToControl(g[0]);return undefined}else if(a.length>0){const e=i?i.findElements(true,e=>e.isA(r.getMetadata().getName())&&e.getParent()?.getParent()===i):[];if(e.length>0&&e[0]){const s=e[o];const r=this.getTargetCell(s,n);if(r){const e=r.isA("sap.fe.macros.field.FieldAPI")?r.getContent().getContentEdit()[0]:r.getItems()[0].getContent().getContentEdit()[0];this.setFocusToControl(e);return undefined}else{const e=n.getTargets()[0].split("/").pop();if(e){t.getModel("internal").setProperty("/messageTargetProperty",e)}if(i&&this._navigationConfigured(i)){return t.getController()._routing.navigateForwardToContext(s.getBindingContext())}else{return false}}}return undefined}return undefined};g._getMessageRank=function e(t,n){if(n){let e,i,o,s,r,a,g,l;for(s=n.length-1;s>=0;--s){e=n[s];i=e.getSubSections();for(r=i.length-1;r>=0;--r){o=i[r];g=o.findElements(true);a=g.filter(this._fnFilterUponId.bind(this,t.getControlId()));l=s+1;if(a.length>0){if(e.getVisible()&&o.getVisible()){if(!t.hasOwnProperty("sectionName")){t.sectionName=e.getTitle()}if(!t.hasOwnProperty("subSectionName")){t.subSectionName=o.getTitle()}return l*10+(r+1)}else{return 1}}}}if(!t.sectionName&&!t.subSectionName&&t.getPersistent()){return 1}return 999}return 999};g._filterOutMessagesInDialog=function e(){const t=e=>n.isMessageOutOfParameterDialog(e);return new T({path:"controlIds",test:t,caseSensitive:true})};g._getFilterToHideBackendMessageOnErrorValidation=function e(){const t=function(){return d.getMessageModel().getData().filter(e=>e.validation===true&&e.getControlId()?.match(/field.*-inner$/i)).map(e=>e.getControlId()?.replace("-inner",""))};const n=function(e){return!e.some(e=>t().includes(e))};return new T({filters:[new T({filters:[new T({path:"validation",operator:b.EQ,value1:false}),new T({path:"controlIds",test:n,caseSensitive:true})],and:true}),new T({path:"validation",operator:b.EQ,value1:true})],and:false})};g._applyFiltersAndSort=function e(){let t,n,i,o,s,r,a;const g=[];this.sViewId=this.sViewId?this.sViewId:this._getViewId(this.getId());const l=this.getAggregation("customFilters");if(l){l.forEach(function(e){g.push(new T({path:e.getProperty("path"),operator:e.getProperty("operator"),value1:e.getProperty("value1"),value2:e.getProperty("value2")}))})}const c=this.getBindingContext();if(!c){this.setVisible(false);return}else{o=c.getPath();t=new T({filters:[new T({path:"validation",operator:b.EQ,value1:true}),_.getCheckControlInViewFilter(this.sViewId)],and:true});n=new T({filters:[t,new T({path:"target",operator:b.StartsWith,value1:o})],and:false});r=new T({filters:[this._filterOutMessagesInDialog()]})}const u=new T({filters:[n,r,this._getFilterToHideBackendMessageOnErrorValidation()],and:true});if(g.length>0){i=new T({filters:[g,u],and:false})}else{i=u}this.oItemBinding.filter(i);this.oObjectPageLayout=this._getObjectPageLayout(this,this.oObjectPageLayout);if(this.oObjectPageLayout){s=new m("",undefined,undefined,(e,t)=>{if(!a){a=this.oObjectPageLayout&&this.oObjectPageLayout.getSections()}const n=this._getMessageRank(e,a);const i=this._getMessageRank(t,a);if(n<i){return-1}if(n>i){return 1}return 0});this.oItemBinding.sort(s)}};g._fnFilterUponId=function e(t,n){return t===n.getId()};g._getSectionBySectionTitle=function e(t,n){let i;if(n){const e=t.getSections();for(let t=0;t<e.length;t++){if(e[t].getVisible()&&e[t].getTitle()===n){i=e[t];break}}}return i};g._navigateFromMessageToSectionInIconTabBarMode=function e(t,n){const i=t.getUseIconTabBar();if(i){const e=this._getSectionBySectionTitle(t,n);const i=t.getSelectedSection();if(e&&i!==e.getId()){t.setSelectedSection(e.getId())}}};g._navigateFromMessageToSectionTableInIconTabBarMode=async function e(t,n,i){const o=t.getRowBinding();const s=t.getBindingContext();const r=n.getBindingContext();const a=!(s===r);this._navigateFromMessageToSectionInIconTabBarMode(n,i);return new Promise(function(e){if(a){o.attachEventOnce("change",function(){e()})}else{e()}})};g._getMdcTable=function e(t){let n=t.getParent();while(n&&!n.isA("sap.ui.mdc.Table")){n=n.getParent()}return n&&n.isA("sap.ui.mdc.Table")?n:undefined};g._getGridTable=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Table")&&e.getParent()===t})[0]};g._getTableRow=function e(t){let n=t.getParent();while(n&&!n.isA("sap.ui.table.Row")&&!n.isA("sap.ui.table.CreationRow")&&!n.isA(r.getMetadata().getName())){n=n.getParent()}return n&&(n.isA("sap.ui.table.Row")||n.isA("sap.ui.table.CreationRow")||n.isA(r.getMetadata().getName()))?n:undefined};g._getTableRowIndex=function e(t){const n=this._getTableRow(t);let i;if(n?.isA("sap.ui.table.Row")){i=n.getIndex()}else{i=n?.getTable?.().getItems().findIndex(function(e){return e.getId()===n?.getId()})}return i??-1};g._getTableColumnIndex=function e(t){const n=function(e,t){return t?.getCells().findIndex(function(t){return t.getId()===e.getId()})};const i=function(e,t){let i=e.getParent(),o=n(i,t);while(i&&o&&o<0){i=i.getParent();o=n(i,t)}return o};const o=this._getTableRow(t);let s=i(t,o);if(o?.isA("sap.ui.table.CreationRow")){const e=s?o.getCells()[s].getId():undefined,t=o.getTable()?.getColumns();s=t?.findIndex(function(t){if(t.getCreationTemplate()&&e){return e.search(t.getCreationTemplate().getId())>-1?true:false}else{return false}})}return s};g._getMdcTableRows=function e(t){return t.findElements(true,function(e){return e.isA("sap.ui.table.Row")&&e.getTable?.().getParent()===t})};g._getObjectPageLayout=function e(t,n){if(n){return n}let i=t;while(i&&!i.isA("sap.uxap.ObjectPageLayout")){i=i.getParent()??undefined}return i};g._navigationConfigured=function e(t){const n=sap.ui.require("sap/ui/core/Component"),i=t&&n.getOwnerComponentFor(t)&&n.getOwnerComponentFor(t).getNavigation();let o=false,s=false;if(i&&Object.keys(i).includes(t.getRowBinding().getPath())){o=i[t?.getRowBinding().getPath()]&&i[t?.getRowBinding().getPath()].detail&&i[t?.getRowBinding().getPath()].detail.route?true:false}s=o&&t?.getRowSettings().getRowActions()&&t?.getRowSettings().getRowActions()[0].getType().includes("Navigation");return s};g.setFocusToControl=function t(n){const i=this.oMessagePopover;if(i&&n&&n.focus){const e=()=>{n.focus()};if(!i.isOpen()){setTimeout(e,0)}else{const t=()=>{setTimeout(e,0);i.detachEvent("afterClose",t)};i.attachEvent("afterClose",t);i.close()}}else{e.warning("FE V4 : MessageButton : element doesn't have focus method for focusing.")}};g.escape=function e(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};return i}(s),M=G(y.prototype,"customFilters",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),S=G(y.prototype,"messageChange",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),y))||P);return F},false);
//# sourceMappingURL=MessageButton.js.map