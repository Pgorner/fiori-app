/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/table/Utils","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/m/Select","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/fe/base/jsx-runtime/jsx"],function(t,e,n,i,r,o,a,s,l,c,u,g,f,h,d,p){"use strict";var b,m,y,C,S,v,P,I,B,T,x,F,w;var A={};var O=l.getTargetObjectPath;var j=l.getTargetNavigationPath;var z=l.enhanceDataModelPath;var E=s.isAnnotationOfType;var M=a.generate;var k=o.getInvolvedDataModelObjects;var K=n.property;var L=n.event;var $=n.defineUI5Class;var D=e.pathInModel;var _=e.notEqual;function q(t,e,n,i){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function U(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Q(t,e)}function Q(t,e){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Q(t,e)}function N(t,e,n,i,r){var o={};return Object.keys(i).forEach(function(t){o[t]=i[t]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,i){return i(t,e,n)||n},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(t,e,o),null):o}function H(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let R=(b=$("sap.fe.macros.table.QuickFilterSelector"),m=K({type:"string"}),y=K({type:"string",required:true}),C=K({type:"string"}),S=K({type:"object"}),v=L(),b(P=(I=function(e){function n(t,n){var i;i=e.call(this,t,n)||this;q(i,"id",B,i);q(i,"metaPath",T,i);q(i,"contextPath",x,i);q(i,"filterConfiguration",F,i);q(i,"selectionChange",w,i);return i}A=n;U(n,e);var r=n.prototype;r.onMetadataAvailable=function t(){if(!this.content){this.initializeContent()}};r.onSelChange=function t(e){this.fireEvent("selectionChange",e.getParameters())};r.getSegmentedButtonSelector=function t(e){const n=this.filterConfiguration.paths.map((t,n)=>p(g,{...this.getSelectorItemProperties(n,e)}));return p(u,{id:`${this.id}-content`,enabled:_(D("hasPendingFilters","pageInternal"),true),ariaLabelledBy:[this.getSelectorAriaLabelledById()],selectionChange:this.onSelChange.bind(this),children:{items:n}})};r.getSelectSelector=function t(e){const n=this.filterConfiguration.paths.map((t,n)=>p(d,{...this.getSelectorItemProperties(n,e)}));return p(f,{id:`${this.id}-content`,enabled:_(D("hasPendingFilters","pageInternal"),true),ariaLabelledBy:[this.getSelectorAriaLabelledById()],autoAdjustWidth:true,change:this.onSelChange.bind(this),children:{items:n}})};r.getSelectorItemProperties=function t(e,n){return{key:this.filterConfiguration.paths[e].annotationPath,text:this.getSelectorItemText(e,n)}};r.getSelectorAriaLabelledById=function t(){return M([`${this.id}-content`,"AriaText"])};r.getSelectorItemText=function t(e,n){const i=` ({internal>quickFilters/counts/${e}})`;const r=k(n);const o=z(r,this.filterConfiguration.paths[e].annotationPath).targetObject;const a=o?.Text?.toString()??"";return`${a}${this.filterConfiguration.showCounts?i:""}`};r.registerSideEffectForQuickFilter=function t(e,n){const i=k(e,n);const r=i.contextLocation?.targetEntityType.fullyQualifiedName;const o=j(i,true);const a=this.filterConfiguration.paths.map(t=>t.annotationPath);if(o&&r){const t=new Set;for(const e of a){const n=z(i,e).targetObject;if(n.SelectOptions&&E(n,"com.sap.vocabularies.UI.v1.SelectionVariantType")){n.SelectOptions.forEach(e=>{const n=e.PropertyName?.value;if(n){const e=z(i,n);t.add(O(e,true))}})}}this.getAppComponent().getSideEffectsService().addControlSideEffects(r,{sourceProperties:Array.from(t),targetEntities:[{$NavigationPropertyPath:o}],sourceControlId:`${this.id}-content`})}};r.getAccessibilityControl=function t(){const e=`{sap.fe.i18n>M_TABLE_QUICKFILTER_ARIA}`;const n=p(h,{text:e,id:this.getSelectorAriaLabelledById()});n.toStatic();return n};r.initializeContent=function t(){const e=this.getMetaPathObject(this.metaPath);if(e){const t=this._getOwner()?.getMetaModel();const n=t?.createBindingContext(e.getPath());const i=t?.createBindingContext(e.getContextPath());if(!n||!i){return}if(this.filterConfiguration.showCounts){this.registerSideEffectForQuickFilter(n,i)}const r=this.filterConfiguration.paths.length>3?this.getSelectSelector(n):this.getSegmentedButtonSelector(n);r.addDependent(this.getAccessibilityControl());this.content=r}};r.getMDCTable=function t(){if(!this.mdcTable){let t=this.content;while(t&&!t.isA("sap.ui.mdc.Table")){t=t.getParent()}this.mdcTable=t;return this.mdcTable}else{return this.mdcTable}};r.getSelectedKey=function t(){return this.content?.getSelectedKey()||this.content?.getItems()[0].getKey()||""};r.setSelectedKey=function t(e){this.content?.setSelectedKey(e)};r.setCountsAsLoading=function t(){const e={};const n=this.getBindingContext("internal");for(const t in this.content?.getItems()){e[t]="..."}n.setProperty("quickFilters",{counts:e})};r.refreshSelectedCount=function t(){const e=this.getMDCTable().getRowBinding().getCount();if(this.filterConfiguration?.showCounts===true&&e!==undefined){const t=this.content?.getItems().findIndex(t=>t.getKey()===this.getSelectedKey());if(t!==undefined&&t>-1){this.getBindingContext("internal")?.setProperty(`quickFilters/counts/${t}`,c.getCountFormatted(e))}}};r.refreshUnSelectedCounts=async function e(){if(!this.content){return Promise.resolve()}const n=this.getMDCTable();const r=this.content.getItems();const o=this.getBindingContext("internal");const a=this.getPageController();const s=a.getChartControl?.();const l=s?.getParent();const u=async t=>{const e=t.getKey();const a=i.getFiltersFromAnnotation(n,e);const s=await c.getListBindingForCount(n,n.getBindingContext(),{batchGroupId:"$auto",additionalFilters:[...f,...a]});const l=r.findIndex(t=>t.getKey()===e);if(l>-1){o.setProperty(`quickFilters/counts/${l}`,c.getCountFormatted(s))}};const g=l?.hasSelections()&&l?.getFilter();const f=c.getHiddenFilters(n);if(g){f.push(g)}const h=r.filter(t=>t.getKey()!==this.getSelectedKey()).map(async t=>u(t));try{await Promise.all(h)}catch(e){t.error("Error while retrieving the binding promises",e)}};return n}(r),B=N(I.prototype,"id",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),T=N(I.prototype,"metaPath",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),x=N(I.prototype,"contextPath",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),F=N(I.prototype,"filterConfiguration",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),w=N(I.prototype,"selectionChange",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),I))||P);A=R;return A},false);
//# sourceMappingURL=QuickFilterSelector.js.map