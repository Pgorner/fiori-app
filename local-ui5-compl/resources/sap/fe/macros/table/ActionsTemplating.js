/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/Common/table/StandardActions","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/CommonHelper","sap/fe/macros/TSXUtils","sap/fe/macros/table/TableFullScreenButton","sap/fe/macros/table/TableHelper","sap/m/Button","sap/m/Menu","sap/m/MenuButton","sap/m/MenuItem","sap/m/OverflowToolbarLayoutData","sap/m/library","sap/m/upload/ActionsPlaceholder","sap/ui/mdc/actiontoolbar/ActionToolbarAction","../internal/helpers/ActionHelper","./BasicSearch","sap/fe/base/jsx-runtime/jsx"],function(e,t,n,i,a,o,d,s,r,l,c,u,b,f,m,p,x,M,v,A,h,C,g){"use strict";var T={};var D=M.MenuButtonMode;var y=l.createCustomData;var P=s.generate;var F=o.StandardActionKeys;var E=a.ButtonType;var B=i.isDataFieldForIntentBasedNavigation;var I=i.isDataFieldForAction;var O=i.isActionWithDialog;var _=t.ActionType;var S=e.pathInModel;var j=e.notEqual;var N=e.equal;var k=e.compileExpression;var H=e.and;function L(e,t,i,a,o,d,s){if(!i.annotationPath){return undefined}const l=r.getActionContext(a.metaPath.getModel().createBindingContext(i.annotationPath+"/Action"));const c=a.metaPath.getModel().createBindingContext(l);const b=c?n.getInvolvedDataModelObjects(c,d):undefined;const f=e.ActionTarget?.isBound;const m=e.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false;const x=!o?i.command:i.command+"::ContextMenu";const M=o?"ContextMenu":"ActionMenu";const v=i.command?undefined:s.getDataFieldForActionButtonPressHandler(e,i,t,o);const A=i.command?`cmd:${x}|press`:undefined;const h=i.enabled!==undefined?i.enabled:u.isDataFieldForActionEnabled(a.tableDefinition,e.Action,!!f,c.getObject(),i.enableOnSelect,b?.targetEntityType,o);if(f!==true||m){const n=P([a.id,i.key,t.key,M,e,"MenuItemForAction"]);return g(p,{text:e.Label,id:n,press:v,"jsx:command":A,enabled:h,visible:i.visible,children:{customData:[y("actionId",n)]}})}else{return undefined}}function w(e,t,n){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let a=arguments.length>4?arguments[4]:undefined;let o=arguments.length>5?arguments[5]:undefined;let d=arguments.length>6?arguments[6]:undefined;const s=t.command?undefined:d.getDataFieldForIBNPressHandler(t,i);const r=t.command?`cmd:${t.command}|press`:undefined;const l=t.enabled!==undefined?t.enabled:u.isDataFieldForIBNEnabled({collection:a,tableDefinition:n.tableDefinition},e,e.RequiresContext,e.NavigationAvailable,i);const c=i?P([n.id,t.key,o.key,e,"MenuItemIntentBasedNavigation","ContextMenu"]):P([n.id,t.key,o.key,e,"MenuItemIntentBasedNavigation"]);return g(p,{text:e.Label,id:c,press:s,"jsx:command":r,enabled:l,visible:t.visible,children:{customData:[!e.RequiresContext?y("IBNData",`{semanticObject: '${e.SemanticObject}' , action : '${e.Action}'}`):undefined,y("actionId",c)]}})}function U(e,t,n,i,a,o){const d=t.annotationPath?n.convertedMetadata.resolvePath(t.annotationPath).target:undefined;switch(d&&t.type){case"ForAction":if(I(d)){if(!i||i&&u.isActionShownInContextMenu(t,n.contextObjectPath)){return L(d,e,t,n,i,a,o)}}break;case"ForNavigation":if(B(d)&&(!i||i&&u.isActionShownInContextMenu(t,n.contextObjectPath))){return w(d,t,n,i,a,e,o)}break;default:}const s=!i?t.command:t.command+"::ContextMenu";const r=t.command?undefined:o.getManifestActionPressHandler(t,i);const l=t.command?`cmd:${s}|press`:undefined;const c=!i?t.enabled:t.enabledForContextMenu;const b=i?"ContextMenu":"ActionMenu";const f=P([n.id,t.key,b,e.key,d,"MenuItem"]);return g(p,{"core:require":"{FPM: 'sap/fe/core/helpers/FPMHelper'}",text:t?.text,id:f,press:r,"jsx:command":l,visible:t.visible,enabled:c,children:{customData:[y("actionId",f)]}})}function $(e,t,i,a,o,d){const s=i.metaPath.getModel().createBindingContext(t.annotationPath+"/Action");const l=r.getActionContext(s);const c=i.metaPath.getModel().createBindingContext(l);const f=c?n.getInvolvedDataModelObjects(c,o):undefined;const m=e.ActionTarget?.isBound;const x=!a?t.command:t.command+"::ContextMenu";const M=t.command?undefined:d.getDataFieldForActionButtonPressHandler(e,t,undefined,a);const v=t.command?`cmd:${x}|press`:undefined;const A=t.enabled!==undefined?t.enabled:u.isDataFieldForActionEnabled(i.tableDefinition,e.Action,!!m,c.getObject(),t.enableOnSelect,f?.targetEntityType,a);if(!a){const n=P([i.id,e]);return g(b,{id:n,text:e.Label,ariaHasPopup:O(e),press:M,"jsx:command":v,type:E.Transparent,enabled:A,visible:t.visible,children:{customData:[y("actionId",n)]}})}else{const n=P([i.id,e,"ContextMenu"]);return g(p,{id:n,text:e.Label,press:M,"jsx:command":v,enabled:A,visible:t.visibleForContextMenu,children:{customData:[y("actionId",n)]}})}}function R(e,t,n,i,a,o){const d=!i?t.command:t.command+"::ContextMenu";const s=t.command?undefined:o.getDataFieldForIBNPressHandler(t,i);const r=t.command?`cmd:${d}|press`:undefined;const l=t.enabled!==undefined?t.enabled:u.isDataFieldForIBNEnabled({collection:a,tableDefinition:n.tableDefinition},e,e.RequiresContext,e.NavigationAvailable,i);const c=!e.RequiresContext?"{semanticObject: '"+e.SemanticObject+"' , action : '"+e.Action+"'}":undefined;if(!i){const i=P([n.id,e]);return g(b,{id:i,text:e.Label,press:s,"jsx:command":r,type:E.Transparent,enabled:l,visible:t.visible,children:{customData:[y("IBNData",c),y("actionId",i)]}})}else{const i=P([n.id,e,"ContextMenu"]);return g(p,{id:i,text:e.Label,press:s,"jsx:command":r,enabled:l,visible:t.visibleForContextMenu,children:{customData:[y("IBNData",c),y("actionId",i)]}})}}function q(e,t,n,i,a){const o=e.annotationPath?t.convertedMetadata.resolvePath(e.annotationPath).target:undefined;let d;if(!o){return undefined}switch(e.type){case"ForAction":if(I(o)){const s=o.ActionTarget?.isBound;const r=o.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false;if(!n||u.isActionShownInContextMenu(e,t.contextObjectPath)){if(s!==true||r){d=$(o,e,t,n,i,a)}}}break;case"ForNavigation":if(B(o)&&(!n||u.isActionShownInContextMenu(e,t.contextObjectPath))){d=R(o,e,t,n,i,a)}break;default:}if(d===undefined){return undefined}if(!n){return g(A,{id:P([t.id,e.id,o,"ActionToolbarAction"]),"dt:designtime":e.visible==="true"||e.visible==="false"?undefined:"not-adaptable-visibility",children:{action:d}})}else{return d}}function V(e,t,n){if(!e||!t){return{}}try{switch(e.type){case"ForAction":return{handler:n.getDataFieldForActionButtonPressHandler(t,e,undefined,false)};case"ForNavigation":return{handler:n.getDataFieldForIBNPressHandler(e,false)};default:{if(e.command){return{command:`cmd:${e.command}|defaultAction`}}else{return{handler:n.getManifestActionPressHandler(e,false)}}}}}catch(e){return{}}}function W(e,t,n,i,a){if(!n){const o=e.defaultAction;const d=o?.annotationPath?t.convertedMetadata.resolvePath(o.annotationPath).target:undefined;const s=V(o,d,a);const r=e.menu?.filter(e=>typeof e!=="string").map(o=>U(e,o,t,n,i,a)).filter(e=>e!==undefined);if(r?.length){const n=P([t.id,e.id]);return g(A,{id:P([t.id,e.id,"ActionToolbarAction"]),"dt:designtime":e.visible==="true"||e.visible==="false"?undefined:"not-adaptable-visibility",children:g(m,{text:e.text,type:E.Transparent,menuPosition:"BeginBottom",id:n,visible:e.visible,enabled:e.enabled,useDefaultActionOnly:!!e.defaultAction,buttonMode:e.defaultAction?D.Split:D.Regular,defaultAction:s.handler,"jsx:command":s.command,children:{customData:[y("actionId",n)],menu:g(f,{children:r})}})})}else{return undefined}}else{const o=[];e.menu?.forEach(e=>{if(typeof e!=="string"&&u.isActionShownInContextMenu(e,t.contextObjectPath)){o?.push(e)}});const d=o.filter(e=>typeof e!=="string").map(o=>U(e,o,t,n,i,a)).filter(e=>e!==undefined);if(d?.length){return g(p,{text:e.text,id:P([t.id,e.id,"ContextMenu"]),visible:e.visibleForContextMenu,enabled:e.enabled,children:{items:d}})}else{return undefined}}}function X(e,t,n,i){const a=!n?e.command:e.command+"::ContextMenu";const o=e.command?undefined:i.getManifestActionPressHandler(e,n);const d=e.command?`cmd:${a}|press`:undefined;if(!n){return g(A,{id:P([t.id,e.id,"ActionToolbarAction"]),"dt:designtime":e.visible==="true"||e.visible==="false"?undefined:"not-adaptable-visibility",children:g(b,{"core:require":"{FPM: 'sap/fe/core/helpers/FPMHelper'}",id:P([t.id,e.id]),text:e.text,press:o,"jsx:command":d,type:E.Transparent,visible:e.visible,enabled:e.enabled,children:{customData:[y("actionId",P([t.id,e.id]))]}})})}else if(u.isActionShownInContextMenu(e,t.contextObjectPath)){const n=P([t.id,e.id,"ContextMenu"]);return g(p,{"core:require":"{FPM: 'sap/fe/core/helpers/FPMHelper'}",id:n,text:e.text,press:o,"jsx:command":d,visible:e.visibleForContextMenu,enabled:e.enabledForContextMenu,children:{customData:[y("actionId",n)]}})}else{return undefined}}function G(e,t,n,i,a){switch(e.type){case"Default":if("noWrap"in e){return X(e,t,n,a)}break;case"Menu":return W(e,t,n,i,a);default:}return q(e,t,n,i,a)}function K(e,t,i,a,o){const d=e.annotationPath?t.convertedMetadata.resolvePath(e.annotationPath).target:undefined;const s=r.getActionContext(t.metaPath.getModel().createBindingContext(e.annotationPath+"/Action"));const l=d?.ActionTarget?.annotations?.Core?.OperationAvailable!==undefined;const c=t.metaPath.getModel().createBindingContext(s);const f=c?n.getInvolvedDataModelObjects(c,a):undefined;const m=d?.ActionTarget?.isBound;const x=d?o.getDataFieldForActionButtonPressHandler(d,e,undefined,i):undefined;const M=l?u.isDataFieldForActionEnabled(t.tableDefinition,d.Action,!!m,c.getObject(),e.enableOnSelect,f?.targetEntityType,i,true):`{= ${h.getNumberOfContextsExpression("single",i)}}`;if(!i){return g(A,{id:P([t.id,d,"ActionToolbarAction"]),"dt:designtime":e.visible==="true"||e.visible==="false"?undefined:"not-adaptable-visibility",children:g(b,{id:P([t.id,d]),text:e.text,press:x,type:E.Transparent,visible:e.visible,enabled:M,children:{customData:[y("actionId",P([t.id,d]))]}})})}else{return g(p,{id:P([t.id,d,"ContextMenu"]),text:e.text,press:x,visible:e.visibleForContextMenu,enabled:k(N(S("contextmenu/numberOfSelectedContexts","internal"),1)),children:{customData:[y("actionId",P([t.id,d,"ContextMenu"]))]}})}}function z(e,t,n,i){const a=i.name;const o=t.getTranslatedText("M_COMMON_TABLE_CREATE",undefined,a);const d=t.tableDefinition.annotation.create.outboundDetail;if(t.tableDefinition.control.enableUploadPlugin){return g(v,{id:`${t.id}-uploadButton`,placeholderFor:"UploadButtonPlaceholder"})}else if(!n){return g(A,{id:P([t.id,e.key,"ActionToolbarAction"]),"dt:designtime":"not-adaptable-tree",children:g(b,{id:P([t.id,e.key]),text:o,"jsx:command":"cmd:Create|press",type:E.Transparent,visible:e.visible,enabled:e.enabled,children:{customData:y("IBNData",u.getIBNData(d))}})})}else{return g(p,{id:P([t.id,e.key,"ContextMenu"]),text:o,"jsx:command":"cmd:Create::ContextMenu|press",visible:e.visible,enabled:e.enabledForContextMenu})}}function J(e,t,n,i,a){const o=n.name;const d=t.getTranslatedText("M_COMMON_TABLE_CREATE",undefined,o);const s=t.tableDefinition.control.nodeType.values;const r=t.tableDefinition.control.createEnablement!==undefined;const l=s.map((e,n)=>{const o=!i?"":"contextmenu/";const d=r?j(S(`${o}createEnablement/Create_${n}`,"internal"),false):undefined;const s=i?P([t.id,e.value,"ContextMenu"]):P([t.id,e.value]);return g(p,{id:s,text:e.text,enabled:d?k(d):undefined,press:a.getCreateMenuItemPressHandler(n,i)})});if(i){return g(p,{id:P([t.id,e.key,"ContextMenu"]),text:d,visible:e.visible,enabled:e.enabledForContextMenu,children:{items:l!==undefined&&l.length>0?l:undefined}})}return g(A,{id:P([t.id,e.key,"ActionToolbarAction"]),"dt:designtime":"not-adaptable-tree",children:g(m,{text:d,type:E.Transparent,menuPosition:"BeginBottom",id:P([t.id,e.key]),visible:e.visible,enabled:e.enabled,children:{customData:[y("actionId",P([t.id,e.key]))],menu:g(f,{children:l})}})})}function Q(e,t,n,i){const a=i.name;const o=t.getTranslatedText("M_COMMON_TABLE_DELETE",undefined,a);if(!n){return g(A,{id:P([t.id,e.key,"ActionToolbarAction"]),"dt:designtime":"not-adaptable-tree",children:g(b,{id:P([t.id,e.key]),text:o,"jsx:command":"cmd:DeleteEntry|press",type:E.Transparent,visible:e.visible,enabled:e.enabled,ariaHasPopup:"Dialog"})})}else{return g(p,{id:P([t.id,e.key,"ContextMenu"]),text:o,"jsx:command":"cmd:DeleteEntry::ContextMenu|press",visible:e.visible,enabled:e.enabledForContextMenu})}}function Y(e,t,n,i,a){if(e.isTemplated==="false"){return undefined}switch(e.key){case F.Create:if(!t.tableDefinition.annotation.isInsertUpdateActionsTemplated||t.tableDefinition.control.type!=="TreeTable"&&n){return undefined}else if(t.tableDefinition.control.nodeType){return J(e,t,a,n,i)}else{return z(e,t,n,a)}case F.Delete:return Q(e,t,n,a);case F.Cut:return ne(e,t,n);case F.Paste:return ae(e,t,n);case F.MassEdit:if(t.tableDefinition.annotation.isInsertUpdateActionsTemplated){if(!n){return g(A,{id:P([t.id,e.key,"ActionToolbarAction"]),"dt:designtime":"not-adaptable-tree",children:g(b,{id:P([t.id,e.key]),text:"{sap.fe.i18n>M_COMMON_TABLE_MASSEDIT}",press:i.getMassEditButtonPressHandler(false),visible:e.visible,enabled:e.enabled})})}else{return g(p,{id:P([t.id,e.key,"ContextMenu"]),text:"{sap.fe.i18n>M_COMMON_TABLE_MASSEDIT}",press:i.getMassEditButtonPressHandler(true),visible:e.visibleForContextMenu,enabled:e.enabledForContextMenu})}}return undefined;case F.Insights:if(!n){return g(A,{id:P([t.id,e.key,"ActionToolbarAction"]),"dt:designtime":e.visible==="true"||e.visible==="false"?undefined:"not-adaptable-visibility",visible:e.visible,children:g(b,{id:P([t.id,e.key]),text:"{sap.fe.i18n>M_COMMON_INSIGHTS_CARD}",press:i.addCardToInsightsPress,visible:e.visible,enabled:e.enabled,children:{layoutData:g(x,{priority:"AlwaysOverflow"})}})})}return undefined;case F.MoveUp:case F.MoveDown:return ie(e,t,n);default:return undefined}}function Z(e,t,n,i,a){return e.tableDefinition.actions.map(o=>{switch(o.type){case _.Standard:return Y(o,e,t,n,a);case _.Copy:return K(o,e,t,i,n);default:return G(o,e,t,i,n)}}).filter(e=>e!==undefined)}T.getActions=Z;function ee(e,t,n,i){if(e){return g(A,{id:P([t,"ActionToolbarAction"]),label:"{sap.fe.i18n>M_BASIC_SEARCH}","dt:designtime":"not-adaptable-tree",children:{action:g(C,{id:t,useDraftEditState:n,visible:i})}})}return undefined}function te(e){if(e.tableDefinition.control.enableFullScreen){return g(A,{id:P([e.id,"StandardAction","FullScreen","ActionToolbarAction"]),"dt:designtime":"not-adaptable-tree",children:{action:g(c,{id:P([e.id,"StandardAction","FullScreen"])})}})}return undefined}function ne(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!n){return g(A,{id:P([t.id,"Cut","ActionToolbarAction"]),"dt:designtime":"not-adaptable-tree",children:g(b,{id:P([t.id,"Cut"]),text:"{sap.fe.i18n>M_TABLE_CUT}","jsx:command":"cmd:Cut|press",visible:e.visible,enabled:e.enabled})})}else{return g(p,{id:P([t.id,"Cut","ContextMenu"]),text:"{sap.fe.i18n>M_TABLE_CUT}","jsx:command":"cmd:Cut::ContextMenu|press",visible:e.visible,enabled:e.enabledForContextMenu})}}function ie(e,t,n){const i=e.key===F.MoveUp;if(!n){return g(A,{id:P([t.id,e.key,"ActionToolbarAction"]),visible:e.visible,"dt:designtime":"not-adaptable-tree",children:g(b,{id:P([t.id,e.key]),text:i?"{sap.fe.i18n>M_TABLE_MOVE_UP}":"{sap.fe.i18n>M_TABLE_MOVE_DOWN}","jsx:command":i?"cmd:TableMoveElementUp|press":"cmd:TableMoveElementDown|press",visible:e.visible,enabled:e.enabled})})}else{return g(p,{id:P([t.id,e.key,"ContextMenu"]),text:i?"{sap.fe.i18n>M_TABLE_MOVE_UP}":"{sap.fe.i18n>M_TABLE_MOVE_DOWN}","jsx:command":i?"cmd:TableMoveElementUp::ContextMenu|press":"cmd:TableMoveElementDown::ContextMenu|press",visible:e.visible,enabled:e.enabledForContextMenu})}}function ae(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;const i=t.tableDefinition.control.type;if(i==="TreeTable"){if(!n){return g(A,{id:P([t.id,"Paste","ActionToolbarAction"]),"dt:designtime":"not-adaptable-tree",children:g(b,{id:P([t.id,"Paste"]),text:"{sap.fe.i18n>M_PASTE}","jsx:command":"cmd:Paste|press",visible:e.visible,enabled:e.enabled})})}else{return g(p,{id:P([t.id,"Paste","ContextMenu"]),text:"{sap.fe.i18n>M_PASTE}","jsx:command":"cmd:Paste::ContextMenu|press",visible:e.visible,enabled:e.enabledForContextMenu})}}return undefined}function oe(e,t,n,i){const a=d.isDraftNode(i)||d.isDraftRoot(i);let o;if(e.isSearchable===false){o=false}else{o=e.tableDefinition.annotation.searchable}const s=[];const r=ee(!!e.useBasicSearch,e.filterBar,a,o);if(r){s.push(r)}s.push(...Z(e,false,t,n,i));const l=te(e);if(l){s.push(l)}return s}T.getTableActionsTemplate=oe;function de(e,t,n,i){const a=Z(e,true,t,n,i);if(e.tableDefinition.control.type==="TreeTable"){a.push(se(e,true,t.expandNode));a.push(se(e,false,t.collapseNode))}return a}T.getTableContextMenuTemplate=de;function se(e,t,n){const i=t?H(N(S("contextmenu/isExpandable","internal"),true),N(S("contextmenu/numberOfSelectedContexts","internal"),1)):H(N(S("contextmenu/isCollapsable","internal"),true),N(S("contextmenu/numberOfSelectedContexts","internal"),1));return g(p,{id:P([e.id,t?"Expand":"Collapse","ContextMenu"]),text:t?"{sap.fe.i18n>M_TABLE_CONTEXTMENU_EXPAND}":"{sap.fe.i18n>M_TABLE_CONTEXTMENU_COLLAPSE}",press:n,enabled:i})}return T},false);
//# sourceMappingURL=ActionsTemplating.js.map