/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/helpers/FPMHelper","sap/fe/macros/field/FieldTemplating","../CommonHelper","./TableHelper","./TableRuntime"],function(e,t,n,o,i,a,r){"use strict";var s={};var l=o.formatValueRecursively;var c=t.isPathInModelExpression;var d=t.isConstant;var u=t.getExpressionFromAnnotation;var b=t.compileExpression;const h=10;let g=function(){function t(e,t,n){this.tableBlockProperties=e;this.collectionEntity=t;this.tableAPI=n;this.metaModel=e.metaPath?.getModel();if(n){this.constructorWithFunctions(n)}else{this.constructorWithStrings()}}s=t;var o=t.prototype;o.constructorWithStrings=function e(){const t=this.tableBlockProperties.tableDefinition?.control?.type;this.addCardToInsightsPress="API.onAddCardToInsightsPressed($event, $controller)";this.beforeExport="API.onBeforeExport($event)";this.beforeOpenContextMenu="API.onContextMenuPress($event)";this.collapseNode=t==="TreeTable"?"API.onCollapseExpandNode($event, false)":undefined;this.contextMenuItemSelected="TableRuntime.onContextMenuItemSelected";const n=this.tableBlockProperties.tableDefinition?.annotation.row?.navigationInfo;if(n!==undefined){if(n.type==="Outbound"){this.contextMenuOpenInNewTab=`.onOpenInNewTabNavigateOutBound('${n.navigationTarget}', %{internal>contextmenu/selectedContexts}, "", ${h})`}else{this.contextMenuOpenInNewTab=`API.onOpenInNewTabPress($event, $controller, %{internal>contextmenu/selectedContexts}, { callExtension: true, targetPath: '${n.targetPath}', navMode: 'openInNewTab' }, ${h})`}}this.dataStateChange="API.onDataStateChange";if(this.tableBlockProperties.tableDefinition?.control?.hasDataStateIndicatorFilter){this.dataStateIndicatorFilter="TableRuntime.dataStateIndicatorFilter"}this.displayTableSettings="TableRuntime.displayTableSettings";this.dragStartDocument=t==="TreeTable"?"API.onDragStartDocument":undefined;this.dragEnterDocument=t==="TreeTable"?"API.onDragEnterDocument":undefined;this.dropDocument=t==="TreeTable"?"API.onDropDocument":undefined;this.expandNode=t==="TreeTable"?"API.onCollapseExpandNode($event, true)":undefined;this.quickFilterSelectionChange="API.onQuickFilterSelectionChange";if(this.tableBlockProperties.rowPressHandlerPath){this.rowPress=this.tableBlockProperties.rowPressHandlerPath}else if(n!==undefined){if(n.type==="Outbound"){this.rowPress=`API.onChevronPressNavigateOutBound($event, $controller ,'${n.navigationTarget}', \${$parameters>bindingContext})`}else{const e=n.checkEditable?"!${$parameters>bindingContext}.getProperty('IsActiveEntity')":"undefined";const t=n.recreateContext?", recreateContext: true":"";this.rowPress=`API.onTableRowPress($event, $controller, \${$parameters>bindingContext}, { callExtension: true, targetPath: '${n.targetPath}', editable: ${e} ${t} })`}}this.segmentedButtonPress=this.tableBlockProperties.onSegmentedButtonPressedHandlerPath;this.selectionChange="TableRuntime.setContexts";this.tableContextChange=t==="TreeTable"?`TableRuntime.onTreeTableContextChanged($event, ${this.tableBlockProperties.tableDefinition?.annotation?.initialExpansionLevel})`:undefined;this.variantSaved=this.tableBlockProperties.variantSavedHandlerPath;this.variantSelected=this.tableBlockProperties.variantSelectedHandlerPath};o.constructorWithFunctions=function e(t){const n=this.tableBlockProperties.tableDefinition?.control?.type;this.addCardToInsightsPress=t.onAddCardToInsightsPressed.bind(t);this.beforeExport=t.onBeforeExport.bind(t);this.beforeOpenContextMenu=t.onContextMenuPress.bind(t);this.collapseNode=n==="TreeTable"?e=>{t.onCollapseExpandNode(e,false)}:undefined;this.contextMenuItemSelected=r.onContextMenuItemSelected.bind(r);const o=this.tableBlockProperties.tableDefinition?.annotation.row?.navigationInfo;if(o!==undefined){if(o.type==="Outbound"){this.contextMenuOpenInNewTab=e=>{const n=t.getPageController();const i=t.getBindingContext("internal");n?.onOpenInNewTabNavigateOutBound?.(o.navigationTarget,i?.getProperty("contextmenu/selectedContexts"),"",h)}}else{this.contextMenuOpenInNewTab=e=>{const n=t.getPageController();const i=t.getBindingContext("internal");t.onOpenInNewTabPress(e,n,i?.getProperty("contextmenu/selectedContexts"),{callExtension:true,targetPath:o.targetPath,navMode:"openInNewTab"},h)}}}this.dataStateChange=t.onDataStateChange.bind(t);if(this.tableBlockProperties.tableDefinition?.control?.hasDataStateIndicatorFilter){this.dataStateIndicatorFilter=t.dataStateIndicatorFilter.bind(t)}this.displayTableSettings=r.displayTableSettings.bind(r);this.dragStartDocument=n==="TreeTable"?t.onDragStartDocument.bind(t):undefined;this.dragEnterDocument=n==="TreeTable"?t.onDragEnterDocument.bind(t):undefined;this.dropDocument=n==="TreeTable"?t.onDropDocument.bind(t):undefined;this.expandNode=n==="TreeTable"?e=>{t.onCollapseExpandNode(e,true)}:undefined;this.quickFilterSelectionChange=t.onQuickFilterSelectionChange.bind(t);if(t.rowPress){this.rowPress=t.rowPress}else if(o!==undefined){if(o.type==="Outbound"){this.rowPress=e=>{const n=t.getPageController();const i=e;t.onChevronPressNavigateOutBound(e,n,o.navigationTarget,i.getParameter("bindingContext"))}}else{this.rowPress=e=>{const n=e;const i=o.checkEditable?!n.getParameter("bindingContext").getProperty("IsActiveEntity"):undefined;const a={callExtension:true,targetPath:o.targetPath,editable:i,recreateContext:o.recreateContext};const r=t.getPageController();t.onTableRowPress(e,r,n.getParameter("bindingContext"),a)}}}this.segmentedButtonPress=t.segmentedButtonPress;this.selectionChange=r.setContexts.bind(r);this.tableContextChange=n==="TreeTable"?e=>{r.onTreeTableContextChanged(e,this.tableBlockProperties.tableDefinition?.annotation?.initialExpansionLevel)}:undefined;this.variantSaved=t.variantSaved;this.variantSelected=t.variantSelected};o.getCreateButtonPressHandler=function e(t,n){if(this.tableAPI){return n?r.onCreateButtonPress.bind(r):e=>{const n=this.tableAPI.getBindingContext("internal");const o=t?"contextmenu/selectedContexts":"selectedContexts";r.onCreateButtonPress(e,n?.getProperty(o))}}else if(!n){return t?"TableRuntime.onCreateButtonPress($event, ${internal>contextmenu/selectedContexts})":"TableRuntime.onCreateButtonPress($event, ${internal>selectedContexts})"}else{return"TableRuntime.onCreateButtonPress($event)"}};o.getCreateMenuItemPressHandler=function e(t,n){const o=n?"contextmenu/selectedContexts":"selectedContexts";if(this.tableAPI){return e=>{r.onCreateMenuItemPress(e,t,this.tableAPI.getBindingContext("internal")?.getProperty(o))}}else{return`TableRuntime.onCreateMenuItemPress($event, ${t}, \${internal>${o}})`}};o.getCutHandler=function e(t){if(this.tableAPI){return e=>{this.tableAPI.onCut(e,t)}}else{return`API.onCut($event, ${t})`}};o.getDataFieldForActionButtonPressHandler=function e(t,n,o,r){if(!t){return undefined}const s=n.annotationPath?i.getActionContext(this.metaModel.createBindingContext(n.annotationPath+"/Action")):undefined;const l=s?this.metaModel.createBindingContext(s):undefined;if(this.tableAPI){const e=t.Action;const i=this.tableBlockProperties.contextObjectPath.targetEntityType.fullyQualifiedName;const s=typeof l?.getObject()!=="string"&&(a._isStaticAction(l?.getObject(),e)||a._isActionOverloadOnDifferentType(e.toString(),i));const c=!r?"aApplicable":"aApplicableForContextMenu";const d=!r?"aNotApplicable":"aNotApplicableForContextMenu";const u=!r?"":"contextmenu/";return e=>{const i=this.tableAPI.getBindingContext("internal");const a={contexts:!s?i.getProperty(`${u}selectedContexts`):null,bStaticAction:s?s:undefined,entitySetName:this.collectionEntity.name,applicableContexts:!s?i.getProperty(`dynamicActions/${t.Action}/${c}/`):null,notApplicableContexts:!s?i.getProperty(`dynamicActions/${t.Action}/${d}/`):null,isNavigable:(o??n).isNavigable,enableAutoScroll:n.enableAutoScroll,defaultValuesExtensionFunction:n.defaultValuesExtensionFunction,invocationGrouping:t?.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",controlId:this.tableBlockProperties.id,operationAvailableMap:this.tableBlockProperties.tableDefinition.operationAvailableMap,label:t.Label?.valueOf()??"",model:this.tableAPI.getPageController().getModel()};this.tableAPI?.onActionPress(e,this.tableAPI.getPageController(),t.Action.valueOf(),a)}}else{return a.pressEventDataFieldForActionButton({contextObjectPath:this.tableBlockProperties.contextObjectPath,id:this.tableBlockProperties.id},t,this.collectionEntity.name,this.tableBlockProperties.tableDefinition.operationAvailableMap,l?.getObject(),(o??n).isNavigable,n.enableAutoScroll,n.defaultValuesExtensionFunction,r)}};o.getDataFieldForIBNPressHandler=function e(t,n){if(t.annotationPath===undefined){return undefined}const o=this.metaModel.createBindingContext(t.annotationPath);const a=o?.getObject();if(!a){return undefined}const r=this.tableBlockProperties.tableDefinition.enableAnalytics!==true;if(this.tableAPI){return e=>{const t=this.tableAPI.getBindingContext("internal");const o={};o.navigationContexts=n?t.getProperty("contextmenu/selectedContexts"):t.getProperty("selectedContexts");if(a.RequiresContext&&!a.Inline&&r){const e=!n?"aApplicable":"aApplicableForContextMenu";const i=!n?"aNotApplicable":"aNotApplicableForContextMenu";o.applicableContexts=t.getProperty(`ibn/${a.SemanticObject}-${a.Action}/${e}/`);o.notApplicableContexts=t.getProperty(`ibn/${a.SemanticObject}-${a.Action}/${i}/`);o.label=a.Label}o.semanticObjectMapping=a.Mapping;const i=this.tableAPI.getPageController();if(r){i?._intentBasedNavigation.navigateWithConfirmationDialog(a.SemanticObject,a.Action,o,e.getSource())}else{i?._intentBasedNavigation.navigate(a.SemanticObject,a.Action,o,e.getSource())}}}else{return i.getPressHandlerForDataFieldForIBN(a,n?"${internal>contextmenu/selectedContexts}":"${internal>selectedContexts}",r,n)}};o.getExpressionForDataFieldValue=function e(t,n){const o=t?.Value;if(!o){return undefined}if(typeof o==="string"){return this.tableAPI?o:i.addSingleQuotes(o,true)}else{const e=u(o);if(d(e)||c(e)){const t=l(e,n);return b(t)}}};o.getDeleteButtonPressHandler=function e(t){const n=(this.collectionEntity?.entityType||this.collectionEntity?.targetType)?.annotations?.UI?.HeaderInfo;const o=!t?"":"contextmenu/";const a=`${o}deletableContexts`;const r=`${o}selectedContextsIncludingInactive`;const s=!t?`numberOfSelectedContexts`:`${o}numberOfSelectedContextsForDelete`;const l=`${o}unSavedContexts`;const c=`${o}lockedContexts`;const d=`${o}draftsWithDeletableActive`;const u=`${o}draftsWithNonDeletableActive`;const b=this.getExpressionForDataFieldValue(n?.Title,this.tableBlockProperties.contextObjectPath);const h=this.getExpressionForDataFieldValue(n?.Description,this.tableBlockProperties.contextObjectPath);if(this.tableAPI){return e=>{const t=this.tableAPI.getBindingContext("internal");const n={id:this.tableBlockProperties.id,entitySetName:this.collectionEntity.name,numberOfSelectedContexts:t?.getProperty(s),unSavedContexts:t?.getProperty(l),lockedContexts:t?.getProperty(c),draftsWithDeletableActive:t?.getProperty(d),draftsWithNonDeletableActive:t?.getProperty(u),controlId:t?.getProperty("controlId"),title:b,description:h,selectedContexts:t?.getProperty(r)};this.tableAPI.getPageController()?.editFlow.deleteMultipleDocuments(t?.getProperty(a),n)}}else{const e={id:i.addSingleQuotes(this.tableBlockProperties.id),entitySetName:i.addSingleQuotes(this.collectionEntity.name),numberOfSelectedContexts:`\${internal>${s}}`,unSavedContexts:`\${internal>${l}}`,lockedContexts:`\${internal>${c}}`,draftsWithDeletableActive:`\${internal>${d}}`,draftsWithNonDeletableActive:`\${internal>${u}}`,controlId:"${internal>controlId}",title:b,description:h,selectedContexts:`\${internal>${r}}`};return i.generateFunction(".editFlow.deleteMultipleDocuments",`\${internal>${a}}`,i.objectToString(e))}};o.getManifestActionPressHandler=function t(o,a){if(this.tableAPI){if(o.noWrap===true){throw new Error("Slot actions are not supported yet in new mode")}else{return t=>{const i=a?"contextmenu/selectedContexts":"selectedContexts";const r=this.tableAPI.getBindingContext("internal");n.actionWrapper(t,o.handlerModule,o.handlerMethod,{contexts:r.getProperty(i)}).catch(t=>{e.error("Error while executing custom action",t)})}}}else{return o.noWrap===true?o.press:i.buildActionWrapper(o,{id:this.tableBlockProperties.id},a)}};o.getMassEditButtonPressHandler=function e(t){if(this.tableAPI){return e=>{this.tableAPI.onMassEditButtonPressed(e,t)}}else{return`API.onMassEditButtonPressed($event, ${t})`}};o.getMoveUpDownHandler=function e(t,n){if(this.tableAPI){return e=>{this.tableAPI.onMoveUpDown(e,t,n)}}else{return`API.onMoveUpDown($event, ${t}, ${n})`}};o.getPasteHandler=function e(t){if(this.tableAPI){const e=this.tableAPI.getPageController();return n=>{this.tableAPI.onPaste(n,e,t)}}else{return`API.onPaste($event, $controller, ${t})`}};return t}();s=g;return s},false);
//# sourceMappingURL=TableEventHandlerProvider.js.map