/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/controls/Any","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/field/Field","sap/fe/macros/table/massEdit/library","sap/m/Select","sap/ui/core/Item","sap/ui/mdc/enums/FieldEditMode","../../field/FieldRuntimeHelper","sap/fe/base/jsx-runtime/jsx"],function(e,t,i,r,s,n,o,p,l,a){"use strict";var h={};var d=s.SpecificSelectKeys;var f=e.isConstant;var u=e.compileExpression;var c=e.compileConstant;let y=function(){function e(e,t){this.isValid=true;this.properties=e;this.context=t;this.context=t;this.select=this.createSelect();this.field=this.createField();this.postConfiguration()}h=e;var s=e.prototype;s.getControls=function e(){const t=[this.select];if(this.field){t.push(this.field)}return t};s.getFieldValues=function e(){const t=this.select.getSelectedKey();const i=this.properties.selectItems.find(e=>t===e.key);const r={};let s="";let n="";const o=this.field?.getBindingContext()?.getProperty(this.properties.propertyInfo.relativePath);if(!this.select.getParent()?.getVisible()||!i){return{}}switch(i.key){case d.ClearFieldValueKey:s=this.getFormattedValue(o);break;case d.ReplaceKey:if(this.field){const e=this.properties.propertyInfo.unitPropertyPath?this.field.getBindingContext()?.getProperty(this.properties.propertyInfo.unitPropertyPath):undefined;const t=this.properties.selectItems.find(t=>this.properties.propertyInfo.unitPropertyPath&&t.propertyValue===o&&t.unitValue===e||!this.properties.propertyInfo.unitPropertyPath&&t.text===o);const i=t?.propertyValue??o;const r=t?.unitValue??e;if(i===null&&r===null){return{}}s=this.getFormattedValue(i);n=r}break;case d.KeepKey:return{};default:if(this.properties.inputType==="CheckBox"){s=this.getFormattedValue(i.key)}else{return{}}break}r[this.properties.propertyInfo.relativePath]=s;if(this.properties.propertyInfo.unitPropertyPath){r[this.properties.propertyInfo.unitPropertyPath]=n}return r};s.postConfiguration=async function e(){if(this.field){await this.field.contentCreated;this.field.setVisible(false);this.field.attachEvent("onChange",this.handleFieldChange.bind(this))}};s.isReadOnlyOnContext=function e(i){const r=this.properties.readOnlyExpression;let s=false;if(f(r)){s=c(r,false,undefined,true)}else{const e=new t({anyBoolean:u(r)});e.setModel(i.getModel());e.setBindingContext(i);s=e.getBinding("anyBoolean")?.getExternalValue();e.destroy()}return s};s.getFormattedValue=function e(t){if(this.properties.inputType==="CheckBox"){return t==="true"}if(!t&&this.field?.getBindingContext()){if(this.properties.propertyInfo.unitPropertyPath){return 0}if(this.properties.propertyInfo.nullable){return t}this.field.setValue("");return this.field.getValue()}return t};s.createField=function e(){if(this.properties.inputType!=="CheckBox")return a(r,{contextPath:this.context,metaPath:this.properties.propertyInfo.relativePath,id:i.generate(["MED_",this.properties.propertyInfo.key,"_Field"]),editMode:p.Editable,vhIdPrefix:"FieldValueHelp"})};s.handleFieldChange=function e(t){this.isValid=!!l.getFieldStateOnChange(t).state["validity"]};s.isFieldValid=function e(){return this.isValid};s.createSelect=function e(){return a(n,{id:i.generate(["MED_",this.properties.propertyInfo.key]),items:this.properties.selectItems.map(e=>a(o,{text:e.text},e.key)),required:this.properties.isFieldRequired,change:this.handleSelectionChange.bind(this),width:"100%",ariaLabelledBy:[i.generate(["MED_",this.properties.propertyInfo.key,"Label"])]})};s.handleSelectionChange=function e(){const t=this.select.getSelectedItem();if(this.field&&t){this.isValid=true;const e=this.field.getBindingContext();const i=t.getKey();let r;this.field.setVisible(![d.KeepKey,d.ClearFieldValueKey].includes(t.getKey()));if(!(i in d)){r=this.properties.selectItems.find(e=>e.key===i);this.select.setSelectedKey(d.ReplaceKey)}if(e){const t=this.properties.propertyInfo.unitPropertyPath;e.setProperty(this.properties.propertyInfo.relativePath,this.properties.descriptionPath?r?.text:r?.propertyValue);if(t){e.setProperty(t,r?.unitValue)}}}};return e}();h=y;return h},false);
//# sourceMappingURL=MassEditField.js.map