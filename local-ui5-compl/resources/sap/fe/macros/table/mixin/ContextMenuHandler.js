/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/ActionRuntime","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/StableIdHelper","sap/m/MenuItem","sap/ui/fl/util/ManagedObjectModel","../TableRuntime"],function(t,e,n,o,i,s){"use strict";var a={};var c=n.generate;let u=function(){function n(){this.contextMenuActive=false}a=n;var u=n.prototype;u.setupMixin=function t(e){};u.alignContextMenuWithTableToolbarChanges=function t(e){const n=e.getContextMenu();const o=[];const i=e.getActions();i?.forEach(t=>{const i=t.getAggregation("action");if(this._isActionSplit(i)){this._splitActionsInContextMenu(i,n)}if(this._isActionCombined(i)){this._combineActionInContextMenu(i,n,e)}const s=this._getCorrespondingContextMenuAction(i,n);if(s){this._alignTextAndVisiblityInContextMenu(i,s,t);o.push(s)}});if(o.length){o.forEach((t,e)=>{const o=n.indexOfItem(t);if(o!==e){n.removeItem(t);n.insertItem(t,e)}})}};u._isActionCombined=function t(e){if(e.getMetadata().getName()==="sap.m.MenuButton"){const t=e.getDependents();const n=t.filter(t=>t instanceof i);return n.some(t=>t.getName().includes("$sap.m.flexibility.MenuButtonModel"))}return false};u._combineActionInContextMenu=function t(e,n,o){const i=n.getItems();const s=this._findOrCreateMenuButtonInContextMenu(e,o);const a=e.getMenu().getItems();for(const t of a){const o=t;for(const t of i){const i=t.data("actionId");const a=o.data("actionId");if(i===a+"::ContextMenu"||i===a.replace("::ActionMenu","::ContextMenu")){t.setText(o.getText());n.removeItem(t);s.addItem(t)}if(t.getItems().length>0&&!t.getId().includes(e.getId())){const e=this._findActionInSubMenu(t.getItems(),o);if(e){e.setText(o.getText());s.addItem(e);if(t.getItems().length===0){t.destroy()}}}}}};u._findActionInSubMenu=function t(e,n){for(const t of e){if(t.data("actionId")===n.data("actionId").replace("::ActionMenu","::ContextMenu")||t.data("actionId")===n.data("actionId")+"::ContextMenu"){const n=t;e.splice(e.indexOf(t),1);return n}}return undefined};u._findOrCreateMenuButtonInContextMenu=function t(e,n){const i=n.getContextMenu();const s=i.getItems();for(const t of s){if(t.getId().includes(e.getId())){return t}}const a=new o({id:c([n.getId(),e.getId(),"::ContextMenu"]),text:e.getText()});i.addItem(a);return a};u._splitActionsInContextMenu=function t(e,n){const o=n.getItems();for(let t=0;t<o.length;t++){if(o[t].getItems().length>0){if(o[t].getItems().some(t=>t.data("actionId")===e.data("actionId").replace("::ActionMenu","::ContextMenu"))){const e=o[t];const i=e.getItems();n.removeItem(e);i.forEach((e,o)=>{n.insertItem(e,t+o)})}}}};u._getCorrespondingContextMenuAction=function t(e,n){const o=n.getItems();for(const t of o){if(e.getId()+"::ContextMenu"===t.getId()||t.data("actionId")===e.data("actionId")?.replace("::ActionMenu","::ContextMenu")){return t}if(t.getId().includes(e.getId())){return t}}return null};u._alignTextAndVisiblityInContextMenu=function t(e,n,o){n.setText(e.getText());const i=e.getVisible()&&o.getVisible();if(i!==n.getVisible()){n.setVisible(i)}};u._isActionSplit=function t(e){if(e.getMetadata().getName()==="sap.m.MenuButton"){return false}const n=e.getDependents();const o=n.filter(t=>t instanceof i);return o.some(t=>t.getName()==="$sap.m.flexibility.SplitButtonsModel")};u.setContextMenuActive=function t(e){this.contextMenuActive=e};u.isContextMenuActive=function t(){return this.contextMenuActive};u._onContextMenuPress=function n(o){const i=o.getSource(),a=i.getSelectedContexts(),c=o.getParameter("bindingContext"),u=this.getBindingContext("internal");const r=this.getRelevantSelection(a,c);let l=true;l=r.some(t=>!t.isInactive());u?.setProperty("contextmenu/inactiveContext",!l);const d=r.filter(function(t){return!t.isInactive()});u?.setProperty("contextmenu/selectedContexts",d);u?.setProperty("contextmenu/numberOfSelectedContexts",d.length);u?.setProperty("contextmenu/numberOfSelectedContextsForDelete",r.length);if(d.length>0){this.alignContextMenuWithTableToolbarChanges(i)}const f=i.getContextMenu();const g=f.getItems();const m=g.filter(t=>t.getVisible());if(m.length===0){o.preventDefault()}const x=r.some(t=>t.isExpanded()!==undefined);const p=r.some(t=>t.isExpanded());u?.setProperty("contextmenu/isExpandable",x);u?.setProperty("contextmenu/isCollapsable",p);u?.setProperty("controlId",i.getId());e.updateDeleteInfoForSelectedContexts(u,r,true);if(!i.data("enableAnalytics")){const t=i?.data("navigationAvailableMap");s.setIntentBasedNavigationEnablement(u,t,d,true)}const I=i?.data("updatablePropertyPath");const M=i?.data("draft");const C=i.data("displayModePropertyBinding")==="true"&&M!=="undefined";const b=[];for(const t of d){if(s.isUpdatableContext(I,t,C)){b.push(t)}}u?.setProperty("contextmenu/updatableContexts",b);const h=this.getTableDefinition();if(h.control.createEnablement&&r.length===1){s._updateCreateEnablement(u,h.control.createEnablement,i,r[0],h.control.nodeType,true)}s.updateCutPasteEnablement(u.getObject(),i,true);s.updateMoveUpDownEnablement(u.getObject(),i,true);const A=i?.data("operationAvailableMap").customData;t.setActionEnablement(u,JSON.parse(A),d,"table",true)};u.getRelevantSelection=function t(e,n){let o;if(e.includes(n)){o=e}else{o=[n]}return o};return n}();a=u;return a},false);
//# sourceMappingURL=ContextMenuHandler.js.map