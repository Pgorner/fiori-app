/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/helpers/ResourceModelHelper","sap/ui/core/Lib"],function(t,e,o){"use strict";var r={};var n=e.getLocalizedText;let i=function(){function e(){}r=e;var i=e.prototype;i.setupMixin=function t(e){this.downloadUrl=undefined;this.tableBindingInfo=undefined};i.setTableBindingInfo=function t(e){this.tableBindingInfo=e};i.setDownloadUrl=async function e(){this.downloadUrl=undefined;if(this.getTableDefinition().enableAnalytics===true){return}let o;const r=this.getContent();try{const t=r.getPropertyHelper();let e=[];for(const o of r.getColumns()){e=e.concat(t.getColumnExportSettings(o))}const n={};const i=this.getDataModelObjectForMetaPath(this.metaPath,this.contextPath)?.targetEntityType.keys.map(t=>t.name);const a=e.map(t=>Array.isArray(t.property)?t.property.join(","):t.property);i?.forEach(t=>{if(!a.includes(t)){a.push(t)}});const s=this.getTableDefinition().requestAtLeast;s?.forEach(t=>{if(!a.includes(t)){a.push(t)}});n["$select"]=a.join(",");if(this.tableBindingInfo?.parameters?.$search){n.$search=this.tableBindingInfo.parameters.$search}if(this.tableBindingInfo?.parameters?.$$aggregation){n.$$aggregation=this.tableBindingInfo.parameters.$$aggregation}const l=r.getRowBinding();const p=l.getModel().bindList(l.getPath(),l.getContext(),this.tableBindingInfo?.sorter,this.tableBindingInfo?.filters,n);o=await p.requestDownloadUrl();p.destroy()}catch(e){t.debug("Error while computing the download URL for the export",e)}if(o){this.downloadUrl=o}};i._onBeforeExport=function t(o){const r=o.getParameter("userExportSettings")?.splitCells===true;const n=o.getSource(),i=o.getParameter("exportSettings"),a=this.getTableDefinition();e.updateExportSettings(i,a,n,r)};e.updateExportSettings=function t(e,r,i,a){const s=r.columns;this.setStaticSizeLimit(r,e);const l=e.workbook.columns;for(let t=l.length-1;t>=0;t--){const e=l[t];const r=o.getResourceBundleFor("sap.fe.macros");e.label=n(e.label,i);this.translateBooleanValueForExport(e,r);if(a){this.setExportConfig(s,l,t);this.addTargetValueColumn(s,l,r,t)}}const p=i.getParent().downloadUrl;if(p){e.dataSource.dataUrl=p}return e};e.setStaticSizeLimit=function t(e,o){if(!e.enableAnalytics&&(e.control.type==="ResponsiveTable"||e.control.type==="GridTable")){o.dataSource.sizeLimit=e.control.exportRequestSize??1e3}};e.translateBooleanValueForExport=function t(e,o){if(e.type==="Boolean"){e.falseValue=o.getText("no");e.trueValue=o.getText("yes")}};e.setExportConfig=function t(e,o,r){const n=e.find(t=>!t.propertyInfos&&t.relativePath===o[r].property.toString());if(n?.exportSettings){const t=["scale","delimiter","format","utc","type","inputFormat"];for(const e of t){if(n.exportSettings[e]){o[r]={...o[r],...{[e]:n.exportSettings[e]}};if(o[r].type==="Currency"){o[r].type="Number"}}}}};e.addTargetValueColumn=function t(e,o,r,n){const i=e?.find(t=>{if(!this.isPropertyFromExport(t,o[n])){return false}return this.columnWithTargetValueToBeAdded(t,o[n])});if(i){const t={label:r.getText("TargetValue"),property:Array.isArray(o[n].property)?o[n].property:[o[n].property],template:i.exportDataPointTargetValue};o.splice(n+1,0,t)}};e.isPropertyFromExport=function t(e,o){if(e.relativePath===o.property||o.property.includes(e.relativePath)||o.property.includes(e.name)){return true}if(e.propertyInfos?.length===1&&o.property[0]===e.propertyInfos[0]){return true}return false};e.columnWithTargetValueToBeAdded=function t(e,o){let r=false;if(e.exportDataPointTargetValue&&e.propertyInfos?.length===1){delete o.template;r=true}return r};return e}();r=i;return r},false);
//# sourceMappingURL=TableExport.js.map