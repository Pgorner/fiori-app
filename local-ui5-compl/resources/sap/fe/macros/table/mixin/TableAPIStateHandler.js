/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/controllerextensions/viewState/IViewStateContributorMixin","sap/ui/core/Element","sap/ui/mdc/p13n/StateUtil"],function(t,e,i,n){"use strict";function a(t){return new Promise((e,i)=>{sap.ui.require([t],i=>{if(!(i&&i.__esModule)){i=i===null||!(typeof i==="object"&&t.endsWith("/library"))?{default:i}:i;Object.defineProperty(i,"__esModule",{value:true})}e(i)},t=>{i(t)})})}var r={};function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}let s=function(e){function l(){return e.apply(this,arguments)||this}r=l;o(l,e);var s=l.prototype;s.retrieveState=async function t(){const e={};e.innerTable=this.getControlState(await n.retrieveExternalState(this.content));const i=this.getQuickFilter();if(i){const t=i.getSelectedKey();if(!e.quickFilter){e.quickFilter={}}e.quickFilter.selectedKey=t}const a=this.content.getVariant()?.getId();if(a){const t=this.content.getVariant();if(!e.variantManagement){e.variantManagement={variantId:t?.getCurrentVariantKey()}}else{e.variantManagement.variantId=t?.getCurrentVariantKey()}}return e};s.setInitialState=async function e(){try{const t=await n.retrieveExternalState(this.content);this.initialControlState=t}catch(e){t.error(e)}};s.applyLegacyState=async function t(e,i,n){const a=this.content;const r=a.getVariant();const o=this.getQuickFilter();const l=e(a);const s=r?e(r):null;const c=o?.content?e(o.content):null;const u={};if(l){u.innerTable={...u.innerTable,...l,fullState:{...u.innerTable?.fullState,...l.fullState},initialState:{...u.innerTable?.initialState,...l.initialState}}}if(s?.variantId){u.variantManagement={...u.variantManagement,variantId:s.variantId.toString()}}if(c?.selectedKey){u.quickFilter={...u.quickFilter,selectedKey:c.selectedKey.toString()}}if(u&&Object.keys(u).length>0){await this.applyState(u,i,n)}};s.applyState=async function e(r,o,l){if(!r)return;await this.content.initialized();const s=r?.innerTable;const c=r?.variantManagement?.variantId;const u=this.content?.getVariant();const f=r?.quickFilter?.selectedKey;const p=this.getQuickFilter();if(c!==undefined&&c!==u.getCurrentVariantKey()){const e=this.content?.getVariant();const i=e?.getVariants();const n=i?.some(t=>t.getKey()===c)?c:e?.getStandardVariantKey;try{const t=(await a("sap/ui/fl/apply/api/ControlVariantApplyAPI")).default;await t.activateVariant({element:e,variantReference:n});await this.setInitialState()}catch(e){t.error(e);await this.setInitialState()}}else{await this.setInitialState()}let y;if(s){if(l&&s.initialState){if(!s.initialState.supplementaryConfig){s.initialState.supplementaryConfig={}}y=await n.diffState(this.content,s.initialState,s.fullState)}else{if(r&&!r?.supplementaryConfig){r.supplementaryConfig={}}y=s.fullState}await n.applyExternalState(this.content,y)}if(f&&f!==p?.getSelectedKey()){p?.setSelectedKey(f);this.onQuickFilterSelectionChange()}if(this.initialLoad&&this.filterBar){const e=i.getElementById(this.filterBar);if(e&&e.isA("sap.fe.macros.filterBar.FilterBarAPI")){e.waitForInitialState().then(()=>{this.content.rebind();return}).catch(()=>{t.error("Error while waiting for initial state of filter bar")})}}};return l}(e);r=s;return r},false);
//# sourceMappingURL=TableAPIStateHandler.js.map