{"version":3,"names":["TableOptimisticBatch","_exports","_proto","prototype","setupMixin","_baseClass","optimisticBatchEnablerPromise","undefined","setupOptimisticBatch","table","getContent","tableDelegate","awaitControlDelegate","filterBar","UI5Element","getElementById","getFilter","getParent","attachEvent","searchEvent","tableAPI","controller","getPageController","controllerExtension","extension","isA","includes","getParameter","setOptimisticBatchPromiseForModel","enableOptimisticBatchMode","e","internalBindingContext","getBindingContext","setProperty","setOptimisticBatchEnablerPromise","optimisticBatchEnablerPromiseObject","getOptimisticBatchEnablerPromise","isOptimisticBatchDisabled","getTableDefinition","control","disableRequestCache"],"sourceRoot":".","sources":["TableOptimisticBatch.ts"],"sourcesContent":["import { type IInterfaceWithMixin } from \"sap/fe/base/ClassSupport\";\nimport type PromiseKeeper from \"sap/fe/core/helpers/PromiseKeeper\";\nimport type FETableDelegate from \"sap/fe/macros/table/delegates/TableDelegate\";\nimport type ListReportController from \"sap/fe/templates/ListReport/ListReportController.controller\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type Control from \"sap/ui/core/Control\";\nimport UI5Element from \"sap/ui/core/Element\";\nimport { type ITableBlock } from \"../TableAPI\";\n\nexport default class TableOptimisticBatch implements IInterfaceWithMixin {\n\tprivate optimisticBatchEnablerPromise?: PromiseKeeper<boolean>;\n\n\tsetupMixin(_baseClass: Function): void {\n\t\tthis.optimisticBatchEnablerPromise = undefined;\n\t}\n\n\tasync setupOptimisticBatch(this: ITableBlock): Promise<void> {\n\t\tconst table = this.getContent();\n\t\tif (!table) {\n\t\t\treturn;\n\t\t}\n\n\t\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n\t\tconst tableDelegate = (await table?.awaitControlDelegate()) as typeof FETableDelegate;\n\t\tconst filterBar = UI5Element.getElementById(table?.getFilter()) as Control | undefined;\n\t\tif (filterBar && filterBar.getParent) {\n\t\t\tfilterBar.getParent()?.attachEvent(\"search\", (searchEvent: UI5Event<{ reason: string }>) => {\n\t\t\t\tconst tableAPI = table.getParent() as ITableBlock;\n\t\t\t\tconst controller = tableAPI.getPageController()!;\n\t\t\t\tconst controllerExtension = controller.extension;\n\t\t\t\tif (\n\t\t\t\t\tcontroller &&\n\t\t\t\t\tcontroller.isA(\"sap.fe.templates.ListReport.ListReportController\") &&\n\t\t\t\t\tcontrollerExtension === undefined &&\n\t\t\t\t\t![\"Go\", \"Enter\"].includes(searchEvent.getParameter(\"reason\"))\n\t\t\t\t) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\ttableDelegate?.setOptimisticBatchPromiseForModel(controller as ListReportController, tableAPI);\n\t\t\t\t\t\ttableDelegate?.enableOptimisticBatchMode(controller as ListReportController, table);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// An exception will be thrown when the user clicks go and the table data has already been loaded\n\t\t\t\t\t\t// (setOptimisticBatchPromiseForModel is not supposed to be called once a batch has already been sent)\n\t\t\t\t\t\t// We just ignore this exception\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst internalBindingContext = table.getBindingContext(\"internal\");\n\t\t\t\tinternalBindingContext?.setProperty(\"searchFired\", true);\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Setter for the optimisticBatchEnablerPromise property.\n\t * @param optimisticBatchEnablerPromiseObject The Promise that is to be resolved by the V4 model\n\t */\n\tsetOptimisticBatchEnablerPromise(optimisticBatchEnablerPromiseObject: PromiseKeeper<boolean>): void {\n\t\tthis.optimisticBatchEnablerPromise = optimisticBatchEnablerPromiseObject;\n\t}\n\n\t/**\n\t * Getter for the optimisticBatchEnablerPromise property.\n\t * @returns The optimisticBatchEnablerPromise property.\n\t */\n\tgetOptimisticBatchEnablerPromise(): PromiseKeeper<boolean> | undefined {\n\t\treturn this.optimisticBatchEnablerPromise;\n\t}\n\n\t/**\n\t * Method to know if ListReport is configured with Optimistic batch mode disabled.\n\t * @returns Is Optimistic batch mode disabled\n\t */\n\tisOptimisticBatchDisabled(this: ITableBlock): boolean {\n\t\treturn this.getTableDefinition().control.disableRequestCache || false;\n\t}\n}\n"],"mappings":";;;;;;;;MASqBA,oBAAoB;IAAA,SAAAA,qBAAA;IAAAC,QAAA,GAAAD,oBAAA;IAAA,IAAAE,MAAA,GAAAF,oBAAA,CAAAG,SAAA;IAAAD,MAAA,CAGxCE,UAAU,GAAV,SAAAA,UAAUA,CAACC,UAAoB,EAAQ;MACtC,IAAI,CAACC,6BAA6B,GAAGC,SAAS;IAC/C,CAAC;IAAAL,MAAA,CAEKM,oBAAoB,GAA1B,eAAMA,oBAAoBA,CAAA,EAAmC;MAC5D,MAAMC,KAAK,GAAG,IAAI,CAACC,UAAU,CAAC,CAAC;MAC/B,IAAI,CAACD,KAAK,EAAE;QACX;MACD;;MAEA;MACA,MAAME,aAAa,GAAI,MAAMF,KAAK,EAAEG,oBAAoB,CAAC,CAA4B;MACrF,MAAMC,SAAS,GAAGC,UAAU,CAACC,cAAc,CAACN,KAAK,EAAEO,SAAS,CAAC,CAAC,CAAwB;MACtF,IAAIH,SAAS,IAAIA,SAAS,CAACI,SAAS,EAAE;QACrCJ,SAAS,CAACI,SAAS,CAAC,CAAC,EAAEC,WAAW,CAAC,QAAQ,EAAGC,WAAyC,IAAK;UAC3F,MAAMC,QAAQ,GAAGX,KAAK,CAACQ,SAAS,CAAC,CAAgB;UACjD,MAAMI,UAAU,GAAGD,QAAQ,CAACE,iBAAiB,CAAC,CAAE;UAChD,MAAMC,mBAAmB,GAAGF,UAAU,CAACG,SAAS;UAChD,IACCH,UAAU,IACVA,UAAU,CAACI,GAAG,CAAC,kDAAkD,CAAC,IAClEF,mBAAmB,KAAKhB,SAAS,IACjC,CAAC,CAAC,IAAI,EAAE,OAAO,CAAC,CAACmB,QAAQ,CAACP,WAAW,CAACQ,YAAY,CAAC,QAAQ,CAAC,CAAC,EAC5D;YACD,IAAI;cACHhB,aAAa,EAAEiB,iCAAiC,CAACP,UAAU,EAA0BD,QAAQ,CAAC;cAC9FT,aAAa,EAAEkB,yBAAyB,CAACR,UAAU,EAA0BZ,KAAK,CAAC;YACpF,CAAC,CAAC,OAAOqB,CAAC,EAAE;cACX;cACA;cACA;YAAA;UAEF;UACA,MAAMC,sBAAsB,GAAGtB,KAAK,CAACuB,iBAAiB,CAAC,UAAU,CAAC;UAClED,sBAAsB,EAAEE,WAAW,CAAC,aAAa,EAAE,IAAI,CAAC;QACzD,CAAC,CAAC;MACH;IACD;;IAEA;AACD;AACA;AACA,OAHC;IAAA/B,MAAA,CAIAgC,gCAAgC,GAAhC,SAAAA,gCAAgCA,CAACC,mCAA2D,EAAQ;MACnG,IAAI,CAAC7B,6BAA6B,GAAG6B,mCAAmC;IACzE;;IAEA;AACD;AACA;AACA,OAHC;IAAAjC,MAAA,CAIAkC,gCAAgC,GAAhC,SAAAA,gCAAgCA,CAAA,EAAuC;MACtE,OAAO,IAAI,CAAC9B,6BAA6B;IAC1C;;IAEA;AACD;AACA;AACA,OAHC;IAAAJ,MAAA,CAIAmC,yBAAyB,GAAzB,SAAAA,yBAAyBA,CAAA,EAA6B;MACrD,OAAO,IAAI,CAACC,kBAAkB,CAAC,CAAC,CAACC,OAAO,CAACC,mBAAmB,IAAI,KAAK;IACtE,CAAC;IAAA,OAAAxC,oBAAA;EAAA;EAAAC,QAAA,GAAAD,oBAAA;EAAA,OAAAC,QAAA;AAAA","ignoreList":[],"file":"TableOptimisticBatch-dbg.js"}