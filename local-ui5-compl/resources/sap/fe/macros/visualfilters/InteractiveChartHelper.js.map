{"version":3,"file":"InteractiveChartHelper.js","names":["InteractiveChartHelper","getChartDisplayedValue","value","valueFormat","metaPath","infoPath","generate","ScaleFactor","valueOf","NumberOfFractionalDigits","getChartValue","_getCollectionName","collection","contextPath","parameters","collectionObject","targetObject","isNavigationProperty","getPath","name","isEntitySet","_getBindingPathForParameters","filterConditions","metaModel","collectionName","entitySetPath","params","convertedFilterConditions","VisualFilterUtils","convertFilterCondions","parameterProperties","CommonUtils","getParameterInfo","i","parameter","property","entityPath","split","propertyContext","createBindingContext","typeConfig","TypeMap","getTypeConfig","$Type","JSTokenizer","parseJS","formatOptions","context","constraints","condition","conditionInternal","undefined","internalParameterCondition","ConditionConverter","toType","edmType","encodeURIComponent","ODataUtils","formatLiteral","values","replaceAll","push","parameterEntitySet","slice","lastIndexOf","targetNavigation","substring","toString","_getUOMAggregationExpression","customAggregate","UoMHasCustomAggregate","UOM","aggregation","aggregationExpression","UOMExpression","path","isPathAnnotationExpression","AggregatableProperty","AggregationMethod","getAggregationBinding","chartAnnotations","textAssociation","dimensionType","sortOrder","selectionVariant","filterBarContext","draftSupported","chartMeasure","selectionVariantAnnotation","entityType","dimension","Dimensions","filters","this","getUoM","getModel","operator","value1","value2","isParameter","getFiltersConditionsFromSelectionVariant","getCustomConditions","bind","conditions","forEach","length","bindingPath","UOMAggregationExpression","textAssociationExpression","filterExpression","JSON","stringify","getSortOrder","getMaxItems","_getOrderExpressionFromMeasure","sortPropertyName","DynamicProperty","$target","Name","Property","Descending","ChartType","getColorBinding","dataPoint","valueCriticality","annotations","UI","ValueCriticality","Criticality","buildExpressionForCriticalityColorMicroChart","CriticalityCalculation","oDirection","ImprovementDirection","oDataPointValue","Value","oDeviationRangeLowValue","DeviationRangeLowValue","oToleranceRangeLowValue","ToleranceRangeLowValue","oAcceptanceRangeLowValue","AcceptanceRangeLowValue","oAcceptanceRangeHighValue","AcceptanceRangeHighValue","oToleranceRangeHighValue","ToleranceRangeHighValue","oDeviationRangeHighValue","DeviationRangeHighValue","CommonHelper","getCriticalityCalculationBinding","getValueCriticality","result","valueCriticalityType","_getCriticalityFromEnum","join","criticality","valueColor","mLibrary","ValueColor","indicator","Error","Good","Critical","Neutral","getScaleUoMTitle","chartAnnotation","seperator","toolTip","scaleFactor","MeasureAttributes","DataPoint","ValueFormat","fixedInteger","NumberFormat","getIntegerInstance","style","showScale","shortRefNumber","scale","getScale","expression","getMeasureDimensionTitle","measureLabel","measurePath","Measures","DynamicMeasures","dimensionPath","dimensionLabel","Common","Label","Library","getResourceBundleFor","getText","getToolTip","renderLineChart","chartType","measureDimensionToolTip","escapeSingleQuotes","scaleUOMTooltip","_getUOM","UOMObjectPath","customData","aggregatablePropertyPath","UOMObject","$Path","entityProperties","isSingleton","targetType","propertyAnnotations","find","measure","ISOCurrency","unit","Unit","getScaleFactor","getUoMVisiblity","showError","getInParameterFiltersBinding","inParameters","parts","paths","inParameter","localDataProperty","getfilterCountBinding","getInteractiveChartProperties","visualFilter","interactiveChartProperties","id","showErrorExpression","errorMessageExpression","errorMessageTitleExpression","dataPointAnnotation","getParameters","getObject","dimensionText","Text","contextObjectPath","getInvolvedDataModelObjects","SortOrder","aggregationBinding","type","aggregateProperties","filterBarEntityType","scalefactor","uom","stringifyCustomData","inParameterFilters","stringifiedParameters","dimensionContext","fullyQualifiedName","dimensionObject","chartLabel","getTextBinding","displayedValue","color"],"sources":["./InteractiveChartHelper.ts"],"sourcesContent":["import type {\n\tEntitySet,\n\tEntityType,\n\tNavigationProperty,\n\tPathAnnotationExpression,\n\tProperty,\n\tPropertyAnnotationValue,\n\tPropertyPath\n} from \"@sap-ux/vocabularies-types\";\nimport type { AggregatedProperty, AggregatedPropertyType } from \"@sap-ux/vocabularies-types/vocabularies/Analytics\";\nimport type { Label, SortOrderType } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type {\n\tChart,\n\tDataPoint,\n\tNumberFormat as NumberFormatType,\n\tPresentationVariant,\n\tSelectionVariant,\n\tValueCriticalityType\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport JSTokenizer from \"sap/base/util/JSTokenizer\";\nimport type { BindingToolkitExpression, CompiledBindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport { getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport type { ParameterType } from \"sap/fe/core/converters/controls/ListReport/VisualFilters\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { isEntitySet, isNavigationProperty, isPathAnnotationExpression, isSingleton } from \"sap/fe/core/helpers/TypeGuards\";\nimport { buildExpressionForCriticalityColorMicroChart } from \"sap/fe/core/templating/CriticalityFormatters\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport VisualFilterUtils from \"sap/fe/macros/controls/filterbar/utils/VisualFilterUtils\";\nimport { constraints, formatOptions } from \"sap/fe/macros/filter/FilterFieldHelper\";\nimport type { FilterConditions } from \"sap/fe/macros/filterBar/FilterHelper\";\nimport { getFiltersConditionsFromSelectionVariant } from \"sap/fe/macros/filterBar/FilterHelper\";\nimport type { ValueColor } from \"sap/m/library\";\nimport mLibrary from \"sap/m/library\";\nimport Library from \"sap/ui/core/Lib\";\nimport NumberFormat from \"sap/ui/core/format/NumberFormat\";\nimport ConditionConverter from \"sap/ui/mdc/condition/ConditionConverter\";\nimport TypeMap from \"sap/ui/mdc/odata/v4/TypeMap\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport ODataUtils from \"sap/ui/model/odata/v4/ODataUtils\";\nimport { getTextBinding } from \"../field/FieldTemplating\";\nimport type VisualFilterBlock from \"./VisualFilter.block\";\ntype MeasureType = {\n\tvalue?: string;\n\tISOCurrency?: PathAnnotationExpression<string>;\n\tUnit?: PathAnnotationExpression<string>;\n};\ntype InteractiveChartType = {\n\tchartLabel?: BindingToolkitExpression<string> | CompiledBindingToolkitExpression;\n\taggregationBinding?: string;\n\terrorMessageTitleExpression?: string;\n\terrorMessageExpression?: string;\n\tshowErrorExpression?: string;\n\tinParameters?: string;\n\tdisplayedValue?: string;\n\tmeasure?: string;\n\tstringifiedParameters?: string;\n\tselectionVariantAnnotation?: string;\n\tinParameterFilters?: string;\n\tcolor?: string;\n\tuom?: string | PropertyAnnotationValue<unknown>;\n\tscalefactor?: number | object;\n};\n\nconst InteractiveChartHelper = {\n\tgetChartDisplayedValue: function (value: string, valueFormat?: NumberFormatType, metaPath?: string): string {\n\t\tconst infoPath = generate([metaPath]);\n\t\treturn (\n\t\t\t\"{parts:[{path:'\" +\n\t\t\tvalue +\n\t\t\t\"',type:'sap.ui.model.odata.type.Decimal', constraints:{'nullable':false}}\" +\n\t\t\t(valueFormat && valueFormat.ScaleFactor\n\t\t\t\t? \",{value:'\" + valueFormat.ScaleFactor.valueOf() + \"'}\"\n\t\t\t\t: \",{path:'internal>scalefactorNumber/\" + infoPath + \"'}\") +\n\t\t\t(valueFormat && valueFormat.NumberOfFractionalDigits\n\t\t\t\t? \",{value:'\" + valueFormat.NumberOfFractionalDigits + \"'}\"\n\t\t\t\t: \",{value:'0'}\") +\n\t\t\t\",{path:'internal>currency/\" +\n\t\t\tinfoPath +\n\t\t\t\"'}\" +\n\t\t\t\",{path:'\" +\n\t\t\tvalue +\n\t\t\t\"',type:'sap.ui.model.odata.type.String', constraints:{'nullable':false}}\" +\n\t\t\t\"], formatter:'VisualFilterRuntime.scaleVisualFilterValue'}\"\n\t\t); //+ sType.split('#').length ? sType.split('#')[1] : 'Decimal' + \"}\";\n\t},\n\tgetChartValue: function (value: string): string {\n\t\treturn \"{path:'\" + value + \"',type:'sap.ui.model.odata.type.Decimal', constraints:{'nullable':false}}\";\n\t},\n\t_getCollectionName: function (\n\t\tcollection: DataModelObjectPath<NavigationProperty | EntitySet | EntityType>,\n\t\tcontextPath: Context,\n\t\tparameters?: Array<string>\n\t): string {\n\t\tconst collectionObject = collection.targetObject;\n\t\tif (isNavigationProperty(collectionObject)) {\n\t\t\treturn parameters ? contextPath.getPath() : collectionObject.name;\n\t\t} else if (isEntitySet(collectionObject)) {\n\t\t\treturn \"/\" + collectionObject.name;\n\t\t} else {\n\t\t\treturn collectionObject!.name;\n\t\t}\n\t},\n\t_getBindingPathForParameters: function (\n\t\tfilterConditions: Record<string, FilterConditions[]>,\n\t\tmetaModel: ODataModel,\n\t\tcollectionName: string,\n\t\tparameters: Array<string>,\n\t\tentitySetPath: string\n\t): string {\n\t\tconst params = [];\n\t\tconst convertedFilterConditions = VisualFilterUtils.convertFilterCondions(filterConditions);\n\t\tconst parameterProperties = CommonUtils.getParameterInfo(\n\t\t\tmetaModel as unknown as ODataMetaModel,\n\t\t\tcollectionName\n\t\t).parameterProperties;\n\t\tif (parameterProperties) {\n\t\t\tfor (const i in parameters) {\n\t\t\t\tconst parameter = parameters[i];\n\t\t\t\tconst property = parameterProperties[parameter];\n\t\t\t\tconst entityPath = entitySetPath.split(\"/\")[1];\n\t\t\t\tconst propertyContext = metaModel.createBindingContext(`/${entityPath}/${parameter}`);\n\t\t\t\tconst typeConfig = TypeMap.getTypeConfig(\n\t\t\t\t\tproperty.$Type,\n\t\t\t\t\tJSTokenizer.parseJS(formatOptions(property, { context: propertyContext }) || \"{}\"),\n\t\t\t\t\tJSTokenizer.parseJS(constraints(property, { context: propertyContext }) || \"{}\")\n\t\t\t\t);\n\t\t\t\tconst condition = convertedFilterConditions[parameter];\n\t\t\t\tconst conditionInternal = condition ? condition[0] : undefined;\n\t\t\t\tif (conditionInternal) {\n\t\t\t\t\tconst internalParameterCondition = ConditionConverter.toType(conditionInternal, typeConfig, TypeMap);\n\t\t\t\t\tconst edmType = property.$Type;\n\t\t\t\t\tlet value = encodeURIComponent(ODataUtils.formatLiteral(internalParameterCondition.values[0], edmType));\n\t\t\t\t\tvalue = value.replaceAll(\"'\", \"\\\\'\");\n\t\t\t\t\tparams.push(`${parameter}=${value}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst parameterEntitySet = collectionName.slice(0, collectionName.lastIndexOf(\"/\"));\n\t\tconst targetNavigation = collectionName.substring(collectionName.lastIndexOf(\"/\") + 1);\n\t\t// create parameter context\n\t\treturn `${parameterEntitySet}(${params.toString()})/${targetNavigation}`;\n\t},\n\t_getUOMAggregationExpression: function (\n\t\tcustomAggregate?: boolean,\n\t\tUoMHasCustomAggregate?: boolean,\n\t\tUOM?: PropertyAnnotationValue<unknown> | string,\n\t\taggregation?: AggregatedPropertyType\n\t): { aggregationExpression?: string; UOMExpression?: string } {\n\t\tlet aggregationExpression, UOMExpression;\n\t\tconst path = UOM && isPathAnnotationExpression(UOM) && UOM.path;\n\t\tif (customAggregate) {\n\t\t\t//custom aggregate for a currency or unit of measure corresponding to this aggregatable property\n\t\t\tif (UoMHasCustomAggregate) {\n\t\t\t\taggregationExpression = path ? `{ 'unit' : '${path}' }` : \"{}\";\n\t\t\t\tUOMExpression = \"\";\n\t\t\t} else {\n\t\t\t\taggregationExpression = \"{}\";\n\t\t\t\tUOMExpression = path ? `, '${path}' : {}` : \"\";\n\t\t\t}\n\t\t} else if (\n\t\t\taggregation &&\n\t\t\taggregation.AggregatableProperty &&\n\t\t\taggregation.AggregatableProperty.value &&\n\t\t\taggregation.AggregationMethod\n\t\t) {\n\t\t\taggregationExpression =\n\t\t\t\t\"{ 'name' : '\" + aggregation.AggregatableProperty.value + \"', 'with' : '\" + aggregation.AggregationMethod + \"'}\";\n\t\t\tUOMExpression = path ? \", '\" + path + \"' : {}\" : \"\";\n\t\t}\n\n\t\treturn {\n\t\t\taggregationExpression: aggregationExpression,\n\t\t\tUOMExpression: UOMExpression\n\t\t};\n\t},\n\tgetAggregationBinding: function (\n\t\tchartAnnotations: Chart,\n\t\tcollection: DataModelObjectPath<EntitySet | NavigationProperty>,\n\t\tcontextPath: Context,\n\t\ttextAssociation?: PathAnnotationExpression<string>,\n\t\tdimensionType?: string,\n\t\tsortOrder?: SortOrderType[],\n\t\tselectionVariant?: DataModelObjectPath<SelectionVariant>,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType,\n\t\tUoMHasCustomAggregate?: boolean,\n\t\tparameters?: Array<string>,\n\t\tfilterBarContext?: Context,\n\t\tdraftSupported?: boolean,\n\t\tchartMeasure?: string\n\t): string {\n\t\tconst selectionVariantAnnotation = selectionVariant?.targetObject;\n\t\tconst entityType = filterBarContext ? filterBarContext.getPath() : \"\";\n\t\tconst entitySetPath = contextPath.getPath();\n\t\tconst dimension = chartAnnotations.Dimensions[0].value;\n\t\tconst filters = [];\n\t\tlet filterConditions;\n\t\tlet collectionName = this._getCollectionName(collection, contextPath, parameters);\n\t\tconst UOM: PropertyAnnotationValue<unknown> | string | undefined = InteractiveChartHelper.getUoM(\n\t\t\tchartAnnotations,\n\t\t\tcollection,\n\t\t\tundefined,\n\t\t\tcustomAggregate,\n\t\t\taggregation\n\t\t);\n\t\tconst metaModel = contextPath.getModel();\n\t\tif (draftSupported) {\n\t\t\tfilters.push({\n\t\t\t\toperator: \"EQ\",\n\t\t\t\tvalue1: \"true\",\n\t\t\t\tvalue2: null,\n\t\t\t\tpath: \"IsActiveEntity\",\n\t\t\t\tisParameter: true\n\t\t\t});\n\t\t}\n\t\tif (selectionVariantAnnotation) {\n\t\t\tfilterConditions = getFiltersConditionsFromSelectionVariant(\n\t\t\t\tentitySetPath,\n\t\t\t\tmetaModel as unknown as ODataMetaModel,\n\t\t\t\tselectionVariantAnnotation,\n\t\t\t\tVisualFilterUtils.getCustomConditions.bind(VisualFilterUtils)\n\t\t\t);\n\t\t\tfor (const path in filterConditions) {\n\t\t\t\tconst conditions = filterConditions[path];\n\t\t\t\tconditions.forEach(function (condition: FilterConditions) {\n\t\t\t\t\tif (!condition.isParameter) {\n\t\t\t\t\t\tfilters.push(condition);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (entityType !== `${collectionName}/` && parameters && parameters.length && filterConditions) {\n\t\t\tconst bindingPath = this._getBindingPathForParameters(filterConditions, metaModel, collectionName, parameters, entitySetPath);\n\t\t\tcollectionName = bindingPath;\n\t\t}\n\t\tconst UOMAggregationExpression = this._getUOMAggregationExpression(customAggregate, UoMHasCustomAggregate, UOM, aggregation);\n\t\tconst aggregationExpression = UOMAggregationExpression.aggregationExpression;\n\t\tconst UOMExpression = UOMAggregationExpression.UOMExpression;\n\t\tconst textAssociationExpression = textAssociation ? \"' : { 'additionally' : ['\" + textAssociation.path + \"'] }\" : \"' : { }\";\n\t\tconst filterExpression = JSON.stringify(filters);\n\t\treturn (\n\t\t\t\"{path: '\" +\n\t\t\tcollectionName +\n\t\t\t\"', templateShareable: true, suspended : true, 'filters' : \" +\n\t\t\tfilterExpression +\n\t\t\t\",'parameters' : {\" +\n\t\t\tInteractiveChartHelper.getSortOrder(chartAnnotations, dimensionType, sortOrder, chartMeasure) +\n\t\t\t\", '$$aggregation' : {'aggregate' : {'\" +\n\t\t\tchartMeasure +\n\t\t\t\"' : \" +\n\t\t\taggregationExpression +\n\t\t\t\"},'group' : {'\" +\n\t\t\tdimension +\n\t\t\ttextAssociationExpression +\n\t\t\tUOMExpression +\n\t\t\t\"} } }\" +\n\t\t\tInteractiveChartHelper.getMaxItems(chartAnnotations) +\n\t\t\t\"}\"\n\t\t);\n\t},\n\t_getOrderExpressionFromMeasure: function (sortOrder?: SortOrderType[], chartMeasure?: string): string {\n\t\tlet sortPropertyName;\n\t\tif (sortOrder && sortOrder.length) {\n\t\t\tif (sortOrder[0].DynamicProperty) {\n\t\t\t\tsortPropertyName = (sortOrder[0].DynamicProperty.$target as AggregatedProperty)?.Name;\n\t\t\t} else {\n\t\t\t\tsortPropertyName = sortOrder[0].Property?.value;\n\t\t\t}\n\t\t\tif (sortPropertyName === chartMeasure) {\n\t\t\t\treturn \"'$orderby' : '\" + chartMeasure + (sortOrder[0].Descending ? \" desc'\" : \"'\");\n\t\t\t}\n\t\t\treturn \"'$orderby' : '\" + chartMeasure + \" desc'\";\n\t\t}\n\t\treturn \"'$orderby' : '\" + chartMeasure + \" desc'\";\n\t},\n\tgetSortOrder: function (chartAnnotations: Chart, dimensionType?: string, sortOrder?: SortOrderType[], chartMeasure?: string): string {\n\t\tif (chartAnnotations.ChartType === \"UI.ChartType/Donut\" || chartAnnotations.ChartType === \"UI.ChartType/Bar\") {\n\t\t\treturn this._getOrderExpressionFromMeasure(sortOrder, chartMeasure);\n\t\t} else if (dimensionType === \"Edm.Date\" || dimensionType === \"Edm.Time\" || dimensionType === \"Edm.DateTimeOffset\") {\n\t\t\treturn \"'$orderby' : '\" + chartAnnotations.Dimensions[0].value + \"'\";\n\t\t} else if (\n\t\t\tsortOrder &&\n\t\t\tsortOrder.length &&\n\t\t\t(sortOrder[0].Property?.$target as unknown as PathAnnotationExpression<string>)?.path === chartAnnotations.Dimensions[0].value\n\t\t) {\n\t\t\treturn \"'$orderby' : '\" + sortOrder[0].Property?.$target?.name + (sortOrder[0].Descending ? \" desc'\" : \"'\");\n\t\t} else {\n\t\t\treturn \"'$orderby' : '\" + chartAnnotations.Dimensions[0].$target?.name + \"'\";\n\t\t}\n\t},\n\tgetMaxItems: function (chartAnnotations: Chart): string {\n\t\tif (chartAnnotations.ChartType === \"UI.ChartType/Bar\") {\n\t\t\treturn \",'startIndex' : 0,'length' : 3\";\n\t\t} else if (chartAnnotations.ChartType === \"UI.ChartType/Line\") {\n\t\t\treturn \",'startIndex' : 0,'length' : 6\";\n\t\t} else {\n\t\t\treturn \"\";\n\t\t}\n\t},\n\tgetColorBinding: function (dataPoint: DataPoint, dimension: PropertyPath): string | undefined {\n\t\tconst valueCriticality = dimension?.$target?.annotations?.UI?.ValueCriticality;\n\t\tif (dataPoint?.Criticality) {\n\t\t\treturn buildExpressionForCriticalityColorMicroChart(dataPoint);\n\t\t} else if (dataPoint?.CriticalityCalculation) {\n\t\t\tconst oDirection = dataPoint.CriticalityCalculation.ImprovementDirection;\n\t\t\tconst oDataPointValue = dataPoint.Value;\n\t\t\tconst oDeviationRangeLowValue = dataPoint.CriticalityCalculation.DeviationRangeLowValue.valueOf();\n\t\t\tconst oToleranceRangeLowValue = dataPoint.CriticalityCalculation.ToleranceRangeLowValue.valueOf();\n\t\t\tconst oAcceptanceRangeLowValue = dataPoint.CriticalityCalculation.AcceptanceRangeLowValue.valueOf();\n\t\t\tconst oAcceptanceRangeHighValue = dataPoint.CriticalityCalculation.AcceptanceRangeHighValue.valueOf();\n\t\t\tconst oToleranceRangeHighValue = dataPoint.CriticalityCalculation.ToleranceRangeHighValue.valueOf();\n\t\t\tconst oDeviationRangeHighValue = dataPoint.CriticalityCalculation.DeviationRangeHighValue.valueOf();\n\t\t\treturn CommonHelper.getCriticalityCalculationBinding(\n\t\t\t\toDirection,\n\t\t\t\toDataPointValue,\n\t\t\t\toDeviationRangeLowValue,\n\t\t\t\toToleranceRangeLowValue,\n\t\t\t\toAcceptanceRangeLowValue,\n\t\t\t\toAcceptanceRangeHighValue,\n\t\t\t\toToleranceRangeHighValue,\n\t\t\t\toDeviationRangeHighValue\n\t\t\t);\n\t\t} else if (valueCriticality && valueCriticality.length) {\n\t\t\treturn InteractiveChartHelper.getValueCriticality(dimension.value, valueCriticality);\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t},\n\tgetValueCriticality: function (dimension: string, valueCriticality: Array<ValueCriticalityType>): string | undefined {\n\t\tlet result;\n\t\tconst values: string[] = [];\n\t\tif (valueCriticality && valueCriticality.length > 0) {\n\t\t\tvalueCriticality.forEach(function (valueCriticalityType: ValueCriticalityType) {\n\t\t\t\tif (valueCriticalityType.Value && valueCriticalityType.Criticality) {\n\t\t\t\t\tconst value =\n\t\t\t\t\t\t\"${\" +\n\t\t\t\t\t\tdimension +\n\t\t\t\t\t\t\"} === '\" +\n\t\t\t\t\t\tvalueCriticalityType.Value +\n\t\t\t\t\t\t\"' ? '\" +\n\t\t\t\t\t\tInteractiveChartHelper._getCriticalityFromEnum(valueCriticalityType.Criticality) +\n\t\t\t\t\t\t\"'\";\n\t\t\t\t\tvalues.push(value);\n\t\t\t\t}\n\t\t\t});\n\t\t\tresult = values.length > 0 && values.join(\" : \") + \" : undefined\";\n\t\t}\n\t\treturn result ? \"{= \" + result + \" }\" : undefined;\n\t},\n\t/**\n\t * This function returns the criticality indicator from annotations if criticality is EnumMember.\n\t * @param criticality Criticality provided in the annotations\n\t * @returns Return the indicator for criticality\n\t * @private\n\t */\n\t_getCriticalityFromEnum: function (criticality: string): ValueColor {\n\t\tconst valueColor = mLibrary.ValueColor;\n\t\tlet indicator;\n\t\tif (criticality === \"UI.CriticalityType/Negative\") {\n\t\t\tindicator = valueColor.Error;\n\t\t} else if (criticality === \"UI.CriticalityType/Positive\") {\n\t\t\tindicator = valueColor.Good;\n\t\t} else if (criticality === \"UI.CriticalityType/Critical\") {\n\t\t\tindicator = valueColor.Critical;\n\t\t} else {\n\t\t\tindicator = valueColor.Neutral;\n\t\t}\n\t\treturn indicator;\n\t},\n\tgetScaleUoMTitle: function (\n\t\tchartAnnotation?: Chart,\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tmetaPath?: string,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType,\n\t\tseperator?: string,\n\t\ttoolTip?: boolean\n\t): string {\n\t\tconst scaleFactor = chartAnnotation?.MeasureAttributes\n\t\t\t? chartAnnotation.MeasureAttributes[0]?.DataPoint?.$target?.ValueFormat?.ScaleFactor?.valueOf()\n\t\t\t: undefined;\n\t\tconst infoPath = generate([metaPath]);\n\t\tconst fixedInteger = NumberFormat.getIntegerInstance({\n\t\t\tstyle: \"short\",\n\t\t\tshowScale: false,\n\t\t\tshortRefNumber: scaleFactor as number\n\t\t});\n\t\tlet scale = fixedInteger.getScale();\n\t\tlet UOM = InteractiveChartHelper.getUoM(chartAnnotation, collection, undefined, customAggregate, aggregation);\n\t\tUOM = UOM && ((UOM as PathAnnotationExpression<string>).path ? \"${internal>uom/\" + infoPath + \"}\" : \"'\" + UOM + \"'\");\n\t\tscale = scale ? \"'\" + scale + \"'\" : \"${internal>scalefactor/\" + infoPath + \"}\";\n\t\tif (!seperator) {\n\t\t\tseperator = \"|\";\n\t\t}\n\t\tseperator = \"' \" + seperator + \" ' + \";\n\t\tconst expression = scale && UOM ? seperator + scale + \" + ' ' + \" + UOM : seperator + (scale || UOM);\n\t\treturn toolTip ? expression : \"{= \" + expression + \"}\";\n\t},\n\tgetMeasureDimensionTitle: function (chartAnnotation?: Chart, customAggregate?: boolean, aggregation?: AggregatedPropertyType): string {\n\t\tlet measureLabel;\n\t\tlet measurePath;\n\t\tif (customAggregate) {\n\t\t\tmeasurePath = chartAnnotation?.Measures[0]?.$target?.name;\n\t\t}\n\t\tif (chartAnnotation?.DynamicMeasures && chartAnnotation.DynamicMeasures.length > 0) {\n\t\t\tmeasurePath = (chartAnnotation.DynamicMeasures[0]?.$target as AggregatedPropertyType)?.AggregatableProperty?.value;\n\t\t} else if (!customAggregate && chartAnnotation?.Measures && chartAnnotation?.Measures.length > 0) {\n\t\t\tmeasurePath = chartAnnotation.Measures[0]?.$target?.name;\n\t\t}\n\t\tconst dimensionPath = chartAnnotation?.Dimensions[0]?.value as unknown as Label;\n\t\tlet dimensionLabel = chartAnnotation?.Dimensions[0]?.$target?.annotations?.Common?.Label;\n\t\tif (!customAggregate && aggregation) {\n\t\t\t// check if the label is part of aggregated properties (Transformation aggregates)\n\t\t\tmeasureLabel = aggregation.annotations && aggregation.annotations.Common && aggregation.annotations.Common.Label;\n\t\t\tif (measureLabel === undefined) {\n\t\t\t\tmeasureLabel = chartAnnotation?.Measures?.[0]?.$target?.annotations?.Common?.Label;\n\t\t\t}\n\t\t} else {\n\t\t\tmeasureLabel = chartAnnotation?.Measures?.[0]?.$target?.annotations?.Common?.Label;\n\t\t}\n\t\tif (measureLabel === undefined) {\n\t\t\tmeasureLabel = measurePath;\n\t\t}\n\t\tif (dimensionLabel === undefined) {\n\t\t\tdimensionLabel = dimensionPath;\n\t\t}\n\t\treturn Library.getResourceBundleFor(\"sap.fe.macros\")!.getText(\"M_INTERACTIVE_CHART_HELPER_VISUALFILTER_MEASURE_DIMENSION_TITLE\", [\n\t\t\tmeasureLabel,\n\t\t\tdimensionLabel\n\t\t]);\n\t},\n\n\tgetToolTip: function (\n\t\tchartAnnotation?: Chart,\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tmetaPath?: string,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType,\n\t\trenderLineChart?: boolean | string\n\t): string {\n\t\tconst chartType = chartAnnotation && chartAnnotation[\"ChartType\"];\n\t\tlet measureDimensionToolTip = InteractiveChartHelper.getMeasureDimensionTitle(chartAnnotation, customAggregate, aggregation);\n\t\tmeasureDimensionToolTip = CommonHelper.escapeSingleQuotes(measureDimensionToolTip);\n\t\tif (renderLineChart === \"false\" && chartType === \"UI.ChartType/Line\") {\n\t\t\treturn `{= '${measureDimensionToolTip}'}`;\n\t\t}\n\n\t\tconst seperator = Library.getResourceBundleFor(\"sap.fe.macros\")?.getText(\n\t\t\t\"M_INTERACTIVE_CHART_HELPER_VISUALFILTER_TOOLTIP_SEPERATOR\"\n\t\t);\n\t\tconst infoPath = generate([metaPath]);\n\t\tconst scaleUOMTooltip = InteractiveChartHelper.getScaleUoMTitle(\n\t\t\tchartAnnotation,\n\t\t\tcollection,\n\t\t\tinfoPath,\n\t\t\tcustomAggregate,\n\t\t\taggregation,\n\t\t\tseperator,\n\t\t\ttrue\n\t\t);\n\t\treturn \"{= '\" + measureDimensionToolTip + (scaleUOMTooltip ? \"' + \" + scaleUOMTooltip : \"'\") + \"}\";\n\t},\n\t_getUOM: function (\n\t\tUOMObjectPath?: PropertyAnnotationValue<unknown>,\n\t\tUOM?: \"ISOCurrency\" | \"Unit\",\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tcustomData?: boolean,\n\t\taggregatablePropertyPath?: string\n\t): string | PropertyAnnotationValue<unknown> | undefined {\n\t\tconst UOMObject: Record<string, unknown> = {};\n\t\tconst collectionObject = collection?.targetObject;\n\t\tif (UOMObjectPath && UOM && isPathAnnotationExpression(UOMObjectPath)) {\n\t\t\t// check if the UOM is part of Measure annotations(Custom aggregates)\n\t\t\tUOMObject[UOM] = { $Path: UOMObjectPath.path };\n\t\t\treturn customData && UOMObjectPath.path ? JSON.stringify(UOMObject) : UOMObjectPath;\n\t\t} else if (aggregatablePropertyPath) {\n\t\t\t// check if the UOM is part of base property annotations(Transformation aggregates)\n\t\t\tconst entityProperties =\n\t\t\t\tisEntitySet(collectionObject) || isSingleton(collectionObject)\n\t\t\t\t\t? collectionObject.entityType.entityProperties\n\t\t\t\t\t: collectionObject?.targetType?.entityProperties;\n\t\t\tconst propertyAnnotations = entityProperties?.find((property: Property) => property.name == aggregatablePropertyPath);\n\t\t\tif (propertyAnnotations?.annotations?.Measures && UOM) {\n\t\t\t\tUOMObjectPath = propertyAnnotations?.annotations?.Measures[UOM] as PathAnnotationExpression<unknown>;\n\t\t\t\tUOMObject[UOM] = { $Path: UOMObjectPath?.path };\n\t\t\t}\n\t\t\treturn UOMObjectPath && customData && isPathAnnotationExpression(UOMObjectPath) && UOMObjectPath.path\n\t\t\t\t? JSON.stringify(UOMObject)\n\t\t\t\t: UOMObjectPath;\n\t\t}\n\t},\n\tgetUoM: function (\n\t\tchartAnnotation?: Chart,\n\t\tcollection?: DataModelObjectPath<PageContextPathTarget>,\n\t\tcustomData?: boolean,\n\t\tcustomAggregate?: boolean,\n\t\taggregation?: AggregatedPropertyType\n\t): string | PropertyAnnotationValue<unknown> | undefined {\n\t\tlet measure: MeasureType = {};\n\t\tif (customAggregate) {\n\t\t\tmeasure = chartAnnotation?.Measures[0] as MeasureType;\n\t\t}\n\t\tif (chartAnnotation?.DynamicMeasures && chartAnnotation.DynamicMeasures.length > 0) {\n\t\t\tmeasure = (chartAnnotation.DynamicMeasures[0]?.$target as AggregatedPropertyType)?.AggregatableProperty?.$target?.annotations\n\t\t\t\t?.Measures as MeasureType;\n\t\t} else if (!customAggregate && chartAnnotation?.Measures && chartAnnotation.Measures.length > 0) {\n\t\t\tmeasure = chartAnnotation.Measures[0];\n\t\t}\n\t\tconst ISOCurrency = measure?.ISOCurrency;\n\t\tconst unit = measure?.Unit;\n\t\tlet aggregatablePropertyPath: string | undefined;\n\t\tif (!customAggregate && aggregation) {\n\t\t\taggregatablePropertyPath = aggregation.AggregatableProperty && aggregation.AggregatableProperty.value;\n\t\t} else {\n\t\t\taggregatablePropertyPath = measure?.value;\n\t\t}\n\t\treturn (\n\t\t\tthis._getUOM(ISOCurrency, \"ISOCurrency\", collection, customData, aggregatablePropertyPath) ||\n\t\t\tthis._getUOM(unit, \"Unit\", collection, customData, aggregatablePropertyPath)\n\t\t);\n\t},\n\tgetScaleFactor: function (valueFormat?: NumberFormatType): number | undefined {\n\t\tif (valueFormat && valueFormat.ScaleFactor) {\n\t\t\treturn valueFormat.ScaleFactor.valueOf();\n\t\t}\n\t\treturn undefined;\n\t},\n\tgetUoMVisiblity: function (chartAnnotation?: Chart, showError?: boolean): boolean {\n\t\tconst chartType = chartAnnotation && chartAnnotation[\"ChartType\"];\n\t\tif (showError) {\n\t\t\treturn false;\n\t\t} else if (!(chartType === \"UI.ChartType/Bar\" || chartType === \"UI.ChartType/Line\")) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\t},\n\tgetInParameterFiltersBinding: function (inParameters: Array<ParameterType>): string | undefined {\n\t\tif (inParameters.length > 0) {\n\t\t\tconst parts: string[] = [];\n\t\t\tlet paths = \"\";\n\t\t\tinParameters.forEach(function (inParameter: ParameterType) {\n\t\t\t\tif (inParameter.localDataProperty) {\n\t\t\t\t\tparts.push(`{path:'$filters>/conditions/${inParameter.localDataProperty}'}`);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (parts.length > 0) {\n\t\t\t\tpaths = parts.join();\n\t\t\t\treturn `{parts:[${paths}], formatter:'sap.fe.macros.visualfilters.VisualFilterRuntime.getFiltersFromConditions'}`;\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t},\n\n\tgetfilterCountBinding: function (chartAnnotation?: Chart): string {\n\t\tconst dimension = chartAnnotation?.Dimensions[0]?.$target?.name;\n\t\treturn (\n\t\t\t\"{path:'$filters>/conditions/\" + dimension + \"', formatter:'sap.fe.macros.visualfilters.VisualFilterRuntime.getFilterCounts'}\"\n\t\t);\n\t},\n\n\tgetInteractiveChartProperties: function (visualFilter: VisualFilterBlock): InteractiveChartType {\n\t\tconst chartAnnotation = visualFilter.chartAnnotation;\n\t\tconst interactiveChartProperties: InteractiveChartType = {};\n\t\tif (visualFilter.chartMeasure && chartAnnotation?.Dimensions && chartAnnotation.Dimensions[0]) {\n\t\t\tconst id = generate([visualFilter.metaPath?.getPath()]);\n\t\t\tinteractiveChartProperties.showErrorExpression = \"${internal>\" + id + \"/showError}\";\n\t\t\tinteractiveChartProperties.errorMessageExpression = \"{internal>\" + id + \"/errorMessage}\";\n\t\t\tinteractiveChartProperties.errorMessageTitleExpression = \"{internal>\" + id + \"/errorMessageTitle}\";\n\t\t\tlet dataPointAnnotation;\n\t\t\tif (chartAnnotation?.MeasureAttributes && chartAnnotation?.MeasureAttributes[0]) {\n\t\t\t\tdataPointAnnotation = chartAnnotation?.MeasureAttributes[0]?.DataPoint\n\t\t\t\t\t? chartAnnotation?.MeasureAttributes[0].DataPoint.$target\n\t\t\t\t\t: chartAnnotation?.MeasureAttributes[0];\n\t\t\t}\n\t\t\tconst dimension = chartAnnotation?.Dimensions[0];\n\t\t\tconst parameters = CommonHelper.getParameters(visualFilter.contextPath.getObject(), { context: visualFilter.contextPath });\n\t\t\tconst dimensionText = dimension?.$target?.annotations?.Common?.Text as unknown as PathAnnotationExpression<string>;\n\t\t\tconst contextObjectPath = getInvolvedDataModelObjects<PresentationVariant>(\n\t\t\t\tvisualFilter.metaPath,\n\t\t\t\tvisualFilter.contextPath\n\t\t\t).targetObject;\n\t\t\tconst collection = getInvolvedDataModelObjects<EntitySet | NavigationProperty>(visualFilter.contextPath);\n\t\t\tconst selectionVariant = visualFilter.selectionVariantAnnotation\n\t\t\t\t? getInvolvedDataModelObjects<SelectionVariant>(visualFilter.selectionVariantAnnotation)\n\t\t\t\t: undefined;\n\t\t\tconst sortOrder = contextObjectPath?.SortOrder;\n\t\t\tinteractiveChartProperties.aggregationBinding = InteractiveChartHelper.getAggregationBinding(\n\t\t\t\tchartAnnotation,\n\t\t\t\tcollection,\n\t\t\t\tvisualFilter.contextPath,\n\t\t\t\tdimensionText,\n\t\t\t\tdimension.$target?.type,\n\t\t\t\tsortOrder,\n\t\t\t\tselectionVariant,\n\t\t\t\tvisualFilter.customAggregate,\n\t\t\t\tvisualFilter.aggregateProperties,\n\t\t\t\tvisualFilter.UoMHasCustomAggregate,\n\t\t\t\tparameters,\n\t\t\t\tvisualFilter.filterBarEntityType,\n\t\t\t\tvisualFilter.draftSupported,\n\t\t\t\tvisualFilter.chartMeasure\n\t\t\t);\n\t\t\tinteractiveChartProperties.scalefactor = InteractiveChartHelper.getScaleFactor((dataPointAnnotation as DataPoint)?.ValueFormat);\n\t\t\tinteractiveChartProperties.uom = InteractiveChartHelper.getUoM(\n\t\t\t\tchartAnnotation,\n\t\t\t\tcollection,\n\t\t\t\ttrue,\n\t\t\t\tvisualFilter.customAggregate,\n\t\t\t\tvisualFilter.aggregateProperties\n\t\t\t);\n\t\t\tinteractiveChartProperties.inParameters = CommonHelper.stringifyCustomData(visualFilter.inParameters as object);\n\t\t\tinteractiveChartProperties.inParameterFilters = visualFilter.inParameters\n\t\t\t\t? InteractiveChartHelper.getInParameterFiltersBinding(visualFilter.inParameters)\n\t\t\t\t: undefined;\n\t\t\tinteractiveChartProperties.selectionVariantAnnotation = visualFilter.selectionVariantAnnotation\n\t\t\t\t? CommonHelper.stringifyCustomData(visualFilter.selectionVariantAnnotation)\n\t\t\t\t: undefined;\n\t\t\tinteractiveChartProperties.stringifiedParameters = CommonHelper.stringifyCustomData(parameters);\n\t\t\tconst dimensionContext = visualFilter.metaPath\n\t\t\t\t?.getModel()\n\t\t\t\t?.createBindingContext(visualFilter.contextPath.getPath() + \"/@\" + dimension.fullyQualifiedName.split(\"@\")[1]);\n\t\t\tif (dimensionContext) {\n\t\t\t\tconst dimensionObject = getInvolvedDataModelObjects<Property>(dimensionContext, visualFilter.contextPath);\n\t\t\t\tinteractiveChartProperties.chartLabel = getTextBinding(dimensionObject, {});\n\t\t\t}\n\t\t\tinteractiveChartProperties.measure = InteractiveChartHelper.getChartValue(visualFilter.chartMeasure);\n\t\t\tinteractiveChartProperties.displayedValue = InteractiveChartHelper.getChartDisplayedValue(\n\t\t\t\tvisualFilter.chartMeasure,\n\t\t\t\t(dataPointAnnotation as DataPoint)?.ValueFormat,\n\t\t\t\tvisualFilter.metaPath?.getPath()\n\t\t\t);\n\t\t\tinteractiveChartProperties.color = InteractiveChartHelper.getColorBinding(dataPointAnnotation as DataPoint, dimension);\n\t\t}\n\t\treturn interactiveChartProperties;\n\t}\n};\n\nexport default InteractiveChartHelper;\n"],"mappings":"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","ignoreList":[]}