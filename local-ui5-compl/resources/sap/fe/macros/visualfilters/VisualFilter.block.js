/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/buildingBlocks/templating/BuildingBlockSupport","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplatingBase","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/helpers/Aggregation","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","./InteractiveChartHelper","./fragments/InteractiveBarChart","./fragments/InteractiveChartWithError","./fragments/InteractiveLineChart"],function(e,t,r,i,a,n,o,l,s,u,c,g,p){"use strict";var h,f,m,b,y,d,T,A,v,M,C,w,P,I,V,E,S,U,D,x,z,L,B,O,H,_,$,F,R,q,N,k,j,W,Y,G,J,K,Q,X,Z,ee,te,re,ie,ae,ne,oe,le,se,ue;var ce={};var ge=p.getInteractiveLineChartTemplate;var pe=g.getInteractiveChartWithErrorTemplate;var he=c.getInteractiveBarChartTemplate;var fe=s.generate;var me=o.AggregationHelper;var be=n.getDefaultSelectionVariant;var ye=a.getInvolvedDataModelObjects;var de=r.xml;var Te=t.defineBuildingBlock;var Ae=t.blockAttribute;function ve(e,t,r,i){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Me(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ce(e,t)}function Ce(e,t){return Ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ce(e,t)}function we(e,t,r,i,a){var n={};return Object.keys(i).forEach(function(e){n[e]=i[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},n),a&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(a):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function Pe(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let Ie=(h=Te({name:"VisualFilter",namespace:"sap.fe.macros"}),f=Ae({type:"string",required:true}),m=Ae({type:"string"}),b=Ae({type:"sap.ui.model.Context",required:true,expectedTypes:["EntitySet","NavigationProperty"]}),y=Ae({type:"sap.ui.model.Context",required:true}),d=Ae({type:"string"}),T=Ae({type:"string"}),A=Ae({type:"sap.ui.model.Context"}),v=Ae({type:"array"}),M=Ae({type:"boolean"}),C=Ae({type:"boolean"}),w=Ae({type:"boolean"}),P=Ae({type:"string"}),I=Ae({type:"string"}),V=Ae({type:"sap.ui.model.Context"}),E=Ae({type:"boolean"}),S=Ae({type:"string"}),U=Ae({type:"boolean"}),D=Ae({type:"boolean"}),x=Ae({type:"boolean"}),z=Ae({type:"string"}),L=Ae({type:"string"}),B=Ae({type:"string"}),O=Ae({type:"boolean"}),H=Ae({type:"boolean"}),h(_=($=function(t){function r(r,i,a){var n;n=t.call(this,r,i,a)||this;ve(n,"id",F,n);ve(n,"title",R,n);ve(n,"contextPath",q,n);ve(n,"metaPath",N,n);ve(n,"outParameter",k,n);ve(n,"valuelistProperty",j,n);ve(n,"selectionVariantAnnotation",W,n);ve(n,"inParameters",Y,n);ve(n,"multipleSelectionAllowed",G,n);ve(n,"required",J,n);ve(n,"showOverlayInitially",K,n);ve(n,"renderLineChart",Q,n);ve(n,"requiredProperties",X,n);ve(n,"filterBarEntityType",Z,n);ve(n,"showError",ee,n);ve(n,"chartMeasure",te,n);ve(n,"UoMHasCustomAggregate",re,n);ve(n,"showValueHelp",ie,n);ve(n,"customAggregate",ae,n);ve(n,"groupId",ne,n);ve(n,"errorMessageTitle",oe,n);ve(n,"errorMessage",le,n);ve(n,"draftSupported",se,n);ve(n,"isValueListWithFixedValues",ue,n);n.groupId="$auto.visualFilters";n.path=n.metaPath?.getPath();const o=ye(n.metaPath,n.contextPath);const s=n.getConverterContext(o,undefined,a);const c=new me(s.getEntityType(),s);const g=c.getCustomAggregateDefinitions();const p=o.targetObject;let h;const f=p&&p.Visualizations;n.getChartAnnotation(f,s);let m=[],b=[];if(n.chartAnnotation?.Measures?.length){b=g.filter(e=>e.qualifier===n.chartAnnotation?.Measures[0].value);h=b.length>0?b[0].qualifier:n.chartAnnotation.Measures[0].value;m=c.getAggregatedProperties()[0]}if(m&&m.length>0&&!n.chartAnnotation?.DynamicMeasures&&b.length===0&&n.chartAnnotation?.Measures&&n.chartAnnotation?.Measures.length>0){e.warning("The transformational aggregate measures are configured as Chart.Measures but should be configured as Chart.DynamicMeasures instead. Please check the SAP Help documentation and correct the configuration accordingly.")}if(n.chartAnnotation?.DynamicMeasures){if(b.length===0){h=s.getConverterContextFor(s.getAbsoluteAnnotationPath(n.chartAnnotation.DynamicMeasures[0].value)).getDataModelObjectPath().targetObject?.Name.toString();m=c.getAggregatedProperty()}else{e.warning("The dynamic measures have been ignored as visual filters can deal with only 1 measure and the first (custom aggregate) measure defined under Chart.Measures is considered.")}}if(g.some(function(e){return e.qualifier===h})){n.customAggregate=true}const y=be(s.getEntityType());n.checkSelectionVariant(y);const d=n.getAggregateProperties(m,h);if(d){n.aggregateProperties=d}const T=f&&n.chartAnnotation?.Measures&&n.chartAnnotation?.Measures[0]?.$target?.annotations;const A=d?.AggregatableProperty?.$target?.annotations;n.checkIfUOMHasCustomAggregate(g,T,A);const v=T?.UI?.Hidden;const M=v?.valueOf();const C=n.chartAnnotation?.ChartType;n.chartType=C;n.showValueHelp=n.getShowValueHelp(C,M);n.draftSupported=l.isDraftSupported(a.models.metaModel,n.contextPath?.getPath());n.errorMessage=n.getErrorMessage(M,h);n.chartMeasure=h;n.measureDimensionTitle=u.getMeasureDimensionTitle(n.chartAnnotation,n.customAggregate,n.aggregateProperties);const w=ye(n.contextPath);n.toolTip=u.getToolTip(n.chartAnnotation,w,n.path,n.customAggregate,n.aggregateProperties,n.renderLineChart);n.UoMVisibility=u.getUoMVisiblity(n.chartAnnotation,n.showError);n.scaleUoMTitle=u.getScaleUoMTitle(n.chartAnnotation,w,n.path,n.customAggregate,n.aggregateProperties);n.filterCountBinding=u.getfilterCountBinding(n.chartAnnotation);return n}ce=r;Me(r,t);var i=r.prototype;i.checkIfUOMHasCustomAggregate=function e(t,r,i){const a=r?.Measures;const n=i?.Measures;const o=this.getUoM(a,n);if(o&&t.some(function(e){return e.qualifier===o})){this.UoMHasCustomAggregate=true}else{this.UoMHasCustomAggregate=false}};i.getChartAnnotation=function e(t,r){if(t){for(let e=0;e<t.length;e++){const i=t[e]&&t[e].value;this.chartAnnotation=r.getEntityTypeAnnotation(i)&&r.getEntityTypeAnnotation(i).annotation}}};i.getErrorMessage=function e(t,r){let i;if(this.chartAnnotation){if(this.chartAnnotation.ChartType==="UI.ChartType/Line"||this.chartAnnotation.ChartType==="UI.ChartType/Bar"){i=true}else{i=false}}if(typeof t==="boolean"&&t||!i||this.renderLineChart==="false"){this.showError=true;this.errorMessageTitle=t||!i?this.getTranslatedText("M_VISUAL_FILTERS_ERROR_MESSAGE_TITLE"):this.getTranslatedText("M_VISUAL_FILTER_LINE_CHART_INVALID_DATATYPE");if(t){return this.getTranslatedText("M_VISUAL_FILTER_HIDDEN_MEASURE",[r])}else if(!i){return this.getTranslatedText("M_VISUAL_FILTER_UNSUPPORTED_CHART_TYPE")}else{return this.getTranslatedText("M_VISUAL_FILTER_LINE_CHART_UNSUPPORTED_DIMENSION")}}};i.getShowValueHelp=function e(t,r){const i=this.chartAnnotation?.Dimensions[0]&&this.chartAnnotation?.Dimensions[0].$target&&this.chartAnnotation.Dimensions[0].$target.type;if(i==="Edm.Date"||i==="Edm.Time"||i==="Edm.DateTimeOffset"){return false}else if(typeof r==="boolean"&&r){return false}else if(!(t==="UI.ChartType/Bar"||t==="UI.ChartType/Line")){return false}else if(this.renderLineChart==="false"&&t==="UI.ChartType/Line"){return false}else if(this.isValueListWithFixedValues===true){return false}else{return true}};i.checkSelectionVariant=function t(r){let i;if(this.selectionVariantAnnotation){const e=this.metaPath?.getModel().createBindingContext(this.selectionVariantAnnotation.getPath());i=e&&ye(e,this.contextPath).targetObject}if(!i&&r){i=r}if(i&&i.SelectOptions&&!this.multipleSelectionAllowed){for(const t of i.SelectOptions){if(t.PropertyName?.value===this.chartAnnotation?.Dimensions[0].value){if(t.Ranges.length>1){e.error("Multiple SelectOptions for FilterField having SingleValue Allowed Expression")}}}}};i.getAggregateProperties=function e(t,r){let i;if(!t){return}t.some(function(e){if(e.Name===r){i=e;return true}});return i};i.getUoM=function e(t,r){let i=t?.ISOCurrency;let a=t?.Unit;if(!i&&!a&&r){i=r.ISOCurrency;a=r.Unit}return i?.path||a?.path};i.getRequired=function e(){if(this.required){return de`<Label text="" width="0.5rem" required="true">
							<layoutData>
								<OverflowToolbarLayoutData priority="Never" />
							</layoutData>
						</Label>`}else{return""}};i.getUoMTitle=function e(t){if(this.UoMVisibility){return de`<Title
							id="${fe([this.id,"ScaleUoMTitle"])}"
							visible="{= !${t}}"
							text="${this.scaleUoMTitle}"
							titleStyle="H6"
							level="H3"
							width="4.15rem"
						/>`}else{return""}};i.getValueHelp=function e(t){if(this.showValueHelp){return de`<ToolbarSpacer />
						<Button
							id="${fe([this.id,"VisualFilterValueHelpButton"])}"
							type="Transparent"
							ariaHasPopup="Dialog"
							text="${this.filterCountBinding}"
							press="VisualFilterRuntime.fireValueHelp"
							enabled="{= !${t}}"
							customData:multipleSelectionAllowed="${this.multipleSelectionAllowed}"
						>
							<layoutData>
								<OverflowToolbarLayoutData priority="Never" />
							</layoutData>
						</Button>`}else{return""}};i.getInteractiveChartFragment=function e(){if(this.showError){return pe(this)}else if(this.chartType==="UI.ChartType/Bar"){return he(this)}else if(this.chartType==="UI.ChartType/Line"){return ge(this)}return""};i.getTemplate=function e(){const t=fe([this.path]);const r="${internal>"+t+"/showError}";const i=document.body.classList.contains("sapUiSizeCozy");const a=i?"13rem":"100%";const n=i?"100%":"7.5rem";return de`
		<fbControls:VisualFilter
		core:require="{VisualFilterRuntime: 'sap/fe/macros/visualfilters/VisualFilterRuntime'}"
		xmlns="sap.m"
		xmlns:fbControls="sap.fe.macros.controls.filterbar"
		xmlns:customData="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
		xmlns:core="sap.ui.core"
		id="${this.id}"
		height="${a}"
		width="20.5rem"
		class="sapUiSmallMarginBeginEnd"
		customData:infoPath="${fe([this.path])}"
	>
		<VBox height="2rem" class="sapUiTinyMarginTopBottom">
			<OverflowToolbar style="Clear">
				${this.getRequired()}
				<Title
					id="${fe([this.id,"MeasureDimensionTitle"])}"
					text="${this.measureDimensionTitle}"
					tooltip="${this.toolTip}"
					titleStyle="H6"
					level="H3"
					class="sapUiTinyMarginEnd sapUiNoMarginBegin"
				/>
				${this.getUoMTitle(r)}
				${this.getValueHelp(r)}
			</OverflowToolbar>
		</VBox>
		<VBox height="${n}" width="100%">
			${this.getInteractiveChartFragment()}
		</VBox>
	</fbControls:VisualFilter>`};return r}(i),F=we($.prototype,"id",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),R=we($.prototype,"title",[m],{configurable:true,enumerable:true,writable:true,initializer:function(){return""}}),q=we($.prototype,"contextPath",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),N=we($.prototype,"metaPath",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),k=we($.prototype,"outParameter",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),j=we($.prototype,"valuelistProperty",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),W=we($.prototype,"selectionVariantAnnotation",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=we($.prototype,"inParameters",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),G=we($.prototype,"multipleSelectionAllowed",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),J=we($.prototype,"required",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),K=we($.prototype,"showOverlayInitially",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=we($.prototype,"renderLineChart",[P],{configurable:true,enumerable:true,writable:true,initializer:null}),X=we($.prototype,"requiredProperties",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=we($.prototype,"filterBarEntityType",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=we($.prototype,"showError",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),te=we($.prototype,"chartMeasure",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),re=we($.prototype,"UoMHasCustomAggregate",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=we($.prototype,"showValueHelp",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),ae=we($.prototype,"customAggregate",[x],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),ne=we($.prototype,"groupId",[z],{configurable:true,enumerable:true,writable:true,initializer:function(){return"$auto.visualFilters"}}),oe=we($.prototype,"errorMessageTitle",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),le=we($.prototype,"errorMessage",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),se=we($.prototype,"draftSupported",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=we($.prototype,"isValueListWithFixedValues",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),$))||_);ce=Ie;return ce},false);
//# sourceMappingURL=VisualFilter.block.js.map