/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/strings/formatMessage","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/helpers/BindingHelper","sap/m/Button","sap/m/ObjectMarker","sap/m/Popover","sap/m/Text","sap/m/VBox","sap/m/library","sap/ui/core/Lib","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(t,e,i,a,r,n,s,o,c,l,d,f,p,u,D){"use strict";var y,A,T,b,h,v,g,_,I,O,m,P,E,B,C;var x={};var M=f.ObjectMarkerVisibility;var L=f.ObjectMarkerType;var U=n.UI;var R=n.Entity;var N=i.property;var F=i.defineUI5Class;var w=e.pathInModel;var j=e.or;var V=e.not;var z=e.isEmpty;var H=e.ifElse;var k=e.and;function S(t,e,i,a){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(a):void 0})}function G(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,K(t,e)}function K(t,e){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},K(t,e)}function J(t,e,i,a,r){var n={};return Object.keys(a).forEach(function(t){n[t]=a[t]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,a){return a(t,e,i)||i},n),r&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(r):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(t,e,n),null):n}function X(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let W=(y=F("sap.fe.macros.draftIndicator.DraftIndicator"),A=N({type:"string"}),T=N({type:"string"}),b=N({type:"string",required:true}),h=N({type:"string"}),v=N({type:"boolean"}),g=N({type:"boolean"}),y(_=(I=function(e){function i(t,i){var a;a=e.call(this,t,i)||this;S(a,"id",O,a);S(a,"draftIndicatorType",m,a);S(a,"contextPath",P,a);S(a,"class",E,a);S(a,"usedInTable",B,a);S(a,"usedInAnalyticalTable",C,a);return a}x=i;G(i,e);var r=i.prototype;r.setDraftIndicatorType=function t(e){if([M.IconOnly,M.IconAndText].includes(e)){this.setProperty("draftIndicatorType",e)}else{throw new Error(`Allowed value ${e} does not match`)}};r.addAriaLabelledByForDraftIndicator=function t(e){const i=this.content?.getAriaLabelledBy()??[];if(!i.includes(e)){this.content?.addAriaLabelledBy(e)}};r.onMetadataAvailable=function t(){if(!this.content){this.content=this.createContent()}};i.formatDraftOwnerTextInPopover=function t(e,i,a,r,n){const s=p.getResourceBundleFor("sap.fe.macros");if(!s){return""}if(e){const t=r||i||n||a;if(!t){return s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_UNKNOWN")}else{return i?s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_LOCKED_BY_KNOWN",[t]):s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_UNSAVED_CHANGES_BY_KNOWN",[t])}}else{return s.getText("M_FIELD_RUNTIME_DRAFT_POPOVER_NO_DATA_TEXT")}};r.getDraftAdministrativeDataProperties=function t(){const e=this.getDataModelObjectPath(this.contextPath);const i=e?.targetEntityType.navigationProperties.find(t=>t.name==="DraftAdministrativeData");const a=i?.targetType.entityProperties;return a?.map(t=>t.name)};r.getPopoverTitleBindingExpression=function t(){return H(V(R.IsActive),w("M_COMMON_DRAFT_OBJECT","sap.fe.i18n"),H(R.HasDraft,H(V(z(w("DraftAdministrativeData/InProcessByUser"))),w("M_COMMON_DRAFT_LOCKED_OBJECT","sap.fe.i18n"),w("M_DRAFT_POPOVER_ADMIN_UNSAVED_OBJECT","sap.fe.i18n")),this.draftIndicatorType===M.IconAndText?" ":w("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_FLAGGED_OBJECT","sap.fe.i18n")))};r.getDraftOwnerTextBindingExpression=function t(){const e=this.getDraftAdministrativeDataProperties();const a=[{path:"HasDraftEntity",targetType:"any"},{path:"DraftAdministrativeData/InProcessByUser"},{path:"DraftAdministrativeData/LastChangedByUser"}];if(e?.includes("InProcessByUserDescription")){a.push({path:"DraftAdministrativeData/InProcessByUserDescription"})}if(e?.includes("LastChangedByUserDescription")){a.push({path:"DraftAdministrativeData/LastChangedByUserDescription"})}return{parts:a,formatter:i.formatDraftOwnerTextInPopover}};r.createPopover=function e(i){const r=k(V(R.IsActive),z(w("DraftAdministrativeData/LastChangeDateTime")));const n=this.draftIndicatorType===M.IconAndText?w("M_DRAFT_POPOVER_ADMIN_GENERIC_LOCKED_OBJECT_POPOVER_TEXT","sap.fe.i18n"):w("C_DRAFT_POPOVER_ADMIN_DATA_DRAFTINFO_POPOVER_NO_DATA_TEXT","sap.fe.i18n");const o=k(V(R.IsActive),V(z(w("DraftAdministrativeData/LastChangeDateTime"))));const f={parts:[{path:"M_DRAFT_POPOVER_ADMIN_LAST_CHANGE_TEXT",model:"sap.fe.i18n"},{path:"DraftAdministrativeData/LastChangeDateTime"}],formatter:t};const p=k(R.IsActive,V(z(w("DraftAdministrativeData/LastChangeDateTime"))));const y={...f};const A=u(c,{title:this.getPopoverTitleBindingExpression(),showHeader:true,verticalScrolling:false,class:"sapUiContentPadding",placement:"Auto",endButton:u(s,{icon:"sap-icon://decline",press:()=>{this.draftPopover?.close()}}),children:D(d,{class:"sapUiContentPadding",children:[u(d,{visible:r,children:u(l,{text:n})}),u(d,{visible:o,children:u(l,{text:f})}),D(d,{visible:p,children:[u(l,{text:this.getDraftOwnerTextBindingExpression()}),u(l,{class:"sapUiSmallMarginTop",text:y})]})]})});a.getTargetView(i).addDependent(A);return A};r.onObjectMarkerPressed=function t(e){const i=e.getSource();const a=i.getBindingContext();this.draftPopover??=this.createPopover(i);this.draftPopover.setBindingContext(a);this.draftPopover.openBy(i,false)};r.getIconAndTextAdditionalInfoBindingExpression=function t(){const e=this.getDraftAdministrativeDataProperties();const i=[];if(e?.includes("InProcessByUserDescription")){i.push(w("DraftAdministrativeData/InProcessByUserDescription"))}i.push(w("DraftAdministrativeData/InProcessByUser"));if(e?.includes("LastChangedByUserDescription")){i.push(w("DraftAdministrativeData/LastChangedByUserDescription"))}i.push(w("DraftAdministrativeData/LastChangedByUser"));return H(R.HasDraft,j(...i),"")};r.getIconAndTextContent=function t(){const e=H(V(R.IsActive),L.Draft,H(R.HasDraft,H(w("DraftAdministrativeData/InProcessByUser"),L.LockedBy,H(w("DraftAdministrativeData/LastChangedByUser"),L.UnsavedBy,L.Unsaved)),L.Flagged));const i=H(V(R.HasDraft),M.TextOnly,M.IconAndText);return u(o,{type:e,press:this.onObjectMarkerPressed.bind(this),visibility:i,additionalInfo:this.getIconAndTextAdditionalInfoBindingExpression(),ariaLabelledBy:this.ariaLabelledBy?this.ariaLabelledBy:[],class:this.class})};r.getIconOnlyContent=function t(){const e=H(V(R.IsActive),L.Draft,H(R.HasDraft,H(!!this.usedInAnalyticalTable,L.Locked,H(w("DraftAdministrativeData/InProcessByUser"),L.Locked,L.Unsaved)),L.Flagged));let i;if(this.usedInTable===true){i=j(V(R.IsActive),k(R.IsActive,R.HasDraft))}else{i=k(V(z(R.HasDraft)),V(U.IsEditable),R.HasDraft,V(w("DraftAdministrativeData/DraftIsCreatedByMe")))}return u(o,{type:e,press:!this.usedInAnalyticalTable?this.onObjectMarkerPressed.bind(this):undefined,visibility:M.IconOnly,visible:i,ariaLabelledBy:this.ariaLabelledBy?this.ariaLabelledBy:[],class:this.class})};r.createContent=function t(){if(this.draftIndicatorType===M.IconAndText){return this.getIconAndTextContent()}else{return this.getIconOnlyContent()}};return i}(r),O=J(I.prototype,"id",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),m=J(I.prototype,"draftIndicatorType",[T],{configurable:true,enumerable:true,writable:true,initializer:function(){return M.IconAndText}}),P=J(I.prototype,"contextPath",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),E=J(I.prototype,"class",[h],{configurable:true,enumerable:true,writable:true,initializer:function(){return""}}),B=J(I.prototype,"usedInTable",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),C=J(I.prototype,"usedInAnalyticalTable",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),I))||_);x=W;return x},false);
//# sourceMappingURL=DraftIndicator.js.map