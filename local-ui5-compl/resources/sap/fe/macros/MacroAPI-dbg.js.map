{"version":3,"names":["MacroAPI","_dec","defineUI5Class","_dec2","implementInterface","_dec3","aggregation","type","multiple","isDefault","_dec4","property","_dec5","_class","_class2","_MacroAPI","_BuildingBlock","mSettings","others","_this","call","_initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","parentContextToBind","_inheritsLoose","_proto","prototype","applySettings","oScope","eventsKeys","Object","keys","getMetadata","getEvents","eventsKey","undefined","init","getModel","oPageModel","Component","getOwnerComponentFor","setModel","rerender","UIArea","rerenderControl","content","getController","getObject","setParentBindingContext","modelName","path","setParent","_len","arguments","length","args","Array","_key","forEach","getParent","bindObject","model","events","change","oBoundContext","getBoundContext","setProperty","BuildingBlock","namespace","macroName","fragment","hasValidation","getConverterContext","oDataModelPath","contextPath","oAppComponent","appComponent","viewData","models","getData","ConverterContext","createConverterContextForMacro","startingEntitySet","name","metaModel","getDiagnostics","merge","contextLocation","createBindingContext","oData","sContextPath","uid","converterContext","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sourceRoot":".","sources":["MacroAPI.ts"],"sourcesContent":["import merge from \"sap/base/util/merge\";\nimport uid from \"sap/base/util/uid\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { aggregation, defineUI5Class, implementInterface, property } from \"sap/fe/base/ClassSupport\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport type { TemplateProcessorSettings } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport type { $ManagedObjectSettings } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type Control from \"sap/ui/core/Control\";\nimport type { $ControlSettings } from \"sap/ui/core/Control\";\nimport UIArea from \"sap/ui/core/UIArea\";\nimport type { IFormContent } from \"sap/ui/core/library\";\nimport type ClientContextBinding from \"sap/ui/model/ClientContextBinding\";\nimport type Context from \"sap/ui/model/Context\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\n\n/**\n * Base API control for building blocks.\n * @hideconstructor\n * @public\n */\n@defineUI5Class(\"sap.fe.macros.MacroAPI\")\nclass MacroAPI extends BuildingBlock implements IFormContent {\n\t@implementInterface(\"sap.ui.core.IFormContent\")\n\t__implements__sap_ui_core_IFormContent = true;\n\n\tstatic namespace = \"sap.fe.macros\";\n\n\tstatic macroName = \"Macro\";\n\n\tstatic fragment = \"sap.fe.macros.Macro\";\n\n\tstatic hasValidation = true;\n\n\t@aggregation({ type: \"sap.ui.core.Control\", multiple: false, isDefault: true })\n\tcontent!: Control;\n\n\tconstructor(mSettings?: $ControlSettings & PropertiesOf<MacroAPI>, others?: $ControlSettings) {\n\t\tsuper(mSettings, others);\n\t}\n\n\tapplySettings(mSettings: $ManagedObjectSettings, oScope?: object): this {\n\t\t// Cleanup events\n\t\tif (mSettings) {\n\t\t\tconst eventsKeys = Object.keys(this.getMetadata().getEvents());\n\t\t\tfor (const eventsKey of eventsKeys) {\n\t\t\t\tif (mSettings[eventsKey as keyof $ManagedObjectSettings] === undefined) {\n\t\t\t\t\tdelete mSettings[eventsKey as keyof $ManagedObjectSettings];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn super.applySettings(mSettings, oScope);\n\t}\n\n\tinit(): void {\n\t\tsuper.init();\n\t\tif (!this.getModel(\"_pageModel\")) {\n\t\t\tconst oPageModel = Component.getOwnerComponentFor(this)?.getModel(\"_pageModel\");\n\t\t\tif (oPageModel) {\n\t\t\t\tthis.setModel(oPageModel, \"_pageModel\");\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Defines the path of the context used in the current page or block.\n\t * This setting is defined by the framework.\n\t * @public\n\t */\n\t@property({ type: \"string\" })\n\tcontextPath!: string;\n\n\t/**\n\t * Defines the relative path of the property in the metamodel, based on the current contextPath.\n\t * @public\n\t */\n\t@property({ type: \"string\" })\n\tmetaPath!: string;\n\n\trerender(): void {\n\t\t(UIArea as unknown as { rerenderControl(control: Control): void }).rerenderControl(this.content);\n\t}\n\n\tgetController(): PageController {\n\t\treturn (this.getModel(\"$view\") as JSONModel)?.getObject(\"/\").getController() as PageController;\n\t}\n\n\t/**\n\t * Retrieve a Converter Context.\n\t * @param oDataModelPath\n\t * @param contextPath\n\t * @param mSettings\n\t * @returns A Converter Context\n\t */\n\tstatic getConverterContext = function (\n\t\toDataModelPath: DataModelObjectPath<unknown>,\n\t\tcontextPath: string,\n\t\tmSettings: TemplateProcessorSettings\n\t): ConverterContext {\n\t\tconst oAppComponent = mSettings.appComponent;\n\t\tconst viewData = mSettings.models.viewData && mSettings.models.viewData.getData();\n\t\treturn ConverterContext.createConverterContextForMacro(\n\t\t\toDataModelPath.startingEntitySet.name,\n\t\t\tmSettings.models.metaModel,\n\t\t\toAppComponent && oAppComponent.getDiagnostics(),\n\t\t\tmerge,\n\t\t\toDataModelPath.contextLocation,\n\t\t\tviewData\n\t\t);\n\t};\n\n\t/**\n\t * Create a Binding Context.\n\t * @param oData\n\t * @param mSettings\n\t * @returns The binding context\n\t */\n\tstatic createBindingContext = function (oData: object, mSettings: TemplateProcessorSettings): Context {\n\t\tconst sContextPath = `/uid--${uid()}`;\n\t\tmSettings.models.converterContext.setProperty(sContextPath, oData);\n\t\treturn mSettings.models.converterContext.createBindingContext(sContextPath)!;\n\t};\n\n\tparentContextToBind: Record<string, string> = {};\n\n\t/**\n\t * Keep track of a binding context that should be assigned to the parent of that control.\n\t * @param modelName The model name that the context will relate to\n\t * @param path The path of the binding context\n\t */\n\tsetParentBindingContext(modelName: string, path: string): void {\n\t\tthis.parentContextToBind[modelName] = path;\n\t}\n\n\tsetParent(...args: unknown[]): void {\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n\t\t// @ts-ignore\n\t\tsuper.setParent(...args);\n\t\tObject.keys(this.parentContextToBind).forEach((modelName) => {\n\t\t\tthis.getParent()!.bindObject({\n\t\t\t\tpath: this.parentContextToBind[modelName],\n\t\t\t\tmodel: modelName,\n\t\t\t\tevents: {\n\t\t\t\t\tchange: function (this: ClientContextBinding) {\n\t\t\t\t\t\tconst oBoundContext = this.getBoundContext() as InternalModelContext;\n\t\t\t\t\t\tif (oBoundContext && !oBoundContext.getObject()) {\n\t\t\t\t\t\t\toBoundContext.setProperty(\"\", {});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n}\n\nexport default MacroAPI;\n"],"mappings":"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","ignoreList":[],"file":"MacroAPI-dbg.js"}