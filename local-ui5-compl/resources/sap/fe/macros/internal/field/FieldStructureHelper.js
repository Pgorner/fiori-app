/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/annotations/DataField","sap/fe/core/formatters/CollaborationFormatter","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/BindingHelper","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/helpers/TitleHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/SemanticObjectHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldTemplating","sap/fe/macros/internal/valuehelp/AdditionalValueFormatter","sap/fe/macros/situations/SituationsIndicator","sap/ui/mdc/enums/FieldEditMode"],function(t,e,a,i,o,n,r,s,l,d,c,p,u,f,m,y,h,P,v,x){"use strict";var g={};var M=h.setEditStyleProperties;var O=h.isUsedInNavigationWithQuickViewFacets;var b=h.isRetrieveTextFromValueListEnabled;var I=h.hasPropertyInsertRestrictions;var S=h.getVisibleExpression;var E=h.getValueBinding;var D=h.getTextBindingExpression;var C=h.getDraftIndicatorVisibleBinding;var F=h.getDataModelObjectPathForValue;var T=m.manageSemanticObjectsForCurrentUser;var j=m.getPropertyWithSemanticObject;var U=f.isSemanticKey;var V=f.getAssociatedExternalIdPropertyPath;var L=f.getAssociatedExternalIdProperty;var A=u.getTargetObjectPath;var $=u.getRelativePaths;var w=u.getContextRelativeTargetObjectPath;var R=p.isPropertyPathExpression;var B=p.isProperty;var k=c.getTitleBindingExpression;var H=d.generate;var W=s.getRequiredPropertiesFromUpdateRestrictions;var N=s.getRequiredPropertiesFromInsertRestrictions;var _=r.UI;var q=i.isDataField;var Q=e.CollaborationFieldGroupPrefix;var K=t.wrapBindingExpression;var G=t.resolveBindingString;var z=t.pathInModel;var J=t.not;var X=t.ifElse;var Y=t.getExpressionFromAnnotation;var Z=t.formatWithTypeInformation;var tt=t.formatResult;var et=t.fn;var at=t.equal;var it=t.constant;var ot=t.compileExpression;var nt=t.and;function rt(t,e,a,i,o){const n={...t};n.change=t.change;n.metaPath=i?i:t.metaPath;n.contextPath=o?o:t.contextPath;n.visible=t.visible;n.liveChangeEnabled=!!t.onLiveChange||t.hasListeners?.("liveChange");n.semanticObject=t.semanticObject;n.value=t.value;n.mainPropertyRelativePath=t.mainPropertyRelativePath;if(!n.vhIdPrefix){n.vhIdPrefix="FieldValueHelp";n._flexId=t.id;if(!n.idPrefix){n.idPrefix=t.id}n.showValueHelpTemplate=true}n.formatOptions??={};n.formatOptions=mt(n);n.valueHelpMetaPath=i?i:n.metaPath;lt(n,a);n.convertedMetaPath=gt(n.convertedMetaPath);Dt(n);ft(n);n.dataSourcePath=A(n.dataModelPath);pt(n);n.entityType=n.odataMetaModel.createBindingContext(`/${n.dataModelPath.targetEntityType.fullyQualifiedName}`);if(n.formatOptions?.forInlineCreationRows===true){n.hasPropertyInsertRestrictions=I(n.dataModelPath)}ct(n);st(n);dt(n);n.formatOptions=n.formatOptions?n.formatOptions:{};St(n,n.dataModelPathExternalID||n.dataModelPath,e,a);Mt(n,n.convertedMetaPath,n.dataModelPath,a);bt(n,a?.appComponent);n.valueState=Et(n);if(n.editStyle==="InputWithValueHelp"){n.editStylePlaceholder=xt(n)}const r=["Avatar","AmountWithCurrency"];if(n.displayStyle&&!r.includes(n.displayStyle)&&n.dataModelPath.targetObject){n.text=n.text??n.value??h.getTextBinding(n.dataModelPathExternalID||n.dataModelPath,n.formatOptions)}else{n.text=""}if(n.formatOptions.showEmptyIndicator){n.emptyIndicatorMode=String(n.formatOptions.showEmptyIndicator)==="true"?"On":undefined}else{n.emptyIndicatorMode=undefined}if(B(n.convertedMetaPath)&&n.convertedMetaPath.annotations?.UI?.DataFieldDefault!==undefined){n.metaPath=n.odataMetaModel.createBindingContext(`@${"com.sap.vocabularies.UI.v1.DataFieldDefault"}`,i?i:n.metaPath)}if(n.readOnly!==undefined){n.editMode=ot(X(at(G(n.readOnly,"boolean"),true),"Display","Editable"))}n.eventHandlers={change:()=>{},liveChange:()=>{},validateFieldGroup:()=>{}};return n}g.setUpField=rt;function st(t){const e=y.getEditableExpressionAsObject(t.propertyForFieldControl,t.convertedMetaPath,t.dataModelPath);if(l.isCollaborationDraftSupported(t.odataMetaModel)&&t.editMode!==x.Display){const a=true;const i=y.getCollaborationExpression(t.dataModelPath,o.hasCollaborationActivity);const n=ot(nt(e,J(i)));const r=ot(X(i,it("ReadOnly"),X(nt(_.IsInactive,!!t.hasPropertyInsertRestrictions),"Display",t.editModeAsObject)));t.collaborationEnabled=a;t.collaborationExpression=i;t.editableExpression=n;t.editMode=r}else{t.editableExpression=ot(e)}}g.computeCollaborationProperties=st;function lt(t,e){t.convertedMetaPath=a.convertMetaModelContext(t.metaPathContext?t.metaPathContext:t.metaPath);let i=a.getInvolvedDataModelObjects(t.metaPathContext?t.metaPathContext:t.metaPath,t.contextPath);i=F(i)||i;t.dataModelPath=i;t.property=i.targetObject;t.odataMetaModel=e.models.metaModel||e.models.contextPath;t.propertyForFieldControl=i?.targetObject?.Value?(i?.targetObject).Value:i?.targetObject}g.computeCommonProperties=lt;function dt(t){const e=N((t.contextPathContext?t.contextPathContext:t.contextPath)?.getPath().replaceAll("/$NavigationPropertyBinding/","/"),t.odataMetaModel);const a=W((t.contextPathContext?t.contextPathContext:t.contextPath)?.getPath().replaceAll("/$NavigationPropertyBinding/","/"),t.odataMetaModel);const i={requiredPropertiesFromInsertRestrictions:e,requiredPropertiesFromUpdateRestrictions:a};const o=t.liveChangeEnabled;const n=y.getEnabledExpression(t.propertyForFieldControl,t.convertedMetaPath,false,t.dataModelPath);const r=y.getRequiredExpression(t.propertyForFieldControl,t.convertedMetaPath,false,false,i,t.dataModelPath);t.liveChangeEnabled=o;t.enabledExpression=n;t.requiredExpression=r}g.computeEditableExpressions=dt;function ct(t){if(t.editMode!==undefined&&t.editMode!==null){t.editModeAsObject=t.editMode}else{const e=t.formatOptions?.measureDisplayMode?t.formatOptions.measureDisplayMode==="ReadOnly":false;t.editModeAsObject=y.getEditMode(t.propertyForFieldControl,t.dataModelPath,e,true,t.convertedMetaPath);t.editMode=ot(X(nt(_.IsInactive,!!t.hasPropertyInsertRestrictions),"Display",t.editModeAsObject))}}g.computeEditMode=ct;function pt(t){const e=L(t.property);if(e){if(t.property)t.property.type=e.type;if(q(t.convertedMetaPath)){t.convertedMetaPath.Value.$target.type=e.type}const i=V(t.property);const o=t.metaPath.getModel().createBindingContext(t.contextPath?.getPath()+"/"+i,t.metaPath);t.convertedMetaPathExternalID=a.convertMetaModelContext(o);let n=a.getInvolvedDataModelObjects(o,t.contextPath);n=F(n)||n;t.dataModelPathExternalID=n}}g.computeExternalID=pt;function ut(t,e){const a=["InputWithValueHelp","TextArea","DatePicker","TimePicker","DateTimePicker","InputWithUnit","Input","InputMask"];if(!e){return}const i=e.getSideEffectsService();const o=i.computeFieldGroupIds(t.dataModelPath.targetEntityType?.fullyQualifiedName??"",t.dataModelPath.targetObject?.fullyQualifiedName??"");if(t.collaborationEnabled&&a.includes(t.editStyle||"")){const e=`${Q}${t.dataSourcePath}`;o.push(e);t.mainPropertyRelativePath=B(t.dataModelPath.targetObject)?w(t.dataModelPath):undefined}return o.length?o.join(","):undefined}function ft(t){if(t._flexId){t._apiId=t._flexId;t._flexId=Ct(t._flexId);t._vhFlexId=`${t._flexId}_${t.vhIdPrefix}`}if(t.idPrefix){t.editStyleId=H([t.idPrefix,"Field-edit"])}if(t.formatOptions?.fieldMode==="nowrapper"&&t.editMode==="Display"){if(t._flexId){t.displayStyleId=t._flexId}else{t.displayStyleId=t.idPrefix?H([t.idPrefix,"Field-content"]):undefined}}else if(t.idPrefix){t.displayStyleId=H([t.idPrefix,"Field-display"])}}g.computeIDs=ft;function mt(t){return{...t.formatOptions,textAlignMode:t.formatOptions.textAlignMode??"Form",showEmptyIndicator:t.formatOptions.showEmptyIndicator??true,displayMode:t.formatOptions.displayMode,measureDisplayMode:t.formatOptions.measureDisplayMode,textLinesEdit:t.formatOptions.textLinesEdit,textMaxLines:t.formatOptions.textMaxLines,textMaxCharactersDisplay:t.formatOptions.textMaxCharactersDisplay,textExpandBehaviorDisplay:t.formatOptions.textExpandBehaviorDisplay,textMaxLength:t.formatOptions.textMaxLength,fieldEditStyle:t.formatOptions.fieldEditStyle,radioButtonsHorizontalLayout:t.formatOptions.radioButtonsHorizontalLayout,showTime:t.formatOptions.showTime,showTimezone:t.formatOptions.showTimezone,showDate:t.formatOptions.showDate}}g.getFormatOptions=mt;function yt(t,e){let a=z(w(e));const i=t?.displayMode;const o=R(e.targetObject)?e.targetObject.$target:e.targetObject;const r=o.annotations?.Common?.Text;if(r===undefined){return undefined}a=Z(o,a);switch(i){case"ValueDescription":const t=$(e);return ot(Y(r,t));case"DescriptionValue":return ot(tt([a],n.formatToKeepWhitespace));default:return undefined}}function ht(t,e){const a={};if(t){const i=t[e];if(i){Object.keys(i).forEach(function(t){a[t]=i[t]})}}return a}function Pt(t,e,a,i,o){if(o){t.hasQuickView=true;t.quickViewType="Facets"}if(i){const i=T(t.semanticObject,a,e);if(i.hasReachableStaticSemanticObject||i.dynamicSemanticObjects.length){t.hasQuickView=true;t.quickViewType=o?"FacetsAndSemanticLinks":"SemanticLinks";t.dynamicSemanticObjects=i.hasReachableStaticSemanticObject!==true?i.dynamicSemanticObjects:undefined}}}function vt(t,e){return!!j(e)||t.semanticObject!==undefined&&t.semanticObject!==""}function xt(t){let e;const a=t.editStylePlaceholder;const i=t.formatOptions.textAlignMode;if(i==="Table"){e=t.dataModelPath.targetEntityType}const o=t.dataModelPath.targetObject?.name;const n=z(`${o}@$ui5.fe.recommendations.placeholderValue`);const r=z(`${o}@$ui5.fe.recommendations.placeholderDescription`);const s=tt([n,r,z(`/recommendationsData`,"internal"),z(`/currentCtxt`,"internal"),z(`${o}@$ui5.fe.messageType`),a,t.formatOptions.displayMode],P.formatPlaceholder,e);return ot(s)}g.setInputWithValuehelpPlaceholder=xt;function gt(t){const e={...t};if(t?.term==="com.sap.vocabularies.UI.v1.DataPoint"){e.$Type=t.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}return e}g.setUpDataPointType=gt;function Mt(t,e,a,i){const o=t;const n=a.targetObject;if(!a.targetObject){o.displayStyle="Text";return o}o.hasUnitOrCurrency=n.annotations?.Measures?.Unit!==undefined||n.annotations?.Measures?.ISOCurrency!==undefined;o.hasValidAnalyticalCurrencyOrUnit=y.hasValidAnalyticalCurrencyOrUnit(a);o.textFromValueList=K(ot(et("FieldRuntime.retrieveTextFromValueList",[z(w(a)),`/${n.fullyQualifiedName}`,o.formatOptions.displayMode])),false);if(n.annotations?.UI?.IsImage){o.displayStyle="File";return o}if(n.annotations?.UI?.IsImageURL){o.displayStyle="Avatar";return o}if(n.annotations?.UI?.InputMask){o.displayStyle="Text";return o}if(n.type==="Edm.Stream"){o.displayStyle="File";return o}Ot(a,o);switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataPointType":o.displayStyle="DataPoint";return o;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.Target?.$target?.$Type==="com.sap.vocabularies.UI.v1.DataPointType"){o.displayStyle="DataPoint";return o}else if(e.Target?.$target?.$Type==="com.sap.vocabularies.Communication.v1.ContactType"){o.displayStyle="Contact";return o}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":o.displayStyle="Button";return o;case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":o.displayStyle="Link";return o}const r=O(a,n);const s=vt(o,a);if(U(n,a)&&o.formatOptions.semanticKeyStyle){Pt(o,i,a,s,r);It(o,a);o.showErrorIndicator=a.contextLocation?.targetObject?._type==="NavigationProperty"&&!o.formatOptions.fieldGroupDraftIndicatorPropertyPath;o.situationsIndicatorPropertyPath=a.targetObject.name;o.displayStyle=o.formatOptions.semanticKeyStyle==="ObjectIdentifier"?"ObjectIdentifier":"LabelSemanticKey";return o}if(e.Criticality){Pt(o,i,a,s,r);o.displayStyle="ObjectStatus";return o}if(n.annotations?.Measures?.ISOCurrency&&String(o.formatOptions.isCurrencyAligned)==="true"&&o.formatOptions.measureDisplayMode!=="Hidden"){o.valueAsStringBindingExpression=o.value?o.value:E(a,o.formatOptions,true,true,undefined,true);o.unitBindingExpression=ot(y.getBindingForUnitOrCurrency(a));o.displayStyle="AmountWithCurrency";return o}if(n.annotations?.Communication?.IsEmailAddress||n.annotations?.Communication?.IsPhoneNumber){o.displayStyle="Link";return o}if(n.annotations?.UI?.MultiLineText){o.displayStyle="ExpandableText";return o}if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){o.displayStyle="Link";return o}o.displayStyle="Text";Pt(o,i,a,s,r);if(o.hasQuickView){o.displayStyle="LinkWithQuickView"}return o}g.setUpDisplayStyle=Mt;function Ot(t,e){if(U(t.targetObject,t)){e.hasSituationsIndicator=v.getSituationsNavigationProperty(t.targetEntityType)!==undefined;if(t.contextLocation?.targetEntitySet?.annotations?.Common?.DraftRoot&&t.targetEntitySet?.annotations?.Common?.DraftRoot&&e.formatOptions?.hasDraftIndicator===true){e.draftIndicatorVisible=C(t.targetObject?.name);e.addDraftIndicator=true}}}function bt(t,e){const a=t;M(a,a.convertedMetaPath,a.dataModelPath);a.fieldGroupIds=ut(a,e);return a}g.setUpEditStyle=bt;function It(t,e){const a=t.formatOptions?.semanticKeyStyle;const i=t.formatOptions.displayMode;t.identifierTitle=k(e,D,{displayMode:i,splitTitleOnTwoLines:t.formatOptions.semanticKeyStyle==="ObjectIdentifier"},undefined,undefined);t.identifierText=a==="ObjectIdentifier"?yt(t.formatOptions,e):undefined}g.setUpObjectIdentifierTitleAndText=It;function St(t,e,a,i){const o=ht(a,(t.metaPathContext?t.metaPathContext:t.metaPath).getPath());if(!t.formatOptions.displayMode){t.formatOptions.displayMode=y.getDisplayMode(e)}if(t.formatOptions.displayMode==="Description"){t.valueAsStringBindingExpression=t.value?t.value:E(e,t.formatOptions,true,true,undefined,true)}t.formatOptions.textLinesEdit=o.textLinesEdit||o.formatOptions&&o.formatOptions.textLinesEdit||t.formatOptions.textLinesEdit||4;t.formatOptions.textMaxLines=o.textMaxLines||o.formatOptions&&o.formatOptions.textMaxLines||t.formatOptions.textMaxLines;if(i.models.viewData?.getProperty("/retrieveTextFromValueList")){t.formatOptions.retrieveTextFromValueList=b(e.targetObject,t.formatOptions);if(t.formatOptions.retrieveTextFromValueList){const a=!!e?.targetEntityType?.annotations?.UI?.TextArrangement;t.formatOptions.displayMode=a?t.formatOptions.displayMode:"DescriptionValue"}}}g.setUpFormatOptions=St;function Et(t){let e;const a=t.formatOptions?.textAlignMode?t.formatOptions?.textAlignMode:"Form";const i=z(w(t.dataModelPath));const o=$(t.dataModelPath);const n=Y(t.dataModelPath?.targetObject?.annotations?.Common?.Text,o);const r=t.dataModelPath.targetObject?.name;const s=z(`${r}@$ui5.fe.recommendations.placeholderValue`);const l=z(`${r}@$ui5.fe.recommendations.placeholderDescription`);if(a==="Table"){e=tt([s,l,z(`/recommendationsData`,"internal"),z(`/isEditable`,"ui"),t.dataSourcePath,i,n],P.formatValueState,t.dataModelPath.targetEntityType)}else{e=tt([s,l,z(`/recommendationsData`,"internal"),z(`/isEditable`,"ui"),t.dataSourcePath,i,n],P.formatValueState)}t.valueState=ot(e);return t.valueState}g.setUpValueState=Et;function Dt(t){const e=a.getInvolvedDataModelObjects(t.metaPathContext?t.metaPathContext:t.metaPath,t.contextPath);t.visible=t.visible??=S(e,t.formatOptions);t.displayVisible=t.formatOptions?.fieldMode==="nowrapper"?t.visible:undefined}g.setUpVisibleProperties=Dt;function Ct(t){return`${t}-content`}return g},false);
//# sourceMappingURL=FieldStructureHelper.js.map