{"version":3,"names":["ActionHelper","getMultiSelectDisabledActions","collections","multiSelectDisabledActions","actions","filter","collection","$Type","action","actionTarget","ActionTarget","isBound","parameter","parameters","isPathAnnotationExpression","annotations","UI","Hidden","Common","FieldControl","push","name","getPressEventDataFieldForActionButton","sId","oAction","oParams","sOperationAvailableMap","sInvocationGrouping","InvocationGrouping","$EnumMember","CommonHelper","addSingleQuotes","Label","generateFunction","Action","objectToString","getNumberOfContextsExpression","vActionEnabled","forContextMenu","arguments","length","undefined","sNumberOfSelectedContexts","selectedContext","getOperationAvailableMap","aCollection","sControl","oContext","oOperationAvailableMap","forEach","oRecord","actionName","includes","Determining","_getOperationAvailableMapOfTable","_getOperationAvailableMapOfChart","oDataFieldForAction","sActionName","oConverterContext","Core","OperationAvailable","bindingParameterFullName","fullyQualifiedName","targetExpression","getExpressionFromAnnotation","path","bindingContextPathVisitor","getConvertedTypes","isPathInModelExpression","_addToMap","oResult","getActionPath","context","sProperty","substring","sBindingParameter","sKey","oValue","oMap"],"sourceRoot":".","sources":["ActionHelper.ts"],"sourcesContent":["import type { DataFieldAbstractTypes, OperationGroupingType } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTypes, type DataFieldForAction } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { getExpressionFromAnnotation, isPathInModelExpression } from \"sap/fe/base/BindingToolkit\";\nimport type ConverterContext from \"sap/fe/core/converters/ConverterContext\";\nimport { bindingContextPathVisitor } from \"sap/fe/core/helpers/BindingHelper\";\nimport { isPathAnnotationExpression } from \"sap/fe/core/helpers/TypeGuards\";\nimport type { ComputedAnnotationInterface } from \"sap/fe/core/templating/UIFormatters\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport type { MetaModelEnum, MetaModelType } from \"../../../../../../../../types/metamodel_types\";\n\nconst ActionHelper = {\n\t/**\n\t * Returns an array of actions that are not enabled with a multiple selection.\n\t * @param collections Array of records\n\t * @returns An array of action paths\n\t */\n\tgetMultiSelectDisabledActions(collections?: DataFieldAbstractTypes[]): string[] {\n\t\tconst multiSelectDisabledActions: string[] = [];\n\t\tconst actions = (collections?.filter((collection) => collection.$Type === UIAnnotationTypes.DataFieldForAction) ??\n\t\t\t[]) as DataFieldForAction[];\n\t\tfor (const action of actions) {\n\t\t\tconst actionTarget = action?.ActionTarget;\n\t\t\tif (actionTarget?.isBound === true) {\n\t\t\t\tfor (const parameter of actionTarget.parameters) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tisPathAnnotationExpression(parameter.annotations.UI?.Hidden) ||\n\t\t\t\t\t\tisPathAnnotationExpression(parameter.annotations.Common?.FieldControl)\n\t\t\t\t\t) {\n\t\t\t\t\t\tmultiSelectDisabledActions.push(actionTarget.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn multiSelectDisabledActions;\n\t},\n\n\t/**\n\t * Method to get the expression for the 'press' event for the DataFieldForActionButton.\n\t * @param sId Control ID\n\t * @param oAction Action object\n\t * @param oParams Parameters\n\t * @param oParams.invocationGrouping Invocation grouping\n\t * @param oParams.controlId Control ID\n\t * @param oParams.operationAvailableMap OperationAvailableMap\n\t * @param oParams.model Model\n\t * @param oParams.label Label\n\t * @param oParams.contexts Contexts\n\t * @param sOperationAvailableMap OperationAvailableMap as stringified JSON object\n\t * @returns The binding expression\n\t */\n\tgetPressEventDataFieldForActionButton(\n\t\tsId: string,\n\t\toAction: MetaModelType<DataFieldForAction> & { InvocationGrouping: MetaModelEnum<OperationGroupingType> },\n\t\toParams: {\n\t\t\tinvocationGrouping?: string;\n\t\t\tcontrolId?: string;\n\t\t\toperationAvailableMap?: string;\n\t\t\tmodel?: string;\n\t\t\tlabel?: string;\n\t\t\tcontexts?: string;\n\t\t},\n\t\tsOperationAvailableMap: string\n\t): string {\n\t\tconst sInvocationGrouping =\n\t\t\toAction.InvocationGrouping &&\n\t\t\toAction.InvocationGrouping.$EnumMember === \"com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet\"\n\t\t\t\t? \"ChangeSet\"\n\t\t\t\t: \"Isolated\";\n\t\toParams = oParams || {};\n\t\toParams[\"invocationGrouping\"] = CommonHelper.addSingleQuotes(sInvocationGrouping);\n\t\toParams[\"controlId\"] = CommonHelper.addSingleQuotes(sId);\n\t\toParams[\"operationAvailableMap\"] = CommonHelper.addSingleQuotes(sOperationAvailableMap);\n\t\toParams[\"model\"] = \"${$source>/}.getModel()\";\n\t\toParams[\"label\"] = oAction.Label && CommonHelper.addSingleQuotes(oAction.Label, true);\n\n\t\treturn CommonHelper.generateFunction(\n\t\t\t\".editFlow.invokeAction\",\n\t\t\tCommonHelper.addSingleQuotes(oAction.Action!),\n\t\t\tCommonHelper.objectToString(oParams)\n\t\t);\n\t},\n\t/**\n\t * Return Number of contexts expression.\n\t * @param vActionEnabled Status of action (single or multiselect)\n\t * @param forContextMenu Indicates if the action appears in the context menu. If false, the action appears in the table toolbar\n\t * @returns Number of contexts expression\n\t */\n\tgetNumberOfContextsExpression(vActionEnabled: string, forContextMenu = false): string {\n\t\tlet sNumberOfSelectedContexts;\n\t\tconst selectedContext = !forContextMenu\n\t\t\t? \"${internal>numberOfSelectedContexts}\"\n\t\t\t: \"${internal>contextmenu/numberOfSelectedContexts}\";\n\t\tif (vActionEnabled === \"single\") {\n\t\t\tsNumberOfSelectedContexts = selectedContext + \" === 1\";\n\t\t} else {\n\t\t\tsNumberOfSelectedContexts = selectedContext + \" > 0\";\n\t\t}\n\t\treturn sNumberOfSelectedContexts;\n\t},\n\t/**\n\t * Return UI Control (LineItem/Chart) Operation Available Map.\n\t * @param aCollection Array of records\n\t * @param sControl Control name (lineItem / chart)\n\t * @param oContext Converter context\n\t * @returns The record containing all action names and their corresponding Core.OperationAvailable property paths\n\t */\n\tgetOperationAvailableMap(\n\t\taCollection: DataFieldAbstractTypes[] | undefined,\n\t\tsControl: string,\n\t\toContext: ConverterContext<unknown> | ComputedAnnotationInterface\n\t): Record<string, unknown> {\n\t\tlet oOperationAvailableMap: Record<string, unknown> = {};\n\t\tif (aCollection) {\n\t\t\taCollection.forEach((oRecord: DataFieldAbstractTypes) => {\n\t\t\t\tif (oRecord.$Type === UIAnnotationTypes.DataFieldForAction) {\n\t\t\t\t\tif (oRecord.$Type === UIAnnotationTypes.DataFieldForAction) {\n\t\t\t\t\t\tconst actionName = oRecord.Action as string;\n\t\t\t\t\t\tif (!actionName?.includes(\"/\") && !oRecord.Determining) {\n\t\t\t\t\t\t\tif (sControl === \"table\") {\n\t\t\t\t\t\t\t\toOperationAvailableMap = this._getOperationAvailableMapOfTable(\n\t\t\t\t\t\t\t\t\toRecord,\n\t\t\t\t\t\t\t\t\tactionName,\n\t\t\t\t\t\t\t\t\toOperationAvailableMap,\n\t\t\t\t\t\t\t\t\toContext as ConverterContext<unknown>\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t} else if (sControl === \"chart\") {\n\t\t\t\t\t\t\t\toOperationAvailableMap = this._getOperationAvailableMapOfChart(\n\t\t\t\t\t\t\t\t\tactionName,\n\t\t\t\t\t\t\t\t\toOperationAvailableMap,\n\t\t\t\t\t\t\t\t\toContext as ComputedAnnotationInterface\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn oOperationAvailableMap;\n\t},\n\n\t/**\n\t * Return LineItem Action Operation Available Map.\n\t * @private\n\t * @param oDataFieldForAction Data field for action object\n\t * @param sActionName Action name\n\t * @param oOperationAvailableMap Operation available map object\n\t * @param oConverterContext Converter context object\n\t * @returns The record containing all action name of line item and the corresponding Core.OperationAvailable property path\n\t */\n\t_getOperationAvailableMapOfTable(\n\t\toDataFieldForAction: DataFieldForAction,\n\t\tsActionName: string,\n\t\toOperationAvailableMap: Record<string, unknown>,\n\t\toConverterContext: ConverterContext<unknown>\n\t): Record<string, unknown> {\n\t\tconst actionTarget = oDataFieldForAction.ActionTarget;\n\t\tif (actionTarget?.annotations?.Core?.OperationAvailable === null) {\n\t\t\t// We disabled action advertisement but kept it in the code for the time being\n\t\t\t//oOperationAvailableMap = this._addToMap(sActionName, null, oOperationAvailableMap);\n\t\t} else if (actionTarget?.parameters?.length) {\n\t\t\tconst bindingParameterFullName = actionTarget.parameters[0].fullyQualifiedName,\n\t\t\t\ttargetExpression = getExpressionFromAnnotation(\n\t\t\t\t\tactionTarget?.annotations?.Core?.OperationAvailable,\n\t\t\t\t\t[],\n\t\t\t\t\tundefined,\n\t\t\t\t\t(path: string) => bindingContextPathVisitor(path, oConverterContext.getConvertedTypes(), bindingParameterFullName)\n\t\t\t\t);\n\t\t\tif (isPathInModelExpression(targetExpression)) {\n\t\t\t\toOperationAvailableMap = this._addToMap(sActionName, targetExpression.path, oOperationAvailableMap);\n\t\t\t} else if (actionTarget?.annotations?.Core?.OperationAvailable !== undefined) {\n\t\t\t\toOperationAvailableMap = this._addToMap(sActionName, targetExpression, oOperationAvailableMap);\n\t\t\t}\n\t\t}\n\t\treturn oOperationAvailableMap;\n\t},\n\n\t/**\n\t * Return LineItem Action Operation Available Map.\n\t * @private\n\t * @param sActionName Action name\n\t * @param oOperationAvailableMap Operation available map object\n\t * @param oContext Context object\n\t * @param oContext.context Context object\n\t * @returns The record containing all action name of chart and the corresponding Core.OperationAvailable property path\n\t */\n\t_getOperationAvailableMapOfChart(\n\t\tsActionName: string,\n\t\toOperationAvailableMap: Record<string, unknown>,\n\t\toContext: ComputedAnnotationInterface\n\t): Record<string, unknown> {\n\t\tlet oResult = CommonHelper.getActionPath(oContext.context, false, sActionName, true);\n\t\tif (oResult === null) {\n\t\t\toOperationAvailableMap = this._addToMap(sActionName, null, oOperationAvailableMap);\n\t\t} else {\n\t\t\toResult = CommonHelper.getActionPath(oContext.context, false, sActionName) as {\n\t\t\t\tsContextPath: string;\n\t\t\t\tsProperty: string;\n\t\t\t\tsBindingParameter: string;\n\t\t\t};\n\t\t\tif (oResult.sProperty) {\n\t\t\t\toOperationAvailableMap = this._addToMap(\n\t\t\t\t\tsActionName,\n\t\t\t\t\toResult.sProperty.substring(oResult.sBindingParameter.length + 1),\n\t\t\t\t\toOperationAvailableMap\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn oOperationAvailableMap;\n\t},\n\n\t/**\n\t * Return Map.\n\t * @private\n\t * @param sKey Key\n\t * @param oValue Value\n\t * @param oMap Map object\n\t * @returns Map object\n\t */\n\t_addToMap(sKey: string, oValue: unknown, oMap: Record<string, unknown>): Record<string, unknown> {\n\t\tif (sKey && oMap) {\n\t\t\toMap[sKey] = oValue;\n\t\t}\n\t\treturn oMap;\n\t}\n};\n\nexport default ActionHelper;\n"],"mappings":"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","ignoreList":[],"file":"ActionHelper-dbg.js"}