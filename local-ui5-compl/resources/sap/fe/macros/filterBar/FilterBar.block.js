/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/jsx-runtime/jsx","sap/fe/core/TemplateModel","sap/fe/core/buildingBlocks/templating/BuildingBlockSupport","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor","sap/fe/core/buildingBlocks/templating/BuildingBlockTemplatingBase","sap/fe/core/converters/MetaModelConverter","sap/fe/core/converters/controls/Common/DataVisualization","sap/fe/core/converters/controls/ListReport/FilterBar","sap/fe/core/helpers/MetaModelFunction","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/macros/CommonHelper","sap/fe/macros/field/FieldHelper","sap/fe/macros/filter/FilterFieldHelper","sap/fe/macros/filter/FilterUtils","sap/fe/macros/filterBar/DraftEditState","sap/fe/macros/filterBar/FilterHelper","sap/fe/macros/fpm/CustomFragment.block","sap/fe/macros/internal/FilterField.block","sap/ui/core/CustomData","sap/ui/core/fieldhelp/FieldHelpCustomData","sap/ui/mdc/FilterField","sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Popover","sap/ui/mdc/valuehelp/content/FixedList","sap/ui/mdc/valuehelp/content/FixedListItem","../ValueHelp","../controls/CustomFilterFieldContentWrapper","../controls/FilterBar","../table/SlotColumn","./FilterBarAPI","sap/fe/base/jsx-runtime/jsx"],function(e,t,i,r,a,n,l,o,s,u,c,p,d,f,h,b,g,m,y,F,v,P,C,S,B,D,I,w,_,x,A,z,E){"use strict";var T,M,k,H,R,O,V,$,j,L,N,q,U,W,J,K,G,X,Q,Y,Z,ee,te,ie,re,ae,ne,le,oe,se,ue,ce,pe,de,fe,he,be,ge,me,ye,Fe,ve,Pe,Ce,Se,Be,De,Ie,we,_e,xe,Ae,ze,Ee,Te,Me,ke,He,Re,Oe,Ve,$e,je;var Le={};var Ne=m.getFilterConditions;var qe=h.maxConditions;var Ue=p.generate;var We=u.getSearchRestrictions;var Je=s.getSelectionFields;var Ke=o.getSelectionVariant;var Ge=l.getInvolvedDataModelObjects;var Xe=a.storeObjectValue;var Qe=r.defineBuildingBlock;var Ye=r.blockEvent;var Ze=r.blockAttribute;var et=r.blockAggregation;function tt(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function it(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rt(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,at(e,t)}function at(e,t){return at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},at(e,t)}function nt(e,t,i,r,a){var n={};return Object.keys(r).forEach(function(e){n[e]=r[e]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},n),a&&void 0!==n.initializer&&(n.value=n.initializer?n.initializer.call(a):void 0,n.initializer=void 0),void 0===n.initializer?(Object.defineProperty(e,t,n),null):n}function lt(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const ot=function(e,t){t.slotName=t.key;t.key=t.key.replace("InlineXML_","");t.property=e.getAttribute("property");t.label=e.getAttribute("label");t.required=e.getAttribute("required")==="true";t.template=e.getAttribute("template");return t};let st=(T=Qe({name:"FilterBar",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",returnTypes:["sap.fe.macros.filterBar.FilterBarAPI"]}),M=Ze({type:"string",isPublic:true}),k=Ze({type:"boolean",isPublic:true}),H=Ze({type:"sap.ui.model.Context"}),R=Ze({type:"string"}),O=Ze({type:"sap.ui.model.Context",isPublic:true}),V=Ze({type:"sap.ui.model.Context",isPublic:true}),$=Ze({type:"boolean",isPublic:true}),j=Ze({type:"string"}),L=Ze({type:"boolean"}),N=Ze({type:"boolean"}),q=Ze({type:"boolean"}),U=Ze({type:"string[]"}),W=Ze({type:"string"}),J=Ze({type:"boolean"}),K=Ze({type:"string[]"}),G=Ze({type:"boolean",isPublic:true}),X=Ze({type:"string",required:false}),Q=Ze({type:"boolean"}),Y=Ze({type:"boolean"}),Z=Ze({type:"string"}),ee=Ze({type:"string"}),te=Ze({type:"boolean",isPublic:true}),ie=Ze({type:"boolean"}),re=Ze({type:"boolean"}),ae=Ye(),ne=Ye(),le=Ye(),oe=Ye(),se=Ye(),ue=et({type:"sap.fe.macros.filterBar.FilterField",isPublic:true,hasVirtualNode:true,processAggregations:ot}),T(ce=(pe=function(r){function a(a,n,l){var o;o=r.call(this,a,n,l)||this;tt(o,"id",de,o);tt(o,"visible",fe,o);tt(o,"selectionFields",he,o);tt(o,"filterBarDelegate",be,o);tt(o,"metaPath",ge,o);tt(o,"contextPath",me,o);tt(o,"showMessages",ye,o);tt(o,"variantBackreference",Fe,o);tt(o,"hideBasicSearch",ve,o);tt(o,"enableFallback",Pe,o);tt(o,"showAdaptFiltersButton",Ce,o);tt(o,"p13nMode",Se,o);tt(o,"propertyInfo",Be,o);tt(o,"useSemanticDateRange",De,o);tt(o,"navigationProperties",Ie,o);tt(o,"liveMode",we,o);tt(o,"filterConditions",_e,o);tt(o,"suspendSelection",xe,o);tt(o,"isDraftCollaborative",Ae,o);tt(o,"toggleControlId",ze,o);tt(o,"initialLayout",Ee,o);tt(o,"showClearButton",Te,o);tt(o,"_applyIdToContent",Me,o);tt(o,"disableDraftEditStateFilter",ke,o);tt(o,"search",He,o);tt(o,"filterChanged",Re,o);tt(o,"internalFilterChanged",Oe,o);tt(o,"internalSearch",Ve,o);tt(o,"afterClear",$e,o);tt(o,"filterFields",je,o);o.showDraftEditState=false;o.checkIfEditingFilterIsDisabled=e=>{if(e.annotations?.Capabilities?.NavigationRestrictions?.RestrictedProperties?.some(e=>e.NavigationProperty?.value==="DraftAdministrativeData"&&e.FilterRestrictions?.Filterable===false)===true){o.showDraftEditState=false}};o.checkIfCollaborationDraftSupported=e=>{if(c.isCollaborationDraftSupported(e)){o.isDraftCollaborative=true}};o.getEntityTypePath=e=>e[0].endsWith("/")?e[0]:e[0]+"/";o.getSearch=()=>{if(!o.hideBasicSearch){return E(C,{id:Ue([o.id,"BasicSearchField"]),placeholder:"{sap.fe.i18n>M_FILTERBAR_SEARCH}",propertyKey:"$search",conditions:"{$filters>/conditions/$search}",dataType:"sap.ui.model.odata.type.String",maxConditions:"1",dataTypeConstraints:"{'maxLength':1000}"})}return""};o.processSelectionFields=()=>{let e="";if(o.showDraftEditState){const t=g.getEditStates(o.isDraftCollaborative);e=E(C,{label:"{sap.fe.i18n>FILTERBAR_EDITING_STATUS}",maxConditions:"1",id:Ue([o.id,"FilterField","DraftEditingStatus"]),operators:"DRAFT_EDIT_STATE",dataType:"sap.ui.model.odata.type.String",propertyKey:"$editState",conditions:"{$filters>/conditions/$editState}",valueHelp:Ue([o.id,"FilterFieldValueHelp","DraftEditingStatus"]),display:"Description",children:{dependents:E(S,{id:Ue([o.id,"FilterFieldValueHelp","DraftEditingStatus"]),children:{typeahead:E(B,{children:E(D,{useFirstMatch:"true",children:{items:t.map(e=>E(I,{text:e.display},e.id))}})})}})}})}o._valueHelps=[];o._filterFields=[];o._filterFields?.push(e);if(!Array.isArray(o.selectionFields)){o.selectionFields=o.selectionFields.getObject()}o.selectionFields?.forEach(e=>{if(e.availability==="Default"){o.setFilterFieldsAndValueHelps(e)}});o._filterFields=o._filterFields?.length>0?o._filterFields:"";o._valueHelps=o._valueHelps?.length>0?o._valueHelps:""};o.setFilterFieldsAndValueHelps=e=>{if(e.template===undefined&&e.type!=="Slot"){o.pushFilterFieldsAndValueHelps(e)}else if(Array.isArray(o._filterFields)){const t=e.annotationPath;const i=o.metaPath.getModel().createBindingContext(t);const r=i?.getObject();let a;if(e.type==="Slot"){a=E(A,{templateId:e.template,children:E("slot",{name:e.slotName})})}else if(e.template){a=E(y,{fragmentName:e.template,id:Ue([o.id,"CustomFilterField",e.key]),contextPath:"{contextPath>}"})}let n=-1;if(i){n=qe(e.annotationPath,{context:i})??-1}o._filterFields?.push(E(C,{id:Ue([o.id,"CustomFilterField",e.key]),delegate:{name:"sap/fe/macros/field/FieldBaseDelegate"},propertyKey:e.conditionPath,label:e.label,dataType:"Edm.String",maxConditions:n,conditions:`{$filters>/conditions/${e.conditionPath}}`,operators:f.operators(i,r,o.useSemanticDateRange,e.settings,o.contextPath.getPath()),dataTypeConstraints:e.constraints,dataTypeFormatOptions:e.formatOptions,valueHelp:"undefined",required:e.required,children:{content:E(_,{"core:require":"{handler: 'sap/fe/macros/filter/FilterUtils'}",id:Ue([o.id,"FilterFieldContentWrapper",e.key]),binding:`{filterValues>/'${b.conditionToModelPath(e.conditionPath)}}`,conditions:"{path: '$field>/conditions'}",children:{content:a}}),customData:[E(v,{value:e.type==="Slot"},"isSlot"),E(P,{value:`{parts: [{value: 'asArray'}, {value: '${e.documentRefText}'}], formatter: 'sap.fe.core.formatters.StandardFormatter'}`},"sap-ui-DocumentationRef")]}}))}};o.pushFilterFieldsAndValueHelps=e=>{if(Array.isArray(o._filterFields)){o._filterFields?.push(E(F,{idPrefix:Ue([o.id,"FilterField",d.getNavigationPath(e.annotationPath)]),vhIdPrefix:Ue([o.id,"FilterFieldValueHelp"]),property:e.annotationPath,contextPath:o._getContextPathForFilterField(e,o._internalContextPath),useSemanticDateRange:o.useSemanticDateRange,settings:d.stringifyCustomData(e.settings),visualFilter:e.visualFilter!==undefined?Xe(e.visualFilter):undefined,editMode:`{internal>/${o.id}/filterFields/${e.conditionPath}/editMode}`}))}if(Array.isArray(o._valueHelps)){o._valueHelps?.push(E(w,{idPrefix:Ue([o.id,"FilterFieldValueHelp"]),conditionModel:"$filters",metaPath:e.annotationPath,contextPath:o._getContextPathForFilterField(e,o._internalContextPath),filterFieldValueHelp:true,useSemanticDateRange:o.useSemanticDateRange}))}};if(!o.metaPath){e.error("Context Path not available for FilterBar Macro.");return it(o)}const s=o.metaPath.getPath();let u="";const p=s?.split("/@com.sap.vocabularies.UI.v1.SelectionFields")||[];if(p.length>0){u=o.getEntityTypePath(p)}const h=c.getEntitySetPath(u);const m=o.contextPath?.getModel();o._internalContextPath=m?.createBindingContext(u);const x="@com.sap.vocabularies.UI.v1.SelectionFields"+(p.length&&p[1]||"");const z=l?.fullContextPath;let T=x;if(z!==""&&o._internalContextPath.getPath()?.startsWith(z)){T=s.replace(z,"")}o._annotationPath=x;const M={};if(o.filterFields){M[T]={filterFields:o.filterFields}}const k=Ge(o._internalContextPath);const H=o.getConverterContext(k,undefined,l,M);if(!o.propertyInfo){o.propertyInfo=Je(H,[],x).sPropertyInfo}const R=Ge(o.metaPath,o.contextPath).targetEntitySet;if(R?.annotations?.Common?.DraftRoot&&!o.disableDraftEditStateFilter){o.showDraftEditState=true;o.checkIfEditingFilterIsDisabled(R);o.checkIfCollaborationDraftSupported(m)}if(!o.selectionFields){const e=Je(H,[],x).selectionFields;o.selectionFields=new i(e,m).createBindingContext("/");const t=l?.models?.viewData?.getData();const r=H.getEntityType(),a=Ke(r,H),n=m.getContext(h),s=Ne(n,{selectionVariant:a},n.getObject(),t,o.showDraftEditState);o.filterConditions=s}o._processPropertyInfos(o.propertyInfo);if(o._applyIdToContent){o._apiId=o.id+"::FilterBar";o._contentId=o.id}else{o._apiId=o.id;o._contentId=o.getContentId(o.id+"")}if(o.hideBasicSearch!==true){const e=We(h,m);o.hideBasicSearch=Boolean(e&&!e.Searchable)}t.renderAsXML(()=>o.processSelectionFields());o.designtime=o.getDesigntime();return o}Le=a;rt(a,r);var n=a.prototype;n._processPropertyInfos=function e(t){const i=[];if(t){const e=t.replace(/\\{/g,"{").replace(/\\}/g,"}");const r=JSON.parse(e);const a=this.getTranslatedText("FILTERBAR_EDITING_STATUS");r.forEach(function(e){e.key=e.name;if(e.isParameter){i.push(e.name)}if(e.path==="$editState"){e.label=a}});this.propertyInfo=JSON.stringify(r).replace(/\{/g,"\\{").replace(/\}/g,"\\}")}this._parameters=JSON.stringify(i)};n._getContextPathForFilterField=function e(t,i){let r=i?.getPath();if(t.isParameter){const e=t.annotationPath;r=e.substring(0,e.lastIndexOf("/")+1)}return r};n.getDesigntime=function e(){return"sap/fe/macros/filterBar/designtime/FilterBar.designtime"};n.getTemplate=function e(){const t=this._internalContextPath?.getPath();let i="";if(this.filterBarDelegate){i=this.filterBarDelegate}else{i="{name:'sap/fe/macros/filterBar/FilterBarDelegate', payload: {entityTypePath: '"+t+"'}}"}const r=b.formatPropertyInfo(this.propertyInfo);return E(z,{id:this._apiId,metaPath:this.metaPath.getPath(),search:this.search,filterChanged:this.filterChanged,afterClear:this.afterClear,internalSearch:this.internalSearch,internalFilterChanged:this.internalFilterChanged,children:{content:E(x,{"core:require":"{API: 'sap/fe/macros/filterBar/FilterBarAPI'}",id:this._contentId,liveMode:this.liveMode,delegate:i,variantBackreference:this.liveMode?undefined:this.variantBackreference,showAdaptFiltersButton:this.showAdaptFiltersButton,showClearButton:this.showClearButton,p13nMode:this.p13nMode,search:"API.handleSearch($event)",filtersChanged:"API.handleFilterChanged($event)",filterConditions:this.filterConditions,suspendSelection:this.suspendSelection,showMessages:this.showMessages,toggleControl:this.toggleControlId,initialLayout:this.initialLayout,propertyInfo:r,visible:this.visible,"dt:designtime":this.designtime,"customData:entityType":t,children:{customData:[E(v,{value:this.id},"localId"),E(v,{value:this.hideBasicSearch},"hideBasicSearch"),E(v,{value:this.showDraftEditState},"showDraftEditState"),E(v,{value:this.useSemanticDateRange},"useSemanticDateRange"),E(v,{value:this._parameters},"parameters"),E(v,{value:this.propertyInfo},"feFilterInfo"),E(v,{value:this._annotationPath},"annotationPath")],dependents:this._valueHelps,basicSearchField:this.getSearch(),filterItems:this._filterFields}})}})};return a}(n),de=nt(pe.prototype,"id",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=nt(pe.prototype,"visible",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),he=nt(pe.prototype,"selectionFields",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),be=nt(pe.prototype,"filterBarDelegate",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=nt(pe.prototype,"metaPath",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),me=nt(pe.prototype,"contextPath",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),ye=nt(pe.prototype,"showMessages",[$],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Fe=nt(pe.prototype,"variantBackreference",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),ve=nt(pe.prototype,"hideBasicSearch",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),Pe=nt(pe.prototype,"enableFallback",[N],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Ce=nt(pe.prototype,"showAdaptFiltersButton",[q],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),Se=nt(pe.prototype,"p13nMode",[U],{configurable:true,enumerable:true,writable:true,initializer:function(){return"Item,Value"}}),Be=nt(pe.prototype,"propertyInfo",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),De=nt(pe.prototype,"useSemanticDateRange",[J],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),Ie=nt(pe.prototype,"navigationProperties",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),we=nt(pe.prototype,"liveMode",[G],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),_e=nt(pe.prototype,"filterConditions",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),xe=nt(pe.prototype,"suspendSelection",[Q],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Ae=nt(pe.prototype,"isDraftCollaborative",[Y],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),ze=nt(pe.prototype,"toggleControlId",[Z],{configurable:true,enumerable:true,writable:true,initializer:null}),Ee=nt(pe.prototype,"initialLayout",[ee],{configurable:true,enumerable:true,writable:true,initializer:function(){return"compact"}}),Te=nt(pe.prototype,"showClearButton",[te],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),Me=nt(pe.prototype,"_applyIdToContent",[ie],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),ke=nt(pe.prototype,"disableDraftEditStateFilter",[re],{configurable:true,enumerable:true,writable:true,initializer:function(){return false}}),He=nt(pe.prototype,"search",[ae],{configurable:true,enumerable:true,writable:true,initializer:null}),Re=nt(pe.prototype,"filterChanged",[ne],{configurable:true,enumerable:true,writable:true,initializer:null}),Oe=nt(pe.prototype,"internalFilterChanged",[le],{configurable:true,enumerable:true,writable:true,initializer:null}),Ve=nt(pe.prototype,"internalSearch",[oe],{configurable:true,enumerable:true,writable:true,initializer:null}),$e=nt(pe.prototype,"afterClear",[se],{configurable:true,enumerable:true,writable:true,initializer:null}),je=nt(pe.prototype,"filterFields",[ue],{configurable:true,enumerable:true,writable:true,initializer:null}),pe))||ce);Le=st;return Le},false);
//# sourceMappingURL=FilterBar.block.js.map