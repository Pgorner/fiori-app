{"version":3,"file":"FilterBarDelegate.js","names":["ODataFilterBarDelegate","Object","assign","FilterBarDelegate","apiVersion","EDIT_STATE_PROPERTY_NAME","SEARCH_PROPERTY_NAME","VALUE_HELP_TYPE","FETCHED_PROPERTIES_DATA_KEY","CONDITION_PATH_TO_PROPERTY_PATH_REGEX","async","_templateEditState","sIdPrefix","metaModel","oModifier","oThis","JSONModel","id","isDraftCollaborative","ModelHelper","isCollaborationDraftSupported","oPreprocessorSettings","bindingContexts","this","createBindingContext","models","DelegateUtil","templateControlFragment","undefined","finally","destroy","_templateCustomFilter","oFilterBar","oSelectionFieldInfo","oMetaModel","sEntityTypePath","getCustomDataWithModifier","annotationPath","context","getContext","dataModelPath","getInvolvedDataModelObjects","documentRefText","targetObject","annotations","Common","DocumentationRef","toString","oItemModel","TemplateModel","contextPath","item","oView","CommonUtils","getTargetView","oController","getController","oOptions","controller","view","_getPropertyPath","sConditionPath","replace","_findSelectionField","aSelectionFields","sFlexName","find","oSelectionField","conditionPath","replaceAll","availability","_generateIdPrefix","sFilterBarId","sControlType","sNavigationPrefix","generate","_templateValueHelp","oSettings","oParameters","idPrefix","sVhIdPrefix","conditionModel","navigationPrefix","filterFieldValueHelp","useSemanticDateRange","bUseSemanticDateRange","metaPath","opensOnFocus","useMultiValueField","requiresValidation","collaborationEnabled","requestGroupId","jsonModel","mergeObjects","targetPath","FieldHelper","valueHelpPropertyForFilterField","isXML","valueHelpXMLString","jsx","renderAsXML","getValueHelpTemplate","getModel","valueHelpXML","DOMParser","parseFromString","Promise","resolve","firstElementChild","then","aVHElements","sAggregationName","Array","isArray","forEach","elt","insertAggregation","oControl","catch","oError","Log","error","valueHelp","_addXMLCustomFilterField","sPropertyPath","aDependents","getAggregation","i","length","oFilterField","isA","sDataProperty","getPropertyKey","sFilterFieldId","getId","indexOf","_templateFilterField","sInFilterBarId","pageModel","vhIdPrefix","propertyPath","sPropertyName","settings","visualFilter","editMode","oVisualFilter","converterContext","_addPropertyInfo","oParentControl","mPropertyBag","sPropertyInfoName","sPropertyInfoKey","modifier","delegate","getProperty","aPropertyInfo","hasPropertyInfo","some","prop","key","name","entityTypePath","payload","FilterUtils","createConverterContext","appComponent","entityType","getEntityType","filterField","getFilterField","propertyInfo","buildProperyInfo","_updatePropertyInfo","errorMsg","warning","propertyBag","parentControl","propertyInfoForFilterBar","propertyInfoForFilterBarObj","JSON","parse","push","stringify","customDataNode","retrieveCustomDataNode","setAttribute","_propertyInfo","formatPropertyInfo","setProperty","addItem","_addP13nItem","model","getMetaModel","targets","_addFlexItem","removeItem","oFilterFieldProperty","doRemoveItem","filterFieldProperty","data","addCondition","removeCondition","clearFilters","oFilterControl","filterBarAPI","getParent","StateHelper","clearFilterValues","fetchModel","oModel","fetchPropertiesForEntity","oEntityType","getObject","includeHidden","oConverterContext","sEntitySetPath","getEntitySetPath","mFilterFields","getConvertedFilterFields","aFetchedProperties","oFilterFieldInfo","sAnnotationPath","oPropertyAnnotations","getConvertedTypes","resolvePath","target","sTargetPropertyPrefix","CommonHelper","getLocationForPropertyPath","sProperty","selectionFields","UI","SelectionFields","filterFacets","FilterFacets","_isFilterAdaptable","isPropertyFilterable","aParameterFields","processedFields","processSelectionFields","processedFieldsKeys","oProps","filter","oProp","includes","oFR","getFilterRestrictionsByPath","mAllowedExpressions","FilterAllowedExpressions","iFilterFieldIndex","oSelField","group","groupLabel","path","tooltip","removeFromAppState","hasValueHelp","oProperty","oPropertyContext","bRemoveFromAppState","oFilterDefaultValueAnnotation","oFilterDefaultValue","getModelType","$Type","defaultFilterConditions","fieldPath","operator","values","filterExpression","getSpecificAllowedExpression","visible","propInfo","label","getResourceModel","getText","typeConfig","TypeMap","getTypeConfig","dataType","formatOptions","constraints","getLocalizedText","isParameter","setCustomData","getLineItemQualifierFromTable","annotationPaths","getMetaPath","split","Visualizations","visualization","$AnnotationPath","metaPaths","filterFieldInfo","propertyAnnotations","isInFilterFacets","isSelectionField","_isFilterInSelectionFields","filterFacet","fieldGroup","Target","$target","Data","dataField","Value","AdaptationHidden","filterFieldKey","selectionField","value","sFlexPropertyName","oAppComponent","bIsXML","template","type","sNavigationPath","getNavigationPath","sUseSemanticDateRange","sBindingPath","substring","lastIndexOf","sRetrievedEntityTypePath","sRetrievedUseSemanticDateRange","property","filterOutNavPropBinding","join","getPath","sValueHelpType","doesValueHelpExist","bValueHelpExists","localId","_getPageModel","_getCachedProperties","window","Element","getCustomData","_setCachedProperties","_getCachedOrFetchPropertiesForEntity","localGroupLabel","oGroup","sortPropertyInfosByGroupLabel","fetchProperties","filterBar","propertyInfos","fetchFilterProperties","getTypeMap"],"sources":["./FilterBarDelegate.ts"],"sourcesContent":["import type { Property } from \"@sap-ux/vocabularies-types\";\nimport type { PropertyAnnotations_Common } from \"@sap-ux/vocabularies-types/vocabularies/Common_Edm\";\nimport type {\n\tDataFieldAbstractTypes,\n\tDataFieldTypes,\n\tFieldGroupType,\n\tFilterFacets,\n\tReferenceFacet,\n\tSelectionFields\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTerms } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport Log from \"sap/base/Log\";\nimport mergeObjects from \"sap/base/util/merge\";\nimport type { EnhanceWithUI5 } from \"sap/fe/base/ClassSupport\";\nimport jsx from \"sap/fe/base/jsx-runtime/jsx\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { BaseTreeModifier, PreprocessorSettings } from \"sap/fe/core/CommonUtils\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport TemplateModel from \"sap/fe/core/TemplateModel\";\nimport { getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type {\n\tPropertyInfo as FEPropertyInfo,\n\tFilterField,\n\tPropertyInfoExternal\n} from \"sap/fe/core/converters/controls/ListReport/FilterBar\";\nimport { processSelectionFields, sortPropertyInfosByGroupLabel } from \"sap/fe/core/converters/controls/ListReport/FilterBar\";\nimport { isPropertyFilterable } from \"sap/fe/core/helpers/MetaModelFunction\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { getLocalizedText, getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { hasValueHelp } from \"sap/fe/core/templating/PropertyFormatters\";\nimport { getModelType } from \"sap/fe/core/type/EDM\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport DelegateUtil from \"sap/fe/macros/DelegateUtil\";\nimport FieldHelper from \"sap/fe/macros/field/FieldHelper\";\nimport type { IFilterControl } from \"sap/fe/macros/filter/FilterUtils\";\nimport FilterUtils from \"sap/fe/macros/filter/FilterUtils\";\nimport { getValueHelpTemplate } from \"sap/fe/macros/internal/valuehelp/ValueHelpTemplating\";\nimport type { ControlPropertyInfo } from \"sap/fe/macros/mdc/adapter/StateHelper\";\nimport StateHelper from \"sap/fe/macros/mdc/adapter/StateHelper\";\nimport type TableAPI from \"sap/fe/macros/table/TableAPI\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type FilterBar from \"sap/ui/mdc/FilterBar\";\nimport FilterBarDelegate from \"sap/ui/mdc/FilterBarDelegate\";\nimport type MDCFilterField from \"sap/ui/mdc/FilterField\";\nimport type ValueHelp from \"sap/ui/mdc/ValueHelp\";\nimport TypeMap from \"sap/ui/mdc/odata/v4/TypeMap\";\nimport type { PropertyInfo } from \"sap/ui/mdc/util/PropertyHelper\";\nimport type Context from \"sap/ui/model/Context\";\nimport type Model from \"sap/ui/model/Model\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type MacroAPI from \"../MacroAPI\";\n\ntype ModifierElement = UI5Element | UI5Element[] | Element | Element[];\ntype NullableModifierElement = void | ModifierElement | null;\nconst ODataFilterBarDelegate = Object.assign({}, FilterBarDelegate) as typeof FilterBarDelegate & {\n\tapiVersion: number;\n\t_isFilterInSelectionFields(selectionFields: SelectionFields, filterFieldInfo: FilterField): boolean;\n\t_findSelectionField(aSelectionFields: FilterField[], sFlexName: string): FilterField | undefined;\n\tclearFilters(oFilterControl: FilterBar): Promise<void>;\n\tgetTypeMap(): typeof TypeMap;\n\tfetchFilterProperties(filterBar: IFilterControl): Promise<ControlPropertyInfo[] | PropertyInfoExternal[]>;\n\tfetchProperties(filterBar: FilterBar): Promise<PropertyInfoExternal[]>;\n\t_isFilterAdaptable(\n\t\tfilterFieldInfo: FilterField,\n\t\tpropertyAnnotations: Property,\n\t\tselectionFields?: SelectionFields,\n\t\tfilterFacets?: FilterFacets\n\t): boolean;\n\tfetchPropertiesForEntity(sEntityTypePath: string, oMetaModel: ODataMetaModel, oFilterControl: IFilterControl): PropertyInfo[];\n\t_templateCustomFilter(\n\t\toFilterBar: IFilterControl,\n\t\tsIdPrefix: string,\n\t\toSelectionFieldInfo: FilterField,\n\t\toMetaModel: ODataMetaModel,\n\t\toModifier: BaseTreeModifier\n\t): Promise<ModifierElement>;\n\t_addP13nItem(sPropertyInfoName: string, oParentControl: FilterBar): Promise<NullableModifierElement>;\n\t_addFlexItem(\n\t\tsFlexPropertyName: string,\n\t\toParentControl: FilterBar,\n\t\toMetaModel: ODataMetaModel,\n\t\toModifier: BaseTreeModifier | undefined,\n\t\toAppComponent?: AppComponent,\n\t\tview?: View\n\t): Promise<NullableModifierElement>;\n\taddItem(\n\t\toParentControl: FilterBar,\n\t\tsPropertyInfoName: string,\n\t\tmPropertyBag?: { modifier: BaseTreeModifier; appComponent: AppComponent }\n\t): Promise<NullableModifierElement>;\n\taddCondition(\n\t\toParentControl: FilterBar,\n\t\tsPropertyInfoName: string,\n\t\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n\t): Promise<void | null>;\n\tremoveItem(\n\t\toParentControl: FilterBar,\n\t\toFilterFieldProperty: UI5Element | Element,\n\t\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n\t): Promise<boolean | null>;\n\tremoveCondition(\n\t\toParentControl: FilterBar,\n\t\tsPropertyInfoName: string,\n\t\tmPropertyBag: {\n\t\t\tappComponent: AppComponent;\n\t\t\tmodifier: BaseTreeModifier;\n\t\t}\n\t): Promise<void | null>;\n};\nODataFilterBarDelegate.apiVersion = 2;\nconst EDIT_STATE_PROPERTY_NAME = \"$editState\",\n\tSEARCH_PROPERTY_NAME = \"$search\",\n\tVALUE_HELP_TYPE = \"FilterFieldValueHelp\",\n\tFETCHED_PROPERTIES_DATA_KEY = \"sap_fe_FilterBarDelegate_propertyInfoMap\",\n\tCONDITION_PATH_TO_PROPERTY_PATH_REGEX = /[+*]/g;\n\n// For one single entry in UI.SelectionFields\ntype AnnotationSelectionField = {\n\tvalue: string;\n};\n\nasync function _templateEditState(\n\tsIdPrefix: string,\n\tmetaModel: ODataMetaModel,\n\toModifier: BaseTreeModifier | undefined\n): Promise<ModifierElement> {\n\tconst oThis = new JSONModel({\n\t\t\tid: sIdPrefix,\n\t\t\tisDraftCollaborative: ModelHelper.isCollaborationDraftSupported(metaModel)\n\t\t}),\n\t\toPreprocessorSettings = {\n\t\t\tbindingContexts: {\n\t\t\t\tthis: oThis.createBindingContext(\"/\")\n\t\t\t},\n\t\t\tmodels: {\n\t\t\t\t//\"this.i18n\": ResourceModel.getModel(), TODO: To be checked why this is needed, should not be needed at all\n\t\t\t\tthis: oThis\n\t\t\t}\n\t\t};\n\n\treturn DelegateUtil.templateControlFragment(\n\t\t\"sap.fe.macros.filterBar.DraftEditState\",\n\t\toPreprocessorSettings,\n\t\tundefined,\n\t\toModifier\n\t).finally(function () {\n\t\toThis.destroy();\n\t});\n}\n\nODataFilterBarDelegate._templateCustomFilter = async function (\n\toFilterBar: IFilterControl,\n\tsIdPrefix: string,\n\toSelectionFieldInfo: FilterField,\n\toMetaModel: ODataMetaModel,\n\toModifier: BaseTreeModifier\n): Promise<ModifierElement> {\n\tconst sEntityTypePath = await DelegateUtil.getCustomDataWithModifier<string>(oFilterBar, \"entityType\", oModifier);\n\n\tif (oSelectionFieldInfo.annotationPath !== undefined) {\n\t\t// if property is not defined in the manifest\n\t\ttype PropertyAnnotations_Common_extended = PropertyAnnotations_Common & { DocumentationRef?: string };\n\t\tconst context = oMetaModel.getContext(oSelectionFieldInfo.annotationPath),\n\t\t\tdataModelPath = getInvolvedDataModelObjects<Property>(context),\n\t\t\tdocumentRefText = (\n\t\t\t\tdataModelPath.targetObject?.annotations.Common as PropertyAnnotations_Common_extended\n\t\t\t)?.DocumentationRef?.toString();\n\t\toSelectionFieldInfo.documentRefText = documentRefText;\n\t}\n\n\tconst oThis = new JSONModel({\n\t\t\tid: sIdPrefix\n\t\t}),\n\t\toItemModel = new TemplateModel(oSelectionFieldInfo, oMetaModel),\n\t\toPreprocessorSettings = {\n\t\t\tbindingContexts: {\n\t\t\t\tcontextPath: oMetaModel.createBindingContext(sEntityTypePath!),\n\t\t\t\tthis: oThis.createBindingContext(\"/\"),\n\t\t\t\titem: oItemModel.createBindingContext(\"/\")\n\t\t\t},\n\t\t\tmodels: {\n\t\t\t\tcontextPath: oMetaModel,\n\t\t\t\tthis: oThis,\n\t\t\t\titem: oItemModel\n\t\t\t}\n\t\t},\n\t\toView = CommonUtils.getTargetView(oFilterBar),\n\t\toController = oView ? oView.getController() : undefined,\n\t\toOptions = {\n\t\t\tcontroller: oController ? oController : undefined,\n\t\t\tview: oView\n\t\t};\n\n\treturn DelegateUtil.templateControlFragment(\"sap.fe.macros.filter.CustomFilter\", oPreprocessorSettings, oOptions, oModifier).finally(\n\t\tfunction () {\n\t\t\toThis.destroy();\n\t\t\toItemModel.destroy();\n\t\t}\n\t);\n};\nfunction _getPropertyPath(sConditionPath: string): string {\n\treturn sConditionPath.replace(CONDITION_PATH_TO_PROPERTY_PATH_REGEX, \"\");\n}\nODataFilterBarDelegate._findSelectionField = function (aSelectionFields: FilterField[], sFlexName: string): FilterField | undefined {\n\treturn aSelectionFields.find(function (oSelectionField: FilterField) {\n\t\treturn (\n\t\t\t(oSelectionField.conditionPath === sFlexName || oSelectionField.conditionPath.replaceAll(/\\*/g, \"\") === sFlexName) &&\n\t\t\toSelectionField.availability !== \"Hidden\"\n\t\t);\n\t});\n};\nfunction _generateIdPrefix(sFilterBarId: string, sControlType: string, sNavigationPrefix?: string): string {\n\treturn sNavigationPrefix ? generate([sFilterBarId, sControlType, sNavigationPrefix]) : generate([sFilterBarId, sControlType]);\n}\nasync function _templateValueHelp(\n\toSettings: {\n\t\tisXML: boolean;\n\t\tbindingContexts: {\n\t\t\tmetaPath: Context;\n\t\t\tcontextPath: Context;\n\t\t};\n\t\tmodels: {\n\t\t\tmetaPath: ODataMetaModel;\n\t\t\tcontextPath: ODataMetaModel;\n\t\t};\n\t},\n\toParameters: {\n\t\tsVhIdPrefix: string;\n\t\tsNavigationPrefix?: string;\n\t\tbUseSemanticDateRange: boolean;\n\t\toModifier?: BaseTreeModifier;\n\t\toControl: UI5Element;\n\t\tview?: View;\n\t}\n): Promise<void> {\n\tconst oThis = {\n\t\tidPrefix: oParameters.sVhIdPrefix,\n\t\tconditionModel: \"$filters\",\n\t\tnavigationPrefix: oParameters.sNavigationPrefix ? `/${oParameters.sNavigationPrefix}` : \"\",\n\t\tfilterFieldValueHelp: true,\n\t\tuseSemanticDateRange: oParameters.bUseSemanticDateRange,\n\t\tmetaPath: oSettings.bindingContexts.metaPath,\n\t\tcontextPath: oSettings.bindingContexts.contextPath,\n\t\topensOnFocus: true,\n\t\tuseMultiValueField: false,\n\t\trequiresValidation: false,\n\t\tcollaborationEnabled: false,\n\t\trequestGroupId: undefined\n\t};\n\tconst jsonModel = new JSONModel(oThis);\n\tconst oPreprocessorSettings = mergeObjects({}, oSettings, {\n\t\tbindingContexts: {\n\t\t\tthis: jsonModel.createBindingContext(\"/\")\n\t\t},\n\t\tmodels: {\n\t\t\tthis: oThis\n\t\t}\n\t}) as PreprocessorSettings;\n\tconst targetPath = FieldHelper.valueHelpPropertyForFilterField(oSettings.bindingContexts.metaPath);\n\n\tif (oSettings.isXML) {\n\t\tlet valueHelpXMLString = jsx.renderAsXML<string | undefined>(\n\t\t\t() =>\n\t\t\t\tgetValueHelpTemplate(oSettings.bindingContexts.metaPath.getModel().createBindingContext(targetPath), oThis) as\n\t\t\t\t\t| string\n\t\t\t\t\t| undefined\n\t\t);\n\t\tif (valueHelpXMLString) {\n\t\t\tif (oSettings.isXML) {\n\t\t\t\tvalueHelpXMLString = `<root>${valueHelpXMLString}</root>`;\n\t\t\t}\n\t\t\tconst valueHelpXML = new DOMParser().parseFromString(valueHelpXMLString, \"text/xml\");\n\t\t\treturn Promise.resolve(\n\t\t\t\tDelegateUtil.templateControlFragment(valueHelpXML.firstElementChild, oPreprocessorSettings, {\n\t\t\t\t\tisXML: oSettings.isXML\n\t\t\t\t})\n\t\t\t)\n\t\t\t\t.then(async function (aVHElements: ModifierElement): Promise<void> {\n\t\t\t\t\tif (aVHElements) {\n\t\t\t\t\t\tconst sAggregationName = \"dependents\";\n\t\t\t\t\t\t//Some filter fields have the PersistenceProvider aggregation besides the FVH :\n\t\t\t\t\t\tif (Array.isArray(aVHElements)) {\n\t\t\t\t\t\t\taVHElements.forEach(function (elt: Element | UI5Element) {\n\t\t\t\t\t\t\t\tif (oParameters.oModifier) {\n\t\t\t\t\t\t\t\t\toParameters.oModifier.insertAggregation(oParameters.oControl, sAggregationName, elt, 0);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, elt as UI5Element, 0, false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (oParameters.oModifier) {\n\t\t\t\t\t\t\treturn oParameters.oModifier.insertAggregation(\n\t\t\t\t\t\t\t\toParameters.oControl,\n\t\t\t\t\t\t\t\tsAggregationName,\n\t\t\t\t\t\t\t\taVHElements,\n\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\toParameters.view as unknown as Element\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, aVHElements as UI5Element, 0, false);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t})\n\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\tLog.error(\"Error while evaluating DelegateUtil.isValueHelpRequired\", oError as string);\n\t\t\t\t})\n\t\t\t\t.finally(function () {\n\t\t\t\t\tjsonModel.destroy();\n\t\t\t\t});\n\t\t}\n\t} else {\n\t\tconst valueHelp = getValueHelpTemplate(oSettings.bindingContexts.metaPath.getModel().createBindingContext(targetPath), oThis) as\n\t\t\t| ValueHelp\n\t\t\t| undefined;\n\t\tif (valueHelp) {\n\t\t\tconst sAggregationName = \"dependents\";\n\t\t\t//Some filter fields have the PersistenceProvider aggregation besides the FVH :\n\t\t\tif (Array.isArray(valueHelp)) {\n\t\t\t\tvalueHelp.forEach(function (elt: Element | UI5Element) {\n\t\t\t\t\tif (oParameters.oModifier) {\n\t\t\t\t\t\toParameters.oModifier.insertAggregation(oParameters.oControl, sAggregationName, elt, 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, elt as UI5Element, 0, false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (oParameters.oModifier) {\n\t\t\t\toParameters.oModifier.insertAggregation(oParameters.oControl, sAggregationName, valueHelp, 0);\n\t\t\t} else {\n\t\t\t\toParameters.oControl.insertAggregation(sAggregationName, valueHelp, 0, false);\n\t\t\t}\n\t\t}\n\t}\n}\nasync function _addXMLCustomFilterField(\n\toFilterBar: IFilterControl,\n\toModifier: BaseTreeModifier,\n\tsPropertyPath: string\n): Promise<UI5Element | Element | void> {\n\ttry {\n\t\tconst aDependents = await Promise.resolve(oModifier.getAggregation(oFilterBar, \"dependents\"));\n\t\tlet i;\n\t\tif (aDependents && aDependents.length > 1) {\n\t\t\tfor (i = 0; i <= aDependents.length; i++) {\n\t\t\t\tconst oFilterField = aDependents[i];\n\t\t\t\tif (oFilterField && (oFilterField as UI5Element).isA<MDCFilterField>(\"sap.ui.mdc.FilterField\")) {\n\t\t\t\t\tconst sDataProperty = (oFilterField as MDCFilterField).getPropertyKey(),\n\t\t\t\t\t\tsFilterFieldId = (oFilterField as MDCFilterField).getId();\n\t\t\t\t\tif (sPropertyPath === sDataProperty && sFilterFieldId.indexOf(\"CustomFilterField\")) {\n\t\t\t\t\t\treturn oFilterField;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} catch (oError) {\n\t\tLog.error(\"Filter Cannot be added\", oError as string);\n\t}\n}\n\nasync function _templateFilterField(\n\toSettings: Record<string, unknown>,\n\toParameters: Record<string, unknown>,\n\tsInFilterBarId?: string,\n\tpageModel?: JSONModel\n): Promise<UI5Element | UI5Element[] | Element | Element[]> {\n\tconst oThis = new JSONModel({\n\t\tidPrefix: oParameters.sIdPrefix,\n\t\tvhIdPrefix: oParameters.sVhIdPrefix,\n\t\tpropertyPath: oParameters.sPropertyName,\n\t\tnavigationPrefix: oParameters.sNavigationPrefix ? `/${oParameters.sNavigationPrefix}` : \"\",\n\t\tuseSemanticDateRange: oParameters.bUseSemanticDateRange,\n\t\tsettings: oParameters.oSettings,\n\t\tvisualFilter: oParameters.visualFilter,\n\t\teditMode: `{internal>/${sInFilterBarId}/filterFields/${oParameters.sPropertyName}/editMode}`\n\t});\n\ttry {\n\t\tconst oMetaModel = oParameters.oMetaModel as ODataMetaModel;\n\t\tconst oVisualFilter = new TemplateModel(oParameters.visualFilter as object, oMetaModel);\n\t\tconst oPreprocessorSettings = mergeObjects({}, oSettings, {\n\t\t\tbindingContexts: {\n\t\t\t\tthis: oThis.createBindingContext(\"/\"),\n\t\t\t\tvisualFilter: oVisualFilter.createBindingContext(\"/\")\n\t\t\t},\n\t\t\tmodels: {\n\t\t\t\tthis: oThis,\n\t\t\t\tvisualFilter: oVisualFilter,\n\t\t\t\tmetaModel: oMetaModel,\n\t\t\t\tconverterContext: pageModel\n\t\t\t}\n\t\t}) as PreprocessorSettings;\n\n\t\treturn await DelegateUtil.templateControlFragment(\"sap.fe.macros.internal.filterField.FilterFieldTemplate\", oPreprocessorSettings, {\n\t\t\tisXML: !!oSettings.isXML\n\t\t});\n\t} finally {\n\t\toThis.destroy();\n\t}\n}\n\nasync function _addPropertyInfo(\n\toParentControl: FilterBar,\n\tmPropertyBag: { modifier: BaseTreeModifier; appComponent: AppComponent },\n\toMetaModel: ODataMetaModel,\n\tsPropertyInfoName: string\n): Promise<void> {\n\ttry {\n\t\t// key should have the same value as name\n\t\tconst sPropertyInfoKey = sPropertyInfoName;\n\t\tsPropertyInfoName = sPropertyInfoName.replace(\"*\", \"\");\n\t\tif (mPropertyBag && !mPropertyBag.modifier) {\n\t\t\tthrow \"FilterBar Delegate method called without modifier.\";\n\t\t}\n\n\t\tconst delegate = await mPropertyBag.modifier.getProperty<FilterBarDelegate>(oParentControl, \"delegate\");\n\t\tconst aPropertyInfo = await mPropertyBag.modifier.getProperty<FEPropertyInfo[]>(oParentControl, \"propertyInfo\");\n\t\t//We do not get propertyInfo in case of table filters\n\t\tif (aPropertyInfo) {\n\t\t\tconst hasPropertyInfo = aPropertyInfo.some(function (prop: FEPropertyInfo) {\n\t\t\t\treturn prop.key === sPropertyInfoKey || prop.name === sPropertyInfoKey;\n\t\t\t});\n\t\t\tif (!hasPropertyInfo) {\n\t\t\t\tconst entityTypePath = delegate.payload.entityTypePath;\n\t\t\t\tconst converterContext = FilterUtils.createConverterContext(\n\t\t\t\t\toParentControl as unknown as IFilterControl,\n\t\t\t\t\tentityTypePath,\n\t\t\t\t\toMetaModel,\n\t\t\t\t\tmPropertyBag.appComponent\n\t\t\t\t);\n\t\t\t\tconst entityType = converterContext.getEntityType();\n\t\t\t\tconst filterField = FilterUtils.getFilterField(sPropertyInfoName, converterContext, entityType);\n\t\t\t\tconst propertyInfo = FilterUtils.buildProperyInfo(filterField!, converterContext);\n\t\t\t\tawait _updatePropertyInfo(\n\t\t\t\t\taPropertyInfo as PropertyInfo[],\n\t\t\t\t\tmPropertyBag,\n\t\t\t\t\tpropertyInfo as unknown as PropertyInfo,\n\t\t\t\t\toParentControl\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t} catch (errorMsg) {\n\t\tLog.warning(`${oParentControl.getId()} : ${errorMsg}`);\n\t}\n}\n\nasync function _updatePropertyInfo(\n\tpropertyInfo: PropertyInfo[],\n\tpropertyBag: { modifier: BaseTreeModifier; appComponent: AppComponent },\n\tfilterField: PropertyInfo,\n\tparentControl: FilterBar\n): Promise<void> {\n\tlet propertyInfoForFilterBar = await DelegateUtil.getCustomDataWithModifier<string>(\n\t\tparentControl,\n\t\t\"feFilterInfo\",\n\t\tpropertyBag.modifier\n\t);\n\tif (propertyInfoForFilterBar && propertyInfoForFilterBar.length > 0) {\n\t\tconst propertyInfoForFilterBarObj = JSON.parse(propertyInfoForFilterBar) as PropertyInfo[];\n\t\tpropertyInfoForFilterBarObj.push(filterField);\n\t\tpropertyInfoForFilterBar = JSON.stringify(propertyInfoForFilterBarObj);\n\t\tpropertyInfoForFilterBar = propertyInfoForFilterBar.replace(/\\{/g, \"\\\\{\");\n\t\tpropertyInfoForFilterBar = propertyInfoForFilterBar.replace(/\\}/g, \"\\\\}\");\n\t\tconst customDataNode = await DelegateUtil.retrieveCustomDataNode(parentControl, \"feFilterInfo\", propertyBag.modifier);\n\t\tcustomDataNode[0].setAttribute(\"value\", propertyInfoForFilterBar);\n\t\tpropertyBag.modifier.insertAggregation(parentControl, \"customData\", customDataNode[0], 0);\n\t}\n\n\t// Custom data is set to the parent control to store the propertyInfo\n\tpropertyInfo.push(filterField);\n\t//remove unwanted property from the propertyInfo\n\tconst _propertyInfo = FilterUtils.formatPropertyInfo(propertyInfo as FEPropertyInfo[]);\n\t//Update the propertyInfo in the parent control\n\tpropertyBag.modifier.setProperty(parentControl, \"propertyInfo\", _propertyInfo);\n}\n/**\n * Method responsible for creating filter field in standalone mode / in the personalization settings of the filter bar.\n * @param oParentControl Parent control instance to which the filter field is added\n * @param sPropertyInfoName Name of the property being added as the filter field\n * @param mPropertyBag Instance of the property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns Once resolved, a filter field definition is returned\n */\nODataFilterBarDelegate.addItem = async function (\n\toParentControl: FilterBar,\n\tsPropertyInfoName: string,\n\tmPropertyBag?: { view: View; modifier: BaseTreeModifier; appComponent: AppComponent }\n): Promise<NullableModifierElement> {\n\tif (!mPropertyBag) {\n\t\t// Invoked during runtime.\n\t\treturn ODataFilterBarDelegate._addP13nItem(sPropertyInfoName, oParentControl);\n\t}\n\tconst modifier = mPropertyBag.modifier;\n\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\tconst oMetaModel = model && model.getMetaModel();\n\tif (!oMetaModel) {\n\t\treturn Promise.resolve(null);\n\t}\n\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\tif (isXML) {\n\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, sPropertyInfoName);\n\t}\n\treturn ODataFilterBarDelegate._addFlexItem(\n\t\tsPropertyInfoName,\n\t\toParentControl,\n\t\toMetaModel,\n\t\tmodifier,\n\t\tmPropertyBag.appComponent,\n\t\tmPropertyBag.view\n\t);\n};\n\n/**\n * Method responsible for removing filter field in standalone / personalization filter bar.\n * @param oParentControl Parent control instance from which the filter field is removed\n * @param oFilterFieldProperty Object of the filter field property being removed as filter field\n * @param mPropertyBag Instance of property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns The resolved promise\n */\nODataFilterBarDelegate.removeItem = async function (\n\toParentControl: FilterBar,\n\toFilterFieldProperty: UI5Element | Element,\n\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n): Promise<boolean | null> {\n\tlet doRemoveItem = true;\n\tconst modifier = mPropertyBag.modifier;\n\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\tif (isXML) {\n\t\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\t\tconst oMetaModel = model && model.getMetaModel();\n\t\tif (!oMetaModel) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\t\tconst filterFieldProperty = await mPropertyBag.modifier.getProperty(oFilterFieldProperty, \"propertyKey\");\n\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, filterFieldProperty as string);\n\t}\n\tif (\n\t\ttypeof oFilterFieldProperty !== \"string\" &&\n\t\t(oFilterFieldProperty as UI5Element).isA &&\n\t\t(oFilterFieldProperty as UI5Element).isA(\"sap.ui.mdc.FilterField\")\n\t) {\n\t\tif ((oFilterFieldProperty as UI5Element).data(\"isSlot\") === \"true\" && mPropertyBag) {\n\t\t\t// Inserting into the modifier creates a change from flex also filter is been removed hence promise is resolved to false\n\t\t\tmodifier.insertAggregation(oParentControl, \"dependents\", oFilterFieldProperty);\n\t\t\tdoRemoveItem = false;\n\t\t}\n\t}\n\treturn Promise.resolve(doRemoveItem);\n};\n\n/**\n * Method responsible for creating filter field condition in standalone / personalization filter bar.\n * @param oParentControl Parent control instance to which the filter field is added\n * @param sPropertyInfoName Name of the property being added as filter field\n * @param mPropertyBag Instance of property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns The resolved promise\n */\nODataFilterBarDelegate.addCondition = async function (\n\toParentControl: FilterBar,\n\tsPropertyInfoName: string,\n\tmPropertyBag: { appComponent: AppComponent; modifier: BaseTreeModifier }\n): Promise<void | null> {\n\tconst modifier = mPropertyBag.modifier;\n\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\tif (isXML) {\n\t\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\t\tconst oMetaModel = model && model.getMetaModel();\n\t\tif (!oMetaModel) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, sPropertyInfoName);\n\t}\n\treturn Promise.resolve();\n};\n\n/**\n * Method responsible for removing filter field in standalone / personalization filter bar.\n * @param oParentControl Parent control instance from which the filter field is removed\n * @param sPropertyInfoName Name of the property being removed as filter field\n * @param mPropertyBag Instance of property bag from Flex API\n * @param mPropertyBag.appComponent AppComponent\n * @param mPropertyBag.modifier Modifier from Flex API\n * @returns The resolved promise\n */\nODataFilterBarDelegate.removeCondition = async function (\n\toParentControl: FilterBar,\n\tsPropertyInfoName: string,\n\tmPropertyBag: {\n\t\tappComponent: AppComponent;\n\t\tmodifier: BaseTreeModifier;\n\t}\n): Promise<void | null> {\n\tif (!oParentControl.data(\"sap_fe_FilterBarDelegate_propertyInfoMap\")) {\n\t\tconst modifier = mPropertyBag.modifier;\n\t\tconst isXML = modifier && modifier.targets === \"xmlTree\";\n\t\tif (isXML) {\n\t\t\tconst model = mPropertyBag && mPropertyBag.appComponent && mPropertyBag.appComponent.getModel();\n\t\t\tconst oMetaModel = model && model.getMetaModel();\n\t\t\tif (!oMetaModel) {\n\t\t\t\treturn Promise.resolve(null);\n\t\t\t}\n\t\t\tawait _addPropertyInfo(oParentControl, mPropertyBag, oMetaModel, sPropertyInfoName);\n\t\t}\n\t}\n\treturn Promise.resolve();\n};\n/**\n * Clears all input values of visible filter fields in the filter bar.\n * @param oFilterControl Instance of the FilterBar control\n * @returns The resolved promise\n */\nODataFilterBarDelegate.clearFilters = async function (oFilterControl: FilterBar): Promise<void> {\n\tconst filterBarAPI = oFilterControl.getParent();\n\treturn StateHelper.clearFilterValues(filterBarAPI as MacroAPI);\n};\n/**\n * Creates the filter field in the table adaptation of the FilterBar.\n * @param sPropertyInfoName The property name of the entity type for which the filter field needs to be created\n * @param oParentControl Instance of the parent control\n * @returns Once resolved, a filter field definition is returned\n */\nODataFilterBarDelegate._addP13nItem = async function (\n\tsPropertyInfoName: string,\n\toParentControl: FilterBar\n): Promise<NullableModifierElement> {\n\treturn DelegateUtil.fetchModel(oParentControl)\n\t\t.then(async function (oModel: Model) {\n\t\t\treturn ODataFilterBarDelegate._addFlexItem(\n\t\t\t\tsPropertyInfoName,\n\t\t\t\toParentControl,\n\t\t\t\toModel.getMetaModel() as ODataMetaModel,\n\t\t\t\tundefined\n\t\t\t);\n\t\t})\n\t\t.catch(function (oError) {\n\t\t\tLog.error(\"Model could not be resolved\", oError as string);\n\t\t\treturn null;\n\t\t});\n};\nODataFilterBarDelegate.fetchPropertiesForEntity = function (\n\tsEntityTypePath: string,\n\toMetaModel: ODataMetaModel,\n\toFilterControl: IFilterControl\n): PropertyInfo[] {\n\tconst oEntityType = oMetaModel.getObject(sEntityTypePath);\n\tconst includeHidden = oFilterControl.isA(\"sap.ui.mdc.filterbar.vh.FilterBar\") ? true : undefined;\n\tif (!oFilterControl || !oEntityType) {\n\t\treturn [];\n\t}\n\tconst oConverterContext = FilterUtils.createConverterContext(oFilterControl, sEntityTypePath);\n\tconst sEntitySetPath = ModelHelper.getEntitySetPath(sEntityTypePath);\n\n\tconst mFilterFields = FilterUtils.getConvertedFilterFields(oFilterControl, sEntityTypePath, includeHidden);\n\tlet aFetchedProperties: FEPropertyInfo[] = [];\n\tmFilterFields.forEach(function (oFilterFieldInfo: FilterField) {\n\t\tconst sAnnotationPath = oFilterFieldInfo.annotationPath;\n\t\tif (sAnnotationPath) {\n\t\t\tconst oPropertyAnnotations = oConverterContext.getConvertedTypes().resolvePath<Property>(sAnnotationPath).target;\n\t\t\tconst sTargetPropertyPrefix = CommonHelper.getLocationForPropertyPath(oMetaModel, sAnnotationPath);\n\t\t\tconst sProperty = sAnnotationPath.replace(`${sTargetPropertyPrefix}/`, \"\");\n\t\t\tconst entityType = oConverterContext.getEntityType();\n\t\t\tconst selectionFields = entityType.annotations?.UI?.SelectionFields;\n\t\t\tconst filterFacets = entityType.annotations?.UI?.FilterFacets;\n\t\t\tif (\n\t\t\t\toPropertyAnnotations &&\n\t\t\t\tODataFilterBarDelegate._isFilterAdaptable(oFilterFieldInfo, oPropertyAnnotations, selectionFields, filterFacets) &&\n\t\t\t\tisPropertyFilterable(oMetaModel, sTargetPropertyPrefix, _getPropertyPath(sProperty), true)\n\t\t\t) {\n\t\t\t\taFetchedProperties.push(oFilterFieldInfo as PropertyInfo);\n\t\t\t}\n\t\t} else {\n\t\t\t//Custom Filters\n\t\t\taFetchedProperties.push(oFilterFieldInfo as PropertyInfo);\n\t\t}\n\t});\n\n\tconst aParameterFields: string[] = [];\n\tconst processedFields = processSelectionFields(aFetchedProperties as FilterField[], oConverterContext);\n\tconst processedFieldsKeys: string[] = [];\n\tprocessedFields.forEach(function (oProps: FEPropertyInfo) {\n\t\tif (oProps.key) {\n\t\t\tprocessedFieldsKeys.push(oProps.key);\n\t\t}\n\t});\n\n\taFetchedProperties = aFetchedProperties.filter(function (oProp: FEPropertyInfo) {\n\t\treturn processedFieldsKeys.includes(oProp.key!);\n\t});\n\n\tconst oFR = CommonUtils.getFilterRestrictionsByPath(sEntitySetPath, oMetaModel),\n\t\tmAllowedExpressions = oFR.FilterAllowedExpressions;\n\t//Object.keys(processedFields).forEach(function (sFilterFieldKey: string) {\n\tprocessedFields.forEach(function (oProp, iFilterFieldIndex: number) {\n\t\tconst oSelField = aFetchedProperties[iFilterFieldIndex];\n\t\tif (!oSelField || !oSelField.conditionPath) {\n\t\t\treturn;\n\t\t}\n\t\tconst sPropertyPath = _getPropertyPath(oSelField.conditionPath);\n\t\t//fetchBasic\n\t\toProp = Object.assign(oProp, {\n\t\t\tgroup: oSelField.group,\n\t\t\tgroupLabel: oSelField.groupLabel,\n\t\t\tpath: oSelField.conditionPath,\n\t\t\ttooltip: null,\n\t\t\tremoveFromAppState: false,\n\t\t\thasValueHelp: false\n\t\t});\n\n\t\t//fetchPropInfo\n\t\tif (oSelField.annotationPath) {\n\t\t\tconst sAnnotationPath = oSelField.annotationPath;\n\t\t\tconst oProperty = oMetaModel.getObject(sAnnotationPath),\n\t\t\t\toPropertyAnnotations = oMetaModel.getObject(`${sAnnotationPath}@`),\n\t\t\t\toPropertyContext = oMetaModel.createBindingContext(sAnnotationPath);\n\n\t\t\tconst bRemoveFromAppState =\n\t\t\t\toPropertyAnnotations[\"@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive\"] ||\n\t\t\t\toPropertyAnnotations[\"@com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext\"] ||\n\t\t\t\toPropertyAnnotations[\"@com.sap.vocabularies.Analytics.v1.Measure\"];\n\n\t\t\tconst sTargetPropertyPrefix = CommonHelper.getLocationForPropertyPath(oMetaModel, oSelField.annotationPath);\n\t\t\tconst sProperty = sAnnotationPath.replace(`${sTargetPropertyPrefix}/`, \"\");\n\t\t\tlet oFilterDefaultValueAnnotation;\n\t\t\tlet oFilterDefaultValue;\n\t\t\tif (oPropertyContext && isPropertyFilterable(oMetaModel, sTargetPropertyPrefix, _getPropertyPath(sProperty), true)) {\n\t\t\t\toFilterDefaultValueAnnotation = oPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.FilterDefaultValue\"];\n\t\t\t\tif (oFilterDefaultValueAnnotation) {\n\t\t\t\t\toFilterDefaultValue = oFilterDefaultValueAnnotation[`$${getModelType(oProperty.$Type)}`];\n\t\t\t\t}\n\n\t\t\t\toProp = Object.assign(oProp, {\n\t\t\t\t\ttooltip: oPropertyAnnotations[\"@com.sap.vocabularies.Common.v1.QuickInfo\"] || undefined,\n\t\t\t\t\tremoveFromAppState: bRemoveFromAppState,\n\t\t\t\t\thasValueHelp: hasValueHelp(oPropertyContext.getObject(), { context: oPropertyContext }),\n\t\t\t\t\tdefaultFilterConditions: oFilterDefaultValue\n\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfieldPath: oSelField.conditionPath,\n\t\t\t\t\t\t\t\t\toperator: \"EQ\",\n\t\t\t\t\t\t\t\t\tvalues: [oFilterDefaultValue]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t  ]\n\t\t\t\t\t\t: undefined\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t//base\n\n\t\tif (oProp) {\n\t\t\tif (mAllowedExpressions[sPropertyPath] && mAllowedExpressions[sPropertyPath].length > 0) {\n\t\t\t\toProp.filterExpression = CommonUtils.getSpecificAllowedExpression(mAllowedExpressions[sPropertyPath]);\n\t\t\t} else {\n\t\t\t\toProp.filterExpression = \"auto\";\n\t\t\t}\n\n\t\t\toProp = Object.assign(oProp, {\n\t\t\t\tvisible: oSelField.availability === \"Default\"\n\t\t\t});\n\t\t}\n\n\t\tprocessedFields[iFilterFieldIndex] = oProp;\n\t});\n\tprocessedFields.forEach(function (propInfo: FEPropertyInfo) {\n\t\t// key should have the same value as name\n\t\tpropInfo.key = propInfo.name;\n\t\tif (propInfo.path === \"$editState\") {\n\t\t\tpropInfo.label = getResourceModel(oFilterControl).getText(\"FILTERBAR_EDITING_STATUS\");\n\t\t}\n\t\tpropInfo.typeConfig = TypeMap.getTypeConfig(propInfo.dataType, propInfo.formatOptions, propInfo.constraints);\n\t\tpropInfo.label = getLocalizedText(propInfo.label!, oFilterControl) || \"\";\n\t\tif (propInfo.isParameter) {\n\t\t\taParameterFields.push(propInfo.name);\n\t\t}\n\t});\n\n\taFetchedProperties = processedFields;\n\tDelegateUtil.setCustomData(oFilterControl, \"parameters\", aParameterFields as unknown as string);\n\n\treturn aFetchedProperties as PropertyInfo[];\n};\n\nfunction getLineItemQualifierFromTable(oControl: ManagedObject, oMetaModel: ODataMetaModel): string | undefined {\n\tif (oControl.isA<EnhanceWithUI5<TableAPI>>(\"sap.fe.macros.table.TableAPI\")) {\n\t\tconst annotationPaths = oControl.getMetaPath().split(\"#\")[0].split(\"/\");\n\t\tswitch (annotationPaths[annotationPaths.length - 1]) {\n\t\t\tcase `@${UIAnnotationTerms.SelectionPresentationVariant}`:\n\t\t\tcase `@${UIAnnotationTerms.PresentationVariant}`:\n\t\t\t\treturn oMetaModel\n\t\t\t\t\t.getObject(oControl.getMetaPath())\n\t\t\t\t\t.Visualizations?.find((visualization: { $AnnotationPath: string }) =>\n\t\t\t\t\t\tvisualization.$AnnotationPath.includes(`@${UIAnnotationTerms.LineItem}`)\n\t\t\t\t\t).$AnnotationPath;\n\t\t\tcase `@${UIAnnotationTerms.LineItem}`:\n\t\t\t\tconst metaPaths = oControl.getMetaPath().split(\"/\");\n\t\t\t\treturn metaPaths[metaPaths.length - 1];\n\t\t}\n\t}\n\treturn undefined;\n}\n\nODataFilterBarDelegate._isFilterAdaptable = function (\n\tfilterFieldInfo: FilterField,\n\tpropertyAnnotations: Property,\n\tselectionFields?: SelectionFields,\n\tfilterFacets?: FilterFacets\n): boolean {\n\tlet isInFilterFacets: boolean;\n\tconst isSelectionField = selectionFields ? ODataFilterBarDelegate._isFilterInSelectionFields(selectionFields, filterFieldInfo) : false;\n\tif (filterFacets) {\n\t\tisInFilterFacets = filterFacets.some(function (filterFacet: ReferenceFacet) {\n\t\t\tconst fieldGroup = filterFacet.Target?.$target as FieldGroupType;\n\t\t\treturn fieldGroup?.Data.some(function (dataField: DataFieldAbstractTypes) {\n\t\t\t\t// we expect dataField to be DataFieldTypes (having a Value) inside FieldGroups inside FilterFacets\n\t\t\t\tif ((dataField as DataFieldTypes).Value.path === filterFieldInfo.key) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t// dataField types having no Value (DataFieldForAnnotationTypes, DataFieldForActionAbstractTypes, DataFieldForActionGroupTypes), there is nothing to check, but this should not occur anyway\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\t} else {\n\t\tisInFilterFacets = false;\n\t}\n\treturn isSelectionField || isInFilterFacets || !propertyAnnotations.annotations?.UI?.AdaptationHidden;\n};\n\nODataFilterBarDelegate._isFilterInSelectionFields = function (selectionFields: SelectionFields, filterFieldInfo: FilterField): boolean {\n\tconst filterFieldKey = filterFieldInfo.key?.indexOf(\"::\") > 0 ? filterFieldInfo.key?.replace(\"::\", \"/\") : filterFieldInfo.key;\n\treturn selectionFields.some(function (selectionField: AnnotationSelectionField) {\n\t\tif (selectionField.value === filterFieldKey) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t});\n};\n\nODataFilterBarDelegate._addFlexItem = async function (\n\tsFlexPropertyName: string,\n\toParentControl: FilterBar,\n\toMetaModel: ODataMetaModel,\n\toModifier: BaseTreeModifier | undefined,\n\toAppComponent: AppComponent | undefined,\n\tview?: View | undefined\n): Promise<NullableModifierElement> {\n\tconst sFilterBarId = oModifier ? oModifier.getId(oParentControl) : oParentControl.getId(),\n\t\tsIdPrefix = oModifier ? \"\" : \"Adaptation\",\n\t\taSelectionFields = FilterUtils.getConvertedFilterFields(\n\t\t\toParentControl as unknown as IFilterControl,\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\toMetaModel,\n\t\t\toAppComponent,\n\t\t\toModifier,\n\t\t\toModifier ? undefined : getLineItemQualifierFromTable(oParentControl.getParent()!, oMetaModel)\n\t\t),\n\t\toSelectionField = ODataFilterBarDelegate._findSelectionField(aSelectionFields, sFlexPropertyName),\n\t\tsPropertyPath = _getPropertyPath(sFlexPropertyName),\n\t\tbIsXML = !!oModifier && oModifier.targets === \"xmlTree\";\n\tif (sFlexPropertyName === EDIT_STATE_PROPERTY_NAME) {\n\t\treturn _templateEditState(_generateIdPrefix(sFilterBarId, `${sIdPrefix}FilterField`), oMetaModel, oModifier);\n\t} else if (sFlexPropertyName === SEARCH_PROPERTY_NAME) {\n\t\treturn Promise.resolve(null);\n\t} else if (oSelectionField?.template) {\n\t\treturn ODataFilterBarDelegate._templateCustomFilter(\n\t\t\toParentControl as unknown as IFilterControl,\n\t\t\t_generateIdPrefix(sFilterBarId, `${sIdPrefix}`),\n\t\t\toSelectionField,\n\t\t\toMetaModel,\n\t\t\toModifier!\n\t\t);\n\t}\n\n\tif (oSelectionField?.type === \"Slot\" && oModifier) {\n\t\treturn _addXMLCustomFilterField(oParentControl as unknown as IFilterControl, oModifier, sPropertyPath);\n\t}\n\n\tconst sNavigationPath = CommonHelper.getNavigationPath(sPropertyPath);\n\tlet sEntityTypePath: string;\n\tlet sUseSemanticDateRange;\n\tlet oSettings: {\n\t\tbindingContexts: {\n\t\t\tcontextPath: Context;\n\t\t\tproperty: Context;\n\t\t};\n\t\tmodels: {\n\t\t\tcontextPath: ODataMetaModel;\n\t\t\tproperty?: ODataMetaModel;\n\t\t\tmetaPath?: ODataMetaModel;\n\t\t};\n\t\tisXML: boolean;\n\t};\n\tlet sBindingPath;\n\tlet oParameters: {\n\t\tmetaPath: string;\n\t\tsPropertyName: string;\n\t\tsBindingPath: string;\n\t\tsValueHelpType: string;\n\t\toMetaModel: ODataMetaModel;\n\t\tsIdPrefix: string;\n\t\toSettings: unknown;\n\t\tsVhIdPrefix: string;\n\t\tsNavigationPrefix?: string;\n\t\tbUseSemanticDateRange: boolean;\n\t\toModifier?: BaseTreeModifier;\n\t\toControl: UI5Element;\n\t\tvisualFilter?: unknown;\n\t\tview?: View;\n\t};\n\n\treturn Promise.resolve()\n\t\t.then(async function () {\n\t\t\tif (oSelectionField?.isParameter) {\n\t\t\t\tconst sAnnotationPath = oSelectionField.annotationPath;\n\t\t\t\treturn sAnnotationPath.substring(0, sAnnotationPath.lastIndexOf(\"/\") + 1);\n\t\t\t}\n\t\t\treturn DelegateUtil.getCustomDataWithModifier<string>(oParentControl, \"entityType\", oModifier);\n\t\t})\n\t\t.then(async function (sRetrievedEntityTypePath: string | undefined) {\n\t\t\tsEntityTypePath = sRetrievedEntityTypePath!;\n\t\t\treturn DelegateUtil.getCustomDataWithModifier<string>(oParentControl, \"useSemanticDateRange\", oModifier);\n\t\t})\n\t\t.then(async function (sRetrievedUseSemanticDateRange: string | undefined) {\n\t\t\tsUseSemanticDateRange = sRetrievedUseSemanticDateRange;\n\t\t\tconst oPropertyContext = oMetaModel.createBindingContext(sEntityTypePath + sPropertyPath)!;\n\t\t\tconst sInFilterBarId = oModifier ? oModifier.getId(oParentControl) : oParentControl.getId();\n\t\t\toSettings = {\n\t\t\t\tbindingContexts: {\n\t\t\t\t\tcontextPath: oMetaModel.createBindingContext(sEntityTypePath)!,\n\t\t\t\t\tproperty: oPropertyContext\n\t\t\t\t},\n\t\t\t\tmodels: {\n\t\t\t\t\tcontextPath: oMetaModel,\n\t\t\t\t\tproperty: oMetaModel\n\t\t\t\t},\n\t\t\t\tisXML: bIsXML\n\t\t\t};\n\t\t\tsBindingPath = `/${ModelHelper.getEntitySetPath(sEntityTypePath)\n\t\t\t\t.split(\"/\")\n\t\t\t\t.filter(ModelHelper.filterOutNavPropBinding)\n\t\t\t\t.join(\"/\")}`;\n\t\t\toParameters = {\n\t\t\t\tmetaPath: oPropertyContext.getPath(),\n\t\t\t\tsPropertyName: sPropertyPath,\n\t\t\t\tsBindingPath: sBindingPath,\n\t\t\t\tsValueHelpType: sIdPrefix + VALUE_HELP_TYPE,\n\t\t\t\toControl: oParentControl,\n\t\t\t\toMetaModel: oMetaModel,\n\t\t\t\toModifier: oModifier,\n\t\t\t\tsIdPrefix: _generateIdPrefix(sInFilterBarId, `${sIdPrefix}FilterField`, sNavigationPath),\n\t\t\t\tsVhIdPrefix: _generateIdPrefix(sInFilterBarId, sIdPrefix + VALUE_HELP_TYPE),\n\t\t\t\tsNavigationPrefix: sNavigationPath,\n\t\t\t\tbUseSemanticDateRange: sUseSemanticDateRange as unknown as boolean,\n\t\t\t\toSettings: oSelectionField?.settings ?? {},\n\t\t\t\tvisualFilter: oSelectionField?.visualFilter,\n\t\t\t\tview\n\t\t\t};\n\n\t\t\treturn DelegateUtil.doesValueHelpExist(oParameters);\n\t\t})\n\t\t.then(async function (bValueHelpExists: boolean) {\n\t\t\tif (!bValueHelpExists) {\n\t\t\t\treturn _templateValueHelp(\n\t\t\t\t\t{\n\t\t\t\t\t\tbindingContexts: {\n\t\t\t\t\t\t\tcontextPath: oMetaModel.createBindingContext(sEntityTypePath)!,\n\t\t\t\t\t\t\tmetaPath: oSettings.bindingContexts.property\n\t\t\t\t\t\t},\n\t\t\t\t\t\tmodels: {\n\t\t\t\t\t\t\tcontextPath: oMetaModel,\n\t\t\t\t\t\t\tmetaPath: oMetaModel\n\t\t\t\t\t\t},\n\t\t\t\t\t\tisXML: bIsXML\n\t\t\t\t\t},\n\t\t\t\t\toParameters\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn;\n\t\t})\n\t\t.then(async function () {\n\t\t\treturn DelegateUtil.getCustomDataWithModifier<string>(oParentControl, \"localId\", oModifier);\n\t\t})\n\t\t.then(async function (localId: string | undefined) {\n\t\t\tlet pageModel;\n\t\t\tif (oParameters.visualFilter) {\n\t\t\t\t//Need to set the convertercontext as pageModel in settings for BuildingBlock 2.0\n\t\t\t\tpageModel = CommonUtils.getTargetView(oParentControl).getController()._getPageModel();\n\t\t\t}\n\t\t\treturn _templateFilterField(oSettings, oParameters, localId, pageModel);\n\t\t});\n};\nfunction _getCachedProperties(oFilterBar: IFilterControl | Element): null | PropertyInfo[] | undefined {\n\t// properties are not cached during templating\n\tif (oFilterBar instanceof window.Element) {\n\t\treturn null;\n\t}\n\treturn DelegateUtil.getCustomData<PropertyInfo[]>(oFilterBar, FETCHED_PROPERTIES_DATA_KEY);\n}\nfunction _setCachedProperties(oFilterBar: IFilterControl | Element, aFetchedProperties: PropertyInfo[]): void {\n\t// do not cache during templating, else it becomes part of the cached view\n\tif (oFilterBar instanceof window.Element) {\n\t\treturn;\n\t}\n\tDelegateUtil.setCustomData(oFilterBar, FETCHED_PROPERTIES_DATA_KEY, aFetchedProperties as unknown as string);\n}\nfunction _getCachedOrFetchPropertiesForEntity(\n\tsEntityTypePath: string,\n\toMetaModel: ODataMetaModel,\n\toFilterBar: IFilterControl\n): ControlPropertyInfo[] | PropertyInfoExternal[] {\n\tlet aFetchedProperties = _getCachedProperties(oFilterBar);\n\tlet localGroupLabel;\n\n\tif (!aFetchedProperties) {\n\t\taFetchedProperties = ODataFilterBarDelegate.fetchPropertiesForEntity(sEntityTypePath, oMetaModel, oFilterBar);\n\t\taFetchedProperties.forEach(function (oGroup: FEPropertyInfo) {\n\t\t\tlocalGroupLabel = null;\n\t\t\tif (oGroup.groupLabel) {\n\t\t\t\tlocalGroupLabel = getLocalizedText(oGroup.groupLabel, oFilterBar);\n\t\t\t\toGroup.groupLabel = localGroupLabel === null ? oGroup.groupLabel : localGroupLabel;\n\t\t\t}\n\t\t});\n\t\tsortPropertyInfosByGroupLabel(aFetchedProperties);\n\t\t_setCachedProperties(oFilterBar, aFetchedProperties);\n\t}\n\treturn aFetchedProperties;\n}\nODataFilterBarDelegate.fetchProperties = async function (filterBar: FilterBar): Promise<PropertyInfoExternal[]> {\n\tconst propertyInfos = await ODataFilterBarDelegate.fetchFilterProperties(filterBar as unknown as IFilterControl);\n\tDelegateUtil.setCustomData(filterBar, \"feFilterInfo\", propertyInfos);\n\tif (propertyInfos.length > 0) {\n\t\treturn FilterUtils.formatPropertyInfo(propertyInfos as PropertyInfo[]) as PropertyInfoExternal[];\n\t} else {\n\t\treturn [];\n\t}\n};\n\nODataFilterBarDelegate.fetchFilterProperties = async function (\n\tfilterBar: IFilterControl\n): Promise<ControlPropertyInfo[] | PropertyInfoExternal[]> {\n\tconst entityTypePath = DelegateUtil.getCustomData<string>(filterBar, \"entityType\")!;\n\treturn DelegateUtil.fetchModel(filterBar as FilterBar).then(function (model: Model) {\n\t\tif (!model) {\n\t\t\treturn [];\n\t\t}\n\t\treturn _getCachedOrFetchPropertiesForEntity(entityTypePath, model.getMetaModel() as ODataMetaModel, filterBar);\n\t});\n};\n\nODataFilterBarDelegate.getTypeMap = function (): typeof TypeMap {\n\treturn TypeMap;\n};\n\nexport default ODataFilterBarDelegate;\n"],"mappings":"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","ignoreList":[]}