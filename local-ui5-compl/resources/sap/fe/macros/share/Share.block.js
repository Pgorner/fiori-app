/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/templating/BuildingBlockSupport","sap/fe/core/buildingBlocks/templating/RuntimeBuildingBlock","sap/fe/core/controls/CommandExecution","sap/fe/core/helpers/BindingHelper","sap/m/Menu","sap/m/MenuItem","sap/ui/core/CustomData","sap/ui/performance/trace/FESRHelper","sap/m/OverflowToolbarMenuButton","sap/ui/base/BindingParser","./ShareAPI","sap/fe/base/jsx-runtime/jsx"],function(e,t,n,i,a,r,s,o,l,u,c,p,h,m,b,f){"use strict";var d,g,M,A,_,S,O,T,C,I,E,y,w,B,v,R,L,k,N,x,V,P,z,D,H,j,J,F,G,U,$,W,q;function K(e){return new Promise((t,n)=>{sap.ui.require([e],n=>{if(!(n&&n.__esModule)){n=n===null||!(typeof n==="object"&&e.endsWith("/library"))?{default:n}:n;Object.defineProperty(n,"__esModule",{value:true})}t(n)},e=>{n(e)})})}var Q={};var X=o.UI;var Y=a.defineBuildingBlock;var Z=a.blockAttribute;var ee=n.defineReference;var te=t.resolveBindingString;var ne=t.or;var ie=t.not;var ae=t.constant;var re=t.compileExpression;var se=t.and;function oe(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function le(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,ue(e,t)}function ue(e,t){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ue(e,t)}function ce(e,t,n,i,a){var r={};return Object.keys(i).forEach(function(e){r[e]=i[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce(function(n,i){return i(e,t,n)||n},r),a&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(a):void 0,r.initializer=void 0),void 0===r.initializer?(Object.defineProperty(e,t,r),null):r}function pe(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const he={COLLABORATION_MSTEAMS_CARD:"COLLABORATION_MSTEAMS_CARD",COLLABORATION_MSTEAMS_TAB:"COLLABORATION_MSTEAMS_TAB",COLLABORATION_MSTEAMS_CHAT:"COLLABORATION_MSTEAMS_CHAT"};const me={...he,...{SEND_EMAIL:"SEND_EMAIL",SHARE_JAM:"SHARE_JAM",SAVE_AS_TILE:"SAVE_AS_TILE",MS_TEAMS_GROUP:"MS_TEAMS_GROUP",SHARE_COLLABORATION_MANAGER:"SHARE_COLLABORATION_MANAGER"}};let be=(d=Y({name:"Share",namespace:"sap.fe.macros.internal",publicNamespace:"sap.fe.macros",returnTypes:["sap.fe.macros.share.ShareAPI"]}),g=Z({type:"string",required:true,isPublic:true}),M=Z({type:"boolean",isPublic:true,bindable:true}),A=Z({type:"object",isPublic:true}),_=Z({type:"object",isPublic:false}),S=ee(),O=ee(),T=ee(),C=ee(),I=ee(),E=ee(),y=ee(),w=ee(),B=ee(),v=ee(),R=ee(),d(L=(k=function(t){function n(){var e;for(var n=arguments.length,i=new Array(n),a=0;a<n;a++){i[a]=arguments[a]}e=t.call(this,...i)||this;oe(e,"id",N,e);oe(e,"visible",x,e);oe(e,"shareOptions",V,e);oe(e,"msTeamsOptions",P,e);oe(e,"menuButton",z,e);oe(e,"cmdExecution",D,e);oe(e,"menu",H,e);oe(e,"saveAsTileMenuItem",j,e);oe(e,"shareAsCollaborationManager",J,e);oe(e,"shareViaJAMMenuItem",F,e);oe(e,"sendEmailMenuItem",G,e);oe(e,"shareAsCardMenuItem",U,e);oe(e,"shareViaChatMenuItem",$,e);oe(e,"shareAsTabMenuItem",W,e);oe(e,"msTeamsGroupMenuItem",q,e);return e}Q=n;le(n,t);var a=n.prototype;a._initializeMenuItems=async function e(t,n){let i=false;if(n.getEnvironmentCapabilities().getCapabilities().Collaboration){const{default:e}=await K("sap/suite/ui/commons/collaboration/CollaborationHelper");i=await e.isTeamsModeActive()}if(i){this.menuButton.current?.unbindProperty("visible",true);this.menuButton.current?.setVisible(false);return}const a=t.getController();const r=n.getShellServices();const s=await r.waitForPluginsLoad();if(!s){const e=this.menuButton.current?.getAggregation("_control");e?.attachEventOnce("press",{},()=>this._initializeMenuItems,this)}this._blockInternalConfig=this._getShareBlockConfig(t);await this._addMenuItems(a,r);this.setShareOptionsVisibility()};a._addMenuItems=async function e(t,n){this._addSendEmailOption(t);await this._addShellBasedMenuItems(t,n)};a._addSendEmailOption=function e(t){if(this.shareOptions?.showSendEmail??true){this?.menu?.current?.addItem(f(u,{ref:this.sendEmailMenuItem,text:this.getTranslatedText("T_SEMANTIC_CONTROL_SEND_EMAIL"),icon:"sap-icon://email",press:async()=>t.share._triggerEmail()}))}};a._addShellBasedMenuItems=async function e(t,n){const i=n.hasUShell();if(i){this._addShareViaJAMOption(t,n);await this._addMSTeamsOptions(t);await this._addCollaborationManagerOption(t);await this._addSaveAsTileOption(t)}};a._addCollaborationManagerOption=async function t(n){try{const e=n.getAppComponent().getCollaborativeToolsService();const t=await e.getCollaborationManagerOption();if(t&&(this.shareOptions?.showCollaborationManager??false)){const e=f(u,{ref:this.shareAsCollaborationManager,text:t.text,icon:t.icon,press:async e=>this._collaborationManagerButtonPress(t.press,e)});p.setSemanticStepname(e,"press",t.fesrStepName);this?.menu?.current?.addItem(e)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Adding Collaboration Manager Option : ${n}`)}};a._collaborationManagerButtonPress=async function e(t,n){const a=n.getSource();const r=i.getTargetView(a);const s=r.getController();await s.share._adaptShareMetadata();const o=r.getModel("shareInfo");if(o){const e=o.getData();const{collaborationInfo:n}=e;t(n.appTitle,n.url)}};a._addShareViaJAMOption=function e(t,n){const i=!!n.isJamActive?.();if(i){this?.menu?.current?.addItem(f(u,{ref:this.shareViaJAMMenuItem,text:this.getTranslatedText("T_COMMON_SAPFE_SHARE_JAM"),icon:"sap-icon://share-2",press:async()=>t.share._triggerShareToJam()}))}};a._addMSTeamsOptions=async function t(n){try{if(this._blockInternalConfig?.showMsTeamsOptions===false){return}const e=n.getAppComponent().getCollaborativeToolsService();const t=await e.getTeamsCollabOptionsViaShare({isShareAsCardEnabled:this._getIsShareAsCardEnabled()});if(!t){return}for(const e of t){const t=this._getMsTeamsMenuItemSettings(e);const n=t.items;const i=Array.isArray(n)&&n.length?me.MS_TEAMS_GROUP:e.key;this._addMsTeamsMenuItem(t,i,e.fesrStepName)}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : Share : adding MS teams options : ${n}`)}};a._addSaveAsTileOption=async function t(n){try{const{default:e}=await K("sap/ushell/ui/footerbar/AddBookmarkButton");const t=new e;if(t.getEnabled()){this?.menu?.current?.addItem(f(u,{ref:this.saveAsTileMenuItem,text:t.getText(),icon:t.getIcon(),press:async()=>n.share._saveAsTile(this.saveAsTileMenuItem.current),children:{dependents:[t]}}))}else{t.destroy()}}catch(t){const n=t instanceof Error?t.message:String(t);e.error(`FE : Buildingblock : Share : adding Save as tile option : ${n}`)}};a._getIsShareAsCardEnabled=function t(){const n=this.msTeamsOptions?.enableCard??false;if(typeof n==="boolean"){return n}else if(typeof n==="string"){try{return n==="true"||Boolean(m.complexParser(n))}catch(t){e.error(t)}}return true};a._getMsTeamsMenuItemSettings=function e(t){const n=this._getMsTeamsSubOptions(t?.subOptions);const i={text:t.text,icon:t.icon,items:n};if(n.length===0){i.press=async e=>this.collaborationMenuItemPress(e);i["customData"]=new c({key:"collaborationData",value:t})}return i};a._addMsTeamsMenuItem=function e(t,n,i){const a=f(u,{ref:this._getMenuItemReference(n),text:t.text,icon:t.icon,customData:t.customData,items:t.items});if(t.press){a.attachPress(t.press);if(i){p.setSemanticStepname(a,"press",i)}}this?.menu?.current?.addItem(a)};a._getMsTeamsSubOptions=function e(t){if(!Array.isArray(t)){return[]}return t.reduce((e,t)=>{const n=f(u,{ref:this._getMenuItemReference(t.key),text:t.text,icon:t.icon,press:async e=>this.collaborationMenuItemPress(e),customData:new c({key:"collaborationData",value:t})});if(t.fesrStepName){p.setSemanticStepname(n,"press",t.fesrStepName)}return[...e,n]},[])};a.collaborationMenuItemPress=async function t(n){const a=n.getSource();const r=i.getTargetView(a);const s=r.getController();await s.share._adaptShareMetadata();const o=r.getModel("shareInfo");if(o){const t=o.getData();const{collaborationInfo:n}=t;const i=a.data("collaborationData");const r=s.getAppComponent().getCollaborativeToolsService();const l=(await r.getCollaborationServices()).oTeamsHelperService;if(i["key"]===he.COLLABORATION_MSTEAMS_CARD){const t=l.isFeatureFlagEnabled();const i=t?await s.share.getCardDefinition():undefined;let a;if(i){const e=s.getAppComponent().getShellServices();const{semanticObject:t,action:n}=e.parseShellHash(document.location.hash);a=`${t}_${n}`}else{const n=!t?"Feature flag disabled in collaboration teams helper":"Card definition was not created";e.info(`FE V4 : Share block : share as Card : ${n}`)}n["cardManifest"]=i;n["cardId"]=a}l.share(i,n)}};a.setShareOptionsVisibility=function e(){const t=Object.keys(me);const n=t.reduce((e,t)=>{const n=this._getShareOptionVisibilityExpression(t);this._setShareOptionVisibility(t,n);return[...e,n]},[]);const i=se(this.visible,ne(...n));if(this.menuButton.current&&this.cmdExecution.current){this._bindUIVisibility(this.menuButton.current,i);this._bindUIVisibility(this.cmdExecution.current,i)}};a._getMenuItemReference=function e(t){let n;switch(t){case me.COLLABORATION_MSTEAMS_CARD:n=this.shareAsCardMenuItem;break;case me.COLLABORATION_MSTEAMS_CHAT:n=this.shareViaChatMenuItem;break;case me.COLLABORATION_MSTEAMS_TAB:n=this.shareAsTabMenuItem;break;case me.SEND_EMAIL:n=this.sendEmailMenuItem;break;case me.SHARE_JAM:n=this.shareViaJAMMenuItem;break;case me.SAVE_AS_TILE:n=this.saveAsTileMenuItem;break;case me.MS_TEAMS_GROUP:n=this.msTeamsGroupMenuItem;break;case me.SHARE_COLLABORATION_MANAGER:n=this.shareAsCollaborationManager;break;default:break}return n};a._getShareOptionVisibilityExpression=function e(t){const n=this._getMenuItemReference(t);if(!n?.current){return ae(false)}let i;switch(t){case me.COLLABORATION_MSTEAMS_CARD:case me.COLLABORATION_MSTEAMS_CHAT:case me.COLLABORATION_MSTEAMS_TAB:i=this._getMSTeamsShareOptionVisibility(t);break;case me.SHARE_COLLABORATION_MANAGER:i=this._getCollaborationOptionExpression();break;case me.SEND_EMAIL:{const e=this.shareOptions?.showSendEmail??true;const t=te(e,"boolean");const n=this._blockInternalConfig.showSendEmail??true;const a=te(n,"boolean");i=se(t,a);break}case me.SHARE_JAM:case me.SAVE_AS_TILE:{i=ae(true);break}case me.MS_TEAMS_GROUP:{const e=this._getShowMsTeamsOptionsExpression();const t=Object.keys(he);const n=t.reduce((e,t)=>{const n=this._getMSTeamsShareOptionVisibility(t);return[...e,n]},[]);i=se(e,ne(...n));break}default:i=ae(false)}return i};a._getCollaborationOptionExpression=function e(){const t=this.shareOptions?.showCollaborationManager??false;const n=te(t,"boolean");const i=this._blockInternalConfig.showCollaborationManager??true;const a=te(i,"boolean");return se(n,a)};a._getShowMsTeamsOptionsExpression=function e(){const t=this._blockInternalConfig.showMsTeamsOptions??true;return te(t,"boolean")};a._getShareAsCardVisibility=function e(){let t;const n=this._getMenuItemReference(me.COLLABORATION_MSTEAMS_CARD);if(n?.current){const e=this._getShowMsTeamsOptionsExpression();const n=this.msTeamsOptions?.enableCard??true;const i=te(n,"boolean");const a=this._blockInternalConfig.enableCard??true;const r=te(a,"boolean");const s=se(i,r);t=se(ie(X.IsEditable),e,s)}else{t=ae(false)}return t};a._getMSTeamsShareOptionVisibility=function e(t){if(t===me.COLLABORATION_MSTEAMS_CARD){return this._getShareAsCardVisibility()}const n=this._getMenuItemReference(t);return n?.current?this._getShowMsTeamsOptionsExpression():ae(false)};a._setShareOptionVisibility=function e(t,n){const i=this._getMenuItemReference(t);if(i?.current){this._bindUIVisibility(i.current,n)}};a._bindUIVisibility=function t(n,i){const a=re(i);if(a&&a.startsWith("{")&&a?.endsWith("}")){try{const e=m.complexParser(a);n.bindProperty("visible",e)}catch(t){e.error(t)}}else if(a==="false"){n.unbindProperty("visible",true);n.setVisible(false)}};a._getShareBlockConfig=function e(t){const n=t.getViewData();const i=n?.share;const a=t.getController();const r=a.getAppComponent().getManifestEntry("sap.fe")?.app?.share;const s=this._getOptionBlockConfig(r?.showSendEmail,i?.showSendEmail);const o=this._getOptionBlockConfig(r?.showCollaborationManager,i?.showCollaborationManager);const l=this._getOptionBlockConfig(r?.teams?.showMsTeamsOptions,i?.teams?.showMsTeamsOptions);const u=this._getOptionBlockConfig(r?.teams?.asCard,i?.teams?.asCard);return{showSendEmail:s,showMsTeamsOptions:l,enableCard:u,showCollaborationManager:o}};a._getOptionBlockConfig=function e(t,n){const i=typeof t==="string"?te(t):ae(t??true);const a=typeof n==="string"?te(n):ae(n??true);return re(se(i,a))};a.getContent=function t(n,i){const a=f(b,{id:this.id,children:f(h,{text:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE}",ref:this.menuButton,icon:"sap-icon://action",tooltip:"{sap.fe.i18n>M_COMMON_SAPFE_ACTION_SHARE} (Ctrl+Shift+S)",children:f(l,{ref:this.menu})})});n.addDependent(f(s,{ref:this.cmdExecution,command:"Share",execute:()=>{this.menuButton.current?.getMenu().openBy(this.menuButton.current,true)}}));this.isInitialized=this._initializeMenuItems(n,i).catch(t=>{e.error(t)});return a};return n}(r),N=ce(k.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),x=ce(k.prototype,"visible",[M],{configurable:true,enumerable:true,writable:true,initializer:function(){return ae(true)}}),V=ce(k.prototype,"shareOptions",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),P=ce(k.prototype,"msTeamsOptions",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),z=ce(k.prototype,"menuButton",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),D=ce(k.prototype,"cmdExecution",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),H=ce(k.prototype,"menu",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),j=ce(k.prototype,"saveAsTileMenuItem",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),J=ce(k.prototype,"shareAsCollaborationManager",[I],{configurable:true,enumerable:true,writable:true,initializer:null}),F=ce(k.prototype,"shareViaJAMMenuItem",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),G=ce(k.prototype,"sendEmailMenuItem",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),U=ce(k.prototype,"shareAsCardMenuItem",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),$=ce(k.prototype,"shareViaChatMenuItem",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),W=ce(k.prototype,"shareAsTabMenuItem",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),q=ce(k.prototype,"msTeamsGroupMenuItem",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),k))||L);Q=be;return Q},false);
//# sourceMappingURL=Share.block.js.map