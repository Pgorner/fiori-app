/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/ui/core/Element","sap/ui/mdc/field/FieldBaseDelegate","sap/ui/mdc/odata/v4/TypeMap","sap/ui/model/Filter"],function(e,t,n,a,o,r){"use strict";return Object.assign({},a,{apiVersion:2,initializeTypeFromBinding:function(e,t,n){const a={};if(t&&t.isA(["sap.ui.model.odata.type.Unit","sap.ui.model.odata.type.Currency"])&&Array.isArray(n)&&n.length>2&&n[2]!==undefined){t.formatValue(n,"string");a.bTypeInitialized=true;a.mCustomUnits=n[2]}return a},initializeInternalUnitType:function(e,t,n){if(n?.mCustomUnits!==undefined){t.formatValue([null,null,n.mCustomUnits],"string")}},enhanceValueForUnit:function(e,t,n){if(n?.bTypeInitialized===true&&t.length===2){t.push(n.mCustomUnits);return t}return undefined},getDefaultValueHelpDelegate:function(e){return{name:"sap/ui/mdc/odata/v4/ValueHelpDelegate",payload:{}}},getTypeMap:function(e){return o},_getValueListParameter:function(e,t){return e.Parameters.filter(function(e){if(e.LocalDataProperty){return e.LocalDataProperty.$PropertyPath===t}else{return false}})},_getFilter:function(e,t,a,o,i,s,l){const u=[];const c=e.Parameters.filter(function(e){return e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterIn"||e.$Type==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"||e.LocalDataProperty?.$PropertyPath===t&&e.ValueListProperty===a});for(const e of c){let a;if(e.LocalDataProperty?.$PropertyPath===t){a=o}else if(i?.isActionParameterDialog===true){const t=`APD_::${e.LocalDataProperty?.$PropertyPath}`;const o=n.getElementById(t);a=o?.getValue()}else if(s!==undefined){const t=e.LocalDataProperty?.$PropertyPath;const n=s?.[0];a=t&&n?.[t]}else if(l){const t=e.LocalDataProperty?.$PropertyPath;a=l.getObject(t)}if(a!==null&&a!==undefined){u.push(new r({path:e.ValueListProperty,operator:"EQ",value1:a}))}}return u},getItemForValue:function(e,t,n){if(n.value===""){return}if(n.checkDescription){const e=t.getPayload();const a=e.valueHelpDescriptionPath;const o=e?.maxLength;const r=n.value!==null&&n.value!==undefined?n.value.toString().length:0;if(a===""){n.checkDescription=false}else if(o!==undefined&&r>o){return}}return a.getItemForValue(e,t,n)},getDescription:async function(n,a,o,i,s,l,u,c,p,f,d){let m=n?.getPayload();if(!m&&f?.getDisplay().includes("Description")){m={retrieveTextFromValueList:true}}if(m?.retrieveTextFromValueList===true||m?.isFilterField===true){const n=a.getModel();const i=n?n.getMetaModel():t.getAppComponent(a).getModel().getMetaModel();const s=a.getPayload();const u=p?.[s.valueHelpQualifier];const c=s.propertyPath;const f=s?.propertyDescriptionPath;let d;try{const n=await i.requestValueListInfo(c,true,l);const p=i.getObject(`${c}@sapui.name`);const m=n[Object.keys(n)[0]];const g=this._getValueListParameter(m,p);const P=g?.[0]?.ValueListProperty;if(!P){throw Error(`Inconsistent value help annotation for ${p}`)}const h=m.$model;const y=h.getMetaModel().getObject(`/${m.CollectionPath}/${P}@com.sap.vocabularies.Common.v1.Text`);if(y&&y.$Path){d=y.$Path;const e=this._getFilter(m,p,P,o,s,u,l);const t=h.bindList(`/${m.CollectionPath}`,undefined,undefined,e,{$select:d});const n=await t.requestContexts(0,2);return n.length?n[0].getObject(d):undefined}else if(l!==undefined&&f){const n=f.lastIndexOf("/");const o=n>0?f.substring(0,n):f;const r=t.getAppComponent(a).getSideEffectsService();await r.requestSideEffects([o],l);e.warning(`RequestSideEffects is triggered because the text annotation for ${P} is not defined at the CollectionPath of the value help`);return undefined}else{const t=i?.getObject(`${s.propertyPath}@com.sap.vocabularies.Common.v1.ExternalID`)?.$Path;if(t){const e=s.propertyPath.replace(p,t);const n=i.getObject(`${e}@sapui.name`);const a=i?.getObject(`${e}@com.sap.vocabularies.Common.v1.Text`)?.$Path;const l=[];l.push(new r({path:n,operator:"EQ",value1:o}));const u=h.bindList(`/${m.CollectionPath}`,undefined,undefined,l,{$select:`${n},${a}`});const c=await u.requestContexts(0,2);if(c.length){return c[0].getObject(a)}}e.error(`Text Annotation for ${P} is not defined`);return undefined}}catch(t){const n=t?t.status:undefined;const a=t instanceof Error?t.message:String(t);const o=n===404?`Metadata not found (${n}) for value help of property ${c}`:a;e.error(o)}}return undefined}})},false);
//# sourceMappingURL=FieldBaseDelegate.js.map