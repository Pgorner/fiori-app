/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/KeepAliveHelper","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/ResourceModelHelper","sap/m/IllustratedMessage","sap/m/IllustratedMessageType","sap/m/ResponsivePopover","sap/m/library","sap/ui/Device","sap/ui/util/openWindow","../controls/FieldWrapper"],function(e,t,n,i,o,a,s,r,l,c,g,d){"use strict";var p=o.getResourceModel;const u={fetchRecommendations:function(e,n){const o=t.getTargetView(e);const a=e.getBindingContext();let s;const r=a?.getBinding();if(r.isA("sap.ui.model.odata.v4.ODataListBinding")){s=a}else{s=o.getBindingContext()}const l=u.getExtensionController(n);const c=e.getValueHelp();const g=i.getMetaPathForContext(e.getBindingContext());const d=e.data("sourcePath").replace(g,"");const p=`${e.getBindingContext()?.getPath()}${d}`;const f=e.getValue();l.recommendations.updateTelemetryDataBasedOnUserSelection(p,f);if(c&&c.includes("::TableValueHelp::")){const t=c.substring(0,c.indexOf("::TableValueHelp::"));const n=o.byId(t);const i=n?.getParent()?.getIdentifierColumn();l.recommendations.fetchAndApplyRecommendationsOnFieldChange(e,{context:s,contextIdentifier:i})}else{l.recommendations.fetchAndApplyRecommendationsOnFieldChange(e,{context:s})}},getExtensionController:function(e){return e.isA("sap.fe.core.ExtensionAPI")?e._controller:e},getFieldStateOnChange:function(e){let t=e.getSource(),n;const i=function(e){return e&&e.getDataState()?e.getDataState().getInvalidValue()===undefined:true};if(t.isA("sap.fe.macros.field.Field")){t=t.getContent()}if(t.isA("sap.fe.macros.field.FieldAPI")){t=t.getContent()}if(t.isA(d.getMetadata().getName())&&t.getEditMode()==="Editable"){t=t.getContentEdit()[0]}if(t.isA("sap.ui.mdc.Field")){let o=e.getParameter("valid")||e.getParameter("isValid");if(o===undefined){if(t.getMaxConditions()===1){const e=t.getBindingInfo("value");o=i(e&&e.binding)}if(t.getValue()===""&&!t.getProperty("required")){o=true}}n={fieldValue:t.getValue(),validity:!!o}}else{const e=t.getBinding("uploadUrl")||t.getBinding("value")||t.getBinding("selected");n={fieldValue:e&&e.getValue(),validity:i(e)}}return{field:t,state:n}},pressLink:async function(e){const t=e.getSource();let n=t.isA("sap.m.ObjectIdentifier")?t.findElements(false,e=>e.isA("sap.m.Link"))[0]:t;if(t?.isA("sap.fe.macros.controls.TextLink")){n=t.getContent()}if(t.getDependents()&&t.getDependents().length>0&&n.getProperty("text")!==""){const e=t.getDependents()[0];if(e&&e.isA("sap.ui.mdc.Link")){await u.openLink(e,n)}}return n},openLink:async function(i,o){try{const a=await i.getTriggerHref();if(!a){try{await i._useDelegateItems();const e=await i.retrieveLinkItems();if(e?.length===0&&i.getPayload().hasQuickViewFacets==="false"){const e=u.createPopoverWithNoTargets(i);i.addDependent(e);e.openBy(o)}else{await i.open(o)}}catch(t){e.error(`Cannot retrieve the QuickView Popover dialog: ${t}`)}}else{const i=t.getTargetView(o);const s=t.getAppComponent(i);const r=s.getShellServices();const l=r.parseShellHash(a);const c={target:{semanticObject:l.semanticObject,action:l.action},params:l.params};n.storeControlRefreshStrategyForHash(i,l);if(t.isStickyEditMode(o)!==true){await r.navigate(c,s)}else{try{const e=await r.hrefForExternal(c,s);g(e)}catch(t){e.error(`Error while retireving hrefForExternal : ${t}`)}}}}catch(t){e.error(`Error triggering link Href: ${t}`)}},createPopoverWithNoTargets:function(e){const t=e.getId();const n={title:p(e).getText("M_ILLUSTRATEDMESSAGE_TITLE"),description:p(e).getText("M_ILLUSTRATEDMESSAGE_DESCRIPTION"),enableFormattedText:true,illustrationSize:"Dot",illustrationType:s.Tent};const i=new a(`${t}-illustratedmessage`,n);const o={horizontalScrolling:false,showHeader:c.system.phone,placement:l.PlacementType.Auto,content:[i],afterClose:function(e){if(e.getSource()){e.getSource().destroy()}}};return new r(`${t}-popover`,o)}};return u},false);
//# sourceMappingURL=FieldRuntimeHelper.js.map