{"version":3,"file":"FieldRuntime.js","names":["getCollaborationBinding","field","binding","getBindingContext","getBinding","isA","oView","CommonUtils","getTargetView","FieldRuntime","uploadPromises","creatingInactiveRow","onDataFieldWithNavigationPath","async","source","controller","navPath","_routing","bindingContext","view","metaModel","getModel","getMetaModel","viewData","getViewData","draftRootPath","ModelHelper","getDraftRootPath","getPath","urlNavigation","getHashForNavigation","navigateFn","getAppComponent","getRouterProxy","navToHash","isStickySessionSupported","startsWith","sameOPNavigation","converterType","draft","processDataLossOrDraftDiscardConfirmation","Function","prototype","getController","NavigationType","ForwardNavigation","Log","error","isDraftIndicatorVisible","sPropertyPath","sSemanticKeyHasDraftIndicator","HasDraftEntity","IsActiveEntity","hideDraftInfo","undefined","onValidateFieldGroup","oEvent","oSourceField","getSource","oFEController","FieldRuntimeHelper","getExtensionController","_sideEffects","handleFieldGroupChange","handleChangeMultiValueField","oController","bIsTransient","isTransient","pValueResolved","getParameter","Promise","resolve","oSource","bValid","fieldValidity","getFieldStateOnChange","state","fieldAPI","getParent","customValueBinding","newValue","valueModel","model","setProperty","path","updateBindings","then","mParameters","valid","FieldAPI","handleChange","handleFieldChange","fetchRecommendations","catch","debug","valueResolvedAndPatchSent","setTimeout","editFlow","syncTask","prepareDeferredSideEffectsForField","bCollaborationEnabled","collaborativeDraft","isConnected","data","getBindingInfo","parts","filter","part","indexOf","map","retainAsyncMessages","updateCollaboration","hasPendingChanges","attachEventOnce","send","action","Activity","Change","content","releaseAsyncMessages","_sendCollaborationMessageForFileUploader","fileUploader","bindingPath","getProperty","fullPath","handleOpenUploader","event","Lock","handleCloseUploader","Unlock","_fnFixHashQueryString","sCurrentHash","includes","split","openExternalLink","openWindow","uploadStream","FEController","fileWrapper","uploadUrl","getUploadUrl","setUIBusy","setUploadUrl","setHeaderFields","uploadPromise","reject","this","getId","upload","MessageBox","getResourceModel","getText","handleUploadComplete","propertyFileName","propertyPath","status","Number","context","displayMessageForFailedUpload","newETag","etag","getValue","avatar","refreshAvatarCacheBusting","_callSideEffectsForStream","isCollaborationEnabled","notificationData","push","removeStream","deleteButton","oControl","getIconForMimeType","sMimeType","IconPool","retrieveTextFromValueList","sPropertyValue","sPropertyFullPath","sDisplayFormat","sTextProperty","oMetaModel","sPropertyName","CommonHelper","getObject","requestValueListInfo","mValueListInfo","oValueListInfo","Object","keys","oValueListModel","$model","oMetaModelValueList","oParamWithKey","Parameters","find","oParameter","LocalDataProperty","$PropertyPath","ValueListProperty","Error","oTextAnnotation","CollectionPath","$Path","oFilter","Filter","operator","value1","oListBinding","bindList","$select","requestContexts","aContexts","sDescription","Library","getResourceBundleFor","oError","errorObj","sMsg","message","handleTypeMissmatch","givenType","acceptedTypes","getMimeType","showTypeMismatchDialog","handleFileSizeExceed","showFileSizeExceedDialog","getMaximumFileSize","toFixed","showCollaborationEditUser","resourceModel","ResourceModelHelper","popover","Element","getElementById","ResponsivePopover","showHeader","placement","addStyleClass","addDependent","getBindings","activities","editingActivity","length","activity","key","getActivityKeyFromPath","destroyContent","addContent","Label","text","name","openBy","displayAggregateDetails","aggregatedPropertyPath","link","analyticalTable","FPMHelper","getMdcTable","rowContext","tableRowBinding","rowContextData","rowSpecificFilter","rowFilter","getFilter","allFilters","concat","getFilters","aggregation","getAggregation","unitOrCurrencyName","aggregate","unit","group","grandTotal","subtotals","tableItem","getDependents","clone","currencyOrQuantityEnabledLayout","HBox","renderType","justifyContent","items","aggregationParameters","search","oItemsBindingInfo","getResolvedPath","filters","parameters","$$aggregation","sorter","Sorter","isPopoverForGrandTotal","Util","createOrUpdateMultiUnitPopover","control","itemsBindingInfo","listItemContentTemplate","fnOnClose","removeDependent","detachEvent","destroy","attachEvent","ObjectPath","set"],"sources":["./FieldRuntime.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport ObjectPath from \"sap/base/util/ObjectPath\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type { UserActivity } from \"sap/fe/core/controllerextensions/collaboration/CollaborationCommon\";\nimport { Activity, getActivityKeyFromPath } from \"sap/fe/core/controllerextensions/collaboration/CollaborationCommon\";\nimport draft from \"sap/fe/core/controllerextensions/editFlow/draft\";\nimport FPMHelper from \"sap/fe/core/helpers/FPMHelper\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport ResourceModelHelper, { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport CommonHelper from \"sap/fe/macros/CommonHelper\";\nimport type FileWrapper from \"sap/fe/macros/controls/FileWrapper\";\nimport FieldAPI from \"sap/fe/macros/field/FieldAPI\";\nimport {\n\tdisplayMessageForFailedUpload,\n\tsetHeaderFields,\n\tshowFileSizeExceedDialog,\n\tshowTypeMismatchDialog\n} from \"sap/fe/macros/internal/helpers/Upload\";\nimport type Avatar from \"sap/m/Avatar\";\nimport type { CheckBox$SelectEvent } from \"sap/m/CheckBox\";\nimport type { $HBoxSettings } from \"sap/m/HBox\";\nimport HBox from \"sap/m/HBox\";\nimport type { InputBase$ChangeEvent } from \"sap/m/InputBase\";\nimport Label from \"sap/m/Label\";\nimport type Link from \"sap/m/Link\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport ResponsivePopover from \"sap/m/ResponsivePopover\";\nimport { default as Util } from \"sap/m/table/Util\";\nimport type Event from \"sap/ui/base/Event\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type Control from \"sap/ui/core/Control\";\nimport type { Control$ValidateFieldGroupEvent } from \"sap/ui/core/Control\";\nimport Element from \"sap/ui/core/Element\";\nimport IconPool from \"sap/ui/core/IconPool\";\nimport Library from \"sap/ui/core/Lib\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type { default as Field, Field$ChangeEvent } from \"sap/ui/mdc/Field\";\nimport type CompositeBinding from \"sap/ui/model/CompositeBinding\";\nimport Filter from \"sap/ui/model/Filter\";\nimport Sorter from \"sap/ui/model/Sorter\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type Context from \"sap/ui/model/odata/v4/Context\";\nimport type ODataContextBinding from \"sap/ui/model/odata/v4/ODataContextBinding\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type FileUploader from \"sap/ui/unified/FileUploader\";\nimport type {\n\tFileUploader$ChangeEvent,\n\tFileUploader$FileSizeExceedEvent,\n\tFileUploader$TypeMissmatchEvent,\n\tFileUploader$UploadCompleteEvent\n} from \"sap/ui/unified/FileUploader\";\nimport openWindow from \"sap/ui/util/openWindow\";\nimport FieldRuntimeHelper from \"./FieldRuntimeHelper\";\n\n/**\n * Gets the binding used for collaboration notifications.\n * @param field\n * @returns The binding\n */\nfunction getCollaborationBinding(field: Control): ODataListBinding | ODataContextBinding {\n\tlet binding = (field.getBindingContext() as Context).getBinding();\n\n\tif (!binding.isA(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\tconst oView = CommonUtils.getTargetView(field);\n\t\tbinding = oView.getBindingContext().getBinding();\n\t}\n\n\treturn binding;\n}\n/**\n * Static class used by \"sap.ui.mdc.Field\" during runtime\n * @private\n * @experimental This module is only for internal/experimental use!\n */\nconst FieldRuntime = {\n\tuploadPromises: {} as Record<string, { resolve: Function; reject: Function }>,\n\tcreatingInactiveRow: false,\n\n\t/**\n\t * Triggers an internal navigation on the link pertaining to DataFieldWithNavigationPath.\n\t * @param source Source of the press event\n\t * @param controller Instance of the controller\n\t * @param navPath The navigation path\n\t */\n\tonDataFieldWithNavigationPath: async function (source: Control, controller: PageController, navPath: string): Promise<void> {\n\t\tif (controller._routing) {\n\t\t\tconst bindingContext = source.getBindingContext() as Context;\n\n\t\t\tconst view = CommonUtils.getTargetView(source),\n\t\t\t\tmetaModel = bindingContext.getModel().getMetaModel();\n\t\t\tconst viewData = view.getViewData();\n\n\t\t\tconst draftRootPath = ModelHelper.getDraftRootPath(bindingContext) ?? bindingContext.getPath();\n\t\t\tlet urlNavigation = await controller._routing.getHashForNavigation(bindingContext, navPath);\n\t\t\tconst navigateFn = (): void => {\n\t\t\t\tcontroller\n\t\t\t\t\t.getAppComponent()\n\t\t\t\t\t.getRouterProxy()\n\t\t\t\t\t.navToHash(\n\t\t\t\t\t\turlNavigation,\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t!ModelHelper.isStickySessionSupported(bindingContext.getModel().getMetaModel())\n\t\t\t\t\t);\n\t\t\t};\n\n\t\t\t// To know if we're navigating on the same OP Entity\n\t\t\tif (!urlNavigation?.startsWith(\"/\")) {\n\t\t\t\turlNavigation = `/${urlNavigation}`;\n\t\t\t}\n\t\t\tconst sameOPNavigation = urlNavigation.startsWith(draftRootPath);\n\n\t\t\t// Show draft loss confirmation dialog in case of Object page\n\t\t\tif (viewData.converterType === \"ObjectPage\" && !ModelHelper.isStickySessionSupported(metaModel) && !sameOPNavigation) {\n\t\t\t\tdraft.processDataLossOrDraftDiscardConfirmation(\n\t\t\t\t\tnavigateFn,\n\t\t\t\t\tFunction.prototype,\n\t\t\t\t\tbindingContext,\n\t\t\t\t\tview.getController(),\n\t\t\t\t\ttrue,\n\t\t\t\t\tdraft.NavigationType.ForwardNavigation\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tnavigateFn();\n\t\t\t}\n\t\t} else {\n\t\t\tLog.error(\n\t\t\t\t\"FieldRuntime: No routing listener controller extension found. Internal navigation aborted.\",\n\t\t\t\t\"sap.fe.macros.field.FieldRuntime\",\n\t\t\t\t\"onDataFieldWithNavigationPath\"\n\t\t\t);\n\t\t}\n\t},\n\tisDraftIndicatorVisible: function (\n\t\tsPropertyPath: string,\n\t\tsSemanticKeyHasDraftIndicator: string,\n\t\tHasDraftEntity?: boolean,\n\t\tIsActiveEntity?: boolean,\n\t\thideDraftInfo?: boolean\n\t): boolean {\n\t\tif (IsActiveEntity !== undefined && HasDraftEntity !== undefined && (!IsActiveEntity || HasDraftEntity) && !hideDraftInfo) {\n\t\t\treturn sPropertyPath === sSemanticKeyHasDraftIndicator;\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * Handler for the validateFieldGroup event.\n\t * @param oEvent The event object passed by the validateFieldGroup event\n\t */\n\tonValidateFieldGroup: function (oEvent: Control$ValidateFieldGroupEvent): void {\n\t\tconst oSourceField = oEvent.getSource() as ManagedObject;\n\t\tconst view = CommonUtils.getTargetView(oSourceField),\n\t\t\tcontroller = view.getController();\n\n\t\tconst oFEController = FieldRuntimeHelper.getExtensionController(controller);\n\t\toFEController._sideEffects.handleFieldGroupChange(oEvent);\n\t},\n\n\t/**\n\t * Handler for the change event.\n\t * Store field group IDs of this field for requesting side effects when required.\n\t * We store them here to ensure there is a change in the value of the field.\n\t * @param oController The controller of the page containing the field\n\t * @param oEvent The event object passed by the change event\n\t */\n\t//This should be replaced by FieldAPI.handleChange. Currently it is still needed because a pending review of the change handler in MultiValueField\n\thandleChangeMultiValueField: function (oController: PageController, oEvent: Field$ChangeEvent & Event<{ isValid: boolean }>): void {\n\t\tconst oSourceField = oEvent.getSource() as Control,\n\t\t\tbIsTransient = oSourceField && (oSourceField.getBindingContext() as unknown as { isTransient: Function }).isTransient(),\n\t\t\tpValueResolved = oEvent.getParameter(\"promise\") || Promise.resolve(),\n\t\t\toSource = oEvent.getSource(),\n\t\t\tbValid = oEvent.getParameter(\"valid\"),\n\t\t\tfieldValidity = FieldRuntimeHelper.getFieldStateOnChange(oEvent).state[\"validity\"],\n\t\t\tfield = oEvent.getSource() as Control,\n\t\t\tfieldAPI = field.getParent()?.getParent() as FieldAPI | undefined,\n\t\t\tcustomValueBinding = fieldAPI?.customValueBinding;\n\n\t\tif (customValueBinding) {\n\t\t\tlet newValue;\n\t\t\tconst valueModel = field?.getModel(customValueBinding.model) as JSONModel | undefined;\n\t\t\tif (oSource.isA(\"sap.m.CheckBox\")) {\n\t\t\t\tnewValue = (oEvent as CheckBox$SelectEvent).getParameter(\"selected\");\n\t\t\t} else {\n\t\t\t\tnewValue = (oEvent as InputBase$ChangeEvent).getParameter(\"value\");\n\t\t\t}\n\t\t\tvalueModel?.setProperty(customValueBinding.path, newValue);\n\t\t\tvalueModel?.updateBindings(true);\n\t\t}\n\n\t\t// Use the FE Controller instead of the extensionAPI to access internal FE controllers\n\t\tconst oFEController = FieldRuntimeHelper.getExtensionController(oController);\n\n\t\t// TODO: currently we have undefined and true... and our creation row implementation relies on this.\n\t\t// I would move this logic to this place as it's hard to understand for field consumer\n\t\tpValueResolved\n\t\t\t.then(function () {\n\t\t\t\t// The event is gone. For now we'll just recreate it again\n\t\t\t\t(oEvent as { oSource?: Field }).oSource = oSource;\n\t\t\t\t(oEvent as { mParameters?: { valid?: boolean } }).mParameters = {\n\t\t\t\t\tvalid: bValid\n\t\t\t\t};\n\t\t\t\t(FieldAPI as unknown as { handleChange: Function }).handleChange(oEvent, oController);\n\t\t\t\tif (!bIsTransient) {\n\t\t\t\t\t// trigger side effects without registering deferred side effects\n\t\t\t\t\t// deferred side effects are already registered by prepareDeferredSideEffectsForField before pValueResolved is resolved.\n\t\t\t\t\toFEController._sideEffects.handleFieldChange(oEvent, !!fieldValidity, pValueResolved, true);\n\t\t\t\t}\n\t\t\t\t// Recommendations\n\t\t\t\tFieldRuntimeHelper.fetchRecommendations(field as Field, oController);\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch(function (/*oError: any*/) {\n\t\t\t\t// The event is gone. For now we'll just recreate it again\n\t\t\t\t(oEvent as { oSource?: Field }).oSource = oSource;\n\t\t\t\t(oEvent as { mParameters?: { valid?: boolean } }).mParameters = {\n\t\t\t\t\tvalid: false\n\t\t\t\t};\n\t\t\t\tLog.debug(\"Prerequisites on Field for the SideEffects and Recommendations have been rejected\");\n\t\t\t\t// as the UI might need to react on. We could provide a parameter to inform if validation\n\t\t\t\t// was successful?\n\t\t\t\t(FieldAPI as unknown as { handleChange: Function }).handleChange(oEvent, oController);\n\t\t\t});\n\n\t\t// For the EditFlow synchronization, we need to wait for the corresponding PATCH request to be sent, otherwise there could be e.g. action invoked in parallel with the PATCH request.\n\t\t// This is done with a 0-timeout, to allow for the 'patchSent' event to be sent by the binding (then the internal edit flow synchronization kicks in with EditFlow.handlePatchSent).\n\t\tconst valueResolvedAndPatchSent = pValueResolved.then(async () => {\n\t\t\treturn new Promise<void>((resolve) => {\n\t\t\t\tsetTimeout(resolve, 0);\n\t\t\t});\n\t\t});\n\t\toFEController.editFlow.syncTask(valueResolvedAndPatchSent);\n\n\t\t// if the context is transient, it means the request would fail anyway as the record does not exist in reality\n\t\t// TODO: should the request be made in future if the context is transient?\n\t\tif (bIsTransient) {\n\t\t\treturn;\n\t\t}\n\n\t\toFEController._sideEffects.prepareDeferredSideEffectsForField(oEvent, !!fieldValidity, pValueResolved);\n\t\t// Collaboration Draft Activity Sync\n\t\tconst bCollaborationEnabled = oController.collaborativeDraft.isConnected();\n\n\t\tif (bCollaborationEnabled && fieldValidity) {\n\t\t\tconst binding = getCollaborationBinding(field);\n\n\t\t\tconst data = [\n\t\t\t\t...((field.getBindingInfo(\"value\") || field.getBindingInfo(\"selected\"))?.parts || []),\n\t\t\t\t...(field.getBindingInfo(\"additionalValue\")?.parts || [])\n\t\t\t]\n\t\t\t\t.filter((part) => {\n\t\t\t\t\treturn part?.path !== undefined && part.path.indexOf(\"@@\") < 0; // Remove binding parts with @@ that make no sense for collaboration messages\n\t\t\t\t})\n\t\t\t\t.map(function (part: { path: string }) {\n\t\t\t\t\treturn `${field.getBindingContext()?.getPath()}/${part.path}`;\n\t\t\t\t});\n\n\t\t\t// From this point, we will always send a collaboration message (UNLOCK or CHANGE), so we retain\n\t\t\t// a potential UNLOCK that would be sent in handleFocusOut, to make sure it's sent after the CHANGE message\n\t\t\toController.collaborativeDraft.retainAsyncMessages(data);\n\n\t\t\tconst updateCollaboration = (): void => {\n\t\t\t\tif (binding.hasPendingChanges()) {\n\t\t\t\t\t// The value has been changed by the user --> wait until it's sent to the server before sending a notification to other users\n\t\t\t\t\tbinding.attachEventOnce(\"patchCompleted\", function () {\n\t\t\t\t\t\toController.collaborativeDraft.send({ action: Activity.Change, content: data });\n\t\t\t\t\t\toController.collaborativeDraft.releaseAsyncMessages(data);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toController.collaborativeDraft.releaseAsyncMessages(data);\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (oSourceField.isA(\"sap.ui.mdc.Field\") || (oSourceField as Control).isA(\"sap.ui.mdc.MultiValueField\")) {\n\t\t\t\tpValueResolved\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tupdateCollaboration();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\tupdateCollaboration();\n\t\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tupdateCollaboration();\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Method to send collaboration messages from a FileUploader.\n\t * @param fileUploader\n\t * @param action\n\t */\n\t_sendCollaborationMessageForFileUploader(fileUploader: FileUploader, action: Activity): void {\n\t\tconst view = CommonUtils.getTargetView(fileUploader);\n\t\tconst collaborativeDraft = view.getController().collaborativeDraft;\n\t\tif (collaborativeDraft.isConnected()) {\n\t\t\tconst bindingPath = fileUploader.getParent()?.getProperty(\"propertyPath\");\n\t\t\tconst fullPath = `${fileUploader.getBindingContext()?.getPath()}/${bindingPath}`;\n\t\t\tcollaborativeDraft.send({ action, content: fullPath });\n\t\t}\n\t},\n\n\t/**\n\t * Handler when a FileUpload dialog is opened.\n\t * @param event\n\t */\n\thandleOpenUploader: function (event: Event<{}, FileUploader>): void {\n\t\tconst fileUploader = event.getSource();\n\t\tFieldRuntime._sendCollaborationMessageForFileUploader(fileUploader, Activity.Lock);\n\t},\n\n\t/**\n\t * Handler when a FileUpload dialog is closed.\n\t * @param event\n\t */\n\thandleCloseUploader: function (event: Event<{}, FileUploader>): void {\n\t\tconst fileUploader = event.getSource();\n\t\tFieldRuntime._sendCollaborationMessageForFileUploader(fileUploader, Activity.Unlock);\n\t},\n\n\t_fnFixHashQueryString: function (sCurrentHash: string): string {\n\t\tif (sCurrentHash?.includes(\"?\")) {\n\t\t\t// sCurrentHash can contain query string, cut it off!\n\t\t\tsCurrentHash = sCurrentHash.split(\"?\")[0];\n\t\t}\n\t\treturn sCurrentHash;\n\t},\n\topenExternalLink: function (event: Event<{}, Link>): void {\n\t\tconst source = event.getSource();\n\t\tif (source.data(\"url\") && source.getProperty(\"text\") !== \"\") {\n\t\t\t// This opens the link in the same tab as the link. It was done to be more consistent with other type of links.\n\t\t\topenWindow(source.data(\"url\"), \"_self\");\n\t\t}\n\t},\n\n\tuploadStream: function (controller: PageController, event: FileUploader$ChangeEvent): void {\n\t\tconst fileUploader = event.getSource(),\n\t\t\tFEController = FieldRuntimeHelper.getExtensionController(controller),\n\t\t\tfileWrapper = fileUploader.getParent() as unknown as FileWrapper,\n\t\t\tuploadUrl = fileWrapper.getUploadUrl();\n\n\t\tif (uploadUrl !== \"\") {\n\t\t\tfileWrapper.setUIBusy(true);\n\n\t\t\t// use uploadUrl from FileWrapper which returns a canonical URL\n\t\t\tfileUploader.setUploadUrl(uploadUrl);\n\n\t\t\tsetHeaderFields(fileUploader);\n\n\t\t\t// synchronize upload with other requests\n\t\t\tconst uploadPromise = new Promise((resolve: Function, reject: Function) => {\n\t\t\t\tthis.uploadPromises = this.uploadPromises || {};\n\t\t\t\tthis.uploadPromises[fileUploader.getId()] = {\n\t\t\t\t\tresolve: resolve,\n\t\t\t\t\treject: reject\n\t\t\t\t};\n\t\t\t\tfileUploader.upload();\n\t\t\t});\n\t\t\tFEController.editFlow.syncTask(uploadPromise);\n\t\t} else {\n\t\t\tMessageBox.error(getResourceModel(controller).getText(\"M_FIELD_FILEUPLOADER_ABORTED_TEXT\"));\n\t\t}\n\t},\n\n\thandleUploadComplete: function (\n\t\tevent: FileUploader$UploadCompleteEvent,\n\t\tpropertyFileName: { path: string } | undefined,\n\t\tpropertyPath: string,\n\t\tcontroller: PageController\n\t): void {\n\t\tconst status = Number(event.getParameter(\"status\")),\n\t\t\tfileUploader = event.getSource(),\n\t\t\tfileWrapper = fileUploader.getParent() as unknown as FileWrapper;\n\n\t\tfileWrapper.setUIBusy(false);\n\n\t\tconst context = fileUploader.getBindingContext() as Context | undefined | null;\n\t\tif (status === 0 || status >= 400) {\n\t\t\tconst error = (event.getParameter(\"responseRaw\") || event.getParameter(\"response\")) as string;\n\t\t\tdisplayMessageForFailedUpload(fileUploader, error);\n\t\t\tthis.uploadPromises[fileUploader.getId()].reject();\n\t\t} else {\n\t\t\tconst newETag = (event.getParameter(\"headers\") as Record<string, unknown>)?.etag;\n\n\t\t\tif (newETag) {\n\t\t\t\t// set new etag for filename update, but without sending patch request\n\t\t\t\tcontext?.setProperty(\"@odata.etag\", newETag, null as unknown as string);\n\t\t\t}\n\n\t\t\t// set filename for link text\n\t\t\tif (propertyFileName?.path) {\n\t\t\t\tcontext?.setProperty(propertyFileName.path, fileUploader.getValue());\n\t\t\t}\n\n\t\t\t// delete the avatar cache that not gets updated otherwise\n\t\t\tfileWrapper.avatar?.refreshAvatarCacheBusting();\n\n\t\t\tthis._callSideEffectsForStream(event as unknown as Field$ChangeEvent & Event<{ isValid: boolean }>, fileWrapper, controller);\n\n\t\t\tthis.uploadPromises[fileUploader.getId()].resolve();\n\t\t}\n\n\t\tdelete this.uploadPromises[fileUploader.getId()];\n\n\t\t// Collaboration Draft Activity Sync\n\t\tconst isCollaborationEnabled = controller.collaborativeDraft.isConnected();\n\t\tif (!isCollaborationEnabled || !context) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst notificationData = [`${context.getPath()}/${propertyPath}`];\n\t\tif (propertyFileName?.path) {\n\t\t\tnotificationData.push(`${context.getPath()}/${propertyFileName.path}`);\n\t\t}\n\n\t\tlet binding = context.getBinding();\n\t\tif (!binding.isA(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\tconst oView = CommonUtils.getTargetView(fileUploader);\n\t\t\tbinding = oView.getBindingContext().getBinding();\n\t\t}\n\t\tif (binding.hasPendingChanges()) {\n\t\t\tbinding.attachEventOnce(\"patchCompleted\", () => {\n\t\t\t\tcontroller.collaborativeDraft.send({ action: Activity.Change, content: notificationData });\n\t\t\t\tcontroller.collaborativeDraft.send({ action: Activity.Unlock, content: notificationData });\n\t\t\t});\n\t\t} else {\n\t\t\tcontroller.collaborativeDraft.send({ action: Activity.Change, content: notificationData });\n\t\t\tcontroller.collaborativeDraft.send({ action: Activity.Unlock, content: notificationData });\n\t\t}\n\t},\n\n\tremoveStream: function (\n\t\tevent: Field$ChangeEvent & Event<{ isValid: boolean }>,\n\t\tpropertyFileName: { path: string } | undefined,\n\t\tpropertyPath: string,\n\t\tcontroller: PageController\n\t): void {\n\t\tconst deleteButton = event.getSource();\n\t\tconst fileWrapper = deleteButton.getParent() as unknown as FileWrapper;\n\t\tconst context = fileWrapper.getBindingContext() as Context;\n\n\t\t// streams are removed by assigning the null value\n\t\tcontext.setProperty(propertyPath, null);\n\t\t// When setting the property to null, the uploadUrl (@@MODEL.format) is set to \"\" by the model\n\t\t//\twith that another upload is not possible before refreshing the page\n\t\t// (refreshing the page would recreate the URL)\n\t\t//\tThis is the workaround:\n\t\t//\tWe set the property to undefined only on the frontend which will recreate the uploadUrl\n\t\tcontext.setProperty(propertyPath, undefined, null as unknown as string);\n\n\t\tthis._callSideEffectsForStream(event, fileWrapper, controller);\n\n\t\t// Collaboration Draft Activity Sync\n\t\tconst bCollaborationEnabled = controller.collaborativeDraft.isConnected();\n\t\tif (bCollaborationEnabled) {\n\t\t\tlet binding = context.getBinding();\n\t\t\tif (!binding.isA(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\t\tconst oView = CommonUtils.getTargetView(deleteButton);\n\t\t\t\tbinding = oView.getBindingContext().getBinding();\n\t\t\t}\n\n\t\t\tconst data = [`${context.getPath()}/${propertyPath}`];\n\t\t\tif (propertyFileName?.path) {\n\t\t\t\tdata.push(`${context.getPath()}/${propertyFileName.path}`);\n\t\t\t}\n\t\t\tcontroller.collaborativeDraft.send({ action: Activity.Lock, content: data });\n\n\t\t\tbinding.attachEventOnce(\"patchCompleted\", function () {\n\t\t\t\tcontroller.collaborativeDraft.send({ action: Activity.Change, content: data });\n\t\t\t\tcontroller.collaborativeDraft.send({ action: Activity.Unlock, content: data });\n\t\t\t});\n\t\t}\n\t},\n\n\t_callSideEffectsForStream: function (\n\t\toEvent: Field$ChangeEvent & Event<{ isValid: boolean }>,\n\t\toControl: Control,\n\t\toController: PageController\n\t): void {\n\t\tconst oFEController = FieldRuntimeHelper.getExtensionController(oController);\n\t\tif (oControl && (oControl.getBindingContext() as unknown as { isTransient: Function }).isTransient()) {\n\t\t\treturn;\n\t\t}\n\t\tif (oControl) {\n\t\t\t(oEvent as unknown as { oSource: Control }).oSource = oControl;\n\t\t}\n\t\toFEController._sideEffects.handleFieldChange(oEvent, FieldRuntimeHelper.getFieldStateOnChange(oEvent).state[\"validity\"]);\n\t},\n\n\tgetIconForMimeType: function (sMimeType: string): string {\n\t\treturn IconPool.getIconForMimeType(sMimeType);\n\t},\n\n\t/**\n\t * Method to retrieve text from value list for DataField.\n\t * @param sPropertyValue The property value of the datafield\n\t * @param sPropertyFullPath The property full path's\n\t * @param sDisplayFormat The display format for the datafield\n\t * @returns The formatted value in corresponding display format.\n\t */\n\tretrieveTextFromValueList: async function (sPropertyValue: string, sPropertyFullPath: string, sDisplayFormat: string): Promise<string> {\n\t\tlet sTextProperty: string;\n\t\tlet oMetaModel;\n\t\tlet sPropertyName: string;\n\t\tif (sPropertyValue) {\n\t\t\toMetaModel = CommonHelper.getMetaModel();\n\t\t\tsPropertyName = oMetaModel.getObject(`${sPropertyFullPath}@sapui.name`);\n\t\t\treturn oMetaModel\n\t\t\t\t.requestValueListInfo(sPropertyFullPath, true)\n\t\t\t\t.then(function (mValueListInfo) {\n\t\t\t\t\t// take the \"\" one if exists, otherwise take the first one in the object TODO: to be discussed\n\t\t\t\t\tconst oValueListInfo = mValueListInfo[mValueListInfo[\"\"] ? \"\" : Object.keys(mValueListInfo)[0]];\n\t\t\t\t\tconst oValueListModel = oValueListInfo.$model;\n\t\t\t\t\tconst oMetaModelValueList = oValueListModel.getMetaModel();\n\t\t\t\t\tconst oParamWithKey = oValueListInfo.Parameters.find(function (oParameter: {\n\t\t\t\t\t\tLocalDataProperty?: { $PropertyPath: string };\n\t\t\t\t\t}) {\n\t\t\t\t\t\treturn oParameter.LocalDataProperty && oParameter.LocalDataProperty.$PropertyPath === sPropertyName;\n\t\t\t\t\t});\n\t\t\t\t\tif (oParamWithKey && !oParamWithKey.ValueListProperty) {\n\t\t\t\t\t\tthrow new Error(`Inconsistent value help annotation for ${sPropertyName}`);\n\t\t\t\t\t}\n\t\t\t\t\tconst oTextAnnotation = oMetaModelValueList.getObject(\n\t\t\t\t\t\t`/${oValueListInfo.CollectionPath}/${oParamWithKey.ValueListProperty}@com.sap.vocabularies.Common.v1.Text`\n\t\t\t\t\t);\n\n\t\t\t\t\tif (oTextAnnotation && oTextAnnotation.$Path) {\n\t\t\t\t\t\tsTextProperty = oTextAnnotation.$Path;\n\t\t\t\t\t\tconst oFilter = new Filter({\n\t\t\t\t\t\t\tpath: oParamWithKey.ValueListProperty,\n\t\t\t\t\t\t\toperator: \"EQ\",\n\t\t\t\t\t\t\tvalue1: sPropertyValue\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst oListBinding = oValueListModel.bindList(`/${oValueListInfo.CollectionPath}`, undefined, undefined, oFilter, {\n\t\t\t\t\t\t\t$select: sTextProperty\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn oListBinding.requestContexts(0, 2);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsDisplayFormat = \"Value\";\n\t\t\t\t\t\treturn sPropertyValue;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(function (aContexts: Context[]) {\n\t\t\t\t\tconst sDescription = sTextProperty ? aContexts[0]?.getObject()[sTextProperty] : \"\";\n\t\t\t\t\tswitch (sDisplayFormat) {\n\t\t\t\t\t\tcase \"Description\":\n\t\t\t\t\t\t\treturn sDescription;\n\t\t\t\t\t\tcase \"DescriptionValue\":\n\t\t\t\t\t\t\treturn Library.getResourceBundleFor(\"sap.fe.core\")!.getText(\"C_FORMAT_FOR_TEXT_ARRANGEMENT\", [\n\t\t\t\t\t\t\t\tsDescription,\n\t\t\t\t\t\t\t\tsPropertyValue\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\tcase \"ValueDescription\":\n\t\t\t\t\t\t\treturn Library.getResourceBundleFor(\"sap.fe.core\")!.getText(\"C_FORMAT_FOR_TEXT_ARRANGEMENT\", [\n\t\t\t\t\t\t\t\tsPropertyValue,\n\t\t\t\t\t\t\t\tsDescription\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn sPropertyValue;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch(function (oError: unknown) {\n\t\t\t\t\tconst errorObj = oError as { status: number; message: string };\n\t\t\t\t\tconst sMsg =\n\t\t\t\t\t\terrorObj.status && errorObj.status === 404\n\t\t\t\t\t\t\t? `Metadata not found (${errorObj.status}) for value help of property ${sPropertyFullPath}`\n\t\t\t\t\t\t\t: errorObj.message;\n\t\t\t\t\tLog.error(sMsg);\n\t\t\t\t});\n\t\t}\n\t\treturn sPropertyValue;\n\t},\n\n\thandleTypeMissmatch: function (event: FileUploader$TypeMissmatchEvent): void {\n\t\tconst fileUploader = event.getSource();\n\t\tconst givenType = event.getParameter(\"mimeType\");\n\t\tconst acceptedTypes = fileUploader.getMimeType();\n\t\tif (givenType) {\n\t\t\tshowTypeMismatchDialog(fileUploader, givenType, acceptedTypes);\n\t\t}\n\t},\n\n\thandleFileSizeExceed: function (event: FileUploader$FileSizeExceedEvent): void {\n\t\tconst fileUploader = event.getSource();\n\t\tshowFileSizeExceedDialog(fileUploader, fileUploader.getMaximumFileSize().toFixed(3));\n\t},\n\n\t/**\n\t * Event handler to create and show who is editing the field popover.\n\t * @param source The avatar which is next to the field locked\n\t * @param view Current view\n\t */\n\tshowCollaborationEditUser: function (source: Avatar, view: View): void {\n\t\tconst resourceModel = ResourceModelHelper.getResourceModel(view);\n\t\tlet popover = Element.getElementById(`manageCollaborationDraft--editUser`) as ResponsivePopover;\n\n\t\tif (!popover) {\n\t\t\tpopover = new ResponsivePopover(\"manageCollaborationDraft--editUser\", {\n\t\t\t\tshowHeader: false,\n\t\t\t\tplacement: \"Bottom\"\n\t\t\t});\n\t\t\tpopover.addStyleClass(\"sapUiContentPadding\");\n\t\t\tview.addDependent(popover);\n\t\t}\n\n\t\tconst bindingPath = (source.getBinding(\"initials\") as CompositeBinding | undefined)\n\t\t\t?.getBindings()\n\t\t\t.find((binding) => binding?.getPath()?.startsWith(\"/collaboration/activities\"))\n\t\t\t.getPath();\n\t\tconst activities = source.getBindingContext(\"internal\")?.getObject(bindingPath);\n\n\t\tlet editingActivity: UserActivity | undefined;\n\t\tif (activities && activities.length > 0) {\n\t\t\teditingActivity = activities.find((activity: UserActivity) => {\n\t\t\t\treturn activity.key === getActivityKeyFromPath(source.getBindingContext()!.getPath());\n\t\t\t});\n\t\t}\n\t\tpopover.destroyContent();\n\t\tpopover.addContent(\n\t\t\tnew Label({\n\t\t\t\ttext: resourceModel.getText(\"C_COLLABORATIONAVATAR_USER_EDIT_FIELD\", [`${editingActivity?.name}`])\n\t\t\t})\n\t\t);\n\t\tpopover.openBy(source);\n\t},\n\n\tdisplayAggregateDetails: async function (event: Event, aggregatedPropertyPath: string): Promise<void> {\n\t\tconst link = event.getSource<Link>();\n\t\tconst analyticalTable = FPMHelper.getMdcTable(link)!;\n\n\t\tconst rowContext = link.getBindingContext() as Context;\n\t\tconst tableRowBinding = rowContext.getBinding() as ODataListBinding;\n\n\t\t// Get the filters corresponding to the total row\n\t\tconst rowContextData = rowContext.getObject();\n\t\tconst rowSpecificFilter: Filter[] = [];\n\t\tconst rowFilter = rowContext.getFilter();\n\t\tif (rowFilter) {\n\t\t\trowSpecificFilter.push(rowFilter);\n\t\t}\n\n\t\t// Add the filters applied to the original table\n\t\tconst allFilters = rowSpecificFilter.concat(tableRowBinding.getFilters(\"Application\"), tableRowBinding.getFilters(\"Control\"));\n\n\t\t// Calculate $$aggregation parameters for the table in the popover (aggregate amount, group by currency/unit)\n\t\tconst aggregation = tableRowBinding.getAggregation() as {\n\t\t\tgroup: Record<string, object>;\n\t\t\taggregate: Record<string, { unit: string }>;\n\t\t\tsearch?: string;\n\t\t};\n\t\tconst unitOrCurrencyName = aggregation.aggregate[aggregatedPropertyPath].unit;\n\t\tconst group: Record<string, object> = {};\n\t\tgroup[unitOrCurrencyName] = {};\n\t\tconst aggregate: Record<string, object> = {};\n\t\taggregate[aggregatedPropertyPath] = { grandTotal: false, subtotals: false, unit: unitOrCurrencyName };\n\n\t\t// The item displayed in the table in the popover is a copy of the item displayed in the table\n\t\tconst tableItem = link.getDependents()[0].clone();\n\t\tconst currencyOrQuantityEnabledLayout = new HBox({\n\t\t\trenderType: \"Bare\",\n\t\t\tjustifyContent: \"End\",\n\t\t\titems: [tableItem]\n\t\t} as $HBoxSettings);\n\n\t\tconst aggregationParameters: {\n\t\t\tgroup: Record<string, object>;\n\t\t\taggregate: Record<string, object>;\n\t\t\tsearch?: string;\n\t\t} = { group, aggregate };\n\t\tif (aggregation.search) {\n\t\t\taggregationParameters.search = aggregation.search;\n\t\t}\n\n\t\tconst oItemsBindingInfo = {\n\t\t\tpath: tableRowBinding.getResolvedPath(),\n\t\t\tfilters: allFilters,\n\t\t\tparameters: {\n\t\t\t\t$$aggregation: aggregationParameters\n\t\t\t},\n\t\t\tsorter: new Sorter(unitOrCurrencyName, false) // Order by currency\n\t\t};\n\n\t\tconst isPopoverForGrandTotal = rowContextData[\"@$ui5.node.level\"] === 0;\n\t\tconst popover: ResponsivePopover = await Util.createOrUpdateMultiUnitPopover(`${analyticalTable.getId()}-multiUnitPopover`, {\n\t\t\tcontrol: analyticalTable,\n\t\t\tgrandTotal: isPopoverForGrandTotal,\n\t\t\titemsBindingInfo: oItemsBindingInfo,\n\t\t\tlistItemContentTemplate: currencyOrQuantityEnabledLayout\n\t\t});\n\t\tanalyticalTable.addDependent(popover);\n\n\t\tconst fnOnClose = (): void => {\n\t\t\tanalyticalTable.removeDependent(popover);\n\t\t\tpopover.detachEvent(\"afterClose\", fnOnClose);\n\t\t\tpopover.destroy();\n\t\t};\n\t\tpopover.attachEvent(\"afterClose\", fnOnClose);\n\t\tpopover.openBy(link);\n\t}\n};\n\nObjectPath.set(\"sap.fe.macros.field.FieldRuntime\", FieldRuntime);\n\nexport default FieldRuntime;\n"],"mappings":"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","ignoreList":[]}