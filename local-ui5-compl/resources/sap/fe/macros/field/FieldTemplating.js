/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/annotations/DataField","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/CommonFormatters","sap/fe/core/templating/DataFieldFormatters","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyHelper","sap/fe/core/templating/SemanticObjectHelper","sap/fe/core/templating/UIFormatters","sap/m/AvatarShape","sap/ui/model/json/JSONModel","./FieldHelper"],function(t,e,a,n,i,o,r,s,l,c,u,m,f){"use strict";var p={};var g=s.hasStaticPercentUnit;var d=r.getRelativePaths;var v=r.getContextRelativeTargetObjectPath;var y=r.getContextPropertyRestriction;var I=r.enhanceDataModelPath;var b=o.generateVisibleExpression;var h=n.isProperty;var O=n.isPathAnnotationExpression;var T=n.isNavigationProperty;var D=n.isAnnotationOfType;var U=n.isAnnotationOfTerm;var F=e.isDataFieldForAnnotation;var P=t.transformRecursively;var x=t.pathInModel;var j=t.or;var E=t.isPathInModelExpression;var M=t.isComplexTypeExpression;var S=t.ifElse;var V=t.getExpressionFromAnnotation;var k=t.formatWithTypeInformation;var C=t.formatResult;var $=t.constant;var A=t.compileExpression;const B=function(t,e){return P(t,"PathInModel",t=>{let a=t;if(t.modelName===undefined){const n=I(e,t.path);a=i.getBindingWithTextArrangement(n,t)}return a})};p.addTextArrangementToBindingExpression=B;const N=function(t,e){return P(t,"PathInModel",t=>{let a=t;if(t.modelName===undefined){const n=I(e,t.path);if(n.targetObject){a=k(n.targetObject,t)}}return a})};p.formatValueRecursively=N;const W=function(t,e){return R(t,e,true)};p.getTextBindingExpression=W;const R=function(t,e){let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let n=arguments.length>3?arguments[3]:undefined;if(D(t.targetObject,["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataPointType","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldWithAction"])){const e=V(t.targetObject.Value)??"";return A(e)}if(O(t.targetObject)&&t.targetObject.$target){t=I(t,t.targetObject.path)}if(typeof t.targetObject==="string"){return t.targetObject}const o=x(v(t));let r;const s=t;const l=s.targetObject;if(l?.annotations?.UI?.InputMask){r=k(l,o);r.type="sap.fe.core.type.InputMask";r.formatOptions={mask:l.annotations?.UI?.InputMask?.Mask.toString(),placeholderSymbol:l.annotations?.UI?.InputMask?.PlaceholderSymbol.toString(),maskRule:et(l.annotations?.UI?.InputMask?.Rules)}}else if(l?.annotations?.Measures?.Unit||l?.annotations?.Measures?.ISOCurrency){r=c.getBindingWithUnitOrCurrency(s,o);if(e?.measureDisplayMode==="Hidden"&&M(r)){r.formatOptions={...r.formatOptions,showMeasure:false}}}else if(l?.annotations?.Common?.Timezone&&l.type=="Edm.DateTimeOffset"){r=c.getBindingWithTimezone(s,o,false,true,e)}else if(l?.annotations?.Common?.IsTimezone){r=c.getBindingForTimezone(s,o)}else if(l?.annotations?.UI?.DateTimeStyle||e?.dateTimePattern||e?.dateTimeStyle){r=c.getBindingForDateFormat(s,o,e)}else{r=i.getBindingWithTextArrangement(s,o,e,n)}if(a){return r}return A(r)};p.getTextBinding=R;const w=function(t,e){let a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let i=arguments.length>4?arguments[4]:undefined;let o=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;let r=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(O(t.targetObject)&&t.targetObject.$target){const e=t.targetEntityType.resolvePath(t.targetObject.path,true);t.targetObject=e.target;e.visitedObjects.forEach(e=>{if(T(e)){t.navigationProperties.push(e)}})}const s=t.targetObject;if(h(s)){let l=x(v(t));if(E(l)){if(s.annotations?.Communication?.IsEmailAddress){l=k(s,l);l.type="sap.fe.core.type.Email"}else if(s.annotations?.UI?.InputMask){l=k(s,l);l.type="sap.fe.core.type.InputMask";l.formatOptions={...l.formatOptions,mask:s.annotations.UI.InputMask.Mask,placeholderSymbol:s.annotations.UI.InputMask.PlaceholderSymbol,maskRule:et(s.annotations.UI.InputMask.Rules)}}else if(!a&&(s.annotations?.Measures?.ISOCurrency||s.annotations?.Measures?.Unit)){l=c.getBindingWithUnitOrCurrency(t,l,true,r?undefined:{showMeasure:false})}else if(s?.annotations?.Common?.IsTimezone){l=c.getBindingForTimezone(t,l)}else if(s?.annotations?.UI?.DateTimeStyle||e?.dateTimePattern||e?.dateTimeStyle){l=c.getBindingForDateFormat(t,l,e)}else if(s?.annotations?.Common?.Timezone&&s.type==="Edm.DateTimeOffset"){l=c.getBindingWithTimezone(t,l,true)}else{l=k(s,l);if(s.annotations.Common?.ExternalID){l.path+="@$ui5.fe.@Common/ExternalID"}}if(E(l)){if(n){delete l.formatOptions;delete l.constraints;delete l.type}if(i){l.parameters=i}if(o){l.targetType="any"}}return A(l)}else{return""}}else if(s?.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||s?.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath"){return A(V(s.Value))}else{return""}};p.getValueBinding=w;const H=function(t,e){const a=s.getAssociatedTextPropertyPath(t.targetObject);if(a){const n=I(t,a);let i=false;const o=t.targetObject?.annotations?.Common?.ValueList?.Parameters.map(t=>{if(!t){return""}return t?.LocalDataProperty?.$target?.fullyQualifiedName??""})||[];if(n?.targetObject?.fullyQualifiedName&&o.includes(n.targetObject.fullyQualifiedName)){i=true}const r=i?undefined:{$$noPatch:true};return w(n,e,true,false,r)}return undefined};p.getAssociatedTextBinding=H;const z=function(t,e){const a=t?.targetEntityType?.navigationProperties||[];const n=t?.targetEntityType?.annotations?.Common?.SemanticKey||[];let i=false;a.forEach(t=>{if(t.referentialConstraint&&t.referentialConstraint.length){t.referentialConstraint.forEach(a=>{if(a?.sourceProperty===e.name){if(t?.targetType?.annotations?.UI?.QuickViewFacets){i=true}}})}});if(t.contextLocation?.targetEntitySet!==t.targetEntitySet){const a=n.some(function(t){return t?.$target?.name===e.name});if((a||e.isKey)&&t?.targetEntityType?.annotations?.UI?.QuickViewFacets){i=true}}return i};p.isUsedInNavigationWithQuickViewFacets=z;const Q=function(t,e){const a=O(t)&&t.$target||t;if(!a.annotations?.Common?.Text&&!a.annotations?.Measures&&s.hasValueHelp(a)&&e.textAlignMode==="Form"){return true}return false};p.isRetrieveTextFromValueListEnabled=Q;const L=function(t,e,a){let n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;let i=t.targetObject?.Value?.$target.type||t.targetObject?.Target?.$target?.Value.$target.type;if(s.isKey(t.targetObject?.Value?.$target||t.targetObject?.Target?.$target?.Value?.$target)){return"Begin"}if(n&&e.displayMode&&["Description","DescriptionValue","ValueDescription"].includes(e.displayMode)){const e=t.targetObject?.Value?.$target.annotations?.Common?.Text;const a=e?.annotations?.UI?.TextArrangement.valueOf();if(e&&a!=="UI.TextArrangementType/TextSeparate"){i=e.$target.type}}return f.getPropertyAlignment(i,e,a)};p.getTextAlignment=L;const G=function(t,e){return A(b(t,e))};p.getVisibleExpression=G;const K=function(t){const e=t.targetObject;const a=A(b(t));const n=[];if(typeof a==="string"&&a.includes("{=")){return a}if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$target?.$Type==="com.sap.vocabularies.UI.v1.ConnectedFieldsType"){const i=Object.values(e.Target.$target.Data).filter(t=>t?.hasOwnProperty("Value"));i.forEach(e=>{t.targetObject=e;const a=b(t);if(a!==undefined){n.push(a)}});return n.length?A(j(...n)):a}return a};p.visibleExpressionsForConnectedFieldsFormElement=K;const q=function(t){if(!t.targetObject){return""}if(typeof t.targetObject==="string"){return t.targetObject}return R(t,{})};p.getQuickViewBinding=q;const J=function(t){const e=t.targetObject;if(D(e,"com.sap.vocabularies.UI.v1.DataFieldWithUrl")&&e?.Url){return"link"}if(!h(e)&&e?.Value.$target?.annotations?.Communication?.IsEmailAddress||h(e)&&e?.annotations?.Communication?.IsEmailAddress){return"email"}if(!h(e)&&e?.Value.$target?.annotations?.Communication?.IsPhoneNumber||h(e)&&e?.annotations?.Communication?.IsPhoneNumber){return"phone"}return"text"};p.getQuickViewType=J;const Z=function(t){if(t.length>0){let e="";let a="";const n=[];for(const i of t){e=i.key;a=A(V(i.value));n.push({key:e,value:a})}const i=new m(n);i.$$valueAsPromise=true;return i.createBindingContext("/")}else{return new m([]).createBindingContext("/")}};p.getSemanticObjects=Z;const X=function(t,e){if(t.wrap===false){return false}return e};p.getMultipleLinesForDataField=X;const Y=function(t,e){const a=s.getAssociatedUnitProperty(t);const n=s.getAssociatedCurrencyProperty(t);return s.hasValueHelp(t)&&t.type!=="Edm.Boolean"||e!=="Hidden"&&(a&&s.hasValueHelp(a)||n&&s.hasValueHelp(n))};const _=function(e,n,i){const o=e?.Validation?.[n]?.$Date;const r=e?.Validation?.[n];if(o){return C([$(o)],a.provideDateInstance)}else if(r){return t.getExpressionFromAnnotation(e?.Validation?.[n],i)}return undefined};p.getMinMaxDateExpression=_;const tt=function(t,e,a,n){const i=a.targetObject;if(!h(i)||["com.sap.vocabularies.UI.v1.DataFieldForAction","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataFieldForActionGroup","com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"].includes(e.$Type)){t.editStyle=null;return}if(!n){if(i?.annotations?.Validation?.Maximum?.$Date||i?.annotations?.Validation?.Minimum?.$Date){const e=x(v(a));t.valueBindingExpression=c.getBindingForDatePicker(a,e)}else{t.valueBindingExpression=t.value?t.value:w(a,t.formatOptions)}const n=e.annotations?.UI?.Placeholder||e?.Value?.$target?.annotations?.UI?.Placeholder;if(n){t.editStylePlaceholder=A(V(n))}}const o=F(e)?e.Target?.$target:e;if(o?.Visualization==="UI.VisualizationType/Rating"){t.editStyle="RatingIndicator";if(o.annotations?.Common?.QuickInfo){t.ratingIndicatorTooltip=A(V(o.annotations?.Common?.QuickInfo))}t.ratingIndicatorTargetValue=A(V(o.TargetValue));return}if(Y(i,t.formatOptions?.measureDisplayMode)||t.formatOptions?.measureDisplayMode!=="Hidden"&&(i.annotations?.Measures?.ISOCurrency||i.annotations?.Measures?.Unit&&!g(i))){if(!n){const e=i.annotations?.Common?.ExternalID?H(t.dataModelPathExternalID,t.formatOptions):H(a,t.formatOptions);const n=!!t.value&&/{\w+>.+}/.test(t.value);if(n){if(t.description){t.textBindingExpression=t.description}else{t.textBindingExpression=undefined;t.formatOptions.displayMode="Value"}}else{t.textBindingExpression=e}if(t.formatOptions?.measureDisplayMode!=="Hidden"){t.valueBindingExpression=t.value?t.value:w(a,t.formatOptions,false,false,undefined,false,true)}}t.editStyle="InputWithValueHelp";return}switch(i.type){case"Edm.Date":t.editStyle="DatePicker";const e=d(a);if(i?.annotations?.Validation?.Maximum){t.maxDateExpression=_(i?.annotations,"Maximum",e)}if(i?.annotations?.Validation?.Minimum){t.minDateExpression=_(i?.annotations,"Minimum",e)}return;case"Edm.Time":case"Edm.TimeOfDay":t.editStyle="TimePicker";return;case"Edm.DateTime":case"Edm.DateTimeOffset":t.editStyle="DateTimePicker";if(!i.annotations?.Common?.Timezone){t.showTimezone=undefined}else{t.showTimezone=true}return;case"Edm.Boolean":t.editStyle="CheckBox";return;case"Edm.Stream":t.editStyle="File";return;case"Edm.String":if(i.annotations?.UI?.MultiLineText?.valueOf()){t.editStyle="TextArea";return}if(i.annotations?.UI?.InputMask?.valueOf()){t.editStyle="InputMask";t.mask={mask:i.annotations?.UI?.InputMask?.Mask.toString(),placeholderSymbol:i.annotations?.UI?.InputMask?.PlaceholderSymbol.toString(),maskRule:et(i.annotations?.UI?.InputMask?.Rules)};return}break;default:if(g(i)){t.staticDescription="%"}t.editStyle="Input"}t.editStyle="Input"};p.setEditStyleProperties=tt;const et=t=>{if(!t||t.length===0){return[{symbol:"*",regex:"[a-zA-Z0-9]"}]}return t.map(t=>({symbol:t.MaskSymbol.toString(),regex:t.RegExp.toString()}))};const at=t=>{const e=t.targetObject;if(l.hasSemanticObject(e)){return true}const a=t?.navigationProperties?.length?t?.navigationProperties[t?.navigationProperties?.length-1]:null;if(!a||t.contextLocation?.navigationProperties?.find(t=>t.name===a.name)){return false}return l.hasSemanticObject(a)};p.hasSemanticObjectInNavigationOrProperty=at;const nt=t=>{if(!t.targetObject){return undefined}let e="";if(U(t,"com.sap.vocabularies.UI.v1.DataPoint")){t.targetObject.$Type=t.targetObject.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}switch(t.targetObject.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataPointType":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":if(typeof t.targetObject.Value==="object"){e=t.targetObject.Value.path}break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(t.targetObject.Target.$target){if(D(t.targetObject.Target.$target,["com.sap.vocabularies.UI.v1.DataPointType","com.sap.vocabularies.UI.v1.DataField"])){if(t.targetObject.Target.value.indexOf("/")>0){e=t.targetObject.Target.value.replace(/\/@.*/,`/${t.targetObject.Target.$target.Value?.path}`)}else{e=t.targetObject.Target.$target.Value?.path}}else{e=t.targetObject.Target?.path}}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldForActionGroup":case"com.sap.vocabularies.UI.v1.DataFieldWithActionGroup":break}if(e&&e.length>0){return I(t,e)}else{return undefined}};p.getDataModelObjectPathForValue=nt;const it=t=>{const e=y(t,t=>t?.InsertRestrictions?.NonInsertableProperties);return e.some(e=>e?.$target?.fullyQualifiedName===t.targetObject?.fullyQualifiedName)};p.hasPropertyInsertRestrictions=it;const ot=t=>t?A(C([$(t),x("semanticKeyHasDraftIndicator","internal"),x("HasDraftEntity"),x("IsActiveEntity"),x("hideDraftInfo","pageInternal")],"sap.fe.macros.field.FieldRuntime.isDraftIndicatorVisible")):"false";p.getDraftIndicatorVisibleBinding=ot;const rt=t=>{const e=t.targetObject?.annotations?.UI?.IsImageURL?.annotations?.Common?.IsNaturalPerson||t.targetObject?.annotations?.UI?.IsImage?.annotations?.Common?.IsNaturalPerson;const a=t.targetEntityType.annotations?.Common?.IsNaturalPerson;let n;if(e){n=V(e)}else if(a){n=V(a)}else n=false;return A(S(n,u.Circle,u.Square))};p.getAvatarShape=rt;return p},false);
//# sourceMappingURL=FieldTemplating.js.map