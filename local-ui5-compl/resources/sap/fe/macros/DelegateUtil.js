/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/PropertyFormatters","sap/fe/core/templating/PropertyHelper","sap/fe/macros/field/FieldHelper","sap/fe/macros/internal/valuehelp/ValueHelpTemplating"],function(e,t,o,r,a,n,s,i,l){"use strict";var c=l.generateID;var u=s.getAssociatedUnitPropertyPath;var f=s.getAssociatedCurrencyPropertyPath;var d=n.getRelativePropertyPath;var p=a.getTargetObjectPath;var g=a.enhanceDataModelPath;var m=r.generate;var h=o.getInvolvedDataModelObjects;const P="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1";function C(){this.control.detachModelContextChange(C,this);const e=this.modelName,t=this.control.getModel(e);if(t){this.resolve(t)}else{this.control.attachModelContextChange(C,this)}}const y={FETCHED_PROPERTIES_DATA_KEY:"sap_fe_ControlDelegate_propertyInfoMap",setCachedProperties(e,t){if(e instanceof window.Element){return}const o=y.FETCHED_PROPERTIES_DATA_KEY;y.setCustomData(e,o,t)},getCachedProperties(e){if(e instanceof window.Element){return undefined}const t=y.FETCHED_PROPERTIES_DATA_KEY;return y.getCustomData(e,t)},async getCustomDataWithModifier(e,t,o){if(!o){return Promise.resolve(y.getCustomData(e,t))}const r=await y.retrieveCustomDataNode(e,t,o);if(r.length===1){return o.getProperty(r[0],"value")}else{return undefined}},getCustomData(e,t){if(e&&t){if(e instanceof window.Element){return e.getAttributeNS(P,t)}if(e.data instanceof Function){return e.data(t)}}return undefined},setCustomData(e,t,o){if(e&&t){if(e instanceof window.Element){return e.setAttributeNS(P,`customData:${t}`,o)}if(e.data instanceof Function){return e.data(t,o)}}},fetchPropertiesForEntity(e,t){return t.requestObject(`${e}/`)},fetchAnnotationsForEntity(e,t){return t.requestObject(`${e}@`)},async fetchModel(e){return new Promise(t=>{const o=e.getDelegate().payload&&e.getDelegate().payload?.modelName,r={modelName:o,control:e,resolve:t};C.call(r)})},async templateControlFragment(e,o,r,a){return t.templateControlFragment(e,o,r,a)},async doesValueHelpExist(e){const t=e.sPropertyName||"";const o=e.sValueHelpType||"";const r=e.oMetaModel;const a=e.oModifier;const n=`${e.sBindingPath}/${t}`;const s=r.createBindingContext(n);let l=i.valueHelpProperty(s);const P=e.sBindingPath&&e.sBindingPath.indexOf("/")===0;if(l.includes("$Path")){l=r.getObject(l)}if(P&&l.indexOf("/")!==0){const e=h(s);const t=f(e.targetObject)||u(e.targetObject);const o=g(e,t);l=p(o)}const C=c(e.flexId,m([a?a.getId(e.oControl):e.oControl.getId(),o]),d(s.getProperty(n),{context:{getModel:()=>e.oMetaModel,getPath:()=>n}}),d(s.getProperty(l),{context:{getModel:()=>e.oMetaModel,getPath:()=>l}}));return Promise.resolve().then(async function(){if(a){return a.getAggregation(e.oControl,"dependents")}return e.oControl.getAggregation("dependents")}).then(function(e){if(e){for(const t of e){let e=t;if(a){if(a.getControlType(t)==="sap.fe.macros.ValueHelp"&&a.targets!=="xmlTree"){e=t.getContent()}if(e&&a.getId(e)===C){return true}}else{const o=t;if(o.isA("sap.fe.macros.ValueHelp")){e=o.getContent()}if(e?.getId()===C){return true}}}}return false})},async isValueHelpRequired(t,o){const r=t.sPropertyName||"",a=t.oMetaModel,n=`${t.sBindingPath}/${r}`,s=a.createBindingContext(n),l=i.valueHelpProperty(s,o);return this.getCustomDataWithModifier(t.oControl,"displayModePropertyBinding",t.oModifier).then(async function(e){e=typeof e==="boolean"?e:e==="true";if(e){return false}return Promise.all([a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListWithFixedValues`),a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListReferences`),a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueListMapping`),a.requestObject(`${l}@com.sap.vocabularies.Common.v1.ValueList`)])}).then(function(e){if(!Array.isArray(e)){return e}return!!e[0]||!!e[1]||!!e[2]||!!e[3]}).catch(function(t){e.warning("Error while retrieving custom data / value list annotation values",t);return false})},isMultiValue(e){let t=true;switch(e.filterExpression){case"SearchExpression":case"SingleRange":case"SingleValue":t=false;break;default:break}if(e.type&&e.type.indexOf("Boolean")>0){t=false}return t},async retrieveCustomDataNode(e,t,o){const r=[];const a=await Promise.resolve().then(o.getAggregation.bind(o,e,"customData"));for(const e of a){const a=await o.getProperty(e,"key");if(a===t){r.push(e)}}return r}};return y},false);
//# sourceMappingURL=DelegateUtil.js.map