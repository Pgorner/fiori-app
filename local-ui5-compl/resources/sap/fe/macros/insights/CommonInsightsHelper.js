/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/deepClone","sap/fe/core/CommonUtils","sap/fe/core/helpers/ResourceModelHelper","sap/m/MessageBox","sap/ui/core/Element","sap/ui/mdc/p13n/StateUtil","../mdc/adapter/StateFilterToSelectionVariant"],function(t,e,n,o,r,s,a){"use strict";var i={};var c=n.getResourceModel;const l={"sap.ui.model.odata.type.String":"string","sap.ui.model.odata.type.Int":"integer","sap.ui.model.odata.type.Int32":"integer","sap.ui.model.odata.type.Int64":"integer","sap.ui.model.odata.type.Boolean":"boolean","sap.ui.model.odata.type.Decimal":"number","sap.ui.model.odata.type.Double":"number","sap.ui.model.odata.type.Date":"date","sap.ui.model.odata.type.DateTimeOffset":"datetime"};function p(t,e){if(e&&e.length===0){return false}const n=r.getElementById(t);if(n?.isA("sap.fe.macros.controls.FilterBar")){const t=n.getParent().isSemanticDateFilterApplied();return!t}return true}i.isInsightsCardCreationPossible=p;function g(t,e){if(t==="Table"){const t=`<strong>\n\t\t${e.getText("M_CARD_RETRY_MESSAGE")}\n\t\t</strong>`;const n=`<ul><li>\n\t\t\t${e.getText("M_CARD_FAILURE_REASON_DATE_RANGE_FILTERS")}\n\t\t\t</li><li>\n\t\t\t${e.getText("M_CARD_FAILURE_TABLE_REASON_UNSUPPORTED_COLUMNS")}\n\t\t\t</li></ul>`;const r=t+n;o.error(e.getText("M_CARD_CREATION_FAILURE"),{onClose:function(){throw new Error("Insights is not supported")},details:r})}else{const t=e.getText("M_CARD_CREATION_FAILURE_CHART_REASON_DATE_RANGE_FILTERS");o.error(t,{onClose:function(){throw new Error("Insights is not supported")}})}}function u(t){const e=t.getShellServices();const n=t.getNavigationService();const o=e.getHash();const r=e.parseShellHash(o);return{iAppStateKey:n.getIAppStateKey(),intent:{semanticObject:r.semanticObject,action:r.action}}}function d(t,e,n,o){const r={};const s=a.mergeSelectionVariants(e,o);const i=s.getSelectOptionsPropertyNames();if(i.length){for(const e of i){const o=m(e,n);if(e!=="$editState"&&!t.includes(e)&&!e.includes("$Parameter.")&&o){const t={id:s.getID(),Parameters:[],SelectOptions:[{PropertyName:e,Ranges:s.getSelectOption(e)}]};r[e]={value:JSON.stringify(t),type:o}}}}return r}function f(t,e,n){const o={};const r=e.getSelectOptionsPropertyNames();if(r.length){for(const s of t){const t=m(s,n);if(r.includes(s)&&t){o[s]={value:e.getSelectOption(s)?.[0].Low,type:t}}}}return o}function m(t,e){let n;e.forEach(e=>{if(e.name===t){n=l[e.dataType]}});return n}async function S(n,o,i,l){const m=p(i,l);if(!m){g(n,c(o));return}const S=e.getAppComponent(o.content);const A=r.getElementById(i);const E=o.content;const y=await s.retrieveExternalState(E);const R=a.getSelectionVariantFromConditions(y.filter,E.getPropertyHelper());let _,I,T=[];if(A?.isA("sap.fe.macros.controls.FilterBar")){const t=A.getParent();const e=t.getParameters();const n=await t.getSelectionVariant();const o=A.getPropertyInfoSet();T=t.getMandatoryFilterPropertyNames();_=d(e,n,o,R);I=f(e,n,o)}const h=t(S.getManifest(),20);const C=h["sap.app"];if(C["crossNavigation"]){delete C.crossNavigation}const N={navigation:u(S),type:n,requestParameters:{serviceUrl:o.content.getModel().getServiceUrl(),queryUrl:"",sortQuery:""},content:{cardTitle:""},parentAppManifest:h,parameters:{mandatoryFilters:T,filters:_,oDataParameters:I},entitySetPath:""};return N}i.createInsightsParams=S;function A(t){const e=n.getResourceModel(t);o.error(e.getText("M_CARD_FAILURE_GENERIC"))}i.showGenericErrorMessage=A;function E(t,e,n){if(!p(e,n)){return false}let o=false;for(const e of t){const t=e.getAction();const n=t.getId().includes("StandardAction::Insights");o=n&&t.getVisible()&&t.getEnabled();if(o){break}}return o}i.hasInsightActionEnabled=E;return i},false);
//# sourceMappingURL=CommonInsightsHelper.js.map