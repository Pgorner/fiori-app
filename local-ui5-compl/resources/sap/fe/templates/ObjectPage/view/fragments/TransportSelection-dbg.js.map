{"version":3,"names":["TransportSelection","_dec","defineUI5Class","_dec2","property","type","_dec3","_dec4","controllerExtensionHandler","_class","_class2","_BuildingBlock","props","others","_this","call","_initializerDefineProperty","_descriptor","_descriptor2","_exports","_inheritsLoose","_proto","prototype","onMetadataAvailable","_ownerComponent","definition","getModel","getObject","content","createContent","selectTransport","context","getBindingContext","label","messageStrip","getLink","getText","getPageController","editFlow","invokeAction","selectTransportAction","contexts","getTypeExpression","relativePath","getRelativePaths","transportPropertyObjectPath","requiredExpression","isRequiredExpression","targetObject","ifElse","and","not","pathInModel","transportRequestProperty","MessageType","Warning","Information","getLinkTextExpression","getTranslatedText","getStripText","textExpression","getTextBindingExpression","noTransportSelected","transportSelected","concat","getStripVisible","actionEnabledExpression","UI","IsEditable","dataModelObjects","getDataModelObjectPath","targetEntityType","actions","getActionEnabledExpression","convertedTypes","enhanceDataModelPath","_jsx","MessageStrip","text","showIcon","customIcon","class","visible","children","link","Link","press","bind","validateTransportRequestBeforeSave","getVisible","getType","leadingControl","Promise","resolve","BuildingBlock","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer","Object","getOwnPropertyDescriptor"],"sourceRoot":".","sources":["TransportSelection.tsx"],"sourcesContent":["import type { Property } from \"@sap-ux/vocabularies-types\";\nimport type { BindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport { and, concat, ifElse, not, pathInModel } from \"sap/fe/base/BindingToolkit\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { defineUI5Class, property } from \"sap/fe/base/ClassSupport\";\nimport { controllerExtensionHandler } from \"sap/fe/base/HookSupport\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport BuildingBlock from \"sap/fe/core/buildingBlocks/BuildingBlock\";\nimport type { TransportSelectionDefinition } from \"sap/fe/core/converters/ManifestSettings\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport { UI } from \"sap/fe/core/helpers/BindingHelper\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { enhanceDataModelPath, getRelativePaths } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { isRequiredExpression } from \"sap/fe/core/templating/FieldControlHelper\";\nimport { getActionEnabledExpression } from \"sap/fe/core/templating/UIFormatters\";\nimport { getTextBindingExpression } from \"sap/fe/macros/field/FieldTemplating\";\nimport Link from \"sap/m/Link\";\nimport MessageStrip from \"sap/m/MessageStrip\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport type ODataV4Context from \"sap/ui/model/odata/v4/Context\";\n\n@defineUI5Class(\"sap.fe.templates.ObjectPage.view.fragments.TransportSelection\")\nexport default class TransportSelection extends BuildingBlock<MessageStrip> {\n\t// The transport selection definition\n\t@property({ type: \"object\" })\n\tpublic definition!: TransportSelectionDefinition;\n\n\t// a flag to indicate the leading control, also taking care on validating on safe\n\t@property({ type: \"boolean\" })\n\tpublic leadingControl!: boolean;\n\n\t// Reference to the message strip\n\tmessageStrip!: MessageStrip;\n\n\t// the selectTransport action enablement\n\tactionEnabledExpression!: BindingToolkitExpression<boolean>;\n\n\t// data model object path to the transport property\n\ttransportPropertyObjectPath!: DataModelObjectPath<Property>;\n\n\tconstructor(props?: PropertiesOf<TransportSelection>, others?: PropertiesOf<TransportSelection>) {\n\t\tsuper(props, others);\n\t}\n\n\tonMetadataAvailable(_ownerComponent: TemplateComponent): void {\n\t\tsuper.onMetadataAvailable(_ownerComponent);\n\t\tthis.definition = this.definition ?? _ownerComponent.getModel(\"_pageModel\").getObject(\"/transportSelection\");\n\t\tthis.content = this.createContent();\n\t}\n\n\t/**\n\t * Call the selectTransportAction once the user clicks on the link in the message strip.\n\t * @returns Promise that is resolved once a transport request was selected\n\t */\n\tasync selectTransport(): Promise<unknown> {\n\t\tconst context = this.getBindingContext() as ODataV4Context;\n\t\tconst label = this.messageStrip.getLink().getText();\n\t\treturn this.getPageController()?.editFlow.invokeAction(this.definition.selectTransportAction, { contexts: context, label: label });\n\t}\n\n\t/**\n\t * Get expression for the message strip type.\n\t *\n\t * If mandatory and no transport request is given the type is Warning,\n\t * otherwise it's Information.\n\t * @returns Expression to determine the message strip type.\n\t */\n\tgetTypeExpression(): BindingToolkitExpression<MessageType> {\n\t\tconst relativePath = getRelativePaths(this.transportPropertyObjectPath);\n\t\tconst requiredExpression = isRequiredExpression(this.transportPropertyObjectPath.targetObject, relativePath);\n\t\treturn ifElse(\n\t\t\tand(requiredExpression, not(pathInModel(this.definition.transportRequestProperty))),\n\t\t\tMessageType.Warning,\n\t\t\tMessageType.Information\n\t\t);\n\t}\n\n\t/**\n\t * Get expression for the link text.\n\t *\n\t * If transport request is given the text shall be change transport, if not\n\t * it shall be select transport.\n\t * @returns Expression to determine the link text.\n\t */\n\tgetLinkTextExpression(): BindingToolkitExpression<string> {\n\t\treturn ifElse(\n\t\t\tpathInModel(this.definition.transportRequestProperty),\n\t\t\tthis.getTranslatedText(\"T_TRANSPORT_SELECTION_CHANGE_TRANSPORT\"),\n\t\t\tthis.getTranslatedText(\"T_TRANSPORT_SELECTION_SELECT_TRANSPORT\")\n\t\t);\n\t}\n\n\t/**\n\t * Get expression for the message strip text.\n\t *\n\t * If no transport given we show a warning text, if one is given we show the\n\t * selected transport request, and also consider the text annotation on the\n\t * transport request property.\n\t * @returns Expression to determine the message strip text\n\t */\n\tgetStripText(): BindingToolkitExpression<string | undefined> {\n\t\tconst textExpression = getTextBindingExpression(this.transportPropertyObjectPath, {});\n\t\tconst noTransportSelected = this.getTranslatedText(\"T_TRANSPORT_SELECTION_NO_TRANSPORT_SELECTED\");\n\t\tconst transportSelected = concat(`${this.getTranslatedText(\"T_TRANSPORT_SELECTION_SELECTED_TRANSPORT\")}: `, textExpression);\n\t\treturn ifElse(pathInModel(this.definition.transportRequestProperty), transportSelected, noTransportSelected);\n\t}\n\n\t/**\n\t * Get expression for the message strip visibility.\n\t *\n\t * If not in edit mode we don't show the message strip at all. If in edit\n\t * mode we check the OperationAvailable annotation on the selectTransportAction.\n\t * @returns Expression to determine the  message strip visibility\n\t */\n\tgetStripVisible(): BindingToolkitExpression<boolean> {\n\t\t// The visibility of the strip relies on the Core.OperationAvailable set on the transport select action\n\t\treturn ifElse(this.actionEnabledExpression, UI.IsEditable, false);\n\t}\n\n\t/**\n\t * Get the message strip to be shown in the object page header.\n\t * @returns Message strip or nothing in case the feature is not enabled\n\t */\n\tcreateContent(): MessageStrip | undefined {\n\t\tconst dataModelObjects = this.getDataModelObjectPath<PageContextPathTarget>();\n\n\t\tconst selectTransportAction = dataModelObjects?.targetEntityType.actions[this.definition.selectTransportAction];\n\t\tif (dataModelObjects && selectTransportAction) {\n\t\t\tthis.actionEnabledExpression = getActionEnabledExpression(\n\t\t\t\tselectTransportAction,\n\t\t\t\tdataModelObjects?.convertedTypes,\n\t\t\t\tdataModelObjects\n\t\t\t);\n\t\t\tthis.transportPropertyObjectPath = enhanceDataModelPath<Property>(dataModelObjects, this.definition.transportRequestProperty);\n\n\t\t\tthis.messageStrip = (\n\t\t\t\t<MessageStrip\n\t\t\t\t\ttext={this.getStripText()}\n\t\t\t\t\ttype={this.getTypeExpression()}\n\t\t\t\t\tshowIcon=\"true\"\n\t\t\t\t\tcustomIcon=\"sap-icon://shipping-status\"\n\t\t\t\t\tclass=\"sapUiSmallMarginTop\"\n\t\t\t\t\tvisible={this.getStripVisible()}\n\t\t\t\t>\n\t\t\t\t\t{{\n\t\t\t\t\t\tlink: <Link press={this.selectTransport.bind(this)} text={this.getLinkTextExpression()} />\n\t\t\t\t\t}}\n\t\t\t\t</MessageStrip>\n\t\t\t);\n\t\t\treturn this.messageStrip;\n\t\t}\n\t}\n\n\t/**\n\t * Show selectTransport dialog if no transport chosen.\n\t *\n\t * We check if the TransportSelection feature is enabled and if the message strip\n\t * type is warning (= mandatory but no transport request chosen). If so we show the selectTransport dialog.\n\t * @returns Promise that is resolved once a transport request was selected\n\t */\n\t@controllerExtensionHandler(\"editFlow\", \"onBeforeSave\")\n\tasync validateTransportRequestBeforeSave(): Promise<unknown> {\n\t\tif (this.messageStrip.getVisible() && this.messageStrip.getType() === MessageType.Warning && this.leadingControl) {\n\t\t\treturn this.selectTransport();\n\t\t}\n\t\treturn Promise.resolve();\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"TransportSelection-dbg.js"}