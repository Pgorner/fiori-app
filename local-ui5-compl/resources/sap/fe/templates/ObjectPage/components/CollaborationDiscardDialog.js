/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/helpers/ResourceModelHelper","sap/fe/macros/CommonHelper","sap/m/Avatar","sap/m/Button","sap/m/Dialog","sap/m/HBox","sap/m/ObjectIdentifier","sap/m/ObjectStatus","sap/m/Text","sap/m/VBox","sap/ui/core/Lib","sap/ui/core/library","sap/ui/model/Filter","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs","sap/fe/base/jsx-runtime/jsx"],function(e,t,i,s,a,n,o,r,l,c,d,g,u,h,D,C,T,m){"use strict";function p(e){return new Promise((t,i)=>{sap.ui.require([e],i=>{if(!(i&&i.__esModule)){i=i===null||!(typeof i==="object"&&e.endsWith("/library"))?{default:i}:i;Object.defineProperty(i,"__esModule",{value:true})}t(i)},e=>{i(e)})})}var A={};var R=h.ValueState;var f=t.UserStatus;var _=t.UserEditingState;var I=t.CollaborationUtils;let O=function(){function t(e,t){this.formatUserStatus=e=>{switch(e){case f.CurrentlyEditing:return this.discardResourceModel.getText("C_COLLABORATIONDRAFT_USER_CURRENTLY_EDITING");case f.ChangesMade:return this.discardResourceModel.getText("C_COLLABORATIONDRAFT_USER_CHANGES_MADE");case f.NoChangesMade:return this.discardResourceModel.getText("C_COLLABORATIONDRAFT_USER_NO_CHANGES_MADE");case f.NotYetInvited:default:return this.discardResourceModel.getText("C_COLLABORATIONDRAFT_USER_NOT_YET_INVITED")}};this.saveManageDialog=()=>{this.promiseResolve("save");this.manageDialog.close();this.manageDialog.destroy()};this.discardManageDialog=()=>{this.promiseResolve("discardConfirmed");this.manageDialog.close();this.manageDialog.destroy()};this.cancelManageDialog=()=>{this.promiseResolve("cancel");this.manageDialog.close();this.manageDialog.destroy()};this.keepDraftManageDialog=()=>{this.promiseResolve("keepDraft");this.manageDialog.close();this.manageDialog.destroy()};this.actionIsSave=t;this.containingView=e;this.discardResourceModel=i.getResourceModel(e);if(t){this.actionButton=this.getSaveButton();this.topText=this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_EDITING_DRAFT");this.bottomText=this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_SAVE_WARNING")}else{this.actionButton=this.getDiscardButton();this.topText=this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_CHANGES_DRAFT");this.bottomText=this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_DISCARD_WARNING")}}A=t;t.load=async function e(){if(t.GridTableControl===undefined){await u.load({name:"sap.ui.table"});const{default:e}=await p("sap/ui/table/Table");t.GridTableControl=e;const{default:i}=await p("sap/ui/table/Column");t.GridTableColumnControl=i}return this};var h=t.prototype;h.getManageDialog=function e(){this.manageDialog=m(o,{title:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_TITLE"),state:R.Warning,contentWidth:"35em",children:{buttons:T(C,{children:["keepDraftButton = ",this.getKeepDraftButton(),"confirmActionButton = ",this.actionButton,"cancelButton = ",this.getCancelButton()]}),content:T(g,{class:"sapUiSmallMargin",children:[m(l,{class:"sapUiSmallMarginBottom",text:this.topText}),this.getManageDialogUserTable(),m(d,{class:"sapUiSmallMarginTop",text:this.bottomText}),m(d,{class:"sapUiSmallMarginTop",text:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_QUESTION")})]})}});this.containingView.addDependent(this.manageDialog);this.manageDialog.bindElement({model:"internal",path:"collaboration"});return this.manageDialog};h.getManageDialogUserTableColumns=function e(){return T(C,{children:[m(t.GridTableColumnControl,{width:"3em",children:{template:m(r,{alignItems:"Center",justifyContent:"SpaceBetween",width:"100%",children:m(a,{displaySize:"XS",backgroundColor:"{internal>color}",initials:"{internal>initials}"})})}}),m(t.GridTableColumnControl,{width:"10rem",children:{label:m(d,{text:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_INVITATION_TABLE_USER_COLUMN")}),template:m(d,{text:"{internal>name}"})}}),m(t.GridTableColumnControl,{width:"14em",children:{label:m(d,{text:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_INVITATION_TABLE_USER_STATUS_COLUMN")}),template:m(c,{state:{path:"internal>status",formatter:this.formatUserStatusColor},text:{path:"internal>status",formatter:this.formatUserStatus}})}})]})};h.getManageDialogUserTable=function e(){const i=this.containingView.getBindingContext("internal");const a=i.getProperty("collaboration/currentlyEditingUsers");let n;if(s.isDesktop()){n=a.length<5?a.length:5}else{n=a.length<3?a.length:3}return m(t.GridTableControl,{width:"100%",rows:{path:"internal>currentlyEditingUsers"},visibleRowCount:n,visibleRowCountMode:"Fixed",selectionMode:"None",children:{columns:this.getManageDialogUserTableColumns()}})};h.formatUserStatusColor=function e(t){switch(t){case f.CurrentlyEditing:return R.Success;case f.ChangesMade:return R.Warning;case f.NoChangesMade:case f.NotYetInvited:default:return R.Information}};h.readInvitedUsers=async function t(){const i=this.containingView;const s=i.getModel();const a={$select:"UserID,UserDescription,UserEditingState"};const n=s.bindList("DraftAdministrativeData/DraftAdministrativeUser",i.getBindingContext(),[],[],a);const o=I.getMe(e.getAppComponent(i));const r=i.getBindingContext("internal");if(o){n.filter(new D({path:"UserID",operator:"NE",value1:o.id}))}const l=await n.requestContexts(0,100);const c=[];const d=i.getModel("internal").getProperty("/collaboration/activeUsers")||[];if(!l.length||l.length===0){r.setProperty("collaboration/currentlyEditingUsers",[]);return}l.forEach(e=>{const t=e.getObject();const i=this.createUser(t,d);if(i){i.color=I.getUserColor(t.UserID,d,c);c.push(i)}});const g=this.sortUser(c);r.setProperty("collaboration/currentlyEditingUsers",g)};h.sortUser=function e(t){let i=t;if(t.length>1){i=t.sort((e,t)=>{if(e.status<t.status){return 1}else if(e.status>t.status){return-1}return 0})}return i};h.createUser=function e(t,i){let s;const a=i.find(e=>e.id===t.UserID);const n=t.UserDescription??t.UserID;const o=I.formatInitials(n);if(a){s=f.CurrentlyEditing}else if(t.UserEditingState===_.InProgress){s=f.ChangesMade}else{return undefined}const r={id:t.UserID,name:n,status:s,initials:o};return r};h.getSaveButton=function e(){return m(n,{text:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_SAVE"),press:this.saveManageDialog})};h.getDiscardButton=function e(){return m(n,{text:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_DISCARD"),press:this.discardManageDialog})};h.getCancelButton=function e(){return m(n,{text:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_CANCEL"),press:this.cancelManageDialog})};h.getKeepDraftButton=function e(){return m(n,{text:this.discardResourceModel.getText("C_COLLABORATIONDRAFT_DISCARD_KEEP_DRAFT"),press:this.keepDraftManageDialog,type:"Emphasized"})};h.getUserAction=async function e(){await this.readInvitedUsers();return this.open()};h.open=async function e(){await t.load();const i=this.containingView.getBindingContext("internal");const s=i.getProperty("collaboration/currentlyEditingUsers");if(s.length===0){return this.actionIsSave?"save":"discard"}this.manageDialog=this.getManageDialog();this.manageDialog.getBindingContext("internal").setProperty("currentlyEditingUsers",s);this.manageDialog.open();return new Promise(e=>{this.promiseResolve=e})};return t}();A=O;return A},false);
//# sourceMappingURL=CollaborationDiscardDialog.js.map