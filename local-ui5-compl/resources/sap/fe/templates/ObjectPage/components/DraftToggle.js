/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/core/CommonUtils","sap/fe/core/buildingBlocks/BuildingBlock","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/BindingHelper","sap/fe/templates/ObjectPage/ObjectPageTemplating","sap/m/Button","sap/m/ResponsivePopover","sap/m/SelectList","sap/ui/core/InvisibleText","sap/ui/core/Item","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/jsxs"],function(e,t,i,r,n,o,a,c,s,l,p,f,u,d){"use strict";var _,v,T,b,h,g,C,O,m,w,I,A,E;var y={};var S=a.getSwitchDraftAndActiveVisibility;var D=o.UI;var P=o.Entity;var x=t.property;var R=t.implementInterface;var B=t.defineUI5Class;var M=t.defineReference;var V=e.pathInModel;var j=e.not;var z=e.ifElse;var H=e.and;function K(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function N(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,W(e,t)}function W(e,t){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},W(e,t)}function Y(e,t,i,r,n){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,r){return r(e,t,i)||i},o),n&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(n):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(e,t,o),null):o}function F(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let U=(_=B("sap.fe.macros.DraftToggle"),v=R("sap.m.IOverflowToolbarContent"),T=x({type:"string"}),b=x({type:"string"}),h=M(),g=M(),_(C=(O=function(e){function t(t,r){var n;n=e.call(this,t,r)||this;K(n,"__implements__sap_m_IOverflowToolbarContent",m,n);n.SWITCH_TO_DRAFT_KEY="switchToDraft";n.SWITCH_TO_ACTIVE_KEY="switchToActive";K(n,"id",w,n);K(n,"contextPath",I,n);K(n,"switchToActiveRef",A,n);K(n,"switchToDraftRef",E,n);n.initialSelectedKey=n.SWITCH_TO_ACTIVE_KEY;n.handleSelectedItemChange=e=>{const t=e.getParameter("item")?.getProperty("key");if(t!==n.initialSelectedKey){n._containingView.getController().editFlow.toggleDraftActive(n._containingView.getBindingContext())}if(n.popover){n.popover.close();n.popover.destroy();delete n.popover}};n.openSwitchActivePopover=e=>{const t=e.getSource();const r=i.getTargetView(t);const o=r.getBindingContext();const a=o.getObject().IsActiveEntity;n.initialSelectedKey=a?n.SWITCH_TO_ACTIVE_KEY:n.SWITCH_TO_DRAFT_KEY;n.popover=n.createPopover();n._containingView=r;r.addDependent(n.popover);n.popover.openBy(t);n.popover.attachEventOnce("afterOpen",()=>{if(a){n.switchToDraftRef.current?.focus()}else{n.switchToActiveRef.current?.focus()}});return n.popover};return n}y=t;N(t,e);var r=t.prototype;r.onMetadataAvailable=function e(){if(!this.content){this.content=this.createContent()}};r.getVisible=function e(){return this.content?.getVisible()??true};r.getEnabled=function e(){return this.content?.getProperty("enabled")??true};r.getOverflowToolbarConfig=function e(){return{canOverflow:true}};r.createPopover=function e(){return u(s,{showHeader:false,contentWidth:"15.625rem",verticalScrolling:false,class:"sapUiNoContentPadding",placement:"Bottom",children:d(l,{selectedKey:this.initialSelectedKey,itemPress:this.handleSelectedItemChange,children:[u(f,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_DRAFT_MIT}",ref:this.switchToDraftRef},this.SWITCH_TO_DRAFT_KEY),u(f,{text:"{sap.fe.i18n>C_COMMON_OBJECT_PAGE_DISPLAY_SAVED_VERSION_MIT}",ref:this.switchToActiveRef},this.SWITCH_TO_ACTIVE_KEY)]})})};r.createContent=function e(){const t=this._getOwner()?.preprocessorContext?.fullContextPath;const i=this._getOwner()?.getMetaModel();const r=i?.createBindingContext(this.contextPath??t);const o=n.convertMetaModelContext(r);const a=z(H(j(D.IsEditable),j(D.IsCreateMode),P.HasDraft),V("C_COMMON_OBJECT_PAGE_SAVED_VERSION_BUT","sap.fe.i18n"),V("C_COMMON_OBJECT_PAGE_DRAFT_BUT","sap.fe.i18n"));const s=S(o);const l=u(p,{text:"{sap.fe.i18n>T_HEADER_DATAPOINT_TITLE_DRAFT_SWITCHER_ARIA_BUTTON}",id:this.createId("AriaTextDraftSwitcher")});l.toStatic();const f=u(c,{id:this.createId("_dt"),"dt:designtime":"not-adaptable",text:a,visible:s,icon:"sap-icon://navigation-down-arrow",iconFirst:false,type:"Transparent",press:e=>this.openSwitchActivePopover(e),ariaDescribedBy:this.createId("AriaTextDraftSwitcher")?[this.createId("AriaTextDraftSwitcher")]:undefined});f.addDependent(l);return f};return t}(r),m=Y(O.prototype,"__implements__sap_m_IOverflowToolbarContent",[v],{configurable:true,enumerable:true,writable:true,initializer:function(){return true}}),w=Y(O.prototype,"id",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),I=Y(O.prototype,"contextPath",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),A=Y(O.prototype,"switchToActiveRef",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),E=Y(O.prototype,"switchToDraftRef",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),O))||C);y=U;return y},false);
//# sourceMappingURL=DraftToggle.js.map