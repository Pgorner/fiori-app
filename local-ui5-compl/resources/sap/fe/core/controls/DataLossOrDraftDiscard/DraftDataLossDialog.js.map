{"version":3,"file":"DraftDataLossDialog.js","names":["DraftDataLossDialog","_dec","defineUI5Class","_dec2","defineReference","_dec3","_class","_class2","_ManagedObject","_this","_len","arguments","length","args","Array","_key","call","this","_initializerDefineProperty","_descriptor","_descriptor2","shallForceDraftSaveOrDiscard","_exports","_inheritsLoose","_proto","prototype","open","async","controller","view","getView","editFlow","dataLossResourceModel","getResourceModel","createContent","dataLossConfirm","handleDataLossOk","optionsList","current","addEventDelegate","onkeyup","e","key","addDependent","dataLossDialog","selectAndFocusFirstEntry","Promise","resolve","promiseResolve","close","destroy","getSelectedKey","handleDataLossCancel","firstListItemOption","getItems","setSelectedItem","focus","getSelectedItem","data","getConfirmButton","_jsx","Button","text","getText","type","press","getCancelButton","hasActiveEntity","createOrSaveLabel","createOrSaveText","items","push","CustomListItem","customData","CustomData","value","children","_jsxs","VBox","class","Label","design","Text","getBindingContext","getObject","HasActiveEntity","description","Dialog","id","generate","getId","title","state","ValueState","Warning","contentWidth","ref","content","_Fragment","List","mode","showSeparators","includeItemInSelection","backgroundDesign","buttons","ManagedObject","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./DraftDataLossDialog.tsx"],"sourcesContent":["import { defineReference, defineUI5Class } from \"sap/fe/base/ClassSupport\";\nimport type { Ref } from \"sap/fe/base/jsx-runtime/jsx\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport Button from \"sap/m/Button\";\nimport CustomListItem from \"sap/m/CustomListItem\";\nimport Dialog from \"sap/m/Dialog\";\nimport Label from \"sap/m/Label\";\nimport List from \"sap/m/List\";\nimport Text from \"sap/m/Text\";\nimport VBox from \"sap/m/VBox\";\nimport ManagedObject from \"sap/ui/base/ManagedObject\";\nimport CustomData from \"sap/ui/core/CustomData\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport { ValueState } from \"sap/ui/core/library\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type PageController from \"../../PageController\";\nimport type ResourceModel from \"../../ResourceModel\";\n\n@defineUI5Class(\"sap.fe.core.controls.DataLossOrDraftDiscard.DraftDataLossDialog\")\nexport default class DraftDataLossDialog extends ManagedObject {\n\t@defineReference()\n\tdataLossDialog!: Ref<Dialog>;\n\n\t@defineReference()\n\toptionsList!: Ref<List>;\n\n\tprivate view!: View;\n\n\tprivate dataLossResourceModel!: ResourceModel;\n\n\t/**\n\t * Resolves the promise with the selected dialog list option\n\t */\n\tprivate promiseResolve!: Function;\n\n\tprivate shallForceDraftSaveOrDiscard = false;\n\n\t/**\n\t * Opens the data loss dialog.\n\t * @param controller\n\t */\n\tpublic async open(controller: PageController): Promise<unknown> {\n\t\tthis.view = controller.getView();\n\t\tthis.shallForceDraftSaveOrDiscard = controller.editFlow.shallForceDraftSaveOrDiscard();\n\t\tthis.dataLossResourceModel = getResourceModel(this.view);\n\t\tthis.createContent();\n\t\tconst dataLossConfirm = (): void => this.handleDataLossOk();\n\t\tthis.optionsList.current?.addEventDelegate({\n\t\t\tonkeyup: function (e: KeyboardEvent) {\n\t\t\t\tif (e.key === \"Enter\") {\n\t\t\t\t\tdataLossConfirm();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.view.addDependent(this.dataLossDialog.current as UI5Element);\n\t\tthis.dataLossDialog.current?.open();\n\t\tthis.selectAndFocusFirstEntry();\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.promiseResolve = resolve;\n\t\t});\n\t}\n\n\t/**\n\t * Handler to close the dataloss dialog.\n\t *\n\t */\n\tpublic close(): void {\n\t\tthis.dataLossDialog.current?.close();\n\t\tthis.dataLossDialog.current?.destroy();\n\t}\n\n\t/**\n\t * Executes the logic when the data loss dialog is confirmed. The selection of an option resolves the promise and leads to the\n\t * processing of the originally triggered action like e.g. a back navigation.\n\t *\n\t */\n\n\tprivate handleDataLossOk(): void {\n\t\tthis.promiseResolve(this.getSelectedKey());\n\t}\n\n\t/**\n\t * Handler to close the dataloss dialog.\n\t *\n\t */\n\tprivate handleDataLossCancel(): void {\n\t\tthis.promiseResolve(\"cancel\");\n\t}\n\n\t/**\n\t * Sets the focus on the first list item of the dialog.\n\t *\n\t */\n\tprivate selectAndFocusFirstEntry(): void {\n\t\tconst firstListItemOption: CustomListItem = this.optionsList.current?.getItems()[0] as CustomListItem;\n\t\tthis.optionsList.current?.setSelectedItem(firstListItemOption);\n\t\t// We do not set the focus on the button, but catch the ENTER key in the dialog\n\t\t// and process it as Ok, since focusing the button was reported as an ACC issue\n\t\tfirstListItemOption?.focus();\n\t}\n\n\t/**\n\t * Gets the key of the selected item from the list of options that was set via customData.\n\t * @returns The key of the currently selected item\n\t */\n\tprivate getSelectedKey(): string {\n\t\tconst optionsList = this.optionsList.current as List;\n\t\treturn optionsList.getSelectedItem().data(\"itemKey\");\n\t}\n\n\t/**\n\t * Returns the confirm button.\n\t * @returns A button\n\t */\n\tprivate getConfirmButton(): Button {\n\t\treturn (\n\t\t\t<Button\n\t\t\t\ttext={this.dataLossResourceModel.getText(\"C_COMMON_DIALOG_OK\")}\n\t\t\t\ttype={\"Emphasized\"}\n\t\t\t\tpress={(): void => this.handleDataLossOk()}\n\t\t\t/>\n\t\t) as Button;\n\t}\n\n\t/**\n\t * Returns the cancel button.\n\t * @returns A button\n\t */\n\tprivate getCancelButton(): Button {\n\t\treturn (\n\t\t\t<Button text={this.dataLossResourceModel.getText(\"C_COMMON_DIALOG_CANCEL\")} press={(): void => this.handleDataLossCancel()} />\n\t\t) as Button;\n\t}\n\n\t/**\n\t * Returns the options available in the dialog.\n\t * @param hasActiveEntity\n\t * @returns The options as CustomListItems\n\t */\n\tprivate getItems(hasActiveEntity: boolean): CustomListItem[] {\n\t\tconst createOrSaveLabel = hasActiveEntity\n\t\t\t? this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_SAVE_DRAFT_RBL\")\n\t\t\t: this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_CREATE_ENTITY_RBL\");\n\t\tconst createOrSaveText = hasActiveEntity\n\t\t\t? this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_SAVE_DRAFT_TOL\")\n\t\t\t: this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_CREATE_ENTITY_TOL\");\n\n\t\tconst items: CustomListItem[] = [];\n\t\titems.push(\n\t\t\t<CustomListItem customData={[new CustomData({ key: \"itemKey\", value: \"draftDataLossOptionSave\" })]}>\n\t\t\t\t<VBox class=\"sapUiTinyMargin\">\n\t\t\t\t\t<Label text={createOrSaveLabel} design=\"Bold\" />\n\t\t\t\t\t<Text text={createOrSaveText} />\n\t\t\t\t</VBox>\n\t\t\t</CustomListItem>\n\t\t);\n\n\t\t// The option to keep the draft is not available for new drafts and if shallForceDraftSaveOrDiscard === true\n\t\t// (TreeTable in the ListReport)\n\t\tif (hasActiveEntity || !this.shallForceDraftSaveOrDiscard) {\n\t\t\titems.push(\n\t\t\t\t<CustomListItem customData={[new CustomData({ key: \"itemKey\", value: \"draftDataLossOptionKeep\" })]}>\n\t\t\t\t\t<VBox class=\"sapUiTinyMargin\">\n\t\t\t\t\t\t<Label text={this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_KEEP_DRAFT_RBL\")} design=\"Bold\" />\n\t\t\t\t\t\t<Text text={this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_KEEP_DRAFT_TOL\")} />\n\t\t\t\t\t</VBox>\n\t\t\t\t</CustomListItem>\n\t\t\t);\n\t\t}\n\n\t\titems.push(\n\t\t\t<CustomListItem customData={[new CustomData({ key: \"itemKey\", value: \"draftDataLossOptionDiscard\" })]}>\n\t\t\t\t<VBox class=\"sapUiTinyMargin\">\n\t\t\t\t\t<Label text={this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_DISCARD_DRAFT_RBL\")} design=\"Bold\" />\n\t\t\t\t\t<Text text={this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_DISCARD_DRAFT_TOL\")} />\n\t\t\t\t</VBox>\n\t\t\t</CustomListItem>\n\t\t);\n\n\t\treturn items;\n\t}\n\n\t/**\n\t * The building block render function.\n\t * @returns An XML-based string\n\t */\n\tcreateContent(): Dialog {\n\t\tconst hasActiveEntity = this.view.getBindingContext()?.getObject().HasActiveEntity === true;\n\t\tconst description = hasActiveEntity\n\t\t\t? this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_POPUP_MESSAGE_SAVE\")\n\t\t\t: this.dataLossResourceModel.getText(\"ST_DRAFT_DATALOSS_POPUP_MESSAGE_CREATE\");\n\n\t\treturn (\n\t\t\t<Dialog\n\t\t\t\tid={generate([this.getId(), \"draftDataLossDialog\"])}\n\t\t\t\ttitle={this.dataLossResourceModel.getText(\"WARNING\")}\n\t\t\t\tstate={ValueState.Warning}\n\t\t\t\ttype={\"Message\"}\n\t\t\t\tcontentWidth={\"22rem\"}\n\t\t\t\tref={this.dataLossDialog}\n\t\t\t>\n\t\t\t\t{{\n\t\t\t\t\tcontent: (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Text text={description} class=\"sapUiTinyMarginBegin sapUiTinyMarginTopBottom\" />\n\t\t\t\t\t\t\t<List\n\t\t\t\t\t\t\t\tmode=\"SingleSelectLeft\"\n\t\t\t\t\t\t\t\tshowSeparators=\"None\"\n\t\t\t\t\t\t\t\tincludeItemInSelection=\"true\"\n\t\t\t\t\t\t\t\tbackgroundDesign=\"Transparent\"\n\t\t\t\t\t\t\t\tclass=\"sapUiNoContentPadding\"\n\t\t\t\t\t\t\t\tref={this.optionsList}\n\t\t\t\t\t\t\t\titems={this.getItems(hasActiveEntity)}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t),\n\t\t\t\t\tbuttons: (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\tconfirmButton = {this.getConfirmButton()}\n\t\t\t\t\t\t\tcancelButton = {this.getCancelButton()}\n\t\t\t\t\t\t</>\n\t\t\t\t\t)\n\t\t\t\t}}\n\t\t\t</Dialog>\n\t\t) as Dialog;\n\t}\n}\n"],"mappings":"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","ignoreList":[]}