/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/ObjectPage/HeaderFacet","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/TypeGuards","../../ManifestSettings","../../annotations/DataField","../../helpers/ConfigurableObject","../../helpers/ID","../../objectPage/FormMenuActions","../Common/DataVisualization","../Common/Form"],function(e,t,a,n,i,o,s,r,c,l,u,d,f,v){"use strict";var m={};var p=v.isReferenceFacet;var g=v.createFormDefinition;var b=f.getDataVisualizationConfiguration;var I=d.getFormHiddenActions;var F=d.getFormActions;var h=u.getSubSectionID;var y=u.getSideContentID;var A=u.getFormID;var U=u.getCustomSubSectionID;var C=l.insertCustomElements;var S=l.Placement;var D=l.OverrideType;var T=c.isActionWithDialog;var L=r.ActionType;var k=s.isPathAnnotationExpression;var M=o.KeyHelper;var E=i.IssueType;var N=i.IssueSeverity;var P=i.IssueCategory;var O=n.getStashedSettingsForHeaderFacet;var w=n.getHeaderFacetsFromManifest;var $=n.getDesignTimeMetadataSettingsForHeaderFacet;var x=a.removeDuplicateActions;var R=a.prepareMenuActions;var V=a.isActionNavigable;var z=a.getVisibilityEnablementMenuActions;var H=a.getSemanticObjectMapping;var j=a.getMatchingManifestAction;var B=a.getEnabledForAnnotationAction;var _=a.getAnnotationMenuActionItems;var G=a.getActionsFromManifest;var W=a.ButtonType;var q=t.resolveBindingString;var K=t.ref;var X=t.pathInModel;var Q=t.or;var J=t.notEqual;var Y=t.not;var Z=t.isConstant;var ee=t.ifElse;var te=t.getExpressionFromAnnotation;var ae=t.fn;var ne=t.equal;var ie=t.compileExpression;var oe=t.and;let se=function(e){e["Unknown"]="Unknown";e["Form"]="Form";e["Notes"]="Notes";e["DataVisualization"]="DataVisualization";e["XMLFragment"]="XMLFragment";e["Placeholder"]="Placeholder";e["Mixed"]="Mixed";e["EmbeddedComponent"]="EmbeddedComponent";return e}({});m.SubSectionType=se;const re=["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"];function ce(e,t,a,n){const i=e.reduce((e,t)=>{switch(t.$Type){case"com.sap.vocabularies.UI.v1.ReferenceFacet":e.push(t);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":if(t.Facets.find(e=>e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet")){e.splice(e.length,0,...t.Facets)}else{e.push(t)}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":break}return e},[]);return i.map(e=>pe(e,i,t,0,!e?.Facets?.length,a,n))}m.createSubSections=ce;function le(e){const t=w(e.getManifestWrapper().getHeaderFacets());const a=[];Object.keys(t).forEach(function(e){a.push(t[e]);return a});const n=a.reduce((e,t)=>{if(t.templateEdit){e.push(t)}return e},[]);return n.map(e=>ue(e))}m.createCustomHeaderFacetSubSections=le;function ue(e){const t=U(e.key);const a={id:t,key:e.key,title:e.title,type:se.XMLFragment,template:e.templateEdit||"",visible:e.visible,level:1,sideContent:undefined,stashed:e.stashed,flexSettings:e.flexSettings,actions:{},objectPageLazyLoaderEnabled:false};return a}const de=(e,t)=>e.ID?.toString()||e.Label?.toString()||t;function fe(e,t,a){for(let t=e.length-1;t>=0;t--){if(e[t].id?.startsWith("CustomAction::")&&(e[t].key.startsWith("DataFieldForAction::")||e[t].key.startsWith("DataFieldForIntentBasedNavigation::"))){e.splice(t,1)}}const n=I(t,a)||[],i={enabled:D.overwrite,visible:D.overwrite,command:D.overwrite,position:D.overwrite,menu:D.overwrite},o=F(t,a),s=G(o,a,e,undefined,undefined,n),r=_(e),c=j(r,s.actions),l=C(r,c,i);for(let t=e.length-1;t>=0;t--){if(e[t].id?.startsWith("CustomAction::")){for(const a in s.actions){if(a===e[t].key){e.splice(t,1);break}}}}let u=C(e,s.actions,i);R(u,l);u=x(u);u=z(u);u.forEach(e=>{if(e.type===L.Menu&&!!e.defaultAction){e.defaultAction.type=L.Default}});return{actions:u??e,commandActions:s.commandActions}}function ve(e,t){let a=[];switch(e.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":a=e.Facets.filter(e=>p(e)).reduce((e,a)=>be(e,a,t),[]);break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":a=be([],e,t);break;default:break}return fe(a,e,t)}function me(e){const t=ne(te(e),true);return ie(ee(t,W.Ghost,W.Transparent))}function pe(t,a,n,i,o,s,r){const c=h(t);const l=t.annotations?.UI?.Hidden;const u=Y(ne(true,te(l)));const d=!Z(u)&&!k(l);const f=t.Label!==undefined?ie(te(t.Label)):undefined;const v={id:c,key:de(t,c),title:f,type:se.Unknown,annotationPath:n.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),visible:ie(u),isVisibilityDynamic:d,level:i,sideContent:undefined,objectPageLazyLoaderEnabled:n.getManifestWrapper().getEnableLazyLoading()};if(s){v.stashed=O(t,t,n);v.flexSettings={designtime:$(t,t,n)}}let m="";i++;switch(t.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":const c=t.Facets;const l=c.map((e,t)=>({index:t,facet:e})).filter(e=>{let{facet:t}=e;return p(t)&&t.Target.$target&&re.includes(t.Target.$target.term)});const I=c.filter(e=>!l.find(t=>t.facet===e));if(l.length>0){const a=[];const r=[];const c=[];for(const{facet:e}of l){a.push(pe(e,[],n,i,true,s))}if(I.length>0){e.warning(`Warning: CollectionFacet '${t.ID}' includes a combination of either a chart or a table and other content. This can lead to rendering issues. Consider moving the chart or table into a separate CollectionFacet.`);const a={...t};a.Facets=I;r.push(pe(a,[],n,i,o,s))}if(l.find(e=>{let{index:t}=e;return t===0})){c.push(...a);c.push(...r)}else{c.push(...r);c.push(...a)}const u={...v,type:se.Mixed,level:i,content:c};return u}else{const e=ve(t,n),a={...v,type:se.Form,formDefinition:g(t,ie(u),n,e.actions,{useSingleTextAreaFieldAsNotes:r}),level:i,actions:e.actions.filter(e=>e.facetName===undefined),commandActions:e.commandActions};return a}case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!t.Target.$target){m=`Unable to find annotationPath ${t.Target.value}`}else{switch(t.Target.$target.term){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.PresentationVariant":case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":const e=b(t.Target.value,n,{isCondensedTableLayoutCompliant:Ae(t,a,n),doNotCheckApplySupported:s,shouldCreateTemplateChartVisualization:true});const c=v.title?v.title:"";const l=e.visualizations[0]?.annotation?.title||e.visualizations[0]?.title;const p=t.annotations?.UI?.PartOfPreview?.valueOf()!==false;const I=ge(l??"",c,o);const F=ee(d,oe(u,Y(ne(f,"undefined")),I),oe(ie(u)!==undefined,f!=="undefined",f!==undefined,u,I));const h={...v,type:se.DataVisualization,level:i,presentation:e,isPartOfPreview:p,showSubSectionTitle:ie(I),dataVisualizationTitleVisible:ie(F)};return h;case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.DataPoint":case"com.sap.vocabularies.UI.v1.StatusInfo":case"com.sap.vocabularies.Communication.v1.Contact":const y=ve(t,n),A={...v,type:se.Form,level:i,formDefinition:g(t,ie(u),n,y.actions,{useSingleTextAreaFieldAsNotes:r}),actions:y.actions.filter(e=>e.facetName===undefined),commandActions:y.commandActions};return A;case"com.sap.vocabularies.UI.v1.Note":return{...v,type:se.Notes};default:m=`For ${t.Target.$target.term} Fragment`;break}}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":m="For Reference URL Facet";break;default:break}const I={...v,type:se.Unknown,text:m};return I}m.createSubSection=pe;function ge(e,t,a){return Q(Y(a),J(q(e),q(t)))}m.getShowSubSectionTitle=ge;function be(e,t,a){const n=t.Target.$target;const i=t.Target.value;let o={};let s=[];let r;[r]=i.split("@");if(r.length>0){if(r.lastIndexOf("/")===r.length-1){r=r.substring(0,r.length-1)}}else{r=undefined}if(n){switch(n.term){case"com.sap.vocabularies.UI.v1.FieldGroup":s=n.Data;o=G(a.getManifestControlConfiguration(n).actions,a,[],undefined,undefined,undefined,t.fullyQualifiedName).actions;break;case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.StatusInfo":if(n.qualifier){s=n}break;default:break}e=s.reduce((e,i)=>{switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":if(i.RequiresContext?.valueOf()===true){a.getDiagnostics().addIssue(P.Annotation,N.Low,E.MALFORMED_DATAFIELD_FOR_IBN.REQUIRESCONTEXT)}if(i.Inline?.valueOf()===true){a.getDiagnostics().addIssue(P.Annotation,N.Low,E.MALFORMED_DATAFIELD_FOR_IBN.INLINE)}if(i.Determining?.valueOf()===true){a.getDiagnostics().addIssue(P.Annotation,N.Low,E.MALFORMED_DATAFIELD_FOR_IBN.DETERMINING)}const o={};if(i.Mapping){o.semanticObjectMapping=H(i.Mapping)}e.push({type:L.DataFieldForIntentBasedNavigation,id:A(t,i),key:M.generateKeyFromDataField(i),text:i.Label?.toString(),annotationPath:"",enabled:i.NavigationAvailable!==undefined?ie(ne(te(i.NavigationAvailable),true)):"true",visible:ie(Y(ne(te(i.annotations?.UI?.Hidden),true))),buttonType:me(i.annotations?.UI?.Emphasized),press:ie(ae("._intentBasedNavigation.navigate",[te(i.SemanticObject),te(i.Action),o])),customData:ie({semanticObject:te(i.SemanticObject),action:te(i.Action)})});break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":const s=a.getManifestControlConfiguration(n).actions;e.push(Ie(i,t,a,s,r));break;case"com.sap.vocabularies.UI.v1.DataFieldForActionGroup":e.push({type:L.Menu,text:i.Label?.toString(),key:M.generateKeyFromDataField(i),id:A(t,i),visible:ie(Y(ne(te(i.annotations?.UI?.Hidden),true))),menu:i.Actions.map(e=>{const i=a.getManifestControlConfiguration(n).actions;return Ie(e,t,a,i,r)})});break;default:break}return e},e)}return C(e,o)}function Ie(e,t,a,n,i){const o=M.generateKeyFromDataField(e);return{type:L.DataFieldForAction,id:A(t,e),key:M.generateKeyFromDataField(e),text:e.Label?.toString(),annotationPath:"",enabled:B(a,e.ActionTarget),binding:i?`{ 'path' : '${i}'}`:undefined,visible:ie(Y(ne(te(e.annotations?.UI?.Hidden),true))),requiresDialog:T(e),buttonType:me(e.annotations?.UI?.Emphasized),press:ie(ae("invokeAction",[e.Action,{contexts:ae("getBindingContext",[],X("","$source")),invocationGrouping:e.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",label:e.Label?.toString(),model:ae("getModel",[],X("/","$source")),isNavigable:V(n&&n[o])}],K(".editFlow"))),facetName:e.Inline?t.fullyQualifiedName:undefined}}function Fe(e){if(e){const t=e.annotations?.Common?.IsActionCritical;if(e.parameters.length>1||t){return"Dialog"}else{return"None"}}else{return"None"}}m.isDialog=Fe;function he(e,t){const a={};Object.keys(e).forEach(n=>a[n]=ye(e[n],n,t));return a}m.createCustomSubSections=he;function ye(e,t,a){const n=e.sideContent?{template:e.sideContent.template,id:y(t),visible:false,equalSplit:e.sideContent.equalSplit}:undefined;let i=e.position;if(!i){i={placement:S.After}}const o=e.visible!==undefined?e.visible:true;const s=o&&typeof o==="string"&&o.indexOf("{=")===0;const r=G(e.actions,a);const c={type:se.Unknown,id:e.id||U(t),actions:r.actions,key:t,title:e.title,level:1,position:i,visible:e.visible!==undefined?e.visible:"true",sideContent:n,isVisibilityDynamic:s,objectPageLazyLoaderEnabled:e.enableLazyLoading??false,componentName:"",settings:""};if(e.template||e.name){c.type=se.XMLFragment;c.template=e.template||e.name||""}else if(e.embeddedComponent!==undefined){c.type=se.EmbeddedComponent;c.componentName=e.embeddedComponent.name;if(e.embeddedComponent.settings!==undefined){c.settings=JSON.stringify(e.embeddedComponent.settings)}}else{c.type=se.Placeholder}return c}m.createCustomSubSection=ye;function Ae(e,t,a){const n=a.getManifestWrapper();if(n.useIconTabBar()){return Ue(e,t)}else{const n=a.getEntityType();if(n.annotations?.UI?.Facets?.length&&n.annotations?.UI?.Facets?.length>1){return Ue(e,t)}else{return true}}}function Ue(e,t){return t.every(function(t){if(t!==e){if(t.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){const e=t;if(e.Target?.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"||e.Target?.$target?.term==="com.sap.vocabularies.UI.v1.PresentationVariant"||e.Target.$target?.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return e.annotations?.UI?.Hidden!==undefined?e.annotations?.UI?.Hidden:false}return true}else{const e=t;return e.Facets.every(function(e){const t=e;if(t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.LineItem"||t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.PresentationVariant"||t.Target?.$target?.term==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){return t.annotations?.UI?.Hidden!==undefined?t.annotations?.UI?.Hidden:false}return true})}}return true})}return m},false);
//# sourceMappingURL=SubSection.js.map