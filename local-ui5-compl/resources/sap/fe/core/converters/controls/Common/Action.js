/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/ManifestSettings","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/ID","sap/fe/core/formatters/FPMFormatter","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/UIFormatters"],function(e,t,n,i,o,a,r,s){"use strict";var l={};var c=s.getActionEnabledExpression;var u=r.replaceSpecialChars;var f=o.getCustomActionID;var d=i.Placement;var p=n.ActionType;var b=t.resolveBindingString;var v=t.pathInModel;var m=t.or;var h=t.isConstant;var g=t.ifElse;var y=t.greaterOrEqual;var A=t.formatResult;var M=t.equal;var S=t.constant;var E=t.compileExpression;var C=t.and;let x=function(e){e["Accept"]="Accept";e["Attention"]="Attention";e["Back"]="Back";e["Critical"]="Critical";e["Default"]="Default";e["Emphasized"]="Emphasized";e["Ghost"]="Ghost";e["Negative"]="Negative";e["Neutral"]="Neutral";e["Reject"]="Reject";e["Success"]="Success";e["Transparent"]="Transparent";e["Unstyled"]="Unstyled";e["Up"]="Up";return e}({});l.ButtonType=x;const O=e=>{let t,n,i,o;e.forEach(e=>{t=e.visible?.valueOf()==="false";i=false;o=[];n=[];if(e.visible&&!(e.visible.valueOf()==="true"||e.visible.valueOf()==="false")){n.push(e.visible)}if(e?.menu?.length){e?.menu?.forEach(e=>{const t=e.visible;if(t&&(typeof t==="boolean"||t.valueOf()==="true")){i=true}else if(t&&t.valueOf()!=="false"){o.push(t.valueOf())}});if(t){e.visible=false.toString()}else if(!i&&!o.length){e.visible=false.toString()}else if(i&&!n.length){e.visible=true.toString()}else if(n.length||o.length){const t=o.map(e=>b(e,"boolean"));e.visible=E(C(b(e.visible||true,"boolean"),m(...t)))}else{e.visible=(!t).toString()}}});return e};l.getVisibilityEnablementMenuActions=O;function k(e,t,n){const i=t.find(e=>e.key===n);const o=e[n];let a={...i??o};if(Object.keys(a).length===0){t.filter(e=>e.type===p.Menu).forEach(e=>{e.menu?.forEach(e=>{if(e.key===n){a=e}})})}if(i){a.enabled=o?.enabled??i.enabled;a.visible=o?.visible??i.visible;for(const e in o||{}){const t=e;if(!i[t]&&t!=="menu"){a[t]=o[t]}}}const r=a?.visible||a?.type===p.DataFieldForAction||a?.type===p.DataFieldForIntentBasedNavigation;return{action:a,canBeMenuItem:r}}function F(e,t,n,i){const{action:o,canBeMenuItem:a}=k(t,n,e.defaultAction);if(a){e.defaultAction=o}if(o.command){i[o.key]=o}}function I(e,t,n,i){const o=[];const a=n.find(t=>t.key===e.key);if(e.menu?.length!==0){for(const a of e.menu??[]){const{action:e,canBeMenuItem:r}=k(t,n,a);if(r){o.push(e)}if(e.command){i[a]=e}}}else if(a){a.menu?.forEach(e=>o.push(e))}const r=e;r.menu=o;const s=o.map(e=>b(e.visible,"boolean"));r.visible=E(C(b(e.visible,"boolean"),m(...s)))}function P(e,t){const n={};const i=[];const o={};for(const a in e){const r=e[a];if(r.defaultAction!==undefined){F(r,e,t,o)}if(r.type===p.Menu){I(r,e,t,o);if(!r.menu?.length){i.push(r.key)}}if(r.command){o[a]=r}n[a]=r}i.forEach(e=>delete n[e]);return{actions:n,commandActions:o}}const D=function(e,t,n){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(t&&e.enabled===undefined){return undefined}const o=j(e.enabled,n);const a=!i?"numberOfSelectedContexts":"contextmenu/numberOfSelectedContexts";return E(g(e.requiresSelection===true,g(e.enableOnSelect==="single",C(M(v(a,"internal"),1),o),C(y(v(a,"internal"),1),o)),o))};const T=function(e,t,n){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(t&&e.visible===undefined){return undefined}let o=j(e.visible,n);o=i?C(o,M(v("contextmenu/inactiveContext","internal"),false)):o;return E(o)};function B(e,t){if(!t){return}e.type=t.type;e.annotationPath=t.annotationPath;e.press=t.press;e.enabled=e.enabled??t.enabled;e.visible=e.visible??t.visible;e.visibleForContextMenu=e.visibleForContextMenu??t.visibleForContextMenu}function N(e,t,n,i,o,a,r){const s={};for(const a in e){const l=e[a];const c=l.press?.lastIndexOf(".")||-1;let b;if(n){for(const e of n){if(e.id?.startsWith("CustomAction::")){continue}if(e.key===a){b=e;break}else if(e.type==="Menu"){b=e.menu?.find(e=>e.key===a);if(b){break}}}}const v=!!b;if(l.facetName){r=l.facetName}s[a]={id:b?a:f(a),type:l.menu?p.Menu:p.Default,visible:T(l,v,t),visibleForContextMenu:T(l,v,t,true),enabled:D(l,v,t),enabledForContextMenu:D(l,v,t,true),handlerModule:l.press&&l.press.substring(0,c).replace(/\./gi,"/"),handlerMethod:l.press&&l.press.substring(c+1),press:l.press,text:l.text,noWrap:l.__noWrap,key:u(a),enableOnSelect:l.enableOnSelect,defaultValuesExtensionFunction:l.defaultValuesFunction,position:{anchor:l.position?.anchor,placement:l.position===undefined?d.After:l.position.placement},isNavigable:L(l,i,o),command:l.command,requiresSelection:l.requiresSelection===undefined?false:l.requiresSelection,enableAutoScroll:R(l),menu:l.menu??(b?.type===p.Menu?[]:undefined),facetName:l.inline?r:undefined,defaultAction:l.defaultAction};B(s[a],b)}return P(s,n??[])}l.getActionsFromManifest=N;function j(e,t){const n=b(e,"boolean");let i;if(h(n)&&n.value===undefined){i=S(true)}else if(h(n)&&typeof n.value==="string"){const e=n.value;i=A([v("/","$view"),e,v("selectedContexts","internal")],a.customBooleanPropertyCheck,t.getDataModelObjectPath().contextLocation?.targetEntityType||t.getEntityType())}else{i=n}return i}const U=e=>{let t={};e.forEach(e=>{if(e?.menu?.length){const n=e.menu;t=n.reduce((e,t)=>{let{key:n}=t;if(n&&!e[n]){e[n]=true}return e},t)}});return e.filter(e=>!t[e.key])};l.removeDuplicateActions=U;function q(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(t?.annotations.Core?.OperationAvailable){const i=e.getDataModelObjectPath();const o=c(t,e.getConvertedTypes(),i,n);return E(o)}return"true"}l.getEnabledForAnnotationAction=q;function W(e){return e?e.map(e=>({LocalProperty:{$PropertyPath:e.LocalProperty.value},SemanticObjectProperty:e.SemanticObjectProperty.toString()})):[]}l.getSemanticObjectMapping=W;function L(e,t,n){let i=true;if(n){const e=t&&(t.detail||t.display);i=e?.route?true:false}if(e&&e.afterExecution&&(e.afterExecution?.navigateToInstance===false||e.afterExecution?.enableAutoScroll===true)||!i){return false}return true}l.isActionNavigable=L;function R(e){return e?.afterExecution?.enableAutoScroll===true}l.enableAutoScroll=R;function V(e){return e.annotations?.UI?.IsCopyAction?.valueOf()===true&&e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"}l.dataFieldIsCopyAction=V;function $(t){if(t.length===1){return t[0]}if(t.length>1){e.error("Multiple actions are annotated with isCopyAction. There can be only one standard copy action.")}return undefined}l.getCopyAction=$;function w(e){const t=[];e.forEach(e=>{if(e.type==="Menu"&&!e.id?.startsWith("CustomAction::")&&e.menu){t.push(...e.menu)}});return t}l.getAnnotationMenuActionItems=w;function z(e,t){const n={};for(const i in t){if(i.startsWith("DataFieldForAction::")&&e.find(e=>e.key===i)){n[i]=t[i]}}return n}l.getMatchingManifestAction=z;function G(e,t){let n;e.forEach(e=>{if(e.type===p.Menu){e.menu?.forEach((i,o)=>{n=t.find(e=>e.key===i.key);if(n){e.menu?.splice(o,1,n)}})}})}l.prepareMenuActions=G;return l},false);
//# sourceMappingURL=Action.js.map