/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/annotations/DataField","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","../../../helpers/StableIdHelper","../../ManifestSettings","../../helpers/ConfigurableObject","../../helpers/DataFieldHelper","../../helpers/ID","../../helpers/Key"],function(e,t,a,n,o,i,r,s,l,c){"use strict";var f={};var u=c.KeyHelper;var p=l.getFormStandardActionButtonID;var v=l.getFormID;var d=s.isReferencePropertyStaticallyHidden;var m=r.insertCustomElements;var y=r.Placement;var P=r.OverrideType;var h=i.ActionType;var g=o.createIdForAnnotation;var F=n.getTargetObjectPath;var O=n.getTargetEntitySetPath;var b=a.isSingleton;var T=a.isNavigationProperty;var A=t.getSemanticObjectPath;var I=e.pathInModel;var E=e.not;var D=e.ifElse;var C=e.getExpressionFromAnnotation;var S=e.equal;var N=e.compileExpression;let U=function(e){e["Default"]="Default";e["Slot"]="Slot";e["Annotation"]="Annotation";return e}({});f.FormElementType=U;function w(){return{textLinesEdit:4}}function M(e,t){return t?.valueOf()===false||e.annotations?.UI?.PartOfPreview===undefined||e.annotations?.UI?.PartOfPreview.valueOf()===true}function $(e,t){const a=[];const n=t.getEntityTypeAnnotation(e.Target.value);const o=n.annotation;t=n.converterContext;function i(e,n){const o=A(t,e);if(e.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&e.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&e.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"&&!d(e)){const i={key:u.generateKeyFromDataField(e),type:U.Annotation,annotationPath:`${t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName)}/`,semanticObjectPath:o,formatOptions:w(),isPartOfPreview:M(e,n)};if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$target?.$Type==="com.sap.vocabularies.UI.v1.ConnectedFieldsType"){const a=Object.values(e.Target.$target.Data).filter(e=>e?.hasOwnProperty("Value"));i.connectedFields=a.map(e=>({semanticObjectPath:A(t,e)}))}a.push(i)}}switch(o?.term){case"com.sap.vocabularies.UI.v1.FieldGroup":o.Data.forEach(t=>i(t,e.annotations?.UI?.PartOfPreview));break;case"com.sap.vocabularies.UI.v1.Identification":o.forEach(t=>i(t,e.annotations?.UI?.PartOfPreview));break;case"com.sap.vocabularies.UI.v1.DataPoint":a.push({key:`DataPoint::${o.qualifier?o.qualifier:""}`,type:U.Annotation,annotationPath:`${t.getEntitySetBasedAnnotationPath(o.fullyQualifiedName)}/`});break;case"com.sap.vocabularies.UI.v1.InputMask":a.push({key:`MaskedInput::${o.qualifier?o.qualifier:""}`,type:U.Annotation,annotationPath:`${t.getEntitySetBasedAnnotationPath(o.fullyQualifiedName)}/`});break;case"com.sap.vocabularies.Communication.v1.Contact":a.push({key:`Contact::${o.qualifier?o.qualifier:""}`,type:U.Annotation,annotationPath:`${t.getEntitySetBasedAnnotationPath(o.fullyQualifiedName)}/`});break;default:break}return a}function k(e,t){const a=t.getManifestWrapper();const n=a.getFormContainer(e.Target.value);const o={};if(n?.fields){Object.keys(n?.fields).forEach(e=>{o[e]={key:e,id:`CustomFormElement::${e}`,type:n.fields[e].type||U.Default,template:n.fields[e].template,propertyPath:n.fields[e]?.property,label:t.fetchTextFromMetaModel(n.fields[e].label),position:n.fields[e].position||{placement:y.After},formatOptions:{...w(),...n.fields[e].formatOptions}}})}return o}f.getFormElementsFromManifest=k;function x(e,t,a,n){const o=g(e);const i=t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName);const r=t.getEntityTypeAnnotation(e.Target.value);const s=N(E(S(true,C(e.annotations?.UI?.Hidden))));let l;const c=r.converterContext.getEntitySet();const f=r.converterContext.getDataModelObjectPath().targetObject;if(c&&c!==t.getEntitySet()){l=O(r.converterContext.getDataModelObjectPath())}else if(T(f)&&f?.containsTarget===true){l=F(r.converterContext.getDataModelObjectPath(),false)}else if(c&&!l&&b(c)){l=c.fullyQualifiedName}const u=m($(e,t),k(e,t),{formatOptions:P.overwrite});a=a!==undefined?a.filter(t=>t.facetName==e.fullyQualifiedName):[];if(a.length===0){a=undefined}const v={id:p(o,"ShowHideDetails"),key:"StandardAction::ShowHideDetails",text:N(D(S(I("showDetails","internal"),true),I("T_COMMON_OBJECT_PAGE_HIDE_FORM_CONTAINER_DETAILS","sap.fe.i18n"),I("T_COMMON_OBJECT_PAGE_SHOW_FORM_CONTAINER_DETAILS","sap.fe.i18n"))),type:h.ShowFormDetails,press:"FormContainerRuntime.toggleDetails"};if(e.annotations?.UI?.PartOfPreview?.valueOf()!==false&&u.some(e=>e.isPartOfPreview===false)){if(a!==undefined){a.push(v)}else{a=[v]}}return{id:o,formElements:u,annotationPath:i,isVisible:s,entitySet:l,actions:a,useSingleTextAreaFieldAsNotes:n?.useSingleTextAreaFieldAsNotes}}f.getFormContainer=x;function _(e,t,a,n){const o=[];const i={useSingleTextAreaFieldAsNotes:n?.useSingleTextAreaFieldAsNotes};e.Facets?.forEach(e=>{if(e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"){return}o.push(x(e,t,a,i))});return o}function j(e){return e.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"}f.isReferenceFacet=j;function R(e,t,a,n,o){switch(e?.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":return{id:v(e),useFormContainerLabels:true,hasFacetsNotPartOfPreview:e.Facets.some(e=>e.annotations?.UI?.PartOfPreview?.valueOf()===false),formContainers:_(e,a,n,o),isVisible:t};case"com.sap.vocabularies.UI.v1.ReferenceFacet":return{id:v(e),useFormContainerLabels:false,hasFacetsNotPartOfPreview:e.annotations?.UI?.PartOfPreview?.valueOf()===false,formContainers:[x(e,a,n,o)],isVisible:t};default:throw new Error("Cannot create form based on ReferenceURLFacet")}}f.createFormDefinition=R;return f},false);
//# sourceMappingURL=Form.js.map