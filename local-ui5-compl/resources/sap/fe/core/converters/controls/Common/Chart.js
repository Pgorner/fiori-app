/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BindingToolkit","sap/fe/core/converters/annotations/DataField","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/StableIdHelper","sap/fe/core/templating/DataModelPathHelper","sap/ui/core/Lib","../../ManifestSettings","../../helpers/Aggregation","../../helpers/ID","../../helpers/InsightsHelpers"],function(t,e,a,n,o,i,r,s,l,g,p,c,u){"use strict";var d={};var f=u.getInsightsVisibility;var y=u.getInsightsEnablement;var m=c.getFilterBarID;var h=c.getChartID;var b=p.AggregationHelper;var P=g.VisualizationType;var A=g.VariantManagementType;var v=g.TemplateType;var T=g.ActionType;var C=s.getTargetObjectPath;var S=r.generate;var D=i.KeyHelper;var F=o.insertCustomElements;var E=o.OverrideType;var I=n.getActionsFromManifest;var M=a.isDataFieldForActionAbstract;var O=e.not;var N=e.getExpressionFromAnnotation;var w=e.equal;var V=e.compileExpression;var B=e.and;function z(t,e,a){const n=[];if(t?.Actions){t.Actions.forEach(t=>{const e=D.generateKeyFromDataField(t);if(M(t)&&!t.Inline&&!t.Determining){switch(t.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForAction":if(t.ActionTarget&&!t.ActionTarget.isBound){n.push({type:T.DataFieldForAction,annotationPath:a.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:e,visible:R(t,a)})}break;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":n.push({type:T.DataFieldForIntentBasedNavigation,annotationPath:a.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:e,visible:R(t,a),isNavigable:true});break}}if($(t)){n.push({type:T.Menu,text:t.Label?.toString(),visible:R(t,a),menu:t.Actions.map(t=>L(t,a)),key:D.generateKeyFromDataField(t)})}})}return n}function $(t){return t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"}function L(t,e){return{type:T.DataFieldForAction,annotationPath:e.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),key:D.generateKeyFromDataField(t),visible:R(t,e)}}function j(t,e,a){const n=z(t,e,a);const o=I(a.getManifestControlConfiguration(e).actions,a,n);const i={enabled:E.overwrite,enableOnSelect:E.overwrite,visible:E.overwrite,command:E.overwrite,position:E.overwrite};const r=F(n,o.actions,i);return{actions:r,commandActions:o.commandActions}}d.getChartActions=j;function G(t,e){const a=e.getManifestWrapper();const n=e.getManifestControlConfiguration(t);const o=a.getVariantManagement();const i=[];const r=n?.chartSettings?.personalization;const s=o===A.Control?true:false;if(r!==undefined&&!r||r=="false"){return undefined}if(typeof r==="object"){if(r.type){i.push("Type")}if(r.item){i.push("Item")}if(r.sort){i.push("Sort")}if(r.filter){i.push("Filter")}return i.join(",")}else if(s||!!r){return"Sort,Type,Item,Filter"}else{return"Sort,Type,Item"}}d.getP13nMode=G;function k(t){let e;if(t?.Property){e={Property:{$PropertyPath:t?.Property?.value}}}else{e={Property:{$PropertyPath:t?.name}}}return e}function x(e,a,n,o,i){const r=new b(n.getEntityType(),n,true);if(!o&&!r.isAnalyticsSupported()){throw new Error("ApplySupported is not added to the annotations")}const s=r.getTransAggregations();const g=r.getCustomAggregateDefinitions();const p=n.getManifestWrapper();const c=p.getVariantManagement();const u=G(a,n);if(u===undefined&&c==="Control"){t.warning("Variant Management cannot be enabled when personalization is disabled")}const d={};if(g){const t=r.getEntityType();for(const e of g){const a=e?.annotations?.Aggregation?.ContextDefiningProperties;const n=e?.qualifier;const o=n&&t.entityProperties.find(t=>t.name===n);const i=o&&o?.annotations?.Common?.Label?.toString();d[n]={name:n,label:i||`Custom Aggregate (${n})`,sortable:true,sortOrder:"both",contextDefiningProperty:a?a.map(t=>t.value):[]}}}const A={};const T=l.getResourceBundleFor("sap.fe.core");if(s){for(const t of s){A[t.Name]={name:t.Name,propertyPath:t.AggregatableProperty.value,aggregationMethod:t.AggregationMethod,label:t?.annotations?.Common?.Label?t?.annotations?.Common?.Label?.toString():`${T.getText("AGGREGATABLE_PROPERTY")} (${t.Name})`,sortable:true,sortOrder:"both",custom:false}}}const D=r.getAggregatableProperties();const F=r.getGroupableProperties();const E={};E.$Type="Org.OData.Aggregation.V1.ApplySupportedType";E.AggregatableProperties=[];E.GroupableProperties=[];if(D){E.AggregatableProperties=D.map(t=>k(t))}if(F){E.GroupableProperties=F.map(t=>({["$PropertyPath"]:t.value}))}const I=j(e,a,n);let[M]=a.split("@");if(M.lastIndexOf("/")===M.length-1){M=M.substring(0,M.length-1)}const O=e.Title?.toString()||"";const N=n.getDataModelObjectPath();const w=M.length===0;const V=N.targetEntitySet?N.targetEntitySet.name:N.startingEntitySet.name;const z=w?m(n.getContextPath()):undefined;const $={plotArea:{window:{start:"firstDataPoint",end:"lastDataPoint"}},legendGroup:{layout:{position:"bottom"}}};let L;if(n.getTemplateType()===v.ObjectPage){L=true}else if(n.getTemplateType()===v.ListReport||n.getTemplateType()===v.AnalyticalListPage){L=false}const x=n.getManifestWrapper().hasMultipleVisualizations()||n.getTemplateType()===v.AnalyticalListPage;const H=x?".handlers.onSegmentedButtonPressed":"";const R=x?"{= ${pageInternal>alpContentView} !== 'Table'}":"true";const K=r.getAllowedTransformations();E.enableSearch=K?K.includes("search"):true;let U="";if(e.fullyQualifiedName.split("#").length>1){U=e.fullyQualifiedName.split("#")[1]}const W=f("Analytical",n,a);const q=n.getParameterEntityType()?true:false;const J=B(y(),W);return{type:P.Chart,id:U?h(w?V:M,U,P.Chart):h(w?V:M,P.Chart),collection:C(n.getDataModelObjectPath()),apiId:S([U?h(w?V:M,U,P.Chart):h(w?V:M,P.Chart),"Chart"]),entityName:V,personalization:G(a,n),navigationPath:M,annotationPath:n.getAbsoluteAnnotationPath(a),filterId:z,vizProperties:JSON.stringify($),actions:I.actions,commandActions:I.commandActions,title:O,autoBindOnInit:L,onSegmentedButtonPressed:H,visible:R,customAgg:d,transAgg:A,applySupported:E,selectionPresentationVariantPath:i,variantManagement:Q(u,c),isInsightsEnabled:J,isInsightsVisible:W,isParameterizedEntitySet:q}}d.createChartVisualization=x;function Q(t,e){return e==="Control"&&!t?A.None:e}function H(t,e,a){const n=a.fullyQualifiedName.split("#").length>1?a.fullyQualifiedName.split("#")[1]:"";const[o]=e.split("@");const i=t.getDataModelObjectPath();const r=o.length===0;const s=i.targetEntitySet?.name??i.startingEntitySet.name;const l=new b(t.getEntityType(),t,true);const g=l.getAllowedTransformations();const p=!!t.getParameterEntityType();return{annotationPath:t.getAbsoluteAnnotationPath(e),isParameterizedEntitySet:p,collection:C(t.getDataModelObjectPath()),type:P.Chart,entityName:s,id:n?h(r?s:o,n,P.Chart):h(r?s:o,P.Chart),apiId:S([n?h(r?s:o,n,P.Chart):h(r?s:o,P.Chart),"Chart"]),applySupported:{$Type:"Org.OData.Aggregation.V1.ApplySupportedType",enableSearch:g?.includes("search")??true}}}d.createChartVisualizationForTemplating=H;function R(t,e){return V(O(w(N(t.annotations?.UI?.Hidden,[],undefined,e.getRelativeModelPathFunction()),true)))}function K(t){const e=t.getManifestWrapper().hasMultipleVisualizations()||t.getTemplateType()===v.AnalyticalListPage;const a=t.getDataModelObjectPath();const n=a.targetEntitySet?a.targetEntitySet.name:a.startingEntitySet.name;const o={type:P.Chart,id:h(n,P.Chart),apiId:S([h(n,P.Chart),"Chart"]),entityName:n,title:"",collection:"",personalization:undefined,navigationPath:"",annotationPath:"",vizProperties:JSON.stringify({legendGroup:{layout:{position:"bottom"}}}),actions:[],commandActions:{},autoBindOnInit:false,onSegmentedButtonPressed:"",visible:e?"{= ${pageInternal>alpContentView} !== 'Table'}":"true",customAgg:{},transAgg:{},applySupported:{$Type:"Org.OData.Aggregation.V1.ApplySupportedType",AggregatableProperties:[],GroupableProperties:[],enableSearch:false},multiViews:false,variantManagement:A.None};return o}d.createBlankChartVisualization=K;return d},false);
//# sourceMappingURL=Chart.js.map