{"version":3,"file":"Table.js","names":["ColumnType","getTableActions","lineItemAnnotation","visualizationPath","converterContext","standardActions","navigationSettings","tableActions","getTableAnnotationActions","manifestActions","getActionsFromManifest","getManifestControlConfiguration","actions","copyActions","filter","a","type","ActionType","Copy","annotationActions","annotationAndStandardActions","create","delete","massEdit","insights","creationRow","cut","paste","moveUp","moveDown","action","undefined","manifestAction","Object","values","Default","Menu","position","anchor","StandardActionKeys","Create","placement","Placement","Before","manifestActionEntries","entries","standardManifestActions","fromEntries","_ref","key","startsWith","nonStandardManifestActions","_ref2","actionOverwriteConfig","isNavigable","OverrideType","overwrite","enableOnSelect","enableAutoScroll","enabled","visible","visibleForContextMenu","defaultValuesExtensionFunction","command","menu","annotationMenuActionItems","getAnnotationMenuActionItems","matchingManifestActions","getMatchingManifestAction","overwrittenMenuActionItems","insertCustomElements","prepareMenuActions","removeDuplicateActions","getVisibilityEnablementMenuActions","commandActions","_exports","getTableColumns","annotationColumns","getColumnsFromAnnotations","manifestColumns","getColumnsFromManifest","columns","getAnnotationEntityType","tableColumns","width","widthIncludingColumnHeader","importance","horizontalAlign","availability","settings","formatOptions","exportSettings","addComputedColumns","getContextDefiningPropertiesFromAggregationAnnotation","aggregationHelper","customAggregateAnnotations","getCustomAggregateDefinitions","customAggregatedefinitions","forEach","annotation","aggregatedProperty","_entityType","entityProperties","find","property","name","qualifier","contextDefiningProperties","annotations","Aggregation","ContextDefiningProperties","map","ctxDefProperty","value","getExtensionInfoFromEntityType","entityType","AggregationHelper","isAnalyticsSupported","currencyOrUnitProperties","Set","column","tableColumn","unit","targetUnitProperty","prop","add","relativePath","contextDefiningPropertiesFromAggregation","result","propertyInfos","rawContextDefiningProperties","fromGroupableProperty","isPropertyGroupable","has","contextDefiningPropertyName","foundColumn","findColumnByPath","push","length","additionalProperties","updateTableVisualizationForType","tableVisualization","presentationVariantAnnotation","control","aggregationData","enableAnalytics","enable$select","enable$$getKeepAliveContext","analyticsExtensions","_updatePropertyInfosWithAggregatesDefinitions","allowedTransformations","getAllowedTransformations","enableBasicSearch","includes","groupConditions","getGroupConditions","aggregateConditions","getAggregateConditions","ModelHelper","isObjectPathDraftSupported","getDataModelObjectPath","requestAtLeast","isDraftRoot","getEntitySet","Log","error","changeSiblingForRootsSupported","Hierarchy","hierarchyQualifier","ChangeSiblingForRootsSupported","allowDropBetweenNodes","ChangeNextSiblingAction","enableUploadPlugin","streamProperty","UI","MediaResource","Stream","$target","uploadAction","uploadTable","stream","fileName","Core","ContentDisposition","Filename","path","fileNameMaxLength","maxLength","acceptableMediaTypes","AcceptableMediaTypes","createRequestedProperties","lineItem","operationAvailable","selectedFields","pushField","field","indexOf","pushFieldList","fields","operationAvailableProperties","split","validProperties","propName","resolvePath","semanticKeys","Common","SemanticKey","semanticKey","capabilitiesAnnotation","Capabilities","alternateAndSecondaryKeys","getAlternateAndSecondaryKeys","RequestAtLeast","propertyPath","getNavigationAvailableFieldsFromLineItem","DeleteRestrictions","Deletable","UpdateRestrictions","Updatable","record","$Type","Inline","Determining","isPathAnnotationExpression","NavigationAvailable","getNavigationTargetPath","navigationPropertyPath","manifestWrapper","getManifestWrapper","getNavigationConfiguration","navConfig","keys","dataModelPath","contextPath","getContextPath","navConfigForContextPath","targetEntitySet","startingEntitySet","annotationColumn","updateLinkedProperties","dataModelObjectPath","getConverterContextFor","oColumn","propertyDataModelObjectPath","enhanceDataModelPath","targetObject","addCurrencyOrUoMToProperty","timezoneProperty","getAssociatedTimezoneProperty","timezone","Timezone","oTimezoneColumn","timezoneText","toString","displayMode","getDisplayMode","textAnnotation","Text","textColumn","textArrangement","textProperty","mode","currencyOrUoMProperty","getAssociatedCurrencyPropertyPath","getAssociatedUnitPropertyPath","currencyOrUoMPropertyDataModelObjectPath","currencyOrUoMRelativePath","getContextRelativeTargetObjectPath","unitColumn","Measures","ISOCurrency","Unit","unitText","getSemanticKeysAndTitleInfo","headerInfoTitlePath","HeaderInfo","Title","Value","semanticKeyAnnotations","headerInfoTypeName","TypeName","semanticKeyColumns","createTableVisualization","params","isCondensedTableLayoutCompliant","selectionVariantAnnotation","tableManifestConfig","getTableManifestConfiguration","splitPath","navigationTargetPath","operationAvailableMap","getOperationAvailableMap","semanticKeysAndHeaderInfoTitle","standardActionsConfiguration","getStandardActionsConfiguration","tableAnnotation","getTableAnnotationConfiguration","getOperationAvailableProperties","header","title","oVisualization","VisualizationType","Table","JSON","stringify","headerInfoTitle","headerVisible","handlePatchSent","getTemplateType","TemplateType","ListReport","createDefaultTableVisualization","isBlankTable","getColumnsFromEntityType","getEntityType","creationMode","ActionHelper","getCurrentEntitySetUpdatablePath","restrictions","getRestrictions","entitySet","updatable","isUpdatable","isOnlyDynamicOnCurrentEntity","isConstant","expression","navigationExpression","_type","updatableExpression","updatablePropertyPath","properties","actionName","propertyName","size","titleProperty","Array","from","join","getUIHiddenExpForActionsRequiringContext","currentEntityType","contextDataModelObjectPath","aUiHiddenPathExpressions","dataField","ActionTarget","isBound","sourceEntityType","RequiresContext","valueOf","Hidden","equal","getHiddenExpressionAtTableLevel","getPathFromActionAnnotation","source","constant","substring","splitPathForNavigationProperty","navigationPath","isNavigationProperty","partner","pathInModel","slice","updateManifestActionAndTagIt","dataFieldId","some","actionKey","requiresSelection","hasBoundActionsAlwaysVisibleInToolBar","manifestActionId","generate","Action","SemanticObject","hasCustomActionsAlwaysVisibleInToolBar","customActions","reduce","menuAction","getVisibleExpForCustomActionsRequiringContext","aVisiblePathExpressions","resolveBindingString","getCapabilityRestriction","isDeletable","isPathDeletable","isPathUpdatable","getSelectionMode","isEntitySet","targetCapabilities","deleteButtonVisibilityExpression","massEditVisibilityExpression","arguments","cutButtonVisibilityExpression","tableManifestSettings","tableType","tableSettings","selectionMode","SelectionMode","Multi","None","compileExpression","ifElse","ForceMulti","ForceSingle","Single","aHiddenBindingExpressions","aVisibleBindingExpressions","isParentDeletable","parentEntitySetDeletable","ObjectPage","bMassEditEnabled","Auto","buttonVisibilityExpression","or","and","IsEditable","editModebuttonVisibilityExpression","concat","copyDataField","getCopyAction","dataFieldIsCopyAction","annotationPath","getEntitySetBasedAnnotationPath","fullyQualifiedName","KeyHelper","generateKeyFromDataField","visibleExpression","visibleForContextMenuExpression","text","Label","Library","getResourceBundleFor","getText","isDataFieldForActionAbstract","tableAction","getDataFieldAnnotationAction","isDataFieldForActionGroup","dataFieldGroup","DataFieldForAction","sEntityType","_useEnabledExpression","getEnabledForAnnotationAction","DataFieldForIntentBasedNavigation","id","Actions","getHighlightRowBinding","criticalityAnnotation","isDraftRootOrNode","targetEntityType","defaultHighlightRowDefinition","MessageType","getExpressionFromAnnotation","getMessageTypeFromCriticalityType","formatResult","Entity","HasActive","IsActive","IsInactive","tableFormatters","rowHighlighting","_getCreationBehaviour","tableManifestConfiguration","navigation","detail","originalTableSettings","outbound","outboundDetail","CreationMode","NewPage","External","CreationDialog","warning","newAction","targetAnnotations","targetAnnotationsCommon","targetAnnotationsSession","Session","DraftRoot","NewAction","StickySessionSupported","CreationRow","Error","route","append","createAtEnd","navigateToTarget","info","_getRowConfigurationProperty","targetPath","navigationInfo","criticalityProperty","Criticality","navigationTarget","display","target","getDraftRoot","getDraftNode","checkEditable","routePath","recreateContext","rowNavigatedExpression","navigatedRow","rowNavigated","rowCriticalityForInsights","criticalityExpressionForIntegrationCards","not","columnsToBeCreated","tableCreationMode","displayModeOfDescriptionPropertiesMap","restrictionsOnProperties","propertiesNotToBeConsidered","groupableProperties","getGroupableProperties","getAssociatedTextProperty","textProp","exists","targetType","relatedPropertiesInfo","collectRelatedProperties","relatedPropertyNames","additionalPropertyNames","addPropertyToDisplayModeOfDescriptionPropertiesMap","columnInfo","getColumnDefinitionFromProperty","dataPointTargetValue","exportDataPointTargetValue","annotationProperty","updatePropertyLabel","additionalPropertyInfos","additionalPropertyName","nonSortableProperties","relatedColumns","_createRelatedColumns","fullPropertyPath","useDataFieldPrefix","availableForAdaptation","relativePathForMultiValue","semanticObjectAnnotationPath","getSemanticObjectPath","isHidden","isReferencePropertyStaticallyHidden","groupPath","_sliceAtSlash","isGroup","label","getLabel","dataType","getDataFieldDataType","propertyTypeConfig","getTypeConfig","isAPropertyFromTextOnlyAnnotation","sortable","filterable","nonFilterableProperties","typeConfig","className","constraints","_isExportableColumn","createColumnExportSettings","collectedNavigationPropertyLabels","_getCollectedNavigationPropertyLabels","replaceSpecialChars","Annotation","groupLabel","group","semanticObjectPath","isGroupable","isKey","caseSensitive","isFilteringCaseSensitive","getImportance","DataFieldDefault","required","isRequiredColumn","additionalLabels","_addToolTip","_setExportSettingsForDataPoint","enhancedColumn","extension","technicallyAggregatable","technicallyGroupable","unitProperty","utc","isATimezone","currencyProperty","scale","isProperty","getAssociatedUnitProperty","getAssociatedCurrencyProperty","getStaticUnitOrCurrency","getStaticTimezone","isTimezone","exportType","getExportDataType","inputFormat","getDateInputFormat","delimiter","getDelimiter","template","wrap","autoScale","removeUndefinedFromExportSettings","setting","columnName","linkedAnnotationColumns","col","tooltip","propertyType","dataFieldDefaultProperty","Target","MediaType","term","isURL","_isValidColumn","_getVisibleExpression","dataFieldModelPath","propertyValue","isAnalyticalGroupHeaderExpanded","isAnalyticalLeaf","_getFieldGroupHiddenExpressions","fieldGroupHiddenExpressions","Data","innerDataField","dataFieldDefault","isDataFieldTypes","_getTooltip","QuickInfo","datapointTarget","getRowStatusVisibility","colName","isSemanticKeyInFieldGroup","getErrorStatusTextVisibilityFormatter","existingColumns","relatedPropertyNameMap","getAbsoluteAnnotationPath","relatedColumn","propertyObjectPath","isMultiValueField","newNameRelativeTargetPath","computeHiddenOnRelatedColumns","newName","propertyInfo","_getAnnotationColumnName","createTechnicalProperty","relatedAdditionalPropertyNameMap","columnExists","additionalProperty","technicalColumn","aggregatable","_getShowDataFieldsLabel","fieldGroupName","columnKeys","showDataFieldsLabel","_getRelativePath","isLastSlash","isLastPart","iSlashIndex","lastIndexOf","_isColumnMultiValued","_isColumnSortable","nonSortableColumns","filterFunctions","_getFilterFunctions","isArray","ConverterContext","TypeGuards","FilterFunctions","getEntityContainer","_getDefaultFormatOptionsForTable","textLinesEdit","_findSemanticKeyValues","aSemanticKeyValues","bSemanticKeyFound","i","semanticKeyFound","_findProperties","semanticKeyValues","fieldGroupProperties","semanticKeyHasPropertyInFieldGroup","sPropertyPath","tmp","fieldGroupPropertyPath","_findSemanticKeyValuesInFieldGroup","aProperties","_propertiesFound","getDefaultDraftIndicatorForColumn","semanticKeyInFieldGroup","fieldGroupDraftIndicatorPropertyPath","showErrorObjectStatus","hasDraftIndicator","_getImpNumber","Importance","_getDataFieldImportance","targetValuefromDP","getTargetValueOnDataPoint","isDataPointFromDataFieldDefault","_getMaxImportance","maxImpNumber","impNumber","DataFieldWithMaxImportance","requiredProperties","getRequiredProperties","highKeys","fieldsWithImportance","isAnnotationOfType","dataFieldTarget","fieldGroupData","fieldGroupDataField","High","item","getRestrictionsOnProperties","getTableType","defaultCreationMode","getSapFeManifestConfiguration","macros","table","InlineCreationRows","getAnnotationsByTerm","tableConverterContext","getTargetObjectPath","collectRelatedPropertiesRecursively","sLabel","isFieldGroupColumn","navigationProperties","situationsNavProps","navigationProperty","isCollection","SAPObjectNodeType","Name","situationsNavProp","hasSituationsIndicator","isMultiValue","visualSettings","widthCalculation","FieldGroupHiddenExpressions","HTML5","CssDefaults","isPartOfLineItem","relatedPropertyName","displayModeOfPropertyUsedAsDescription","createPropertyAnnotatedTextOnly","_getPropertyNames","matchedProperties","isRequiredFieldGroup","fieldGroup","isDataField","isStaticallyMandatory","isAnnotatedRequiredProperty","isRequiredDataFieldForAnnotation","dataFieldForAnnotation","DataFieldForAnnotationFieldControlNotMandatory","hasFieldControlNotMandatory","hasFieldGroupTarget","hasDataPointTarget","Visualization","isRequiredDataPoint","isRequiredProperty","isRatingVisualizationFromDataFieldDefault","dataPoint","AnalyticalListPage","isDataFieldForAnnotation","_appendCustomTemplate","exportProperties","internalColumns","isAnnotationColumn","isSlotColumn","manifestColumn","Slot","isCustomColumn","_updateLinkedPropertiesOnCustomColumns","annotationTableColumns","replace","isPartOfCustomColumn","validateKey","baseTableColumn","After","propertiesToOverwriteAnnotationColumn","isActionNavigable","getCustomExportSettings","tooltipText","fetchTextFromMetaModel","headerText","customColumnExportSettings","baseManifestColumn","HorizontalAlign","Begin","customTableColumn","message","getDiagnostics","addIssue","IssueCategory","Manifest","IssueSeverity","Low","IssueCategoryType","AnnotationColumns","InvalidKey","columnWithSituationsIndicator","situationsIndicatorColumn","propertyKey","isSituationsIndicator","Computed","clipboardSettings","indexOfFirstVisibleColumn","findIndex","splice","columnsWithDraftIndicator","isDraftNode","columnWithDraftIndicator","draftIndicatorColumn","isDraftIndicator","columnIndexToInsertAfter","getP13nMode","variantManagement","getVariantManagement","modes","isAnalyticalTable","isResponsiveTable","personalization","sort","aggregate","VariantManagementType","Control","_isFilterBarHidden","isFilterBarHidden","hasMultipleVisualizations","getSortConditions","sortConditions","sorters","SortOrder","condition","conditionProperty","Property","infoName","convertPropertyPathsToInfoNames","descending","Descending","getInitialExpansionLevel","level","InitialExpansionLevel","paths","infoNames","currentPath","groupLevels","GroupBy","aGroupBy","aggregatablePropertyName","aggregatablePropertyDefinition","additionalPropertyInfo","getContextPropertyRestriction","capabilities","InsertRestrictions","RequiredProperties","extensionInfoMap","Total","aTotals","creationBehaviour","standardActionsContext","generateStandardActionsContext","getCutVisibility","getDeleteVisibility","massEditButtonVisibilityExpression","getMassEditVisibility","isInsertUpdateActionsTemplated","getInsertUpdateActionsTemplating","isDraftOrStickySupported","getStandardActionCut","getStandardActionCreate","getStandardActionDelete","getStandardActionPaste","getStandardActionMassEdit","getStandardActionInsights","getCreationRow","configuration","getStandardActionMoveUpDown","typeNamePlural","TypeNamePlural","pageManifestSettings","hasAbsolutePath","p13nMode","getTableID","threshold","MaxItems","isSearchable","isPathSearchable","apiId","entityName","entityTypeName","collection","row","isInDisplayMode","searchable","initialExpansionLevel","isCurrency","exportDataType","targetNavigationPropertyPath","getSelectionVariantConfiguration","selectionVariantPath","resolvedTarget","getEntityTypeAnnotation","selection","propertyNames","SelectOptions","selectOption","PropertyName","_getFullScreenBasedOnDevice","isIphone","enableFullScreen","IssueType","FULLSCREENMODE_NOT_ON_LISTREPORT","_getMultiSelectMode","multiSelectMode","selectAll","useIconTabBar","_getTableMode","isTemplateListReport","rowCountMode","rowCount","_getCondensedTableLayout","_tableType","_tableSettings","condensedTableLayout","_getTableSelectionLimit","selectionLimit","_getTableInlineCreationRowCount","inlineCreationRowCount","_getEnableExport","enablePaste","enableExport","_getFrozenColumnCount","frozenColumnCount","_getWidthIncludingColumnHeader","getFilterConfiguration","hideTableTitle","filters","quickVariantSelection","quickFilterPaths","filterPaths","quickFilters","showCounts","hiddenFilters","navProperty","useEnabledExpression","OperationAvailable","overloadAction","sourceType","staticAction","parameters","updateTreeTableManifestConfiguration","tableConfiguration","hierarchyParentNavigationPropertyPath","getHierarchyParentNavigationPropertyPath","nonUpdatableNavigationProperties","getNonUpdatableNavigationProperties","isHierarchyParentNodeUpdatable","isNodeMovable","getCustomFunctionInfo","isMoveToPositionAllowed","createEnablement","isCreateEnabled","nodeType","nodeTypeInfo","creationDialogFields","getFieldList","creationFields","createInPlace","lastDotIndex","moduleName","methodName","additionalRequiredModules","getOptimisticBatchSettingsFromManifest","disableRequestCache","getMassEditSettings","defaultFieldConfiguration","visibleFields","ignoredFields","operationGroupingMode","OperationGroupingMode","Isolated","ChangeSet","enableMassEdit","customFragment","trim","checkCondensedLayout","_manifestWrapper","globalFEManifestSettings","enableAutoColumnWidth","isPhone","disableCopyToClipboard","templateType","isCondensedLayoutCompliant","oFilterConfiguration","customValidationFunction","exportRequestSize","tableRowMode","defaultScrollThreshold","inlineCreationRowsHiddenInEditMode","useTextForNoDataMessages","getUseTextForNoDataMessages","oConfiguration","hasDataStateIndicatorFilter","disableAddRowButtonForEmptyData","enablePastingOfComputedProperties","enableAddCardToInsights","showRowCount","getViewConfiguration","useCondensedTableLayout","isCompactType","beforeRebindTable","selectionChange","modeForNoDataMessage","scrollThreshold","isPropertyNavigated","inheredPropertyDataModelObjectPath","isInheredPropertyNavigated","oProperty","oTargetMapping","isTypeDefinition","EDM_TYPE_MAPPING","underlyingType","$Scale","precision","$Precision","$MaxLength","nullable","$Nullable","minimum","isNaN","Validation","Minimum","maximum","Maximum","isDigitSequence","IsDigitSequence","parseAsString","emptyString","parseKeepsEmptyString","relatedAnnotationColumns","existingColumn","columnKey","columnFromAnnotations","enableWrapping","customExportSettings"],"sources":["./Table.ts"],"sourcesContent":["import type {\n\tEntitySet,\n\tEntityType,\n\tNavigationProperty,\n\tPathAnnotationExpression,\n\tProperty,\n\tPropertyAnnotationValue,\n\tPropertyPath\n} from \"@sap-ux/vocabularies-types\";\nimport type { FilterFunctions } from \"@sap-ux/vocabularies-types/vocabularies/Capabilities\";\nimport type { EntitySetAnnotations_Capabilities } from \"@sap-ux/vocabularies-types/vocabularies/Capabilities_Edm\";\nimport type { SemanticKey } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport { CommonAnnotationTerms } from \"@sap-ux/vocabularies-types/vocabularies/Common\";\nimport type { EntitySetAnnotations_Common } from \"@sap-ux/vocabularies-types/vocabularies/Common_Edm\";\nimport type { EntitySetAnnotations_Session } from \"@sap-ux/vocabularies-types/vocabularies/Session_Edm\";\nimport type {\n\tCriticality,\n\tDataField,\n\tDataFieldAbstractTypes,\n\tDataFieldForAction,\n\tDataFieldForActionGroup,\n\tDataFieldForActionTypes,\n\tDataFieldForAnnotation,\n\tDataFieldForIntentBasedNavigation,\n\tDataFieldTypes,\n\tDataPoint,\n\tDataPointTypeTypes,\n\tFieldGroup,\n\tLineItem,\n\tPresentationVariantType,\n\tSelectOptionType,\n\tSelectionVariant,\n\tSelectionVariantType\n} from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTerms, UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport Log from \"sap/base/Log\";\nimport type { BindingToolkitExpression, CompiledBindingToolkitExpression } from \"sap/fe/base/BindingToolkit\";\nimport {\n\tEDM_TYPE_MAPPING,\n\tand,\n\tcompileExpression,\n\tconstant,\n\tequal,\n\tformatResult,\n\tgetExpressionFromAnnotation,\n\tifElse,\n\tisConstant,\n\tnot,\n\tor,\n\tpathInModel,\n\tresolveBindingString\n} from \"sap/fe/base/BindingToolkit\";\nimport type { PageContextPathTarget } from \"sap/fe/core/converters/TemplateConverter\";\nimport type { ComplexPropertyInfo } from \"sap/fe/core/converters/annotations/DataField\";\nimport {\n\tcollectRelatedProperties,\n\tcollectRelatedPropertiesRecursively,\n\tgetDataFieldDataType,\n\tgetSemanticObjectPath,\n\tgetTargetValueOnDataPoint,\n\thasDataPointTarget,\n\thasFieldGroupTarget,\n\tisDataField,\n\tisDataFieldForActionAbstract,\n\tisDataFieldForActionGroup,\n\tisDataFieldForAnnotation,\n\tisDataFieldTypes,\n\tisDataPointFromDataFieldDefault,\n\tisRatingVisualizationFromDataFieldDefault,\n\tvisibleExpression\n} from \"sap/fe/core/converters/annotations/DataField\";\nimport type {\n\tAnnotationAction,\n\tAnnotationActionGroup,\n\tBaseAction,\n\tCombinedAction,\n\tCustomAction,\n\tOverrideTypeAction\n} from \"sap/fe/core/converters/controls/Common/Action\";\nimport {\n\tdataFieldIsCopyAction,\n\tgetActionsFromManifest,\n\tgetAnnotationMenuActionItems,\n\tgetCopyAction,\n\tgetEnabledForAnnotationAction,\n\tgetMatchingManifestAction,\n\tgetVisibilityEnablementMenuActions,\n\tisActionNavigable,\n\tprepareMenuActions,\n\tremoveDuplicateActions\n} from \"sap/fe/core/converters/controls/Common/Action\";\nimport type { ConfigurableObject, CustomElement } from \"sap/fe/core/converters/helpers/ConfigurableObject\";\nimport { OverrideType, Placement, insertCustomElements } from \"sap/fe/core/converters/helpers/ConfigurableObject\";\nimport { IssueCategory, IssueCategoryType, IssueSeverity, IssueType } from \"sap/fe/core/converters/helpers/IssueManager\";\nimport { KeyHelper } from \"sap/fe/core/converters/helpers/Key\";\nimport { Entity, UI } from \"sap/fe/core/helpers/BindingHelper\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { generate, replaceSpecialChars } from \"sap/fe/core/helpers/StableIdHelper\";\nimport * as TypeGuards from \"sap/fe/core/helpers/TypeGuards\";\nimport {\n\tisAnnotationOfType,\n\tisNavigationProperty,\n\tisPathAnnotationExpression,\n\tisProperty,\n\tisTypeDefinition\n} from \"sap/fe/core/helpers/TypeGuards\";\nimport {\n\tenhanceDataModelPath,\n\tgetContextPropertyRestriction,\n\tgetContextRelativeTargetObjectPath,\n\tgetHierarchyParentNavigationPropertyPath,\n\tgetNonUpdatableNavigationProperties,\n\tgetTargetObjectPath,\n\tisPathDeletable,\n\tisPathSearchable,\n\tisPathUpdatable,\n\ttype DataModelObjectPath\n} from \"sap/fe/core/templating/DataModelPathHelper\";\nimport { getDisplayMode, type DisplayMode } from \"sap/fe/core/templating/DisplayModeFormatter\";\nimport { getRestrictionsOnProperties, type RestrictionsOnProperties } from \"sap/fe/core/templating/EntitySetHelper\";\nimport { hasFieldControlNotMandatory, isStaticallyMandatory } from \"sap/fe/core/templating/FieldControlHelper\";\nimport {\n\tgetAssociatedCurrencyProperty,\n\tgetAssociatedCurrencyPropertyPath,\n\tgetAssociatedTextProperty,\n\tgetAssociatedTimezoneProperty,\n\tgetAssociatedUnitProperty,\n\tgetAssociatedUnitPropertyPath,\n\tgetStaticTimezone,\n\tgetStaticUnitOrCurrency,\n\tisTimezone\n} from \"sap/fe/core/templating/PropertyHelper\";\nimport { isMultiValueField } from \"sap/fe/core/templating/UIFormatters\";\nimport type { DefaultTypeForEdmType } from \"sap/fe/core/type/EDM\";\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nimport { criticalityExpressionForIntegrationCards } from \"sap/fe/core/templating/CriticalityFormatters\";\nimport tableFormatters from \"sap/fe/macros/formatters/TableFormatter\";\n// eslint-disable-next-line @typescript-eslint/no-restricted-imports\nimport ActionHelper from \"sap/fe/macros/internal/helpers/ActionHelper\";\nimport Library from \"sap/ui/core/Lib\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport type ConverterContext from \"../../ConverterContext\";\nimport type {\n\tAvailabilityType,\n\tCustomDefinedTableColumn,\n\tCustomDefinedTableColumnForOverride,\n\tFormatOptionsType,\n\tManifestAction,\n\tNavigationSettingsConfiguration,\n\tNavigationTargetConfiguration,\n\tTableColumnSettings,\n\tTableManifestConfiguration,\n\tTableManifestSettingsConfiguration\n} from \"../../ManifestSettings\";\nimport {\n\tActionType,\n\tCreationMode,\n\tHorizontalAlign,\n\tImportance,\n\tOperationGroupingMode,\n\tSelectionMode,\n\tTemplateType,\n\tVariantManagementType,\n\tVisualizationType\n} from \"../../ManifestSettings\";\nimport type ManifestWrapper from \"../../ManifestWrapper\";\nimport { AggregationHelper } from \"../../helpers/Aggregation\";\nimport { isReferencePropertyStaticallyHidden } from \"../../helpers/DataFieldHelper\";\nimport { getTableID } from \"../../helpers/ID\";\nimport { getMessageTypeFromCriticalityType } from \"./Criticality\";\nimport type { StandardAction } from \"./table/StandardActions\";\nimport {\n\tStandardActionKeys,\n\tgenerateStandardActionsContext,\n\tgetCreationRow,\n\tgetCutVisibility,\n\tgetDeleteVisibility,\n\tgetInsertUpdateActionsTemplating,\n\tgetMassEditVisibility,\n\tgetRestrictions,\n\tgetStandardActionCreate,\n\tgetStandardActionCut,\n\tgetStandardActionDelete,\n\tgetStandardActionInsights,\n\tgetStandardActionMassEdit,\n\tgetStandardActionMoveUpDown,\n\tgetStandardActionPaste,\n\tisDraftOrStickySupported,\n\tisInDisplayMode\n} from \"./table/StandardActions\";\n\ntype UploadTableSettings = {\n\tstream: string;\n\tfileName?: string;\n\tfileNameMaxLength?: int;\n\tacceptableMediaTypes?: string[];\n\tmaxLength?: int;\n\tuploadAction?: StandardAction;\n};\n\ntype RowNavigationInfo =\n\t| {\n\t\t\ttype: \"Outbound\";\n\t\t\tnavigationTarget: string;\n\t\t\tnavigationInEditMode?: boolean;\n\t  }\n\t| {\n\t\t\ttype: \"Navigation\";\n\t\t\ttargetPath: string;\n\t\t\tcheckEditable: boolean;\n\t\t\trecreateContext: boolean;\n\t\t\troutePath: string;\n\t\t\tnavigationInEditMode?: boolean;\n\t  };\n\ntype RowConfiguration = {\n\taction?: string;\n\tnavigationInfo?: RowNavigationInfo;\n\trowHighlighting: CompiledBindingToolkitExpression;\n\trowNavigated: CompiledBindingToolkitExpression;\n\trowCriticalityForInsights?: CompiledBindingToolkitExpression;\n\tvisible?: CompiledBindingToolkitExpression;\n};\n\nexport type MassEditTableConfiguration = {\n\tenabled: boolean;\n\tvisibleFields: string[];\n\tignoredFields: string[];\n\toperationGroupingMode: OperationGroupingMode;\n\tcustomFragment?: string;\n};\n\ntype TableSortConditions = {\n\tsorters: {\n\t\tname: string;\n\t\tdescending: boolean;\n\t}[];\n};\n\ntype TableGroupConditions = {\n\tgroupLevels: { name: string }[];\n};\n\ntype TableAggregateConditions = Record<string, object>;\n\ntype TableP13nMode = \"Aggregate\" | \"Column\" | \"Filter\" | \"Group\" | \"Sort\";\n\nexport type TableAnnotationConfiguration = {\n\tcollection: string;\n\tvariantManagement: VariantManagementType;\n\tfilterId?: string;\n\tid: string;\n\tapiId: string;\n\tnavigationPath: string;\n\tp13nMode?: TableP13nMode[];\n\trow?: RowConfiguration;\n\tselectionMode: string | undefined;\n\tisInsertUpdateActionsTemplated: boolean;\n\tupdatablePropertyPath: string;\n\tdisplayMode?: boolean;\n\tthreshold: number;\n\tentityName: string;\n\tentityTypeName: string;\n\tsortConditions?: TableSortConditions;\n\tgroupConditions?: TableGroupConditions;\n\taggregateConditions?: TableAggregateConditions;\n\tinitialExpansionLevel?: number;\n\tallowDropBetweenNodes?: boolean;\n\tchangeSiblingForRootsSupported?: boolean;\n\t/** Create new entries */\n\tcreate: CreateBehavior | CreateBehaviorExternal;\n\ttitle: string | undefined;\n\tsearchable: boolean;\n\trequiredProperties?: string[];\n\tuploadTable?: UploadTableSettings;\n};\n/**\n * New entries are created within the app (default case)\n */\nexport type CreateBehavior = {\n\tmode: CreationMode;\n\tappend: boolean;\n\tnewAction?: string;\n\tnavigateToTarget?: string;\n};\n\nexport type ExternalMethodConfig = {\n\tmoduleName: string;\n\tmethodName: string;\n};\n/**\n * New entries are created by navigating to some target\n */\nexport type CreateBehaviorExternal = {\n\tmode: \"External\";\n\toutbound: string;\n\toutboundDetail: NavigationTargetConfiguration[\"outboundDetail\"];\n\tnavigationSettings: NavigationSettingsConfiguration;\n};\nexport type TableCapabilityRestriction = {\n\tisDeletable: boolean;\n\tisUpdatable: boolean;\n};\nexport type TableFiltersConfiguration = {\n\tpaths: {\n\t\tannotationPath: string;\n\t}[];\n\tshowCounts?: boolean;\n};\nexport type SelectionVariantConfiguration = {\n\tpropertyNames: string[];\n\ttext?: string;\n};\n\nexport type TableControlConfiguration = {\n\tdisableRequestCache: boolean;\n\tcreateAtEnd: boolean;\n\tcreateInPlace?: boolean;\n\tcreationMode: CreationMode;\n\tdisableAddRowButtonForEmptyData: boolean;\n\tcustomValidationFunction: string | undefined;\n\tuseCondensedTableLayout: boolean;\n\tenableExport: boolean;\n\tenablePastingOfComputedProperties?: boolean;\n\tfrozenColumnCount?: number;\n\twidthIncludingColumnHeader?: boolean;\n\theader?: string;\n\theaderVisible?: boolean;\n\tfilters?: Partial<Record<\"quickFilters\" | \"hiddenFilters\", TableFiltersConfiguration>>;\n\ttype: TableType;\n\trowCountMode?: TableRowCountMode;\n\trowCount?: number;\n\tscrollThreshold?: number;\n\tselectAll?: boolean;\n\tselectionLimit: number;\n\tmultiSelectMode: string | undefined;\n\tenablePaste: boolean;\n\tdisableCopyToClipboard?: boolean;\n\tenableFullScreen: boolean;\n\tshowRowCount: boolean;\n\tinlineCreationRowCount?: number;\n\tinlineCreationRowsHiddenInEditMode?: boolean;\n\tmassEdit: MassEditTableConfiguration;\n\tenableAutoColumnWidth: boolean;\n\thasDataStateIndicatorFilter: boolean;\n\tisCompactType?: boolean;\n\thierarchyQualifier?: string;\n\tisHierarchyParentNodeUpdatable?: boolean;\n\tenableAddCardToInsights?: boolean | undefined;\n\tcreationDialogFields?: string[];\n\tnodeType?: {\n\t\tpropertyName: string;\n\t\tvalues: { value: string; text: string; creationDialogFields?: string[] }[];\n\t};\n\tcreateEnablement?: ExternalMethodConfig;\n\tisNodeMovable?: ExternalMethodConfig;\n\tisMoveToPositionAllowed?: ExternalMethodConfig;\n\tselectionChange?: string;\n\tadditionalRequiredModules?: string[];\n\tbeforeRebindTable?: string;\n\texportRequestSize?: number;\n\tenableUploadPlugin?: boolean;\n\tmodeForNoDataMessage?: string;\n};\nexport type TableType = \"GridTable\" | \"ResponsiveTable\" | \"AnalyticalTable\" | \"TreeTable\";\nexport type TableRowCountMode = \"Auto\" | \"Fixed\";\n\nenum ColumnType {\n\tDefault = \"Default\", // Default Type (Custom Column)\n\tAnnotation = \"Annotation\",\n\tSlot = \"Slot\",\n\tComputed = \"Computed\"\n}\n// Custom Column from Manifest\nexport type ManifestDefinedCustomColumn = CustomDefinedTableColumn & {\n\ttype?: ColumnType.Default;\n};\n// Slot Column from Building Block\nexport type FragmentDefinedSlotColumn = CustomDefinedTableColumn & {\n\ttype: ColumnType.Slot;\n};\n// Properties all ColumnTypes have:\nexport type BaseTableColumn = ConfigurableObject & {\n\ttype: ColumnType; //Origin of the source where we are getting the templated information from\n\twidth?: string;\n\twidthIncludingColumnHeader?: boolean;\n\timportance?: Importance;\n\thorizontalAlign?: HorizontalAlign;\n\tavailability?: AvailabilityType;\n\tisNavigable?: boolean;\n\tcaseSensitive: boolean;\n\tlabel?: string;\n\ttooltip?: string;\n};\n// Properties on Custom Columns and Slot Columns\nexport type CustomBasedTableColumn = BaseTableColumn & {\n\tid: string;\n\tname: string;\n\theader?: string;\n\ttemplate: string;\n\tpropertyInfos?: string[];\n\texportSettings?: ColumnExportSettings | null;\n\tformatOptions: FormatOptionsType;\n\tisGroupable: boolean;\n\tisNavigable: boolean;\n\tsortable: boolean;\n\tvisualSettings: { widthCalculation: null };\n\tproperties?: string[];\n\trequired?: CompiledBindingToolkitExpression;\n};\n\nexport type ComputedTableColumn = BaseTableColumn & {\n\tname: string;\n\tlabel: string;\n\tpropertyKey: string;\n\tisDraftIndicator?: boolean;\n\tisSituationsIndicator?: boolean;\n\tformatOptions?: FormatOptionsType | null;\n\tpropertyInfos?: string[];\n\texportSettings?: ColumnExportSettings | null;\n\tclipboardSettings?: Object | null;\n\trequired?: CompiledBindingToolkitExpression;\n};\n\n// Properties derived from Manifest to override Annotation configurations\nexport type AnnotationTableColumnForOverride = BaseTableColumn & {\n\tsettings?: TableColumnSettings;\n\tformatOptions?: FormatOptionsType;\n\texportSettings?: ColumnExportSettings | null;\n};\nexport type PropertyTypeConstraints = Partial<{\n\tscale: number;\n\tprecision: number;\n\tmaxLength: number;\n\tnullable: boolean;\n\tminimum: string;\n\tmaximum: string;\n\tisDigitSequence: boolean;\n}>;\nexport type PropertyTypeFormatOptions = Partial<{\n\tparseAsString: boolean;\n\temptyString: string;\n\tparseKeepsEmptyString: boolean;\n}>;\nexport type PropertyTypeConfig = {\n\ttype?: string;\n\tconstraints: PropertyTypeConstraints;\n\tformatOptions: PropertyTypeFormatOptions;\n\ttypeInstance?: unknown;\n\tbaseType?: string;\n\tclassName?: keyof typeof DefaultTypeForEdmType;\n};\nexport type ColumnExportSettings = Partial<{\n\ttemplate: string;\n\tlabel: string;\n\twrap: boolean;\n\ttype: string;\n\tinputFormat: string;\n\tformat: string;\n\tscale: number;\n\tdelimiter: boolean;\n\tunit: string;\n\tunitProperty: string;\n\ttimezone: string;\n\ttimezoneProperty: string;\n\tutc: boolean;\n\tdataPointTargetValue: string;\n\tisCurrency: boolean;\n\tproperty: string[];\n\twidth: number;\n\tautoScale: boolean;\n}>;\n// Properties for Annotation Columns\nexport type AnnotationTableColumn = AnnotationTableColumnForOverride & {\n\tname: string;\n\tpropertyInfos?: string[];\n\tannotationPath: string;\n\trelativePath: string;\n\tlabel?: string;\n\ttooltip?: string;\n\tgroupLabel?: string;\n\tgroup?: string;\n\tFieldGroupHiddenExpressions?: CompiledBindingToolkitExpression;\n\tshowDataFieldsLabel?: boolean;\n\trequired?: CompiledBindingToolkitExpression;\n\tisKey?: boolean;\n\tisGroupable?: boolean;\n\tunit?: string;\n\tunitText?: string;\n\ttimezoneText?: string;\n\ttimezone?: string;\n\tsemanticObjectPath?: string;\n\tsortable: boolean;\n\tfilterable?: boolean;\n\texportSettings?: ColumnExportSettings | null;\n\ttextArrangement?: {\n\t\ttextProperty: string;\n\t\tmode: DisplayMode;\n\t};\n\tadditionalPropertyInfos?: string[];\n\tvisualSettings?: VisualSettings;\n\ttypeConfig?: PropertyTypeConfig;\n\tisPartOfLineItem?: boolean; // temporary indicator to only allow filtering on navigation properties when they're part of a line item\n\tisPartOfCustomColumn?: boolean;\n\tadditionalLabels?: string[];\n\texportDataPointTargetValue?: string;\n\taggregatable?: boolean;\n\textension?: ExtensionForAnalytics;\n\tisMultiValue?: boolean;\n};\nexport type ExtensionForAnalytics = {\n\tadditionalProperties?: string[];\n};\nexport type TechnicalColumn = AnnotationTableColumn & {\n\textension?: {\n\t\ttechnicallyGroupable: boolean;\n\t\ttechnicallyAggregatable: boolean;\n\t};\n};\nexport type VisualSettings = {\n\twidthCalculation?: WidthCalculation;\n};\nexport type WidthCalculation = null | {\n\tminWidth?: number;\n\tmaxWidth?: number;\n\tdefaultWidth?: number;\n\ttruncateLabel?: boolean;\n\tgap?: number;\n\t// only relevant for complex types\n\texcludeProperties?: string[];\n\tverticalArrangement?: boolean;\n};\n\nexport type TableColumn = CustomBasedTableColumn | AnnotationTableColumn | ComputedTableColumn | TechnicalColumn;\nexport type ManifestColumn = CustomElement<CustomBasedTableColumn | AnnotationTableColumnForOverride>;\nexport type InternalExtensionForAnalytics = ExtensionForAnalytics & {\n\tfromGroupableProperty: boolean;\n\trelativePath: string;\n};\nexport type TableVisualization = {\n\ttype: VisualizationType.Table;\n\tannotation: TableAnnotationConfiguration;\n\tcontrol: TableControlConfiguration;\n\tcolumns: TableColumn[];\n\tactions: BaseAction[];\n\tcommandActions?: Record<string, CustomAction>;\n\tanalyticsExtensions?: Record<string, InternalExtensionForAnalytics>;\n\trequestAtLeast?: string[];\n\tenableAnalytics?: boolean;\n\tenableBasicSearch?: boolean;\n\toperationAvailableMap: string;\n\toperationAvailableProperties: string;\n\theaderInfoTitle: string;\n\tsemanticKeys: string[];\n\theaderInfoTypeName: PropertyAnnotationValue<String> | undefined;\n\tenable$select: boolean;\n\tenable$$getKeepAliveContext: boolean;\n\tisInsightsEnabled?: boolean;\n\theader?: string;\n\theaderVisible?: boolean;\n\thandlePatchSent: boolean;\n};\n\n/**\n * Returns an array of all standard, annotation-based, and manifest-based table actions.\n * @param lineItemAnnotation\n * @param visualizationPath\n * @param converterContext\n * @param standardActions\n * @param navigationSettings\n * @returns The complete table actions\n */\nexport function getTableActions(\n\tlineItemAnnotation: LineItem,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tstandardActions: StandardActionsConfiguration[\"standardActions\"],\n\tnavigationSettings?: NavigationSettingsConfiguration\n): CombinedAction {\n\t// 1. Get actions from annotations\n\tconst tableActions = getTableAnnotationActions(lineItemAnnotation, visualizationPath, converterContext);\n\t// 2. Get actions from manifest\n\tconst manifestActions = getActionsFromManifest(\n\t\tconverterContext.getManifestControlConfiguration<TableManifestConfiguration>(visualizationPath).actions as Record<\n\t\t\tstring,\n\t\t\tManifestAction\n\t\t>,\n\t\tconverterContext,\n\t\ttableActions.tableActions,\n\t\tnavigationSettings,\n\t\ttrue\n\t);\n\t// The \"Copy\" action always needs to be placed after the \"Create\" action, so we need to separate it\n\tconst copyActions = tableActions.tableActions.filter((a) => a.type === ActionType.Copy);\n\tconst annotationActions = tableActions.tableActions.filter((a) => a.type !== ActionType.Copy);\n\t// Combine standard, annotation, and custom actions together, respecting the fixed order of standard actions\n\tconst annotationAndStandardActions = (\n\t\t[\n\t\t\t...annotationActions,\n\t\t\tstandardActions.create,\n\t\t\t...copyActions,\n\t\t\tstandardActions.delete,\n\t\t\tstandardActions.massEdit,\n\t\t\tstandardActions.insights,\n\t\t\tstandardActions.creationRow, // Not templated as a button\n\t\t\tstandardActions.cut,\n\t\t\tstandardActions.paste,\n\t\t\tstandardActions.moveUp,\n\t\t\tstandardActions.moveDown\n\t\t] as BaseAction[]\n\t).filter((action) => action !== undefined);\n\t// Anchor all non-anchored manifest custom actions/menus before the standard actions\n\tfor (const manifestAction of Object.values(manifestActions.actions)) {\n\t\tif ((manifestAction.type === ActionType.Default || manifestAction.type === ActionType.Menu) && !manifestAction.position?.anchor) {\n\t\t\tmanifestAction.position = {\n\t\t\t\tanchor: StandardActionKeys.Create,\n\t\t\t\tplacement: Placement.Before\n\t\t\t};\n\t\t}\n\t}\n\t// Insert twice to allow regular override for non-standard actions and positional override for standard actions\n\tconst manifestActionEntries = Object.entries(manifestActions.actions);\n\tconst standardManifestActions = Object.fromEntries(manifestActionEntries.filter(([key]) => key.startsWith(\"StandardAction::\")));\n\tconst nonStandardManifestActions = Object.fromEntries(manifestActionEntries.filter(([key]) => !standardManifestActions[key]));\n\tconst actionOverwriteConfig: OverrideTypeAction = {\n\t\tisNavigable: OverrideType.overwrite,\n\t\tenableOnSelect: OverrideType.overwrite,\n\t\tenableAutoScroll: OverrideType.overwrite,\n\t\tenabled: OverrideType.overwrite,\n\t\tvisible: OverrideType.overwrite,\n\t\tvisibleForContextMenu: OverrideType.overwrite,\n\t\tdefaultValuesExtensionFunction: OverrideType.overwrite,\n\t\tcommand: OverrideType.overwrite,\n\t\tposition: OverrideType.overwrite,\n\t\tmenu: OverrideType.overwrite\n\t};\n\t// 3. Get all annotation menu items\n\tconst annotationMenuActionItems = getAnnotationMenuActionItems(annotationActions);\n\t// 4. Find manifest actions which override any annotation menu items\n\tconst matchingManifestActions = getMatchingManifestAction(annotationMenuActionItems, manifestActions.actions);\n\t// 5. Get overridden annotation menu items\n\tconst overwrittenMenuActionItems = insertCustomElements(annotationMenuActionItems, matchingManifestActions, actionOverwriteConfig);\n\t// 6. Override all actions\n\tlet actions = insertCustomElements(annotationAndStandardActions, nonStandardManifestActions, actionOverwriteConfig) as CustomAction[];\n\tactions = insertCustomElements(actions, standardManifestActions, {\n\t\tposition: OverrideType.overwrite\n\t});\n\t// 7. Replace original menu items with their corresponding overridden menu items\n\tprepareMenuActions(actions, overwrittenMenuActionItems);\n\t// 8. Remove duplicate actions which are menu items\n\tactions = removeDuplicateActions(actions);\n\t// 9. Hide menus where all menu items are hidden\n\tactions = getVisibilityEnablementMenuActions(actions);\n\treturn {\n\t\tactions: actions,\n\t\tcommandActions: manifestActions.commandActions\n\t};\n}\n/**\n * Returns an array of all columns, annotation-based as well as manifest-based.\n * They are sorted and some properties can be overwritten via the manifest (check out the keys that can be overwritten).\n * @param lineItemAnnotation Collection of data fields for representation in a table or list\n * @param visualizationPath\n * @param converterContext\n * @param navigationSettings\n * @returns Returns all table columns that should be available, regardless of templating or personalization or their origin\n */\nexport function getTableColumns(\n\tlineItemAnnotation: LineItem,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tnavigationSettings?: NavigationSettingsConfiguration\n): TableColumn[] {\n\tconst annotationColumns = getColumnsFromAnnotations(lineItemAnnotation, visualizationPath, converterContext);\n\tconst manifestColumns = getColumnsFromManifest(\n\t\tconverterContext.getManifestControlConfiguration<TableManifestConfiguration>(visualizationPath).columns ?? {},\n\t\tannotationColumns,\n\t\tconverterContext,\n\t\tconverterContext.getAnnotationEntityType(lineItemAnnotation),\n\t\tnavigationSettings\n\t);\n\n\tconst tableColumns: TableColumn[] = insertCustomElements(\n\t\tannotationColumns as TableColumn[],\n\t\tmanifestColumns as Record<string, CustomElement<TableColumn>>,\n\t\t{\n\t\t\twidth: OverrideType.overwrite,\n\t\t\twidthIncludingColumnHeader: OverrideType.overwrite,\n\t\t\timportance: OverrideType.overwrite,\n\t\t\thorizontalAlign: OverrideType.overwrite,\n\t\t\tavailability: OverrideType.overwrite,\n\t\t\tisNavigable: OverrideType.overwrite,\n\t\t\tsettings: OverrideType.overwrite,\n\t\t\tformatOptions: OverrideType.overwrite,\n\t\t\texportSettings: OverrideType.overwrite\n\t\t}\n\t);\n\n\treturn addComputedColumns(tableColumns, visualizationPath, converterContext);\n}\n\n//Returns the ContextDefiningProperties from the custom aggregate annotation or from the aggregation annotation on the property itself.\nfunction getContextDefiningPropertiesFromAggregationAnnotation(aggregationHelper: AggregationHelper): Record<string, string[]> {\n\tconst customAggregateAnnotations = aggregationHelper.getCustomAggregateDefinitions();\n\tconst customAggregatedefinitions: Record<string, string[]> = {};\n\tcustomAggregateAnnotations.forEach((annotation) => {\n\t\tconst aggregatedProperty = aggregationHelper._entityType.entityProperties.find((property) => {\n\t\t\treturn property.name === annotation.qualifier;\n\t\t});\n\t\tif (aggregatedProperty) {\n\t\t\tconst contextDefiningProperties =\n\t\t\t\tannotation.annotations?.Aggregation?.ContextDefiningProperties ??\n\t\t\t\taggregatedProperty.annotations.Aggregation?.ContextDefiningProperties;\n\t\t\tcustomAggregatedefinitions[aggregatedProperty.name] =\n\t\t\t\tcontextDefiningProperties?.map((ctxDefProperty) => ctxDefProperty.value) ?? [];\n\t\t}\n\t});\n\treturn customAggregatedefinitions;\n}\n\n/**\n * Retrieve the extension information for all aggregable properties .\n * @param entityType The target entity type.\n * @param tableColumns The array of columns for the entity type.\n * @param converterContext The converter context.\n * @returns The aggregate definitions from the entityType, or undefined if the entity doesn't support analytical queries.\n */\nexport const getExtensionInfoFromEntityType = function (\n\tentityType: EntityType,\n\ttableColumns: TableColumn[],\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): Record<string, InternalExtensionForAnalytics> | undefined {\n\tconst aggregationHelper = new AggregationHelper(entityType, converterContext);\n\tif (!aggregationHelper.isAnalyticsSupported()) {\n\t\treturn undefined;\n\t}\n\t// Keep a set of all currency/unit properties, as we don't want to consider them as aggregates\n\t// They are aggregates for technical reasons (to manage multi-units situations) but it doesn't make sense from a user standpoint\n\tconst currencyOrUnitProperties = new Set();\n\ttableColumns.forEach((column) => {\n\t\tconst tableColumn = column as AnnotationTableColumn;\n\t\tif (tableColumn.unit) {\n\t\t\tconst targetUnitProperty = tableColumns.find((prop) => prop.name === tableColumn.unit) as AnnotationTableColumn;\n\t\t\tcurrencyOrUnitProperties.add(targetUnitProperty.relativePath);\n\t\t}\n\t});\n\tconst contextDefiningPropertiesFromAggregation = getContextDefiningPropertiesFromAggregationAnnotation(aggregationHelper);\n\tconst result: Record<string, InternalExtensionForAnalytics> = {};\n\ttableColumns.forEach((column) => {\n\t\tconst tableColumn = column as AnnotationTableColumn;\n\t\tconst property = entityType.entityProperties.find((prop) => prop.name === tableColumn.relativePath);\n\t\tif (tableColumn.propertyInfos === undefined && tableColumn.relativePath) {\n\t\t\tlet rawContextDefiningProperties = contextDefiningPropertiesFromAggregation[tableColumn.relativePath] as string[] | undefined;\n\n\t\t\t// if there is no custom aggregate definition, and the property is groupable, then we can use the default context defining properties\n\t\t\tlet fromGroupableProperty = false;\n\t\t\tif (!rawContextDefiningProperties && property && !!aggregationHelper.isPropertyGroupable(property)) {\n\t\t\t\tfromGroupableProperty = true;\n\t\t\t\trawContextDefiningProperties = property.annotations.Aggregation?.ContextDefiningProperties?.map(\n\t\t\t\t\t(ctxDefProperty) => ctxDefProperty.value\n\t\t\t\t);\n\t\t\t}\n\t\t\t// Ignore aggregates corresponding to currencies or units of measure\n\t\t\tif (rawContextDefiningProperties && !currencyOrUnitProperties.has(tableColumn.relativePath)) {\n\t\t\t\tresult[tableColumn.name] = {\n\t\t\t\t\tfromGroupableProperty: fromGroupableProperty,\n\t\t\t\t\trelativePath: tableColumn.relativePath\n\t\t\t\t};\n\t\t\t\tconst contextDefiningProperties: string[] = [];\n\t\t\t\trawContextDefiningProperties.forEach((contextDefiningPropertyName) => {\n\t\t\t\t\t// Ignore contextdefiningproperties corresponding to currencies or units of measure\n\t\t\t\t\tif (currencyOrUnitProperties.has(contextDefiningPropertyName)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst foundColumn = findColumnByPath(contextDefiningPropertyName, tableColumns);\n\t\t\t\t\tif (foundColumn) {\n\t\t\t\t\t\tcontextDefiningProperties.push(foundColumn.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (contextDefiningProperties.length) {\n\t\t\t\t\tresult[tableColumn.name].additionalProperties = contextDefiningProperties;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\treturn result;\n};\n/**\n * Updates a table visualization for analytical use cases.\n * @param tableVisualization The visualization to be updated\n * @param entityType The entity type displayed in the table\n * @param converterContext The converter context\n * @param presentationVariantAnnotation The presentationVariant annotation (if any)\n */\nexport function updateTableVisualizationForType(\n\ttableVisualization: TableVisualization,\n\tentityType: EntityType,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tpresentationVariantAnnotation?: PresentationVariantType\n): void {\n\tif (tableVisualization.control.type === \"AnalyticalTable\") {\n\t\tconst aggregationData = getExtensionInfoFromEntityType(entityType, tableVisualization.columns, converterContext),\n\t\t\taggregationHelper = new AggregationHelper(entityType, converterContext);\n\t\tif (aggregationData) {\n\t\t\ttableVisualization.enableAnalytics = true;\n\t\t\ttableVisualization.enable$select = false;\n\t\t\ttableVisualization.enable$$getKeepAliveContext = false;\n\t\t\ttableVisualization.analyticsExtensions = aggregationData;\n\t\t\t_updatePropertyInfosWithAggregatesDefinitions(tableVisualization);\n\t\t\tconst allowedTransformations = aggregationHelper.getAllowedTransformations();\n\t\t\ttableVisualization.enableBasicSearch = allowedTransformations ? allowedTransformations.includes(\"search\") : true;\n\t\t\t// Add group and sort conditions from the presentation variant\n\t\t\ttableVisualization.annotation.groupConditions = getGroupConditions(\n\t\t\t\tpresentationVariantAnnotation,\n\t\t\t\ttableVisualization.columns,\n\t\t\t\ttableVisualization.control.type\n\t\t\t);\n\t\t\ttableVisualization.annotation.aggregateConditions = getAggregateConditions(\n\t\t\t\tpresentationVariantAnnotation,\n\t\t\t\ttableVisualization.columns,\n\t\t\t\taggregationData\n\t\t\t);\n\n\t\t\tif (ModelHelper.isObjectPathDraftSupported(converterContext.getDataModelObjectPath())) {\n\t\t\t\t// For an analytical table displaying a draft-enabled entity, we always load 'HasActiveEntity'\n\t\t\t\t// because it's needed for the row criticality expression\n\t\t\t\tif (tableVisualization.requestAtLeast) {\n\t\t\t\t\ttableVisualization.requestAtLeast.push(\"HasActiveEntity\");\n\t\t\t\t} else {\n\t\t\t\t\ttableVisualization.requestAtLeast = [\"HasActiveEntity\"];\n\t\t\t\t}\n\n\t\t\t\t// We always load 'HasDraftEntity' in a LR because it's needed to navigate to the draft instance if there's one when clicking on the active instance\n\t\t\t\tif (ModelHelper.isDraftRoot(converterContext.getEntitySet())) {\n\t\t\t\t\ttableVisualization.requestAtLeast.push(\"HasDraftEntity\");\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tLog.error(`Aggregation not supported for this entity type: ${entityType.name}`);\n\t\t}\n\t\ttableVisualization.control.type = \"GridTable\"; // AnalyticalTable isn't a real type for the MDC:Table, so we always switch back to Grid\n\t} else if (tableVisualization.control.type === \"ResponsiveTable\") {\n\t\ttableVisualization.annotation.groupConditions = getGroupConditions(\n\t\t\tpresentationVariantAnnotation,\n\t\t\ttableVisualization.columns,\n\t\t\ttableVisualization.control.type\n\t\t);\n\t} else if (tableVisualization.control.type === \"TreeTable\") {\n\t\tconst aggregationHelper = new AggregationHelper(entityType, converterContext);\n\t\tconst allowedTransformations = aggregationHelper.getAllowedTransformations();\n\t\ttableVisualization.enableBasicSearch = allowedTransformations ? allowedTransformations.includes(\"search\") : true;\n\t\ttableVisualization.enable$$getKeepAliveContext = true;\n\t\ttableVisualization.annotation.changeSiblingForRootsSupported = (entityType?.annotations.Hierarchy?.[\n\t\t\t`RecursiveHierarchyActions#${tableVisualization.control.hierarchyQualifier ?? \"\"}`\n\t\t]?.ChangeSiblingForRootsSupported ?? true) as boolean;\n\n\t\ttableVisualization.annotation.allowDropBetweenNodes =\n\t\t\t!!entityType.annotations.Hierarchy?.[`RecursiveHierarchyActions#${tableVisualization.control.hierarchyQualifier ?? \"\"}`]\n\t\t\t\t?.ChangeNextSiblingAction;\n\n\t\t// We always load 'HasDraftEntity' in a LR because it's needed to navigate to the draft instance if there's one when clicking on the active instance\n\t\tif (ModelHelper.isDraftRoot(converterContext.getEntitySet())) {\n\t\t\tif (tableVisualization.requestAtLeast) {\n\t\t\t\ttableVisualization.requestAtLeast.push(\"HasDraftEntity\");\n\t\t\t} else {\n\t\t\t\ttableVisualization.requestAtLeast = [\"HasDraftEntity\"];\n\t\t\t}\n\t\t}\n\t}\n\n\tif (tableVisualization.control.enableUploadPlugin) {\n\t\tconst streamProperty = converterContext.getAnnotationEntityType().annotations?.UI?.MediaResource?.Stream?.$target;\n\t\tif (!streamProperty) {\n\t\t\tthrow \"UI.MediaResource annotation with Stream property missing\";\n\t\t}\n\n\t\t// the upload action is treated as the create action\n\t\tconst uploadAction = tableVisualization.actions.find((a) => a.key === StandardActionKeys.Create) as StandardAction;\n\n\t\ttableVisualization.annotation.uploadTable = {\n\t\t\tstream: streamProperty.name,\n\t\t\tfileName: (streamProperty.annotations.Core?.ContentDisposition?.Filename as PathAnnotationExpression<string> | undefined)?.path,\n\t\t\tfileNameMaxLength: streamProperty.annotations.Core?.ContentDisposition?.Filename?.$target?.maxLength,\n\t\t\tacceptableMediaTypes: streamProperty.annotations.Core?.AcceptableMediaTypes,\n\t\t\tmaxLength: streamProperty.maxLength,\n\t\t\tuploadAction: uploadAction\n\t\t};\n\t}\n}\n\n/**\n * Creates and returns a select query with the selected fields from the parameters that were passed.\n * @param lineItem The LineItem we want the requested properties from.\n * @param converterContext The converter context.\n * @param operationAvailable A string containing the available operation, which we'll take the properties to add to the select query.\n * @param presentationVariantAnnotation The presentation variant annotation which we'll take the RequestAtLeast properties from.\n * @returns The 'select' query that has the selected fields from the parameters that were passed.\n */\nexport function createRequestedProperties(\n\tlineItem: LineItem,\n\tconverterContext: ConverterContext,\n\toperationAvailable?: string,\n\tpresentationVariantAnnotation?: PresentationVariantType\n): string[] {\n\tconst entityType = converterContext.getAnnotationEntityType(lineItem);\n\tconst selectedFields: string[] = [];\n\tfunction pushField(field: string): void {\n\t\tif (field && !selectedFields.includes(field) && field.indexOf(\"/\") !== 0) {\n\t\t\t// Do not add singleton property (with absolute path) to $select\n\t\t\tselectedFields.push(field);\n\t\t}\n\t}\n\n\tfunction pushFieldList(fields: string[]): void {\n\t\tif (fields?.length) {\n\t\t\tfields.forEach(pushField);\n\t\t}\n\t}\n\n\tconst operationAvailableProperties = (operationAvailable || \"\").split(\",\");\n\tconst validProperties = operationAvailableProperties.filter(function (propName: string) {\n\t\treturn entityType.resolvePath(propName);\n\t});\n\tconst semanticKeys: string[] = (entityType.annotations.Common?.SemanticKey || []).map((semanticKey) => semanticKey.value);\n\tconst capabilitiesAnnotation = converterContext.getEntitySet()?.annotations?.Capabilities;\n\tconst alternateAndSecondaryKeys = ModelHelper.getAlternateAndSecondaryKeys(entityType, converterContext.getEntitySet() as EntitySet);\n\tif (presentationVariantAnnotation) {\n\t\tpushFieldList(presentationVariantAnnotation.RequestAtLeast?.map((propertyPath) => propertyPath.value));\n\t}\n\tpushFieldList(getNavigationAvailableFieldsFromLineItem(lineItem, entityType));\n\tpushFieldList(validProperties);\n\tpushFieldList(semanticKeys);\n\tpushFieldList(alternateAndSecondaryKeys);\n\tif (capabilitiesAnnotation) {\n\t\tpushField((capabilitiesAnnotation.DeleteRestrictions?.Deletable as PathAnnotationExpression<boolean>)?.path);\n\t\tpushField((capabilitiesAnnotation.UpdateRestrictions?.Updatable as PathAnnotationExpression<boolean>)?.path);\n\t}\n\n\treturn selectedFields;\n}\n\n/**\n * This return the property that are available from the NavigationAvailable annotation on IBN Fields.\n * @param lineItem The line item annotation.\n * @param entityType The Entity Type.\n * @returns An array containing the properties name.\n */\nfunction getNavigationAvailableFieldsFromLineItem(lineItem: LineItem, entityType: EntityType): string[] {\n\tconst selectedFields: string[] = [];\n\tlineItem.forEach(function (record) {\n\t\tif (\n\t\t\trecord.$Type === UIAnnotationTypes.DataFieldForIntentBasedNavigation &&\n\t\t\t!record.Inline &&\n\t\t\t!record.Determining &&\n\t\t\tisPathAnnotationExpression(record.NavigationAvailable)\n\t\t) {\n\t\t\tconst path = (record.NavigationAvailable as unknown as { path: string }).path;\n\t\t\tif (entityType.resolvePath(path)) {\n\t\t\t\tselectedFields.push(path);\n\t\t\t}\n\t\t}\n\t});\n\treturn selectedFields;\n}\n\n/**\n * Get the navigation target path from manifest settings.\n * @param converterContext The converter context\n * @param navigationPropertyPath The navigation path to check in the manifest settings\n * @returns Navigation path from manifest settings\n */\nexport function getNavigationTargetPath(converterContext: ConverterContext<PageContextPathTarget>, navigationPropertyPath: string): string {\n\tconst manifestWrapper = converterContext.getManifestWrapper();\n\tif (navigationPropertyPath && manifestWrapper.getNavigationConfiguration(navigationPropertyPath)) {\n\t\tconst navConfig = manifestWrapper.getNavigationConfiguration(navigationPropertyPath);\n\t\tif (Object.keys(navConfig).length > 0) {\n\t\t\treturn navigationPropertyPath;\n\t\t}\n\t}\n\tconst dataModelPath = converterContext.getDataModelObjectPath();\n\tconst contextPath = converterContext.getContextPath();\n\tconst navConfigForContextPath = manifestWrapper.getNavigationConfiguration(contextPath);\n\tif (navConfigForContextPath && Object.keys(navConfigForContextPath).length > 0) {\n\t\treturn contextPath;\n\t}\n\treturn dataModelPath.targetEntitySet ? dataModelPath.targetEntitySet.name : dataModelPath.startingEntitySet.name;\n}\nfunction findColumnByPath(path: string, tableColumns: TableColumn[]): TableColumn | undefined {\n\treturn tableColumns.find((column) => {\n\t\tconst annotationColumn = column as AnnotationTableColumn;\n\t\treturn annotationColumn.propertyInfos === undefined && annotationColumn.relativePath === path;\n\t});\n}\n/**\n * Sets the 'unit', 'textArrangement', 'timezone' and 'exportsettings' properties in columns when necessary.\n * @param converterContext The instance of the converter context\n * @param tableColumns The columns to be updated\n */\nexport function updateLinkedProperties(converterContext: ConverterContext, tableColumns: TableColumn[]): void {\n\tconst dataModelObjectPath = converterContext.getConverterContextFor(converterContext.getContextPath()).getDataModelObjectPath();\n\ttableColumns.forEach((oColumn) => {\n\t\tconst tableColumn = oColumn as AnnotationTableColumn;\n\t\tif (tableColumn.propertyInfos === undefined && tableColumn.relativePath) {\n\t\t\tconst propertyDataModelObjectPath = enhanceDataModelPath<Property>(dataModelObjectPath, tableColumn.relativePath);\n\t\t\tconst property = propertyDataModelObjectPath.targetObject;\n\t\t\tif (property) {\n\t\t\t\taddCurrencyOrUoMToProperty(property, propertyDataModelObjectPath, tableColumns, tableColumn);\n\t\t\t\tconst timezoneProperty = getAssociatedTimezoneProperty(property);\n\t\t\t\tconst timezone = property?.annotations?.Common?.Timezone;\n\t\t\t\tif (timezoneProperty) {\n\t\t\t\t\tconst oTimezoneColumn = findColumnByPath(timezoneProperty.name, tableColumns);\n\t\t\t\t\ttableColumn.timezone = oTimezoneColumn?.name;\n\t\t\t\t} else if (timezone) {\n\t\t\t\t\ttableColumn.timezoneText = timezone.toString();\n\t\t\t\t}\n\t\t\t\tconst displayMode = getDisplayMode(property),\n\t\t\t\t\ttextAnnotation = property.annotations.Common?.Text;\n\t\t\t\tif (isPathAnnotationExpression(textAnnotation) && displayMode !== \"Value\") {\n\t\t\t\t\tconst textColumn = findColumnByPath(textAnnotation.path, tableColumns);\n\t\t\t\t\tif (textColumn && textColumn.name !== tableColumn.name) {\n\t\t\t\t\t\ttableColumn.textArrangement = {\n\t\t\t\t\t\t\ttextProperty: textColumn.name,\n\t\t\t\t\t\t\tmode: displayMode\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// If text properties are used but hidden, we must include them to the export as there are used in the paste\n\t\t\t\t\t\tif (!textColumn.exportSettings) {\n\t\t\t\t\t\t\ttextColumn.exportSettings = { type: \"String\" };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n}\n\n/**\n * Adds the \"unit\" property into the columns when neccesary for columns with unit of measure and currencies.\n * @param property The property referenced on the column\n * @param dataModelObjectPath The property DataModelObjectPath.\n * @param tableColumns The list of columns displayed on the table\n * @param tableColumn The table column which adds the currency or unit\n * @returns The updated property with the UoM or currency\n */\n\nfunction addCurrencyOrUoMToProperty(\n\tproperty: Property,\n\tpropertyDataModelObjectPath: DataModelObjectPath<Property>,\n\ttableColumns: TableColumn[],\n\ttableColumn: AnnotationTableColumn\n): void {\n\tconst currencyOrUoMProperty = getAssociatedCurrencyPropertyPath(property) || getAssociatedUnitPropertyPath(property);\n\tif (currencyOrUoMProperty) {\n\t\tconst currencyOrUoMPropertyDataModelObjectPath = enhanceDataModelPath<Property>(propertyDataModelObjectPath, currencyOrUoMProperty);\n\t\tconst currencyOrUoMRelativePath = getContextRelativeTargetObjectPath(currencyOrUoMPropertyDataModelObjectPath);\n\t\tif (currencyOrUoMRelativePath) {\n\t\t\tconst unitColumn = findColumnByPath(currencyOrUoMRelativePath, tableColumns);\n\t\t\ttableColumn.unit = unitColumn?.name;\n\t\t}\n\t} else {\n\t\tconst unit = property?.annotations?.Measures?.ISOCurrency || property?.annotations?.Measures?.Unit;\n\t\tif (unit) {\n\t\t\ttableColumn.unitText = `${unit}`;\n\t\t}\n\t}\n}\nfunction getSemanticKeysAndTitleInfo(converterContext: ConverterContext<PageContextPathTarget>): {\n\theaderInfoTitlePath: string;\n\tsemanticKeyColumns: string[];\n\theaderInfoTypeName: PropertyAnnotationValue<String> | undefined;\n} {\n\tconst headerInfoTitlePath = (converterContext.getAnnotationEntityType()?.annotations?.UI?.HeaderInfo?.Title as DataFieldTypes)?.Value\n\t\t?.path;\n\tconst semanticKeyAnnotations = converterContext.getAnnotationEntityType()?.annotations?.Common?.SemanticKey;\n\tconst headerInfoTypeName = converterContext?.getAnnotationEntityType()?.annotations?.UI?.HeaderInfo?.TypeName;\n\tconst semanticKeyColumns: string[] = [];\n\tif (semanticKeyAnnotations) {\n\t\tsemanticKeyAnnotations.forEach(function (oColumn) {\n\t\t\tsemanticKeyColumns.push(oColumn.value);\n\t\t});\n\t}\n\treturn { headerInfoTitlePath, semanticKeyColumns, headerInfoTypeName };\n}\nexport function createTableVisualization(\n\tlineItemAnnotation: LineItem,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tparams?: Partial<{\n\t\tpresentationVariantAnnotation: PresentationVariantType;\n\t\tselectionVariantAnnotation: SelectionVariantType;\n\t\tisCondensedTableLayoutCompliant: boolean;\n\t}>\n): TableVisualization {\n\tconst { presentationVariantAnnotation, isCondensedTableLayoutCompliant, selectionVariantAnnotation } = params ?? {};\n\tconst tableManifestConfig = getTableManifestConfiguration(\n\t\tlineItemAnnotation,\n\t\tvisualizationPath,\n\t\tconverterContext,\n\t\tisCondensedTableLayoutCompliant,\n\t\tselectionVariantAnnotation\n\t);\n\tconst { navigationPropertyPath } = splitPath(visualizationPath);\n\tconst navigationTargetPath = getNavigationTargetPath(converterContext, navigationPropertyPath);\n\tconst navigationSettings = converterContext.getManifestWrapper().getNavigationConfiguration(navigationTargetPath);\n\tconst columns = getTableColumns(lineItemAnnotation, visualizationPath, converterContext, navigationSettings);\n\tconst operationAvailableMap = getOperationAvailableMap(lineItemAnnotation, converterContext);\n\tconst semanticKeysAndHeaderInfoTitle = getSemanticKeysAndTitleInfo(converterContext);\n\tconst standardActionsConfiguration = getStandardActionsConfiguration(\n\t\tlineItemAnnotation,\n\t\tvisualizationPath,\n\t\tconverterContext,\n\t\ttableManifestConfig,\n\t\tnavigationSettings\n\t);\n\tconst tableAnnotation = getTableAnnotationConfiguration(\n\t\tlineItemAnnotation,\n\t\tvisualizationPath,\n\t\tconverterContext,\n\t\ttableManifestConfig,\n\t\tcolumns,\n\t\tnavigationSettings,\n\t\tstandardActionsConfiguration,\n\t\tpresentationVariantAnnotation\n\t);\n\tconst tableActions = getTableActions(\n\t\tlineItemAnnotation,\n\t\tvisualizationPath,\n\t\tconverterContext,\n\t\tstandardActionsConfiguration.standardActions,\n\t\tnavigationSettings\n\t);\n\tconst operationAvailable = getOperationAvailableProperties(operationAvailableMap, converterContext);\n\tlet header = tableManifestConfig.header;\n\theader ??= tableAnnotation.title === \"\" ? undefined : tableAnnotation.title;\n\tconst oVisualization: TableVisualization = {\n\t\ttype: VisualizationType.Table,\n\t\tannotation: tableAnnotation,\n\t\tcontrol: tableManifestConfig,\n\t\tactions: tableActions.actions,\n\t\tcommandActions: tableActions.commandActions,\n\t\tcolumns: columns,\n\t\toperationAvailableMap: JSON.stringify(operationAvailableMap),\n\t\toperationAvailableProperties: operationAvailable,\n\t\theaderInfoTitle: semanticKeysAndHeaderInfoTitle.headerInfoTitlePath,\n\t\tsemanticKeys: semanticKeysAndHeaderInfoTitle.semanticKeyColumns,\n\t\theaderInfoTypeName: semanticKeysAndHeaderInfoTitle.headerInfoTypeName,\n\t\tenable$select: true,\n\t\tenable$$getKeepAliveContext: true,\n\t\theader: header,\n\t\theaderVisible: tableManifestConfig.headerVisible,\n\t\trequestAtLeast: createRequestedProperties(lineItemAnnotation, converterContext, operationAvailable, presentationVariantAnnotation),\n\t\thandlePatchSent: converterContext.getManifestWrapper().getTemplateType() !== TemplateType.ListReport\n\t};\n\tupdateLinkedProperties(converterContext, columns);\n\tupdateTableVisualizationForType(\n\t\toVisualization,\n\t\tconverterContext.getAnnotationEntityType(lineItemAnnotation),\n\t\tconverterContext,\n\t\tpresentationVariantAnnotation\n\t);\n\treturn oVisualization;\n}\nexport function createDefaultTableVisualization(\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tisBlankTable?: boolean\n): TableVisualization {\n\tconst tableManifestConfig = getTableManifestConfiguration(undefined, \"\", converterContext, false);\n\tconst columns = getColumnsFromEntityType(\n\t\t{},\n\t\tconverterContext.getEntityType(),\n\t\t[],\n\t\tconverterContext,\n\t\ttableManifestConfig.type,\n\t\ttableManifestConfig.creationMode,\n\t\t{}\n\t);\n\tconst operationAvailableMap = getOperationAvailableMap(undefined, converterContext);\n\tconst semanticKeysAndHeaderInfoTitle = getSemanticKeysAndTitleInfo(converterContext);\n\tconst navigationTargetPath = getNavigationTargetPath(converterContext, \"\");\n\tconst navigationSettings = converterContext.getManifestWrapper().getNavigationConfiguration(navigationTargetPath);\n\tconst standardActionsConfiguration = getStandardActionsConfiguration(\n\t\tundefined,\n\t\t\"\",\n\t\tconverterContext,\n\t\ttableManifestConfig,\n\t\tnavigationSettings\n\t);\n\tconst oVisualization: TableVisualization = {\n\t\ttype: VisualizationType.Table,\n\t\tannotation: getTableAnnotationConfiguration(\n\t\t\tundefined,\n\t\t\t\"\",\n\t\t\tconverterContext,\n\t\t\ttableManifestConfig,\n\t\t\tisBlankTable ? [] : columns,\n\t\t\tnavigationSettings,\n\t\t\tstandardActionsConfiguration\n\t\t),\n\t\tcontrol: tableManifestConfig,\n\t\tactions: [],\n\t\tcolumns: columns,\n\t\toperationAvailableMap: JSON.stringify(operationAvailableMap),\n\t\toperationAvailableProperties: getOperationAvailableProperties(operationAvailableMap, converterContext),\n\t\theaderInfoTitle: semanticKeysAndHeaderInfoTitle.headerInfoTitlePath,\n\t\tsemanticKeys: semanticKeysAndHeaderInfoTitle.semanticKeyColumns,\n\t\theaderInfoTypeName: semanticKeysAndHeaderInfoTitle.headerInfoTypeName,\n\t\tenable$select: true,\n\t\tenable$$getKeepAliveContext: true,\n\t\theader: tableManifestConfig.header,\n\t\theaderVisible: tableManifestConfig.headerVisible,\n\t\thandlePatchSent: converterContext.getManifestWrapper().getTemplateType() !== TemplateType.ListReport\n\t};\n\tupdateLinkedProperties(converterContext, columns);\n\tupdateTableVisualizationForType(oVisualization, converterContext.getEntityType(), converterContext);\n\treturn oVisualization;\n}\n/**\n * Gets the map of Core.OperationAvailable property paths for all DataFieldForActions.\n * @param lineItemAnnotation The instance of the line item\n * @param converterContext The instance of the converter context\n * @returns The record containing all action names and their corresponding Core.OperationAvailable property paths\n */\nfunction getOperationAvailableMap(\n\tlineItemAnnotation: LineItem | undefined,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): Record<string, unknown> {\n\treturn ActionHelper.getOperationAvailableMap(lineItemAnnotation, \"table\", converterContext);\n}\n/**\n * Gets updatable propertyPath for the current entityset if valid.\n * @param converterContext The instance of the converter context\n * @returns The updatable property for the rows\n */\nfunction getCurrentEntitySetUpdatablePath(converterContext: ConverterContext<PageContextPathTarget>): string {\n\tconst restrictions = getRestrictions(converterContext);\n\tconst entitySet = converterContext.getEntitySet();\n\tconst updatable = restrictions.isUpdatable;\n\tconst isOnlyDynamicOnCurrentEntity = !isConstant(updatable.expression) && updatable.navigationExpression._type === \"Unresolvable\";\n\tconst updatableExpression = entitySet?.annotations.Capabilities?.UpdateRestrictions?.Updatable;\n\tconst updatablePropertyPath = isPathAnnotationExpression(updatableExpression) && updatableExpression.path;\n\treturn isOnlyDynamicOnCurrentEntity ? (updatablePropertyPath as string) : \"\";\n}\n/**\n * Method to retrieve all property paths assigned to the Core.OperationAvailable annotation.\n * @param operationAvailableMap The record consisting of actions and their Core.OperationAvailable property paths\n * @param converterContext The instance of the converter context\n * @returns The CSV string of all property paths associated with the Core.OperationAvailable annotation\n */\nfunction getOperationAvailableProperties(\n\toperationAvailableMap: Record<string, unknown>,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): string {\n\tconst properties = new Set();\n\tfor (const actionName in operationAvailableMap) {\n\t\tconst propertyName = operationAvailableMap[actionName];\n\t\tif (propertyName === null) {\n\t\t\t// Annotation configured with explicit 'null' (action advertisement relevant)\n\t\t\tproperties.add(actionName);\n\t\t} else if (typeof propertyName === \"string\") {\n\t\t\t// Add property paths and not Constant values.\n\t\t\tproperties.add(propertyName);\n\t\t}\n\t}\n\tif (properties.size) {\n\t\t// Some actions have an operation available based on property --> we need to load the HeaderInfo.Title property\n\t\t// so that the dialog on partial actions is displayed properly (BCP 2180271425)\n\t\tconst entityType = converterContext.getEntityType();\n\t\tconst titleProperty = (entityType.annotations?.UI?.HeaderInfo?.Title as DataFieldTypes)?.Value?.path;\n\t\tif (titleProperty) {\n\t\t\tproperties.add(titleProperty);\n\t\t}\n\t}\n\treturn Array.from(properties).join(\",\");\n}\n/**\n * Iterates over the DataFieldForAction and DataFieldForIntentBasedNavigation of a line item and\n * returns all the UI.Hidden annotation expressions.\n * @param lineItemAnnotation Collection of data fields used for representation in a table or list\n * @param currentEntityType Current entity type\n * @param contextDataModelObjectPath Object path of the data model\n * @returns All the `UI.Hidden` path expressions found in the relevant actions\n */\nfunction getUIHiddenExpForActionsRequiringContext(\n\tlineItemAnnotation: LineItem,\n\tcurrentEntityType: EntityType,\n\tcontextDataModelObjectPath: DataModelObjectPath<PageContextPathTarget>\n): BindingToolkitExpression<boolean>[] {\n\tconst aUiHiddenPathExpressions: BindingToolkitExpression<boolean>[] = [];\n\tlineItemAnnotation.forEach((dataField) => {\n\t\t// Check if the lineItem context is the same as that of the action:\n\t\tif (\n\t\t\t(dataField.$Type === UIAnnotationTypes.DataFieldForAction &&\n\t\t\t\tdataField?.ActionTarget?.isBound &&\n\t\t\t\tcurrentEntityType === dataField?.ActionTarget.sourceEntityType) ||\n\t\t\t(dataField.$Type === UIAnnotationTypes.DataFieldForIntentBasedNavigation &&\n\t\t\t\tdataField.RequiresContext &&\n\t\t\t\tdataField?.Inline?.valueOf() !== true)\n\t\t) {\n\t\t\tif (typeof dataField.annotations?.UI?.Hidden?.valueOf() === \"object\") {\n\t\t\t\taUiHiddenPathExpressions.push(equal(getHiddenExpressionAtTableLevel(dataField, contextDataModelObjectPath), false));\n\t\t\t}\n\t\t}\n\t});\n\treturn aUiHiddenPathExpressions;\n}\n/**\n * This method is used to get the binding expression of the path of a DataField.\n * @param expression CompiledBindingToolkitExpression\n * @returns The binding expression\n */\nfunction getPathFromActionAnnotation(expression: CompiledBindingToolkitExpression): CompiledBindingToolkitExpression {\n\tlet path: CompiledBindingToolkitExpression;\n\tif (isPathAnnotationExpression(expression)) {\n\t\tpath = expression.path;\n\t} else {\n\t\tpath = expression;\n\t}\n\treturn path;\n}\n/**\n * This method is used to change the context currently referenced by this binding by removing the last navigation property.\n *\n * It is used (specifically in this case), to transform a binding made for a NavProp context /MainObject/NavProp1/NavProp2,\n * into a binding on the previous context /MainObject/NavProp1.\n * @param source DataFieldForAction | DataFieldForIntentBasedNavigation | CustomAction\n * @param contextDataModelObjectPath DataModelObjectPath\n * @returns The binding expression\n */\nfunction getHiddenExpressionAtTableLevel(\n\tsource: DataFieldAbstractTypes,\n\tcontextDataModelObjectPath: DataModelObjectPath<PageContextPathTarget>\n): BindingToolkitExpression<unknown> {\n\tconst expression = source.annotations?.UI?.Hidden as CompiledBindingToolkitExpression;\n\tlet path = getPathFromActionAnnotation(expression);\n\tif (typeof path === \"object\") {\n\t\treturn constant(false);\n\t} else if (typeof path === \"string\") {\n\t\tif (\"visible\" in source) {\n\t\t\tpath = path.substring(1, path.length - 1);\n\t\t}\n\t\tif (path.indexOf(\"/\") > 0) {\n\t\t\t//check if the navigation property is correct:\n\t\t\tconst splitPathForNavigationProperty = path.split(\"/\");\n\t\t\tconst navigationPath = splitPathForNavigationProperty[0];\n\t\t\tif (\n\t\t\t\tisNavigationProperty(contextDataModelObjectPath?.targetObject) &&\n\t\t\t\tcontextDataModelObjectPath.targetObject.partner === navigationPath\n\t\t\t) {\n\t\t\t\treturn pathInModel(splitPathForNavigationProperty.slice(1).join(\"/\"));\n\t\t\t} else {\n\t\t\t\treturn constant(true);\n\t\t\t}\n\t\t} else {\n\t\t\treturn constant(false);\n\t\t}\n\t}\n\treturn constant(true);\n}\n/**\n * Loop through the manifest actions and check the following:\n *\n * If the data field is also referenced as a custom action.\n * If the underlying manifest action is either a bound action or has the 'RequiresContext' property set to true.\n *\n * If so, the 'requiresSelection' property is forced to 'true' in the manifest.\n * @param dataFieldId Id of the DataField evaluated\n * @param dataField DataField evaluated\n * @param manifestActions The actions defined in the manifest\n * @returns `true` if the DataField is found among the manifest actions\n */\nfunction updateManifestActionAndTagIt(\n\tdataFieldId: string,\n\tdataField: DataFieldForAction | DataFieldForIntentBasedNavigation,\n\tmanifestActions: Record<string, CustomAction>\n): boolean {\n\treturn Object.keys(manifestActions).some((actionKey) => {\n\t\tif (actionKey === dataFieldId) {\n\t\t\tif (\n\t\t\t\t(dataField as DataFieldForAction)?.ActionTarget?.isBound ||\n\t\t\t\t(dataField as DataFieldForIntentBasedNavigation)?.RequiresContext\n\t\t\t) {\n\t\t\t\tmanifestActions[dataFieldId].requiresSelection = true;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t});\n}\n/**\n * Loop through the DataFieldForAction and DataFieldForIntentBasedNavigation of a line item and\n * check the following:\n * If at least one of them is always visible in the table toolbar and requires a context\n * If an action is also defined in the manifest, it is set aside and will be considered\n * when going through the manifest.\n * @param lineItemAnnotation Collection of data fields for representation in a table or list\n * @param manifestActions The actions defined in the manifest\n * @param currentEntityType Current Entity Type\n * @returns `true` if there is at least 1 action that meets the criteria\n */\nfunction hasBoundActionsAlwaysVisibleInToolBar(\n\tlineItemAnnotation: LineItem,\n\tmanifestActions: Record<string, CustomAction>,\n\tcurrentEntityType: EntityType\n): boolean {\n\treturn lineItemAnnotation.some((dataField) => {\n\t\tif (\n\t\t\t(dataField.$Type === UIAnnotationTypes.DataFieldForAction ||\n\t\t\t\tdataField.$Type === UIAnnotationTypes.DataFieldForIntentBasedNavigation) &&\n\t\t\tdataField?.Inline?.valueOf() !== true &&\n\t\t\t(dataField.annotations?.UI?.Hidden?.valueOf() === false || dataField.annotations?.UI?.Hidden?.valueOf() === undefined)\n\t\t) {\n\t\t\tif (dataField.$Type === UIAnnotationTypes.DataFieldForAction) {\n\t\t\t\tconst manifestActionId = generate([\"DataFieldForAction\", dataField.Action as string]);\n\t\t\t\t// if the DataFieldForActon from annotation also exists in the manifest, its visibility will be evaluated later on\n\t\t\t\tif (updateManifestActionAndTagIt(manifestActionId, dataField, manifestActions)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\t// Check if the lineItem context is the same as that of the action:\n\t\t\t\treturn dataField?.ActionTarget?.isBound && currentEntityType === dataField?.ActionTarget.sourceEntityType;\n\t\t\t} else if (dataField.$Type === UIAnnotationTypes.DataFieldForIntentBasedNavigation) {\n\t\t\t\t// if the DataFieldForIntentBasedNavigation from annotation also exists in the manifest, its visibility will be evaluated later on\n\t\t\t\tif (\n\t\t\t\t\tupdateManifestActionAndTagIt(\n\t\t\t\t\t\t`DataFieldForIntentBasedNavigation::${dataField.SemanticObject}::${dataField.Action}`,\n\t\t\t\t\t\tdataField,\n\t\t\t\t\t\tmanifestActions\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\treturn dataField.RequiresContext;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t});\n}\n/**\n * Checks if a custom action that requires a context is always visible in the toolbar.\n * @param manifestActions The actions defined in the manifest\n * @returns `true` if there is at least 1 action that meets the criteria\n */\nfunction hasCustomActionsAlwaysVisibleInToolBar(manifestActions: Record<string, CustomAction>): boolean {\n\tconst customActions = Object.keys(manifestActions).reduce((actions: CustomAction[], actionKey) => {\n\t\tconst action = manifestActions[actionKey];\n\t\tif (!action.menu) {\n\t\t\t//simple custom action\n\t\t\tactions.push(action);\n\t\t} else {\n\t\t\t// grouped actions\n\t\t\tactions = [...actions, ...(action.menu.filter((menuAction) => typeof menuAction !== \"string\") as CustomAction[])];\n\t\t}\n\t\treturn actions;\n\t}, []);\n\treturn !!customActions.find(\n\t\t(action) => action.requiresSelection && (action.visible === undefined || action.visible?.toString() === \"true\")\n\t);\n}\n/**\n * Iterates over the custom actions (with key requiresSelection) declared in the manifest for the current line item and returns all the\n * visible key values as an expression.\n * @param manifestActions The actions defined in the manifest\n * @returns Array<Expression<boolean>> All the visible path expressions of the actions that meet the criteria\n */\nfunction getVisibleExpForCustomActionsRequiringContext(manifestActions: Record<string, CustomAction>): BindingToolkitExpression<boolean>[] {\n\tconst aVisiblePathExpressions: BindingToolkitExpression<boolean>[] = [];\n\tif (manifestActions) {\n\t\tObject.keys(manifestActions).forEach((actionKey) => {\n\t\t\tconst action = manifestActions[actionKey];\n\t\t\tif (action.requiresSelection === true && action.visible !== undefined) {\n\t\t\t\tif (typeof action.visible === \"string\") {\n\t\t\t\t\t/*The final aim would be to check if the path expression depends on the parent context\n\t\t\t\t\tand considers only those expressions for the expression evaluation,\n\t\t\t\t\tbut currently not possible from the manifest as the visible key is bound on the parent entity.\n\t\t\t\t\tTricky to differentiate the path as it's done for the Hidden annotation.\n\t\t\t\t\tFor the time being we consider all the paths of the manifest*/\n\t\t\t\t\taVisiblePathExpressions.push(resolveBindingString(action?.visible?.valueOf()));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\treturn aVisiblePathExpressions;\n}\n/**\n * Evaluate if the path is statically deletable or updatable.\n * @param converterContext\n * @returns The table capabilities\n */\nexport function getCapabilityRestriction(converterContext: ConverterContext<PageContextPathTarget>): TableCapabilityRestriction {\n\tconst isDeletable = isPathDeletable(converterContext.getDataModelObjectPath());\n\tconst isUpdatable = isPathUpdatable(converterContext.getDataModelObjectPath());\n\treturn {\n\t\tisDeletable: !(isConstant(isDeletable) && isDeletable.value === false),\n\t\tisUpdatable: !(isConstant(isUpdatable) && isUpdatable.value === false)\n\t};\n}\nexport function getSelectionMode(\n\tlineItemAnnotation: LineItem | undefined,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tisEntitySet: boolean,\n\ttargetCapabilities: TableCapabilityRestriction,\n\tdeleteButtonVisibilityExpression?: BindingToolkitExpression<boolean>,\n\tmassEditVisibilityExpression: BindingToolkitExpression<boolean> = constant(false),\n\tcutButtonVisibilityExpression: BindingToolkitExpression<boolean> = constant(false)\n): string | undefined {\n\tconst tableManifestSettings = converterContext.getManifestControlConfiguration<TableManifestConfiguration>(visualizationPath);\n\tconst tableType = tableManifestSettings.tableSettings?.type;\n\tlet selectionMode = tableManifestSettings.tableSettings?.selectionMode;\n\n\t// The collapse/Expand action of a tree table is a bound action, as a result, a tree table should always have a selection mode to \"Multi\" when no selectionMode has been set in the manifest\n\tif (tableType === \"TreeTable\" && !selectionMode) {\n\t\treturn SelectionMode.Multi;\n\t}\n\n\t// If the selection mode is forced to 'None' in the manifest/macro table parameters, we keep it unless here is a delete button\n\tif (!lineItemAnnotation || selectionMode === SelectionMode.None) {\n\t\tif (targetCapabilities.isDeletable && deleteButtonVisibilityExpression) {\n\t\t\treturn compileExpression(ifElse(deleteButtonVisibilityExpression, constant(SelectionMode.Multi), constant(SelectionMode.None)));\n\t\t}\n\t\treturn SelectionMode.None;\n\t}\n\tif (selectionMode === SelectionMode.ForceMulti) {\n\t\treturn SelectionMode.Multi;\n\t} else if (selectionMode === SelectionMode.ForceSingle) {\n\t\treturn SelectionMode.Single;\n\t}\n\tlet aHiddenBindingExpressions: BindingToolkitExpression<boolean>[] = [],\n\t\taVisibleBindingExpressions: BindingToolkitExpression<boolean>[] = [];\n\tconst manifestActions = getActionsFromManifest(\n\t\tconverterContext.getManifestControlConfiguration<TableManifestConfiguration>(visualizationPath).actions,\n\t\tconverterContext,\n\t\t[],\n\t\tundefined,\n\t\tfalse\n\t);\n\tlet isParentDeletable, parentEntitySetDeletable;\n\tif (converterContext.getTemplateType() === TemplateType.ObjectPage) {\n\t\tisParentDeletable = isPathDeletable(converterContext.getDataModelObjectPath());\n\t\tparentEntitySetDeletable = isParentDeletable ? compileExpression(isParentDeletable, true) : isParentDeletable;\n\t}\n\tconst bMassEditEnabled: boolean = !isConstant(massEditVisibilityExpression) || massEditVisibilityExpression.value !== false;\n\tif (!selectionMode || selectionMode === SelectionMode.Auto) {\n\t\tselectionMode = SelectionMode.Multi;\n\t}\n\tif (bMassEditEnabled) {\n\t\t// Override default selection mode when mass edit is visible\n\t\tselectionMode = selectionMode === SelectionMode.Single ? SelectionMode.Single : SelectionMode.Multi;\n\t}\n\tif (\n\t\thasBoundActionsAlwaysVisibleInToolBar(lineItemAnnotation, manifestActions.actions, converterContext.getEntityType()) ||\n\t\thasCustomActionsAlwaysVisibleInToolBar(manifestActions.actions)\n\t) {\n\t\treturn selectionMode;\n\t}\n\taHiddenBindingExpressions = getUIHiddenExpForActionsRequiringContext(\n\t\tlineItemAnnotation,\n\t\tconverterContext.getEntityType(),\n\t\tconverterContext.getDataModelObjectPath()\n\t);\n\taVisibleBindingExpressions = getVisibleExpForCustomActionsRequiringContext(manifestActions.actions);\n\t// No action requiring a context:\n\tif (\n\t\taHiddenBindingExpressions.length === 0 &&\n\t\taVisibleBindingExpressions.length === 0 &&\n\t\t(cutButtonVisibilityExpression || deleteButtonVisibilityExpression || bMassEditEnabled)\n\t) {\n\t\tif (!isEntitySet) {\n\t\t\t// Example: OP case\n\t\t\tif (targetCapabilities.isDeletable || parentEntitySetDeletable !== \"false\" || bMassEditEnabled) {\n\t\t\t\t// Building expression for delete and mass edit\n\t\t\t\tconst buttonVisibilityExpression = or(\n\t\t\t\t\tcutButtonVisibilityExpression || true,\n\t\t\t\t\tdeleteButtonVisibilityExpression || true, // default delete visibility as true\n\t\t\t\t\tmassEditVisibilityExpression\n\t\t\t\t);\n\t\t\t\treturn compileExpression(\n\t\t\t\t\tifElse(and(UI.IsEditable, buttonVisibilityExpression), constant(selectionMode), constant(SelectionMode.None))\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\treturn compileExpression(\n\t\t\t\t\tifElse(cutButtonVisibilityExpression, constant(SelectionMode.Single), constant(SelectionMode.None))\n\t\t\t\t);\n\t\t\t}\n\t\t\t// EntitySet deletable:\n\t\t} else if (bMassEditEnabled) {\n\t\t\t// example: LR scenario\n\t\t\treturn selectionMode;\n\t\t} else if (targetCapabilities.isDeletable && deleteButtonVisibilityExpression) {\n\t\t\treturn compileExpression(ifElse(deleteButtonVisibilityExpression, constant(selectionMode), constant(SelectionMode.None)));\n\t\t\t// EntitySet not deletable:\n\t\t} else {\n\t\t\treturn SelectionMode.None;\n\t\t}\n\t\t// There are actions requiring a context:\n\t} else if (!isEntitySet) {\n\t\t// Example: OP case\n\t\tif (targetCapabilities.isDeletable || parentEntitySetDeletable !== \"false\" || bMassEditEnabled) {\n\t\t\t// Use selectionMode in edit mode if delete is enabled or mass edit is visible\n\t\t\tconst editModebuttonVisibilityExpression = ifElse(\n\t\t\t\tbMassEditEnabled && !targetCapabilities.isDeletable,\n\t\t\t\tmassEditVisibilityExpression,\n\t\t\t\tconstant(true)\n\t\t\t);\n\t\t\treturn compileExpression(\n\t\t\t\tifElse(\n\t\t\t\t\tand(UI.IsEditable, editModebuttonVisibilityExpression),\n\t\t\t\t\tconstant(selectionMode),\n\t\t\t\t\tifElse(\n\t\t\t\t\t\tor(...aHiddenBindingExpressions.concat(aVisibleBindingExpressions)),\n\t\t\t\t\t\tconstant(selectionMode),\n\t\t\t\t\t\tconstant(SelectionMode.None)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\treturn compileExpression(\n\t\t\t\tifElse(\n\t\t\t\t\tor(...aHiddenBindingExpressions.concat(aVisibleBindingExpressions)),\n\t\t\t\t\tconstant(selectionMode),\n\t\t\t\t\tconstant(SelectionMode.None)\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t\t//EntitySet deletable:\n\t} else if (targetCapabilities.isDeletable || bMassEditEnabled) {\n\t\t// Example: LR scenario\n\t\treturn selectionMode;\n\t\t//EntitySet not deletable:\n\t} else {\n\t\treturn compileExpression(\n\t\t\tifElse(\n\t\t\t\tor(...aHiddenBindingExpressions.concat(aVisibleBindingExpressions), massEditVisibilityExpression),\n\t\t\t\tconstant(selectionMode),\n\t\t\t\tconstant(SelectionMode.None)\n\t\t\t)\n\t\t);\n\t}\n}\n\n/**\n * Method to retrieve all table actions from annotations.\n * @param lineItemAnnotation\n * @param visualizationPath\n * @param converterContext\n * @returns The table annotation actions\n */\nfunction getTableAnnotationActions(\n\tlineItemAnnotation: LineItem,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): { tableActions: Array<AnnotationAction | AnnotationActionGroup> } {\n\tconst tableActions: Array<AnnotationAction | AnnotationActionGroup> = [];\n\tconst copyDataField = getCopyAction(\n\t\tlineItemAnnotation.filter((dataField) => {\n\t\t\treturn dataFieldIsCopyAction(dataField as DataFieldForActionTypes);\n\t\t}) as DataFieldForActionTypes[]\n\t);\n\tif (copyDataField) {\n\t\ttableActions.push({\n\t\t\ttype: ActionType.Copy,\n\t\t\tannotationPath: converterContext.getEntitySetBasedAnnotationPath(copyDataField.fullyQualifiedName),\n\t\t\tkey: KeyHelper.generateKeyFromDataField(copyDataField),\n\t\t\tvisible: compileExpression(visibleExpression(copyDataField, converterContext)),\n\t\t\tvisibleForContextMenu: compileExpression(visibleForContextMenuExpression(copyDataField, converterContext)),\n\t\t\ttext: copyDataField.Label?.toString() ?? Library.getResourceBundleFor(\"sap.fe.core\")!.getText(\"C_COMMON_COPY\"),\n\t\t\tisNavigable: true\n\t\t});\n\t}\n\tlineItemAnnotation\n\t\t.filter((dataField) => {\n\t\t\treturn !dataFieldIsCopyAction(dataField as DataFieldForAction);\n\t\t})\n\t\t.forEach((dataField: DataFieldAbstractTypes) => {\n\t\t\tif (\n\t\t\t\tisDataFieldForActionAbstract(dataField) &&\n\t\t\t\tdataField.Inline?.valueOf() !== true &&\n\t\t\t\tdataField.Determining?.valueOf() !== true\n\t\t\t) {\n\t\t\t\tconst tableAction = getDataFieldAnnotationAction(dataField, converterContext);\n\t\t\t\tif (tableAction) {\n\t\t\t\t\ttableActions.push(tableAction);\n\t\t\t\t}\n\t\t\t} else if (isDataFieldForActionGroup(dataField)) {\n\t\t\t\tconst dataFieldGroup = getDataFieldAnnotationAction(dataField, converterContext);\n\t\t\t\tif (dataFieldGroup) {\n\t\t\t\t\ttableActions.push(dataFieldGroup);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\treturn {\n\t\ttableActions\n\t};\n}\n\n// For the context menu, the visibility should also consider the 'inactiveContext' property:\n// only when at least one selected context is active (i.e. \"contextmenu/inactiveContext\" is false), the action should be visible in the context menu\n// This is only relevant when the table manifest setting \"creationMode\" is \"InlineCreationRows\"\nfunction visibleForContextMenuExpression(\n\tdataField: DataFieldForAction | DataFieldForIntentBasedNavigation | DataFieldForActionGroup | undefined,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): BindingToolkitExpression<boolean> {\n\treturn and(visibleExpression(dataField, converterContext), equal(pathInModel(\"contextmenu/inactiveContext\", \"internal\"), false));\n}\n\nfunction getDataFieldAnnotationAction(\n\tdataField: DataFieldAbstractTypes,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): AnnotationAction | AnnotationActionGroup | void {\n\tswitch (dataField.$Type) {\n\t\tcase UIAnnotationTypes.DataFieldForAction:\n\t\t\tconst tableAction: AnnotationAction = {\n\t\t\t\ttype: ActionType.DataFieldForAction,\n\t\t\t\tannotationPath: converterContext.getEntitySetBasedAnnotationPath(dataField.fullyQualifiedName),\n\t\t\t\tkey: KeyHelper.generateKeyFromDataField(dataField),\n\t\t\t\tvisible: compileExpression(visibleExpression(dataField, converterContext)),\n\t\t\t\tvisibleForContextMenu: compileExpression(visibleForContextMenuExpression(dataField, converterContext)),\n\t\t\t\tisNavigable: true\n\t\t\t};\n\t\t\tconst sEntityType = converterContext.getEntityType().fullyQualifiedName;\n\t\t\tif (_useEnabledExpression(dataField, sEntityType)) {\n\t\t\t\ttableAction.enabled = getEnabledForAnnotationAction(converterContext, dataField.ActionTarget, true);\n\t\t\t}\n\t\t\treturn tableAction;\n\t\tcase UIAnnotationTypes.DataFieldForIntentBasedNavigation:\n\t\t\treturn {\n\t\t\t\ttype: ActionType.DataFieldForIntentBasedNavigation,\n\t\t\t\tannotationPath: converterContext.getEntitySetBasedAnnotationPath(dataField.fullyQualifiedName),\n\t\t\t\tkey: KeyHelper.generateKeyFromDataField(dataField),\n\t\t\t\tvisible: compileExpression(visibleExpression(dataField, converterContext)),\n\t\t\t\tvisibleForContextMenu: compileExpression(visibleForContextMenuExpression(dataField, converterContext))\n\t\t\t};\n\t\tcase UIAnnotationTypes.DataFieldForActionGroup:\n\t\t\treturn {\n\t\t\t\ttype: ActionType.Menu,\n\t\t\t\tkey: KeyHelper.generateKeyFromDataField(dataField),\n\t\t\t\tid: KeyHelper.generateKeyFromDataField(dataField),\n\t\t\t\ttext: dataField.Label?.toString(),\n\t\t\t\tvisible: compileExpression(visibleExpression(dataField, converterContext)),\n\t\t\t\tvisibleForContextMenu: compileExpression(visibleForContextMenuExpression(dataField, converterContext)),\n\t\t\t\tmenu: dataField.Actions.map((action) => getDataFieldAnnotationAction(action, converterContext))\n\t\t\t} as AnnotationActionGroup;\n\t\tdefault:\n\t\t\treturn;\n\t}\n}\n\n/**\n * Generate the bindingExpression for the highlight rowSetting parameter.\n * @param criticalityAnnotation Path or value of the criticality\n * @param isDraftRootOrNode  Is the current entitySet an Draft root or a node\n * @param targetEntityType The targeted entityType\n * @returns An expressionBinding\n */\nfunction getHighlightRowBinding(\n\tcriticalityAnnotation: Criticality | undefined,\n\tisDraftRootOrNode: boolean,\n\ttargetEntityType?: EntityType\n): BindingToolkitExpression<MessageType> {\n\tlet defaultHighlightRowDefinition: MessageType | BindingToolkitExpression<MessageType> = MessageType.None;\n\tif (criticalityAnnotation) {\n\t\tif (typeof criticalityAnnotation === \"object\") {\n\t\t\tdefaultHighlightRowDefinition = getExpressionFromAnnotation(criticalityAnnotation) as BindingToolkitExpression<MessageType>;\n\t\t} else {\n\t\t\t// Enum Value so we get the corresponding static part\n\t\t\tdefaultHighlightRowDefinition = getMessageTypeFromCriticalityType(criticalityAnnotation);\n\t\t}\n\t}\n\treturn formatResult(\n\t\t[\n\t\t\tdefaultHighlightRowDefinition,\n\t\t\tpathInModel(`filteredMessages`, \"internal\"),\n\t\t\tisDraftRootOrNode && Entity.HasActive,\n\t\t\tisDraftRootOrNode && Entity.IsActive,\n\t\t\t`${isDraftRootOrNode}`,\n\t\t\tpathInModel(\"@$ui5.fe.contextPath\"),\n\t\t\tUI.IsInactive\n\t\t],\n\t\ttableFormatters.rowHighlighting,\n\t\ttargetEntityType\n\t);\n}\nfunction _getCreationBehaviour(\n\tlineItemAnnotation: LineItem | undefined,\n\ttableManifestConfiguration: TableControlConfiguration,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tnavigationSettings: NavigationSettingsConfiguration,\n\tvisualizationPath: string\n): TableAnnotationConfiguration[\"create\"] {\n\tconst navigation = navigationSettings?.create || navigationSettings?.detail;\n\tconst tableManifestSettings: TableManifestConfiguration = converterContext.getManifestControlConfiguration(visualizationPath);\n\tconst originalTableSettings = (tableManifestSettings && tableManifestSettings.tableSettings) || {};\n\t// cross-app\n\tif (navigation?.outbound && navigation.outboundDetail && navigationSettings?.create) {\n\t\treturn {\n\t\t\tmode: \"External\",\n\t\t\toutbound: navigation.outbound,\n\t\t\toutboundDetail: navigation.outboundDetail,\n\t\t\tnavigationSettings: navigationSettings\n\t\t};\n\t}\n\tif (\n\t\tconverterContext.getTemplateType() === TemplateType.ListReport &&\n\t\t![CreationMode.NewPage, CreationMode.External, CreationMode.CreationDialog].includes(tableManifestConfiguration.creationMode)\n\t) {\n\t\t// Fallback to \"NewPage\"\n\t\tLog.warning(\n\t\t\t`Creation mode '${tableManifestConfiguration.creationMode}' can not be used within the List Report. Instead, the default mode \"NewPage\" is used.`\n\t\t);\n\t\ttableManifestConfiguration.creationMode = CreationMode.NewPage;\n\t} else if (\n\t\tconverterContext.getTemplateType() !== TemplateType.ListReport &&\n\t\ttableManifestConfiguration.type === \"TreeTable\" &&\n\t\t![CreationMode.NewPage, CreationMode.Inline, CreationMode.CreationDialog].includes(tableManifestConfiguration.creationMode)\n\t) {\n\t\t// Fallback to \"NewPage\" in case of a non-supported mode for a TreeTable\n\t\tLog.warning(\n\t\t\t`Creation mode '${tableManifestConfiguration.creationMode}' can not be used with a Tree Table. Instead, the default mode \"NewPage\" is used.`\n\t\t);\n\t\ttableManifestConfiguration.creationMode = CreationMode.NewPage;\n\t}\n\tlet newAction;\n\tif (lineItemAnnotation) {\n\t\t// in-app\n\t\tconst targetAnnotations = converterContext.getEntitySet()?.annotations;\n\t\tconst targetAnnotationsCommon = targetAnnotations?.Common as EntitySetAnnotations_Common,\n\t\t\ttargetAnnotationsSession = targetAnnotations?.Session as EntitySetAnnotations_Session;\n\t\tnewAction = targetAnnotationsCommon?.DraftRoot?.NewAction || targetAnnotationsSession?.StickySessionSupported?.NewAction;\n\t\tif (tableManifestConfiguration.creationMode === CreationMode.CreationRow && newAction) {\n\t\t\t// A combination of 'CreationRow' and 'NewAction' does not make sense\n\t\t\tthrow Error(`Creation mode '${CreationMode.CreationRow}' can not be used with a custom 'new' action (${newAction})`);\n\t\t}\n\t\tif (navigation?.route) {\n\t\t\t// route specified\n\t\t\treturn {\n\t\t\t\tmode: tableManifestConfiguration.creationMode,\n\t\t\t\tappend: tableManifestConfiguration.createAtEnd,\n\t\t\t\tnewAction: newAction?.toString(),\n\t\t\t\tnavigateToTarget: tableManifestConfiguration.creationMode === CreationMode.NewPage ? navigation.route : undefined // navigate only in NewPage mode\n\t\t\t};\n\t\t}\n\t}\n\t// no navigation or no route specified - fallback to inline create if original creation mode was 'NewPage'\n\tif (tableManifestConfiguration.creationMode === CreationMode.NewPage) {\n\t\tif (converterContext.getTemplateType() === TemplateType.ListReport) {\n\t\t\tLog.error(\"The creation mode 'NewPage' is used but the navigation configuration to the sub page is missing.\");\n\t\t} else {\n\t\t\ttableManifestConfiguration.creationMode = CreationMode.Inline;\n\t\t\t// In case there was no specific configuration for the createAtEnd we force it to false\n\t\t\tif (originalTableSettings.creationMode?.createAtEnd === undefined) {\n\t\t\t\ttableManifestConfiguration.createAtEnd = false;\n\t\t\t}\n\t\t\tLog.info(\"The creation mode was changed from 'NewPage' to 'Inline' due to missing navigation configuration to the sub page.\");\n\t\t}\n\t}\n\treturn {\n\t\tmode: tableManifestConfiguration.creationMode,\n\t\tappend: tableManifestConfiguration.createAtEnd,\n\t\tnewAction: newAction?.toString()\n\t};\n}\nconst _getRowConfigurationProperty = function (\n\tlineItemAnnotation: LineItem | undefined,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tnavigationSettings: NavigationSettingsConfiguration,\n\ttargetPath: string,\n\ttableType: TableType\n): RowConfiguration {\n\tlet navigationInfo: RowNavigationInfo | undefined;\n\tlet criticalityProperty: BindingToolkitExpression<MessageType> = constant(MessageType.None);\n\tconst targetEntityType = converterContext.getEntityType();\n\tconst criticalityAnnotation = lineItemAnnotation?.annotations?.UI?.Criticality;\n\tif (navigationSettings && lineItemAnnotation) {\n\t\tconst navigationTarget = navigationSettings.display?.target || navigationSettings.detail?.outbound;\n\t\tconst targetEntitySet = converterContext.getEntitySet();\n\t\tcriticalityProperty = getHighlightRowBinding(\n\t\t\tcriticalityAnnotation,\n\t\t\t!!ModelHelper.getDraftRoot(targetEntitySet) || !!ModelHelper.getDraftNode(targetEntitySet),\n\t\t\ttargetEntityType\n\t\t);\n\t\tif (navigationTarget) {\n\t\t\tnavigationInfo = { type: \"Outbound\", navigationTarget };\n\t\t}\n\t\tif (!navigationTarget && navigationSettings.detail?.route) {\n\t\t\tconst checkEditable =\n\t\t\t\tModelHelper.getDraftRoot(targetEntitySet) !== undefined || ModelHelper.getDraftNode(targetEntitySet) !== undefined;\n\t\t\tnavigationInfo = {\n\t\t\t\ttype: \"Navigation\",\n\t\t\t\troutePath: navigationSettings.detail.route,\n\t\t\t\ttargetPath,\n\t\t\t\tcheckEditable,\n\t\t\t\trecreateContext: tableType === \"AnalyticalTable\"\n\t\t\t};\n\t\t}\n\t}\n\tconst rowNavigatedExpression: BindingToolkitExpression<boolean> = formatResult(\n\t\t[pathInModel(\"/deepestPath\", \"internal\")],\n\t\ttableFormatters.navigatedRow,\n\t\ttargetEntityType\n\t);\n\treturn {\n\t\tnavigationInfo,\n\t\taction: navigationInfo ? \"Navigation\" : undefined,\n\t\trowHighlighting: compileExpression(criticalityProperty),\n\t\trowNavigated: compileExpression(rowNavigatedExpression),\n\t\trowCriticalityForInsights: criticalityAnnotation ? criticalityExpressionForIntegrationCards(criticalityAnnotation) : undefined,\n\t\tvisible: compileExpression(not(UI.IsInactive))\n\t};\n};\n/**\n * Retrieve the columns from the entityType.\n * @param columnsToBeCreated The columns to be created.\n * @param entityType The target entity type.\n * @param annotationColumns The array of columns created based on LineItem annotations.\n * @param converterContext The converter context.\n * @param tableType The table type.\n * @param tableCreationMode The creation mode of the table.\n * @param displayModeOfDescriptionPropertiesMap The map of properties referenced as description on a text arrangement annotation.\n * @param restrictionsOnProperties The existing restrictions on properties\n * @returns The column from the entityType\n */\nexport const getColumnsFromEntityType = function (\n\tcolumnsToBeCreated: Record<string, Property>,\n\tentityType: EntityType,\n\tannotationColumns: AnnotationTableColumn[],\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\ttableType: TableType,\n\ttableCreationMode: CreationMode,\n\tdisplayModeOfDescriptionPropertiesMap: Record<string, DisplayMode>,\n\trestrictionsOnProperties?: RestrictionsOnProperties\n): AnnotationTableColumn[] {\n\tif (annotationColumns === undefined) {\n\t\tannotationColumns = [];\n\t}\n\n\tlet propertiesNotToBeConsidered: string[] = [];\n\tconst tableColumns: (AnnotationTableColumn | TechnicalColumn)[] = annotationColumns;\n\tconst aggregationHelper = new AggregationHelper(entityType, converterContext);\n\tconst groupableProperties = aggregationHelper.getGroupableProperties();\n\t//For Analytical table, we exclude all properties that are not groupable and used as Text in a groupable Property.\n\tif (tableType === \"AnalyticalTable\" && aggregationHelper.isAnalyticsSupported() && groupableProperties) {\n\t\tpropertiesNotToBeConsidered = groupableProperties\n\t\t\t.map((property) => property.$target)\n\t\t\t.filter((target) => target !== undefined)\n\t\t\t.map((target) => getAssociatedTextProperty(target as Property))\n\t\t\t.filter((textProp) => textProp && !aggregationHelper.isPropertyGroupable(textProp))\n\t\t\t.map((prop) => prop?.name)\n\t\t\t.filter((name) => name !== undefined) as string[];\n\t}\n\tentityType.entityProperties.forEach((property: Property) => {\n\t\t// Catch already existing columns - which were added before by LineItem Annotations\n\t\tconst exists = annotationColumns.some((column) => {\n\t\t\treturn column.name === property.name;\n\t\t});\n\t\t// if target type exists, it is a complex property and should be ignored\n\t\tif (!property.targetType && !exists && !propertiesNotToBeConsidered.includes(property.name)) {\n\t\t\tconst relatedPropertiesInfo: ComplexPropertyInfo = collectRelatedProperties(\n\t\t\t\tproperty.name,\n\t\t\t\tproperty,\n\t\t\t\tconverterContext,\n\t\t\t\ttrue,\n\t\t\t\ttableType\n\t\t\t);\n\t\t\tconst relatedPropertyNames: string[] = Object.keys(relatedPropertiesInfo.properties);\n\t\t\tconst additionalPropertyNames: string[] = Object.keys(relatedPropertiesInfo.additionalProperties);\n\t\t\t// Include the text properties and their corresponding text arrangement\n\t\t\trelatedPropertyNames.forEach((name) => {\n\t\t\t\taddPropertyToDisplayModeOfDescriptionPropertiesMap(displayModeOfDescriptionPropertiesMap, relatedPropertiesInfo, name);\n\t\t\t});\n\n\t\t\tconst columnInfo = getColumnDefinitionFromProperty(\n\t\t\t\tproperty,\n\t\t\t\tconverterContext.getEntitySetBasedAnnotationPath(property.fullyQualifiedName),\n\t\t\t\tproperty.name,\n\t\t\t\ttrue,\n\t\t\t\ttrue,\n\t\t\t\taggregationHelper,\n\t\t\t\tconverterContext,\n\t\t\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\t\t\trestrictionsOnProperties,\n\t\t\t\ttableCreationMode,\n\t\t\t\trelatedPropertiesInfo\n\t\t\t);\n\t\t\tif (relatedPropertyNames.length > 0) {\n\t\t\t\tcolumnInfo.propertyInfos = relatedPropertyNames;\n\t\t\t\tif (relatedPropertiesInfo.exportSettings.dataPointTargetValue) {\n\t\t\t\t\tcolumnInfo.exportDataPointTargetValue = relatedPropertiesInfo.exportSettings.dataPointTargetValue;\n\t\t\t\t}\n\t\t\t\t// Collect information of related columns to be created.\n\t\t\t\trelatedPropertyNames.forEach((name) => {\n\t\t\t\t\tcolumnsToBeCreated[name] = relatedPropertiesInfo.properties[name].annotationProperty;\n\t\t\t\t});\n\t\t\t}\n\t\t\t// update Property Label when it's referenced only once in a column, new label will be the label of the column\n\t\t\tupdatePropertyLabel(annotationColumns, columnsToBeCreated, columnInfo);\n\t\t\tif (additionalPropertyNames.length > 0) {\n\t\t\t\tcolumnInfo.additionalPropertyInfos = additionalPropertyNames;\n\t\t\t\t// Create columns for additional properties identified for ALP use case.\n\t\t\t\tadditionalPropertyNames.forEach((additionalPropertyName) => {\n\t\t\t\t\t// Intentional overwrite as we require only one new PropertyInfo for a related Property.\n\t\t\t\t\tcolumnsToBeCreated[additionalPropertyName] = relatedPropertiesInfo.additionalProperties[additionalPropertyName];\n\t\t\t\t});\n\t\t\t}\n\t\t\ttableColumns.push(columnInfo);\n\t\t}\n\t\t// In case a property has defined a #TextOnly text arrangement that points to a text property (and not a 'hard coded text') don't only create the complex property with the text property as a child property,\n\t\t// but also the property itself as it can be used as within the sortConditions or on custom columns.\n\t\t// This step must be valid also from the columns added via LineItems or from a column available on the p13n.\n\t\tif (getDisplayMode(property) === \"Description\") {\n\t\t\trestrictionsOnProperties?.nonSortableProperties.push(property.name);\n\t\t\tif (isPathAnnotationExpression(property?.annotations?.Common?.Text)) {\n\t\t\t\ttableColumns.push(\n\t\t\t\t\tgetColumnDefinitionFromProperty(\n\t\t\t\t\t\tproperty,\n\t\t\t\t\t\tconverterContext.getEntitySetBasedAnnotationPath(property.fullyQualifiedName),\n\t\t\t\t\t\tproperty.name,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t\taggregationHelper,\n\t\t\t\t\t\tconverterContext,\n\t\t\t\t\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\t\t\t\t\trestrictionsOnProperties,\n\t\t\t\t\t\ttableCreationMode\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t});\n\t// Create a propertyInfo for each related property.\n\tconst relatedColumns = _createRelatedColumns(\n\t\tcolumnsToBeCreated,\n\t\ttableColumns,\n\t\tconverterContext,\n\t\tentityType,\n\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\ttableCreationMode,\n\t\trestrictionsOnProperties\n\t);\n\treturn tableColumns.concat(relatedColumns);\n};\n/**\n * Create a column definition from a property.\n * @param property Entity type property for which the column is created\n * @param fullPropertyPath The full path to the target property\n * @param relativePath The relative path to the target property based on the context\n * @param useDataFieldPrefix Should be prefixed with \"DataField::\", else it will be prefixed with \"Property::\"\n * @param availableForAdaptation Decides whether the column should be available for adaptation\n * @param aggregationHelper The aggregationHelper for the entity\n * @param converterContext The converter context\n * @param displayModeOfDescriptionPropertiesMap The map of properties referenced as description on a text arrangement annotation\n * @param restrictionsOnProperties The existing restrictions on properties\n * @param tableCreationMode The creation mode of the table\n * @param relatedPropertiesInfo The properties identified so far for the column\n * @param relativePathForMultiValue The MDC path used for the 1:n property to allow filtering from MDC\n * @returns The annotation column definition\n */\nconst getColumnDefinitionFromProperty = function (\n\tproperty: Property,\n\tfullPropertyPath: string,\n\trelativePath: string,\n\tuseDataFieldPrefix: boolean,\n\tavailableForAdaptation: boolean,\n\taggregationHelper: AggregationHelper,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tdisplayModeOfDescriptionPropertiesMap: Record<string, DisplayMode>,\n\trestrictionsOnProperties?: RestrictionsOnProperties,\n\ttableCreationMode?: CreationMode,\n\trelatedPropertiesInfo?: ComplexPropertyInfo,\n\trelativePathForMultiValue?: string\n): AnnotationTableColumn | TechnicalColumn {\n\tlet name, key;\n\tconst semanticObjectAnnotationPath = getSemanticObjectPath(converterContext, property);\n\tconst isHidden = isReferencePropertyStaticallyHidden(property);\n\tconst groupPath: string | undefined = property.name ? _sliceAtSlash(property.name, true, false) : undefined;\n\tconst isGroup: boolean = groupPath != property.name;\n\tconst label = getLabel(property, isGroup);\n\tconst dataType: string | undefined = getDataFieldDataType(property);\n\tconst propertyTypeConfig = getTypeConfig(property, dataType);\n\tconst isAPropertyFromTextOnlyAnnotation = displayModeOfDescriptionPropertiesMap[relativePath] === \"Description\";\n\tconst sortable =\n\t\t(!isHidden || isAPropertyFromTextOnlyAnnotation) && !restrictionsOnProperties?.nonSortableProperties.includes(relativePath);\n\tconst filterable = !isAPropertyFromTextOnlyAnnotation && !restrictionsOnProperties?.nonFilterableProperties.includes(relativePath);\n\tconst typeConfig = {\n\t\tclassName: property.type || dataType,\n\t\tformatOptions: propertyTypeConfig.formatOptions,\n\t\tconstraints: propertyTypeConfig.constraints\n\t};\n\tlet exportSettings: ColumnExportSettings | null = null;\n\tif (_isExportableColumn(property)) {\n\t\texportSettings = createColumnExportSettings(property, relatedPropertiesInfo);\n\t}\n\tconst availability: AvailabilityType =\n\t\t!availableForAdaptation || isHidden || displayModeOfDescriptionPropertiesMap[relativePath] ? \"Hidden\" : \"Adaptation\";\n\tconst collectedNavigationPropertyLabels: string[] | undefined = _getCollectedNavigationPropertyLabels(relativePath, converterContext);\n\tif (relativePathForMultiValue) {\n\t\tname = relativePathForMultiValue;\n\t\tkey = \"DataField::\" + replaceSpecialChars(relativePathForMultiValue);\n\t\trelativePath = relativePathForMultiValue;\n\t} else {\n\t\tname = useDataFieldPrefix ? relativePath : `Property::${relativePath}`;\n\t\tkey = (useDataFieldPrefix ? \"DataField::\" : \"Property::\") + replaceSpecialChars(relativePath);\n\t}\n\n\tconst column: AnnotationTableColumn = {\n\t\tkey: key,\n\t\ttype: ColumnType.Annotation,\n\t\tlabel: label,\n\t\tgroupLabel: isGroup ? getLabel(property) : undefined,\n\t\tgroup: isGroup ? groupPath : undefined,\n\t\tannotationPath: fullPropertyPath,\n\t\tsemanticObjectPath: semanticObjectAnnotationPath,\n\t\tavailability: availability,\n\t\tname: name,\n\t\trelativePath: relativePath,\n\t\tsortable: sortable,\n\t\tfilterable: filterable,\n\t\tisGroupable: aggregationHelper.isAnalyticsSupported() ? !!aggregationHelper.isPropertyGroupable(property) : sortable,\n\t\tisKey: property.isKey,\n\t\texportSettings: exportSettings,\n\t\tcaseSensitive: isFilteringCaseSensitive(converterContext),\n\t\ttypeConfig: typeConfig as PropertyTypeConfig,\n\t\timportance: getImportance(converterContext, property.annotations?.UI?.DataFieldDefault),\n\t\trequired: isRequiredColumn(converterContext, property, tableCreationMode),\n\t\tadditionalLabels: collectedNavigationPropertyLabels\n\t};\n\t_addToolTip(property, column);\n\t_setExportSettingsForDataPoint(property, column);\n\n\tif (\n\t\taggregationHelper.isAnalyticsSupported() &&\n\t\tModelHelper.isObjectPathDraftSupported(converterContext.getDataModelObjectPath()) &&\n\t\t(relativePath === \"HasActiveEntity\" || relativePath === \"HasDraftEntity\")\n\t) {\n\t\t// In case of analytical table on a draft-enabled entity, we always consider the HasDraftEntity and HasActiveEntity properties as\n\t\t// technically groupable, as we need to load them for our internal logic.\n\t\tconst enhancedColumn = column as TechnicalColumn;\n\t\tenhancedColumn.extension = {\n\t\t\ttechnicallyAggregatable: false,\n\t\t\ttechnicallyGroupable: true\n\t\t};\n\t\treturn enhancedColumn;\n\t} else {\n\t\treturn column;\n\t}\n};\n/**\n * Create the export settings for a given column.\n * @param column The given column from a line item as a data field or a property from the entity type\n * @param relatedPropertiesInfo The related properties linked to the column (named also complex property)\n * @returns The export settings in a the given column\n */\nconst createColumnExportSettings = function (\n\tcolumn: Property | DataFieldAbstractTypes,\n\trelatedPropertiesInfo?: ComplexPropertyInfo\n): ColumnExportSettings {\n\tlet unitProperty, timezoneProperty, unitText, timezoneText, utc, isATimezone, currencyProperty, scale;\n\tconst relatedPropertyNames = relatedPropertiesInfo ? Object.keys(relatedPropertiesInfo.properties) : [];\n\tif (relatedPropertiesInfo && relatedPropertyNames?.length === 1) {\n\t\t// Create the export settings of a column based on the related (child) property in case there is only one.\n\t\t// This is required when we have a text only annotation to compute the export settings from the text instead of the value\n\t\tcolumn = relatedPropertiesInfo.properties[relatedPropertyNames[0]].annotationProperty;\n\t}\n\tconst dataType = getDataFieldDataType(column);\n\tif (isProperty(column)) {\n\t\tunitProperty = getAssociatedUnitProperty(column);\n\t\tcurrencyProperty = getAssociatedCurrencyProperty(column);\n\t\ttimezoneProperty = getAssociatedTimezoneProperty(column);\n\t\tunitText = getStaticUnitOrCurrency(column);\n\t\ttimezoneText = getStaticTimezone(column);\n\t\tisATimezone = isTimezone(column);\n\t\tscale = column.scale;\n\t}\n\tunitProperty = relatedPropertiesInfo?.exportSettings?.unitProperty ?? unitProperty?.name ?? currencyProperty?.name;\n\ttimezoneProperty = relatedPropertiesInfo?.exportSettings?.timezoneProperty ?? timezoneProperty?.name;\n\tscale = relatedPropertiesInfo?.exportSettings?.scale ?? scale;\n\tconst exportType = getExportDataType(dataType, isATimezone, !!currencyProperty, relatedPropertiesInfo?.exportSettings);\n\tif (timezoneProperty || (exportType === \"DateTime\" && !timezoneText)) {\n\t\tutc = false;\n\t}\n\tconst exportSettings: ColumnExportSettings = {\n\t\ttype: exportType,\n\t\tinputFormat: getDateInputFormat(dataType),\n\t\tdelimiter: getDelimiter(dataType),\n\t\tscale: scale,\n\t\tunitProperty: unitProperty,\n\t\tunit: relatedPropertiesInfo?.exportSettings.unit ?? unitText,\n\t\ttimezoneProperty: timezoneProperty,\n\t\ttimezone: relatedPropertiesInfo?.exportSettings.timezone ?? timezoneText?.toString(),\n\t\ttemplate: relatedPropertiesInfo?.exportSettings.template,\n\t\t//only in case of complex properties, wrap the cell content\ton the excel exported file\n\t\twrap: relatedPropertiesInfo?.exportSettings.wrap,\n\t\tutc: utc\n\t};\n\tif (exportSettings.unitProperty || exportSettings.unit) {\n\t\texportSettings.autoScale = true;\n\t}\n\treturn removeUndefinedFromExportSettings(exportSettings);\n};\n/**\n * Gets the export format template for columns with dates.\n * @param dataType The data type of the column\n * @returns The inputFormat\n */\nconst getDateInputFormat = function (dataType?: string): string | undefined {\n\treturn dataType === \"Edm.Date\" ? \"YYYY-MM-DD\" : undefined;\n};\n/**\n * Gets the delimiter in numeric columns.\n * The delimiter is used to display thousands separator in numeric columns.\n * @param dataType The data type of the column\n * @returns True to display thousands separator in numeric columns\n */\nconst getDelimiter = function (dataType?: string): boolean | undefined {\n\treturn dataType === \"Edm.Int64\" ? true : undefined;\n};\n/**\n * Removes undefined values from the export settings object of a column.\n * @param exportSettings The export settings configurations for a column\n * @returns The export settings configurations without undefined values\n */\nconst removeUndefinedFromExportSettings = function (exportSettings: ColumnExportSettings): ColumnExportSettings {\n\t//Remove undefined settings from exportSetting object\n\tfor (const setting in exportSettings) {\n\t\tif (exportSettings[setting as keyof ColumnExportSettings] === undefined) {\n\t\t\tdelete exportSettings[setting as keyof ColumnExportSettings];\n\t\t}\n\t}\n\treturn exportSettings;\n};\n/**\n * Update property label in case it's only referenced in one column. The label of the column must be used instead of the property label.\n * This update also is applied for the tooltip as it is based on the column's label.\n * @param annotationColumns The array of columns created based on LineItem annotations.\n * @param columnsToBeCreated The columns to be created\n * @param columnInfo The column definition\n * @param columnName The name of the column\n */\nfunction updatePropertyLabel(\n\tannotationColumns: AnnotationTableColumn[],\n\tcolumnsToBeCreated: Record<string, Property>,\n\tcolumnInfo: AnnotationTableColumn,\n\tcolumnName?: string\n): void {\n\tconst linkedAnnotationColumns = annotationColumns.filter(\n\t\t(col) => col.propertyInfos?.includes(columnInfo.relativePath) || (columnName && col.propertyInfos?.includes(columnName))\n\t);\n\tif (\n\t\tlinkedAnnotationColumns?.length === 1 &&\n\t\t(columnsToBeCreated[columnInfo.relativePath] || (columnName && columnsToBeCreated[columnName])) &&\n\t\tlinkedAnnotationColumns[0].propertyInfos?.length === 1\n\t) {\n\t\tcolumnInfo.label = linkedAnnotationColumns[0].label;\n\t\tcolumnInfo.tooltip = linkedAnnotationColumns[0].tooltip;\n\t}\n}\n/**\n * Returns Boolean true for exportable columns, false for non exportable columns.\n * @param source The dataField or property to be evaluated\n * @returns True for exportable column, false for non exportable column\n */\nfunction _isExportableColumn(source: DataFieldAbstractTypes | Property): boolean {\n\tlet propertyType, property;\n\tconst dataFieldDefaultProperty = (source as Property).annotations.UI?.DataFieldDefault;\n\tif (isProperty(source)) {\n\t\tif (isReferencePropertyStaticallyHidden(source)) {\n\t\t\treturn false;\n\t\t}\n\t\tpropertyType = dataFieldDefaultProperty?.$Type;\n\t} else if (isReferencePropertyStaticallyHidden(source)) {\n\t\treturn false;\n\t} else {\n\t\tproperty = source;\n\t\tpropertyType = property.$Type;\n\t\tif (propertyType === UIAnnotationTypes.DataFieldForAnnotation && (property as DataFieldForAnnotation).Target?.$target?.$Type) {\n\t\t\t//For Chart\n\t\t\tpropertyType = (property as DataFieldForAnnotation).Target?.$target?.$Type;\n\t\t\treturn propertyType !== undefined && !UIAnnotationTypes.ChartDefinitionType.includes(propertyType);\n\t\t} else if (\n\t\t\t(property as DataField).Value?.$target?.annotations?.Core?.MediaType?.term === \"Org.OData.Core.V1.MediaType\" &&\n\t\t\t(property as DataField).Value?.$target?.annotations?.Core?.isURL !== true\n\t\t) {\n\t\t\t//For Stream\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn propertyType\n\t\t? ![\n\t\t\t\tUIAnnotationTypes.DataFieldForAction,\n\t\t\t\tUIAnnotationTypes.DataFieldForIntentBasedNavigation,\n\t\t\t\tUIAnnotationTypes.DataFieldForActionGroup\n\t\t  ].includes(propertyType)\n\t\t: true;\n}\n/**\n * Returns Boolean true for valid columns, false for invalid columns.\n * @param dataField Different DataField types defined in the annotations\n * @returns True for valid columns, false for invalid columns\n */\nconst _isValidColumn = function (dataField: DataFieldAbstractTypes): boolean {\n\tswitch (dataField.$Type) {\n\t\tcase UIAnnotationTypes.DataFieldForAction:\n\t\tcase UIAnnotationTypes.DataFieldForIntentBasedNavigation:\n\t\t\treturn !!dataField.Inline;\n\t\tcase UIAnnotationTypes.DataFieldWithAction:\n\t\tcase UIAnnotationTypes.DataFieldWithIntentBasedNavigation:\n\t\tcase UIAnnotationTypes.DataField:\n\t\tcase UIAnnotationTypes.DataFieldWithUrl:\n\t\tcase UIAnnotationTypes.DataFieldForAnnotation:\n\t\tcase UIAnnotationTypes.DataFieldWithNavigationPath:\n\t\t\treturn true;\n\t\tdefault:\n\t\t\t// Todo: Replace with proper Log statement once available\n\t\t\t//  throw new Error(\"Unhandled DataField Abstract type: \" + dataField.$Type);\n\t\t\treturn false;\n\t}\n};\n/**\n * Returns the binding expression to evaluate the visibility of a DataField or DataPoint annotation.\n *\n * SAP Fiori elements will evaluate either the UI.Hidden annotation defined on the annotation itself or on the target property.\n * @param dataFieldModelPath The metapath referring to the annotation that is evaluated by SAP Fiori elements.\n * @returns An expression that you can bind to the UI.\n */\nexport const _getVisibleExpression = function (\n\tdataFieldModelPath: DataModelObjectPath<DataFieldAbstractTypes | DataPointTypeTypes>\n): BindingToolkitExpression<boolean> {\n\tconst targetObject = dataFieldModelPath.targetObject;\n\tlet propertyValue;\n\tif (targetObject) {\n\t\tswitch (targetObject.$Type) {\n\t\t\tcase UIAnnotationTypes.DataField:\n\t\t\tcase UIAnnotationTypes.DataFieldWithUrl:\n\t\t\tcase UIAnnotationTypes.DataFieldWithNavigationPath:\n\t\t\tcase UIAnnotationTypes.DataFieldWithIntentBasedNavigation:\n\t\t\tcase UIAnnotationTypes.DataFieldWithAction:\n\t\t\tcase UIAnnotationTypes.DataPointType:\n\t\t\t\tpropertyValue = targetObject.Value.$target;\n\t\t\t\tbreak;\n\t\t\tcase UIAnnotationTypes.DataFieldForAnnotation:\n\t\t\t\t// if it is a DataFieldForAnnotation pointing to a DataPoint we look at the dataPoint's value\n\t\t\t\tif (targetObject?.Target?.$target?.$Type === UIAnnotationTypes.DataPointType) {\n\t\t\t\t\tpropertyValue = targetObject.Target.$target?.Value.$target;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase UIAnnotationTypes.DataFieldForIntentBasedNavigation:\n\t\t\tcase UIAnnotationTypes.DataFieldForAction:\n\t\t\tdefault:\n\t\t\t\tpropertyValue = undefined;\n\t\t}\n\t}\n\tconst isAnalyticalGroupHeaderExpanded = /*formatOptions?.isAnalytics ? UI.IsExpanded :*/ constant(false);\n\tconst isAnalyticalLeaf = /*formatOptions?.isAnalytics ? equal(UI.NodeLevel, 0) :*/ constant(false);\n\t// A data field is visible if:\n\t// - the UI.Hidden expression in the original annotation does not evaluate to 'true'\n\t// - the UI.Hidden expression in the target property does not evaluate to 'true'\n\t// - in case of Analytics it's not visible for an expanded GroupHeader\n\treturn and(\n\t\t...[\n\t\t\tnot(equal(getExpressionFromAnnotation(targetObject?.annotations?.UI?.Hidden), true)),\n\t\t\tifElse(\n\t\t\t\t!!propertyValue,\n\t\t\t\tpropertyValue && not(equal(getExpressionFromAnnotation(propertyValue.annotations?.UI?.Hidden), true)),\n\t\t\t\ttrue\n\t\t\t),\n\t\t\tor(not(isAnalyticalGroupHeaderExpanded), isAnalyticalLeaf)\n\t\t]\n\t);\n};\n/**\n * Returns hidden binding expressions for a field group.\n * @param dataFieldGroup DataField defined in the annotations\n * @returns Compile binding of field group expressions.\n */\nconst _getFieldGroupHiddenExpressions = function (dataFieldGroup: DataFieldAbstractTypes): CompiledBindingToolkitExpression | undefined {\n\tconst fieldGroupHiddenExpressions: BindingToolkitExpression<boolean>[] = [];\n\tif (\n\t\tdataFieldGroup.$Type === UIAnnotationTypes.DataFieldForAnnotation &&\n\t\tdataFieldGroup.Target?.$target?.$Type === UIAnnotationTypes.FieldGroupType\n\t) {\n\t\tif (dataFieldGroup?.annotations?.UI?.Hidden) {\n\t\t\treturn compileExpression(not(equal(getExpressionFromAnnotation(dataFieldGroup.annotations.UI.Hidden), true)));\n\t\t} else {\n\t\t\tdataFieldGroup.Target.$target.Data?.forEach((innerDataField: DataFieldAbstractTypes | DataPointTypeTypes) => {\n\t\t\t\tfieldGroupHiddenExpressions.push(\n\t\t\t\t\t_getVisibleExpression({ targetObject: innerDataField } as DataModelObjectPath<\n\t\t\t\t\t\tDataFieldAbstractTypes | DataPointTypeTypes\n\t\t\t\t\t>)\n\t\t\t\t);\n\t\t\t});\n\t\t\treturn compileExpression(ifElse(or(...fieldGroupHiddenExpressions), constant(true), constant(false)));\n\t\t}\n\t} else {\n\t\treturn undefined;\n\t}\n};\n/**\n * Returns the label for the property and dataField.\n * @param [property] Property, DataField or Navigation Property defined in the annotations\n * @param isGroup\n * @returns Label of the property or DataField\n */\nconst getLabel = function (property: DataFieldAbstractTypes | Property | NavigationProperty, isGroup = false): string | undefined {\n\tif (!property) {\n\t\treturn undefined;\n\t}\n\tif (isProperty(property) || isNavigationProperty(property)) {\n\t\tconst dataFieldDefault = (property as Property).annotations?.UI?.DataFieldDefault;\n\t\tif (dataFieldDefault && !dataFieldDefault.qualifier && dataFieldDefault.Label) {\n\t\t\treturn dataFieldDefault.Label?.toString();\n\t\t}\n\t\treturn property.annotations.Common?.Label?.toString() ?? property.name;\n\t} else if (isDataFieldTypes(property)) {\n\t\tif (!!isGroup && property.$Type === UIAnnotationTypes.DataFieldWithIntentBasedNavigation) {\n\t\t\treturn property?.Label?.toString();\n\t\t}\n\t\treturn (\n\t\t\tproperty?.Label?.toString() ??\n\t\t\tcompileExpression(\n\t\t\t\tgetExpressionFromAnnotation(property.Value?.$target?.annotations?.Common?.Label, [], property.Value?.$target?.name)\n\t\t\t)\n\t\t);\n\t} else if (property.$Type === UIAnnotationTypes.DataFieldForAnnotation) {\n\t\treturn (\n\t\t\tproperty.Label?.toString() ??\n\t\t\tcompileExpression(\n\t\t\t\tgetExpressionFromAnnotation((property.Target?.$target as DataPoint)?.Value?.$target?.annotations?.Common?.Label?.valueOf())\n\t\t\t)\n\t\t);\n\t} else {\n\t\treturn property.Label?.toString();\n\t}\n};\nconst _getTooltip = function (source: DataFieldAbstractTypes | Property): string | undefined {\n\tif (!source) {\n\t\treturn undefined;\n\t}\n\tif (isProperty(source) || source.annotations?.Common?.QuickInfo) {\n\t\treturn source.annotations?.Common?.QuickInfo\n\t\t\t? compileExpression(getExpressionFromAnnotation(source.annotations.Common.QuickInfo))\n\t\t\t: undefined;\n\t} else if (isDataFieldTypes(source)) {\n\t\treturn source.Value?.$target?.annotations?.Common?.QuickInfo\n\t\t\t? compileExpression(getExpressionFromAnnotation(source.Value.$target.annotations.Common.QuickInfo))\n\t\t\t: undefined;\n\t} else if (source.$Type === UIAnnotationTypes.DataFieldForAnnotation) {\n\t\tconst datapointTarget = source.Target?.$target as DataPoint;\n\t\treturn datapointTarget?.Value?.$target?.annotations?.Common?.QuickInfo\n\t\t\t? compileExpression(getExpressionFromAnnotation(datapointTarget.Value.$target.annotations.Common.QuickInfo))\n\t\t\t: undefined;\n\t} else {\n\t\treturn undefined;\n\t}\n};\nexport function getRowStatusVisibility(colName: string, isSemanticKeyInFieldGroup?: boolean): BindingToolkitExpression<boolean> {\n\treturn formatResult(\n\t\t[\n\t\t\tpathInModel(`semanticKeyHasDraftIndicator`, \"internal\"),\n\t\t\tpathInModel(`filteredMessages`, \"internal\"),\n\t\t\tcolName,\n\t\t\tisSemanticKeyInFieldGroup\n\t\t],\n\t\ttableFormatters.getErrorStatusTextVisibilityFormatter\n\t);\n}\n/**\n * Creates a PropertyInfo for each identified property consumed by a LineItem.\n * @param columnsToBeCreated Identified properties.\n * @param existingColumns The list of columns created for LineItems and Properties of entityType.\n * @param converterContext The converter context.\n * @param entityType The entity type for the LineItem\n * @param displayModeOfDescriptionPropertiesMap The map of properties referenced as text on a text arrangement annotation.\n * @param tableCreationMode The creation mode of the table\n * @param restrictionsOnProperties The existing restrictions on properties\n * @returns The array of columns created.\n */\nconst _createRelatedColumns = function (\n\tcolumnsToBeCreated: Record<string, Property>,\n\texistingColumns: AnnotationTableColumn[],\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tentityType: EntityType,\n\tdisplayModeOfDescriptionPropertiesMap: Record<string, DisplayMode>,\n\ttableCreationMode?: CreationMode,\n\trestrictionsOnProperties?: RestrictionsOnProperties\n): AnnotationTableColumn[] {\n\tconst relatedColumns: (AnnotationTableColumn | TechnicalColumn)[] = [];\n\tconst relatedPropertyNameMap: Record<string, string> = {};\n\tconst aggregationHelper = new AggregationHelper(entityType, converterContext);\n\tObject.keys(columnsToBeCreated).forEach((name) => {\n\t\tconst property = columnsToBeCreated[name],\n\t\t\tannotationPath = converterContext.getAbsoluteAnnotationPath(name),\n\t\t\t// Check whether the related column already exists.\n\t\t\trelatedColumn = existingColumns.find((column) => column.name === name);\n\t\tconst dataModelObjectPath = converterContext.getConverterContextFor(converterContext.getContextPath()).getDataModelObjectPath();\n\t\tconst propertyObjectPath = enhanceDataModelPath<PageContextPathTarget>(dataModelObjectPath, name);\n\t\tif (isMultiValueField(propertyObjectPath)) {\n\t\t\tconst newNameRelativeTargetPath = getContextRelativeTargetObjectPath(propertyObjectPath, false, true);\n\t\t\tconst column = getColumnDefinitionFromProperty(\n\t\t\t\tproperty,\n\t\t\t\tannotationPath,\n\t\t\t\tname,\n\t\t\t\ttrue,\n\t\t\t\tfalse,\n\t\t\t\taggregationHelper,\n\t\t\t\tconverterContext,\n\t\t\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\t\t\trestrictionsOnProperties,\n\t\t\t\ttableCreationMode,\n\t\t\t\tundefined,\n\t\t\t\tnewNameRelativeTargetPath\n\t\t\t);\n\t\t\tcomputeHiddenOnRelatedColumns(existingColumns, name, column);\n\t\t\tupdatePropertyLabel(existingColumns, columnsToBeCreated, column, name);\n\t\t\trelatedColumns.push(column);\n\t\t\trelatedPropertyNameMap[name] = newNameRelativeTargetPath ?? name;\n\t\t} else if (relatedColumn === undefined) {\n\t\t\t// Case 1: Key contains DataField prefix to ensure all property columns have the same key format.\n\t\t\t// New created property column is set to hidden.\n\t\t\tconst column = getColumnDefinitionFromProperty(\n\t\t\t\tproperty,\n\t\t\t\tannotationPath,\n\t\t\t\tname,\n\t\t\t\ttrue,\n\t\t\t\tfalse,\n\t\t\t\taggregationHelper,\n\t\t\t\tconverterContext,\n\t\t\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\t\t\trestrictionsOnProperties,\n\t\t\t\ttableCreationMode\n\t\t\t);\n\t\t\tcomputeHiddenOnRelatedColumns(existingColumns, name, column);\n\t\t\tupdatePropertyLabel(existingColumns, columnsToBeCreated, column);\n\t\t\trelatedColumns.push(column);\n\t\t} else if (relatedColumn.annotationPath !== annotationPath || relatedColumn.propertyInfos) {\n\t\t\t// Case 2: The existing column points to a LineItem (or)\n\t\t\t// Case 3: This is a self reference from an existing column\n\t\t\tconst newName = `Property::${name}`;\n\t\t\t// Checking whether the related property column has already been created in a previous iteration.\n\t\t\tif (!existingColumns.some((column) => column.name === newName)) {\n\t\t\t\t// Create a new property column with 'Property::' prefix,\n\t\t\t\t// Set it to hidden as it is only consumed by Complex property infos.\n\t\t\t\tconst column = getColumnDefinitionFromProperty(\n\t\t\t\t\tproperty,\n\t\t\t\t\tannotationPath,\n\t\t\t\t\tname,\n\t\t\t\t\tfalse,\n\t\t\t\t\tfalse,\n\t\t\t\t\taggregationHelper,\n\t\t\t\t\tconverterContext,\n\t\t\t\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\t\t\t\trestrictionsOnProperties,\n\t\t\t\t\ttableCreationMode\n\t\t\t\t);\n\t\t\t\tcomputeHiddenOnRelatedColumns(existingColumns, name, column);\n\t\t\t\tupdatePropertyLabel(existingColumns, columnsToBeCreated, column);\n\t\t\t\trelatedColumns.push(column);\n\t\t\t\trelatedPropertyNameMap[name] = newName;\n\t\t\t} else if (\n\t\t\t\texistingColumns.some((column) => column.name === newName) &&\n\t\t\t\texistingColumns.some((column) => column.propertyInfos?.includes(name))\n\t\t\t) {\n\t\t\t\trelatedPropertyNameMap[name] = newName;\n\t\t\t}\n\t\t} else if (\n\t\t\tdisplayModeOfDescriptionPropertiesMap[name] === \"Description\" &&\n\t\t\t!relatedColumn.filterable &&\n\t\t\t!restrictionsOnProperties?.nonFilterableProperties.includes(name)\n\t\t) {\n\t\t\t// Case 4: The column is a referenced text only property. Set it to hidden, non sortable nor groupable.\n\t\t\t// Case 5: The column isn't already available for filtering as it could be referenced on another column (e.g. text first).\n\t\t\trestrictionsOnProperties?.nonSortableProperties.push(name);\n\t\t\tconst column = getColumnDefinitionFromProperty(\n\t\t\t\tproperty,\n\t\t\t\tannotationPath,\n\t\t\t\tname,\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t\taggregationHelper,\n\t\t\t\tconverterContext,\n\t\t\t\t{},\n\t\t\t\trestrictionsOnProperties,\n\t\t\t\ttableCreationMode\n\t\t\t);\n\t\t\tcolumn.isGroupable = false;\n\t\t\trelatedColumns.push(column);\n\t\t}\n\t});\n\t// The property 'name' has been prefixed with 'Property::' for uniqueness.\n\t// Update the same in other propertyInfos[] references which point to this property.\n\texistingColumns.forEach((column) => {\n\t\tcolumn.propertyInfos = column.propertyInfos?.map((propertyInfo) => relatedPropertyNameMap[propertyInfo] ?? propertyInfo);\n\t\tcolumn.additionalPropertyInfos = column.additionalPropertyInfos?.map(\n\t\t\t(propertyInfo) => relatedPropertyNameMap[propertyInfo] ?? propertyInfo\n\t\t);\n\t});\n\treturn relatedColumns;\n};\n/**\n * Getting the Column Name\n * If it points to a DataField with one property or DataPoint with one property, it will use the property name\n * here to be consistent with the existing flex changes.\n * @param dataField Different DataField types defined in the annotations\n * @returns The name of annotation columns\n */\nconst _getAnnotationColumnName = function (dataField: DataFieldAbstractTypes): string {\n\t// This is needed as we have flexibility changes already that we have to check against\n\tif (isDataFieldTypes(dataField) && dataField.Value?.path) {\n\t\treturn dataField.Value?.path;\n\t} else if (dataField.$Type === UIAnnotationTypes.DataFieldForAnnotation && (dataField.Target?.$target as DataPoint)?.Value?.path) {\n\t\t// This is for removing duplicate properties. For example, 'Progress' Property is removed if it is already defined as a DataPoint\n\t\treturn (dataField.Target?.$target as DataPoint)?.Value.path;\n\t} else {\n\t\treturn KeyHelper.generateKeyFromDataField(dataField);\n\t}\n};\n/**\n * Creates a PropertyInfo for the identified additional property for the ALP table use-case.\n *\n * For e.g. If UI.Hidden points to a property, include this technical property in the additionalProperties of ComplexPropertyInfo object.\n * @param name The name of the property to be created.\n * @param columns The list of columns created for LineItems and Properties of entityType from the table visualization.\n * @param relatedAdditionalPropertyNameMap\n */\nconst createTechnicalProperty = function (\n\tname: string,\n\tcolumns: TableColumn[],\n\trelatedAdditionalPropertyNameMap: Record<string, string>\n): void {\n\tconst key = `Property_Technical::${name}`;\n\t// Validate if the technical property hasn't yet been created on previous iterations.\n\tconst columnExists = columns.find((column) => column.key === key);\n\t// Retrieve the simple property used by the hidden annotation, it will be used as a base for the mandatory attributes of newly created technical property. For e.g. relativePath\n\tconst additionalProperty =\n\t\t!columnExists && (columns.find((column) => column.name === name && !column.propertyInfos) as AnnotationTableColumn)!;\n\tif (additionalProperty) {\n\t\tconst technicalColumn: TechnicalColumn = {\n\t\t\tkey: key,\n\t\t\ttype: ColumnType.Annotation,\n\t\t\tlabel: additionalProperty.label,\n\t\t\tannotationPath: additionalProperty.annotationPath,\n\t\t\tavailability: \"Hidden\",\n\t\t\tname: key,\n\t\t\trelativePath: additionalProperty.relativePath,\n\t\t\tsortable: false,\n\t\t\tisGroupable: false,\n\t\t\tisKey: false,\n\t\t\texportSettings: null,\n\t\t\tcaseSensitive: false,\n\t\t\taggregatable: false,\n\t\t\tfilterable: false,\n\t\t\textension: {\n\t\t\t\ttechnicallyGroupable: true,\n\t\t\t\ttechnicallyAggregatable: true\n\t\t\t}\n\t\t};\n\t\tcolumns.push(technicalColumn);\n\t\trelatedAdditionalPropertyNameMap[name] = technicalColumn.name;\n\t}\n};\n/**\n * Determines if the data field labels have to be displayed in the table.\n * @param fieldGroupName The `DataField` name being processed.\n * @param visualizationPath\n * @param converterContext\n * @returns `showDataFieldsLabel` value from the manifest\n */\nconst _getShowDataFieldsLabel = function (\n\tfieldGroupName: string,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): boolean | undefined {\n\tconst columns = converterContext.getManifestControlConfiguration<TableManifestConfiguration>(visualizationPath)?.columns;\n\tconst columnKeys = columns && Object.keys(columns);\n\treturn (\n\t\tcolumnKeys &&\n\t\t!!columnKeys.find(function (key: string) {\n\t\t\treturn key === fieldGroupName && (columns[key] as CustomDefinedTableColumnForOverride).showDataFieldsLabel;\n\t\t})\n\t);\n};\n/**\n * Determines the relative path of the property with respect to the root entity.\n * @param dataField The `DataField` being processed.\n * @returns The relative path\n */\nconst _getRelativePath = function (dataField: DataFieldAbstractTypes): string {\n\tlet relativePath = \"\";\n\tswitch (dataField.$Type) {\n\t\tcase UIAnnotationTypes.DataField:\n\t\tcase UIAnnotationTypes.DataFieldWithNavigationPath:\n\t\tcase UIAnnotationTypes.DataFieldWithUrl:\n\t\tcase UIAnnotationTypes.DataFieldWithIntentBasedNavigation:\n\t\tcase UIAnnotationTypes.DataFieldWithAction:\n\t\t\trelativePath = (dataField as DataField)?.Value?.path;\n\t\t\tbreak;\n\t\tcase UIAnnotationTypes.DataFieldForAnnotation:\n\t\t\trelativePath = dataField?.Target?.value;\n\t\t\tbreak;\n\t\tcase UIAnnotationTypes.DataFieldForAction:\n\t\tcase UIAnnotationTypes.DataFieldForIntentBasedNavigation:\n\t\tcase UIAnnotationTypes.DataFieldForActionGroup:\n\t\tcase UIAnnotationTypes.DataFieldWithActionGroup:\n\t\t\trelativePath = KeyHelper.generateKeyFromDataField(dataField);\n\t\t\tbreak;\n\t}\n\treturn relativePath;\n};\nconst _sliceAtSlash = function (path: string, isLastSlash: boolean, isLastPart: boolean): string {\n\tconst iSlashIndex = isLastSlash ? path.lastIndexOf(\"/\") : path.indexOf(\"/\");\n\tif (iSlashIndex === -1) {\n\t\treturn path;\n\t}\n\treturn isLastPart ? path.substring(iSlashIndex + 1, path.length) : path.substring(0, iSlashIndex);\n};\n/**\n * Determines if the column contains a multi-value field.\n * @param dataField The DataField being processed\n * @param converterContext The converter context\n * @returns True if the DataField corresponds to a multi-value field.\n */\nconst _isColumnMultiValued = function (\n\tdataField: DataFieldAbstractTypes,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): boolean {\n\tif (isDataFieldTypes(dataField) && isPathAnnotationExpression(dataField.Value)) {\n\t\tconst propertyObjectPath = enhanceDataModelPath<PageContextPathTarget>(\n\t\t\tconverterContext.getDataModelObjectPath(),\n\t\t\tdataField.Value.path\n\t\t);\n\t\treturn isMultiValueField(propertyObjectPath);\n\t} else {\n\t\treturn false;\n\t}\n};\n/**\n * Determine whether a column is sortable.\n * @param dataField The data field being processed\n * @param propertyPath The property path\n * @param nonSortableColumns Collection of non-sortable column names as per annotation\n * @param relatedPropertiesInfo The related properties linked to the column\n * @returns True if the column is sortable\n */\nconst _isColumnSortable = function (\n\tdataField: DataFieldAbstractTypes,\n\tpropertyPath: string,\n\tnonSortableColumns: string[],\n\trelatedPropertiesInfo: ComplexPropertyInfo\n): boolean {\n\treturn (\n\t\t!nonSortableColumns.includes(propertyPath) && // Column is not marked as non-sortable via annotation\n\t\t(((dataField.$Type === UIAnnotationTypes.DataField || dataField.$Type === UIAnnotationTypes.DataFieldForAnnotation) &&\n\t\t\tObject.keys(relatedPropertiesInfo.properties).some((propName) => {\n\t\t\t\tconst isHidden = isReferencePropertyStaticallyHidden(relatedPropertiesInfo.properties[propName].annotationProperty);\n\t\t\t\treturn !isHidden && !nonSortableColumns.includes(propName);\n\t\t\t})) ||\n\t\t\tdataField.$Type === UIAnnotationTypes.DataFieldWithUrl ||\n\t\t\tdataField.$Type === UIAnnotationTypes.DataFieldWithIntentBasedNavigation ||\n\t\t\tdataField.$Type === UIAnnotationTypes.DataFieldWithAction)\n\t);\n};\n/**\n * Returns whether filtering on the table is case sensitive.\n * @param converterContext The instance of the converter context\n * @returns Returns 'false' if FilterFunctions annotation supports 'tolower', else 'true'\n */\nexport const isFilteringCaseSensitive = function (converterContext: ConverterContext<PageContextPathTarget>): boolean {\n\tconst filterFunctions: FilterFunctions | undefined = _getFilterFunctions(converterContext);\n\treturn Array.isArray(filterFunctions) ? !(filterFunctions as String[]).includes(\"tolower\") : true;\n};\nfunction _getFilterFunctions(ConverterContext: ConverterContext<PageContextPathTarget>): FilterFunctions | undefined {\n\tconst entitySet = ConverterContext.getEntitySet();\n\tif (TypeGuards.isEntitySet(entitySet)) {\n\t\treturn (\n\t\t\tentitySet.annotations.Capabilities?.FilterFunctions ??\n\t\t\tConverterContext.getEntityContainer().annotations.Capabilities?.FilterFunctions\n\t\t);\n\t}\n\treturn undefined;\n}\n/**\n * Returns default format options for text fields in a table.\n * @param formatOptions\n * @returns Collection of format options with default values\n */\nfunction _getDefaultFormatOptionsForTable(formatOptions: FormatOptionsType | undefined): FormatOptionsType | undefined {\n\treturn formatOptions === undefined\n\t\t? undefined\n\t\t: {\n\t\t\t\ttextLinesEdit: 4,\n\t\t\t\t...formatOptions\n\t\t  };\n}\nfunction _findSemanticKeyValues(semanticKeys: SemanticKey, name: string): { values: string[]; semanticKeyFound: boolean } {\n\tconst aSemanticKeyValues: string[] = [];\n\tlet bSemanticKeyFound = false;\n\tfor (let i = 0; i < semanticKeys.length; i++) {\n\t\taSemanticKeyValues.push(semanticKeys[i].value);\n\t\tif (semanticKeys[i].value === name) {\n\t\t\tbSemanticKeyFound = true;\n\t\t}\n\t}\n\treturn {\n\t\tvalues: aSemanticKeyValues,\n\t\tsemanticKeyFound: bSemanticKeyFound\n\t};\n}\nfunction _findProperties(\n\tsemanticKeyValues: string[],\n\tfieldGroupProperties: string[]\n): { semanticKeyHasPropertyInFieldGroup: boolean; fieldGroupPropertyPath?: string } {\n\tlet semanticKeyHasPropertyInFieldGroup = false;\n\tlet sPropertyPath;\n\tif (semanticKeyValues && semanticKeyValues.length >= 1 && fieldGroupProperties && fieldGroupProperties.length >= 1) {\n\t\tfor (let i = 0; i < semanticKeyValues.length; i++) {\n\t\t\tif ([semanticKeyValues[i]].some((tmp) => fieldGroupProperties.includes(tmp))) {\n\t\t\t\tsemanticKeyHasPropertyInFieldGroup = true;\n\t\t\t\tsPropertyPath = semanticKeyValues[i];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn {\n\t\tsemanticKeyHasPropertyInFieldGroup: semanticKeyHasPropertyInFieldGroup,\n\t\tfieldGroupPropertyPath: sPropertyPath\n\t};\n}\n/**\n * Find the first property in the fieldGroup that is part of the semantic keys.\n * @param dataFieldGroup\n * @param semanticKeyValues\n * @returns An object containing a flag true if a property is found and a propertyPath.\n */\nfunction _findSemanticKeyValuesInFieldGroup(\n\tdataFieldGroup: DataFieldAbstractTypes | null,\n\tsemanticKeyValues: string[]\n): { semanticKeyHasPropertyInFieldGroup: boolean; propertyPath?: string } {\n\t// this info is used in FieldHelper#isDraftIndicatorVisibleInFieldGroup to show a draft indicator at the end of a field group\n\tconst aProperties: string[] = [];\n\tlet _propertiesFound: { semanticKeyHasPropertyInFieldGroup: boolean; fieldGroupPropertyPath?: string } = {\n\t\tsemanticKeyHasPropertyInFieldGroup: false,\n\t\tfieldGroupPropertyPath: undefined\n\t};\n\tif (\n\t\tdataFieldGroup &&\n\t\tdataFieldGroup.$Type === UIAnnotationTypes.DataFieldForAnnotation &&\n\t\tdataFieldGroup.Target?.$target?.$Type === UIAnnotationTypes.FieldGroupType\n\t) {\n\t\tdataFieldGroup.Target.$target.Data?.forEach((innerDataField: DataFieldAbstractTypes) => {\n\t\t\tif (\n\t\t\t\t(innerDataField.$Type === UIAnnotationTypes.DataField || innerDataField.$Type === UIAnnotationTypes.DataFieldWithUrl) &&\n\t\t\t\tinnerDataField.Value\n\t\t\t) {\n\t\t\t\taProperties.push(innerDataField.Value.path);\n\t\t\t}\n\t\t\t_propertiesFound = _findProperties(semanticKeyValues, aProperties);\n\t\t});\n\t}\n\treturn {\n\t\tsemanticKeyHasPropertyInFieldGroup: _propertiesFound.semanticKeyHasPropertyInFieldGroup,\n\t\tpropertyPath: _propertiesFound.fieldGroupPropertyPath\n\t};\n}\n/**\n * Returns default format options with draftIndicator for a column.\n * @param name\n * @param semanticKeys\n * @param dataFieldGroup\n * @returns Collection of format options with default values\n */\nfunction getDefaultDraftIndicatorForColumn(\n\tname: string,\n\tsemanticKeys: SemanticKey,\n\tdataFieldGroup: DataFieldAbstractTypes | null\n): Partial<{\n\tfieldGroupDraftIndicatorPropertyPath: string;\n\tfieldGroupName: string;\n\tshowErrorObjectStatus: CompiledBindingToolkitExpression;\n\thasDraftIndicator: boolean;\n}> {\n\tif (!semanticKeys) {\n\t\treturn {};\n\t}\n\tconst semanticKey = _findSemanticKeyValues(semanticKeys, name);\n\tconst semanticKeyInFieldGroup = _findSemanticKeyValuesInFieldGroup(dataFieldGroup, semanticKey.values);\n\tif (semanticKeyInFieldGroup.semanticKeyHasPropertyInFieldGroup) {\n\t\t// Semantic Key has a property in a FieldGroup\n\t\treturn {\n\t\t\t//TODO we should rather store hasSemanticKeyInFieldGroup\n\t\t\tfieldGroupDraftIndicatorPropertyPath: semanticKeyInFieldGroup.propertyPath,\n\t\t\tfieldGroupName: name,\n\t\t\tshowErrorObjectStatus: compileExpression(getRowStatusVisibility(name, true))\n\t\t};\n\t} else if (semanticKey.semanticKeyFound) {\n\t\treturn {\n\t\t\thasDraftIndicator: true,\n\t\t\tshowErrorObjectStatus: compileExpression(getRowStatusVisibility(name, false))\n\t\t};\n\t}\n\treturn {};\n}\nfunction _getImpNumber(dataField: DataFieldTypes): number {\n\tconst importance = dataField?.annotations?.UI?.Importance as string;\n\tif (importance && importance.includes(\"UI.ImportanceType/High\")) {\n\t\treturn 3;\n\t}\n\tif (importance && importance.includes(\"UI.ImportanceType/Medium\")) {\n\t\treturn 2;\n\t}\n\tif (importance && importance.includes(\"UI.ImportanceType/Low\")) {\n\t\treturn 1;\n\t}\n\treturn 0;\n}\nfunction _getDataFieldImportance(dataField: DataFieldTypes): Importance {\n\tconst importance = dataField?.annotations?.UI?.Importance as string;\n\treturn importance ? (importance.split(\"/\")[1] as Importance) : Importance.None;\n}\n/**\n * Sets the export settings of a column containing datapoints.\n * @param property The property referenced on a given column\n * @param column The column to be updated\n */\n\nfunction _setExportSettingsForDataPoint(property: Property, column: AnnotationTableColumn): void {\n\tconst targetValuefromDP = getTargetValueOnDataPoint(property);\n\tif (\n\t\tisDataPointFromDataFieldDefault(property) &&\n\t\ttypeof targetValuefromDP === \"string\" &&\n\t\tcolumn.exportSettings &&\n\t\tcolumn.exportSettings?.unit !== \"%\"\n\t) {\n\t\tcolumn.exportDataPointTargetValue = targetValuefromDP;\n\t\tcolumn.exportSettings.template = \"{0}/\" + targetValuefromDP;\n\t}\n}\n\nfunction _getMaxImportance(fields: DataFieldTypes[]): Importance {\n\tif (fields && fields.length > 0) {\n\t\tlet maxImpNumber = -1;\n\t\tlet impNumber = -1;\n\t\tlet DataFieldWithMaxImportance;\n\t\tfor (const field of fields) {\n\t\t\timpNumber = _getImpNumber(field);\n\t\t\tif (impNumber > maxImpNumber) {\n\t\t\t\tmaxImpNumber = impNumber;\n\t\t\t\tDataFieldWithMaxImportance = field;\n\t\t\t}\n\t\t}\n\t\treturn _getDataFieldImportance(DataFieldWithMaxImportance as DataFieldTypes);\n\t}\n\treturn Importance.None;\n}\n/**\n * Returns the importance value for a column.\n * @param converterContext\n * @param dataField\n * @returns The importance value\n */\nexport function getImportance(\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tdataField: DataFieldAbstractTypes | undefined\n): Importance | undefined {\n\tif (!dataField) {\n\t\treturn undefined;\n\t}\n\tconst semanticKeys = converterContext.getDataModelObjectPath().targetEntityType.annotations.Common?.SemanticKey ?? [];\n\tconst requiredProperties = getRequiredProperties(converterContext);\n\tconst highKeys = [...semanticKeys, ...requiredProperties].map((propertyPath) => propertyPath.$target?.fullyQualifiedName);\n\t//Evaluate default Importance is not set explicitly\n\tlet fieldsWithImportance;\n\tif (isAnnotationOfType<DataFieldForAnnotation>(dataField, UIAnnotationTypes.DataFieldForAnnotation)) {\n\t\tconst dataFieldTarget = dataField.Target.$target;\n\t\tif (isAnnotationOfType<FieldGroup>(dataFieldTarget, UIAnnotationTypes.FieldGroupType)) {\n\t\t\tconst fieldGroupData = dataFieldTarget.Data;\n\t\t\t//If a FieldGroup contains a semanticKey or required property, importance set to High\n\t\t\tif (\n\t\t\t\tfieldGroupData.some(function (fieldGroupDataField: DataFieldAbstractTypes): boolean {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tisDataFieldTypes(fieldGroupDataField) && highKeys.includes(fieldGroupDataField.Value?.$target?.fullyQualifiedName)\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t) {\n\t\t\t\treturn Importance.High;\n\t\t\t} else {\n\t\t\t\t//If the DataFieldForAnnotation has an Importance we take it\n\t\t\t\tif (dataField?.annotations?.UI?.Importance) {\n\t\t\t\t\treturn _getDataFieldImportance(dataField as unknown as DataFieldTypes);\n\t\t\t\t}\n\t\t\t\t// else the highest importance (if any) is returned\n\t\t\t\tfieldsWithImportance = fieldGroupData.filter(function (item) {\n\t\t\t\t\treturn item?.annotations?.UI?.Importance;\n\t\t\t\t});\n\t\t\t\treturn _getMaxImportance(fieldsWithImportance as DataFieldTypes[]);\n\t\t\t}\n\t\t}\n\t}\n\treturn highKeys.includes((dataField as DataFieldTypes).Value?.$target?.fullyQualifiedName)\n\t\t? Importance.High\n\t\t: _getDataFieldImportance(dataField as unknown as DataFieldTypes);\n}\n/**\n * Returns line items from metadata annotations.\n * @param lineItemAnnotation Collection of data fields with their annotations\n * @param visualizationPath The visualization path\n * @param converterContext The converter context\n * @returns The columns from the annotations\n */\nconst getColumnsFromAnnotations = function (\n\tlineItemAnnotation: LineItem,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): AnnotationTableColumn[] {\n\tconst entityType: EntityType = converterContext.getAnnotationEntityType(lineItemAnnotation),\n\t\tannotationColumns: AnnotationTableColumn[] = [],\n\t\tcolumnsToBeCreated: Record<string, Property> = {},\n\t\tdisplayModeOfDescriptionPropertiesMap: Record<string, DisplayMode> = {},\n\t\trestrictionsOnProperties = getRestrictionsOnProperties(converterContext.getEntitySet()),\n\t\ttableManifestSettings: TableManifestConfiguration = converterContext.getManifestControlConfiguration(visualizationPath),\n\t\ttableType = getTableType(converterContext, tableManifestSettings),\n\t\tdefaultCreationMode =\n\t\t\tconverterContext.getManifestWrapper().getSapFeManifestConfiguration()?.macros?.table?.defaultCreationMode ===\n\t\t\t\"InlineCreationRows\"\n\t\t\t\t? CreationMode.InlineCreationRows\n\t\t\t\t: undefined,\n\t\ttableCreationMode: CreationMode =\n\t\t\ttableManifestSettings?.tableSettings?.creationMode?.name ?? defaultCreationMode ?? CreationMode.Inline;\n\tconst semanticKeys: SemanticKey = converterContext.getAnnotationsByTerm(\"Common\", CommonAnnotationTerms.SemanticKey, [\n\t\tconverterContext.getEntityType()\n\t])[0] as SemanticKey;\n\tif (lineItemAnnotation) {\n\t\tconst tableConverterContext = converterContext.getConverterContextFor<PageContextPathTarget>(\n\t\t\tgetTargetObjectPath(converterContext.getDataModelObjectPath())\n\t\t);\n\t\tlineItemAnnotation.forEach((dataField) => {\n\t\t\t// TODO: variable name should be datafield and not lineItem\n\t\t\tif (!_isValidColumn(dataField)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet exportSettings: ColumnExportSettings | null = null;\n\t\t\tconst semanticObjectAnnotationPath =\n\t\t\t\tisDataFieldTypes(dataField) && dataField.Value?.$target?.fullyQualifiedName\n\t\t\t\t\t? getSemanticObjectPath(converterContext, dataField)\n\t\t\t\t\t: undefined;\n\t\t\tconst relativePath = _getRelativePath(dataField);\n\t\t\t// Determine properties which are consumed by this LineItem.\n\t\t\tconst relatedPropertiesInfo: ComplexPropertyInfo = collectRelatedPropertiesRecursively(dataField, converterContext, tableType);\n\t\t\tconst relatedPropertyNames: string[] = Object.keys(relatedPropertiesInfo.properties);\n\t\t\tconst additionalPropertyNames: string[] = Object.keys(relatedPropertiesInfo.additionalProperties);\n\t\t\tconst groupPath: string | undefined = relativePath ? _sliceAtSlash(relativePath, true, false) : undefined;\n\t\t\tconst isGroup: boolean = groupPath != relativePath;\n\t\t\tconst sLabel: string | undefined = getLabel(dataField, isGroup);\n\t\t\tconst name = _getAnnotationColumnName(dataField);\n\t\t\tconst isFieldGroupColumn: boolean = groupPath ? groupPath.includes(`@${UIAnnotationTerms.FieldGroup}`) : false;\n\t\t\tconst showDataFieldsLabel: boolean | undefined = isFieldGroupColumn\n\t\t\t\t? _getShowDataFieldsLabel(name, visualizationPath, converterContext)\n\t\t\t\t: false;\n\t\t\tconst dataType: string | undefined = getDataFieldDataType(dataField);\n\t\t\tconst formatOptions = _getDefaultFormatOptionsForTable(getDefaultDraftIndicatorForColumn(name, semanticKeys, dataField));\n\t\t\tconst propertyDataModelObjectPath = enhanceDataModelPath<DataFieldAbstractTypes>(\n\t\t\t\tconverterContext.getDataModelObjectPath(),\n\t\t\t\trelativePath\n\t\t\t);\n\t\t\t// Determine if we need a situations indicator\n\t\t\tconst navigationProperties: NavigationProperty[] = propertyDataModelObjectPath.targetEntityType.navigationProperties;\n\t\t\tconst situationsNavProps = navigationProperties.filter(\n\t\t\t\t(navigationProperty) =>\n\t\t\t\t\t!navigationProperty.isCollection &&\n\t\t\t\t\tnavigationProperty.targetType.annotations.Common?.SAPObjectNodeType?.Name === \"BusinessSituation\"\n\t\t\t);\n\t\t\tconst situationsNavProp: NavigationProperty | undefined = situationsNavProps.length >= 1 ? situationsNavProps[0] : undefined;\n\t\t\tif (situationsNavProp && formatOptions) {\n\t\t\t\tformatOptions.hasSituationsIndicator = true;\n\t\t\t}\n\n\t\t\tlet fieldGroupHiddenExpressions: CompiledBindingToolkitExpression;\n\t\t\tif (\n\t\t\t\tdataField.$Type === UIAnnotationTypes.DataFieldForAnnotation &&\n\t\t\t\tdataField.Target?.$target?.$Type === UIAnnotationTypes.FieldGroupType\n\t\t\t) {\n\t\t\t\tfieldGroupHiddenExpressions = _getFieldGroupHiddenExpressions(dataField);\n\t\t\t}\n\t\t\tconst isMultiValue = _isColumnMultiValued(dataField, tableConverterContext);\n\t\t\tif (!isMultiValue && _isExportableColumn(dataField)) {\n\t\t\t\t//exclude the types listed above for the Export (generates error on Export as PDF)\n\t\t\t\texportSettings = createColumnExportSettings(dataField, relatedPropertiesInfo);\n\t\t\t}\n\t\t\tlet propertyTypeConfig: PropertyTypeConfig | undefined;\n\t\t\tif (dataType) {\n\t\t\t\tpropertyTypeConfig = getTypeConfig(dataField, dataType);\n\t\t\t}\n\t\t\tconst typeConfig: PropertyTypeConfig = {\n\t\t\t\tclassName: dataType as keyof typeof DefaultTypeForEdmType,\n\t\t\t\tformatOptions: {\n\t\t\t\t\t...formatOptions,\n\t\t\t\t\t...propertyTypeConfig?.formatOptions\n\t\t\t\t},\n\t\t\t\tconstraints: { ...propertyTypeConfig?.constraints }\n\t\t\t};\n\t\t\tconst visualSettings: VisualSettings = {};\n\t\t\tif (!dataType || !typeConfig) {\n\t\t\t\t// for charts\n\t\t\t\tvisualSettings.widthCalculation = null;\n\t\t\t}\n\t\t\tconst sortable =\n\t\t\t\t!isMultiValue &&\n\t\t\t\t_isColumnSortable(dataField, relativePath, restrictionsOnProperties.nonSortableProperties, relatedPropertiesInfo);\n\t\t\tconst availability = isReferencePropertyStaticallyHidden(dataField) ? \"Hidden\" : \"Default\";\n\t\t\tconst column: AnnotationTableColumn = {\n\t\t\t\tkey: KeyHelper.generateKeyFromDataField(dataField),\n\t\t\t\ttype: ColumnType.Annotation,\n\t\t\t\tlabel: sLabel,\n\t\t\t\tgroupLabel: isGroup ? getLabel(dataField) : undefined,\n\t\t\t\tgroup: isGroup ? groupPath : undefined,\n\t\t\t\tFieldGroupHiddenExpressions: fieldGroupHiddenExpressions,\n\t\t\t\tannotationPath: converterContext.getEntitySetBasedAnnotationPath(dataField.fullyQualifiedName),\n\t\t\t\tsemanticObjectPath: semanticObjectAnnotationPath,\n\t\t\t\tavailability: availability,\n\t\t\t\tname: name,\n\t\t\t\tshowDataFieldsLabel: showDataFieldsLabel,\n\t\t\t\trequired: isRequiredColumn(converterContext, dataField as DataFieldTypes, tableCreationMode),\n\t\t\t\trelativePath: relativePath,\n\t\t\t\tsortable: sortable,\n\t\t\t\tpropertyInfos: relatedPropertyNames.length ? relatedPropertyNames : undefined,\n\t\t\t\tadditionalPropertyInfos: additionalPropertyNames.length > 0 ? additionalPropertyNames : undefined,\n\t\t\t\texportSettings: exportSettings,\n\t\t\t\twidth: (dataField.annotations?.HTML5?.CssDefaults?.width?.valueOf() as string) || undefined,\n\t\t\t\timportance: getImportance(converterContext, dataField as DataFieldTypes),\n\t\t\t\tisNavigable: true,\n\t\t\t\tformatOptions: formatOptions,\n\t\t\t\tcaseSensitive: isFilteringCaseSensitive(converterContext),\n\t\t\t\ttypeConfig: typeConfig,\n\t\t\t\tvisualSettings: visualSettings,\n\t\t\t\ttimezoneText: exportSettings?.timezone,\n\t\t\t\tisPartOfLineItem: true,\n\t\t\t\tisMultiValue\n\t\t\t};\n\t\t\tconst tooltip = _getTooltip(dataField) ?? sLabel;\n\t\t\tif (tooltip) {\n\t\t\t\tcolumn.tooltip = tooltip;\n\t\t\t}\n\t\t\tif (relatedPropertiesInfo.exportSettings.dataPointTargetValue) {\n\t\t\t\tcolumn.exportDataPointTargetValue = relatedPropertiesInfo.exportSettings.dataPointTargetValue;\n\t\t\t}\n\t\t\tannotationColumns.push(column);\n\t\t\t// Collect information of related columns to be created.\n\t\t\trelatedPropertyNames.forEach((relatedPropertyName) => {\n\t\t\t\tcolumnsToBeCreated[relatedPropertyName] = relatedPropertiesInfo.properties[relatedPropertyName].annotationProperty;\n\t\t\t\t// In case of a multi-value, related properties cannot be sorted as we go through a 1-n relation\n\t\t\t\tif (isMultiValue) {\n\t\t\t\t\trestrictionsOnProperties.nonSortableProperties.push(relatedPropertyName);\n\t\t\t\t}\n\t\t\t\taddPropertyToDisplayModeOfDescriptionPropertiesMap(\n\t\t\t\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\t\t\t\trelatedPropertiesInfo,\n\t\t\t\t\trelatedPropertyName\n\t\t\t\t);\n\t\t\t\t// In case the lineItem points to a navigation property with a textArrangement TextOnly, we need to create the column with the value navigation property.\n\t\t\t\t// The text property is referenced on the related properties of the lineItem, so will be created on the _createRelatedColumns method.\n\t\t\t\tif (relatedPropertiesInfo.properties[relatedPropertyName].displayModeOfPropertyUsedAsDescription === \"Description\") {\n\t\t\t\t\tcreatePropertyAnnotatedTextOnly(\n\t\t\t\t\t\tconverterContext,\n\t\t\t\t\t\tpropertyDataModelObjectPath,\n\t\t\t\t\t\tdataField,\n\t\t\t\t\t\tcolumnsToBeCreated,\n\t\t\t\t\t\trelativePath,\n\t\t\t\t\t\trestrictionsOnProperties\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Create columns for additional properties identified for ALP use case.\n\t\t\tadditionalPropertyNames.forEach((additionalPropertyName) => {\n\t\t\t\t// Intentional overwrite as we require only one new PropertyInfo for a related Property.\n\t\t\t\tcolumnsToBeCreated[additionalPropertyName] = relatedPropertiesInfo.additionalProperties[additionalPropertyName];\n\t\t\t});\n\t\t});\n\t}\n\t// Get columns from the Properties of EntityType\n\treturn getColumnsFromEntityType(\n\t\tcolumnsToBeCreated,\n\t\tentityType,\n\t\tannotationColumns,\n\t\tconverterContext,\n\t\ttableType,\n\t\ttableCreationMode,\n\t\tdisplayModeOfDescriptionPropertiesMap,\n\t\trestrictionsOnProperties\n\t);\n};\n/**\n * Gets the property names from the manifest and checks against existing properties already added by annotations.\n * If a not yet stored property is found it adds it for sorting and filtering only to the annotationColumns.\n * @param properties\n * @param annotationColumns\n * @param converterContext\n * @param entityType\n * @returns The columns from the annotations\n */\nconst _getPropertyNames = function (\n\tproperties: string[] | undefined,\n\tannotationColumns: AnnotationTableColumn[],\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tentityType: EntityType\n): string[] | undefined {\n\tlet matchedProperties: string[] | undefined;\n\tif (properties) {\n\t\tmatchedProperties = properties.map(function (propertyPath) {\n\t\t\tconst annotationColumn = annotationColumns.find(function (annotationColumn) {\n\t\t\t\treturn annotationColumn.relativePath === propertyPath && annotationColumn.propertyInfos === undefined;\n\t\t\t});\n\t\t\tif (annotationColumn) {\n\t\t\t\treturn annotationColumn.name;\n\t\t\t} else {\n\t\t\t\tconst relatedColumns = _createRelatedColumns(\n\t\t\t\t\t{ [propertyPath]: entityType.resolvePath(propertyPath) },\n\t\t\t\t\tannotationColumns,\n\t\t\t\t\tconverterContext,\n\t\t\t\t\tentityType,\n\t\t\t\t\t{}\n\t\t\t\t);\n\t\t\t\tannotationColumns.push(relatedColumns[0]);\n\t\t\t\treturn relatedColumns[0].name;\n\t\t\t}\n\t\t});\n\t}\n\treturn matchedProperties;\n};\n\n/**\n * Determines if the field group has to be flagged as required.\n * @param converterContext The converter context\n * @param fieldGroup The fieldGroup being processed\n * @param tableCreationMode The creation mode of the underlying table\n * @returns True if the fieldGroup is required.\n */\nconst isRequiredFieldGroup = function (\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tfieldGroup: FieldGroup,\n\ttableCreationMode: CreationMode\n): boolean {\n\tconst fieldGroupData = fieldGroup.Data;\n\treturn fieldGroupData.some(function (item) {\n\t\t// we exclude boolean type, the end-user may want to keep the underlying check box empty on purpose\n\t\tif (isDataField(item) && item?.Value?.$target.type !== \"Edm.Boolean\") {\n\t\t\treturn (\n\t\t\t\tisStaticallyMandatory(item) ||\n\t\t\t\t(tableCreationMode === CreationMode.InlineCreationRows &&\n\t\t\t\t\tisAnnotatedRequiredProperty(item.Value.$target.fullyQualifiedName, converterContext))\n\t\t\t);\n\t\t}\n\t});\n};\n\n/**\n * Determines if the dataFieldForAnnotation has to be flagged as required.\n * @param converterContext The converter context\n * @param dataFieldForAnnotation The property being processed\n * @param tableCreationMode The creation mode of the underlying table\n * @returns True if the property is required.\n */\nconst isRequiredDataFieldForAnnotation = function (\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tdataFieldForAnnotation: DataFieldForAnnotation,\n\ttableCreationMode: CreationMode\n): boolean {\n\tconst dataFieldTarget = dataFieldForAnnotation.Target.$target;\n\tconst DataFieldForAnnotationFieldControlNotMandatory = hasFieldControlNotMandatory(dataFieldForAnnotation);\n\t// Check if the DataFieldForAnnotation points to a FieldGroup\n\tif (hasFieldGroupTarget(dataFieldForAnnotation)) {\n\t\tif (isRequiredFieldGroup(converterContext, dataFieldTarget as FieldGroup, tableCreationMode)) {\n\t\t\treturn true;\n\t\t}\n\t\tconst fieldGroupData = (dataFieldTarget as FieldGroup).Data;\n\t\treturn fieldGroupData.some((innerDataField: DataFieldAbstractTypes) => {\n\t\t\treturn isRequiredColumn(converterContext, innerDataField, tableCreationMode);\n\t\t});\n\t}\n\t/*If the underlying datapoint is a rating indicator, the end-user may want to keep the rating empty (value 0) on purpose.\n\tBesides, currently, only a fieldControl set on a dataFieldForAnnotation pointing to a dataPoint has an influence in the table.\n\tAccordingly, if a datapoint comes from a dataFieldForAnnotation with a fieldControl set as not mandatory, this dataPoint must not be flagged as \"required\"*/\n\tif (hasDataPointTarget(dataFieldForAnnotation) && (dataFieldTarget as DataPoint).Visualization !== \"UI.VisualizationType/Rating\") {\n\t\tif (DataFieldForAnnotationFieldControlNotMandatory) {\n\t\t\treturn false;\n\t\t}\n\t\tif (isStaticallyMandatory(dataFieldForAnnotation)) {\n\t\t\treturn true;\n\t\t}\n\t\treturn isRequiredDataPoint(converterContext, dataFieldTarget as DataPoint, tableCreationMode);\n\t}\n\treturn false;\n};\n\n/**\n * Determines if the property has to be flagged as required.\n * @param converterContext The converter context\n * @param property The property being processed\n * @param tableCreationMode The creation mode of the underlying table\n * @returns True if the property is required.\n */\nconst isRequiredProperty = function (\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tproperty: Property,\n\ttableCreationMode: CreationMode\n): boolean {\n\treturn (\n\t\tproperty.type !== \"Edm.Boolean\" &&\n\t\t!isRatingVisualizationFromDataFieldDefault(property) &&\n\t\t(isStaticallyMandatory(property) ||\n\t\t\t(tableCreationMode === CreationMode.InlineCreationRows &&\n\t\t\t\tisAnnotatedRequiredProperty(property.fullyQualifiedName, converterContext)))\n\t);\n};\n\n/**\n * Determines if the dataPoint has to be flagged as required.\n * @param converterContext The converter context\n * @param dataPoint The dataPoint being processed\n * @param tableCreationMode The creation mode of the underlying table\n * @returns True if the dataPoint is required.\n */\nconst isRequiredDataPoint = function (\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tdataPoint: DataPoint,\n\ttableCreationMode: CreationMode\n): boolean {\n\treturn (\n\t\tisStaticallyMandatory(dataPoint) ||\n\t\t(tableCreationMode === CreationMode.InlineCreationRows &&\n\t\t\tisAnnotatedRequiredProperty(dataPoint.Value.$target.fullyQualifiedName, converterContext))\n\t);\n};\n\n/**\n * Determines if the underlying column has to be flagged as required.\n * @param converterContext The converter context\n * @param target The target being processed\n * @param tableCreationMode The creation mode of the underlying table\n * @returns The binding expression for the 'required' property of the table column.\n */\nconst isRequiredColumn = function (\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\ttarget: DataFieldAbstractTypes | Property,\n\ttableCreationMode?: CreationMode\n): CompiledBindingToolkitExpression {\n\tconst creationMode = tableCreationMode || CreationMode.Inline;\n\tif (\n\t\tconverterContext.getTemplateType() === TemplateType.ListReport ||\n\t\tconverterContext.getTemplateType() === TemplateType.AnalyticalListPage\n\t) {\n\t\treturn undefined;\n\t}\n\tif (isProperty(target)) {\n\t\treturn isRequiredProperty(converterContext, target, creationMode) ? compileExpression(UI.IsEditable) : undefined;\n\t}\n\t// Check if the dataField is of type DataFieldForAnnotation\n\tif (isDataFieldForAnnotation(target)) {\n\t\treturn isRequiredDataFieldForAnnotation(converterContext, target, creationMode) ? compileExpression(UI.IsEditable) : undefined;\n\t}\n\t//If the underlying property is a boolean, the end-user may want to keep the check box empty on purpose\n\tif (isDataField(target) && target.Value?.$target?.type !== \"Edm.Boolean\") {\n\t\treturn isStaticallyMandatory(target) ||\n\t\t\t(creationMode === CreationMode.InlineCreationRows &&\n\t\t\t\tisAnnotatedRequiredProperty(target.Value.$target.fullyQualifiedName, converterContext))\n\t\t\t? compileExpression(UI.IsEditable)\n\t\t\t: undefined;\n\t}\n\treturn undefined;\n};\nconst _appendCustomTemplate = function (properties: string[] | undefined, exportProperties: string[] | undefined): string | undefined {\n\tif (exportProperties?.length) {\n\t\tproperties = exportProperties;\n\t}\n\tif (properties) {\n\t\treturn properties\n\t\t\t.map((property) => {\n\t\t\t\treturn `{${properties!.indexOf(property)}}`;\n\t\t\t})\n\t\t\t.join(`${\"\\n\"}`);\n\t}\n\treturn undefined;\n};\n/**\n * Returns table column definitions from manifest.\n *\n * These may be custom columns defined in the manifest, slot columns coming through\n * a building block, or annotation columns to overwrite annotation-based columns.\n * @param columns\n * @param annotationColumns\n * @param converterContext\n * @param entityType\n * @param navigationSettings\n * @returns The columns from the manifest\n */\nconst getColumnsFromManifest = function (\n\tcolumns: Record<string, CustomDefinedTableColumn | CustomDefinedTableColumnForOverride>,\n\tannotationColumns: AnnotationTableColumn[],\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tentityType: EntityType,\n\tnavigationSettings?: NavigationSettingsConfiguration\n): Record<string, ManifestColumn> {\n\tconst internalColumns: Record<string, ManifestColumn> = {};\n\tfunction isAnnotationColumn(\n\t\tcolumn: CustomDefinedTableColumn | CustomDefinedTableColumnForOverride,\n\t\tkey: string\n\t): column is CustomDefinedTableColumnForOverride {\n\t\treturn annotationColumns.some((annotationColumn) => annotationColumn.key === key);\n\t}\n\tfunction isSlotColumn(manifestColumn: CustomDefinedTableColumn): manifestColumn is FragmentDefinedSlotColumn {\n\t\treturn manifestColumn.type === ColumnType.Slot;\n\t}\n\tfunction isCustomColumn(manifestColumn: CustomDefinedTableColumn): manifestColumn is ManifestDefinedCustomColumn {\n\t\treturn manifestColumn.type === undefined && !!manifestColumn.template;\n\t}\n\tfunction _updateLinkedPropertiesOnCustomColumns(propertyInfos: string[], annotationTableColumns: AnnotationTableColumn[]): void {\n\t\tconst restrictionsOnProperties = getRestrictionsOnProperties(converterContext.getEntitySet());\n\t\tpropertyInfos.forEach((property) => {\n\t\t\tannotationTableColumns.forEach((prop) => {\n\t\t\t\tif (prop.name === property) {\n\t\t\t\t\tprop.sortable = !restrictionsOnProperties.nonSortableProperties.includes(property.replace(\"Property::\", \"\"));\n\t\t\t\t\tprop.isGroupable = prop.sortable;\n\t\t\t\t\tprop.filterable = !restrictionsOnProperties.nonFilterableProperties.includes(property.replace(\"Property::\", \"\"));\n\t\t\t\t\tprop.isPartOfCustomColumn = true;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tfor (const key in columns) {\n\t\tconst manifestColumn = columns[key];\n\t\tKeyHelper.validateKey(key);\n\t\t// BaseTableColumn\n\t\tconst baseTableColumn = {\n\t\t\tkey: key,\n\t\t\twidthIncludingColumnHeader: manifestColumn.widthIncludingColumnHeader,\n\t\t\twidth: manifestColumn.width || undefined,\n\t\t\tposition: {\n\t\t\t\tanchor: manifestColumn.position?.anchor,\n\t\t\t\tplacement: manifestColumn.position === undefined ? Placement.After : manifestColumn.position.placement\n\t\t\t},\n\t\t\tcaseSensitive: isFilteringCaseSensitive(converterContext)\n\t\t};\n\t\tif (isAnnotationColumn(manifestColumn, key)) {\n\t\t\tconst propertiesToOverwriteAnnotationColumn: CustomElement<AnnotationTableColumnForOverride> = {\n\t\t\t\t...baseTableColumn,\n\t\t\t\timportance: manifestColumn?.importance,\n\t\t\t\thorizontalAlign: manifestColumn?.horizontalAlign,\n\t\t\t\tavailability: manifestColumn?.availability,\n\t\t\t\ttype: ColumnType.Annotation,\n\t\t\t\tisNavigable: isAnnotationColumn(manifestColumn, key)\n\t\t\t\t\t? undefined\n\t\t\t\t\t: isActionNavigable(manifestColumn, navigationSettings, true),\n\t\t\t\tsettings: manifestColumn.settings,\n\t\t\t\tformatOptions: _getDefaultFormatOptionsForTable(manifestColumn.formatOptions),\n\t\t\t\texportSettings: getCustomExportSettings(\n\t\t\t\t\tmanifestColumn?.exportSettings,\n\t\t\t\t\tannotationColumns,\n\t\t\t\t\tconverterContext,\n\t\t\t\t\tentityType,\n\t\t\t\t\tundefined,\n\t\t\t\t\tkey\n\t\t\t\t)\n\t\t\t};\n\t\t\tinternalColumns[key] = propertiesToOverwriteAnnotationColumn;\n\t\t} else {\n\t\t\tconst propertyInfos: string[] | undefined = _getPropertyNames(\n\t\t\t\tmanifestColumn.properties,\n\t\t\t\tannotationColumns,\n\t\t\t\tconverterContext,\n\t\t\t\tentityType\n\t\t\t);\n\t\t\tconst tooltipText = converterContext.fetchTextFromMetaModel(manifestColumn.tooltip),\n\t\t\t\theaderText = converterContext.fetchTextFromMetaModel(manifestColumn.header);\n\n\t\t\tconst customColumnExportSettings: ColumnExportSettings | null = propertyInfos\n\t\t\t\t? getCustomExportSettings(manifestColumn?.exportSettings, annotationColumns, converterContext, entityType, propertyInfos)\n\t\t\t\t: null;\n\t\t\tconst baseManifestColumn = {\n\t\t\t\t...baseTableColumn,\n\t\t\t\theader: headerText,\n\t\t\t\timportance: manifestColumn?.importance || Importance.None,\n\t\t\t\thorizontalAlign: manifestColumn?.horizontalAlign || HorizontalAlign.Begin,\n\t\t\t\tavailability: manifestColumn?.availability || \"Default\",\n\t\t\t\ttemplate: manifestColumn.template,\n\t\t\t\tpropertyInfos: propertyInfos,\n\t\t\t\texportSettings: customColumnExportSettings,\n\t\t\t\tid: `CustomColumn::${key}`,\n\t\t\t\tname: `CustomColumn::${key}`,\n\t\t\t\t//Needed for MDC:\n\t\t\t\tformatOptions: { textLinesEdit: 4 },\n\t\t\t\tisGroupable: false,\n\t\t\t\tisNavigable: false,\n\t\t\t\tsortable: false,\n\t\t\t\tvisualSettings: { widthCalculation: null },\n\t\t\t\ttooltip: tooltipText ? tooltipText : headerText,\n\t\t\t\tproperties: manifestColumn.properties,\n\t\t\t\trequired:\n\t\t\t\t\tmanifestColumn.required &&\n\t\t\t\t\tconverterContext.getTemplateType() !== TemplateType.ListReport &&\n\t\t\t\t\tconverterContext.getTemplateType() !== TemplateType.AnalyticalListPage\n\t\t\t\t\t\t? compileExpression(UI.IsEditable)\n\t\t\t\t\t\t: undefined\n\t\t\t};\n\t\t\tif (propertyInfos) {\n\t\t\t\t_updateLinkedPropertiesOnCustomColumns(propertyInfos, annotationColumns);\n\t\t\t}\n\t\t\tif (isSlotColumn(manifestColumn)) {\n\t\t\t\tconst customTableColumn: CustomElement<CustomBasedTableColumn> = {\n\t\t\t\t\t...baseManifestColumn,\n\t\t\t\t\ttype: ColumnType.Slot\n\t\t\t\t};\n\t\t\t\tinternalColumns[key] = customTableColumn;\n\t\t\t} else if (isCustomColumn(manifestColumn)) {\n\t\t\t\tconst customTableColumn: CustomElement<CustomBasedTableColumn> = {\n\t\t\t\t\t...baseManifestColumn,\n\t\t\t\t\ttype: ColumnType.Default\n\t\t\t\t};\n\t\t\t\tinternalColumns[key] = customTableColumn;\n\t\t\t} else {\n\t\t\t\tconst message = `The annotation column '${key}' referenced in the manifest is not found`;\n\t\t\t\tconverterContext\n\t\t\t\t\t.getDiagnostics()\n\t\t\t\t\t.addIssue(\n\t\t\t\t\t\tIssueCategory.Manifest,\n\t\t\t\t\t\tIssueSeverity.Low,\n\t\t\t\t\t\tmessage,\n\t\t\t\t\t\tIssueCategoryType,\n\t\t\t\t\t\tIssueCategoryType?.AnnotationColumns?.InvalidKey\n\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\treturn internalColumns;\n};\n\n/**\n * Adds computed columns such as the draft status and situations status.\n * @param tableColumns The table columns collected so far\n * @param visualizationPath\n * @param converterContext\n * @returns The enriched set of table columns\n */\nexport function addComputedColumns(\n\ttableColumns: TableColumn[],\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): TableColumn[] {\n\tconst tableManifestSettings: TableManifestConfiguration = converterContext.getManifestControlConfiguration(visualizationPath);\n\tconst tableType = getTableType(converterContext, tableManifestSettings);\n\n\tif (![\"GridTable\", \"TreeTable\", \"AnalyticalTable\"].includes(tableType)) {\n\t\t// Computed columns are not used in Responsive tables\n\t\treturn tableColumns;\n\t}\n\n\t// In case a grid table or tree table is used, we display the situations indicator in a separate column\n\t// so we have to disable it here to ensure, that the field building block\n\t// does not render it into the ID column\n\tconst columnWithSituationsIndicator: TableColumn | undefined = tableColumns.find(\n\t\t(column) => column.formatOptions?.hasSituationsIndicator !== undefined && column.formatOptions?.hasSituationsIndicator === true\n\t);\n\tif (columnWithSituationsIndicator?.formatOptions) {\n\t\t// Switch off the situations indicator in the found column\n\t\tcolumnWithSituationsIndicator.formatOptions.hasSituationsIndicator = false;\n\n\t\t// Insert a separate situations indicator column\n\t\tconst situationsIndicatorColumn: ComputedTableColumn = {\n\t\t\tkey: \"situationsIndicator\",\n\t\t\tname: \"situationsIndicator\",\n\t\t\tpropertyKey: columnWithSituationsIndicator.name,\n\t\t\tisSituationsIndicator: true,\n\t\t\tavailability: \"Default\",\n\t\t\tlabel: \"{sap.fe.i18n>C_SITUATIONS_STATUS_COLUMN_LABEL_TOOLTIP}\",\n\t\t\ttooltip: \"{sap.fe.i18n>C_SITUATIONS_STATUS_COLUMN_LABEL_TOOLTIP}\",\n\t\t\ttype: ColumnType.Computed,\n\t\t\tformatOptions: null,\n\t\t\texportSettings: null,\n\t\t\tclipboardSettings: null,\n\t\t\tpropertyInfos: undefined,\n\t\t\tcaseSensitive: false\n\t\t};\n\n\t\t// Place the draft status column after the first visible column\n\t\tconst indexOfFirstVisibleColumn: int = tableColumns.findIndex((column) => column.availability !== \"Hidden\");\n\t\ttableColumns.splice(indexOfFirstVisibleColumn + 1, 0, situationsIndicatorColumn);\n\t}\n\n\t// In case a grid table or tree table is used, we display the draft indicator in a separate column\n\t// so we have to disable it here to ensure, that the field building block\n\t// does not render it into the ID column\n\t// The additional column is only added for tables on a LR and in case tehe entity is draft enabled!\n\tconst columnsWithDraftIndicator: TableColumn[] = tableColumns.filter((column) => column.formatOptions?.hasDraftIndicator === true);\n\tif (\n\t\tcolumnsWithDraftIndicator.length &&\n\t\tconverterContext.getTemplateType() === TemplateType.ListReport &&\n\t\t(ModelHelper.isDraftNode(converterContext.getEntitySet()) || ModelHelper.isDraftRoot(converterContext.getEntitySet()))\n\t) {\n\t\t// Switch off the draft indicator in the found column\n\t\tcolumnsWithDraftIndicator.forEach((columnWithDraftIndicator: TableColumn) => {\n\t\t\tif (columnWithDraftIndicator?.formatOptions) {\n\t\t\t\tcolumnWithDraftIndicator.formatOptions.hasDraftIndicator = false;\n\t\t\t}\n\t\t});\n\n\t\t// Insert a separate draft indicator column\n\t\tconst draftIndicatorColumn: ComputedTableColumn = {\n\t\t\tkey: \"draftStatus\",\n\t\t\tname: \"draftStatus\",\n\t\t\tpropertyKey: columnsWithDraftIndicator[0].name,\n\t\t\tisDraftIndicator: true,\n\t\t\tavailability: \"Default\",\n\t\t\tlabel: \"{sap.fe.i18n>C_DRAFT_STATUS_COLUMN_LABEL_TOOLTIP}\",\n\t\t\ttooltip: \"{sap.fe.i18n>C_DRAFT_STATUS_COLUMN_LABEL_TOOLTIP}\",\n\t\t\ttype: ColumnType.Computed,\n\t\t\tformatOptions: null,\n\t\t\texportSettings: null,\n\t\t\tcaseSensitive: false\n\t\t};\n\t\tlet columnIndexToInsertAfter: int = 0;\n\t\tif (columnWithSituationsIndicator) {\n\t\t\t// If there's a situations indicator column, place the draft status column before it\n\t\t\tcolumnIndexToInsertAfter =\n\t\t\t\ttableColumns.findIndex((column) => (column as ComputedTableColumn).isSituationsIndicator === true) - 1;\n\t\t} else {\n\t\t\t// Otherwise place the draft status column after the first visible column\n\t\t\tcolumnIndexToInsertAfter = tableColumns.findIndex((column) => column.availability !== \"Hidden\");\n\t\t}\n\t\ttableColumns.splice(columnIndexToInsertAfter + 1, 0, draftIndicatorColumn);\n\t}\n\n\treturn tableColumns;\n}\n\nexport function getP13nMode(\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\ttableManifestConfiguration: TableControlConfiguration\n): TableP13nMode[] | undefined {\n\tconst manifestWrapper: ManifestWrapper = converterContext.getManifestWrapper();\n\tconst tableManifestSettings: TableManifestConfiguration = converterContext.getManifestControlConfiguration(visualizationPath);\n\tconst variantManagement: VariantManagementType = manifestWrapper.getVariantManagement();\n\tconst modes: TableP13nMode[] = [];\n\tconst isAnalyticalTable = tableManifestConfiguration.type === \"AnalyticalTable\";\n\tconst isResponsiveTable = tableManifestConfiguration.type === \"ResponsiveTable\";\n\tif (tableManifestSettings?.tableSettings?.personalization !== undefined) {\n\t\t// Personalization configured in manifest.\n\t\tconst personalization = tableManifestSettings.tableSettings.personalization;\n\t\tif (personalization === true) {\n\t\t\t// Table personalization fully enabled.\n\t\t\tswitch (tableManifestConfiguration.type) {\n\t\t\t\tcase \"AnalyticalTable\":\n\t\t\t\t\treturn [\"Sort\", \"Column\", \"Filter\", \"Group\", \"Aggregate\"];\n\t\t\t\tcase \"ResponsiveTable\":\n\t\t\t\t\treturn [\"Sort\", \"Column\", \"Filter\", \"Group\"];\n\t\t\t\tdefault:\n\t\t\t\t\treturn [\"Sort\", \"Column\", \"Filter\"];\n\t\t\t}\n\t\t} else if (typeof personalization === \"object\") {\n\t\t\t// Specific personalization options enabled in manifest. Use them as is.\n\t\t\tif (personalization.sort) {\n\t\t\t\tmodes.push(\"Sort\");\n\t\t\t}\n\t\t\tif (personalization.column) {\n\t\t\t\tmodes.push(\"Column\");\n\t\t\t}\n\t\t\tif (personalization.filter) {\n\t\t\t\tmodes.push(\"Filter\");\n\t\t\t}\n\t\t\tif (personalization.group && (isAnalyticalTable || isResponsiveTable)) {\n\t\t\t\tmodes.push(\"Group\");\n\t\t\t}\n\t\t\tif (personalization.aggregate && isAnalyticalTable) {\n\t\t\t\tmodes.push(\"Aggregate\");\n\t\t\t}\n\t\t\treturn modes.length > 0 ? modes : undefined;\n\t\t}\n\t} else {\n\t\t// No personalization configured in manifest.\n\t\tmodes.push(\"Sort\");\n\t\tmodes.push(\"Column\");\n\t\tif (converterContext.getTemplateType() === TemplateType.ListReport) {\n\t\t\tif (variantManagement === VariantManagementType.Control || _isFilterBarHidden(manifestWrapper, converterContext)) {\n\t\t\t\t// Feature parity with V2.\n\t\t\t\t// Enable table filtering by default only in case of Control level variant management.\n\t\t\t\t// Or when the LR filter bar is hidden via manifest setting\n\t\t\t\tmodes.push(\"Filter\");\n\t\t\t}\n\t\t} else {\n\t\t\tmodes.push(\"Filter\");\n\t\t}\n\t\tif (isAnalyticalTable) {\n\t\t\tmodes.push(\"Group\");\n\t\t\tmodes.push(\"Aggregate\");\n\t\t}\n\t\tif (isResponsiveTable) {\n\t\t\tmodes.push(\"Group\");\n\t\t}\n\t\treturn modes;\n\t}\n}\n/**\n * Returns a Boolean value suggesting if a filter bar is being used on the page.\n *\n * Chart has a dependency to filter bar (issue with loading data). Once resolved, the check for chart should be removed here.\n * Until then, hiding filter bar is now allowed if a chart is being used on LR.\n * @param manifestWrapper Manifest settings getter for the page\n * @param converterContext The instance of the converter context\n * @returns Boolean suggesting if a filter bar is being used on the page.\n */\nfunction _isFilterBarHidden(manifestWrapper: ManifestWrapper, converterContext: ConverterContext<PageContextPathTarget>): boolean {\n\treturn (\n\t\tmanifestWrapper.isFilterBarHidden() &&\n\t\t!converterContext.getManifestWrapper().hasMultipleVisualizations() &&\n\t\tconverterContext.getTemplateType() !== TemplateType.AnalyticalListPage\n\t);\n}\n/**\n * Returns a JSON string containing the sort conditions for the presentation variant.\n * @param converterContext The instance of the converter context\n * @param presentationVariantAnnotation Presentation variant annotation\n * @param columns Table columns processed by the converter\n * @returns Sort conditions for a presentation variant.\n */\nfunction getSortConditions(\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tpresentationVariantAnnotation: PresentationVariantType | undefined,\n\tcolumns: TableColumn[]\n): TableSortConditions | undefined {\n\t// Currently navigation property is not supported as sorter\n\tconst nonSortableProperties = getRestrictionsOnProperties(converterContext.getEntitySet()).nonSortableProperties;\n\tconst sortConditions: TableSortConditions = {\n\t\tsorters: []\n\t};\n\tif (presentationVariantAnnotation?.SortOrder) {\n\t\tpresentationVariantAnnotation.SortOrder.forEach((condition) => {\n\t\t\tconst conditionProperty = condition.Property;\n\t\t\tif (conditionProperty?.$target !== undefined && !nonSortableProperties.includes(conditionProperty.$target.name)) {\n\t\t\t\tconst infoName = convertPropertyPathsToInfoNames([conditionProperty], columns)[0];\n\t\t\t\tif (infoName) {\n\t\t\t\t\tsortConditions.sorters.push({\n\t\t\t\t\t\tname: infoName,\n\t\t\t\t\t\tdescending: !!condition.Descending\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\treturn sortConditions.sorters.length ? sortConditions : undefined;\n}\nfunction getInitialExpansionLevel(presentationVariantAnnotation: PresentationVariantType | undefined): number | undefined {\n\tif (!presentationVariantAnnotation) {\n\t\treturn undefined;\n\t}\n\tconst level = presentationVariantAnnotation.InitialExpansionLevel?.valueOf();\n\treturn typeof level === \"number\" ? level + 1 : undefined;\n}\n/**\n * Converts an array of propertyPath to an array of propertyInfo names.\n * @param paths The array to be converted\n * @param columns The array of propertyInfos\n * @returns An array of propertyInfo names\n */\nfunction convertPropertyPathsToInfoNames(paths: PropertyPath[], columns: TableColumn[]): string[] {\n\tconst infoNames: string[] = [];\n\tlet propertyInfo: TableColumn | undefined, annotationColumn: AnnotationTableColumn;\n\tpaths.forEach((currentPath) => {\n\t\tif (currentPath?.value) {\n\t\t\tpropertyInfo = columns.find((column) => {\n\t\t\t\tannotationColumn = column as AnnotationTableColumn;\n\t\t\t\treturn !annotationColumn.propertyInfos && annotationColumn.relativePath === currentPath?.value;\n\t\t\t});\n\t\t\tif (propertyInfo) {\n\t\t\t\tinfoNames.push(propertyInfo.name);\n\t\t\t}\n\t\t}\n\t});\n\treturn infoNames;\n}\n/**\n * Returns a JSON string containing Presentation Variant group conditions.\n * @param presentationVariantAnnotation Presentation variant annotation\n * @param columns Converter processed table columns\n * @param tableType The table type.\n * @returns Group conditions for a Presentation variant.\n */\nfunction getGroupConditions(\n\tpresentationVariantAnnotation: PresentationVariantType | undefined,\n\tcolumns: TableColumn[],\n\ttableType: string\n): TableGroupConditions | undefined {\n\tconst groupConditions: TableGroupConditions = {\n\t\tgroupLevels: []\n\t};\n\tif (presentationVariantAnnotation?.GroupBy) {\n\t\tlet aGroupBy = presentationVariantAnnotation.GroupBy;\n\t\tif (tableType === \"ResponsiveTable\") {\n\t\t\taGroupBy = aGroupBy.slice(0, 1);\n\t\t}\n\t\tgroupConditions.groupLevels = convertPropertyPathsToInfoNames(aGroupBy, columns).map((infoName) => {\n\t\t\treturn { name: infoName };\n\t\t});\n\t}\n\treturn groupConditions.groupLevels.length ? groupConditions : undefined;\n}\n/**\n * Updates the column's propertyInfos of a analytical table integrating all extensions and binding-relevant property info part.\n * @param tableVisualization The visualization to be updated\n */\nfunction _updatePropertyInfosWithAggregatesDefinitions(tableVisualization: TableVisualization): void {\n\tconst relatedAdditionalPropertyNameMap: Record<string, string> = {};\n\ttableVisualization.columns.forEach((column) => {\n\t\tcolumn = column as AnnotationTableColumn;\n\t\tconst aggregatablePropertyName = Object.keys(tableVisualization.analyticsExtensions!).find(\n\t\t\t(aggregate) => aggregate === column.name\n\t\t);\n\t\tif (aggregatablePropertyName) {\n\t\t\tconst aggregatablePropertyDefinition = tableVisualization.analyticsExtensions![aggregatablePropertyName];\n\t\t\tcolumn.aggregatable = !aggregatablePropertyDefinition.fromGroupableProperty;\n\t\t\tcolumn.extension = aggregatablePropertyDefinition ?? {};\n\t\t}\n\t\tif (column.additionalPropertyInfos?.length) {\n\t\t\tcolumn.additionalPropertyInfos.forEach((additionalPropertyInfo) => {\n\t\t\t\t// Create propertyInfo for each additional property.\n\t\t\t\t// The new property 'name' has been prefixed with 'Property_Technical::' for uniqueness and it has been named technical property as it requires dedicated MDC attributes (technicallyGroupable and technicallyAggregatable).\n\t\t\t\tcreateTechnicalProperty(additionalPropertyInfo, tableVisualization.columns, relatedAdditionalPropertyNameMap);\n\t\t\t});\n\t\t}\n\t});\n\ttableVisualization.columns.forEach((column) => {\n\t\tcolumn = column as AnnotationTableColumn;\n\t\tif (column.additionalPropertyInfos) {\n\t\t\tcolumn.additionalPropertyInfos = column.additionalPropertyInfos.map(\n\t\t\t\t(propertyInfo) => relatedAdditionalPropertyNameMap[propertyInfo] ?? propertyInfo\n\t\t\t);\n\t\t\t// Add additional properties to the complex property using the hidden annotation.\n\t\t\tcolumn.propertyInfos = column.propertyInfos?.concat(column.additionalPropertyInfos);\n\t\t}\n\t});\n}\n/**\n * Provides the required properties set on the annotations.\n * @param converterContext  The instance of the converter context\n * @returns The paths of the restricted properties\n */\nfunction getRequiredProperties(converterContext: ConverterContext<PageContextPathTarget>): PropertyPath[] {\n\treturn getContextPropertyRestriction(\n\t\tconverterContext.getDataModelObjectPath(),\n\t\t(capabilities) => {\n\t\t\treturn (capabilities as EntitySetAnnotations_Capabilities | undefined)?.InsertRestrictions?.RequiredProperties;\n\t\t},\n\t\tfalse\n\t);\n}\n/**\n * Determines if the property is annotated as a required property.\n * @param name The name of the property\n * @param converterContext The instance of the converter context\n * @returns True if the property is required\n */\nfunction isAnnotatedRequiredProperty(name: string, converterContext: ConverterContext<PageContextPathTarget>): boolean {\n\treturn getRequiredProperties(converterContext)\n\t\t.map((property) => property.$target?.fullyQualifiedName)\n\t\t.includes(name);\n}\n/**\n * Returns a JSON string containing Presentation Variant aggregate conditions.\n * @param presentationVariantAnnotation Presentation variant annotation\n * @param columns Converter processed table columns\n * @param extensionInfoMap\n * @returns Group conditions for a Presentation variant.\n */\nfunction getAggregateConditions(\n\tpresentationVariantAnnotation: PresentationVariantType | undefined,\n\tcolumns: TableColumn[],\n\textensionInfoMap: Record<string, InternalExtensionForAnalytics>\n): TableAggregateConditions | undefined {\n\tconst aggregateConditions: TableAggregateConditions = {};\n\tif (presentationVariantAnnotation?.Total) {\n\t\tconst aTotals = presentationVariantAnnotation.Total;\n\t\tconvertPropertyPathsToInfoNames(aTotals, columns).forEach((infoName) => {\n\t\t\taggregateConditions[infoName] = {};\n\t\t});\n\t} else {\n\t\tfor (const key in extensionInfoMap) {\n\t\t\tif (!extensionInfoMap[key].fromGroupableProperty) {\n\t\t\t\taggregateConditions[key] = {};\n\t\t\t}\n\t\t}\n\t}\n\treturn Object.keys(aggregateConditions).length ? aggregateConditions : undefined;\n}\nexport type StandardActionsConfiguration = {\n\tcreationBehaviour: TableAnnotationConfiguration[\"create\"];\n\tcutButtonVisibilityExpression: BindingToolkitExpression<boolean>;\n\tdeleteButtonVisibilityExpression: BindingToolkitExpression<boolean>;\n\tmassEditButtonVisibilityExpression: BindingToolkitExpression<boolean>;\n\tisInsertUpdateActionsTemplated: boolean;\n\tstandardActions: {\n\t\tcreate: StandardAction;\n\t\tdelete: StandardAction;\n\t\tpaste: StandardAction;\n\t\tmassEdit: StandardAction;\n\t\tinsights: StandardAction;\n\t\tcreationRow: StandardAction;\n\t\tcut: StandardAction;\n\t\tmoveUp?: StandardAction;\n\t\tmoveDown?: StandardAction;\n\t};\n};\n/**\n * Calculates the standard actions and adjacent properties that are needed in the further conversion process.\n * @param lineItemAnnotation Collection of data fields used for representation in a table or list\n * @param visualizationPath The visualization path\n * @param converterContext The instance of the converter context\n * @param tableManifestConfiguration The table manifest configuration\n * @param navigationSettings The navigation target manifest configuration\n * @returns Standard actions and connected properties\n */\nexport function getStandardActionsConfiguration(\n\tlineItemAnnotation: LineItem | undefined,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\ttableManifestConfiguration: TableControlConfiguration,\n\tnavigationSettings: NavigationSettingsConfiguration\n): StandardActionsConfiguration {\n\tconst creationBehaviour = _getCreationBehaviour(\n\t\tlineItemAnnotation,\n\t\ttableManifestConfiguration,\n\t\tconverterContext,\n\t\tnavigationSettings,\n\t\tvisualizationPath\n\t);\n\tconst standardActionsContext = generateStandardActionsContext(\n\t\tconverterContext,\n\t\tcreationBehaviour.mode as CreationMode,\n\t\ttableManifestConfiguration\n\t);\n\tconst cutButtonVisibilityExpression = getCutVisibility(converterContext, standardActionsContext);\n\tconst deleteButtonVisibilityExpression = getDeleteVisibility(converterContext, standardActionsContext);\n\tconst massEditButtonVisibilityExpression = getMassEditVisibility(converterContext, standardActionsContext);\n\tconst isInsertUpdateActionsTemplated = getInsertUpdateActionsTemplating(\n\t\tstandardActionsContext,\n\t\tisDraftOrStickySupported(converterContext)\n\t);\n\tconst standardActions = {\n\t\tcut: getStandardActionCut(converterContext, standardActionsContext),\n\t\tcreate: getStandardActionCreate(converterContext, standardActionsContext),\n\t\tdelete: getStandardActionDelete(converterContext, standardActionsContext),\n\t\tpaste: getStandardActionPaste(converterContext, standardActionsContext, isInsertUpdateActionsTemplated),\n\t\tmassEdit: getStandardActionMassEdit(converterContext, standardActionsContext),\n\t\tinsights: getStandardActionInsights(converterContext, standardActionsContext, visualizationPath),\n\t\tcreationRow: getCreationRow(converterContext, standardActionsContext)\n\t};\n\tconst configuration: StandardActionsConfiguration = {\n\t\tcreationBehaviour,\n\t\tcutButtonVisibilityExpression,\n\t\tdeleteButtonVisibilityExpression,\n\t\tmassEditButtonVisibilityExpression,\n\t\tisInsertUpdateActionsTemplated,\n\t\tstandardActions\n\t};\n\n\tif (standardActionsContext.tableManifestConfiguration.type === \"TreeTable\") {\n\t\tconfiguration.standardActions.moveUp = getStandardActionMoveUpDown(converterContext, standardActionsContext, true);\n\t\tconfiguration.standardActions.moveDown = getStandardActionMoveUpDown(converterContext, standardActionsContext, false);\n\t}\n\n\treturn configuration;\n}\nexport function getTableAnnotationConfiguration(\n\tlineItemAnnotation: LineItem | undefined,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\ttableManifestConfiguration: TableControlConfiguration,\n\tcolumns: TableColumn[],\n\tnavigationSettings: NavigationSettingsConfiguration,\n\tstandardActionsConfiguration: StandardActionsConfiguration,\n\tpresentationVariantAnnotation?: PresentationVariantType\n): TableAnnotationConfiguration {\n\t// Need to get the target\n\tconst { navigationPropertyPath } = splitPath(visualizationPath);\n\tconst typeNamePlural = converterContext.getDataModelObjectPath().targetEntityType.annotations?.UI?.HeaderInfo?.TypeNamePlural;\n\tconst title = typeNamePlural && compileExpression(getExpressionFromAnnotation(typeNamePlural));\n\tconst entitySet = converterContext.getDataModelObjectPath().targetEntitySet;\n\tconst pageManifestSettings: ManifestWrapper = converterContext.getManifestWrapper();\n\tconst hasAbsolutePath = navigationPropertyPath.length === 0;\n\tconst p13nMode = getP13nMode(visualizationPath, converterContext, tableManifestConfiguration);\n\tconst id = navigationPropertyPath ? getTableID(visualizationPath) : getTableID(converterContext.getContextPath(), \"LineItem\");\n\tconst targetCapabilities = getCapabilityRestriction(converterContext);\n\tconst navigationTargetPath = getNavigationTargetPath(converterContext, navigationPropertyPath);\n\tconst selectionMode = getSelectionMode(\n\t\tlineItemAnnotation,\n\t\tvisualizationPath,\n\t\tconverterContext,\n\t\thasAbsolutePath,\n\t\ttargetCapabilities,\n\t\tstandardActionsConfiguration.deleteButtonVisibilityExpression,\n\t\tstandardActionsConfiguration.massEditButtonVisibilityExpression,\n\t\tstandardActionsConfiguration.cutButtonVisibilityExpression\n\t);\n\tlet threshold = navigationPropertyPath ? 10 : 30;\n\tif (presentationVariantAnnotation?.MaxItems) {\n\t\tthreshold = presentationVariantAnnotation.MaxItems.valueOf();\n\t} else if (tableManifestConfiguration.type === \"TreeTable\") {\n\t\t// To make scrolling smooth, we set the threshold value higher for tree tables\n\t\tthreshold = 200;\n\t} else if (tableManifestConfiguration.type === \"GridTable\" || tableManifestConfiguration.type === \"AnalyticalTable\") {\n\t\tthreshold = 100;\n\t}\n\tconst variantManagement: VariantManagementType = pageManifestSettings.getVariantManagement();\n\tconst isSearchable = isPathSearchable(converterContext.getDataModelObjectPath());\n\treturn {\n\t\tid: id,\n\t\tapiId: generate([id, \"Table\"]),\n\t\tentityName: entitySet ? entitySet.name : \"\",\n\t\tentityTypeName: entitySet && entitySet.entityType ? entitySet.entityType.name : \"\",\n\t\tcollection: getTargetObjectPath(converterContext.getDataModelObjectPath()),\n\t\tnavigationPath: navigationPropertyPath,\n\t\trow: _getRowConfigurationProperty(\n\t\t\tlineItemAnnotation,\n\t\t\tconverterContext,\n\t\t\tnavigationSettings,\n\t\t\tnavigationTargetPath,\n\t\t\ttableManifestConfiguration.type\n\t\t),\n\t\tp13nMode,\n\t\tisInsertUpdateActionsTemplated: standardActionsConfiguration.isInsertUpdateActionsTemplated,\n\t\tupdatablePropertyPath: getCurrentEntitySetUpdatablePath(converterContext),\n\t\tdisplayMode: isInDisplayMode(converterContext, true),\n\t\tcreate: standardActionsConfiguration.creationBehaviour,\n\t\tselectionMode: selectionMode,\n\t\tvariantManagement: variantManagement === \"Control\" && !p13nMode ? VariantManagementType.None : variantManagement,\n\t\tthreshold: threshold,\n\t\tsortConditions: getSortConditions(converterContext, presentationVariantAnnotation, columns),\n\t\ttitle: title,\n\t\tsearchable: tableManifestConfiguration.type !== \"AnalyticalTable\" && !(isConstant(isSearchable) && isSearchable.value === false),\n\t\tinitialExpansionLevel: getInitialExpansionLevel(presentationVariantAnnotation),\n\t\trequiredProperties: getRequiredProperties(converterContext)\n\t\t\t.filter((property) => property?.$target?.type !== \"Edm.Boolean\")\n\t\t\t.map((property) => property.value)\n\t};\n}\n/**\n * Gets the data type of a column for the export.\n * @param dataType The data type of a property, column\n * @param isATimezone Is the given property a timezone\n * @param isCurrency Is the given property a currency\n * @param exportSettings The already detected export settings from datafields\n * @returns The supported export type\n */\nfunction getExportDataType(\n\tdataType: string | undefined,\n\tisATimezone = false,\n\tisCurrency = false,\n\texportSettings?: ColumnExportSettings\n): string {\n\tlet exportDataType = \"String\";\n\tif (!dataType || exportSettings?.dataPointTargetValue) {\n\t\treturn exportDataType;\n\t}\n\tif (exportSettings?.isCurrency || isCurrency) {\n\t\treturn \"Currency\";\n\t}\n\tif (isATimezone) {\n\t\treturn \"Timezone\";\n\t}\n\tif (exportSettings?.wrap) {\n\t\treturn exportDataType;\n\t}\n\tswitch (dataType) {\n\t\tcase \"Edm.Decimal\":\n\t\tcase \"Edm.Int32\":\n\t\tcase \"Edm.Int64\":\n\t\tcase \"Edm.Double\":\n\t\tcase \"Edm.Byte\":\n\t\t\texportDataType = \"Number\";\n\t\t\tbreak;\n\t\tcase \"Edm.DateOfTime\":\n\t\tcase \"Edm.Date\":\n\t\t\texportDataType = \"Date\";\n\t\t\tbreak;\n\t\tcase \"Edm.DateTimeOffset\":\n\t\t\texportDataType = \"DateTime\";\n\t\t\tbreak;\n\t\tcase \"Edm.TimeOfDay\":\n\t\t\texportDataType = \"Time\";\n\t\t\tbreak;\n\t\tcase \"Edm.Boolean\":\n\t\t\texportDataType = \"Boolean\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\texportDataType = \"String\";\n\t}\n\treturn exportDataType;\n}\n/**\n * Splits the visualization path into navigation property path and annotation.\n * @param visualizationPath\n * @returns The split path\n */\nexport function splitPath(visualizationPath: string): { navigationPropertyPath: string; annotationPath: string } {\n\tconst [targetNavigationPropertyPath, annotationPath] = visualizationPath.split(\"@\");\n\tlet navigationPropertyPath = targetNavigationPropertyPath;\n\tif (navigationPropertyPath.lastIndexOf(\"/\") === navigationPropertyPath.length - 1) {\n\t\t// Drop trailing slash\n\t\tnavigationPropertyPath = navigationPropertyPath.substring(0, navigationPropertyPath.length - 1);\n\t}\n\treturn { navigationPropertyPath, annotationPath };\n}\nexport function getSelectionVariantConfiguration(\n\tselectionVariantPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): SelectionVariantConfiguration | undefined {\n\tconst resolvedTarget = converterContext.getEntityTypeAnnotation(selectionVariantPath);\n\tconst selection: SelectionVariant = resolvedTarget.annotation as SelectionVariant;\n\tif (selection) {\n\t\tconst propertyNames: string[] = [];\n\t\tselection.SelectOptions?.forEach((selectOption: SelectOptionType) => {\n\t\t\tconst propertyName = selectOption.PropertyName;\n\t\t\tconst propertyPath: string = propertyName?.value ?? \"\";\n\t\t\tif (!propertyNames.includes(propertyPath)) {\n\t\t\t\tpropertyNames.push(propertyPath);\n\t\t\t}\n\t\t});\n\t\treturn {\n\t\t\ttext: selection?.Text?.toString(),\n\t\t\tpropertyNames: propertyNames\n\t\t};\n\t}\n\treturn undefined;\n}\nfunction _getFullScreenBasedOnDevice(\n\ttableSettings: TableManifestSettingsConfiguration,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tisIphone: boolean\n): boolean {\n\t// If enableFullScreen is not set, use as default true on phone and false otherwise\n\tlet enableFullScreen = tableSettings.enableFullScreen ?? isIphone;\n\t// Make sure that enableFullScreen is not set on ListReport for desktop or tablet\n\tif (!isIphone && enableFullScreen && converterContext.getTemplateType() === TemplateType.ListReport) {\n\t\tenableFullScreen = false;\n\t\tconverterContext.getDiagnostics().addIssue(IssueCategory.Manifest, IssueSeverity.Low, IssueType.FULLSCREENMODE_NOT_ON_LISTREPORT);\n\t}\n\treturn enableFullScreen;\n}\nfunction _getMultiSelectMode(\n\ttableSettings: TableManifestSettingsConfiguration,\n\ttableType: TableType,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): string | undefined {\n\tlet multiSelectMode: string | undefined;\n\tif (tableType !== \"ResponsiveTable\") {\n\t\treturn undefined;\n\t}\n\tswitch (converterContext.getTemplateType()) {\n\t\tcase TemplateType.ListReport:\n\t\tcase TemplateType.ObjectPage:\n\t\t\tmultiSelectMode = tableSettings.selectAll === false ? \"ClearAll\" : \"Default\";\n\t\t\tif (converterContext.getTemplateType() === TemplateType.ObjectPage && converterContext.getManifestWrapper().useIconTabBar()) {\n\t\t\t\tmultiSelectMode = !tableSettings.selectAll ? \"ClearAll\" : \"Default\";\n\t\t\t}\n\t\t\tbreak;\n\t\tcase TemplateType.AnalyticalListPage:\n\t\t\tmultiSelectMode = !tableSettings.selectAll ? \"ClearAll\" : \"Default\";\n\t\t\tbreak;\n\t\tdefault:\n\t}\n\treturn multiSelectMode;\n}\nfunction _getTableMode(\n\ttableType: TableType,\n\ttableSettings: TableManifestSettingsConfiguration,\n\tisTemplateListReport: boolean\n): { rowCountMode?: TableRowCountMode; rowCount?: number } {\n\tif (tableType !== \"ResponsiveTable\") {\n\t\tif (isTemplateListReport) {\n\t\t\treturn {\n\t\t\t\trowCountMode: \"Auto\",\n\t\t\t\trowCount: 3\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\trowCountMode: tableSettings.rowCountMode ?? \"Fixed\",\n\t\t\t\trowCount: tableSettings.rowCount ?? (tableType === \"GridTable\" ? 5 : 10)\n\t\t\t};\n\t\t}\n\t} else {\n\t\treturn {};\n\t}\n}\nfunction _getCondensedTableLayout(_tableType: TableType, _tableSettings: TableManifestSettingsConfiguration): boolean {\n\treturn _tableSettings.condensedTableLayout !== undefined && _tableType !== \"ResponsiveTable\"\n\t\t? _tableSettings.condensedTableLayout\n\t\t: false;\n}\nfunction _getTableSelectionLimit(_tableSettings: TableManifestSettingsConfiguration): number {\n\treturn _tableSettings.selectAll === true || _tableSettings.selectionLimit === 0 ? 0 : _tableSettings.selectionLimit || 200;\n}\nfunction _getTableInlineCreationRowCount(_tableSettings: TableManifestSettingsConfiguration): number {\n\treturn _tableSettings.creationMode?.inlineCreationRowCount ? _tableSettings.creationMode?.inlineCreationRowCount : 1;\n}\n\nfunction _getEnableExport(\n\ttableSettings: TableManifestSettingsConfiguration,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tenablePaste: boolean\n): boolean {\n\treturn tableSettings.enableExport !== undefined\n\t\t? tableSettings.enableExport\n\t\t: converterContext.getTemplateType() !== \"ObjectPage\" || enablePaste;\n}\nfunction _getFrozenColumnCount(tableSettings: TableManifestSettingsConfiguration): number | undefined {\n\treturn tableSettings.frozenColumnCount;\n}\n\n/**\n * Get the widthIncludingColumnHeader value from the tableSettings if it exists.\n * @param tableSettings TableSettings Object\n * @returns Returns the value of widthIncludingColumnHeader or false\n */\nfunction _getWidthIncludingColumnHeader(tableSettings: TableManifestSettingsConfiguration): boolean {\n\treturn tableSettings.widthIncludingColumnHeader ?? false;\n}\n\nfunction getFilterConfiguration(\n\ttableSettings: TableManifestSettingsConfiguration,\n\tlineItemAnnotation: LineItem,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tselectionVariantAnnotation: SelectionVariantType | undefined\n): {\n\tfilters: Partial<Record<\"quickFilters\" | \"hiddenFilters\", TableFiltersConfiguration>>;\n\theaderVisible: boolean;\n} {\n\tlet hideTableTitle = false;\n\tconst filters: Partial<Record<\"quickFilters\" | \"hiddenFilters\", TableFiltersConfiguration>> = {};\n\tconst targetEntityType = converterContext.getAnnotationEntityType(lineItemAnnotation);\n\tif (tableSettings.quickVariantSelection) {\n\t\tconst quickFilterPaths = (tableSettings.quickVariantSelection.paths ?? []).reduce(\n\t\t\t(filterPaths: { annotationPath: string }[], path) => {\n\t\t\t\tif (targetEntityType.resolvePath(path.annotationPath)) {\n\t\t\t\t\tfilterPaths.push({ annotationPath: path.annotationPath });\n\t\t\t\t}\n\t\t\t\treturn filterPaths;\n\t\t\t},\n\t\t\t[]\n\t\t);\n\t\tif (quickFilterPaths.length) {\n\t\t\tfilters.quickFilters = {\n\t\t\t\tshowCounts: tableSettings.quickVariantSelection.showCounts,\n\t\t\t\tpaths: quickFilterPaths\n\t\t\t};\n\t\t}\n\t}\n\tif (selectionVariantAnnotation) {\n\t\t/**\n\t\t * Provide Selection Variant to hiddenFilters in order to set the SV filters to the table.\n\t\t * MDC Table overrides binding Filter and from SAP FE the only method where we are able to add\n\t\t * additional filter is 'rebindTable' into Table delegate.\n\t\t * To avoid implementing specific LR feature to SAP FE Macro Table, the filter(s)  not managed by the FilterBar\n\t\t * can be passed to macro table via parameter/context named filters and key hiddenFilters.\n\t\t */\n\t\tfilters.hiddenFilters = { paths: [{ annotationPath: `@${selectionVariantAnnotation.fullyQualifiedName.split(\"@\")[1]}` }] };\n\t}\n\n\thideTableTitle = !!tableSettings.quickVariantSelection?.hideTableTitle;\n\treturn {\n\t\tfilters: filters,\n\t\theaderVisible: !(filters?.quickFilters && hideTableTitle)\n\t};\n}\n/**\n * Adds the tooltip configuration for a given column.\n * @param property The property referenced on the column\n * @param column The column to be updated\n */\nfunction _addToolTip(property: Property, column: AnnotationTableColumn): void {\n\tconst tooltip = _getTooltip(property) ?? column.label;\n\tif (tooltip) {\n\t\tcolumn.tooltip = tooltip;\n\t}\n}\nfunction _getCollectedNavigationPropertyLabels(\n\trelativePath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): string[] | undefined {\n\tconst navigationProperties = enhanceDataModelPath(converterContext.getDataModelObjectPath(), relativePath).navigationProperties;\n\tif (navigationProperties?.length > 0) {\n\t\tconst collectedNavigationPropertyLabels: string[] = [];\n\t\tnavigationProperties.forEach((navProperty) => {\n\t\t\tcollectedNavigationPropertyLabels.push(getLabel(navProperty) || navProperty.name);\n\t\t});\n\t\treturn collectedNavigationPropertyLabels;\n\t}\n}\n/**\n * Determines if the action will have an expression for enablement generated.\n * @param dataField The dataField containing an action\n * @param sEntityType The current entity for templating\n * @returns Whether an expression for enablement is to be generated\n */\nfunction _useEnabledExpression(dataField: DataFieldForActionTypes, sEntityType: string): boolean {\n\t// There are three cases when a table action has an OperationAvailable that leads to an enablement expression\n\t// and is not dependent upon the table entries.\n\t// 1. An action with an overload, that is executed against a parent entity.\n\t// 2. An unbound action\n\t// 3. A static action (that is, bound to a collection)\n\tlet useEnabledExpression = false;\n\tif (dataField.ActionTarget?.annotations?.Core?.OperationAvailable !== undefined) {\n\t\t// Unbound action. Is recognised, but getExpressionFromAnnotation checks for isBound = true, so not generated.\n\t\tconst isBound = dataField.ActionTarget?.isBound;\n\t\t//overload action\n\t\tconst overloadAction = isBound && dataField.ActionTarget?.sourceType !== sEntityType;\n\t\t//static action\n\t\tconst staticAction = dataField.ActionTarget?.parameters[0]?.isCollection;\n\t\t//copy action\n\t\tif (!isBound || overloadAction || staticAction) {\n\t\t\tuseEnabledExpression = true;\n\t\t}\n\t}\n\treturn useEnabledExpression;\n}\n\n/**\n * Updates the table control configuration with Tree-Table specific information.\n * @param tableConfiguration The table configuration\n * @param tableSettings Settings from the manifest\n * @param converterContext The instance of the converter context\n */\nfunction updateTreeTableManifestConfiguration(\n\ttableConfiguration: TableControlConfiguration,\n\ttableSettings: TableManifestSettingsConfiguration,\n\tconverterContext: ConverterContext\n): void {\n\tconst dataModelObjectPath = converterContext.getDataModelObjectPath();\n\ttableConfiguration.hierarchyQualifier = tableSettings.hierarchyQualifier;\n\tconst hierarchyParentNavigationPropertyPath = getHierarchyParentNavigationPropertyPath(\n\t\tdataModelObjectPath,\n\t\ttableConfiguration.hierarchyQualifier!\n\t);\n\tconst nonUpdatableNavigationProperties = getNonUpdatableNavigationProperties(dataModelObjectPath);\n\ttableConfiguration.isHierarchyParentNodeUpdatable = !nonUpdatableNavigationProperties?.includes(hierarchyParentNavigationPropertyPath);\n\ttableConfiguration.isNodeMovable = getCustomFunctionInfo(tableSettings.isNodeMovable, tableConfiguration);\n\ttableConfiguration.isMoveToPositionAllowed = getCustomFunctionInfo(tableSettings.isMoveToPositionAllowed, tableConfiguration);\n\ttableConfiguration.createEnablement = getCustomFunctionInfo(tableSettings.creationMode?.isCreateEnabled, tableConfiguration);\n\n\tif (tableSettings.creationMode?.nodeType?.propertyName && tableSettings.creationMode?.nodeType?.values) {\n\t\tconst values = tableSettings.creationMode.nodeType.values;\n\t\ttableConfiguration.nodeType = {\n\t\t\tpropertyName: tableSettings.creationMode.nodeType.propertyName,\n\t\t\tvalues: Object.keys(values).map((value) => {\n\t\t\t\tconst nodeTypeInfo = values[value];\n\n\t\t\t\tif (typeof nodeTypeInfo === \"string\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\ttext: nodeTypeInfo\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\ttext: nodeTypeInfo.label,\n\t\t\t\t\t\tcreationDialogFields:\n\t\t\t\t\t\t\ttableConfiguration.creationMode === CreationMode.CreationDialog\n\t\t\t\t\t\t\t\t? getFieldList(nodeTypeInfo.creationFields, converterContext)\n\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t})\n\t\t};\n\t}\n\n\t// Create in place\n\tif (tableSettings.creationMode?.createInPlace) {\n\t\ttableConfiguration.createInPlace = true;\n\t}\n}\n\nexport function getCustomFunctionInfo(\n\tvalue: string | undefined,\n\ttableConfiguration: TableControlConfiguration\n): ExternalMethodConfig | undefined {\n\tif (!value) {\n\t\treturn undefined;\n\t}\n\tconst lastDotIndex = value.lastIndexOf(\".\") || -1;\n\tconst moduleName = value.substring(0, lastDotIndex).replace(/\\./gi, \"/\");\n\tconst methodName = value.substring(lastDotIndex + 1);\n\n\t// Add the custom module in the list of required modules if necessary\n\tif (!moduleName.startsWith(\"/extension/\")) {\n\t\tif (!tableConfiguration.additionalRequiredModules) {\n\t\t\ttableConfiguration.additionalRequiredModules = [moduleName];\n\t\t} else if (!tableConfiguration.additionalRequiredModules.includes(moduleName)) {\n\t\t\ttableConfiguration.additionalRequiredModules.push(moduleName);\n\t\t}\n\t}\n\n\treturn { moduleName, methodName };\n}\n\n/**\n * Retrieve the table control configuration optimistic batch information.\n * @param tableManifestSettings The table configuration\n @returns True if Optimistic batch mode is disabled\n */\nfunction getOptimisticBatchSettingsFromManifest(tableManifestSettings: TableManifestConfiguration): boolean {\n\t// Optimistic batch is set by default\n\treturn tableManifestSettings?.tableSettings?.disableRequestCache || false;\n}\n\n/**\n * Gets the settings coming from the manifest related to the mass edit dialog.\n * @param tableSettings The table configuration\n * @param converterContext The instance of the converter context\n * @returns The mass edit configuration.\n */\nexport function getMassEditSettings(\n\ttableSettings: TableManifestSettingsConfiguration,\n\tconverterContext: ConverterContext<PageContextPathTarget>\n): MassEditTableConfiguration {\n\tconst defaultFieldConfiguration = {\n\t\tvisibleFields: [],\n\t\tignoredFields: [],\n\t\toperationGroupingMode:\n\t\t\tconverterContext.getTemplateType() === TemplateType.ListReport\n\t\t\t\t? OperationGroupingMode.Isolated\n\t\t\t\t: OperationGroupingMode.ChangeSet\n\t};\n\tif (!tableSettings.enableMassEdit) {\n\t\treturn { enabled: false, ...defaultFieldConfiguration };\n\t}\n\tif (tableSettings.enableMassEdit === true) {\n\t\treturn { enabled: tableSettings.enableMassEdit, ...defaultFieldConfiguration };\n\t} else if (typeof tableSettings.enableMassEdit === \"object\") {\n\t\treturn {\n\t\t\tenabled: true,\n\t\t\tvisibleFields: getFieldList(tableSettings.enableMassEdit.visibleFields, converterContext),\n\t\t\tignoredFields: getFieldList(tableSettings.enableMassEdit.ignoredFields, converterContext),\n\t\t\toperationGroupingMode:\n\t\t\t\ttableSettings.enableMassEdit.operationGroupingMode &&\n\t\t\t\tObject.values(OperationGroupingMode).includes(tableSettings.enableMassEdit.operationGroupingMode)\n\t\t\t\t\t? tableSettings.enableMassEdit.operationGroupingMode\n\t\t\t\t\t: defaultFieldConfiguration.operationGroupingMode,\n\t\t\tcustomFragment: tableSettings.enableMassEdit.customFragment\n\t\t};\n\t}\n\treturn { enabled: false, ...defaultFieldConfiguration };\n}\n\n/**\n * Gets a list of the fields coming from the manifest.\n * @param fields The fields, could be a FieldGroup or fields separated by a comma\n * @param converterContext The instance of the converter context\n * @returns The list of fields.\n */\nfunction getFieldList(fields: string | undefined, converterContext: ConverterContext<PageContextPathTarget>): string[] {\n\tif (!fields) {\n\t\treturn [];\n\t}\n\tif (fields.startsWith(UIAnnotationTerms.FieldGroup)) {\n\t\tconst fieldGroup = converterContext.getEntityTypeAnnotation<FieldGroup>(`@${fields}`);\n\t\tif (isAnnotationOfType<FieldGroup>(fieldGroup.annotation, UIAnnotationTypes.FieldGroupType)) {\n\t\t\treturn fieldGroup.annotation.Data.reduce((properties: string[], field) => {\n\t\t\t\tif (isDataField(field) && isPathAnnotationExpression(field.Value)) {\n\t\t\t\t\tproperties.push(field.Value.path);\n\t\t\t\t}\n\t\t\t\treturn properties;\n\t\t\t}, []);\n\t\t}\n\t\treturn [];\n\t}\n\treturn fields\n\t\t.replace(/\\s/g, \"\")\n\t\t.split(\",\")\n\t\t.map((name) => name.trim());\n}\n\nexport function getTableManifestConfiguration(\n\tlineItemAnnotation: LineItem | undefined,\n\tvisualizationPath: string,\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tcheckCondensedLayout = true,\n\tselectionVariantAnnotation?: SelectionVariantType\n): TableControlConfiguration {\n\tconst _manifestWrapper = converterContext.getManifestWrapper();\n\tconst tableManifestSettings: TableManifestConfiguration = converterContext.getManifestControlConfiguration(visualizationPath);\n\tconst tableSettings = tableManifestSettings?.tableSettings ?? {};\n\tconst globalFEManifestSettings = _manifestWrapper.getSapFeManifestConfiguration();\n\tconst defaultCreationMode =\n\t\tglobalFEManifestSettings?.macros?.table?.defaultCreationMode === \"InlineCreationRows\" ? CreationMode.InlineCreationRows : undefined;\n\tconst creationMode: CreationMode = tableSettings.creationMode?.name ?? defaultCreationMode ?? CreationMode.NewPage;\n\tconst enableAutoColumnWidth = !_manifestWrapper.isPhone();\n\tconst disableCopyToClipboard = tableSettings.disableCopyToClipboard;\n\tconst templateType = converterContext.getTemplateType();\n\tconst isCondensedTableLayoutCompliant = checkCondensedLayout && _manifestWrapper.isCondensedLayoutCompliant();\n\tconst oFilterConfiguration = lineItemAnnotation\n\t\t? getFilterConfiguration(tableSettings, lineItemAnnotation, converterContext, selectionVariantAnnotation)\n\t\t: {};\n\tconst customValidationFunction = tableSettings.creationMode?.customValidationFunction;\n\tconst exportRequestSize = tableSettings.exportRequestSize;\n\tconst tableType = getTableType(converterContext, tableManifestSettings);\n\t// By default, paste is enabled on an ObjectPage and on a ListReport with a draft TreeTable\n\tconst enablePaste =\n\t\ttableSettings.enablePaste ??\n\t\t(converterContext.getTemplateType() === \"ObjectPage\" ||\n\t\t\t(tableType === \"TreeTable\" && (converterContext.getEntitySet() as EntitySet)?.annotations.Common?.DraftRoot !== undefined));\n\tconst tableRowMode = _getTableMode(tableType, tableSettings, templateType === TemplateType.ListReport);\n\tconst defaultScrollThreshold = tableType !== \"ResponsiveTable\" ? 300 : undefined;\n\tconst condensedTableLayout = _getCondensedTableLayout(tableType, tableSettings);\n\tlet inlineCreationRowsHiddenInEditMode = false;\n\tif (tableSettings.creationMode?.inlineCreationRowsHiddenInEditMode) {\n\t\tinlineCreationRowsHiddenInEditMode =\n\t\t\ttypeof tableSettings.creationMode?.inlineCreationRowsHiddenInEditMode === \"string\"\n\t\t\t\t? tableSettings.creationMode?.inlineCreationRowsHiddenInEditMode === \"true\"\n\t\t\t\t: tableSettings.creationMode?.inlineCreationRowsHiddenInEditMode;\n\t}\n\tlet useTextForNoDataMessages: string;\n\tif (converterContext.getTemplateType() === \"ListReport\") {\n\t\tuseTextForNoDataMessages = \"illustratedMessage-Auto\";\n\t} else {\n\t\tuseTextForNoDataMessages = _manifestWrapper.getUseTextForNoDataMessages() ? \"text\" : \"illustratedMessage-Dot\";\n\t}\n\tconst oConfiguration = {\n\t\t// If no createAtEnd is specified it will be false for Inline/CreationDialog create and true otherwise\n\t\tcreateAtEnd:\n\t\t\ttableSettings.creationMode?.createAtEnd !== undefined\n\t\t\t\t? tableSettings.creationMode?.createAtEnd\n\t\t\t\t: ![CreationMode.Inline, CreationMode.CreationDialog].includes(creationMode),\n\t\tcreationMode: creationMode,\n\t\tcreationDialogFields:\n\t\t\tcreationMode === CreationMode.CreationDialog\n\t\t\t\t? getFieldList(tableSettings.creationMode?.creationFields, converterContext)\n\t\t\t\t: undefined,\n\t\tcustomValidationFunction: customValidationFunction,\n\t\thasDataStateIndicatorFilter: templateType === TemplateType.ListReport,\n\t\t// if a custom validation function is provided, disableAddRowButtonForEmptyData should not be considered, i.e. set to false\n\t\tdisableAddRowButtonForEmptyData: !customValidationFunction ? !!tableSettings.creationMode?.disableAddRowButtonForEmptyData : false,\n\t\tenableAutoColumnWidth: enableAutoColumnWidth,\n\t\tenablePastingOfComputedProperties: tableSettings.enablePastingOfComputedProperties,\n\t\tenableExport: _getEnableExport(tableSettings, converterContext, enablePaste),\n\t\tfrozenColumnCount: _getFrozenColumnCount(tableSettings),\n\t\twidthIncludingColumnHeader: _getWidthIncludingColumnHeader(tableSettings),\n\t\tenableFullScreen: _getFullScreenBasedOnDevice(tableSettings, converterContext, _manifestWrapper.isPhone()),\n\t\tmassEdit: getMassEditSettings(tableSettings, converterContext),\n\t\tenableAddCardToInsights: tableSettings?.enableAddCardToInsights,\n\t\tenablePaste: enablePaste,\n\t\tdisableCopyToClipboard: disableCopyToClipboard,\n\t\theaderVisible: true,\n\t\theader: tableSettings.header,\n\t\tmultiSelectMode: _getMultiSelectMode(tableSettings, tableType, converterContext),\n\t\tselectionLimit: _getTableSelectionLimit(tableSettings),\n\t\tinlineCreationRowCount: _getTableInlineCreationRowCount(tableSettings),\n\t\tinlineCreationRowsHiddenInEditMode: inlineCreationRowsHiddenInEditMode,\n\t\tshowRowCount: tableSettings?.quickVariantSelection?.paths ? false : !_manifestWrapper.getViewConfiguration()?.showCounts,\n\t\ttype: tableType,\n\t\tdisableRequestCache: getOptimisticBatchSettingsFromManifest(tableManifestSettings),\n\t\tuseCondensedTableLayout: condensedTableLayout && isCondensedTableLayoutCompliant,\n\t\tisCompactType: _manifestWrapper.isCompactType(),\n\t\tbeforeRebindTable: tableSettings.beforeRebindTable,\n\t\texportRequestSize: exportRequestSize,\n\t\tenableUploadPlugin: !!converterContext.getAnnotationEntityType().annotations?.UI?.MediaResource?.Stream,\n\t\tselectionChange: tableSettings.selectionChange,\n\t\tmodeForNoDataMessage: useTextForNoDataMessages,\n\t\tscrollThreshold: tableSettings.scrollThreshold ?? defaultScrollThreshold\n\t};\n\n\tconst tableConfiguration: TableControlConfiguration = { ...oConfiguration, ...tableRowMode, ...oFilterConfiguration };\n\tif (tableType === \"TreeTable\") {\n\t\tupdateTreeTableManifestConfiguration(tableConfiguration, tableSettings, converterContext);\n\t}\n\n\tif (tableSettings.headerVisible !== undefined) {\n\t\ttableConfiguration.headerVisible = tableSettings.headerVisible;\n\t}\n\n\treturn tableConfiguration;\n}\n\nfunction getTableType(\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\ttableManifestSettings?: TableManifestConfiguration\n): TableType {\n\tif (tableManifestSettings?.tableSettings?.type) {\n\t\t// in case the application specified a table type we will use this one\n\t\treturn tableManifestSettings.tableSettings.type;\n\t}\n\n\t// default is the ResponsiveTable\n\treturn \"ResponsiveTable\";\n}\n\n/**\n * Creates a property using the text arrangement annotation set to text only.\n * @param converterContext The converter context.\n * @param propertyDataModelObjectPath The corresponding DataModelObjectPath.\n * @param lineItem The column to be evaluated.\n * @param columnsToBeCreated The list of columns to be created.\n * @param relativePath The relative path to the target property based on the context.\n * @param restrictionsOnProperties The existing restrictions on properties\n */\nfunction createPropertyAnnotatedTextOnly(\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tpropertyDataModelObjectPath: DataModelObjectPath<DataFieldAbstractTypes>,\n\tlineItem: DataFieldAbstractTypes,\n\tcolumnsToBeCreated: Record<string, Property>,\n\trelativePath: string,\n\trestrictionsOnProperties: RestrictionsOnProperties\n): void {\n\tconst isPropertyNavigated =\n\t\tpropertyDataModelObjectPath.navigationProperties.length !== converterContext.getDataModelObjectPath().navigationProperties.length;\n\tif (isPropertyNavigated && isDataField(lineItem)) {\n\t\tcolumnsToBeCreated[relativePath] = lineItem.Value.$target;\n\t\trestrictionsOnProperties.nonSortableProperties.push(relativePath);\n\t} else if (isDataFieldForAnnotation(lineItem) && hasFieldGroupTarget(lineItem)) {\n\t\t(lineItem.Target.$target as FieldGroup).Data.forEach((field) => {\n\t\t\tif (isDataField(field) && getDisplayMode(field.Value.$target) === \"Description\") {\n\t\t\t\tconst inheredPropertyDataModelObjectPath = enhanceDataModelPath(\n\t\t\t\t\tconverterContext.getDataModelObjectPath(),\n\t\t\t\t\tfield.Value.path\n\t\t\t\t);\n\t\t\t\tconst isInheredPropertyNavigated =\n\t\t\t\t\tinheredPropertyDataModelObjectPath.navigationProperties.length !==\n\t\t\t\t\tconverterContext.getDataModelObjectPath().navigationProperties.length;\n\t\t\t\tif (isInheredPropertyNavigated) {\n\t\t\t\t\tcolumnsToBeCreated[field.Value.path] = field.Value.$target;\n\t\t\t\t\trestrictionsOnProperties.nonSortableProperties.push(field.Value.path);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function getTypeConfig(oProperty: Property | DataFieldAbstractTypes | undefined, dataType: string | undefined): PropertyTypeConfig {\n\tlet oTargetMapping;\n\tif (isProperty(oProperty)) {\n\t\toTargetMapping = isTypeDefinition(oProperty.targetType)\n\t\t\t? EDM_TYPE_MAPPING[oProperty.targetType.underlyingType]\n\t\t\t: EDM_TYPE_MAPPING[oProperty.type];\n\t}\n\tif (oTargetMapping === undefined && dataType !== undefined) {\n\t\toTargetMapping = EDM_TYPE_MAPPING[dataType];\n\t}\n\tconst propertyTypeConfig: PropertyTypeConfig = {\n\t\ttype: oTargetMapping?.type,\n\t\tconstraints: {},\n\t\tformatOptions: {}\n\t};\n\tif (isProperty(oProperty) && oTargetMapping !== undefined) {\n\t\tpropertyTypeConfig.constraints = {\n\t\t\tscale: oTargetMapping.constraints?.$Scale ? oProperty.scale : undefined,\n\t\t\tprecision: oTargetMapping.constraints?.$Precision ? oProperty.precision : undefined,\n\t\t\tmaxLength: oTargetMapping.constraints?.$MaxLength ? oProperty.maxLength : undefined,\n\t\t\tnullable: oTargetMapping.constraints?.$Nullable ? oProperty.nullable : undefined,\n\t\t\tminimum:\n\t\t\t\toTargetMapping.constraints?.[\"@Org.OData.Validation.V1.Minimum/$Decimal\"] &&\n\t\t\t\t!isNaN(oProperty.annotations?.Validation?.Minimum)\n\t\t\t\t\t? `${oProperty.annotations?.Validation?.Minimum}`\n\t\t\t\t\t: undefined,\n\t\t\tmaximum:\n\t\t\t\toTargetMapping.constraints?.[\"@Org.OData.Validation.V1.Maximum/$Decimal\"] &&\n\t\t\t\t!isNaN(oProperty.annotations?.Validation?.Maximum)\n\t\t\t\t\t? `${oProperty.annotations?.Validation?.Maximum}`\n\t\t\t\t\t: undefined,\n\t\t\tisDigitSequence:\n\t\t\t\tpropertyTypeConfig.type === \"sap.ui.model.odata.type.String\" &&\n\t\t\t\toTargetMapping.constraints?.[`@${CommonAnnotationTerms.IsDigitSequence}`] &&\n\t\t\t\toProperty.annotations?.Common?.IsDigitSequence\n\t\t\t\t\t? true\n\t\t\t\t\t: undefined\n\t\t};\n\t}\n\tpropertyTypeConfig.formatOptions = {\n\t\tparseAsString:\n\t\t\tpropertyTypeConfig?.type?.indexOf(\"sap.ui.model.odata.type.Int\") === 0 ||\n\t\t\tpropertyTypeConfig?.type?.indexOf(\"sap.ui.model.odata.type.Double\") === 0\n\t\t\t\t? false\n\t\t\t\t: undefined,\n\t\temptyString:\n\t\t\tpropertyTypeConfig?.type?.indexOf(\"sap.ui.model.odata.type.Int\") === 0 ||\n\t\t\tpropertyTypeConfig?.type?.indexOf(\"sap.ui.model.odata.type.Double\") === 0\n\t\t\t\t? \"\"\n\t\t\t\t: undefined,\n\t\tparseKeepsEmptyString:\n\t\t\tpropertyTypeConfig.type === \"sap.ui.model.odata.type.String\" && propertyTypeConfig.constraints.nullable === false\n\t\t\t\t? true\n\t\t\t\t: undefined\n\t};\n\treturn propertyTypeConfig;\n}\n/**\n * Add a description property to the list of description properties used by the columns of a table\n * @param textProperties The list of properties referenced as text on a text arrangement annotation\n * @param relatedPropertiesInfo The related properties linked to the column (named also complex property)\n * @param relatedPropertyName The property name to be added\n */\n\nfunction addPropertyToDisplayModeOfDescriptionPropertiesMap(\n\tdisplayModeOfDescriptionPropertiesMap: Record<string, DisplayMode>,\n\trelatedPropertiesInfo: ComplexPropertyInfo,\n\trelatedPropertyName: string\n): void {\n\tif (\n\t\trelatedPropertiesInfo.properties[relatedPropertyName].displayModeOfPropertyUsedAsDescription &&\n\t\t!displayModeOfDescriptionPropertiesMap[relatedPropertyName]\n\t) {\n\t\tdisplayModeOfDescriptionPropertiesMap[relatedPropertyName] =\n\t\t\trelatedPropertiesInfo.properties[relatedPropertyName].displayModeOfPropertyUsedAsDescription!;\n\t}\n}\n\n/**\n * Computes the referenced properties of a LineItem in case the LineItem is annotated as hidden.\n * @param existingColumns The list of columns created from LineItems and from properties of entityType\n * @param name The name of the property to be evaluated\n * @param column The given column from lineItem or property of entitySet\n */\nfunction computeHiddenOnRelatedColumns(existingColumns: AnnotationTableColumn[], name: string, column: AnnotationTableColumn): void {\n\tconst relatedAnnotationColumns = existingColumns.filter(\n\t\t(existingColumn) => existingColumn.propertyInfos?.includes(name) && existingColumn.isPartOfLineItem\n\t);\n\tcolumn.isPartOfLineItem = !!relatedAnnotationColumns.length;\n\tif (\n\t\trelatedAnnotationColumns.length &&\n\t\t!relatedAnnotationColumns?.some((annotationColumn) => annotationColumn.availability !== \"Hidden\")\n\t) {\n\t\tcolumn.sortable = false;\n\t\tcolumn.isGroupable = false;\n\t\tcolumn.filterable = false;\n\t}\n}\n\n/**\n * Gets the export settings properties of a manifest column.\n * @param exportSettings The customized/overwritten export settings of a manifest column\n * @param annotationColumns The list of columns created from LineItems\n * @param converterContext The converter context\n * @param entityType The target entity type\n * @param propertyInfos The properties linked to a complex column\n * @param columnKey The column key of the column to be overwritten\n * @returns The export settings of the column merging customized export settings with the default values detected on the annotation column\n */\nfunction getCustomExportSettings(\n\texportSettings: ColumnExportSettings | undefined,\n\tannotationColumns: AnnotationTableColumn[],\n\tconverterContext: ConverterContext<PageContextPathTarget>,\n\tentityType: EntityType,\n\tpropertyInfos?: string[],\n\tcolumnKey?: string\n): ColumnExportSettings | null {\n\tlet columnFromAnnotations;\n\tif (columnKey) {\n\t\tcolumnFromAnnotations = annotationColumns.find((annotationColumn) => annotationColumn.key === columnKey);\n\t\tif (columnFromAnnotations?.exportSettings === null) {\n\t\t\treturn columnFromAnnotations?.exportSettings;\n\t\t}\n\t}\n\tconst enableWrapping =\n\t\texportSettings?.wrap ??\n\t\t(!!(exportSettings?.property && exportSettings.property?.length > 1) || !!(propertyInfos && propertyInfos.length > 1));\n\tconst customExportSettings: ColumnExportSettings = {\n\t\t...columnFromAnnotations?.exportSettings,\n\t\ttype: exportSettings?.type ?? columnFromAnnotations?.exportSettings?.type,\n\t\ttemplate:\n\t\t\texportSettings?.template ??\n\t\t\t_appendCustomTemplate(propertyInfos, exportSettings?.property) ??\n\t\t\tcolumnFromAnnotations?.exportSettings?.template,\n\t\tproperty: exportSettings?.property\n\t\t\t? _getPropertyNames(exportSettings?.property, annotationColumns, converterContext, entityType)\n\t\t\t: undefined,\n\t\twidth: exportSettings?.width,\n\t\twrap: enableWrapping\n\t};\n\treturn removeUndefinedFromExportSettings(customExportSettings);\n}\n\nexport default {\n\tgetTableActions,\n\tgetTableColumns,\n\tgetColumnsFromEntityType,\n\tupdateLinkedProperties,\n\tcreateTableVisualization,\n\tcreateDefaultTableVisualization,\n\tgetCapabilityRestriction,\n\tgetImportance,\n\tgetSelectionMode,\n\tgetRowStatusVisibility,\n\tgetP13nMode,\n\tgetStandardActionsConfiguration,\n\tgetTableAnnotationConfiguration,\n\tisFilteringCaseSensitive,\n\tsplitPath,\n\tgetSelectionVariantConfiguration,\n\tgetTableManifestConfiguration,\n\tgetTypeConfig,\n\tupdateTableVisualizationForType,\n\tcreateRequestedProperties,\n\tgetNavigationTargetPath,\n\tgetCustomFunctionInfo\n};\n"],"mappings":"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","ignoreList":[]}