/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/macros/formatters/TableFormatter","../../../../helpers/BindingHelper","../../../ManifestSettings","../../../helpers/InsightsHelpers"],function(e,t,n,a,i,o,s,r){"use strict";var l={};var c=r.getInsightsVisibility;var d=r.getInsightsEnablement;var u=s.TemplateType;var p=s.CreationMode;var f=s.ActionType;var b=o.singletonPathVisitor;var g=o.UI;var v=a.isPathUpdatable;var y=a.isPathInsertable;var C=a.isPathDeletable;var h=a.getTargetObjectPath;var x=n.isSingleton;var M=n.isNavigationProperty;var m=n.isEntitySet;var T=e.pathInModel;var S=e.or;var E=e.notEqual;var A=e.not;var D=e.lessOrEqual;var P=e.length;var U=e.isPathInModelExpression;var I=e.isConstant;var O=e.ifElse;var R=e.greaterThan;var w=e.greaterOrEqual;var k=e.getExpressionFromAnnotation;var j=e.formatResult;var H=e.equal;var V=e.constant;var F=e.compileExpression;var L=e.and;const _={Cut:"StandardAction::Cut",Create:"StandardAction::Create",Delete:"StandardAction::Delete",CreationRow:"StandardAction::CreationRow",Paste:"StandardAction::Paste",MassEdit:"StandardAction::MassEdit",Insights:"StandardAction::Insights",MoveUp:"StandardAction::MoveUp",MoveDown:"StandardAction::MoveDown"};l.StandardActionKeys=_;function N(e,t,n){return{collectionPath:h(e.getDataModelObjectPath()),hiddenAnnotation:{create:B(e,"CreateHidden"),delete:B(e,"DeleteHidden"),update:B(e,"UpdateHidden")},creationMode:t,isDraftOrStickySupported:q(e),newAction:z(e),tableManifestConfiguration:n,restrictions:W(e)}}l.generateStandardActionsContext=N;function q(e){const n=e.getDataModelObjectPath();const a=t.isObjectPathDraftSupported(n);const i=n.startingEntitySet?.annotations?.Session?.StickySessionSupported?true:false;return a||i}l.isDraftOrStickySupported=q;function z(e){const t=e.getEntitySet();const n=m(t)?t.annotations.Common?.DraftRoot?.NewAction??t.annotations.Session?.StickySessionSupported?.NewAction:undefined;const a=n?.toString();if(a){const t=e?.getEntityType().actions[a]?.annotations?.Core?.OperationAvailable;return{name:a,available:k(t,[],true)}}return undefined}l.getNewAction=z;function B(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;const a=e.getEntitySet();const i=!x(a)&&a?.annotations.UI?.[t]||e.getEntityType().annotations.UI?.[t];if(!i){return V(false)}const o=e.getDataModelObjectPath();const s=o.navigationProperties.length>0&&n?o.navigationProperties.map(e=>e.name):[];return k(i,s,undefined,t=>b(t,e.getConvertedTypes(),s))}l.isActionAnnotatedHidden=B;function W(e){const t=e.getDataModelObjectPath();const n=[{key:"isInsertable",function:y},{key:"isUpdatable",function:v},{key:"isDeletable",function:C}];const a={};n.forEach(function(n){const i=n["function"];a[n.key]={expression:i.apply(null,[t,{pathVisitor:(t,n)=>b(t,e.getConvertedTypes(),n)}]),navigationExpression:i.apply(null,[t,{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:(t,n)=>b(t,e.getConvertedTypes(),n)}])}});return a}l.getRestrictions=W;function $(e,t){return t||e.creationMode===p.External}l.getInsertUpdateActionsTemplating=$;function G(e,t){const n=ie(e,t);return{isTemplated:F(ne(t,n)),visible:F(n),visibleExpression:n,enabled:F(ce(e,t,n)),enabledForContextMenu:F(ce(e,t,n,true)),key:_.Create,type:f.Standard}}l.getStandardActionCreate=G;function K(e,t){const n=Y(e,t);return{isTemplated:F(ae(n)),visible:F(n),enabled:F(fe(n,t,false)),enabledForContextMenu:F(fe(n,t,true)),key:_.Cut,type:f.Standard}}l.getStandardActionCut=K;function Q(e,t,n){const a=e.getEntityType().annotations.Hierarchy?.[`RecursiveHierarchyActions#${t.tableManifestConfiguration.hierarchyQualifier??""}`]?.ChangeNextSiblingAction!==undefined;const i=L(Y(e,t),a);return{isTemplated:F(ae(i)),visible:F(i),enabled:F(be(i,t,n)),enabledForContextMenu:F(be(i,t,n,true)),key:n?_.MoveUp:_.MoveDown,type:f.Standard}}l.getStandardActionMoveUpDown=Q;function J(e,t){const n=oe(e,t);return{isTemplated:F(ae(n)),visible:F(n),enabled:F(de(e,t,n,false)),enabledForContextMenu:F(de(e,t,n,true)),key:_.Delete,type:f.Standard}}l.getStandardActionDelete=J;function X(e,t){const n=ie(e,t,true);return{isTemplated:F(ne(t,n,true)),visible:F(n),enabled:F(le(e,t,n)),key:_.CreationRow,type:f.Standard}}l.getCreationRow=X;function Y(e,t){const n=t.restrictions?.isUpdatable?.expression;const a=e.getTemplateType()!==u.ListReport?g.IsEditable:e.getEntitySet()?.annotations.Common?.DraftRoot!==undefined;return O(H(t.tableManifestConfiguration?.type,"TreeTable"),L(t.tableManifestConfiguration.isHierarchyParentNodeUpdatable,A(L(I(n),H(n,false))),a),false)}l.getCutVisibility=Y;function Z(e,t,n){const a=Y(e,t);const i=ie(e,t,false,true);const o=se(e,t,i,a,n);const s=ue(o,t,false);const r=ue(o,t,true);return{visible:F(o),enabled:F(s),enabledForContextMenu:F(r),key:_.Paste,type:f.Standard}}l.getStandardActionPaste=Z;function ee(e,t){const n=re(e,t);return{isTemplated:F(ae(n)),visible:F(n),visibleForContextMenu:F(L(n,H(T("contextmenu/inactiveContext","internal"),false))),enabled:F(pe(e,t,n)),enabledForContextMenu:F(pe(e,t,n,true)),key:_.MassEdit,type:f.Standard}}l.getStandardActionMassEdit=ee;function te(e,t,n){const a=c("Table",e,n,t);const i=L(a,d());return{isTemplated:F(ae(a)),visible:F(a),enabled:F(i),key:_.Insights,type:f.Standard}}l.getStandardActionInsights=te;function ne(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return L(S(L(n,e.creationMode===p.CreationRow),L(!n,e.creationMode!==p.CreationRow)),S(A(I(t)),t))}l.getCreateTemplating=ne;function ae(e){return S(A(I(e)),e)}l.getDefaultTemplating=ae;function ie(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const i=t.restrictions.isInsertable.expression;const o=n?B(e,"CreateHidden",false):t.hiddenAnnotation.create;const s=t.newAction;return O(t.creationMode===p.External,L(A(o),S(e.getTemplateType()===u.ListReport,g.IsEditable)),O(S(L(I(s?.available),H(s?.available,false)),L(I(i),H(i,false),!s),L(I(o),H(o,true)),L(t.creationMode===p.InlineCreationRows,t.tableManifestConfiguration?.type==="ResponsiveTable",O(L(t?.tableManifestConfiguration?.inlineCreationRowsHiddenInEditMode===false,A(a)),true,g.IsCreateMode))),false,O(e.getTemplateType()===u.ListReport,S(A(U(o)),A(o)),L(A(o),g.IsEditable))))}l.getCreateVisibility=ie;function oe(e,t){const n=t.hiddenAnnotation.delete;const a=t.restrictions.isDeletable.expression;return O(e.getTemplateType()===u.AnalyticalListPage,false,O(L(I(a),H(a,false)),false,O(L(I(n),H(n,V(true))),false,O(e.getTemplateType()!==u.ListReport,L(A(n),g.IsEditable),A(L(U(n),n))))))}l.getDeleteVisibility=oe;function se(e,t,n,a,i){let o=t.restrictions?.isUpdatable?.navigationExpression;if(o?._type==="Unresolvable"){o=V(true)}return L(t.tableManifestConfiguration.type==="TreeTable"?a:L(S(L(n,t.restrictions.isInsertable.expression),L(g.IsEditable,o)),E(t.tableManifestConfiguration.enablePaste,false),![u.ListReport,u.AnalyticalListPage].includes(e.getTemplateType())),i)}l.getPasteVisibility=se;function re(e,t){const n=t.hiddenAnnotation.update,a=t.restrictions.isUpdatable.expression,i=t.tableManifestConfiguration?.massEdit.enabled||false;const o=e.getTemplateType()===u.ObjectPage?g.IsEditable:e.getTemplateType()===u.ListReport;return L(A(L(I(a),H(a,false))),i,o,A(n))}l.getMassEditVisibility=re;function le(e,t,n){const a=y(e.getDataModelObjectPath(),{ignoreTargetCollection:true,authorizeUnresolvable:true,pathVisitor:(t,n)=>{if(t.indexOf("/")===0){t=b(t,e.getConvertedTypes(),n);return t}const a=e.getDataModelObjectPath().navigationProperties;if(a){const e=a[a.length-1];const n=M(e)&&e.partner;if(n){t=`${n}/${t}`}}return t}});const o=a._type==="Unresolvable"?y(e.getDataModelObjectPath(),{pathVisitor:t=>b(t,e.getConvertedTypes(),[])}):a;return L(n,o,S(!t.tableManifestConfiguration.disableAddRowButtonForEmptyData,j([T("creationRowFieldValidity","internal")],i.validateCreationRowFields)))}l.getCreationRowEnablement=le;function ce(e,t,n){let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const i=[];const o=!a?"":"contextmenu/";if(t.creationMode===p.InlineCreationRows){i.push(L(A(t.hiddenAnnotation.create),g.IsEditable))}else{i.push(n)}const s=t.restrictions.isInsertable.expression;const r=e.resolveAbsolutePath(t.collectionPath).target;i.push(S(m(r),L(s,S(e.getTemplateType()!==u.ObjectPage,g.IsEditable))));if(t.tableManifestConfiguration.type==="TreeTable"){i.push(D(T(o+"numberOfSelectedContexts","internal"),1));if(t.tableManifestConfiguration.createEnablement){i.push(E(T(o+"createEnablement/Create","internal"),false))}}return L(...i)}l.getCreateEnablement=ce;function de(e,t,n){let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const i=!a?"":"contextmenu/";const o=T(i+"deletableContexts","internal");const s=T(i+"unSavedContexts","internal");const r=T(i+"draftsWithDeletableActive","internal");const l=T(i+"draftsWithNonDeletableActive","internal");return L(n,S(t.restrictions.isDeletable.navigationExpression._type==="Unresolvable",t.restrictions.isDeletable.expression),S(R(P(o,true),0),R(P(r,true),0),R(P(l,true),0),R(P(s,true),0)))}l.getDeleteEnablement=de;function ue(e,t,n){if(t.tableManifestConfiguration.type==="TreeTable"){const a=!n?"numberOfSelectedContexts":"contextmenu/numberOfSelectedContexts";return L(e,S(t.restrictions.isUpdatable.navigationExpression._type==="Unresolvable",t.restrictions.isUpdatable.expression),L(H(P(T("pastableContexts","internal"),true),1),t.tableManifestConfiguration.type==="TreeTable"?D(T(a,"internal"),1):true,H(T("pasteAuthorized","internal"),true)))}let a=t.restrictions?.isUpdatable?.navigationExpression;if(a?._type==="Unresolvable"){a=V(true)}return L(a,e)}l.getPasteEnablement=ue;function pe(e,n,a){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const o=n.restrictions.isUpdatable.expression;const s=!I(o)&&n.restrictions.isUpdatable.navigationExpression._type==="Unresolvable";const r=!i?"numberOfSelectedContexts":"contextmenu/numberOfSelectedContexts";const l=!i?"updatableContexts":"contextmenu/updatableContexts";const c=w(T(r,"internal"),1);const d=w(P(T(l,"internal")),1);const u=t.isObjectPathDraftSupported(e.getDataModelObjectPath());const p=ge(e);const f=O(S(L(p,u),s),L(c,d),L(c));return L(a,O(s,f,L(f,o)))}l.getMassEditEnablement=pe;function fe(e,t,n){const a=!n?"numberOfSelectedContexts":"contextmenu/numberOfSelectedContexts";const i=H(T(a,"internal"),1);const o=!n?"cutableContexts":"contextmenu/cutableContexts";const s=L(i,H(P(T(o,"internal"),true),1));return L(e,S(t.restrictions.isUpdatable.navigationExpression._type==="Unresolvable",t.restrictions.isUpdatable.expression),s)}l.getCutEnablement=fe;function be(e,t,n){let a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;const i=!a?"singleContextMovableUp":"contextmenu/singleContextMovableUp";const o=!a?"singleContextMovableDown":"contextmenu/singleContextMovableDown";const s=n?H(T(i,"internal"),true):H(T(o,"internal"),true);return L(e,S(t.restrictions.isUpdatable.navigationExpression._type==="Unresolvable",t.restrictions.isUpdatable.expression),s)}function ge(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const n=e.getTemplateType();if(n===u.ListReport||n===u.AnalyticalListPage||t&&e.getManifestWrapper().hasMultipleVisualizations()){return true}return false}l.isInDisplayMode=ge;return l},false);
//# sourceMappingURL=StandardActions.js.map