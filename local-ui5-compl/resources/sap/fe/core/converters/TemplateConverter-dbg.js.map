{"version":3,"names":["handleErrorForCollectionFacets","oFacets","oDiagnostics","sEntitySetName","level","forEach","oFacet","Message","$Type","ID","addIssue","IssueCategory","Facets","IssueSeverity","High","IssueCategoryType","MissingID","Label","Medium","UnSupportedLevel","convertPage","sTemplateType","oMetaModel","oManifestSettings","sFullContextPath","oCapabilities","component","oConvertedMetadata","convertTypes","diagnostics","annotationErrorDetail","checkIfIssueExists","Annotation","message","entityTypes","oEntitySet","annotations","UI","name","sTargetEntitySetName","entitySet","sContextPath","contextPath","oContext","createBindingContext","oFullContext","getInvolvedDataModelObjects","oConvertedPage","converterContext","ConverterContext","merge","TemplateType","ListReport","AnalyticalListPage","ListReportConverter","ObjectPage","ObjectPageConverter","FreeStylePage","extendPageDefinition","undefined","_exports"],"sourceRoot":".","sources":["TemplateConverter.ts"],"sourcesContent":["import type { EntitySet, NavigationProperty, Singleton } from \"@sap-ux/vocabularies-types\";\nimport type { FacetTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport { UIAnnotationTypes } from \"@sap-ux/vocabularies-types/vocabularies/UI\";\nimport merge from \"sap/base/util/merge\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport { IssueCategory, IssueCategoryType, IssueSeverity } from \"sap/fe/core/converters/helpers/IssueManager\";\nimport type { EnvironmentCapabilities } from \"sap/fe/core/services/EnvironmentServiceFactory\";\nimport type { IssueDefinition } from \"sap/fe/core/support/Diagnostics\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport ConverterContext from \"./ConverterContext\";\nimport type { BaseManifestSettings } from \"./ManifestSettings\";\nimport { TemplateType } from \"./ManifestSettings\";\nimport { convertTypes, getInvolvedDataModelObjects } from \"./MetaModelConverter\";\nimport * as ListReportConverter from \"./templates/ListReportConverter\";\nimport * as ObjectPageConverter from \"./templates/ObjectPageConverter\";\n\n// A context path for a page can either point to an EntitySet, a NavigationProperty or a Singleton\nexport type PageContextPathTarget = EntitySet | NavigationProperty | Singleton;\n\nexport type PageDefinition = {\n\ttemplate: string;\n};\n\nexport interface IDiagnostics {\n\taddIssue(\n\t\tissueCategory: IssueCategory,\n\t\tissueSeverity: IssueSeverity,\n\t\tdetails: string,\n\t\tissueCategoryType?: typeof IssueCategoryType,\n\t\tissueSubCategory?: string\n\t): void;\n\tgetIssues(): IssueDefinition[];\n\tcheckIfIssueExists(\n\t\tissueCategory: IssueCategory,\n\t\tissueSeverity: IssueSeverity,\n\t\tdetails: string,\n\t\tissueCategoryType?: typeof IssueCategoryType,\n\t\tissueSubCategory?: string\n\t): boolean;\n}\nfunction handleErrorForCollectionFacets(oFacets: FacetTypes[], oDiagnostics: IDiagnostics, sEntitySetName: string, level: number): void {\n\toFacets.forEach((oFacet) => {\n\t\tlet Message = `For entity set ${sEntitySetName}`;\n\t\tif (oFacet?.$Type === UIAnnotationTypes.CollectionFacet && !oFacet?.ID) {\n\t\t\tMessage = `${Message}, ` + `level ${level}, the collection facet does not have an ID.`;\n\t\t\toDiagnostics.addIssue(\n\t\t\t\tIssueCategory.Facets,\n\t\t\t\tIssueSeverity.High,\n\t\t\t\tMessage,\n\t\t\t\tIssueCategoryType,\n\t\t\t\tIssueCategoryType?.Facets?.MissingID\n\t\t\t);\n\t\t}\n\t\tif (oFacet?.$Type === UIAnnotationTypes.CollectionFacet && level >= 3) {\n\t\t\tMessage = `${Message}, collection facet ${oFacet.Label} is not supported at ` + `level ${level}`;\n\t\t\toDiagnostics.addIssue(\n\t\t\t\tIssueCategory.Facets,\n\t\t\t\tIssueSeverity.Medium,\n\t\t\t\tMessage,\n\t\t\t\tIssueCategoryType,\n\t\t\t\tIssueCategoryType?.Facets?.UnSupportedLevel\n\t\t\t);\n\t\t}\n\t\tif (oFacet?.$Type === UIAnnotationTypes.CollectionFacet && oFacet?.Facets) {\n\t\t\thandleErrorForCollectionFacets(oFacet?.Facets, oDiagnostics, sEntitySetName, ++level);\n\t\t\tlevel = level - 1;\n\t\t}\n\t});\n}\n/**\n * Based on a template type, convert the metamodel and manifest definition into a json structure for the page.\n * @param sTemplateType The template type\n * @param oMetaModel The odata model metaModel\n * @param oManifestSettings The current manifest settings\n * @param oDiagnostics The diagnostics wrapper\n * @param sFullContextPath The context path to reach this page\n * @param oCapabilities\n * @param component The template component\n * @returns The target page definition\n */\nexport function convertPage(\n\tsTemplateType: TemplateType,\n\toMetaModel: ODataMetaModel,\n\toManifestSettings: BaseManifestSettings,\n\toDiagnostics: IDiagnostics,\n\tsFullContextPath: string,\n\toCapabilities?: EnvironmentCapabilities,\n\tcomponent?: TemplateComponent\n): object | undefined {\n\tconst oConvertedMetadata = convertTypes(oMetaModel, oCapabilities);\n\t// TODO: This will have incomplete information because the conversion happens lazily\n\toConvertedMetadata.diagnostics.forEach((annotationErrorDetail) => {\n\t\tconst checkIfIssueExists = oDiagnostics.checkIfIssueExists(\n\t\t\tIssueCategory.Annotation,\n\t\t\tIssueSeverity.High,\n\t\t\tannotationErrorDetail.message\n\t\t);\n\t\tif (!checkIfIssueExists) {\n\t\t\toDiagnostics.addIssue(IssueCategory.Annotation, IssueSeverity.High, annotationErrorDetail.message);\n\t\t}\n\t});\n\toConvertedMetadata?.entityTypes?.forEach((oEntitySet) => {\n\t\tif (oEntitySet?.annotations?.UI?.Facets) {\n\t\t\thandleErrorForCollectionFacets(oEntitySet?.annotations?.UI?.Facets, oDiagnostics, oEntitySet?.name, 1);\n\t\t}\n\t});\n\tconst sTargetEntitySetName = oManifestSettings.entitySet;\n\tconst sContextPath =\n\t\toManifestSettings?.contextPath || (sFullContextPath === \"/\" ? sFullContextPath + sTargetEntitySetName : sFullContextPath);\n\tconst oContext = oMetaModel.createBindingContext(sContextPath) as Context;\n\tconst oFullContext = getInvolvedDataModelObjects<PageContextPathTarget>(oContext);\n\tif (oFullContext) {\n\t\tlet oConvertedPage = {};\n\t\tconst converterContext = new ConverterContext(oConvertedMetadata, oManifestSettings, oDiagnostics, merge, oFullContext);\n\t\tswitch (sTemplateType) {\n\t\t\tcase TemplateType.ListReport:\n\t\t\tcase TemplateType.AnalyticalListPage:\n\t\t\t\toConvertedPage = ListReportConverter.convertPage(converterContext, oCapabilities);\n\t\t\t\tbreak;\n\t\t\tcase TemplateType.ObjectPage:\n\t\t\t\toConvertedPage = ObjectPageConverter.convertPage(converterContext);\n\t\t\t\tbreak;\n\t\t\tcase TemplateType.FreeStylePage:\n\t\t\t\tbreak;\n\t\t}\n\t\tif (component?.extendPageDefinition) {\n\t\t\toConvertedPage = component.extendPageDefinition(oConvertedPage, converterContext);\n\t\t}\n\t\treturn oConvertedPage;\n\t}\n\treturn undefined;\n}\n"],"mappings":"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","ignoreList":[],"file":"TemplateConverter-dbg.js"}