/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/TypeGuards","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/UIFormatters","sap/ui/core/Lib","../../helpers/BindingHelper","../ManifestSettings"],function(e,t,n,i,a,o,r,s,l,c,u){"use strict";var f={};var p=u.ActionType;var d=c.singletonPathVisitor;var y=c.UI;var v=c.Draft;var g=s.isVisible;var b=r.isPathDeletable;var A=o.isEntitySet;var m=i.KeyHelper;var D=n.Placement;var E=t.getSemanticObjectMapping;var h=t.getEnabledForAnnotationAction;var I=t.getCopyAction;var F=t.dataFieldIsCopyAction;var C=t.ButtonType;var T=e.pathInModel;var S=e.not;var O=e.ifElse;var U=e.getExpressionFromAnnotation;var B=e.fn;var P=e.equal;var N=e.constant;var M=e.compileExpression;var k=e.and;function R(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean(e.Determining?.valueOf())===t&&(e.ActionTarget?.isBound?.valueOf()!==true||e?.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false)?true:false)||[]}f.getIdentificationDataFieldForActions=R;function H(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&Boolean(e.Determining?.valueOf())===t&&(e.ActionTarget?.isBound?.valueOf()!==true||e?.ActionTarget?.annotations?.Core?.OperationAvailable?.valueOf()!==false)||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"?true:false)||[]}f.getIdentificationDataFieldForActionsOrGroups=H;function V(e,t){return e.annotations?.UI?.Identification?.filter(e=>e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&Boolean(e.Determining?.valueOf())===t?true:false)||[]}const x=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];f.IMPORTANT_CRITICALITIES=x;function L(e,t){const n=e.getDataModelObjectPath(),i=n.navigationProperties.map(e=>e.name),a=U(t,i,false,t=>d(t,e.getConvertedTypes(),[])),o=e.getManifestWrapper(),r=o.getViewLevel(),s=r>1?y.IsEditable:S(y.IsEditable);return O(t===undefined||t.valueOf()===false,s,k(s,P(a,false)))}f.getDeleteButtonVisibility=L;function j(e,t,n){const i=n.getEntitySet(),o=a.isDraftRoot(i);let r=O(t!==undefined,t,O(e!==undefined,P(U(e),true),N(true)));r=o?k(r,S(T("DraftAdministrativeData/InProcessByUser"))):r;return r}f.getDeleteButtonEnabled=j;function w(e,t,n,i,o){const r=n?.getEntitySet(),s=e.getEntitySet(),l=e.getManifestWrapper().isFclEnabled();let c;const u=$(n,t);if(o&&o>1){c=a.isDraftNode(s)}else{c=a.isDraftRoot(r)}const f=$(n,i);const p=S(y.IsEditable);const d=O(o>1,O(i===undefined||i.valueOf()===false,k(p,P(T("rootEditVisible","internal"),true),O(l,P(T("/showEditButton","fclhelper"),true),true)),k(p,P(f,false),P(T("rootEditVisible","internal"),true),O(l,P(T("/showEditButton","fclhelper"),true),true))),O(t===undefined||t.valueOf()===false,p,k(p,P(u,false))));return O(c,k(d,v.HasNoDraftForCurrentUser),d)}f.getEditButtonVisibility=w;function $(e,t){const n=e.getDataModelObjectPath(),i=n.navigationProperties.map(e=>e.name),a=U(t,i,false,t=>d(t,e.getConvertedTypes(),i));return a}f.getHiddenExpression=$;function K(e,t,n){const i=e.getEntitySet(),o=a.isDraftRoot(i),r=a.isSticky(i);let s;if(o&&A(i)){s=i.annotations.Common?.DraftRoot?.EditAction}else if(r&&A(i)){s=i.annotations.Session?.StickySessionSupported?.EditAction}if(s){const i=e.getAbsoluteAnnotationPath(s);const a=e.resolveAbsolutePath(i).target;if(a?.annotations?.Core?.OperationAvailable===null){}else if(n>1){if(t!==undefined){return M(k(P(U(t),true),P(T("rootEditEnabled","internal"),true)))}else{return M(P(T("rootEditEnabled","internal"),true))}}else{return h(e,a??undefined)}}return"true"}f.getEditButtonEnabled=K;function G(e){const t=e.getContextPath();const n=a.getRootEntitySetPath(t);const i=e.getConverterContextFor("/"+n);const o=e.getEntitySet(),r=e.getEntityType(),s=i.getEntitySet(),c=i.getEntityType(),u=a.getStickySession(s),f=a.getDraftRoot(s),y=a.getDraftNode(s),v=o&&o.annotations?.Capabilities?.DeleteRestrictions,g=a.isUpdateHidden(s,c),D=s&&A(s)&&g?.valueOf(),h=e.getDataModelObjectPath(),O=b(h,{pathVisitor:(t,n)=>d(t,e.getConvertedTypes(),n)}),N=O?M(O):O,R=H(e.getEntityType(),false);const $=e.getManifestWrapper().getViewLevel()===1?I(R.filter(e=>{if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return F(e)}})):undefined;const G=R.filter(e=>!F(e));const W=[];if(A(o)&&f?.EditAction&&D!==true){W.push({type:p.DraftActions,key:"DraftActions"})}const _=e.getManifestWrapper().getViewLevel();const Y=_>1?o?.annotations.Capabilities?.UpdateRestrictions?.Updatable:undefined;if(f||y){W.push({type:p.CollaborationAvatars,key:"CollaborationAvatars"})}Q(W,true,G,e);if((f?.EditAction||u?.EditAction)&&D!==true){W.push({type:p.Primary,key:"EditAction",visible:M(w(e,g,i,a.isUpdateHidden(o,r),_)),enabled:K(i,Y,_)})}if(N&&N!=="false"||v?.Deletable?.valueOf()!==false&&N!=="false"){const t=a.getDeleteHidden(o,r);W.push({type:p.Secondary,key:"DeleteAction",visible:M(L(e,t)),enabled:M(j(v?.Deletable,O,e)),parentEntityDeleteEnabled:N})}if($){W.push({...q($,e),type:p.Copy,text:$.Label?.toString()??l.getResourceBundleFor("sap.fe.core").getText("C_COMMON_COPY")})}const z=V(e.getEntityType(),false);z.filter(e=>{const t=M(U(e?.Criticality));return!x.includes(t)}).forEach(t=>{if(t.RequiresContext?.valueOf()===true){throw new Error(`RequiresContext property should not be true for header IBN action : ${t.Label}`)}if(t.Inline?.valueOf()===true){throw new Error(`Inline property should not be true for header IBN action : ${t.Label}`)}const n={semanticObjectMapping:E(t.Mapping)};W.push({type:p.DataFieldForIntentBasedNavigation,text:t.Label?.toString(),annotationPath:e.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),buttonType:C.Ghost,visible:M(k(S(P(U(t.annotations?.UI?.Hidden),true)),S(P(T("shellNavigationNotAvailable","internal"),true)))),enabled:t.NavigationAvailable!==undefined?M(P(U(t.NavigationAvailable),true)):true,key:m.generateKeyFromDataField(t),isNavigable:true,press:M(B("._intentBasedNavigation.navigate",[U(t.SemanticObject),U(t.Action),n])),customData:M({semanticObject:U(t.SemanticObject),action:U(t.Action)})})});Q(W,false,G,e);return W}f.getHeaderDefaultActions=G;function W(e){const t=e.getEntityType();const n=t.annotations?.UI?.Identification?.filter(e=>e?.annotations?.UI?.Hidden?.valueOf()===true)||[];return n.map(e=>({type:p.Default,key:m.generateKeyFromDataField(e)}))}f.getHiddenHeaderActions=W;function _(e,t){const n=t.getEntitySet();const i=t.getEntityType();const o=a.getStickySession(n),r=A(n)&&(n.annotations.Common?.DraftRoot?.term??n.annotations.Session?.StickySessionSupported?.term),s=Boolean(r==="com.sap.vocabularies.Common.v1.DraftRoot"||o&&o?.SaveAction),l=e>1,c=Boolean(r==="com.sap.vocabularies.Common.v1.DraftRoot"||o&&o?.DiscardAction);const u=R(t.getEntityType(),true);const f=u.filter(e=>{const t=M(U(e?.Criticality));return t&&x.includes(t)}).map(e=>q(e,t));if(n?.entityTypeName===i?.fullyQualifiedName&&s){f.push({type:p.Primary,key:"SaveAction"})}if(l){f.push({type:p.DefaultApply,key:"ApplyAction"})}u.filter(e=>{const t=M(U(e?.Criticality));return t&&!x.includes(t)}).forEach(e=>{f.push(q(e,t))});if(c){f.push({type:p.Secondary,key:"CancelAction",position:{placement:D.End}})}return f}f.getFooterDefaultActions=_;function q(e,t){const n=g(e);return{type:p.DataFieldForAction,annotationPath:t.getEntitySetBasedAnnotationPath(e.fullyQualifiedName),key:m.generateKeyFromDataField(e),visible:M(n),enabled:h(t,e.ActionTarget),isNavigable:true}}function Q(e,t,n,i){n.filter(e=>{const n=M(U(e?.Criticality));return t?x.includes(n):!x.includes(n)}).forEach(t=>{if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){e.push(q(t,i))}else if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldForActionGroup"){e.push({type:p.Menu,text:t.Label,key:m.generateKeyFromDataField(t),id:m.generateKeyFromDataField(t),visible:M(S(P(U(t.annotations?.UI?.Hidden),true))),menu:t.Actions.map(e=>q(e,i))})}})}return f},false);
//# sourceMappingURL=HeaderAndFooterAction.js.map