/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/controllerextensions/collaboration/CollaborationCommon","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/WebSocket","sap/m/MessageBox"],function(e,t,o,r){"use strict";var n={};var a=o.createWebSocket;var i=o.ChannelType;var s=t.getResourceModel;var c=e.Activity;const l="/collaboration";const C="/collaboration/connection";const N="/collaboration/DraftID";const f="/collaboration/websocket_status";let p=function(e){e[e["CLOSED"]=0]="CLOSED";e[e["CLOSING"]=1]="CLOSING";e[e["CONNECTING"]=2]="CONNECTING";e[e["CONNECTED"]=3]="CONNECTED";e[e["ERROR"]=4]="ERROR";return e}({});n.WEBSOCKET_STATUS=p;function u(e){return e.getProperty(f)===p.CONNECTED}n.isCollaborationConnected=u;function O(e,t,o,n,c){let u=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(o.getProperty(C)){if(o.getProperty(N)===t){return false}else{d(o)}}const O=[e];o.setProperty(l,{activeUsers:O,activities:{}});const E={draft:t};if(u||new URLSearchParams(window.location.search).get("useFLPUser")==="true"){E["userID"]=e.id;E["userName"]=e.initialName??""}const g=a(i.CollaborationDraft,c.getModel(),E);o.setProperty(f,p.CONNECTING);o.setProperty(C,g);o.setProperty(N,t);g.attachMessage(function(e){const t=e.getParameter("pcpFields");if(t){n(t)}});g.attachOpen(function(){o.setProperty(f,p.CONNECTED)});g.attachError(function(){if([p.CONNECTING,p.CONNECTED].includes(o.getProperty(f))){const e=s(c);const t=e.getText("C_COLLABORATIONDRAFT_CONNECTION_LOST");r.warning(t,{actions:[r.Action.OK],emphasizedAction:r.Action.OK})}o.setProperty(f,p.ERROR)});g.attachClose(function(){o.setProperty(f,p.CLOSED)});return true}n.initializeCollaboration=O;function E(e,t,o,r,n,a){if(u(o)){const i=o.getProperty(C);i.send("",{clientAction:e,clientContent:t,clientTriggeredActionName:r,clientRefreshListBinding:n,clientRequestedProperties:a});if(e===c.Activate||e===c.Discard){d(o)}}}n.broadcastCollaborationMessage=E;function d(e){const t=e.getProperty(C);e.setProperty(l,{});e.setProperty(f,p.CLOSING);t?.close()}n.endCollaboration=d;return n},false);
//# sourceMappingURL=ActivityBase.js.map