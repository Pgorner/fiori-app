{"version":3,"file":"CollaborationManager.js","names":["CollaborationManagerExtension","_dec","defineUI5Class","_dec2","methodOverride","_dec3","_dec4","_dec5","publicExtension","_dec6","extensible","_class","_class2","_ControllerExtension","_this","call","this","init","_exports","_inheritsLoose","_proto","prototype","onInit","async","feView","base","getView","appComponent","CommonUtils","getAppComponent","environmentCapabilities","getService","serviceEnabled","getCapabilities","InsightsSupported","isInsightsEnabled","onAfterBinding","connect","getId","cards","collectAvailableCards","cardObject","updateCards","parentAppId","addCardsToCollaborationManager","reduce","acc","cur","card","id","onExit","unregisterProvider","getCollaborationManagerService","Promise","resolve","ControllerExtension","_applyDecoratedDescriptor","Object","getOwnPropertyDescriptor"],"sources":["./CollaborationManager.ts"],"sourcesContent":["import { defineUI5Class, extensible, methodOverride, publicExtension } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type { CollaborationManagerService, WrappedCard } from \"sap/fe/core/services/CollaborationManagerServiceFactory\";\nimport type { EnvironmentCapabilitiesService } from \"sap/fe/core/services/EnvironmentServiceFactory\";\nimport ControllerExtension from \"sap/ui/core/mvc/ControllerExtension\";\n/**\n * An implementation for controller extension used internally in sap.fe for central functionalities to serve collaboration manager use cases.\n * @since 1.120.0\n */\n@defineUI5Class(\"sap.fe.core.controllerextensions.cards.CollaborationManager\")\nexport default class CollaborationManagerExtension extends ControllerExtension {\n\tprotected base!: PageController;\n\n\tprotected feView!: FEView;\n\n\tprivate appComponent!: AppComponent;\n\n\tprivate serviceEnabled!: boolean;\n\n\tconstructor() {\n\t\tsuper();\n\t\t(this as unknown as { init: Function }).init();\n\t}\n\n\t@methodOverride()\n\tasync onInit(): Promise<void> {\n\t\tthis.feView = this.base.getView();\n\t\tthis.appComponent = CommonUtils.getAppComponent(this.feView);\n\t\tconst environmentCapabilities = (await this.appComponent.getService(\"environmentCapabilities\")) as EnvironmentCapabilitiesService;\n\n\t\tthis.serviceEnabled = true;\n\t\t// Only connect to the Collaboration Manager if it is explicitly enabled and the sap.insights library is loaded\n\t\tif (\n\t\t\t!this.appComponent[\"isCollaborationManagerServiceEnabled\"]() ||\n\t\t\t!environmentCapabilities.getCapabilities().InsightsSupported ||\n\t\t\t!(await environmentCapabilities.isInsightsEnabled())\n\t\t) {\n\t\t\tthis.serviceEnabled = false;\n\t\t}\n\t}\n\n\t@methodOverride(\"_routing\")\n\tasync onAfterBinding(): Promise<void> {\n\t\tif (this.serviceEnabled === false) {\n\t\t\treturn;\n\t\t}\n\t\tawait this.getService().connect(this.appComponent.getId(), async () => {\n\t\t\tconst cards: WrappedCard[] = [];\n\t\t\tawait this.collectAvailableCards(cards);\n\t\t\tconst cardObject = this.updateCards(cards);\n\t\t\tconst parentAppId = this.appComponent.getId();\n\t\t\tthis.getService().addCardsToCollaborationManager(cardObject, parentAppId);\n\t\t});\n\t}\n\t\n\tupdateCards(cards: WrappedCard[]): Record<string, WrappedCard> {\n\t\treturn cards.reduce(\n\t\t\t(acc, cur) => {\n\t\t\t\tif (cur?.card[\"sap.app\"]?.id) {\n\t\t\t\t\tacc[cur?.card[\"sap.app\"]?.id] = cur;\n\t\t\t\t}\n\t\t\t\treturn acc;\n\t\t\t},\n\t\t\t{} as Record<string, WrappedCard>\n\t\t);\n\t}\n\n\t/**\n\t * Automatic unregistering on exit of the application.\n\t *\n\t */\n\t@methodOverride()\n\tonExit(): void {\n\t\tthis.getService().unregisterProvider();\n\t}\n\n\tgetService(): CollaborationManagerService {\n\t\treturn this.appComponent.getCollaborationManagerService();\n\t}\n\n\t@publicExtension()\n\t@extensible(\"AfterAsync\")\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tasync collectAvailableCards(cards: WrappedCard[]): Promise<void> {\n\t\treturn Promise.resolve();\n\t}\n}\n"],"mappings":";;;;k3BAQA,IAKqBA,GAA6BC,EADjDC,EAAe,+DAA8DC,EAe5EC,IAAgBC,EAiBhBD,EAAe,YAAWE,EA8B1BF,IAAgBG,EAShBC,IAAiBC,EACjBC,EAAW,cAAaT,EAAAU,GAAAC,EAAA,SAAAC,GA9DzB,SAAAb,IAAc,IAAAc,EACbA,EAAAD,EAAAE,KAAAC,OAAOA,KACPF,EAAwCG,OAAO,OAAAH,CAChD,CAACI,EAAAlB,EAAAmB,EAAAnB,EAAAa,GAAA,IAAAO,EAAApB,EAAAqB,UAAAD,EAGKE,OADNC,eACMD,IACLN,KAAKQ,OAASR,KAAKS,KAAKC,UACxBV,KAAKW,aAAeC,EAAYC,gBAAgBb,KAAKQ,QACrD,MAAMM,QAAiCd,KAAKW,aAAaI,WAAW,2BAEpEf,KAAKgB,eAAiB,KAEtB,IACEhB,KAAKW,aAAa,4CAClBG,EAAwBG,kBAAkBC,0BACnCJ,EAAwBK,oBAC/B,CACDnB,KAAKgB,eAAiB,KACvB,CACD,EAACZ,EAGKgB,eADNb,eACMa,IACL,GAAIpB,KAAKgB,iBAAmB,MAAO,CAClC,MACD,OACMhB,KAAKe,aAAaM,QAAQrB,KAAKW,aAAaW,QAASf,UAC1D,MAAMgB,EAAuB,SACvBvB,KAAKwB,sBAAsBD,GACjC,MAAME,EAAazB,KAAK0B,YAAYH,GACpC,MAAMI,EAAc3B,KAAKW,aAAaW,QACtCtB,KAAKe,aAAaa,+BAA+BH,EAAYE,EAAY,EAE3E,EAACvB,EAEDsB,YAAA,SAAAA,EAAYH,GACX,OAAOA,EAAMM,OACZ,CAACC,EAAKC,KACL,GAAIA,GAAKC,KAAK,YAAYC,GAAI,CAC7BH,EAAIC,GAAKC,KAAK,YAAYC,IAAMF,CACjC,CACA,OAAOD,CAAG,EAEX,CAAC,EAEH,EAEA1B,EAKA8B,OADA,SACAA,IACClC,KAAKe,aAAaoB,oBACnB,EAAC/B,EAEDW,WAAA,SAAAA,IACC,OAAOf,KAAKW,aAAayB,gCAC1B,EAAChC,EAKKoB,sBAHNjB,eAGMiB,EAAsBD,GAC3B,OAAOc,QAAQC,SAChB,EAAC,OAAAtD,CAAA,CAJwB,CAvEiCuD,GAAmBC,EAAA5C,EAAAS,UAAA,UAAAlB,GAAAsD,OAAAC,yBAAA9C,EAAAS,UAAA,UAAAT,EAAAS,WAAAmC,EAAA5C,EAAAS,UAAA,kBAAAhB,GAAAoD,OAAAC,yBAAA9C,EAAAS,UAAA,kBAAAT,EAAAS,WAAAmC,EAAA5C,EAAAS,UAAA,UAAAf,GAAAmD,OAAAC,yBAAA9C,EAAAS,UAAA,UAAAT,EAAAS,WAAAmC,EAAA5C,EAAAS,UAAA,yBAAAd,EAAAE,GAAAgD,OAAAC,yBAAA9C,EAAAS,UAAA,yBAAAT,EAAAS,WAAAT,KAAAD,GAAAO,EAAAlB,EAAA,OAAAkB,CAAA","ignoreList":[]}