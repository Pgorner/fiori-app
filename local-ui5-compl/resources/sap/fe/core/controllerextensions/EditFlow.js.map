{"version":3,"file":"EditFlow.js","names":["ProgrammingModel","FELibrary","Constants","DraftStatus","EditMode","StartupMode","EditFlow","_dec","defineUI5Class","_dec2","publicExtension","_dec3","finalExtension","_dec4","_dec5","_dec6","_dec7","_dec8","_dec9","extensible","OverrideExecution","After","_dec10","_dec11","_dec12","_dec13","_dec14","_dec15","_dec16","_dec17","_dec18","_dec19","_dec20","_dec21","_dec22","_dec23","_dec24","_dec25","_dec26","_dec27","_dec28","_dec29","_dec30","_dec31","_dec32","_dec33","_dec34","_dec35","_dec36","_dec37","_dec38","_dec39","_dec40","_dec41","Instead","_dec42","_dec43","_class","_class2","_BaseControllerExtens","_this","_len","arguments","length","args","Array","_key","call","this","syncTasks","Promise","resolve","handleSideEffects","async","listBinding","creationPromise","viewBindingContext","getView","getBindingContext","newContext","created","CommonUtils","hasTransientContext","getAppComponent","getSideEffectsService","requestSideEffectsForNavigationProperty","getPath","error","Log","createCustomValidationMessages","validationMessages","table","customValidationFunction","getCreationRow","data","customValidity","getProperty","customMessages","fieldControl","finalTarget","oldMessages","Messaging","getMessageModel","getData","filter","message","getCode","removeMessages","forEach","validationMessage","messageTarget","Element","getElementById","fieldId","getBindingPath","getTargets","some","target","addMessages","Message","messageText","processor","getModel","type","MessageType","Error","code","technical","persistent","existingValidationMessages","addControlId","push","text","getMessageHandler","showMessageDialog","resolveCreationMode","initialCreationMode","createData","CreationMode","NewPage","metaModel","getMetaModel","programmingModel","getProgrammingModel","isRelative","dataModelListBindingPath","getInvolvedDataModelObjects","getMetaContext","entitySet","targetEntitySet","newAction","Draft","annotations","Common","DraftRoot","Session","StickySessionSupported","NewAction","toString","targetEntityType","actions","parameters","Deferred","creationParameters","getTransactionHelper","getCreationParameters","Async","_inheritsLoose","_proto","prototype","getInterface","base","editDocument","context","transactionHelper","rootViewController","_getRootViewController","model","viewData","getViewData","rootContext","view","groupId","messageHandlingKey","registerToHoldMessages","viewLevel","Sticky","createRootContext","editFlow","onBeforeEdit","rightmostContext","_isFclEnabled","getRightmostContext","undefined","newDocumentContextPromise","rootContextInfo","rootSiblingPathPromise","_setStickySessionInternalProperties","siblingInfoPromise","computeSiblingInfo","_computeSiblingInformation","submitBatch","siblingInfo","newDocumentContext","contextToNavigate","_getNavigationTargetForEdit","_updatePathsInHistory","overrideMessageUIDecision","onAfterEdit","_handleNewContext","editable","recreateContext","forceFocus","stickyContext","getKeepAliveContext","handleStickyOn","ModelHelper","isCollaborationDraftSupported","shareObject","setEditMode","Editable","setDocumentModified","unHoldKey","overrideUIDecision","reject","requestSideEffectsOnDelete","parentContext","sideEffectService","stateMessagesPath","getMessagesPath","isListBindingHierarchical","requestSideEffects","deleteMultipleDocuments","contextsToDelete","beforeDeleteCallBack","onBeforeDelete","lockObject","getGlobalUIModel","parentControl","byId","controlId","inactiveContextsToDelete","isA","isInactive","getBinding","getRowBinding","bFindActiveContexts","BusyLocker","lock","selectedContexts","deleteDocumentTransaction","result","clearSelection","isRoot","refreshListBinding","EditState","setEditStateDirty","isRecommendationEnabled","recommendations","ignoreRecommendationForContexts","onAfterDelete","contexts","tableAPI","getParent","tableDefinition","control","creationMode","InlineCreationRows","removeEmptyRowsMessages","setUpEmptyRows","_sendActivity","Activity","Delete","unlock","updateDocument","updatedContext","updatePromise","originalBindingContext","isDraft","removeTransitionMessages","syncTask","setDraftStatus","Saving","currentBindingContext","entitySetName","getObject","semanticKeys","SemanticKeyHelper","getSemanticKeys","currentSemanticMapping","_getSemanticMapping","currentSemanticPath","semanticPath","sChangedPath","getSemanticPath","Saved","Clear","showMessages","getParentContextFromSelection","createDocument","source","mInParameters","oDataListBinding","fnListBinding","instance","listBindingPath","dataModel","bindList","External","listBindingFromPath","createAtEnd","resolvedCreationMode","getRouterProxy","removeIAppStateKey","singleDraftForCreate","getManifest","app","getRootBinding","getHeaderContext","newBinding","getContext","Sorter","Filter","filters","path","operator","value1","and","requestContexts","then","destroy","_handleCreationMode","vListBinding","createExternalDocument","outbound","createDeferredDocument","CreationRow","creationRow","createCreateRowDocument","skipSideEffects","Inline","createDialogInlineDocument","tableId","CreationDialog","creationDialogFields","createDialogAndSaveDocument","Sync","createSyncAsyncDocument","bFromDeferred","createAction","postDocumentCreation","prerequisite","params","onAfterCreate","metaContext","startingEntitySet","getInternalModel","setProperty","isListBindingAnalytical","forceDraftSaveOrDiscard","setDocumentModifiedOnCreate","Create","isDraftRoot","collaborativeDraft","isConnected","creation","appComponent","navigation","creationRowContext","documentValidation","getCreationRowValidationFunction","entityType","creationRowPayload","_checkForValidationErrors","attachEventOnce","scrollToIndex","getLength","handleCreateEvents","Object","assign","keys","propertyPath","navigationProperties","findIndex","property","name","map","keepTransientContextOnFailed","busyMode","busyId","getTableDefinition","annotation","id","beforeCreateCallBack","onBeforeCreate","skipParameterDialog","getStartupMode","AutoCreate","_getResourceModel","creationRowListBinding","newTransientContext","create","setBindingContext","catch","trace","delete","all","isLocked","contextIndex","getIndex","aggregationData","getAggregation","isCreateInPlace","createInPlace","focusRow","MessageToast","show","getText","parentIndex","savedDocumentContext","afterCreateInDialog","onBeforeSave","saveDocument","onAfterSave","refresh","itemIndex","afterCreateCallBack","getInternalRouting","navigateForwardToContext","createOnNavigateParameters","mode","routingListener","createContextPromise","coreResourceBundle","Library","getResourceBundleFor","navigateToMessagePage","title","description","navParameters","transient","navigateToContext","CancelActionDialog","ActionExecutionFailed","CreationFailed","OnBeforeCreateFailed","includes","navigateBackFromTransientState","controller","getController","createPath","getAbsoluteMetaPathForListBinding","_intentBasedNavigation","onChevronPressNavigateOutBound","validateDocument","creationRowObjects","createMultipleDocuments","dataForCreate","isFromCopyPaste","createAsInactive","targetListBinding","contextPath","metaPath","getMetaPath","creationPromises","createParameters","inactive","propertyValues","$kind","createdContexts","activeContexts","err","_mParameters","onBeforeDiscard","onAfterDiscard","oContext","mParameters","bExecuteSideEffectsOnError","aBindings","bindings","mergePatchDraft","_submitOpenChanges","recommendationOptionChoosen","checkRecommendationOption","sProgrammingModel","isFclEnabled","_sideEffects","handlePageChangeContext","hasPendingChanges","activeDocumentContext","getCreationMode","_removeStickySessionInternalProperties","Activate","disconnect","_triggerConfiguredSurvey","StandardActions","save","TriggerType","standardAction","Display","storeDataForTelemetry","_createSiblingInfo","previousSemanticPath","newSemanticPath","pathMapping","oldPath","newPath","targetContext","oError","canceled","toggleDraftActive","oContextData","bIsDraft","IsActiveEntity","HasActiveEntity","HasDraftEntity","oRootViewController","oRightmostContext","lastSemanticMapping","technicalPath","targetPath","cancelDocument","isNewDocument","cancelParameters","skipDiscardPopover","cancelButton","beforeCancelCallBack","cancelResult","isDocumentModified","getInstancedViews","isKeepAlive","setKeepAlive","Discard","skipBackNavigation","navigateBackFromContext","oActiveDocumentContext","_fetchSemanticKeyValues","skipBindingToView","showDocumentDiscardMessage","resourceModel","getRoutingService","attachAfterRouteMatched","showMessageWhenNoContext","detachAfterRouteMatched","deleteDocument","oAppComponent","siblingContext","bindContext","getBoundContext","draftPath","requestCanonicalPath","draftContextToRemove","replaceWith","contextBinding","getShellServices","setBackNavigation","Deeplink","exitFromApp","applyDocument","oLockObject","isContinue","showConfirmRecommendationsDialog","RecommendationDialogDecision","Continue","invokeAction","sActionName","mExtraParams","aParts","sOverloadEntityType","oCurrentActionCallBacks","oView","isArray","isNavigable","requiresNavigation","convertedMetadata","convertTypes","entityContainer","isBound","oControl","internalModelContext","ignoreETag","split","replaceAll","bStaticAction","_getActionOverloadContextFromMetadataPath","enableAutoScroll","createActionPromise","getId","bObjectPage","converterType","response","callAction","successFullExecution","isFulfilled","listRefreshed","_refreshListIfRequired","getActionResponseDataAndKeys","Action","value","boundContext","action","fResolver","_getBoundContext","returnedContext","oMetaModel","sContextMetaPath","_fnValidContexts","applicableContexts","element","oActionContext","sActionContextMetaPath","checkNoHashChange","info","onAfterActionExecution","oResult","fRejector","_actionName","customMassEditSave","securedExecution","fnFunction","bBusySet","busy","set","bBusyCheck","check","bUpdatesDocument","updatesDocument","finally","handlePatchSent","oEvent","internalContext","getSource","setIgnoreETag","sourceBinding","oPatchPromise","patchCompletedEvent","ActionRuntime","setActionEnablementAfterPatch","bSuccess","getParameter","handleCreateSent","event","newTask","debug","computeModelsForEditMode","globalModel","isActiveEntity","requestObject","hasActiveEntity","lastInvokedActionName","isNewActionForSticky","numberOfSelectedContexts","sourceControl","getResourceModel","TransactionHelper","messageHandler","getPageInternalModel","setCreationMode","bCreationMode","pageInternalContext","UiModelConstants","CreateMode","DocumentModified","modified","binding","attachEvent","success","draftStatus","editMode","isCreation","forced","shallForceDraftSaveOrDiscard","actionName","stickySession","AdditionalNewActions","hasNavigationGuard","hashTracker","getHash","internalModel","setTimeout","setNavigationGuard","substring","onBackNavigationInSession","bind","i18nModel","registerStickySessionCallbacks","getDirtyStateProvider","getSessionTimeoutFunction","getRouteMatchedFunction","handleStickyOff","discardNavigationGuard","unregisterStickySessionCallbacks","getHttpHeaders","navigationContext","targetHash","innerAppRoute","routerProxy","lclHashTracker","isDirty","isSessionOn","isNavigationFinalized","checkHashWithGuard","isGuardCrossAllowedByUser","setDirtyFlag","warningDialog","Dialog","state","content","Text","beginButton","Button","press","afterClose","addStyleClass","setModel","addDependent","open","currentHash","discardStickySession","clearSessionContext","discardedContext","sticky","discardDocument","resetChanges","_routing","getRootViewController","getLastSemanticMapping","resolveFunction","rejectFunction","actionPromise","currentView","metaModelData","metaModelAction","actionReturnType","$ReturnType","$Type","$Key","oData","getCurrentActionPromise","deleteCurrentActionPromise","isSave","confirmRecommendationsDialog","ConfirmRecommendationDialog","_scrollAndFocusOnInactiveRow","rowBinding","activeRowIndex","getCount","allRowContexts","getContexts","index","singleContext","createEmptyRowsAndFocus","inlineCreationRowsHiddenInEditMode","relatedContexts","triggeredActionName","actionRequestedProperties","send","triggerType","triggerConfiguredSurvey","oModel","oRequestor","waitForRunningChangeRequests","checkIfBackIsOutOfGuard","processDataLossConfirmation","history","back","navigationParameters","persistOPScroll","reason","NavigationReason","EditFlowAction","showPlaceholder","keepCurrentLayout","bRefreshAfterAction","sViewId","aMessages","validation","getControlId","oResponse","oBinding","aKeys","oCurrentData","bReturnedContextIsSame","every","sKey","sEntitySetName","aSemanticKeys","paths","oKey","$PropertyPath","requestProperty","overloadEntityType","contextSegments","currentContext","pop","unshift","parentContexts","pathSegment","reverse","overloadContext","find","mappings","setPathMapping","rootCurrentContext","rightmostCurrentContext","doNotComputeIfRoot","startsWith","rightMostContextToUse","draft","computeSiblingInformation","BaseControllerExtension","_applyDecoratedDescriptor","getOwnPropertyDescriptor"],"sources":["./EditFlow.ts"],"sourcesContent":["import type { EntitySet } from \"@sap-ux/vocabularies-types\";\nimport Log from \"sap/base/Log\";\nimport { defineUI5Class, extensible, finalExtension, publicExtension } from \"sap/fe/base/ClassSupport\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type IRowBindingInterface from \"sap/fe/core/IRowBindingInterface\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type ResourceModel from \"sap/fe/core/ResourceModel\";\nimport BaseControllerExtension from \"sap/fe/core/controllerextensions/BaseControllerExtension\";\nimport BusyLocker from \"sap/fe/core/controllerextensions/BusyLocker\";\nimport { StandardActions, TriggerType, triggerConfiguredSurvey } from \"sap/fe/core/controllerextensions/Feedback\";\nimport type InternalRouting from \"sap/fe/core/controllerextensions/InternalRouting\";\nimport type MessageHandler from \"sap/fe/core/controllerextensions/MessageHandler\";\nimport type { CustomMessage } from \"sap/fe/core/controllerextensions/MessageHandler\";\nimport { Activity, shareObject } from \"sap/fe/core/controllerextensions/collaboration/CollaborationCommon\";\nimport type { CancelParameters, CreateParameters } from \"sap/fe/core/controllerextensions/editFlow/TransactionHelper\";\nimport TransactionHelper from \"sap/fe/core/controllerextensions/editFlow/TransactionHelper\";\nimport type { BindContextParameters, RootContextInfo, SiblingInformation } from \"sap/fe/core/controllerextensions/editFlow/draft\";\nimport draft from \"sap/fe/core/controllerextensions/editFlow/draft\";\nimport UiModelConstants from \"sap/fe/core/controllerextensions/editFlow/editFlowConstants\";\nimport sticky from \"sap/fe/core/controllerextensions/editFlow/sticky\";\nimport type { MetaModelAction } from \"sap/fe/core/converters/MetaModelConverter\";\nimport { convertTypes, getInvolvedDataModelObjects } from \"sap/fe/core/converters/MetaModelConverter\";\nimport type { DraftSiblingPair } from \"sap/fe/core/helpers/DeleteHelper\";\nimport EditState from \"sap/fe/core/helpers/EditState\";\nimport type { InternalModelContext } from \"sap/fe/core/helpers/ModelHelper\";\nimport ModelHelper from \"sap/fe/core/helpers/ModelHelper\";\nimport { getResourceModel } from \"sap/fe/core/helpers/ResourceModelHelper\";\nimport SemanticKeyHelper from \"sap/fe/core/helpers/SemanticKeyHelper\";\nimport FELibrary from \"sap/fe/core/library\";\nimport type FclController from \"sap/fe/core/rootView/Fcl.controller\";\nimport type RootViewBaseController from \"sap/fe/core/rootView/RootViewBaseController\";\nimport type { RoutingNavigationParameters, SemanticMapping } from \"sap/fe/core/services/RoutingServiceFactory\";\nimport type MacroTable from \"sap/fe/macros/Table\";\nimport type TableAPI from \"sap/fe/macros/table/TableAPI\";\nimport Button from \"sap/m/Button\";\nimport Dialog from \"sap/m/Dialog\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport Text from \"sap/m/Text\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type BaseObject from \"sap/ui/base/Object\";\nimport type Control from \"sap/ui/core/Control\";\nimport Element from \"sap/ui/core/Element\";\nimport Library from \"sap/ui/core/Lib\";\nimport Messaging from \"sap/ui/core/Messaging\";\nimport Message from \"sap/ui/core/message/Message\";\nimport MessageType from \"sap/ui/core/message/MessageType\";\nimport OverrideExecution from \"sap/ui/core/mvc/OverrideExecution\";\nimport type MultiValueField from \"sap/ui/mdc/MultiValueField\";\nimport type Table from \"sap/ui/mdc/Table\";\nimport type CreationRow from \"sap/ui/mdc/table/CreationRow\";\nimport type Binding from \"sap/ui/model/Binding\";\nimport Filter from \"sap/ui/model/Filter\";\nimport type Model from \"sap/ui/model/Model\";\nimport Sorter from \"sap/ui/model/Sorter\";\nimport type JSONModel from \"sap/ui/model/json/JSONModel\";\nimport type { default as Context, default as ODataV4Context } from \"sap/ui/model/odata/v4/Context\";\nimport type { ODataContextBinding$PatchSentEvent } from \"sap/ui/model/odata/v4/ODataContextBinding\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type { MetaModelEntityType } from \"types/metamodel_types\";\nimport ActionRuntime from \"../ActionRuntime\";\nimport { ConfirmRecommendationDialog, RecommendationDialogDecision } from \"../controls/Recommendations/ConfirmRecommendationDialog\";\nimport { CreationMode, type BaseManifestSettings } from \"../converters/ManifestSettings\";\nimport { isFulfilled } from \"../helpers/TypeGuards\";\nimport type { OperationResult } from \"./editFlow/ODataOperation\";\nimport NavigationReason from \"./routing/NavigationReason\";\n\nconst ProgrammingModel = FELibrary.ProgrammingModel,\n\tConstants = FELibrary.Constants,\n\tDraftStatus = FELibrary.DraftStatus,\n\tEditMode = FELibrary.EditMode,\n\tStartupMode = FELibrary.StartupMode;\n\ntype SaveDocumentParameters = {\n\tbExecuteSideEffectsOnError?: boolean;\n\tmergePatchDraft?: boolean;\n\tbindings?: ODataListBinding[];\n};\n\ntype InternalCreateParameters = {\n\tbeforeCreateCallBack?: Function;\n\tbFromDeferred?: boolean;\n\tbusyMode?: string;\n\tcreateAction?: boolean;\n\tcreateAtEnd?: boolean;\n\tcreationMode: string;\n\tcreationRow?: CreationRow;\n\tdata?: object;\n\ttableId?: string;\n\toutbound?: string;\n\tskipParameterDialog?: boolean;\n\tskipSideEffects?: boolean;\n\tselectedContexts?: ODataV4Context[];\n\tcreationDialogFields?: string[];\n};\n\n/**\n * A controller extension offering hooks into the edit flow of the application\n * @hideconstructor\n * @public\n * @since 1.90.0\n */\n@defineUI5Class(\"sap.fe.core.controllerextensions.EditFlow\")\nclass EditFlow extends BaseControllerExtension {\n\tprotected base!: PageController;\n\n\tprivate syncTasks: Promise<unknown> = Promise.resolve();\n\n\tprivate actionPromise?: Promise<{ controlId?: string; oData: Record<string, unknown>; keys: string[] }>;\n\n\tprivate confirmRecommendationsDialog?: ConfirmRecommendationDialog;\n\n\t//////////////////////////////////////\n\t// Public methods\n\t//////////////////////////////////////\n\n\tgetInterface(): BaseObject {\n\t\treturn super.getInterface();\n\t}\n\n\tgetAppComponent(): AppComponent {\n\t\treturn this.base.getAppComponent();\n\t}\n\n\t/**\n\t * Creates a draft document for the existing active document.\n\t * @param context Context of the active document\n\t * @returns Promise resolved once the editable document is available with the editable context\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync editDocument(context: Context): Promise<ODataV4Context | void> {\n\t\tconst transactionHelper = this.getTransactionHelper();\n\t\tconst rootViewController = this._getRootViewController();\n\t\tconst model = context.getModel();\n\t\tconst viewData = this.getView().getViewData() as BaseManifestSettings;\n\t\tconst programmingModel = this.getProgrammingModel(context);\n\t\tlet rootContext: Context = context;\n\t\tconst view = this.base.getView();\n\t\tconst groupId = \"editGroup\";\n\t\tconst messageHandlingKey = this.getMessageHandler().registerToHoldMessages();\n\t\ttry {\n\t\t\tif ((viewData?.viewLevel as number) > 1) {\n\t\t\t\tif (programmingModel === ProgrammingModel.Draft || programmingModel === ProgrammingModel.Sticky) {\n\t\t\t\t\trootContext = (await CommonUtils.createRootContext(programmingModel, view, this.getAppComponent())) as Context;\n\t\t\t\t}\n\t\t\t}\n\t\t\tawait this.base.editFlow.onBeforeEdit({ context: rootContext });\n\n\t\t\tlet rightmostContext = this._isFclEnabled() ? (rootViewController as FclController).getRightmostContext() : context;\n\t\t\tif (\n\t\t\t\trightmostContext === undefined ||\n\t\t\t\t(programmingModel === ProgrammingModel.Draft && this.getProgrammingModel(rightmostContext) !== ProgrammingModel.Draft)\n\t\t\t) {\n\t\t\t\t// we check the rightmostContext can be used in draft\n\t\t\t\trightmostContext = context;\n\t\t\t}\n\t\t\tconst newDocumentContextPromise = transactionHelper.editDocument(\n\t\t\t\trootContext,\n\t\t\t\tthis.base.getView(),\n\t\t\t\tthis.getAppComponent(),\n\t\t\t\tthis.getMessageHandler(),\n\t\t\t\tgroupId\n\t\t\t);\n\t\t\tconst rootContextInfo = {\n\t\t\t\trootSiblingPathPromise: newDocumentContextPromise\n\t\t\t};\n\t\t\tthis._setStickySessionInternalProperties(programmingModel, model);\n\n\t\t\tlet siblingInfoPromise;\n\t\t\t// rightmostContext === rootContext => we're in OP. If not, we're in multi-column layout of FCL\n\t\t\tconst computeSiblingInfo = rightmostContext !== rootContext || (viewData?.viewLevel as number) > 1;\n\t\t\tif (computeSiblingInfo) {\n\t\t\t\tsiblingInfoPromise = this._computeSiblingInformation(\n\t\t\t\t\trootContext,\n\t\t\t\t\trightmostContext,\n\t\t\t\t\tprogrammingModel,\n\t\t\t\t\ttrue,\n\t\t\t\t\trootContextInfo,\n\t\t\t\t\tgroupId\n\t\t\t\t);\n\t\t\t}\n\t\t\tcontext.getModel().submitBatch(groupId);\n\n\t\t\tlet siblingInfo = await siblingInfoPromise;\n\t\t\tconst newDocumentContext = (await newDocumentContextPromise) as Context;\n\t\t\tlet contextToNavigate: Context | undefined = newDocumentContext;\n\t\t\tif (computeSiblingInfo && contextToNavigate) {\n\t\t\t\tif (siblingInfo === undefined) {\n\t\t\t\t\tsiblingInfo = await this._computeSiblingInformation(\n\t\t\t\t\t\trootContext,\n\t\t\t\t\t\trightmostContext,\n\t\t\t\t\t\tprogrammingModel,\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\trootContextInfo,\n\t\t\t\t\t\t\"$auto\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tcontextToNavigate = this._getNavigationTargetForEdit(context, newDocumentContext, siblingInfo);\n\t\t\t} else {\n\t\t\t\tthis._updatePathsInHistory([]);\n\t\t\t}\n\n\t\t\tlet overrideMessageUIDecision = false;\n\t\t\tif (newDocumentContext) {\n\t\t\t\tawait this.base.editFlow.onAfterEdit({ context: contextToNavigate });\n\t\t\t\tawait this._handleNewContext(contextToNavigate as Context, {\n\t\t\t\t\teditable: true,\n\t\t\t\t\trecreateContext: false,\n\t\t\t\t\tforceFocus: true\n\t\t\t\t});\n\t\t\t\tif (programmingModel === ProgrammingModel.Sticky) {\n\t\t\t\t\t// The stickyOn handler must be set after the navigation has been done,\n\t\t\t\t\t// as the URL may change in the case of FCL\n\t\t\t\t\tlet stickyContext: Context;\n\t\t\t\t\tif (this._isFclEnabled()) {\n\t\t\t\t\t\t// We need to use the kept-alive context used to bind the page\n\t\t\t\t\t\tstickyContext = newDocumentContext?.getModel().getKeepAliveContext(newDocumentContext.getPath());\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstickyContext = newDocumentContext;\n\t\t\t\t\t}\n\t\t\t\t\tawait this.handleStickyOn(stickyContext);\n\t\t\t\t} else if (ModelHelper.isCollaborationDraftSupported(model.getMetaModel())) {\n\t\t\t\t\t// according to UX in case of enabled collaboration draft we share the object immediately\n\t\t\t\t\tshareObject(newDocumentContext);\n\t\t\t\t}\n\t\t\t\toverrideMessageUIDecision = true;\n\n\t\t\t\t// We change the edit mode after the page binding has been done, otherwise the creation of empty rows might fail (as the table is still on the active version)\n\t\t\t\tthis.setEditMode(EditMode.Editable, false);\n\t\t\t\tthis.setDocumentModified(false);\n\t\t\t}\n\t\t\tthis.getMessageHandler().showMessageDialog({ unHoldKey: messageHandlingKey, overrideUIDecision: overrideMessageUIDecision });\n\t\t\treturn contextToNavigate;\n\t\t} catch (error) {\n\t\t\tthis.getMessageHandler().showMessageDialog({ unHoldKey: messageHandlingKey });\n\t\t\tLog.error(\"Error while editing the document\", error as string);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\t}\n\n\t/**\n\t * Requests the side effects required after deleting an object.\n\t * @param listBinding The list binding the deleted object belongs to\n\t * @param parentContext The context of parent object of the deleted object\n\t */\n\tprivate requestSideEffectsOnDelete(listBinding: ODataListBinding | undefined, parentContext: Context | undefined): void {\n\t\tif (!listBinding || !parentContext || CommonUtils.hasTransientContext(listBinding)) {\n\t\t\t// if there are transient contexts, we must avoid requesting side effects\n\t\t\t// this is avoid a potential list refresh, there could be a side effect that refreshes the list binding\n\t\t\t// if list binding is refreshed, transient contexts might be lost\n\t\t\treturn;\n\t\t}\n\n\t\tconst sideEffectService = this.getAppComponent().getSideEffectsService();\n\t\tsideEffectService.requestSideEffectsForNavigationProperty(listBinding.getPath(), parentContext);\n\n\t\tconst stateMessagesPath = ModelHelper.getMessagesPath(listBinding.getModel().getMetaModel(), parentContext.getPath());\n\t\t// In case of a TreeTable, we need to refresh state messages for the ObjectPage, as some of these messages might be attached\n\t\t// to children of a deleted row which may not have been loaded yet, and therefore the model wouldn't clean up these messages\n\t\tif (stateMessagesPath && this.getTransactionHelper().isListBindingHierarchical(listBinding)) {\n\t\t\tsideEffectService.requestSideEffects([stateMessagesPath], parentContext);\n\t\t}\n\t}\n\n\t/**\n\t * Deletes several documents.\n\t * @param contextsToDelete The contexts of the documents to be deleted\n\t * @param parameters The parameters\n\t * @param parameters.beforeDeleteCallBack\n\t * @param parameters.requestSideEffects\n\t * @param parameters.controlId\n\t * @param parameters.parentControl\n\t * @param parameters.bFindActiveContexts\n\t * @param parameters.selectedContexts\n\t * @param parameters.noDialog\n\t * @returns Promise resolved once the documents are deleted\n\t */\n\tasync deleteMultipleDocuments(\n\t\tcontextsToDelete: Context[],\n\t\tparameters: {\n\t\t\tbeforeDeleteCallBack?: Function;\n\t\t\trequestSideEffects?: boolean;\n\t\t\tcontrolId: string;\n\t\t\tnoDialog?: boolean;\n\t\t\tparentControl?: Control;\n\t\t\tbFindActiveContexts?: boolean;\n\t\t\tselectedContexts?: Context[];\n\t\t}\n\t): Promise<void> {\n\t\tparameters.beforeDeleteCallBack = this.base.editFlow.onBeforeDelete;\n\t\tparameters.requestSideEffects = parameters.requestSideEffects !== false;\n\n\t\tconst lockObject = this.getGlobalUIModel();\n\t\tconst parentControl = this.getView().byId(parameters.controlId) ?? Element.getElementById(parameters.controlId);\n\t\tlet inactiveContextsToDelete: Context[] = [];\n\t\tif (parentControl?.isA<Table>(\"sap.ui.mdc.Table\")) {\n\t\t\tinactiveContextsToDelete = contextsToDelete.filter((context) => context.isInactive());\n\t\t}\n\t\tif (!parentControl) {\n\t\t\tthrow new Error(\"parameter controlId missing or incorrect\");\n\t\t} else {\n\t\t\tparameters.parentControl = parentControl as Control;\n\t\t}\n\t\tconst listBinding = (parentControl.getBinding(\"items\") || (parentControl as Table).getRowBinding()) as ODataListBinding;\n\t\tparameters.bFindActiveContexts = true;\n\t\tBusyLocker.lock(lockObject);\n\n\t\ttry {\n\t\t\tif (this.getProgrammingModel(parameters?.selectedContexts?.[0] ?? contextsToDelete[0]) === ProgrammingModel.Sticky) {\n\t\t\t\tthis.setDocumentModified(true);\n\t\t\t}\n\t\t\tawait this.deleteDocumentTransaction(contextsToDelete, parameters);\n\n\t\t\tlet result;\n\n\t\t\t// Multiple object deletion is triggered from a list\n\t\t\t// First clear the selection in the table as it's not valid any more\n\t\t\tif (parentControl.isA<Table>(\"sap.ui.mdc.Table\")) {\n\t\t\t\tparentControl.clearSelection();\n\t\t\t}\n\n\t\t\t// Then refresh the list-binding (LR), or require side-effects (OP)\n\t\t\tconst viewBindingContext = this.getView().getBindingContext() as Context;\n\t\t\tif (listBinding.isRoot()) {\n\t\t\t\t// keep promise chain pending until refresh of listbinding is completed\n\t\t\t\tresult = this.getTransactionHelper().refreshListBinding(listBinding, this.getAppComponent());\n\t\t\t} else if (parameters.requestSideEffects) {\n\t\t\t\tthis.requestSideEffectsOnDelete(listBinding, viewBindingContext);\n\t\t\t}\n\n\t\t\t// deleting at least one object should also set the UI to dirty\n\t\t\tif (!this.getAppComponent()._isFclEnabled()) {\n\t\t\t\tEditState.setEditStateDirty();\n\t\t\t}\n\t\t\tconst isRecommendationEnabled = this.base.recommendations.isRecommendationEnabled();\n\t\t\t// We clear recommendation data and contexts from internal model for the deleted contexts\n\t\t\tif (isRecommendationEnabled) {\n\t\t\t\tthis.base.recommendations.ignoreRecommendationForContexts(contextsToDelete);\n\t\t\t}\n\t\t\t// Notify consumers of which contexts were deleted\n\t\t\tawait this.base.editFlow.onAfterDelete({ contexts: contextsToDelete });\n\n\t\t\tif (parentControl.isA<Table>(\"sap.ui.mdc.Table\")) {\n\t\t\t\tconst tableAPI = parentControl.getParent() as TableAPI;\n\t\t\t\tif (\n\t\t\t\t\ttableAPI?.tableDefinition?.control?.creationMode === CreationMode.InlineCreationRows &&\n\t\t\t\t\tinactiveContextsToDelete.length > 0\n\t\t\t\t) {\n\t\t\t\t\ttableAPI.removeEmptyRowsMessages(inactiveContextsToDelete);\n\t\t\t\t\tawait tableAPI.setUpEmptyRows(parentControl, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._sendActivity(Activity.Delete, contextsToDelete);\n\n\t\t\treturn await result;\n\t\t} catch (error: unknown) {\n\t\t\t// We still want to refresh the listbinding in case we deleted some information but not everything (Drafts for example)\n\t\t\tif (listBinding.isRoot()) {\n\t\t\t\t// keep promise chain pending until refresh of listbinding is completed\n\t\t\t\tawait this.getTransactionHelper().refreshListBinding(listBinding, this.getAppComponent());\n\t\t\t} else if (parameters.requestSideEffects) {\n\t\t\t\tconst viewBindingContext = this.getView().getBindingContext() as Context;\n\t\t\t\tthis.requestSideEffectsOnDelete(listBinding, viewBindingContext);\n\t\t\t}\n\t\t\tLog.error(\"Error while deleting the document(s)\", error as string);\n\t\t} finally {\n\t\t\tBusyLocker.unlock(lockObject);\n\t\t}\n\t}\n\n\t/**\n\t * Updates the draft status and displays the error messages if there are errors during an update.\n\t * @param updatedContext Context of the updated field\n\t * @param updatePromise Promise to determine when the update operation is completed. The promise should be resolved when the update operation is completed, so the draft status can be updated.\n\t * @returns Promise resolves once draft status has been updated\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync updateDocument(updatedContext: Binding | Context, updatePromise: Promise<unknown>): Promise<void> {\n\t\tconst originalBindingContext = this.getView().getBindingContext();\n\t\tconst isDraft = this.getProgrammingModel(updatedContext) === ProgrammingModel.Draft;\n\n\t\tthis.getMessageHandler().removeTransitionMessages();\n\t\tconst messageHandlingKey = this.getMessageHandler().registerToHoldMessages();\n\t\treturn this.syncTask(async () => {\n\t\t\tif (originalBindingContext) {\n\t\t\t\tthis.setDocumentModified(true);\n\t\t\t\tif (!this._isFclEnabled()) {\n\t\t\t\t\tEditState.setEditStateDirty();\n\t\t\t\t}\n\n\t\t\t\tif (isDraft) {\n\t\t\t\t\tthis.setDraftStatus(DraftStatus.Saving);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait updatePromise;\n\t\t\t\tconst currentBindingContext = this.getView().getBindingContext() as ODataV4Context | null | undefined;\n\t\t\t\tif (!isDraft || !currentBindingContext || currentBindingContext !== originalBindingContext) {\n\t\t\t\t\t// If a navigation happened while oPromise was being resolved, the binding context of the page changed\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// We're still on the same context\n\t\t\t\tconst metaModel = currentBindingContext.getModel().getMetaModel();\n\t\t\t\tconst entitySetName = metaModel.getMetaContext(currentBindingContext.getPath()).getObject(\"@sapui.name\");\n\t\t\t\tconst semanticKeys = SemanticKeyHelper.getSemanticKeys(metaModel, entitySetName);\n\t\t\t\tif (\n\t\t\t\t\tsemanticKeys?.length &&\n\t\t\t\t\tcurrentBindingContext.getProperty(\"IsActiveEntity\") === false && // We don't use the semantic key for a new document (creation)\n\t\t\t\t\tcurrentBindingContext.getProperty(\"HasActiveEntity\") === true\n\t\t\t\t) {\n\t\t\t\t\tconst currentSemanticMapping = this._getSemanticMapping();\n\t\t\t\t\tconst currentSemanticPath = currentSemanticMapping?.semanticPath,\n\t\t\t\t\t\tsChangedPath = SemanticKeyHelper.getSemanticPath(currentBindingContext, true);\n\t\t\t\t\t// currentSemanticPath could be null if we have navigated via deep link then there are no semanticMappings to calculate it from\n\t\t\t\t\tif (currentSemanticPath && currentSemanticPath !== sChangedPath) {\n\t\t\t\t\t\tawait this._handleNewContext(currentBindingContext, { editable: true, recreateContext: false });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.setDraftStatus(DraftStatus.Saved);\n\t\t\t} catch (error: unknown) {\n\t\t\t\tLog.error(\"Error while updating the document\", error as string);\n\t\t\t\tif (isDraft && originalBindingContext) {\n\t\t\t\t\tthis.setDraftStatus(DraftStatus.Clear);\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tawait this.getMessageHandler().showMessages({ unHoldKey: messageHandlingKey });\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate getParentContextFromSelection(selectedContexts: ODataV4Context[] | undefined): ODataV4Context | undefined {\n\t\tif (selectedContexts && selectedContexts.length > 1) {\n\t\t\t// One parent at most !!\n\t\t\tthrow new Error(`Cannot create a new document in a TreeTable with ${selectedContexts.length} parents`);\n\t\t}\n\n\t\treturn selectedContexts?.length === 1 ? selectedContexts[0] : undefined;\n\t}\n\n\t// Internal only params ---\n\t// * @param {string} mParameters.creationMode The creation mode using one of the following:\n\t// *                    Sync - the creation is triggered and once the document is created, the navigation is done\n\t// *                    Async - the creation and the navigation to the instance are done in parallel\n\t// *                    Deferred - the creation is done on the target page\n\t// *                    CreationRow - The creation is done inline async so the user is not blocked\n\t// mParameters.creationRow Instance of the creation row - (TODO: get rid but use list bindings only)\n\n\t/**\n\t * Creates a new document.\n\t * @param source  ODataListBinding object or the binding path or a table building block for a temporary list binding\n\t * @param mInParameters Contains the following attributes:\n\t * @param mInParameters.creationMode The creation mode using one of the following:<br/>\n\t *                    NewPage - the created document is shown in a new page, depending on whether metadata 'Sync', 'Async', or 'Deferred' is used<br/>\n\t *                    Inline - The creation is done inline (in a table)<br/>\n\t *                    External - The creation is done in a different application specified by the parameter 'outbound'<br/>\n\t *                    CreationDialog - the creation is done in the table, with a dialog allowing to specify some initial property values (the properties are listed in `creationDialogFields`)\n\t * @param mInParameters.tableId ID of the table\n\t * @param mInParameters.outbound The navigation target where the document is created in case of creationMode 'External'\n\t * @param mInParameters.createAtEnd Specifies if the new entry should be created at the top or bottom of a table in case of creationMode 'Inline'\n\t * @param mInParameters.data The initial data for the created document\n\t * @param mInParameters.beforeCreateCallBack PRIVATE\n\t * @param mInParameters.bFromDeferred PRIVATE\n\t * @param mInParameters.busyMode PRIVATE\n\t * @param mInParameters.createAction PRIVATE\n\t * @param mInParameters.creationRow PRIVATE\n\t * @param mInParameters.skipParameterDialog PRIVATE\n\t * @param mInParameters.skipSideEffects PRIVATE\n\t * @param mInParameters.selectedContexts The contexts that are selected in the table initiating the creation. Used in case of a TreeTable to determine the parent context of the created document\n\t * @param mInParameters.singleDraftForCreate When enabled, an extra request checks if any drafts exist that were never saved. If unsaved drafts are found, the newest one is opened. If no unsaved drafts are found, a new entity is created\n\t * @param mInParameters.creationDialogFields Defines the list of properties that are displayed in the creation dialog when the creation mode is set to 'CreationDialog'.<br/>The value is a comma-separated list of property names\n\t * @returns Promise resolves once the object has been created\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync createDocument(\n\t\tsource: ODataListBinding | string | MacroTable,\n\t\tmInParameters: {\n\t\t\tbeforeCreateCallBack?: Function;\n\t\t\tbFromDeferred?: boolean;\n\t\t\tbusyMode?: string;\n\t\t\tcreateAction?: boolean;\n\t\t\tcreateAtEnd?: boolean;\n\t\t\tcreationMode: string;\n\t\t\tcreationRow?: CreationRow;\n\t\t\tdata?: object;\n\t\t\ttableId?: string;\n\t\t\toutbound?: string;\n\t\t\tskipParameterDialog?: boolean;\n\t\t\tskipSideEffects?: boolean;\n\t\t\tselectedContexts?: ODataV4Context[];\n\t\t\tsingleDraftForCreate?: boolean;\n\t\t\tcreationDialogFields?: string[];\n\t\t}\n\t): Promise<void> {\n\t\tlet oDataListBinding!: ODataListBinding;\n\t\tlet parentContext: ODataV4Context | undefined;\n\n\t\tconst fnListBinding = function (instance: EditFlow, listBindingPath: string): ODataListBinding | undefined {\n\t\t\tconst dataModel = instance.getView().getModel();\n\t\t\tif (!dataModel) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn dataModel.bindList(listBindingPath) as ODataListBinding;\n\t\t};\n\n\t\tif (typeof source === \"object\" && source.isA && source.isA<IRowBindingInterface>(\"sap.fe.core.IRowBindingInterface\")) {\n\t\t\toDataListBinding = source.getRowBinding();\n\t\t\tsource = oDataListBinding;\n\t\t}\n\n\t\tif (mInParameters.creationMode !== CreationMode.External) {\n\t\t\tif (typeof source === \"string\") {\n\t\t\t\tconst listBindingFromPath = fnListBinding(this, source);\n\t\t\t\tif (!listBindingFromPath) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\toDataListBinding = listBindingFromPath;\n\t\t\t\t}\n\t\t\t\tdelete mInParameters.createAtEnd;\n\t\t\t} else if (typeof source === \"object\" && source.isA && source.isA<ODataListBinding>(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\t\toDataListBinding = source;\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Binding object or path expected\");\n\t\t\t}\n\n\t\t\tif (this.getTransactionHelper().isListBindingHierarchical(oDataListBinding)) {\n\t\t\t\tparentContext = this.getParentContextFromSelection(mInParameters.selectedContexts);\n\t\t\t}\n\t\t}\n\n\t\tconst resolvedCreationMode = this.resolveCreationMode(mInParameters.creationMode, oDataListBinding, mInParameters.data);\n\n\t\tthis.getAppComponent().getRouterProxy().removeIAppStateKey();\n\n\t\tif (\n\t\t\t(mInParameters.singleDraftForCreate !== undefined\n\t\t\t\t? mInParameters.singleDraftForCreate\n\t\t\t\t: this.getAppComponent().getManifest()[\"sap.fe\"]?.app?.singleDraftForCreate) &&\n\t\t\toDataListBinding === oDataListBinding.getRootBinding() &&\n\t\t\toDataListBinding.getHeaderContext() !== null\n\t\t) {\n\t\t\tconst newBinding = oDataListBinding.getModel()?.bindList(\n\t\t\t\toDataListBinding.getPath(),\n\t\t\t\toDataListBinding.getContext(),\n\t\t\t\tnew Sorter(\"DraftAdministrativeData/LastChangeDateTime\", true),\n\t\t\t\tnew Filter({\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"IsActiveEntity\",\n\t\t\t\t\t\t\toperator: \"EQ\",\n\t\t\t\t\t\t\tvalue1: false\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Filter({\n\t\t\t\t\t\t\tpath: \"HasActiveEntity\",\n\t\t\t\t\t\t\toperator: \"EQ\",\n\t\t\t\t\t\t\tvalue1: false\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tand: true\n\t\t\t\t})\n\t\t\t);\n\t\t\tconst result = await newBinding?.requestContexts(0, 1);\n\t\t\tif (result.length > 0) {\n\t\t\t\treturn this._handleNewContext(result[0], { editable: true, recreateContext: false }).then(() => newBinding?.destroy());\n\t\t\t}\n\t\t\tnewBinding?.destroy();\n\t\t\treturn this._handleCreationMode(\n\t\t\t\tresolvedCreationMode,\n\t\t\t\tsource as string | ODataListBinding,\n\t\t\t\tmInParameters,\n\t\t\t\toDataListBinding,\n\t\t\t\tparentContext\n\t\t\t);\n\t\t}\n\t\treturn this._handleCreationMode(\n\t\t\tresolvedCreationMode,\n\t\t\tsource as string | ODataListBinding,\n\t\t\tmInParameters,\n\t\t\toDataListBinding,\n\t\t\tparentContext\n\t\t);\n\t}\n\n\tasync _handleCreationMode(\n\t\tresolvedCreationMode: string,\n\t\tvListBinding: string | ODataListBinding,\n\t\tparameters: InternalCreateParameters,\n\t\toDataListBinding: ODataListBinding,\n\t\tparentContext: Context | undefined\n\t): Promise<void> {\n\t\tthis._updatePathsInHistory([]);\n\t\tswitch (resolvedCreationMode) {\n\t\t\tcase CreationMode.External:\n\t\t\t\treturn this.createExternalDocument(vListBinding, parameters.outbound);\n\t\t\tcase CreationMode.Deferred:\n\t\t\t\treturn this.createDeferredDocument(oDataListBinding, parentContext, parameters.data);\n\t\t\tcase CreationMode.CreationRow:\n\t\t\t\treturn parameters.creationRow\n\t\t\t\t\t? this.createCreateRowDocument({\n\t\t\t\t\t\t\tcreationRow: parameters.creationRow,\n\t\t\t\t\t\t\tskipSideEffects: parameters.skipSideEffects,\n\t\t\t\t\t\t\tcreateAtEnd: parameters.createAtEnd\n\t\t\t\t\t  })\n\t\t\t\t\t: undefined;\n\t\t\tcase CreationMode.Inline:\n\t\t\t\treturn this.createDialogInlineDocument(\n\t\t\t\t\t{\n\t\t\t\t\t\tcreationMode: CreationMode.Inline,\n\t\t\t\t\t\ttableId: parameters.tableId,\n\t\t\t\t\t\tcreateAtEnd: parameters.createAtEnd,\n\t\t\t\t\t\tskipSideEffects: parameters.skipSideEffects,\n\t\t\t\t\t\tparentContext,\n\t\t\t\t\t\tdata: parameters.data\n\t\t\t\t\t},\n\t\t\t\t\toDataListBinding\n\t\t\t\t);\n\n\t\t\tcase CreationMode.CreationDialog:\n\t\t\t\tif (oDataListBinding.isRelative()) {\n\t\t\t\t\t// Creation with dialog in an ObjectPage\n\t\t\t\t\treturn this.createDialogInlineDocument(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcreationMode: CreationMode.CreationDialog,\n\t\t\t\t\t\t\ttableId: parameters.tableId,\n\t\t\t\t\t\t\tcreateAtEnd: parameters.createAtEnd,\n\t\t\t\t\t\t\tskipSideEffects: parameters.skipSideEffects,\n\t\t\t\t\t\t\tparentContext,\n\t\t\t\t\t\t\tdata: parameters.data,\n\t\t\t\t\t\t\tcreationDialogFields: parameters.creationDialogFields\n\t\t\t\t\t\t},\n\t\t\t\t\t\toDataListBinding\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\t// Creation with dialog in a ListReport\n\t\t\t\t\treturn this.createDialogAndSaveDocument(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttableId: parameters.tableId,\n\t\t\t\t\t\t\tcreateAtEnd: parameters.createAtEnd,\n\t\t\t\t\t\t\tskipSideEffects: parameters.skipSideEffects,\n\t\t\t\t\t\t\tparentContext,\n\t\t\t\t\t\t\tdata: parameters.data,\n\t\t\t\t\t\t\tcreationDialogFields: parameters.creationDialogFields\n\t\t\t\t\t\t},\n\t\t\t\t\t\toDataListBinding\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\tcase CreationMode.Sync:\n\t\t\tcase CreationMode.Async:\n\t\t\t\treturn this.createSyncAsyncDocument(\n\t\t\t\t\t{\n\t\t\t\t\t\tcreationMode: resolvedCreationMode,\n\t\t\t\t\t\tdata: parameters.data as Record<string, unknown>,\n\t\t\t\t\t\tbFromDeferred: parameters.bFromDeferred,\n\t\t\t\t\t\tskipSideEffects: parameters.skipSideEffects,\n\t\t\t\t\t\tcreateAction: parameters.createAction,\n\t\t\t\t\t\tparentContext\n\t\t\t\t\t},\n\t\t\t\t\toDataListBinding\n\t\t\t\t);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unhandled creationMode ${resolvedCreationMode}`);\n\t\t}\n\t}\n\n\t/**\n\t *Executes the mandatory configuration after the document has been created.\n\t * @param prerequisite Promise of the document creation and the following navigation\n\t * @param listBinding ODataListBinding where the document is created\n\t * @returns Promise resolves once the configuration is done\n\t */\n\tasync postDocumentCreation(prerequisite: Promise<[Context, unknown]>, listBinding: ODataListBinding): Promise<void> {\n\t\tconst programmingModel: string = this.getProgrammingModel(listBinding);\n\t\tconst model = listBinding.getModel();\n\t\tconst params = await prerequisite;\n\t\tconst newDocumentContext = params[0];\n\t\tthis._setStickySessionInternalProperties(programmingModel, model);\n\t\tawait this.base.editFlow.onAfterCreate({ context: newDocumentContext });\n\t\tthis.setEditMode(EditMode.Editable); // The createMode flag will be set in computeModelsForEditMode\n\t\tif (!listBinding.isRelative()) {\n\t\t\tif (programmingModel === ProgrammingModel.Sticky) {\n\t\t\t\t// Workaround to tell the OP that we've created a new object from the LR\n\t\t\t\tconst metaContext = model.getMetaModel().getMetaContext(listBinding.getPath());\n\t\t\t\tconst entitySet = getInvolvedDataModelObjects(metaContext).startingEntitySet as EntitySet;\n\t\t\t\tconst newAction = entitySet?.annotations.Session?.StickySessionSupported?.NewAction;\n\t\t\t\tthis.getInternalModel().setProperty(\"/lastInvokedAction\", newAction);\n\t\t\t} else if (\n\t\t\t\tthis.getTransactionHelper().isListBindingHierarchical(listBinding) ||\n\t\t\t\tthis.getTransactionHelper().isListBindingAnalytical(listBinding)\n\t\t\t) {\n\t\t\t\t// Creating a new item in a hierarchy/analytical table from the ListReport (since the listBinding is not relative)\n\t\t\t\t// --> we want to force the user to either save or discard the draft before leaving the OP\n\t\t\t\tthis.forceDraftSaveOrDiscard(true);\n\t\t\t}\n\t\t}\n\t\tif (newDocumentContext) {\n\t\t\tthis.setDocumentModifiedOnCreate(listBinding);\n\t\t\tif (!this._isFclEnabled()) {\n\t\t\t\tEditState.setEditStateDirty();\n\t\t\t}\n\t\t\tthis._sendActivity(Activity.Create, newDocumentContext);\n\t\t\tif (\n\t\t\t\tModelHelper.isCollaborationDraftSupported(model.getMetaModel()) &&\n\t\t\t\tthis.isDraftRoot(newDocumentContext) &&\n\t\t\t\t!this.base.collaborativeDraft.isConnected()\n\t\t\t) {\n\t\t\t\t// the share action will be execued later as soon  as the page is bound\n\t\t\t\tthis.getInternalModel().setProperty(\"/executeShareActionForCollaboration\", true);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Creates a new document via the creationRow.\n\t * @param parameters Contains the following attributes:\n\t * @param parameters.createAtEnd The new document is created at the end.\n\t * @param parameters.creationRow The creation row\n\t * @param parameters.skipSideEffects The sideEffects are requested\n\t * @returns Promise resolves once the document has been created\n\t */\n\tasync createCreateRowDocument(parameters: {\n\t\tcreateAtEnd?: boolean;\n\t\tcreationRow: CreationRow;\n\t\tskipSideEffects?: boolean;\n\t}): Promise<void> {\n\t\tlet creation: Promise<Context>;\n\t\tconst appComponent = this.getAppComponent();\n\t\tconst creationRow = parameters.creationRow;\n\t\tconst table = parameters.creationRow.getParent() as Table | undefined;\n\t\tlet navigation = Promise.resolve();\n\t\tif (!table) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst metaModel = table.getModel()?.getMetaModel() as ODataMetaModel;\n\t\tconst listBinding = table.getRowBinding();\n\t\tif (this.getTransactionHelper().isListBindingHierarchical(listBinding)) {\n\t\t\tthrow new Error(`Unhandled creationMode \"CreationRow\" with a TreeTable`);\n\t\t}\n\t\tconst creationRowContext = creationRow.getBindingContext() as Context;\n\t\tconst documentValidation = this.getCreationRowValidationFunction(table);\n\t\t// disableAddRowButtonForEmptyData is set to false in manifest converter (Table.ts) if customValidationFunction exists\n\t\tif (creationRow.data(\"disableAddRowButtonForEmptyData\") === \"true\") {\n\t\t\ttable.getBindingContext(\"internal\")?.setProperty(\"creationRowFieldValidity\", {});\n\t\t}\n\n\t\tconst validationMessages = await this.syncTask(documentValidation);\n\t\tif (validationMessages.length > 0) {\n\t\t\tthis.createCustomValidationMessages(validationMessages, table);\n\t\t\tLog.error(\"Custom Validation failed\");\n\t\t\t// if custom validation fails, we leave the method immediately\n\t\t\treturn;\n\t\t}\n\t\tconst entityType = getInvolvedDataModelObjects(metaModel.getMetaContext(creationRowContext.getPath())).targetEntityType;\n\t\tconst creationRowPayload = creationRowContext.getObject();\n\n\t\tawait this._checkForValidationErrors();\n\n\t\t//moved after _checkForValidationErrors to avoid \"'creation' use before initialization\" console errors\n\t\t//after validation errors occurred\n\t\tlistBinding.attachEventOnce(\"change\", async () => {\n\t\t\tawait creation;\n\t\t\ttable.scrollToIndex(parameters.createAtEnd ? table.getRowBinding().getLength() : 0);\n\t\t});\n\n\t\t// take care on message handling, draft indicator (in case of draft)\n\t\t// Attach the create sent and create completed event to the object page binding so that we can react\n\t\tthis.handleCreateEvents(listBinding);\n\t\ttry {\n\t\t\tcreation = this.getTransactionHelper().createDocument(\n\t\t\t\tlistBinding,\n\t\t\t\t{\n\t\t\t\t\tdata: Object.assign(\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t...Object.keys(creationRowPayload)\n\t\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t\t(propertyPath: string) =>\n\t\t\t\t\t\t\t\t\tentityType.navigationProperties.findIndex((property) => property.name === propertyPath) === -1\n\t\t\t\t\t\t\t) // ensure navigation properties are not part of the payload, deep create not supported\n\t\t\t\t\t\t\t.map((path) => ({ [path]: creationRowPayload[path] }))\n\t\t\t\t\t),\n\t\t\t\t\tkeepTransientContextOnFailed: false, // currently not fully supported\n\t\t\t\t\tbusyMode: \"Local\", // busy handling shall be done locally only\n\t\t\t\t\tbusyId: (table?.getParent() as TableAPI | undefined)?.getTableDefinition()?.annotation.id,\n\t\t\t\t\tparentControl: this.getView(),\n\t\t\t\t\tbeforeCreateCallBack: this.base.editFlow.onBeforeCreate,\n\t\t\t\t\tskipParameterDialog: appComponent.getStartupMode() === StartupMode.AutoCreate, // In case the application was called with preferredMode=autoCreateWith, we want to skip the action parameter dialog\n\t\t\t\t\tcreateAtEnd: parameters.createAtEnd,\n\t\t\t\t\tcreationMode: CreationMode.CreationRow\n\t\t\t\t},\n\t\t\t\tappComponent,\n\t\t\t\tthis._getResourceModel(),\n\t\t\t\tthis.getMessageHandler(),\n\t\t\t\tfalse\n\t\t\t);\n\t\t\t// SideEffects on Create\n\t\t\t// if Save is pressed directly after filling the CreationRow, no SideEffects request\n\t\t\tif (!parameters.skipSideEffects) {\n\t\t\t\tthis.handleSideEffects(listBinding, creation);\n\t\t\t}\n\n\t\t\tawait creation;\n\t\t\tconst creationRowListBinding = creationRowContext.getBinding() as ODataListBinding;\n\t\t\tconst newTransientContext = creationRowListBinding.create();\n\t\t\tcreationRow.setBindingContext(newTransientContext);\n\n\t\t\t// this is needed to avoid console errors TO be checked with model colleagues\n\t\t\tnewTransientContext.created()?.catch(() => {\n\t\t\t\tLog.trace(\"transient fast creation context deleted\");\n\t\t\t});\n\t\t\tnavigation = creationRowContext.delete(\"$direct\");\n\t\t\treturn await this.postDocumentCreation(Promise.all([creation, navigation]), listBinding);\n\t\t} catch (error: unknown) {\n\t\t\t// Reset busy indicator after a validation error\n\t\t\tif (BusyLocker.isLocked(this.base.getView().getModel(\"ui\"))) {\n\t\t\t\tBusyLocker.unlock(this.base.getView().getModel(\"ui\"));\n\t\t\t}\n\t\t\tLog.error(\"CreationRow navigation error: \", error as string);\n\t\t}\n\t}\n\n\t/**\n\t * Creates a new document in Inline mode or with a creation inline dialog (Object page case).\n\t * @param parameters Contains the following attributes:\n\t * @param parameters.creationMode\n\t * @param parameters.createAtEnd The new document is created at the end\n\t * @param parameters.skipSideEffects The sideEffects are requested\n\t * @param parameters.tableId The id of the table\n\t * @param parameters.parentContext Parent context (for TreeTable)\n\t * @param parameters.data Intial data for creation\n\t * @param parameters.creationDialogFields Fields to be displayed in the creation dialog\n\t * @param listBinding ODataListBinding where the document is created\n\t * @returns Promise resolves once the document has been created\n\t */\n\tasync createDialogInlineDocument(\n\t\tparameters: {\n\t\t\tcreationMode: CreationMode.Inline | CreationMode.CreationDialog;\n\t\t\tcreateAtEnd?: boolean;\n\t\t\tskipSideEffects?: boolean;\n\t\t\ttableId?: string;\n\t\t\tparentContext?: ODataV4Context;\n\t\t\tdata?: object;\n\t\t\tcreationDialogFields?: string[];\n\t\t},\n\t\tlistBinding: ODataListBinding\n\t): Promise<void> {\n\t\tlet table: Table | undefined;\n\t\tif (parameters.tableId) {\n\t\t\ttable = this.getView().byId(parameters.tableId) as Table;\n\t\t}\n\t\tif (table?.isA<Table>(\"sap.ui.mdc.Table\")) {\n\t\t\ttable.getRowBinding().attachEventOnce(\"createCompleted\", async () => {\n\t\t\t\tconst newContext = await creation;\n\t\t\t\tconst contextIndex = newContext.getIndex();\n\t\t\t\tconst aggregationData = listBinding.getAggregation() as { createInPlace?: boolean } | undefined;\n\t\t\t\tconst isCreateInPlace = aggregationData?.createInPlace ?? false;\n\n\t\t\t\tif (contextIndex !== undefined && contextIndex >= 0) {\n\t\t\t\t\ttable?.focusRow(contextIndex, true);\n\t\t\t\t} else if (isCreateInPlace) {\n\t\t\t\t\t// For create in-place mode (server position), display a warning message in case the newly created node isn't visible\n\t\t\t\t\tMessageToast.show(this._getResourceModel().getText(\"C_NEW_ELEMENT_NOT_DISPLAYED\"));\n\t\t\t\t}\n\n\t\t\t\tif (this.getTransactionHelper().isListBindingHierarchical(listBinding) && !isCreateInPlace) {\n\t\t\t\t\t// In case of a tree table, we also scroll to keep the parent visible\n\t\t\t\t\tconst parentContext = newContext.getParent();\n\t\t\t\t\tconst parentIndex = parentContext?.getIndex();\n\t\t\t\t\tif (parentIndex !== undefined && parentIndex >= 0) {\n\t\t\t\t\t\ttable?.scrollToIndex(parentIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// take care on message handling, draft indicator (in case of draft)\n\t\t// Attach the create sent and create completed event to the object page binding so that we can react\n\t\tthis.handleCreateEvents(listBinding);\n\t\tconst creation = this.getTransactionHelper().createDocument(\n\t\t\tlistBinding,\n\t\t\t{\n\t\t\t\t//Check if All parameters are needed\n\t\t\t\tkeepTransientContextOnFailed: false, // currently not fully supported\n\t\t\t\tbusyMode: \"Local\", // busy handling shall be done locally only\n\t\t\t\tbusyId: (table?.getParent() as TableAPI | undefined)?.getTableDefinition()?.annotation.id,\n\t\t\t\tparentControl: this.getView(),\n\t\t\t\tbeforeCreateCallBack: this.base.editFlow.onBeforeCreate,\n\t\t\t\tskipParameterDialog: this.getAppComponent().getStartupMode() === StartupMode.AutoCreate, // In case the application was called with preferredMode=autoCreateWith, we want to skip the action parameter dialog\n\t\t\t\tcreateAtEnd: parameters.createAtEnd,\n\t\t\t\tcreationMode: parameters.creationMode,\n\t\t\t\tparentContext: parameters.parentContext,\n\t\t\t\tdata: parameters.data as Record<string, unknown>,\n\t\t\t\tcreationDialogFields: parameters.creationDialogFields\n\t\t\t},\n\t\t\tthis.getAppComponent(),\n\t\t\tthis._getResourceModel(),\n\t\t\tthis.getMessageHandler(),\n\t\t\tfalse\n\t\t);\n\n\t\tif (!parameters.skipSideEffects) {\n\t\t\tthis.handleSideEffects(listBinding, creation);\n\t\t}\n\t\treturn this.postDocumentCreation(Promise.all([creation, this.syncTask(creation)]), listBinding);\n\t}\n\n\t/**\n\t * Creates a new document via a dialog and saves it immediately (ListReport case).\n\t * @param parameters Contains the following attributes:\n\t * @param parameters.createAtEnd The new document is created at the end\n\t * @param parameters.skipSideEffects The sideEffects are requested\n\t * @param parameters.tableId The id of the table\n\t * @param parameters.parentContext Parent context (for TreeTable)\n\t * @param parameters.data Intial data for creation\n\t * @param parameters.creationDialogFields Fields to be displayed in the creation dialog\n\t * @param listBinding ODataListBinding where the document is created\n\t * @returns Promise resolves once the document has been created\n\t */\n\tasync createDialogAndSaveDocument(\n\t\tparameters: {\n\t\t\tcreateAtEnd?: boolean;\n\t\t\tskipSideEffects?: boolean;\n\t\t\ttableId?: string;\n\t\t\tparentContext?: ODataV4Context;\n\t\t\tdata?: object;\n\t\t\tcreationDialogFields?: string[];\n\t\t},\n\t\tlistBinding: ODataListBinding\n\t): Promise<void> {\n\t\tlet table: Table | undefined;\n\t\tif (parameters.tableId) {\n\t\t\ttable = this.getView().byId(parameters.tableId) as Table | undefined;\n\t\t\tif (table?.isA<Table>(\"sap.ui.mdc.Table\") !== true) {\n\t\t\t\ttable = undefined;\n\t\t\t}\n\t\t}\n\n\t\tlet savedDocumentContext: ODataV4Context | undefined;\n\n\t\tconst afterCreateInDialog = async (newDocumentContext: ODataV4Context): Promise<void> => {\n\t\t\ttry {\n\t\t\t\tawait this.base.editFlow.onAfterCreate({ context: newDocumentContext });\n\t\t\t} catch (error) {\n\t\t\t\t// Errors in onAfterCreate are not causing the overall flow to fail\n\t\t\t\tLog.error(\"Error after creation: \" + error);\n\t\t\t}\n\n\t\t\tawait this.base.editFlow.onBeforeSave({ context: newDocumentContext });\n\t\t\tsavedDocumentContext = await this.getTransactionHelper().saveDocument(\n\t\t\t\tnewDocumentContext,\n\t\t\t\tthis.getAppComponent(),\n\t\t\t\tthis._getResourceModel(),\n\t\t\t\tfalse,\n\t\t\t\t[],\n\t\t\t\tthis.getMessageHandler(),\n\t\t\t\ttrue,\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\ttry {\n\t\t\t\tawait this.base.editFlow.onAfterSave({\n\t\t\t\t\tcontext: savedDocumentContext\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\t// Errors in onAfterSave are not causing the overall flow to fail\n\t\t\t\tLog.error(\"Error after save: \" + error);\n\t\t\t}\n\n\t\t\tif (this.getTransactionHelper().isListBindingHierarchical(listBinding)) {\n\t\t\t\t// In case of a TreeTable, we don't use the listBinding from the ListReport to create the new item,\n\t\t\t\t// So we can't know the position of the new item in the listBinding\n\t\t\t\t// --> We refresh the table and scroll to the parent position\n\t\t\t\tconst tableAPI = table?.getParent() as TableAPI | undefined;\n\t\t\t\tif (tableAPI) {\n\t\t\t\t\tconst parentIndex = parameters.parentContext?.getIndex();\n\t\t\t\t\ttableAPI.refresh();\n\t\t\t\t\tif (parentIndex !== undefined && parentIndex >= 0) {\n\t\t\t\t\t\ttable?.scrollToIndex(parentIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// In case of a flat table, we can scroll to the newly created item\n\t\t\t\tconst itemIndex = savedDocumentContext.getIndex();\n\t\t\t\tif (itemIndex !== undefined && itemIndex >= 0) {\n\t\t\t\t\ttable?.scrollToIndex(itemIndex);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst creation = this.getTransactionHelper().createDocument(\n\t\t\tlistBinding,\n\t\t\t{\n\t\t\t\t//Check if All parameters are needed\n\t\t\t\tkeepTransientContextOnFailed: false, // currently not fully supported\n\t\t\t\tbusyMode: \"Local\", // busy handling shall be done locally only\n\t\t\t\tbusyId: (table?.getParent() as TableAPI | undefined)?.getTableDefinition()?.annotation.id,\n\t\t\t\tparentControl: this.getView(),\n\t\t\t\tbeforeCreateCallBack: this.base.editFlow.onBeforeCreate,\n\t\t\t\tafterCreateCallBack: afterCreateInDialog,\n\t\t\t\tskipParameterDialog: this.getAppComponent().getStartupMode() === StartupMode.AutoCreate, // In case the application was called with preferredMode=autoCreateWith, we want to skip the action parameter dialog\n\t\t\t\tcreateAtEnd: parameters.createAtEnd,\n\t\t\t\tcreationMode: CreationMode.CreationDialog,\n\t\t\t\tparentContext: parameters.parentContext,\n\t\t\t\tdata: parameters.data as Record<string, unknown>,\n\t\t\t\tcreationDialogFields: parameters.creationDialogFields\n\t\t\t},\n\t\t\tthis.getAppComponent(),\n\t\t\tthis._getResourceModel(),\n\t\t\tthis.getMessageHandler(),\n\t\t\tfalse\n\t\t);\n\n\t\tawait Promise.all([creation, this.syncTask(creation)]);\n\t\tif (savedDocumentContext && parameters.skipSideEffects !== true) {\n\t\t\tthis.getAppComponent()\n\t\t\t\t.getSideEffectsService()\n\t\t\t\t.requestSideEffectsForNavigationProperty(listBinding.getPath(), savedDocumentContext);\n\t\t}\n\t}\n\n\t/**\n\t * Creates a deffered document.\n\t * @param listBinding ODataListBinding where the document has to be created\n\t * @param parentContext Optional parent context when creating a node in TreeTable\n\t * @param data\n\t * @returns Promise resolves once the navigation is done\n\t */\n\tasync createDeferredDocument(listBinding: ODataListBinding, parentContext?: ODataV4Context, data?: object): Promise<void> {\n\t\tconst lockObject = this.getGlobalUIModel();\n\t\tBusyLocker.lock(lockObject);\n\t\tawait this.getInternalRouting().navigateForwardToContext(listBinding, {\n\t\t\tcreateOnNavigateParameters: { mode: \"Deferred\", parentContext, listBinding, data },\n\t\t\teditable: true,\n\t\t\tforceFocus: true\n\t\t});\n\t\tBusyLocker.unlock(lockObject);\n\t}\n\n\t/**\n\t * Creates a sync or async document.\n\t * @param parameters Contains the following attributes:\n\t * @param parameters.creationMode The sync or async creation mode\n\t * @param parameters.bFromDeferred This document is created after a deffered creation\n\t * @param parameters.createAction  The create has been triggered by a create action\n\t * @param parameters.data  Data to save on the new document\n\t * @param parameters.skipSideEffects The sideEffects are requested\n\t * @param parameters.parentContext\n\t * @param listBinding ODataListBinding where the document is created\n\t * @returns Promise resolves once the document has been created\n\t */\n\tasync createSyncAsyncDocument(\n\t\tparameters: {\n\t\t\tcreationMode: string;\n\t\t\tbFromDeferred?: boolean;\n\t\t\tcreateAction?: boolean;\n\t\t\tdata?: Record<string, unknown>;\n\t\t\tskipSideEffects?: boolean;\n\t\t\tparentContext?: ODataV4Context;\n\t\t},\n\t\tlistBinding: ODataListBinding\n\t): Promise<void> {\n\t\tlet navigation: Promise<unknown> | undefined;\n\t\tconst lockObject = this.getGlobalUIModel();\n\t\tconst routingListener = this.getInternalRouting();\n\t\tBusyLocker.lock(lockObject);\n\n\t\tconst creation = this.getTransactionHelper()\n\t\t\t.createDocument(\n\t\t\t\tlistBinding,\n\t\t\t\t{\n\t\t\t\t\t...parameters,\n\t\t\t\t\t...{\n\t\t\t\t\t\tparentControl: this.getView(),\n\t\t\t\t\t\tbeforeCreateCallBack: this.base.editFlow.onBeforeCreate,\n\t\t\t\t\t\tskipParameterDialog: this.getAppComponent().getStartupMode() === StartupMode.AutoCreate // In case the application was called with preferredMode=autoCreateWith, we want to skip the action parameter dialog\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tthis.getAppComponent(),\n\t\t\t\tthis._getResourceModel(),\n\t\t\t\tthis.getMessageHandler(),\n\t\t\t\tfalse\n\t\t\t)\n\t\t\t.then((newDocumentContext) => {\n\t\t\t\tif (this._isFclEnabled() && newDocumentContext && newDocumentContext.getBinding() !== listBinding) {\n\t\t\t\t\t// In FCL case, if the new context has been created with an action (not with the standard POST create), we need to refresh\n\t\t\t\t\t// the original listBinding so that it contains the newly created object (this is done automatically by the listBinding for standard create)\n\t\t\t\t\tlistBinding.refresh();\n\t\t\t\t}\n\n\t\t\t\treturn newDocumentContext;\n\t\t\t});\n\n\t\t// Don't do this if the invocation comes from a deferred creation or if Save is pressed directly after filling the CreationRow\n\t\tif (parameters.bFromDeferred !== true && !parameters.skipSideEffects) {\n\t\t\tthis.handleSideEffects(listBinding, creation);\n\t\t}\n\n\t\tif (parameters.creationMode === CreationMode.Async) {\n\t\t\tnavigation = routingListener.navigateForwardToContext(listBinding, {\n\t\t\t\tcreateOnNavigateParameters: { mode: \"Async\", createContextPromise: creation },\n\t\t\t\teditable: true,\n\t\t\t\tforceFocus: true\n\t\t\t});\n\t\t} else {\n\t\t\tnavigation = creation.then(async (newDocumentContext) => {\n\t\t\t\tif (!newDocumentContext) {\n\t\t\t\t\tconst coreResourceBundle = Library.getResourceBundleFor(\"sap.fe.core\")!;\n\t\t\t\t\treturn routingListener.navigateToMessagePage(coreResourceBundle.getText(\"C_COMMON_SAPFE_DATA_RECEIVED_ERROR\"), {\n\t\t\t\t\t\ttitle: coreResourceBundle.getText(\"C_COMMON_SAPFE_ERROR\"),\n\t\t\t\t\t\tdescription: coreResourceBundle.getText(\"C_EDITFLOW_SAPFE_CREATION_FAILED_DESCRIPTION\")\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t// In case the Sync creation was triggered for a deferred creation, we don't navigate forward\n\t\t\t\t\t// as we're already on the corresponding ObjectPage\n\t\t\t\t\tconst navParameters: RoutingNavigationParameters = {\n\t\t\t\t\t\teditable: true,\n\t\t\t\t\t\tforceFocus: true,\n\t\t\t\t\t\ttransient:\n\t\t\t\t\t\t\tthis.getProgrammingModel(listBinding) == ProgrammingModel.Sticky || parameters.createAction ? true : undefined\n\t\t\t\t\t};\n\n\t\t\t\t\treturn parameters.bFromDeferred\n\t\t\t\t\t\t? routingListener.navigateToContext(newDocumentContext, navParameters)\n\t\t\t\t\t\t: routingListener.navigateForwardToContext(newDocumentContext, navParameters);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\ttry {\n\t\t\tawait this.postDocumentCreation(Promise.all([creation, navigation]), listBinding);\n\t\t} catch (error: unknown) {\n\t\t\t// TODO: currently, the only errors handled here are raised as string - should be changed to Error objects\n\t\t\t// creation has been cancelled by user or failed in backend => in case we have navigated to transient context before, navigate back\n\t\t\t// the switch-statement above seems to indicate that this happens in creationModes deferred and async. But in fact, in these cases after the navigation from routeMatched in OP component\n\t\t\t// createDeferredDocument is triggered, which calls this method (createDocument) again - this time with creationMode sync. Therefore, also in that mode we need to trigger back navigation.\n\t\t\t// The other cases might still be needed in case the navigation fails.\n\t\t\tif (\n\t\t\t\t[\n\t\t\t\t\tConstants.CancelActionDialog,\n\t\t\t\t\tConstants.ActionExecutionFailed,\n\t\t\t\t\tConstants.CreationFailed,\n\t\t\t\t\tConstants.OnBeforeCreateFailed\n\t\t\t\t].includes(error)\n\t\t\t) {\n\t\t\t\tthis.getInternalRouting().navigateBackFromTransientState();\n\t\t\t}\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\tBusyLocker.unlock(lockObject);\n\t\t}\n\t}\n\n\t/**\n\t * Creates an external document.\n\t * @param listBinding ODataListBinding where the document has to be created\n\t * @param outbound The outbound action\n\t * @returns Promise resolves once the navigation has been triggered\n\t */\n\tasync createExternalDocument(listBinding: ODataListBinding | string, outbound?: string): Promise<void> {\n\t\t// TODO: Call appropriate function (currently using the same as for outbound chevron nav, and without any context - 3rd param)\n\t\tif (outbound) {\n\t\t\tif (typeof listBinding !== \"string\" && this.getTransactionHelper().isListBindingHierarchical(listBinding)) {\n\t\t\t\tthrow new Error(`Unhandled creationMode \"External\" with a TreeTable`);\n\t\t\t}\n\n\t\t\tawait this.syncTask();\n\t\t\tconst controller = this.getView().getController() as PageController;\n\t\t\tconst createPath = ModelHelper.getAbsoluteMetaPathForListBinding(this.base.getView(), listBinding);\n\t\t\tcontroller._intentBasedNavigation.onChevronPressNavigateOutBound(controller, outbound, undefined, createPath);\n\t\t}\n\t}\n\n\t/**\n\t * Manages the SideEffects to execute after the document creation.\n\t * @param listBinding ODataListBinding where the document has to be created\n\t * @param creationPromise The promise resolved once the document is created\n\t * @returns Promise resolves once the SideEffects has been triggered\n\t */\n\thandleSideEffects = async (listBinding: ODataListBinding, creationPromise: Promise<Context>): Promise<void> => {\n\t\ttry {\n\t\t\tconst viewBindingContext = this.getView().getBindingContext();\n\t\t\tconst newContext = await creationPromise;\n\t\t\t// transient contexts are reliably removed once oNewContext.created() is resolved\n\t\t\tawait newContext.created();\n\t\t\t// if there are transient contexts, we must avoid requesting side effects\n\t\t\t// this is avoid a potential list refresh, there could be a side effect that refreshes the list binding\n\t\t\t// if list binding is refreshed, transient contexts might be lost\n\t\t\tif (!CommonUtils.hasTransientContext(listBinding) && viewBindingContext) {\n\t\t\t\tthis.getAppComponent()\n\t\t\t\t\t.getSideEffectsService()\n\t\t\t\t\t.requestSideEffectsForNavigationProperty(listBinding.getPath(), viewBindingContext as Context);\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(\"Error while creating the document\", error as string);\n\t\t}\n\t};\n\n\t/**\n\t * Generates the custom validation messages for the creationRow.\n\t * @param validationMessages The error messages form the custom validation function\n\t * @param table The table targeted by the messages\n\t */\n\tcreateCustomValidationMessages = (validationMessages: { messageTarget?: string; messageText: string }[], table: Table): void => {\n\t\tconst customValidationFunction = table.getCreationRow().data(\"customValidationFunction\");\n\t\tconst customValidity = table.getBindingContext(\"internal\")?.getProperty(\"creationRowCustomValidity\");\n\t\tconst customMessages: CustomMessage[] = [];\n\t\tlet fieldControl;\n\t\tlet finalTarget: string;\n\n\t\t// Remove existing CustomValidation message\n\t\tconst oldMessages = Messaging.getMessageModel()\n\t\t\t.getData()\n\t\t\t.filter((message: Message) => message.getCode() === customValidationFunction);\n\t\tMessaging.removeMessages(oldMessages);\n\n\t\tvalidationMessages.forEach((validationMessage) => {\n\t\t\t// Handle Bound CustomValidation message\n\t\t\tif (validationMessage.messageTarget) {\n\t\t\t\tfieldControl = Element.getElementById(customValidity[validationMessage.messageTarget].fieldId) as Control;\n\t\t\t\tfinalTarget = `${fieldControl.getBindingContext()?.getPath()}/${fieldControl.getBindingPath(\"value\")}`;\n\t\t\t\t// Add validation message if still not exists\n\t\t\t\tif (\n\t\t\t\t\t!Messaging.getMessageModel()\n\t\t\t\t\t\t.getData()\n\t\t\t\t\t\t.filter((message: Message) => message.getTargets().some((target) => target === finalTarget)).length\n\t\t\t\t) {\n\t\t\t\t\tMessaging.addMessages(\n\t\t\t\t\t\tnew Message({\n\t\t\t\t\t\t\tmessage: validationMessage.messageText,\n\t\t\t\t\t\t\tprocessor: this.getView().getModel(),\n\t\t\t\t\t\t\ttype: MessageType.Error,\n\t\t\t\t\t\t\tcode: customValidationFunction,\n\t\t\t\t\t\t\ttechnical: false,\n\t\t\t\t\t\t\tpersistent: false,\n\t\t\t\t\t\t\ttarget: finalTarget\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\t// Add controlId in order to get the focus handling of the error popover\n\t\t\t\tconst existingValidationMessages = Messaging.getMessageModel()\n\t\t\t\t\t.getData()\n\t\t\t\t\t.filter((message: Message) => message.getTargets().some((target) => target === finalTarget));\n\t\t\t\texistingValidationMessages[0].addControlId(customValidity[validationMessage.messageTarget].fieldId);\n\n\t\t\t\t// Handle Unbound CustomValidation message\n\t\t\t} else {\n\t\t\t\tcustomMessages.push({\n\t\t\t\t\tcode: customValidationFunction,\n\t\t\t\t\ttext: validationMessage.messageText,\n\t\t\t\t\tpersistent: true,\n\t\t\t\t\ttype: MessageType.Error\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (customMessages.length) {\n\t\t\tthis.getMessageHandler().showMessageDialog({\n\t\t\t\tcustomMessages: customMessages\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Resolves the creation mode\n\t * Provides the expected creation mode:\n\t * - preserves the passed creation mode when this one is not a NewPage\n\t * - calculates the new one if the creation mode is a NewPage.\n\t * @param initialCreationMode The initial creation mode\n\t * @param listBinding The list binding\n\t * @param createData The initial data for object creation\n\t * @returns The new creation mode\n\t */\n\tresolveCreationMode = (initialCreationMode: string, listBinding: ODataListBinding, createData: object | undefined): string => {\n\t\tif (initialCreationMode !== CreationMode.NewPage) {\n\t\t\t// use the passed creation mode\n\t\t\treturn initialCreationMode;\n\t\t} else {\n\t\t\tconst metaModel = listBinding.getModel().getMetaModel();\n\t\t\tconst programmingModel: string = this.getProgrammingModel(listBinding);\n\t\t\t// NewAction is not yet supported for NavigationProperty collection\n\t\t\tif (!listBinding.isRelative()) {\n\t\t\t\tconst dataModelListBindingPath = getInvolvedDataModelObjects(metaModel.getMetaContext(listBinding.getPath()));\n\t\t\t\tconst entitySet = dataModelListBindingPath.targetEntitySet as EntitySet | undefined,\n\t\t\t\t\t// if NewAction with parameters is present, then creation is 'Deferred'\n\t\t\t\t\t// in the absence of NewAction or NewAction with parameters, creation is async\n\t\t\t\t\tnewAction = (\n\t\t\t\t\t\tprogrammingModel === ProgrammingModel.Draft\n\t\t\t\t\t\t\t? entitySet?.annotations.Common?.DraftRoot\n\t\t\t\t\t\t\t: entitySet?.annotations.Session?.StickySessionSupported\n\t\t\t\t\t)?.NewAction?.toString();\n\n\t\t\t\tif (newAction && dataModelListBindingPath.targetEntityType.actions[newAction].parameters.length > 1) {\n\t\t\t\t\t// binding parameter (eg: _it) is not considered\n\t\t\t\t\treturn CreationMode.Deferred;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst creationParameters = this.getTransactionHelper().getCreationParameters(listBinding, createData, this.getAppComponent());\n\t\t\tif (creationParameters.length) {\n\t\t\t\treturn CreationMode.Deferred;\n\t\t\t}\n\t\t\treturn CreationMode.Async;\n\t\t}\n\t};\n\n\t/**\n\t * Validates a document.\n\t * @returns Promise resolves with result of the custom validation function\n\t */\n\n\tasync validateDocument(\n\t\tcontext: Context,\n\t\tparameters: { customValidationFunction?: string; data: Record<string, unknown> }\n\t): Promise<{ messageTarget?: string; messageText: string }[]> {\n\t\treturn this.getTransactionHelper().validateDocument(context, parameters, this.getView());\n\t}\n\n\t/**\n\t * This function returns an asynchronous function that provides the result of\n\t * a creation row's custom validation as a promise. If no creation row is involved\n\t * the resulting function returns a resolved promise.\n\t * @param table The table with the creationRow\n\t * @returns A function that returns a promise\n\t */\n\tgetCreationRowValidationFunction(table: Table | undefined): () => Promise<{ messageTarget?: string; messageText: string }[]> {\n\t\tconst creationRow = table?.getCreationRow();\n\t\tif (creationRow && table) {\n\t\t\treturn async (): Promise<{ messageTarget?: string; messageText: string }[]> => {\n\t\t\t\tconst creationRowObjects = (creationRow.getBindingContext() as Context).getObject();\n\t\t\t\tdelete creationRowObjects[\"@$ui5.context.isTransient\"];\n\t\t\t\treturn this.validateDocument(table.getBindingContext() as Context, {\n\t\t\t\t\tdata: creationRowObjects,\n\t\t\t\t\tcustomValidationFunction: table.getCreationRow().data(\"customValidationFunction\")\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn async () => Promise.resolve([]);\n\t}\n\n\t/**\n\t * Creates several documents.\n\t * @param listBinding The listBinding used to create the documents\n\t * @param dataForCreate The initial data for the new documents\n\t * @param createAtEnd True if the new contexts need to be created at the end of the list binding\n\t * @param isFromCopyPaste True if the creation has been triggered by a paste action\n\t * @param beforeCreateCallBack Callback to be called before the creation\n\t * @param createAsInactive True if the contexts need to be created as inactive\n\t * @param requestSideEffects True by default, false if SideEffects should not be requested\n\t * @returns A Promise with the newly created contexts.\n\t */\n\tasync createMultipleDocuments(\n\t\tlistBinding: ODataListBinding,\n\t\tdataForCreate: Record<string, unknown>[],\n\t\tcreateAtEnd: boolean,\n\t\tisFromCopyPaste: boolean,\n\t\tbeforeCreateCallBack?: Function,\n\t\tcreateAsInactive = false,\n\t\trequestSideEffects?: boolean\n\t): Promise<Context[]> {\n\t\tconst transactionHelper = this.getTransactionHelper();\n\t\tconst lockObject = this.getGlobalUIModel();\n\t\tconst targetListBinding = listBinding;\n\t\trequestSideEffects = requestSideEffects !== false;\n\t\tif (!createAsInactive) {\n\t\t\tBusyLocker.lock(lockObject);\n\t\t}\n\t\ttry {\n\t\t\tawait this.syncTask();\n\t\t\tif (beforeCreateCallBack) {\n\t\t\t\tawait beforeCreateCallBack({ contextPath: targetListBinding.getPath() });\n\t\t\t}\n\n\t\t\tconst metaModel = targetListBinding.getModel().getMetaModel();\n\t\t\tlet metaPath: string;\n\n\t\t\tif (targetListBinding.getContext()) {\n\t\t\t\tmetaPath = metaModel.getMetaPath(`${targetListBinding.getContext().getPath()}/${targetListBinding.getPath()}`);\n\t\t\t} else {\n\t\t\t\tmetaPath = metaModel.getMetaPath(targetListBinding.getPath());\n\t\t\t}\n\n\t\t\tthis.handleCreateEvents(targetListBinding);\n\n\t\t\t// Iterate on all items and store the corresponding creation promise\n\t\t\tconst creationPromises = dataForCreate.map(async (propertyValues) => {\n\t\t\t\tconst createParameters: CreateParameters = { data: {}, parentControl: this.getView() };\n\n\t\t\t\tcreateParameters.keepTransientContextOnFailed = false; // currently not fully supported\n\t\t\t\tcreateParameters.creationMode = CreationMode.CreationRow;\n\t\t\t\tcreateParameters.createAtEnd = createAtEnd;\n\t\t\t\tcreateParameters.inactive = createAsInactive;\n\n\t\t\t\t// Remove navigation properties as we don't support deep create\n\t\t\t\tfor (const propertyPath in propertyValues) {\n\t\t\t\t\tconst property = metaModel.getObject(`${metaPath}/${propertyPath}`);\n\t\t\t\t\tif (\n\t\t\t\t\t\tproperty &&\n\t\t\t\t\t\tproperty.$kind !== \"NavigationProperty\" &&\n\t\t\t\t\t\t!propertyPath.includes(\"/\") &&\n\t\t\t\t\t\tpropertyValues[propertyPath]\n\t\t\t\t\t) {\n\t\t\t\t\t\tcreateParameters.data![propertyPath] = propertyValues[propertyPath];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn transactionHelper.createDocument(\n\t\t\t\t\ttargetListBinding,\n\t\t\t\t\tcreateParameters,\n\t\t\t\t\tthis.getAppComponent(),\n\t\t\t\t\tthis._getResourceModel(),\n\t\t\t\t\tthis.getMessageHandler(),\n\t\t\t\t\tisFromCopyPaste\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tconst createdContexts = await Promise.all(creationPromises);\n\t\t\tif (!createAsInactive) {\n\t\t\t\tthis.setDocumentModifiedOnCreate(targetListBinding);\n\t\t\t}\n\t\t\t// transient contexts are reliably removed once oNewContext.created() is resolved\n\t\t\tconst activeContexts = createdContexts.filter((newContext) => !newContext.isInactive());\n\t\t\tawait Promise.all(activeContexts.map(async (newContext) => newContext.created()));\n\n\t\t\tconst viewBindingContext = this.getView().getBindingContext();\n\n\t\t\t// if there are transient contexts, we must avoid requesting side effects\n\t\t\t// this is avoid a potential list refresh, there could be a side effect that refreshes the list binding\n\t\t\t// if list binding is refreshed, transient contexts might be lost\n\t\t\tif (requestSideEffects && !CommonUtils.hasTransientContext(targetListBinding)) {\n\t\t\t\tthis.getAppComponent()\n\t\t\t\t\t.getSideEffectsService()\n\t\t\t\t\t.requestSideEffectsForNavigationProperty(targetListBinding.getPath(), viewBindingContext as Context);\n\t\t\t}\n\n\t\t\tif (this.base.collaborativeDraft.isConnected() && activeContexts.length > 0) {\n\t\t\t\tthis._sendActivity(Activity.Create, activeContexts);\n\t\t\t}\n\n\t\t\treturn createdContexts;\n\t\t} catch (err: unknown) {\n\t\t\tLog.error(\"Error while creating multiple documents.\");\n\t\t\tthrow err;\n\t\t} finally {\n\t\t\tif (!createAsInactive) {\n\t\t\t\tBusyLocker.unlock(lockObject);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * This function can be used to intercept the 'Create' action. You can execute custom coding in this function.\n\t * The framework waits for the returned promise to be resolved before continuing the 'Create' action.\n\t * If you reject the promise, the 'Create' action is stopped.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onBeforeCreate\n\t * @param _mParameters.contextPath Path pointing to the context on which Create action is triggered\n\t * @param _mParameters.createParameters Array of values that are filled in the Action Parameter Dialog\n\t * @returns A promise to be returned by the overridden method. If resolved, the 'Create' action is triggered. If rejected, the 'Create' action is not triggered.\n\t * @public\n\t * @since 1.98.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onBeforeCreate(_mParameters?: { contextPath?: string; createParameters?: unknown[] }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to intercept the 'Edit' action. You can execute custom coding in this function.\n\t * The framework waits for the returned promise to be resolved before continuing the 'Edit' action.\n\t * If you reject the promise, the 'Edit' action is stopped and the user stays in display mode.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onBeforeEdit\n\t * @param _mParameters.context Page context that is going to be edited.\n\t * @returns A promise to be returned by the overridden method. If resolved, the 'Edit' action is triggered. If rejected, the 'Edit' action is not triggered and the user stays in display mode.\n\t * @public\n\t * @since 1.98.0\n\t */\n\t@publicExtension()\n\t@extensible(\"AfterAsync\")\n\tasync onBeforeEdit(_mParameters?: { context?: Context }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to intercept the 'Save' action. You can execute custom coding in this function.\n\t * The framework waits for the returned promise to be resolved before continuing the 'Save' action.\n\t * If you reject the promise, the 'Save' action is stopped and the user stays in edit mode.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onBeforeSave\n\t * @param _mParameters.context Page context that is going to be saved.\n\t * @returns A promise to be returned by the overridden method. If resolved, the 'Save' action is triggered. If rejected, the 'Save' action is not triggered and the user stays in edit mode.\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@extensible(\"AfterAsync\")\n\tasync onBeforeSave(_mParameters?: { context?: Context }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to intercept the 'Discard' action. You can execute custom coding in this function.\n\t * The framework waits for the returned promise to be resolved before continuing the 'Discard' action.\n\t * If you reject the promise, the 'Discard' action is stopped and the user stays in edit mode.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onBeforeDiscard\n\t * @param _mParameters.context Page context that is going to be discarded.\n\t * @returns A promise to be returned by the overridden method. If resolved, the 'Discard' action is triggered. If rejected, the 'Discard' action is not triggered and the user stays in edit mode.\n\t * @public\n\t * @since 1.98.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onBeforeDiscard(_mParameters?: { context?: Context }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to intercept the 'Delete' action. You can execute custom coding in this function.\n\t * The framework waits for the returned promise to be resolved before continuing the 'Delete' action.\n\t * If you reject the promise, the 'Delete' action is stopped.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onBeforeDelete\n\t * @param _mParameters.contexts An array of contexts that are going to be deleted\n\t * @returns A promise to be returned by the overridden method. If resolved, the 'Delete' action is triggered. If rejected, the 'Delete' action is not triggered.\n\t * @public\n\t * @since 1.98.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onBeforeDelete(_mParameters?: { contexts?: Context[] }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to execute code after the 'Save' action.\n\t * You can execute custom coding in this function.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onAfterSave\n\t * @param _mParameters.context The context we obtained after saving\n\t * @returns A promise to be returned by the overridden method.\n\t * @public\n\t * @since 1.116.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onAfterSave(_mParameters?: { context?: Context }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to execute code after the 'Create' action.\n\t * You can execute custom coding in this function.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onAfterCreate\n\t * @param _mParameters.context The newly created context\n\t * @returns A promise to be returned by the overridden method.\n\t * @public\n\t * @since 1.116.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onAfterCreate(_mParameters?: { context?: Context }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to execute code after the 'Edit' action.\n\t * You can execute custom coding in this function.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onAfterEdit\n\t * @param _mParameters.context Page context that is going to be edited.\n\t * @returns A promise to be returned by the overridden method.\n\t * @public\n\t * @since 1.116.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onAfterEdit(_mParameters?: { context?: Context }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to execute code after the 'Discard' action.\n\t * You can execute custom coding in this function.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onAfterDiscard\n\t * @param _mParameters.context The context obtained after discarding the object, or undefined if we discarded a new object\n\t * @returns A promise to be returned by the overridden method.\n\t * @public\n\t * @since 1.116.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onAfterDiscard(_mParameters?: { context?: Context }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t/**\n\t * This function can be used to execute code after the 'Delete' action.\n\t * You can execute custom coding in this function.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers, but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.After}.\n\t * @param _mParameters Object containing the parameters passed to onAfterDelete\n\t * @param _mParameters.contexts An array of contexts that are going to be deleted\n\t * @returns A promise to be returned by the overridden method.\n\t * @public\n\t * @since 1.116.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onAfterDelete(_mParameters?: { contexts?: Context[] }): Promise<void> {\n\t\t// to be overridden\n\t\treturn Promise.resolve();\n\t}\n\n\t// Internal only params ---\n\t// @param {boolean} mParameters.bExecuteSideEffectsOnError Indicates whether SideEffects need to be ignored when user clicks on Save during an Inline creation\n\t// @param {object} mParameters.bindings List bindings of the tables in the view.\n\t// Both of the above parameters are for the same purpose. User can enter some information in the creation row(s) but does not 'Add row', instead clicks Save.\n\t// There can be more than one in the view.\n\n\t/**\n\t * Saves a new document after checking it.\n\t * @param oContext  Context of the editable document\n\t * @param mParameters PRIVATE\n\t * @returns Promise resolves once save is complete\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync saveDocument(oContext: Context, mParameters: SaveDocumentParameters): Promise<void> {\n\t\tmParameters = mParameters || {};\n\t\tconst bExecuteSideEffectsOnError = mParameters.bExecuteSideEffectsOnError || undefined;\n\t\tconst transactionHelper = this.getTransactionHelper();\n\t\tconst aBindings = mParameters.bindings as ODataListBinding[];\n\t\tconst messageHandlingKey = this.getMessageHandler().registerToHoldMessages();\n\n\t\ttry {\n\t\t\tawait this.syncTask();\n\t\t\t// in case of saving / activating the bound transition messages shall be removed before the PATCH/POST\n\t\t\t// is sent to the backend\n\t\t\tthis.getMessageHandler().removeTransitionMessages();\n\t\t\tif (mParameters.mergePatchDraft !== true) {\n\t\t\t\tawait this._submitOpenChanges(oContext);\n\t\t\t\t//we need to request for recommendations and then bring the dialog here\n\t\t\t}\n\t\t\tawait this._checkForValidationErrors();\n\n\t\t\tconst recommendationOptionChoosen = await this.checkRecommendationOption();\n\n\t\t\tawait this.base.editFlow.onBeforeSave({ context: oContext });\n\n\t\t\tconst sProgrammingModel = this.getProgrammingModel(oContext);\n\t\t\tconst rootViewController = this._getRootViewController();\n\t\t\tlet siblingInfo: SiblingInformation | undefined;\n\t\t\tif (\n\t\t\t\t(sProgrammingModel === ProgrammingModel.Sticky || oContext.getProperty(\"HasActiveEntity\")) &&\n\t\t\t\trootViewController.isFclEnabled()\n\t\t\t) {\n\t\t\t\t// No need to try to get rightmost context in case of a new object\n\t\t\t\tsiblingInfo = await this._computeSiblingInformation(\n\t\t\t\t\toContext,\n\t\t\t\t\trootViewController.getRightmostContext(),\n\t\t\t\t\tsProgrammingModel,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Execute the registered deferred SideEffects which have not be executed yet for the page context\n\t\t\t// Can occur when shortcut is used to save the document.\n\t\t\tawait this.base._sideEffects.handlePageChangeContext(oContext);\n\n\t\t\t// The $auto queue can only have pending changes at this point when SAVE was clicked immediately after changing a field.\n\t\t\t// In this case the $auto queue is locked therefore the following submit batch should not create a separate batch request.\n\t\t\t// It is done in order to make sure that patch, draftprepare, draftactivate each have their own changeset\n\t\t\tif (oContext.getModel().hasPendingChanges(\"$auto\") && mParameters.mergePatchDraft) {\n\t\t\t\toContext.getModel().submitBatch(\"$auto\");\n\t\t\t}\n\t\t\tconst activeDocumentContext = await transactionHelper.saveDocument(\n\t\t\t\toContext,\n\t\t\t\tthis.getAppComponent(),\n\t\t\t\tthis._getResourceModel(),\n\t\t\t\tbExecuteSideEffectsOnError as boolean,\n\t\t\t\taBindings,\n\t\t\t\tthis.getMessageHandler(),\n\t\t\t\tthis.getCreationMode()\n\t\t\t);\n\t\t\tthis._removeStickySessionInternalProperties(sProgrammingModel);\n\n\t\t\tthis._sendActivity(Activity.Activate, activeDocumentContext);\n\t\t\tthis.base.collaborativeDraft.disconnect();\n\n\t\t\tthis._triggerConfiguredSurvey(StandardActions.save, TriggerType.standardAction);\n\n\t\t\tthis.setDocumentModified(false);\n\t\t\tthis.setEditMode(EditMode.Display, false);\n\t\t\tthis.getMessageHandler().showMessageDialog({ unHoldKey: messageHandlingKey });\n\n\t\t\tawait this.base.editFlow.onAfterSave({\n\t\t\t\tcontext: activeDocumentContext\n\t\t\t});\n\n\t\t\t// update telemetry data for how page was saved and then do storing of this data to backend through the storeData function\n\t\t\tthis.base.recommendations.storeDataForTelemetry(recommendationOptionChoosen);\n\n\t\t\tif (activeDocumentContext !== oContext) {\n\t\t\t\tlet contextToNavigate = activeDocumentContext;\n\t\t\t\tsiblingInfo = siblingInfo ?? this._createSiblingInfo(oContext, activeDocumentContext);\n\n\t\t\t\tif (sProgrammingModel === ProgrammingModel.Draft) {\n\t\t\t\t\t// When saving, the semantic keys may have changed.\n\t\t\t\t\t// In this case, we also need to manage the semantic URL change in the history\n\t\t\t\t\tconst previousSemanticPath = SemanticKeyHelper.getSemanticPath(oContext, true);\n\t\t\t\t\tconst newSemanticPath = SemanticKeyHelper.getSemanticPath(activeDocumentContext, true);\n\t\t\t\t\tif (previousSemanticPath && newSemanticPath && previousSemanticPath !== newSemanticPath) {\n\t\t\t\t\t\tsiblingInfo.pathMapping.push({ oldPath: previousSemanticPath, newPath: newSemanticPath });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis._updatePathsInHistory(siblingInfo.pathMapping);\n\t\t\t\tif (rootViewController.isFclEnabled()) {\n\t\t\t\t\tif (siblingInfo.targetContext.getPath() !== activeDocumentContext.getPath()) {\n\t\t\t\t\t\tcontextToNavigate = siblingInfo.targetContext;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tawait this._handleNewContext(contextToNavigate, { editable: false, recreateContext: false, forceFocus: true });\n\t\t\t}\n\t\t} catch (oError: unknown) {\n\t\t\tthis.getMessageHandler().showMessageDialog({ unHoldKey: messageHandlingKey });\n\t\t\tif (!(oError && (oError as { canceled?: boolean }).canceled)) {\n\t\t\t\tLog.error(\"Error while saving the document\", oError as string);\n\t\t\t}\n\t\t\tthrow oError;\n\t\t}\n\t}\n\n\t/**\n\t * Switches the UI between draft and active document.\n\t * @param oContext The context to switch from\n\t * @returns Promise resolved once the switch is done\n\t */\n\tasync toggleDraftActive(oContext: Context): Promise<void> {\n\t\tconst oContextData = oContext.getObject();\n\t\tlet editable: boolean;\n\t\tconst bIsDraft = oContext && this.getProgrammingModel(oContext) === ProgrammingModel.Draft;\n\n\t\t//toggle between draft and active document is only available for edit drafts and active documents with draft)\n\t\tif (\n\t\t\t!bIsDraft ||\n\t\t\t!(\n\t\t\t\t(!oContextData.IsActiveEntity && oContextData.HasActiveEntity) ||\n\t\t\t\t(oContextData.IsActiveEntity && oContextData.HasDraftEntity)\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!oContextData.IsActiveEntity && oContextData.HasActiveEntity) {\n\t\t\t//start Point: edit draft\n\t\t\teditable = false;\n\t\t} else {\n\t\t\t// start point active document\n\t\t\teditable = true;\n\t\t}\n\n\t\ttry {\n\t\t\tconst oRootViewController = this._getRootViewController();\n\t\t\tconst oRightmostContext = oRootViewController.isFclEnabled() ? oRootViewController.getRightmostContext() : oContext;\n\t\t\tlet siblingInfo = await this._computeSiblingInformation(oContext, oRightmostContext, ProgrammingModel.Draft, false);\n\t\t\tif (!siblingInfo && oContext !== oRightmostContext) {\n\t\t\t\t// Try to compute sibling info for the root context if it fails for the rightmost context\n\t\t\t\t// --> In case of FCL, if we try to switch between draft and active but a child entity has no sibling, the switch will close the child column\n\t\t\t\tsiblingInfo = await this._computeSiblingInformation(oContext, oContext, ProgrammingModel.Draft, false);\n\t\t\t}\n\t\t\tif (siblingInfo) {\n\t\t\t\tthis.setEditMode(editable ? EditMode.Editable : EditMode.Display, false); //switch to edit mode only if a draft is available\n\n\t\t\t\tif (oRootViewController.isFclEnabled()) {\n\t\t\t\t\tconst lastSemanticMapping = this._getSemanticMapping();\n\t\t\t\t\tif (lastSemanticMapping?.technicalPath === oContext.getPath()) {\n\t\t\t\t\t\tconst targetPath = siblingInfo.pathMapping[siblingInfo.pathMapping.length - 1].newPath;\n\t\t\t\t\t\tsiblingInfo.pathMapping.push({ oldPath: lastSemanticMapping.semanticPath, newPath: targetPath });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._updatePathsInHistory(siblingInfo.pathMapping);\n\n\t\t\t\tawait this._handleNewContext(siblingInfo.targetContext, { editable, recreateContext: true, forceFocus: true });\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"Error in EditFlow.toggleDraftActive - Cannot find sibling\");\n\t\t\t}\n\t\t} catch (oError) {\n\t\t\tthrow new Error(`Error in EditFlow.toggleDraftActive:${oError}`);\n\t\t}\n\t}\n\n\t// Internal only params ---\n\t// @param {sap.m.Button} mParameters.cancelButton - Currently this is passed as cancelButton internally (replaced by mParameters.control in the JSDoc below). Currently it is also mandatory.\n\t// Plan - This should not be mandatory. If not provided, we should have a default that can act as reference control for the discard popover OR we can show a dialog instead of a popover.\n\n\t/**\n\t * Discard the editable document.\n\t * @param oContext  Context of the editable document\n\t * @param mParameters Can contain the following attributes:\n\t * @param mParameters.control This is the control used to open the discard popover\n\t * @param mParameters.cancelButton PRIVATE\n\t * @param mParameters.skipDiscardPopover Optional, supresses the discard popover and allows custom handling\n\t * @param mParameters.skipBackNavigation\n\t * @param mParameters.skipBindingToView\n\t * @returns Promise resolves once editable document has been discarded\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync cancelDocument(\n\t\toContext: Context,\n\t\tmParameters: {\n\t\t\tcontrol?: Button;\n\t\t\tcancelButton?: Button;\n\t\t\tskipDiscardPopover?: boolean;\n\t\t\tskipBackNavigation?: boolean;\n\t\t\tskipBindingToView?: boolean;\n\t\t}\n\t): Promise<Context | undefined> {\n\t\tconst transactionHelper = this.getTransactionHelper();\n\n\t\tlet siblingInfo: SiblingInformation | undefined;\n\t\tlet isNewDocument = false;\n\t\tconst cancelParameters: CancelParameters = {\n\t\t\tskipDiscardPopover: mParameters.skipDiscardPopover === true,\n\t\t\tcancelButton: (mParameters.control || mParameters.cancelButton)!,\n\t\t\tbeforeCancelCallBack: this.base.editFlow.onBeforeDiscard\n\t\t};\n\n\t\ttry {\n\t\t\tawait this.syncTask();\n\t\t\tconst sProgrammingModel = this.getProgrammingModel(oContext);\n\t\t\tif ((sProgrammingModel === ProgrammingModel.Sticky || oContext.getProperty(\"HasActiveEntity\")) && this._isFclEnabled()) {\n\t\t\t\tconst oRootViewController = this._getRootViewController();\n\n\t\t\t\t// No need to try to get rightmost context in case of a new object\n\t\t\t\tsiblingInfo = await this._computeSiblingInformation(\n\t\t\t\t\toContext,\n\t\t\t\t\t(oRootViewController as FclController).getRightmostContext(),\n\t\t\t\t\tsProgrammingModel,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst cancelResult = await transactionHelper.cancelDocument(\n\t\t\t\toContext,\n\t\t\t\tcancelParameters,\n\t\t\t\tthis.getAppComponent(),\n\t\t\t\tthis._getResourceModel(),\n\t\t\t\tthis.getMessageHandler(),\n\t\t\t\tthis.getCreationMode(),\n\t\t\t\tthis.isDocumentModified()\n\t\t\t);\n\t\t\tthis._getRootViewController()\n\t\t\t\t.getInstancedViews()\n\t\t\t\t.forEach((view) => {\n\t\t\t\t\tconst context = view.getBindingContext() as ODataV4Context;\n\t\t\t\t\tif (context && context.isKeepAlive()) {\n\t\t\t\t\t\tcontext.setKeepAlive(false);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\tthis._removeStickySessionInternalProperties(sProgrammingModel);\n\n\t\t\tthis.setEditMode(EditMode.Display, false);\n\t\t\tthis.setDocumentModified(false);\n\t\t\tthis.setDraftStatus(DraftStatus.Clear);\n\n\t\t\tawait this.base.editFlow.onAfterDiscard({\n\t\t\t\tcontext: typeof cancelResult === \"boolean\" || cancelResult === null ? undefined : cancelResult\n\t\t\t});\n\t\t\t// we force the edit state even for FCL because the draft discard might not be implemented\n\t\t\t// and we may just delete the draft\n\t\t\tEditState.setEditStateDirty();\n\t\t\tif (!cancelResult) {\n\t\t\t\tthis._sendActivity(Activity.Discard, oContext);\n\t\t\t\tthis.base.collaborativeDraft.disconnect();\n\t\t\t\t//in case of a new document, no activeContext is returned --> navigate back.\n\t\t\t\tif (!mParameters.skipBackNavigation) {\n\t\t\t\t\tawait this.getInternalRouting().navigateBackFromContext(oContext);\n\t\t\t\t\tisNewDocument = true;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst oActiveDocumentContext = cancelResult;\n\t\t\t\tthis._sendActivity(Activity.Discard, oActiveDocumentContext);\n\t\t\t\tthis.base.collaborativeDraft.disconnect();\n\t\t\t\tlet contextToNavigate = oActiveDocumentContext;\n\t\t\t\tsiblingInfo = siblingInfo ?? this._createSiblingInfo(oContext, oActiveDocumentContext);\n\t\t\t\tthis._updatePathsInHistory(siblingInfo.pathMapping);\n\t\t\t\tif (this._isFclEnabled()) {\n\t\t\t\t\tif (siblingInfo.targetContext.getPath() !== oActiveDocumentContext.getPath()) {\n\t\t\t\t\t\tcontextToNavigate = siblingInfo.targetContext;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (sProgrammingModel === ProgrammingModel.Draft) {\n\t\t\t\t\t// We need to load the semantic keys of the active context, as we need them\n\t\t\t\t\t// for the navigation\n\t\t\t\t\tawait this._fetchSemanticKeyValues(oActiveDocumentContext);\n\t\t\t\t\t// We force the recreation of the context, so that it's created and bound in the same microtask,\n\t\t\t\t\t// so that all properties are loaded together by autoExpandSelect, so that when switching back to Edit mode\n\t\t\t\t\t// $$inheritExpandSelect takes all loaded properties into account (BCP 2070462265)\n\t\t\t\t\tif (!mParameters.skipBindingToView) {\n\t\t\t\t\t\tawait this._handleNewContext(contextToNavigate, { editable: false, recreateContext: true, forceFocus: true });\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn oActiveDocumentContext;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Active context is returned in case of cancel of existing document, and it's the same as the edited context\n\t\t\t\t\t// So, we force the recreation as it may have been destroyed when calling setKeepAlive(false) on all view's contexts\n\t\t\t\t\t// earlier in this method\n\t\t\t\t\tawait this._handleNewContext(contextToNavigate, { editable: false, recreateContext: true, forceFocus: true });\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (sProgrammingModel === ProgrammingModel.Draft) {\n\t\t\t\t//show Draft discarded message toast only for draft enabled apps\n\t\t\t\tthis.showDocumentDiscardMessage(isNewDocument);\n\t\t\t}\n\t\t} catch (oError: unknown) {\n\t\t\tLog.error(\"Error while discarding the document\", oError as string);\n\t\t}\n\t}\n\n\t/**\n\t * Brings up a message toast when a draft is discarded.\n\t * @param isNewDocument This is a Boolean flag that determines whether the document is new or already exists.\n\t */\n\tshowDocumentDiscardMessage(isNewDocument?: boolean): void {\n\t\tconst resourceModel = this._getResourceModel();\n\t\tconst message = resourceModel.getText(\"C_TRANSACTION_HELPER_DISCARD_DRAFT_TOAST\");\n\t\tif (isNewDocument == true) {\n\t\t\tconst appComponent = this.getAppComponent();\n\t\t\tappComponent.getRoutingService().attachAfterRouteMatched({}, this.showMessageWhenNoContext, this);\n\t\t} else {\n\t\t\tMessageToast.show(message);\n\t\t}\n\t}\n\n\t/**\n\t * We use this function in showDocumentDiscardMessage when no context is passed.\n\t */\n\tshowMessageWhenNoContext(): void {\n\t\tconst resourceModel = this._getResourceModel();\n\t\tconst message = resourceModel.getText(\"C_TRANSACTION_HELPER_DISCARD_DRAFT_TOAST\");\n\t\tconst appComponent = this.getAppComponent();\n\t\tMessageToast.show(message);\n\t\tappComponent.getRoutingService().detachAfterRouteMatched(this.showMessageWhenNoContext, this);\n\t}\n\n\t/**\n\t * Checks if a context corresponds to a draft root.\n\t * @param context The context to check\n\t * @returns True if the context points to a draft root\n\t */\n\tprivate isDraftRoot(context: Context): boolean {\n\t\tconst metaModel = context.getModel().getMetaModel();\n\t\tconst metaContext = metaModel.getMetaContext(context.getPath());\n\t\treturn ModelHelper.isDraftRoot(getInvolvedDataModelObjects(metaContext).targetEntitySet);\n\t}\n\n\t// Internal only params ---\n\t// @param {string} mParameters.entitySetName Name of the EntitySet to which the object belongs\n\n\t/**\n\t * Deletes the document.\n\t * @param oContext  Context of the document\n\t * @param mInParameters Can contain the following attributes:\n\t * @param mInParameters.title Title of the object being deleted\n\t * @param mInParameters.description Description of the object being deleted\n\t * @param mInParameters.entitySetName PRIVATE\n\t * @returns Promise resolves once document has been deleted\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync deleteDocument(oContext: Context, mInParameters?: { entitySetName: string; title: string; description: string }): Promise<void> {\n\t\tconst oAppComponent = this.getAppComponent();\n\t\tconst mParameters: {\n\t\t\t\tbeforeDeleteCallBack?: Function;\n\t\t\t\trequestSideEffects?: boolean;\n\t\t\t\tcontrolId?: string;\n\t\t\t\tparentControl?: Control;\n\t\t\t\tbFindActiveContexts: boolean;\n\t\t\t\tselectedContexts?: Context[];\n\t\t\t\tinternalModelContext?: InternalModelContext | null;\n\t\t\t\tentitySetName?: string;\n\t\t\t\ttitle?: string;\n\t\t\t\tdescription?: string;\n\t\t\t} = { ...mInParameters, bFindActiveContexts: false, beforeDeleteCallBack: this.base.editFlow.onBeforeDelete },\n\t\t\tmessageHandlingKey = this.getMessageHandler().registerToHoldMessages();\n\n\t\ttry {\n\t\t\tif (\n\t\t\t\tthis._isFclEnabled() &&\n\t\t\t\tthis.isDraftRoot(oContext) &&\n\t\t\t\toContext.getIndex() === undefined &&\n\t\t\t\toContext.getProperty(\"IsActiveEntity\") === true &&\n\t\t\t\toContext.getProperty(\"HasDraftEntity\") === true\n\t\t\t) {\n\t\t\t\t// Deleting an active entity which has a draft that could potentially be displayed in the ListReport (FCL case)\n\t\t\t\t// --> need to remove the draft from the LR and replace it with the active version, so that the ListBinding is properly refreshed\n\t\t\t\t// The condition 'oContext.getIndex() === undefined' makes sure the active version isn't already displayed in the LR\n\t\t\t\tmParameters.beforeDeleteCallBack = async (parameters?: { contexts?: Context[] }): Promise<void> => {\n\t\t\t\t\tawait this.base.editFlow.onBeforeDelete(parameters);\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst model = oContext.getModel();\n\t\t\t\t\t\tconst siblingContext = model.bindContext(`${oContext.getPath()}/SiblingEntity`).getBoundContext();\n\t\t\t\t\t\tconst draftPath = await siblingContext.requestCanonicalPath();\n\t\t\t\t\t\tconst draftContextToRemove = model.getKeepAliveContext(draftPath);\n\t\t\t\t\t\tdraftContextToRemove.replaceWith(oContext);\n\t\t\t\t\t} catch (error: unknown) {\n\t\t\t\t\t\tLog.error(\"Error while replacing the draft instance in the LR ODLB\", error as string);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (this.getProgrammingModel(oContext) === ProgrammingModel.Sticky) {\n\t\t\t\tthis.setDocumentModified(true);\n\t\t\t}\n\n\t\t\tawait this.deleteDocumentTransaction(oContext, mParameters);\n\n\t\t\t// Single objet deletion is triggered from an OP header button (not from a list)\n\t\t\t// --> Mark UI dirty and navigate back to dismiss the OP\n\t\t\tif (!this._isFclEnabled()) {\n\t\t\t\tEditState.setEditStateDirty();\n\t\t\t} else {\n\t\t\t\tconst contextBinding = oContext.getBinding();\n\t\t\t\tif (contextBinding.isA<ODataListBinding>(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\t\t\tif (contextBinding.isRoot()) {\n\t\t\t\t\t\t// Even in the FCL case, we need to refresh the listbinding in the LR (not OP) to update the counts in the tabs and quickfilters\n\t\t\t\t\t\tawait this.getTransactionHelper().refreshListBinding(contextBinding, oAppComponent);\n\t\t\t\t\t} else if (mParameters.requestSideEffects !== false) {\n\t\t\t\t\t\tthis.requestSideEffectsOnDelete(contextBinding, contextBinding.getContext());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._sendActivity(Activity.Delete, oContext);\n\n\t\t\t// After delete is successfull, we need to detach the setBackNavigation Methods\n\t\t\tawait oAppComponent?.getShellServices().setBackNavigation();\n\t\t\tconst isRecommendationEnabled = this.base.recommendations.isRecommendationEnabled();\n\t\t\t// We clear recommendation data and contexts from internal model for the deleted contexts\n\t\t\tif (isRecommendationEnabled) {\n\t\t\t\tthis.base.recommendations.ignoreRecommendationForContexts([oContext]);\n\t\t\t}\n\t\t\t// Notify consumers of which contexts were deleted\n\t\t\tawait this.base.editFlow.onAfterDelete({ contexts: [oContext] });\n\n\t\t\tif (!this._isFclEnabled()) {\n\t\t\t\tif (oAppComponent?.getStartupMode() === StartupMode.Deeplink) {\n\t\t\t\t\t// In case the app has been launched with semantic keys, deleting the object we've landed on shall navigate back\n\t\t\t\t\t// to the app we came from (except for FCL, where we navigate to LR as usual)\n\t\t\t\t\toAppComponent.getRouterProxy().exitFromApp();\n\t\t\t\t} else {\n\t\t\t\t\t// Else navigate back from the page. In FCL, this is done when the kept-alive context is destroyed (callback)\n\t\t\t\t\tthis.getInternalRouting().navigateBackFromContext(oContext);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.error(\"Error while deleting the document\", error as string);\n\t\t} finally {\n\t\t\tthis.getMessageHandler().showMessages({ unHoldKey: messageHandlingKey });\n\t\t}\n\t}\n\n\t/**\n\t * Submit the current set of changes and navigate back.\n\t * @param oContext  Context of the document\n\t * @returns Promise resolves once the changes have been saved\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync applyDocument(oContext: Context): Promise<void> {\n\t\tconst oLockObject = this.getGlobalUIModel();\n\t\tconst messageHandlingKey = this.getMessageHandler().registerToHoldMessages();\n\n\t\ttry {\n\t\t\tawait this.syncTask();\n\t\t\tif (oContext.getModel().hasPendingChanges(\"$auto\")) {\n\t\t\t\tBusyLocker.lock(oLockObject);\n\t\t\t\tawait this._submitOpenChanges(oContext);\n\t\t\t\t//we need to request for recommendations and then bring the dialog here\n\t\t\t}\n\t\t\tconst isContinue = await this.showConfirmRecommendationsDialog(false);\n\t\t\tif (isContinue === RecommendationDialogDecision.Continue) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait this._checkForValidationErrors();\n\t\t\tawait this.getMessageHandler().showMessageDialog({ unHoldKey: messageHandlingKey });\n\t\t\tawait this.getInternalRouting().navigateBackFromContext(oContext);\n\t\t} finally {\n\t\t\tif (BusyLocker.isLocked(oLockObject)) {\n\t\t\t\tBusyLocker.unlock(oLockObject);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Internal only params ---\n\t// @param {boolean} [mParameters.bStaticAction] Boolean value for static action, undefined for other actions\n\t// @param {boolean} [mParameters.isNavigable] Boolean value indicating whether navigation is required after the action has been executed\n\t// Currently the parameter isNavigable is used internally and should be changed to requiresNavigation as it is a more apt name for this param\n\n\t/**\n\t * Invokes an action (bound or unbound) and tracks the changes so that other pages can be refreshed and show the updated data upon navigation.\n\t * @param sActionName The name of the action to be called\n\t * @param mInParameters Contains the following attributes:\n\t * @param mInParameters.parameterValues A map of action parameter names and provided values\n\t * @param mInParameters.skipParameterDialog Skips the action parameter dialog if values are provided for all of them in parameterValues\n\t * @param mInParameters.contexts For a bound action, a context or an array with contexts for which the action is to be called must be provided\n\t * @param mInParameters.model For an unbound action, an instance of an OData V4 model must be provided\n\t * @param mInParameters.requiresNavigation Boolean value indicating whether navigation is required after the action has been executed. Navigation takes place to the context returned by the action\n\t * @param mInParameters.label A human-readable label for the action. This is needed in case the action has a parameter and a parameter dialog is shown to the user. The label will be used for the title of the dialog and for the confirmation button\n\t * @param mInParameters.invocationGrouping Mode how actions are to be called: 'ChangeSet' to put all action calls into one changeset, 'Isolated' to put them into separate changesets\n\t * @param mInParameters.isNavigable PRIVATE\n\t * @param mInParameters.entitySetName PRIVATE\n\t * @param mInParameters.operationAvailableMap PRIVATE\n\t * @param mInParameters.controlId PRIVATE\n\t * @param mInParameters.bStaticAction PRIVATE\n\t * @param mInParameters.applicableContexts PRIVATE\n\t * @param mInParameters.notApplicableContexts PRIVATE\n\t * @param mInParameters.enableAutoScroll PRIVATE\n\t * @param mInParameters.defaultValuesExtensionFunction PRIVATE\n\t * @param mExtraParams PRIVATE\n\t * @returns A promise which resolves once the action has been executed, providing the response\n\t * @public\n\t * @since 1.90.0\n\t * @final\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync invokeAction(\n\t\tsActionName: string,\n\t\tmInParameters?: {\n\t\t\tparameterValues?: { name: string; value: unknown }[];\n\t\t\tskipParameterDialog?: boolean;\n\t\t\tcontexts?: Context | Context[];\n\t\t\tmodel?: ODataModel;\n\t\t\trequiresNavigation?: boolean;\n\t\t\tlabel?: string;\n\t\t\tisNavigable?: boolean;\n\t\t\tentitySetName?: string;\n\t\t\tinvocationGrouping?: string;\n\t\t\toperationAvailableMap?: string;\n\t\t\tcontrolId?: string;\n\t\t\tbStaticAction?: boolean;\n\t\t\tapplicableContexts?: Context[];\n\t\t\tnotApplicableContexts?: Context[];\n\t\t\tenableAutoScroll?: boolean;\n\t\t\tdefaultValuesExtensionFunction?: string;\n\t\t},\n\t\tmExtraParams?: {}\n\t): Promise<unknown> {\n\t\tconst transactionHelper = this.getTransactionHelper();\n\t\tlet aParts;\n\t\tlet sOverloadEntityType;\n\t\tlet oCurrentActionCallBacks:\n\t\t\t| {\n\t\t\t\t\tfResolver: Function;\n\t\t\t\t\tfRejector: Function;\n\t\t\t  }\n\t\t\t| undefined;\n\t\tconst oView = this.base.getView();\n\n\t\t// Due to a mistake the invokeAction in the extensionAPI had a different API than this one.\n\t\t// The one from the extensionAPI doesn't exist anymore as we expose the full edit flow now but\n\t\t// due to compatibility reasons we still need to support the old signature\n\t\tif (\n\t\t\t((mInParameters as Context)?.isA && (mInParameters as Context)?.isA<Context>(\"sap.ui.model.odata.v4.Context\")) ||\n\t\t\tArray.isArray(mInParameters) ||\n\t\t\tmExtraParams !== undefined\n\t\t) {\n\t\t\tconst contexts: ODataV4Context | ODataV4Context[] | undefined = mInParameters as ODataV4Context | ODataV4Context[] | undefined;\n\t\t\tmInParameters = mExtraParams || {};\n\t\t\tif (contexts) {\n\t\t\t\tmInParameters.contexts = contexts;\n\t\t\t} else {\n\t\t\t\tmInParameters.model = this.base.getView().getModel();\n\t\t\t}\n\t\t}\n\n\t\tconst mParameters: {\n\t\t\tbindingParameters?: BindContextParameters;\n\t\t\tbStaticAction?: boolean;\n\t\t\tparameterValues?: Record<string, unknown>[];\n\t\t\tskipParameterDialog?: boolean;\n\t\t\tshowActionParameterDialog?: boolean;\n\t\t\tlabel?: string;\n\t\t\tinvocationGrouping?: string;\n\t\t\tentitySetName?: string;\n\t\t\tcontexts?: ODataV4Context | ODataV4Context[] | null;\n\t\t\tmodel?: ODataModel;\n\t\t\tparentControl: FEView;\n\t\t\tcontrolId?: string;\n\t\t\tisNavigable?: boolean;\n\t\t\tapplicableContexts?: Context[];\n\t\t\trequiresNavigation?: boolean;\n\t\t\tbObjectPage?: boolean;\n\t\t\tbIsCreateAction?: boolean;\n\t\t\toperationAvailableMap?: string;\n\t\t\tinternalModelContext?: InternalModelContext | null;\n\t\t\tgroupId?: string;\n\t\t\tdefaultValuesExtensionFunction?: string;\n\t\t\tenableAutoScroll?: boolean;\n\t\t\tisBound?: boolean;\n\t\t\tignoreETag?: boolean;\n\t\t} = { ...mInParameters, parentControl: this.base.getView() } || { parentControl: this.base.getView() };\n\n\t\tmParameters.isNavigable = mParameters.requiresNavigation || mParameters.isNavigable;\n\n\t\t// Determine if the referenced action is bound or unbound\n\t\tconst convertedMetadata = convertTypes(this.getView().getModel()?.getMetaModel() as ODataMetaModel);\n\t\t// The EntityContainer may NOT be missing, so it should not be able to be undefined, but since in our converted Metadata\n\t\t// it can be undefined, I need this workaround here of adding \"\" since indexOf does not accept something that's\n\t\t// undefined.\n\t\tif (sActionName.includes(\"\" + convertedMetadata.entityContainer.name)) {\n\t\t\t// Unbound actions are always referenced via the action import and we found the EntityContainer in the sActionName so\n\t\t\t// an unbound action is referenced!\n\t\t\tmParameters.isBound = false;\n\t\t} else {\n\t\t\t// No entity container in the sActionName, so either a bound or static action is referenced which is also bound!\n\t\t\tmParameters.isBound = true;\n\t\t}\n\n\t\tif (!mParameters.entitySetName && mParameters.contexts && mParameters.model) {\n\t\t\tmParameters.entitySetName = mParameters.model\n\t\t\t\t.getMetaModel()\n\t\t\t\t.getMetaContext((Array.isArray(mParameters.contexts) ? mParameters.contexts[0] : mParameters.contexts).getPath())\n\t\t\t\t.getObject(\"@sapui.name\");\n\t\t}\n\t\tlet oControl: Control | undefined;\n\t\tif (mParameters.controlId) {\n\t\t\toControl = this.getView().byId(mParameters.controlId) as Control;\n\t\t\tif (oControl) {\n\t\t\t\t// TODO: currently this selected contexts update is done within the operation, should be moved out\n\t\t\t\tmParameters.internalModelContext = oControl.getBindingContext(\"internal\") as InternalModelContext | null;\n\t\t\t}\n\t\t} else {\n\t\t\tmParameters.internalModelContext = oView.getBindingContext(\"internal\") as InternalModelContext | null;\n\t\t}\n\n\t\t// if sticky session is enabled we trigger actions without eTag\n\t\tmParameters.ignoreETag = mParameters.internalModelContext?.getProperty(\"/sessionOn\");\n\n\t\tif (sActionName && sActionName.includes(\"(\")) {\n\t\t\t// get entity type of action overload and remove it from the action path\n\t\t\t// Example sActionName = \"<ActionName>(Collection(<OverloadEntityType>))\"\n\t\t\t// sActionName = aParts[0] --> <ActionName>\n\t\t\t// sOverloadEntityType = aParts[2] --> <OverloadEntityType>\n\t\t\taParts = sActionName.split(\"(\");\n\t\t\tsActionName = aParts[0];\n\t\t\tsOverloadEntityType = aParts[aParts.length - 1].replaceAll(\")\", \"\");\n\t\t}\n\n\t\tif (mParameters.bStaticAction && oControl) {\n\t\t\tif (oControl.isA<Table>(\"sap.ui.mdc.Table\")) {\n\t\t\t\tconst tableAPI = oControl.getParent() as TableAPI;\n\t\t\t\tmParameters.contexts = (\n\t\t\t\t\tthis.getView().getModel()?.bindList(tableAPI.getRowBinding().getHeaderContext()!.getPath()) as ODataListBinding\n\t\t\t\t).getHeaderContext();\n\t\t\t}\n\n\t\t\tif (sOverloadEntityType && oControl.getBindingContext() && oControl.isA && oControl.isA<Table>(\"sap.ui.mdc.Table\")) {\n\t\t\t\tmParameters.contexts = this._getActionOverloadContextFromMetadataPath(\n\t\t\t\t\toControl.getBindingContext() as ODataV4Context,\n\t\t\t\t\toControl.getRowBinding(),\n\t\t\t\t\tsOverloadEntityType\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (mParameters.enableAutoScroll) {\n\t\t\t\toCurrentActionCallBacks = this.createActionPromise(sActionName, oControl.getId());\n\t\t\t}\n\t\t}\n\t\t// Need to know that the action is called from ObjectPage for changeSet Isolated workaround\n\t\tmParameters.bObjectPage = oView.getViewData().converterType === \"ObjectPage\";\n\n\t\ttry {\n\t\t\tawait this.syncTask();\n\t\t\tconst response = await transactionHelper.callAction(\n\t\t\t\tsActionName,\n\t\t\t\tmParameters,\n\t\t\t\tthis.getView(),\n\t\t\t\tthis.getAppComponent(),\n\t\t\t\tthis.getMessageHandler()\n\t\t\t);\n\t\t\tconst successFullExecution = response.filter(isFulfilled);\n\t\t\tif (response.length !== successFullExecution.length) {\n\t\t\t\t// Keep the same workflow than before\n\t\t\t\t// If at least one promise is rejected, we reject the whole promise\n\t\t\t\tthrow response;\n\t\t\t}\n\t\t\tlet listRefreshed: boolean | undefined;\n\t\t\tif (mParameters.contexts && Array.isArray(mParameters.contexts) && mParameters.isBound === true) {\n\t\t\t\tlistRefreshed = await this._refreshListIfRequired(\n\t\t\t\t\tthis.getActionResponseDataAndKeys(sActionName, successFullExecution),\n\t\t\t\t\tmParameters.contexts[0]\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (this.base.collaborativeDraft.isConnected()) {\n\t\t\t\tthis._sendActivity(\n\t\t\t\t\tActivity.Action,\n\t\t\t\t\tmParameters.contexts,\n\t\t\t\t\tsActionName,\n\t\t\t\t\tlistRefreshed,\n\t\t\t\t\tObject.keys(successFullExecution[0].value.boundContext.getObject())\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis._triggerConfiguredSurvey(sActionName, TriggerType.action);\n\n\t\t\tif (oCurrentActionCallBacks) {\n\t\t\t\toCurrentActionCallBacks.fResolver(successFullExecution);\n\t\t\t}\n\t\t\t/*\n\t\t\t\t\tWe set the (upper) pages to dirty after an execution of an action\n\t\t\t\t\tTODO: get rid of this workaround\n\t\t\t\t\tThis workaround is only needed as long as the model does not support the synchronization.\n\t\t\t\t\tOnce this is supported we don't need to set the pages to dirty anymore as the context itself\n\t\t\t\t\tis already refreshed (it's just not reflected in the object page)\n\t\t\t\t\twe explicitly don't call this method from the list report but only call it from the object page\n\t\t\t\t\tas if it is called in the list report it's not needed - as we anyway will remove this logic\n\t\t\t\t\twe can live with this\n\t\t\t\t\twe need a context to set the upper pages to dirty - if there are more than one we use the\n\t\t\t\t\tfirst one as they are anyway siblings\n\t\t\t\t\t*/\n\t\t\tif (mParameters.contexts) {\n\t\t\t\tif (!this._isFclEnabled() && this.base.getView().getViewData().converterType !== \"ListReport\") {\n\t\t\t\t\tEditState.setEditStateDirty();\n\t\t\t\t}\n\t\t\t\tthis.getInternalModel().setProperty(\"/lastInvokedAction\", sActionName);\n\t\t\t}\n\t\t\tif (mParameters.isNavigable) {\n\t\t\t\tif (successFullExecution.length === 1) {\n\t\t\t\t\tconst context = this._getBoundContext(oView, mParameters)\n\t\t\t\t\t\t? successFullExecution[0].value.boundContext\n\t\t\t\t\t\t: successFullExecution[0].value.returnedContext ?? successFullExecution[0].value.boundContext;\n\t\t\t\t\tconst oMetaModel = oView.getModel().getMetaModel();\n\t\t\t\t\tconst sContextMetaPath = oMetaModel.getMetaPath(context.getPath());\n\t\t\t\t\tconst _fnValidContexts = (contexts: Context[], applicableContexts?: Context[]): Context[] => {\n\t\t\t\t\t\treturn contexts.filter((element) => {\n\t\t\t\t\t\t\tif (applicableContexts) {\n\t\t\t\t\t\t\t\treturn applicableContexts.includes(element);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\t\t\t\t\tconst oActionContext = Array.isArray(mParameters.contexts)\n\t\t\t\t\t\t? _fnValidContexts(mParameters.contexts, mParameters.applicableContexts)[0]\n\t\t\t\t\t\t: mParameters.contexts;\n\t\t\t\t\tconst sActionContextMetaPath = oActionContext && oMetaModel.getMetaPath(oActionContext.getPath());\n\n\t\t\t\t\tif (sContextMetaPath != undefined && sContextMetaPath === sActionContextMetaPath) {\n\t\t\t\t\t\tif (oActionContext?.getPath() !== context.getPath()) {\n\t\t\t\t\t\t\tthis.getInternalRouting().navigateForwardToContext(context, {\n\t\t\t\t\t\t\t\tcheckNoHashChange: true\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// If the action returns a draft context, we already take care during navigation to either create a new\n\t\t\t\t\t\t\t// (full screen) or to use the list binding context after refresh (and not the return value context).\n\t\t\t\t\t\t\t// If the draft is discarded or activated, having the context still as dependent context cause issues\n\t\t\t\t\t\t\t// (e.g. if a side effect is triggered). Therefore, we destroy the return value context here,\n\t\t\t\t\t\t\t// and to be compatible we return a new context with the same path.\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tthis.getProgrammingModel(context) === ProgrammingModel.Draft &&\n\t\t\t\t\t\t\t\t(context.getProperty(\"IsActiveEntity\") === false || this._isFclEnabled())\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tcontext.getBinding().destroy();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tLog.info(\"Navigation to the same context is not allowed\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.base.editFlow.onAfterActionExecution(sActionName);\n\n\t\t\t// Keep this weird returned value for compatibility reasons\n\t\t\t// invokeAction is public and we can't change the returned value for the action\n\t\t\tif (!Array.isArray(mInParameters?.contexts) && successFullExecution.length === 1) {\n\t\t\t\treturn successFullExecution[0].value.returnedContext ?? successFullExecution[0].value.boundContext;\n\t\t\t}\n\t\t\treturn successFullExecution.map((oResult) => {\n\t\t\t\treturn { ...oResult, ...{ value: oResult.value.returnedContext ?? oResult.value.boundContext } };\n\t\t\t});\n\t\t} catch (err: unknown) {\n\t\t\tif (oCurrentActionCallBacks) {\n\t\t\t\toCurrentActionCallBacks.fRejector();\n\t\t\t}\n\t\t\tif (err === Constants.CancelActionDialog) {\n\t\t\t\tthrow new Error(\"Dialog cancelled\");\n\t\t\t}\n\t\t\tthrow err;\n\t\t}\n\t}\n\n\t/**\n\t * Hook which can be overridden after the action execution.\n\t * @param _actionName Name of the action\n\t * @since 1.114.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.After)\n\tasync onAfterActionExecution(_actionName: string): Promise<void> {\n\t\t//to be overridden\n\t}\n\n\t/**\n\t * This function can be used to execute code on the mass edit save.\n\t * You can execute custom coding in this function.\n\t * If you decide to do your own save processing, you can return `true` to prevent the default save behavior.\n\t *\n\t * This function is meant to be individually overridden by consuming controllers but not to be called directly.\n\t * The override execution is: {@link sap.ui.core.mvc.OverrideExecution.Instead}.\n\t * @param _mParameters Object containing the parameters passed to customMassEditSave\n\t * @param _mParameters.aContexts Array containing the selected contexts for the mass edit\n\t * @param _mParameters.oUpdateData A dictionary containing the propertyPath and its value\n\t * @returns `true` to prevent the default execution, `false` to keep the standard behavior\n\t * @public\n\t * @since 1.130.0\n\t */\n\t@publicExtension()\n\t@extensible(OverrideExecution.Instead)\n\tasync customMassEditSave(_mParameters: { aContexts: Context[]; oUpdateData: Record<string, unknown> }): Promise<boolean> {\n\t\t// to be overridden\n\t\treturn Promise.resolve(false);\n\t}\n\n\t/**\n\t * Secured execution of the given function. Ensures that the function is only executed when certain conditions are fulfilled.\n\t * @param fnFunction The function to be executed. Should return a promise that is settled after completion of the execution. If nothing is returned, immediate completion is assumed.\n\t * @param mParameters Definitions of the preconditions to be checked before execution\n\t * @param mParameters.busy Defines the busy indicator\n\t * @param mParameters.busy.set Triggers a busy indicator when the function is executed.\n\t * @param mParameters.busy.check Executes function only if application isn't busy.\n\t * @param mParameters.updatesDocument This operation updates the current document without using the bound model and context. As a result, the draft status is updated if a draft document exists, and the user has to confirm the cancellation of the editing process.\n\t * @returns A promise that is rejected if the execution is prohibited and resolved by the promise returned by the fnFunction.\n\t * @public\n\t * @since 1.90.0\n\t */\n\t@publicExtension()\n\t@finalExtension()\n\tasync securedExecution(\n\t\tfnFunction: Function,\n\t\tmParameters?: {\n\t\t\tbusy?: {\n\t\t\t\tset?: boolean;\n\t\t\t\tcheck?: boolean;\n\t\t\t};\n\t\t\tupdatesDocument?: boolean;\n\t\t}\n\t): Promise<void> {\n\t\tconst bBusySet = mParameters?.busy?.set ?? true,\n\t\t\tbBusyCheck = mParameters?.busy?.check ?? true,\n\t\t\tbUpdatesDocument = mParameters?.updatesDocument ?? false,\n\t\t\toLockObject = this.getGlobalUIModel(),\n\t\t\toContext = this.getView().getBindingContext(),\n\t\t\tbIsDraft = oContext && this.getProgrammingModel(oContext as Context) === ProgrammingModel.Draft,\n\t\t\tmessageHandlingKey = this.getMessageHandler().registerToHoldMessages();\n\n\t\tif (bBusyCheck && BusyLocker.isLocked(oLockObject)) {\n\t\t\treturn Promise.reject(\"Application already busy therefore execution rejected\");\n\t\t}\n\n\t\t// we have to set busy and draft indicator immediately also the function might be executed later in queue\n\t\tif (bBusySet) {\n\t\t\tBusyLocker.lock(oLockObject);\n\t\t}\n\t\tif (bUpdatesDocument && bIsDraft) {\n\t\t\tthis.setDraftStatus(DraftStatus.Saving);\n\t\t}\n\n\t\tthis.getMessageHandler().removeTransitionMessages();\n\n\t\treturn this.syncTask(fnFunction as () => unknown | Promise<unknown>)\n\t\t\t.then(() => {\n\t\t\t\tif (bUpdatesDocument) {\n\t\t\t\t\tthis.setDocumentModified(true);\n\t\t\t\t\tif (!this._isFclEnabled()) {\n\t\t\t\t\t\tEditState.setEditStateDirty();\n\t\t\t\t\t}\n\t\t\t\t\tif (bIsDraft) {\n\t\t\t\t\t\tthis.setDraftStatus(DraftStatus.Saved);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t})\n\t\t\t.catch((oError: unknown): void => {\n\t\t\t\tif (bUpdatesDocument && bIsDraft) {\n\t\t\t\t\tthis.setDraftStatus(DraftStatus.Clear);\n\t\t\t\t}\n\t\t\t\tthrow oError;\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tif (bBusySet) {\n\t\t\t\t\tBusyLocker.unlock(oLockObject);\n\t\t\t\t}\n\t\t\t\tthis.getMessageHandler().showMessageDialog({ unHoldKey: messageHandlingKey });\n\t\t\t});\n\t}\n\n\t/**\n\t * Handles the patchSent event: register document modification.\n\t * @param oEvent The event sent by the binding\n\t */\n\thandlePatchSent(oEvent: ODataContextBinding$PatchSentEvent): void {\n\t\t// In collaborative draft or sticky session, disable ETag check for PATCH requests\n\t\tconst internalContext = this.getView()?.getBindingContext(\"internal\") as InternalModelContext;\n\t\tconst ignoreETag = this.base.collaborativeDraft.isConnected() || internalContext.getProperty(\"/sessionOn\");\n\n\t\tif (ignoreETag) {\n\t\t\t((oEvent.getSource() as Binding).getModel() as ODataModel).setIgnoreETag(true);\n\t\t}\n\t\tif (!internalContext?.getProperty(\"skipPatchHandlers\")) {\n\t\t\tconst sourceBinding = oEvent.getSource() as unknown as ODataListBinding; // FIXME: UI5 type says this should be an ODataContextBinding\n\t\t\t// Create a promise that will be resolved or rejected when the path is completed\n\t\t\tconst oPatchPromise = new Promise<void>((resolve, reject) => {\n\t\t\t\toEvent.getSource().attachEventOnce(\"patchCompleted\", (patchCompletedEvent: UI5Event<{ success: boolean }>) => {\n\t\t\t\t\t// Re-enable ETag checks\n\t\t\t\t\tif (ignoreETag) {\n\t\t\t\t\t\t((oEvent.getSource() as Binding).getModel() as ODataModel).setIgnoreETag(false);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (oEvent.getSource().isA(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\t\t\t\tActionRuntime.setActionEnablementAfterPatch(\n\t\t\t\t\t\t\tthis.getView(),\n\t\t\t\t\t\t\tsourceBinding,\n\t\t\t\t\t\t\tthis.getView()?.getBindingContext(\"internal\") as InternalModelContext\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tconst bSuccess = patchCompletedEvent.getParameter(\"success\");\n\t\t\t\t\tif (bSuccess) {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.updateDocument(sourceBinding, oPatchPromise);\n\t\t}\n\t}\n\n\t/**\n\t * Handles the createSent event: register document modification.\n\t * @param event The event sent by the binding\n\t */\n\thandleCreateSent(event: UI5Event<{ context: Context }>): void {\n\t\tconst context = event.getParameter(\"context\");\n\t\tthis.getMessageHandler().removeTransitionMessages(false, false, context.getPath());\n\t}\n\n\t/**\n\t * Performs a task in sync with other tasks created via this function.\n\t * Returns the promise chain of the task.\n\t * @param [newTask] Optional, a promise or function to be executed synchronously\n\t * @returns Promise resolves once the task is completed\n\t */\n\tasync syncTask<T>(newTask?: (() => T) | Promise<T>): Promise<T> {\n\t\tif (newTask) {\n\t\t\tif (typeof newTask === \"function\") {\n\t\t\t\tthis.syncTasks = this.syncTasks.then(newTask).catch(function (err: unknown) {\n\t\t\t\t\tLog.debug(err as string);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.syncTasks = this.syncTasks\n\t\t\t\t\t.then(async () => newTask)\n\t\t\t\t\t.catch(function (err: unknown) {\n\t\t\t\t\t\tLog.debug(err as string);\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn this.syncTasks as Promise<T>;\n\t}\n\n\t/**\n\t * updates the UI and internal models according the edit mode .\n\t * @param oContext The context to be displayed or edited\n\t * @returns {Promise} Promise resolves once the edit mode is computed\n\t */\n\n\tasync computeModelsForEditMode(context: Context): Promise<void> {\n\t\tconst programmingModel = this.getProgrammingModel(context);\n\n\t\tif (programmingModel === ProgrammingModel.Draft) {\n\t\t\tif (this.getInternalModel().getProperty(\"/executeShareActionForCollaboration\")) {\n\t\t\t\tshareObject(context);\n\t\t\t\tthis.getInternalModel().setProperty(\"/executeShareActionForCollaboration\", false);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tthis.setDraftStatus(DraftStatus.Clear);\n\t\t\t\tconst globalModel = this.getGlobalUIModel();\n\t\t\t\tglobalModel.setProperty(\"/isEditablePending\", true, undefined, true);\n\t\t\t\tconst isActiveEntity = await context.requestObject(\"IsActiveEntity\");\n\t\t\t\tif (isActiveEntity === false) {\n\t\t\t\t\t// in case the document is draft set it in edit mode\n\t\t\t\t\tthis.setEditMode(EditMode.Editable);\n\t\t\t\t\tconst hasActiveEntity = await context.requestObject(\"HasActiveEntity\");\n\t\t\t\t\tthis.setEditMode(undefined, !hasActiveEntity);\n\t\t\t\t} else {\n\t\t\t\t\t// active document, stay on display mode\n\t\t\t\t\tthis.setEditMode(EditMode.Display, false);\n\t\t\t\t}\n\t\t\t\tglobalModel.setProperty(\"/isEditablePending\", false, undefined, true);\n\t\t\t} catch (error: unknown) {\n\t\t\t\tLog.error(\"Error while determining the editMode for draft\", error as string);\n\t\t\t}\n\t\t} else if (programmingModel === ProgrammingModel.Sticky) {\n\t\t\tconst lastInvokedActionName = this.getInternalModel().getProperty(\"/lastInvokedAction\");\n\t\t\tif (lastInvokedActionName && this.isNewActionForSticky(lastInvokedActionName, context)) {\n\t\t\t\tthis.setEditMode(EditMode.Editable, true);\n\t\t\t\tif (!this.getAppComponent()._isFclEnabled()) {\n\t\t\t\t\tEditState.setEditStateDirty();\n\t\t\t\t}\n\t\t\t\tthis.handleStickyOn(context);\n\t\t\t\tthis._setStickySessionInternalProperties(this.getProgrammingModel(context), context.getModel());\n\t\t\t\tthis.getInternalModel().setProperty(\"/lastInvokedAction\", undefined);\n\t\t\t}\n\t\t}\n\t}\n\n\t//////////////////////////////////////\n\t// Private methods\n\t//////////////////////////////////////\n\n\t/**\n\t * Internal method to delete a context or an array of contexts.\n\t * @param contexts The context(s) to be deleted\n\t * @param parameters Parameters for deletion\n\t * @param parameters.beforeDeleteCallBack\n\t * @param parameters.requestSideEffects\n\t * @param parameters.controlId\n\t * @param parameters.parentControl\n\t * @param parameters.bFindActiveContexts\n\t * @param parameters.selectedContexts\n\t * @param parameters.internalModelContext\n\t * @param parameters.noDialog\n\t * @param parameters.title\n\t * @param parameters.description\n\t * @param parameters.entitySetName\n\t * @param parameters.numberOfSelectedContexts\n\t * @param parameters.unSavedContexts\n\t * @param parameters.lockedContexts\n\t * @param parameters.draftsWithDeletableActive\n\t * @param parameters.draftsWithNonDeletableActive\n\t */\n\tprivate async deleteDocumentTransaction(\n\t\tcontexts: Context | Context[],\n\t\tparameters: {\n\t\t\tbeforeDeleteCallBack?: Function;\n\t\t\trequestSideEffects?: boolean;\n\t\t\tcontrolId?: string;\n\t\t\tparentControl?: Control;\n\t\t\tbFindActiveContexts?: boolean;\n\t\t\tnoDialog?: boolean;\n\t\t\tselectedContexts?: Context[];\n\t\t\tinternalModelContext?: InternalModelContext | null;\n\t\t\ttitle?: string;\n\t\t\tdescription?: string | { path: string };\n\t\t\tentitySetName?: string;\n\t\t\tnumberOfSelectedContexts?: number;\n\t\t\tunSavedContexts?: Context[];\n\t\t\tlockedContexts?: Context[];\n\t\t\tdraftsWithDeletableActive?: DraftSiblingPair[];\n\t\t\tdraftsWithNonDeletableActive?: Context[];\n\t\t}\n\t): Promise<void> {\n\t\tif (parameters.selectedContexts) {\n\t\t\t// as selected contexts may include inactive context we need to compute this parameter again to ensure delete helper works properly\n\t\t\tparameters.numberOfSelectedContexts = parameters.selectedContexts.length;\n\t\t}\n\t\tconst resourceModel = this._getResourceModel();\n\t\tconst transactionHelper = this.getTransactionHelper();\n\n\t\t// TODO: this setting and removing of contexts shouldn't be in the transaction helper at all\n\t\t// for the time being I kept it and provide the internal model context to not break something\n\t\tif (parameters.controlId) {\n\t\t\tconst sourceControl = Element.getElementById(parameters.controlId);\n\t\t\tif (sourceControl && !sourceControl.isA<MultiValueField>(\"sap.ui.mdc.MultiValueField\")) {\n\t\t\t\t// In case the delete is triggered from a MultiValueField, we don't use the internal model context as the MVF doesn't have\n\t\t\t\t// such a context of its own, and we don't want to use its parent context (e.g. from the embedding Table)\n\t\t\t\tparameters.internalModelContext = sourceControl.getBindingContext(\"internal\");\n\t\t\t}\n\t\t}\n\n\t\tawait this.syncTask();\n\t\tawait transactionHelper.deleteDocument(contexts, parameters, this.getAppComponent(), resourceModel, this.getMessageHandler());\n\t}\n\n\t_getResourceModel(): ResourceModel {\n\t\treturn getResourceModel(this.getView());\n\t}\n\n\tprivate getTransactionHelper(): typeof TransactionHelper {\n\t\treturn TransactionHelper;\n\t}\n\n\tprivate getMessageHandler(): MessageHandler {\n\t\tif (this.base.messageHandler) {\n\t\t\treturn this.base.messageHandler;\n\t\t} else {\n\t\t\tthrow new Error(\"Edit Flow works only with a given message handler\");\n\t\t}\n\t}\n\n\tprivate getInternalModel(): JSONModel {\n\t\treturn this.getView().getModel(\"internal\") as JSONModel;\n\t}\n\n\tprivate getGlobalUIModel(): JSONModel {\n\t\treturn this.getView().getModel(\"ui\") as JSONModel;\n\t}\n\n\tprivate getPageInternalModel(): JSONModel {\n\t\treturn this.getView().getModel(\"pageInternal\") as JSONModel;\n\t}\n\n\t/**\n\t * Sets that the current page contains a newly created object.\n\t * @param bCreationMode True if the object is new\n\t */\n\tprivate setCreationMode(bCreationMode: boolean): void {\n\t\tconst pageInternalContext = this.getView().getBindingContext(\"pageInternal\") as Context;\n\t\tthis.getPageInternalModel().setProperty(UiModelConstants.CreateMode, bCreationMode, pageInternalContext, true);\n\t}\n\n\t/**\n\t * Indicates whether the current page contains a newly created object or not.\n\t * @returns True if the object is new\n\t */\n\tgetCreationMode(): boolean {\n\t\tconst pageInternalContext = this.getView().getBindingContext(\"pageInternal\") as Context;\n\t\treturn !!pageInternalContext.getProperty(UiModelConstants.CreateMode);\n\t}\n\n\t/**\n\t * Indicates whether the object being edited (or one of its sub-objects) has been modified or not.\n\t * @returns True if the object has been modified\n\t */\n\tprivate isDocumentModified(): boolean {\n\t\treturn !!this.getGlobalUIModel().getProperty(UiModelConstants.DocumentModified);\n\t}\n\n\t/**\n\t * Sets that the object being edited (or one of its sub-objects) has been modified.\n\t * @param modified True if the object has been modified\n\t */\n\tprivate setDocumentModified(modified: boolean): void {\n\t\tthis.getGlobalUIModel().setProperty(UiModelConstants.DocumentModified, modified);\n\t}\n\n\t/**\n\t * Sets that the object being edited has been modified by creating a sub-object.\n\t * @param listBinding The list binding on which the object has been created\n\t */\n\tprivate setDocumentModifiedOnCreate(listBinding: ODataListBinding): void {\n\t\t// Set the modified flag only on relative listBindings, i.e. when creating a sub-object\n\t\t// If the listBinding is not relative, then it's a creation from the ListReport, and by default a newly created root object isn't considered as modified\n\t\tif (listBinding.isRelative()) {\n\t\t\tthis.setDocumentModified(true);\n\t\t}\n\t}\n\n\t/**\n\t * Handles the create event: shows messages and in case of a draft, updates the draft indicator.\n\t * @param binding OData list binding object\n\t */\n\tprivate handleCreateEvents(binding: ODataListBinding): void {\n\t\tthis.setDraftStatus(DraftStatus.Clear);\n\n\t\tconst programmingModel = this.getProgrammingModel(binding);\n\t\tlet messageHandlingKey: string;\n\n\t\tbinding.attachEvent(\"createSent\", () => {\n\t\t\tif (programmingModel === ProgrammingModel.Draft) {\n\t\t\t\tthis.setDraftStatus(DraftStatus.Saving);\n\t\t\t}\n\t\t\tmessageHandlingKey = this.getMessageHandler().registerToHoldMessages();\n\t\t});\n\t\tbinding.attachEvent(\"createCompleted\", (oEvent: UI5Event<{ success: boolean }>): void => {\n\t\t\tconst success = oEvent.getParameter(\"success\");\n\t\t\tif (programmingModel === ProgrammingModel.Draft) {\n\t\t\t\tthis.setDraftStatus(success ? DraftStatus.Saved : DraftStatus.Clear);\n\t\t\t}\n\t\t\tthis.getMessageHandler().showMessageDialog({ unHoldKey: messageHandlingKey });\n\t\t});\n\t}\n\n\t/**\n\t * Updates the draft status message (displayed at the bottom of the page).\n\t * @param draftStatus The draft status message\n\t */\n\tsetDraftStatus(draftStatus: string): void {\n\t\t(this.getView().getModel(\"ui\") as JSONModel).setProperty(\"/draftStatus\", draftStatus, undefined, true);\n\t}\n\n\t/**\n\t * Gets the programming model from a binding or a context.\n\t * @param source The binding or context\n\t * @returns The programming model\n\t */\n\tprivate getProgrammingModel(source: Context | Binding): typeof ProgrammingModel {\n\t\treturn this.getTransactionHelper().getProgrammingModel(source);\n\t}\n\n\t/**\n\t * Sets the edit mode.\n\t * @param editMode The edit mode\n\t * @param isCreation True if the object has been newly created\n\t */\n\tprivate setEditMode(editMode?: string, isCreation?: boolean): void {\n\t\t// at this point of time it's not meant to release the edit flow for freestyle usage therefore we can\n\t\t// rely on the global UI model to exist\n\t\tconst globalModel = this.getGlobalUIModel();\n\n\t\tif (editMode) {\n\t\t\tglobalModel.setProperty(\"/isEditable\", editMode === \"Editable\", undefined, true);\n\t\t\tif (editMode !== \"Editable\") {\n\t\t\t\tthis.forceDraftSaveOrDiscard(false);\n\t\t\t}\n\t\t}\n\n\t\tif (isCreation !== undefined) {\n\t\t\t// Since setCreationMode is public in EditFlow and can be overriden, make sure to call it via the controller\n\t\t\t// to ensure any overrides are taken into account\n\t\t\tthis.setCreationMode(isCreation);\n\t\t}\n\t}\n\n\t/**\n\t * Sets the flag to force Save or Discard when leaving a draft.\n\t * @param forced\n\t */\n\tprivate forceDraftSaveOrDiscard(forced: boolean): void {\n\t\tthis.getGlobalUIModel().setProperty(\"/forceDraftSaveOrDiscard\", forced, undefined, true);\n\t}\n\n\t/**\n\t * Checks if we should force the user to Save or Discard when leaving a draft, or if keeping the draft is allowed.\n\t * @returns True if keeping the draft is not allowed\n\t */\n\tshallForceDraftSaveOrDiscard(): boolean {\n\t\treturn this.getGlobalUIModel().getProperty(\"/forceDraftSaveOrDiscard\") === true;\n\t}\n\n\t/**\n\t * Checks if an action corresponds to a create action for a sticky session.\n\t * @param actionName The name of the action\n\t * @param context Context for the sticky session\n\t * @returns True if the action is a create action\n\t */\n\tprivate isNewActionForSticky(actionName: string, context: Context): boolean {\n\t\ttry {\n\t\t\tconst metaModel = context.getModel().getMetaModel();\n\t\t\tconst metaContext = metaModel.getMetaContext(context.getPath());\n\t\t\tconst entitySet = getInvolvedDataModelObjects(metaContext).startingEntitySet as EntitySet;\n\t\t\tconst stickySession = entitySet.annotations.Session?.StickySessionSupported;\n\t\t\tif (stickySession?.NewAction === actionName) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (stickySession?.AdditionalNewActions && stickySession?.AdditionalNewActions.includes(actionName)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t} catch (error: unknown) {\n\t\t\tLog.info(error as string);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t// TODO Move all sticky-related below to a sticky session manager class\n\n\t/**\n\t * Enables the sticky edit session.\n\t * @param context The context being edited\n\t * @returns True in case of success, false otherwise\n\t */\n\tprivate async handleStickyOn(context: Context): Promise<boolean> {\n\t\tconst appComponent = this.getAppComponent();\n\n\t\ttry {\n\t\t\tif (appComponent === undefined) {\n\t\t\t\tthrow new Error(\"undefined AppComponent for function handleStickyOn\");\n\t\t\t}\n\n\t\t\tif (!appComponent.getRouterProxy().hasNavigationGuard()) {\n\t\t\t\tconst hashTracker = appComponent.getRouterProxy().getHash();\n\t\t\t\tconst internalModel = this.getInternalModel();\n\n\t\t\t\t// Set a guard in the RouterProxy\n\t\t\t\t// A timeout is necessary, as with deferred creation the hashChanger is not updated yet with\n\t\t\t\t// the new hash, and the guard cannot be found in the managed history of the router proxy\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tappComponent.getRouterProxy().setNavigationGuard(context.getPath().substring(1));\n\t\t\t\t}, 0);\n\n\t\t\t\t// Setting back navigation on shell service, to get the dicard message box in case of sticky\n\t\t\t\tawait appComponent.getShellServices().setBackNavigation(this.onBackNavigationInSession.bind(this, context));\n\n\t\t\t\t// Attach sticky session callbacks\n\t\t\t\tconst i18nModel = this.base.getView().getModel(\"sap.fe.i18n\");\n\t\t\t\tappComponent.registerStickySessionCallbacks(\n\t\t\t\t\tthis.getDirtyStateProvider(appComponent, internalModel, hashTracker),\n\t\t\t\t\tthis.getSessionTimeoutFunction(context, i18nModel),\n\t\t\t\t\tthis.getRouteMatchedFunction(context, appComponent)\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.info(error as string);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Disables the sticky edit session.\n\t * @returns True in case of success, false otherwise\n\t */\n\tprivate handleStickyOff(): boolean {\n\t\tconst appComponent = this.getAppComponent();\n\t\ttry {\n\t\t\tif (appComponent === undefined) {\n\t\t\t\tthrow new Error(\"undefined AppComponent for function handleStickyOff\");\n\t\t\t}\n\n\t\t\tif (appComponent.getRouterProxy) {\n\t\t\t\t// If we have exited from the app, CommonUtils.getAppComponent doesn't return a\n\t\t\t\t// sap.fe.core.AppComponent, hence the 'if' above\n\t\t\t\tappComponent.getRouterProxy().discardNavigationGuard();\n\t\t\t}\n\n\t\t\tif (appComponent.unregisterStickySessionCallbacks) {\n\t\t\t\t// If we have exited from the app, CommonUtils.getAppComponent doesn't return a\n\t\t\t\t// sap.fe.core.AppComponent, hence the 'if' above\n\t\t\t\tappComponent.unregisterStickySessionCallbacks();\n\t\t\t}\n\n\t\t\tthis.setEditMode(EditMode.Display, false);\n\n\t\t\tif (appComponent.getShellServices) {\n\t\t\t\t// If we have exited from the app, CommonUtils.getAppComponent doesn't return a\n\t\t\t\t// sap.fe.core.AppComponent, hence the 'if' above\n\t\t\t\tappComponent.getShellServices().setBackNavigation();\n\t\t\t}\n\t\t} catch (error: unknown) {\n\t\t\tLog.info(error as string);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t_setStickySessionInternalProperties(programmingModel: string, model: ODataModel): void {\n\t\tif (programmingModel === ProgrammingModel.Sticky) {\n\t\t\tconst internalModel = this.getInternalModel();\n\t\t\tinternalModel.setProperty(\"/sessionOn\", true);\n\t\t\tinternalModel.setProperty(\"/stickySessionToken\", model.getHttpHeaders(true)[\"SAP-ContextId\"]);\n\t\t}\n\t}\n\n\t/**\n\t * Returns a callback function to be used as a DirtyStateProvider in the Shell.\n\t * @param appComponent The app component\n\t * @param internalModel The model \"internal\"\n\t * @param hashTracker Hash tracker\n\t * @returns The callback function\n\t */\n\tprivate getDirtyStateProvider(appComponent: AppComponent, internalModel: JSONModel, hashTracker: string) {\n\t\treturn (navigationContext: { innerAppRoute: string }): boolean | undefined => {\n\t\t\ttry {\n\t\t\t\tif (navigationContext === undefined) {\n\t\t\t\t\tthrow new Error(\"Invalid input parameters for DirtyStateProvider function\");\n\t\t\t\t}\n\n\t\t\t\tconst targetHash = navigationContext.innerAppRoute;\n\t\t\t\tconst routerProxy = appComponent.getRouterProxy();\n\t\t\t\tlet lclHashTracker = \"\";\n\t\t\t\tlet isDirty: boolean;\n\t\t\t\tconst isSessionOn = internalModel.getProperty(\"/sessionOn\");\n\n\t\t\t\tif (!isSessionOn) {\n\t\t\t\t\t// If the sticky session was terminated before hand.\n\t\t\t\t\t// Example in case of navigating away from application using IBN.\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tif (!routerProxy.isNavigationFinalized()) {\n\t\t\t\t\t// If navigation is currently happening in RouterProxy, it's a transient state\n\t\t\t\t\t// (not dirty)\n\t\t\t\t\tisDirty = false;\n\t\t\t\t\tlclHashTracker = targetHash;\n\t\t\t\t} else if (hashTracker === targetHash) {\n\t\t\t\t\t// the hash didn't change so either the user attempts to refresh or to leave the app\n\t\t\t\t\tisDirty = true;\n\t\t\t\t} else if (routerProxy.checkHashWithGuard(targetHash) || routerProxy.isGuardCrossAllowedByUser()) {\n\t\t\t\t\t// the user attempts to navigate within the root object\n\t\t\t\t\t// or crossing the guard has already been allowed by the RouterProxy\n\t\t\t\t\tlclHashTracker = targetHash;\n\t\t\t\t\tisDirty = false;\n\t\t\t\t} else {\n\t\t\t\t\t// the user attempts to navigate within the app, for example back to the list report\n\t\t\t\t\tisDirty = true;\n\t\t\t\t}\n\n\t\t\t\tif (isDirty) {\n\t\t\t\t\t// the FLP doesn't call the dirty state provider anymore once it's dirty, as they can't\n\t\t\t\t\t// change this due to compatibility reasons we set it back to not-dirty\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tappComponent.getShellServices().setDirtyFlag(false);\n\t\t\t\t\t}, 0);\n\t\t\t\t} else {\n\t\t\t\t\thashTracker = lclHashTracker;\n\t\t\t\t}\n\n\t\t\t\treturn isDirty;\n\t\t\t} catch (error: unknown) {\n\t\t\t\tLog.info(error as string);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Returns a callback function to be used when a sticky session times out.\n\t * @param stickyContext The context for the sticky session\n\t * @param i18nModel\n\t * @returns The callback function\n\t */\n\tprivate getSessionTimeoutFunction(stickyContext: Context, i18nModel: Model) {\n\t\treturn (): undefined | boolean => {\n\t\t\ttry {\n\t\t\t\tif (stickyContext === undefined) {\n\t\t\t\t\tthrow new Error(\"Context missing for SessionTimeout function\");\n\t\t\t\t}\n\t\t\t\t// remove transient messages since we will showing our own message\n\t\t\t\tthis.getMessageHandler().removeTransitionMessages();\n\n\t\t\t\tconst warningDialog = new Dialog({\n\t\t\t\t\ttitle: \"{sap.fe.i18n>C_EDITFLOW_OBJECT_PAGE_SESSION_EXPIRED_DIALOG_TITLE}\",\n\t\t\t\t\tstate: \"Warning\",\n\t\t\t\t\tcontent: new Text({ text: \"{sap.fe.i18n>C_EDITFLOW_OBJECT_PAGE_SESSION_EXPIRED_DIALOG_MESSAGE}\" }),\n\t\t\t\t\tbeginButton: new Button({\n\t\t\t\t\t\ttext: \"{sap.fe.i18n>C_COMMON_DIALOG_OK}\",\n\t\t\t\t\t\ttype: \"Emphasized\",\n\t\t\t\t\t\tpress: (): void => {\n\t\t\t\t\t\t\t// remove sticky handling after navigation since session has already been terminated\n\t\t\t\t\t\t\tthis.handleStickyOff();\n\t\t\t\t\t\t\tthis.getInternalRouting().navigateBackFromContext(stickyContext);\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tafterClose: function (): void {\n\t\t\t\t\t\twarningDialog.destroy();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\twarningDialog.addStyleClass(\"sapUiContentPadding\");\n\t\t\t\twarningDialog.setModel(i18nModel, \"sap.fe.i18n\");\n\t\t\t\tthis.getView().addDependent(warningDialog);\n\t\t\t\twarningDialog.open();\n\t\t\t} catch (error: unknown) {\n\t\t\t\tLog.info(error as string);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t}\n\n\t/**\n\t * Returns a callback function for the onRouteMatched event in case of sticky edition.\n\t * @param context The context being edited (root of the sticky session)\n\t * @param appComponent The app component\n\t * @returns The callback function\n\t */\n\tprivate getRouteMatchedFunction(context: Context, appComponent: AppComponent) {\n\t\treturn (): void => {\n\t\t\tconst currentHash = appComponent.getRouterProxy().getHash();\n\t\t\t// either current hash is empty so the user left the app or he navigated away from the object\n\t\t\tif (!currentHash || !appComponent.getRouterProxy().checkHashWithGuard(currentHash)) {\n\t\t\t\tthis.discardStickySession(context);\n\t\t\t\tcontext.getModel().clearSessionContext();\n\t\t\t}\n\t\t};\n\t}\n\n\t/**\n\t * Ends a sticky session by discarding changes.\n\t * @param context The context being edited (root of the sticky session)\n\t */\n\tprivate async discardStickySession(context: Context): Promise<void> {\n\t\tconst discardedContext = await sticky.discardDocument(context);\n\t\tif (discardedContext?.hasPendingChanges()) {\n\t\t\tdiscardedContext.getBinding().resetChanges();\n\t\t}\n\t\tif (!this.getCreationMode()) {\n\t\t\tdiscardedContext?.refresh();\n\t\t}\n\n\t\tthis.handleStickyOff();\n\t}\n\n\t/**\n\t * Gets the internal routing extension.\n\t * @returns The internal routing extension\n\t */\n\tprivate getInternalRouting(): InternalRouting {\n\t\tif (this.base._routing) {\n\t\t\treturn this.base._routing;\n\t\t} else {\n\t\t\tthrow new Error(\"Edit Flow works only with a given routing listener\");\n\t\t}\n\t}\n\n\t_getRootViewController(): RootViewBaseController {\n\t\treturn this.getAppComponent().getRootViewController();\n\t}\n\n\t_getSemanticMapping(): SemanticMapping | undefined {\n\t\treturn this.getAppComponent().getRoutingService().getLastSemanticMapping();\n\t}\n\n\t/**\n\t * Creates a new promise to wait for an action to be executed.\n\t * @param actionName The name of the action\n\t * @param controlId The ID of the control\n\t * @returns The resolver function which can be used to externally resolve the promise\n\t */\n\tprivate createActionPromise(actionName: string, controlId: string): { fResolver: Function; fRejector: Function } {\n\t\tlet resolveFunction: Function, rejectFunction: Function;\n\t\tthis.actionPromise = new Promise<PromiseFulfilledResult<OperationResult>[]>((resolve, reject) => {\n\t\t\tresolveFunction = resolve;\n\t\t\trejectFunction = reject;\n\t\t}).then((response: PromiseFulfilledResult<OperationResult>[]) => {\n\t\t\treturn Object.assign({ controlId }, this.getActionResponseDataAndKeys(actionName, response));\n\t\t});\n\t\treturn { fResolver: resolveFunction!, fRejector: rejectFunction! };\n\t}\n\n\t/**\n\t *\n\t * @param actionName The name of the action that is executed\n\t * @param response The bound action's response data or response context\n\t * @returns Object with data and names of the key fields of the response\n\t */\n\tprivate getActionResponseDataAndKeys(\n\t\tactionName: string,\n\t\tresponse: PromiseFulfilledResult<OperationResult>[]\n\t): { oData: Record<string, unknown>; keys: string[] } | undefined {\n\t\tif (response.length >= 1) {\n\t\t\tconst currentView = this.base.getView();\n\t\t\tconst metaModelData = (currentView.getModel().getMetaModel().getData() ?? {}) as Record<string, unknown>;\n\t\t\tconst metaModelAction = metaModelData[actionName] as MetaModelAction[] | undefined;\n\t\t\tconst actionReturnType = metaModelAction?.[0].$ReturnType ? metaModelAction?.[0].$ReturnType.$Type : null;\n\t\t\tconst keys =\n\t\t\t\tactionReturnType && (metaModelData[actionReturnType] as MetaModelEntityType)\n\t\t\t\t\t? (metaModelData[actionReturnType] as MetaModelEntityType).$Key\n\t\t\t\t\t: [];\n\t\t\treturn {\n\t\t\t\toData: response[0].value.boundContext.getObject(),\n\t\t\t\tkeys\n\t\t\t};\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tasync getCurrentActionPromise(): Promise<{ controlId?: string; oData: Record<string, unknown>; keys: string[] } | undefined> {\n\t\treturn this.actionPromise;\n\t}\n\n\tdeleteCurrentActionPromise(): void {\n\t\tthis.actionPromise = undefined;\n\t}\n\n\tasync showConfirmRecommendationsDialog(isSave: boolean): Promise<RecommendationDialogDecision | undefined> {\n\t\tif (!this.confirmRecommendationsDialog) {\n\t\t\tthis.confirmRecommendationsDialog = new ConfirmRecommendationDialog({\n\t\t\t\tview: this.getView()\n\t\t\t});\n\t\t}\n\t\treturn this.confirmRecommendationsDialog?.open(isSave);\n\t}\n\n\t_scrollAndFocusOnInactiveRow(table: Table): void {\n\t\tconst rowBinding = table.getRowBinding();\n\t\tconst activeRowIndex: number = rowBinding.getCount() || 0;\n\t\tif (table.data(\"tableType\") !== \"ResponsiveTable\") {\n\t\t\tif (activeRowIndex > 0) {\n\t\t\t\ttable.scrollToIndex(activeRowIndex - 1);\n\t\t\t}\n\t\t\ttable.focusRow(activeRowIndex, true);\n\t\t} else {\n\t\t\t/* In a responsive table, the empty rows appear at the beginning of the table. But when we create more, they appear below the new line.\n\t\t\t * So we check the first inactive row first, then we set the focus on it when we press the button.\n\t\t\t * This doesn't impact the GridTable because they appear at the end, and we already focus the before-the-last row (because 2 empty rows exist)\n\t\t\t */\n\t\t\tconst allRowContexts = rowBinding.getContexts();\n\t\t\tif (!allRowContexts?.length) {\n\t\t\t\ttable.focusRow(activeRowIndex, true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet focusRow = activeRowIndex,\n\t\t\t\tindex = 0;\n\t\t\tfor (const singleContext of allRowContexts) {\n\t\t\t\tif (singleContext.isInactive() && index < focusRow) {\n\t\t\t\t\tfocusRow = index;\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t}\n\t\t\tif (focusRow > 0) {\n\t\t\t\ttable.scrollToIndex(focusRow);\n\t\t\t}\n\t\t\ttable.focusRow(focusRow, true);\n\t\t}\n\t}\n\n\tasync createEmptyRowsAndFocus(table: Table): Promise<void> {\n\t\tconst tableAPI = table.getParent() as TableAPI;\n\t\tif (\n\t\t\ttableAPI?.tableDefinition?.control?.inlineCreationRowsHiddenInEditMode &&\n\t\t\t!table.getBindingContext(\"pageInternal\")?.getProperty(\"createMode\")\n\t\t) {\n\t\t\t// With the parameter, we don't have empty rows in Edit mode, so we need to create them before setting the focus on them\n\t\t\tawait tableAPI.setUpEmptyRows(table, true);\n\t\t}\n\t\tthis._scrollAndFocusOnInactiveRow(table);\n\t}\n\n\t_sendActivity(\n\t\taction: Activity,\n\t\trelatedContexts: Context | Context[] | null | undefined,\n\t\ttriggeredActionName?: string,\n\t\trefreshListBinding?: boolean,\n\t\tactionRequestedProperties?: string[]\n\t): void {\n\t\tconst content = Array.isArray(relatedContexts) ? relatedContexts.map((context) => context.getPath()) : relatedContexts?.getPath();\n\t\tthis.base.collaborativeDraft.send({ action, content, triggeredActionName, refreshListBinding, actionRequestedProperties });\n\t}\n\n\t_triggerConfiguredSurvey(sActionName: string, triggerType: TriggerType): void {\n\t\ttriggerConfiguredSurvey(this.base.getView(), sActionName, triggerType);\n\t}\n\n\tasync _submitOpenChanges(oContext: Context): Promise<void> {\n\t\tconst oModel = oContext.getModel(),\n\t\t\toLockObject = this.getGlobalUIModel();\n\n\t\ttry {\n\t\t\t// Submit any leftover changes that are not yet submitted\n\t\t\t// Currently we are using only 1 updateGroupId, hence submitting the batch directly here\n\t\t\tawait oModel.submitBatch(\"$auto\");\n\n\t\t\t// Wait for all currently running changes\n\t\t\t// For the time being we agreed with the v4 model team to use an internal method. We'll replace it once\n\t\t\t// a public or restricted method was provided\n\t\t\tawait (oModel.oRequestor as unknown as { waitForRunningChangeRequests: Function }).waitForRunningChangeRequests(\"$auto\");\n\n\t\t\t// Check if all changes were submitted successfully\n\t\t\tif (oModel.hasPendingChanges(\"$auto\")) {\n\t\t\t\tthrow new Error(\"submit of open changes failed\");\n\t\t\t}\n\t\t} finally {\n\t\t\tif (BusyLocker.isLocked(oLockObject)) {\n\t\t\t\tBusyLocker.unlock(oLockObject);\n\t\t\t}\n\t\t}\n\t}\n\n\t_removeStickySessionInternalProperties(programmingModel: string): void {\n\t\tif (programmingModel === ProgrammingModel.Sticky) {\n\t\t\tconst internalModel = this.getInternalModel();\n\t\t\tinternalModel.setProperty(\"/sessionOn\", false);\n\t\t\tinternalModel.setProperty(\"/stickySessionToken\", undefined);\n\t\t\tthis.handleStickyOff();\n\t\t}\n\t}\n\n\t/**\n\t * Method to display a 'discard' popover when exiting a sticky session.\n\t * @param context\n\t */\n\tprivate onBackNavigationInSession(context: Context): void {\n\t\tconst view = this.base.getView();\n\t\tconst routerProxy = this.getAppComponent().getRouterProxy();\n\n\t\tif (routerProxy.checkIfBackIsOutOfGuard()) {\n\t\t\tsticky.processDataLossConfirmation(\n\t\t\t\tasync () => {\n\t\t\t\t\tawait this.discardStickySession(context);\n\t\t\t\t\tthis._removeStickySessionInternalProperties(ProgrammingModel.Sticky);\n\t\t\t\t\thistory.back();\n\t\t\t\t},\n\t\t\t\tview,\n\t\t\t\tProgrammingModel.Sticky\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\t\thistory.back();\n\t}\n\n\tasync _handleNewContext(\n\t\toContext: Context,\n\t\tnavigationParameters: { editable: boolean; recreateContext: boolean; forceFocus?: boolean }\n\t): Promise<void> {\n\t\tif (!this._isFclEnabled()) {\n\t\t\tEditState.setEditStateDirty();\n\t\t}\n\n\t\tawait this.getInternalRouting().navigateToContext(oContext, {\n\t\t\tcheckNoHashChange: true,\n\t\t\teditable: navigationParameters.editable,\n\t\t\tpersistOPScroll: true,\n\t\t\trecreateContext: navigationParameters.recreateContext,\n\t\t\treason: NavigationReason.EditFlowAction,\n\t\t\tshowPlaceholder: false,\n\t\t\tforceFocus: navigationParameters.forceFocus ?? false,\n\t\t\tkeepCurrentLayout: true\n\t\t});\n\t}\n\n\t/**\n\t * Checks if there are validation (parse) errors for controls bound to a given context.\n\t * @param view The view\n\t * @param params The parameters\n\t * @param params.controlId The ID of the control\n\t * @param params.isNavigable True if the action is navigable\n\t * @returns True if the action needs to returns the bound context, false otherwise\n\t */\n\t_getBoundContext(view: FEView, params: { controlId?: string; isNavigable?: boolean }): boolean {\n\t\t//This weird condition is needed to avoid navigation in case of some actions into the table\n\t\t// this definitely needs to be refactored to get clear condition where navigation needs to be done or not\n\t\t// SNOW: DINC0278490\n\t\tconst viewLevel = view.getViewData().viewLevel;\n\t\tconst bRefreshAfterAction = viewLevel > 1 || (viewLevel === 1 && params.controlId);\n\t\treturn !params.isNavigable || !!bRefreshAfterAction;\n\t}\n\n\t/**\n\t * Checks if there are validation (parse) errors for controls bound to a given context\n\t * @returns {Promise} Promise resolves if there are no validation errors, and rejects if there are validation errors\n\t */\n\n\tasync _checkForValidationErrors(): Promise<string | undefined | void> {\n\t\treturn this.syncTask().then(() => {\n\t\t\tconst sViewId = this.getView().getId();\n\t\t\tconst aMessages = Messaging.getMessageModel().getData();\n\t\t\tlet oControl;\n\n\t\t\tif (!aMessages.length) {\n\t\t\t\tLog.info(\"No validation errors found\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (const message of aMessages) {\n\t\t\t\tif (message.validation) {\n\t\t\t\t\toControl = Element.getElementById(message.getControlId());\n\t\t\t\t\twhile (oControl) {\n\t\t\t\t\t\tif (oControl.getId() === sViewId) {\n\t\t\t\t\t\t\tthrow \"validation errors exist\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\toControl = oControl.getParent();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t});\n\t}\n\n\t/**\n\t * @param oResponse The response of the bound action and the names of the key fields\n\t * @param oResponse.oData\n\t * @param oResponse.keys\n\t * @param oContext The bound context on which the action was executed\n\t * @returns True Promise if the list was refreshed\n\t */\n\tasync _refreshListIfRequired(\n\t\toResponse?: { oData?: Record<string, unknown>; keys?: string[] | null },\n\t\toContext?: Context\n\t): Promise<boolean> {\n\t\tif (!oContext || !oResponse || !oResponse.oData || !oResponse.keys) {\n\t\t\treturn false;\n\t\t}\n\t\tconst oBinding = oContext.getBinding();\n\t\t// refresh only lists\n\t\tif (oBinding && oBinding.isA<ODataListBinding>(\"sap.ui.model.odata.v4.ODataListBinding\")) {\n\t\t\tconst oContextData = oResponse.oData;\n\t\t\tconst aKeys = oResponse.keys;\n\t\t\tconst oCurrentData = oContext.getObject();\n\t\t\tlet bReturnedContextIsSame = true;\n\t\t\t// ensure context is in the response\n\t\t\tif (Object.keys(oContextData).length) {\n\t\t\t\t// check if context in response is different than the bound context\n\t\t\t\tbReturnedContextIsSame = aKeys.every(function (sKey: string): boolean {\n\t\t\t\t\treturn oCurrentData[sKey] === oContextData[sKey];\n\t\t\t\t});\n\t\t\t\tif (!bReturnedContextIsSame) {\n\t\t\t\t\tawait this.getTransactionHelper().refreshListBinding(oBinding, this.getAppComponent());\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// resolve with oResponse to not disturb the promise chain afterwards\n\t\treturn false;\n\t}\n\n\tasync _fetchSemanticKeyValues(oContext: Context): Promise<void> {\n\t\tconst oMetaModel = oContext.getModel().getMetaModel(),\n\t\t\tsEntitySetName = oMetaModel.getMetaContext(oContext.getPath()).getObject(\"@sapui.name\"),\n\t\t\taSemanticKeys = SemanticKeyHelper.getSemanticKeys(oMetaModel, sEntitySetName);\n\n\t\tif (aSemanticKeys && aSemanticKeys.length) {\n\t\t\tconst paths = aSemanticKeys.map((oKey) => oKey.$PropertyPath);\n\t\t\tawait oContext.requestProperty(paths);\n\t\t}\n\t}\n\n\t/**\n\t * Provides the latest context in the metadata hierarchy from rootBinding to given context pointing to given entityType\n\t * if any such context exists. Otherwise, it returns the original context.\n\t * Note: It is only needed as work-around for incorrect modelling. Correct modelling would imply a DataFieldForAction in a LineItem\n\t * to point to an overload defined either on the corresponding EntityType or a collection of the same.\n\t * @param rootContext The context to start searching from\n\t * @param listBinding The listBinding of the table\n\t * @param overloadEntityType The ActionOverload entity type to search for\n\t * @returns Returns the context of the ActionOverload entity\n\t */\n\t_getActionOverloadContextFromMetadataPath(rootContext: Context, listBinding: ODataListBinding, overloadEntityType: string): Context {\n\t\tconst model: ODataModel = rootContext.getModel();\n\t\tconst metaModel: ODataMetaModel = model.getMetaModel();\n\t\tlet contextSegments: string[] = listBinding.getPath().split(\"/\");\n\t\tlet currentContext: Context = rootContext;\n\n\t\t// We expect that the last segment of the listBinding is the ListBinding of the table. Remove this from contextSegments\n\t\t// because it is incorrect to execute bindContext on a list. We do not anyway need to search this context for the overload.\n\t\tcontextSegments.pop();\n\t\tif (contextSegments.length === 0) {\n\t\t\tcontextSegments = [\"\"]; // Don't leave contextSegments undefined\n\t\t}\n\n\t\tif (contextSegments[0] !== \"\") {\n\t\t\tcontextSegments.unshift(\"\"); // to also get the root context, i.e. the bindingContext of the table\n\t\t}\n\t\t// load all the parent contexts into an array\n\t\tconst parentContexts: Context[] = contextSegments\n\t\t\t.map((pathSegment: string) => {\n\t\t\t\tif (pathSegment !== \"\") {\n\t\t\t\t\tcurrentContext = model.bindContext(pathSegment, currentContext).getBoundContext();\n\t\t\t\t} else {\n\t\t\t\t\t// Creating a new context using bindContext(...).getBoundContext() does not work if the etag is needed. According to model colleagues,\n\t\t\t\t\t// we should always use an existing context if possible.\n\t\t\t\t\t// Currently, the only example we know about is using the rootContext - and in this case, we can obviously reuse that existing context.\n\t\t\t\t\t// If other examples should come up, the best possible work around would be to request some data to get an existing context. To keep the\n\t\t\t\t\t// request as small and fast as possible, we should request only the first key property. As this would introduce asynchronism, and anyway\n\t\t\t\t\t// the whole logic is only part of work-around for incorrect modelling, we wait until we have an example needing it before implementing this.\n\t\t\t\t\tcurrentContext = rootContext;\n\t\t\t\t}\n\t\t\t\treturn currentContext;\n\t\t\t})\n\t\t\t.reverse();\n\t\t// search for context backwards\n\t\tconst overloadContext: Context | undefined = parentContexts.find(\n\t\t\t(parentContext: Context) =>\n\t\t\t\t(metaModel.getMetaContext(parentContext.getPath()).getObject(\"$Type\") as unknown as string) === overloadEntityType\n\t\t);\n\t\treturn overloadContext || listBinding.getHeaderContext()!;\n\t}\n\n\t_createSiblingInfo(currentContext: Context, newContext: Context): SiblingInformation {\n\t\treturn {\n\t\t\ttargetContext: newContext,\n\t\t\tpathMapping: [\n\t\t\t\t{\n\t\t\t\t\toldPath: currentContext.getPath(),\n\t\t\t\t\tnewPath: newContext.getPath()\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\t}\n\n\t_updatePathsInHistory(mappings: { oldPath: string; newPath: string }[]): void {\n\t\tconst oAppComponent = this.getAppComponent();\n\t\toAppComponent.getRouterProxy().setPathMapping(mappings);\n\n\t\t// Also update the semantic mapping in the routing service\n\t\tconst lastSemanticMapping = this._getSemanticMapping();\n\t\tif (mappings.length && lastSemanticMapping?.technicalPath === mappings[mappings.length - 1].oldPath) {\n\t\t\tlastSemanticMapping.technicalPath = mappings[mappings.length - 1].newPath;\n\t\t}\n\t}\n\n\t_getNavigationTargetForEdit(\n\t\tcontext: Context,\n\t\tnewDocumentContext: Context,\n\t\tsiblingInfo: SiblingInformation | undefined\n\t): Context | undefined {\n\t\tlet contextToNavigate: Context | undefined;\n\t\tsiblingInfo = siblingInfo ?? this._createSiblingInfo(context, newDocumentContext);\n\t\tthis._updatePathsInHistory(siblingInfo.pathMapping);\n\t\tif (siblingInfo.targetContext.getPath() != newDocumentContext.getPath()) {\n\t\t\tcontextToNavigate = context.getPath() === siblingInfo.targetContext.getPath() ? context : siblingInfo.targetContext;\n\t\t}\n\t\treturn contextToNavigate;\n\t}\n\n\t/**\n\t * This method creates a sibling context for a subobject page, and calculates a sibling path\n\t * for all intermediate paths between the object page and the subobject page.\n\t * @param rootCurrentContext The context for the root of the draft\n\t * @param rightmostCurrentContext The context of the subobject\n\t * @param sProgrammingModel The programming model\n\t * @param doNotComputeIfRoot If true, we don't compute siblingInfo if the root and the rightmost contexts are the same\n\t * @param rootContextInfo The root context information of root of the draft\n\t * @param groupId\n\t * @returns Returns the siblingInformation object\n\t */\n\tasync _computeSiblingInformation(\n\t\trootCurrentContext: Context,\n\t\trightmostCurrentContext: Context | null | undefined,\n\t\tsProgrammingModel: string,\n\t\tdoNotComputeIfRoot: boolean,\n\t\trootContextInfo?: RootContextInfo,\n\t\tgroupId?: string\n\t): Promise<SiblingInformation | undefined> {\n\t\trightmostCurrentContext = rightmostCurrentContext ?? rootCurrentContext;\n\t\tif (!rightmostCurrentContext.getPath().startsWith(rootCurrentContext.getPath())) {\n\t\t\t// Wrong usage !!\n\t\t\tLog.error(\"Cannot compute rightmost sibling context\");\n\t\t\tthrow new Error(\"Cannot compute rightmost sibling context\");\n\t\t}\n\t\tlet rightMostContextToUse = rightmostCurrentContext;\n\t\tif (sProgrammingModel === ProgrammingModel.Draft && this.getProgrammingModel(rightmostCurrentContext) !== ProgrammingModel.Draft) {\n\t\t\t// we check the rightMostCurrentContext can be used in draft\n\t\t\trightMostContextToUse = rootCurrentContext;\n\t\t}\n\t\tif (doNotComputeIfRoot && rightMostContextToUse.getPath() === rootCurrentContext.getPath()) {\n\t\t\treturn Promise.resolve(undefined);\n\t\t}\n\n\t\tconst model = rootCurrentContext.getModel();\n\t\tif (sProgrammingModel === ProgrammingModel.Draft) {\n\t\t\treturn draft.computeSiblingInformation(rootCurrentContext, rightMostContextToUse, rootContextInfo, groupId);\n\t\t} else {\n\t\t\t// If not in draft mode, we just recreate a context from the path of the rightmost context\n\t\t\t// No path mapping is needed\n\t\t\treturn {\n\t\t\t\ttargetContext: model.bindContext(rightmostCurrentContext.getPath()).getBoundContext(),\n\t\t\t\tpathMapping: []\n\t\t\t};\n\t\t}\n\t}\n\n\t_isFclEnabled(): boolean {\n\t\treturn this.getAppComponent()._isFclEnabled();\n\t}\n\n\tasync checkRecommendationOption(): Promise<RecommendationDialogDecision | undefined> {\n\t\t//The existing recommendations check is now present further in the flow for showing confirmation dialog\n\t\tconst recommendationOptionChoosen = await this.showConfirmRecommendationsDialog(true);\n\t\tif (recommendationOptionChoosen === RecommendationDialogDecision.Continue) {\n\t\t\treturn Promise.reject(RecommendationDialogDecision.Continue);\n\t\t}\n\t\treturn recommendationOptionChoosen;\n\t}\n}\n\nexport default EditFlow;\n"],"mappings":"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","ignoreList":[]}