/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/EditState","sap/fe/core/helpers/ModelHelper","../../controls/DataLossOrDraftDiscard/DraftDataLossDialog","../../controls/Recommendations/ConfirmRecommendationDialog"],function(e,t,a,n,i,o){"use strict";var r=o.RecommendationDialogDecision;var s=function(e){e["BackNavigation"]="BackNavigation";e["ForwardNavigation"]="ForwardNavigation";return e}(s||{});var c=function(e){e["Save"]="draftDataLossOptionSave";e["Keep"]="draftDataLossOptionKeep";e["Discard"]="draftDataLossOptionDiscard";return e}(c||{});const l=new i("fe::DraftDataLossPopup");function d(e){const t=e.getAppComponent().getManifestEntry("sap.fe");return t?.app?.silentlyKeepDraftOnForwardNavigation||false}async function f(e,t,a,n,i,o){if(e.CreationDateTime!==e.LastChangeDateTime){return l.open(a).then(e=>y.handleDialogSelection(e,n,t,a,i,o))}else{n()}}async function g(t,n,i,o,r,c,d,f){if(a.isEditStateDirty()){if(t.CreationDateTime===t.LastChangeDateTime&&r===s.BackNavigation){try{await y.discardDraft(i,d,f);o()}catch(t){e.error("Error while canceling the document",t)}}else if(r===s.ForwardNavigation&&c){o()}else{return l.open(i).then(e=>y.handleDialogSelection(e,o,n,i,d,f))}}else{o()}}async function D(t,a,n,i){if(i===s.BackNavigation){const i={skipDiscardPopover:true,skipBindingToView:true};try{await t.editFlow.cancelDocument(a,i);n()}catch(t){e.error("Error while canceling the document",t)}}else{n()}}async function u(e,t,a,n,i,o,r){if(n===s.ForwardNavigation&&i){a()}else{return l.open(e).then(n=>y.handleDialogSelection(n,a,t,e,o,r))}}async function p(e,t,n,i,o,r){let c=arguments.length>6&&arguments[6]!==undefined?arguments[6]:s.BackNavigation;const l=o.collaborativeDraft.isConnected();const p=!l?t:function(){o.collaborativeDraft.disconnect();for(var e=arguments.length,a=new Array(e),n=0;n<e;n++){a[n]=arguments[n]}t.apply(null,...a)};const v=d(o);if(e){if(o.getAppComponent().getRootViewController().isFclEnabled()){await f(e,n,o,p,r,i)}else if(!i.getObject().HasActiveEntity){g(e,n,o,p,c,v,r)}else if(e.CreationDateTime===e.LastChangeDateTime){D(o,i,p,c)}else if(a.isEditStateDirty()){u(o,n,p,c,v,r,i)}else{p()}}else{t()}}async function v(a,i,o,r,c){let l=arguments.length>5&&arguments[5]!==undefined?arguments[5]:s.BackNavigation;const d=r.getView();const f=d.getBindingContext().getModel();const g=f.getMetaModel();const D=d.getViewData();const u=D.contextPath||(D.entitySet?`/${D.entitySet}`:undefined);const v=u?!!g.getObject(`${u}@com.sap.vocabularies.Common.v1.DraftRoot`):false;const m=t.getIsEditable(d);const h=o;let w=o.getPath();if(!v){w=n.getDraftRootPath(o)??w;o=f.bindContext(w,undefined,{$expand:"DraftAdministrativeData"}).getBoundContext()}const y=v||r.getAppComponent().getRouterProxy().checkIfBackExitsApp();if(h.isDeleted()||!y&&l===s.BackNavigation||!m){a()}else{try{await o.requestProperty(["DraftAdministrativeData/CreationDateTime","DraftAdministrativeData/LastChangeDateTime","HasActiveEntity"]);const e=o.getObject("DraftAdministrativeData");await p(e,a,i,o,r,c,l)}catch(t){e.error("Cannot retrieve draftDataContext information",t);a()}}}async function m(e,t){const a=t!==undefined;t=t??e.getView().getBindingContext();if(!a&&e.isA("sap.fe.templates.ObjectPage.ObjectPageController")){return e._saveDocument()}else{return e.editFlow.saveDocument(t,{})}}async function h(e,t,a){a=a??e.getView().getBindingContext();const n={skipBackNavigation:true,skipDiscardPopover:true,skipBindingToView:t!==undefined?t:true};return e.editFlow.cancelDocument(a,n)}function w(t,a,n,i,o,s){switch(t){case c.Save:y.saveDocument(i,s).then(e=>a(e)).catch(function(t){if(t===r.Continue){return n()}e.error("Error while saving document",t)});l.close();break;case c.Keep:a();l.close();break;case c.Discard:y.discardDraft(i,o,s).then(e=>a(e)).catch(function(t){e.error("Error while discarding draft",t)});l.close();break;default:n();l.close()}}const y={processDataLossOrDraftDiscardConfirmation:v,silentlyKeepDraftOnForwardNavigation:d,NavigationType:s,processFclMode:f,processNoActiveEntityMode:g,processEditingDraftForExistingEntity:D,processEditStateDirty:u,handleDialogSelection:w,saveDocument:m,discardDraft:h};return y},false);
//# sourceMappingURL=draftDataLossPopup.js.map