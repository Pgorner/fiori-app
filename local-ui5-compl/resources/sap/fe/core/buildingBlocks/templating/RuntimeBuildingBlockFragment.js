/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/base/BindingToolkit","sap/fe/base/ClassSupport","sap/fe/base/HookSupport","sap/fe/base/jsx-runtime/jsx","sap/fe/core/CommonUtils","sap/m/Label","sap/ui/base/ManagedObject","sap/ui/core/Component","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,n,r,o,i,a,l,s,u){"use strict";var c,f,p,d,g,m,b,y,w,v,C,M,h;var D={};var O=n.initControllerExtensionHookHandlers;var j=t.event;var k=t.defineUI5Class;var z=t.aggregation;var H=e.resolveBindingString;function _(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function x(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,N(e,t)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function P(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}function A(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let B=(c=k("sap.fe.core.buildingBlocks.templating.RuntimeBuildingBlockFragment"),f=j(),p=z({type:"sap.ui.core.Control"}),d=z({type:"sap.ui.core.Control[]",multiple:true}),g=z({type:"sap.ui.core.CustomData[]",multiple:true}),m=z({type:"sap.ui.core.LayoutData"}),c(b=(y=function(e){function t(){var t;for(var n=arguments.length,r=new Array(n),o=0;o<n;o++){r[o]=arguments[o]}t=e.call(this,...r)||this;_(t,"functionHolder",w,t);_(t,"fragmentXML",v,t);_(t,"dependents",C,t);_(t,"customDataHolder",M,t);_(t,"layoutData",h,t);return t}D=t;x(t,e);return t}(s),w=P(y.prototype,"functionHolder",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),v=P(y.prototype,"fragmentXML",[p],{configurable:true,enumerable:true,writable:true,initializer:null}),C=P(y.prototype,"dependents",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),M=P(y.prototype,"customDataHolder",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),h=P(y.prototype,"layoutData",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),y))||b);D=B;const E={};function L(e){E[`${e.metadata.namespace??e.metadata.publicNamespace}.${e.metadata.name}`]=e}D.storeRuntimeBlock=L;B.registerType("FE_COMPONENTS",{load:async function(e){let t;try{t=await E[e.fragmentName].load()}catch(t){e.loadErrorMessage=t}return t},init:function(e){if(e.loadErrorMessage){return new i({text:e.loadErrorMessage})}let t=e.fragmentContent;if(t===undefined){t=E[e.fragmentName]}if(t===undefined){throw new Error(`No building block class for runtime building block ${e.fragmentName} found`)}const n={};const s=e.customData?.[0]?.mProperties?.value?.["sap.fe.core.buildingBlocks.templating"]||{};delete e.customData;const c=e.functionHolder??[];delete e.functionHolder;const f=e.containingView.getController?.()?.getView?.()??e.containingView.getController?.()?.["_view"]??e.containingView;const p=l.getOwnerComponentFor(f);const d=o.getAppComponent(f);const g=d.getMetaModel();const m=p.getModel("_pageModel");const b=s.functionStringInOrder?.split(",");const y=s.propertiesAssignedToFunction?.split(",")??[];for(const e in t.metadata.properties){const r=t.metadata.properties[e];const o=m.createBindingContext(s[e]);if(o===null){let t=s[e];if(typeof t==="string"){if(r.bindable!==true){switch(r.type){case"boolean":t=t==="true";break;case"number":t=Number(t);break}}else{t=H(t,r.type)}}else if(r.type==="function"){const n=y.indexOf(e);if(n>-1){const e=b[n];const r=c?.find(t=>t[0]?._sapui_handlerName===e);if(r&&r.length>1){t=r[0].bind(r[1])}}}n[e]=t}else if(o.getObject()!==undefined&&e!=="contextPath"&&e!=="metaPath"){n[e]=o.getObject()}else{n[e]=g.createBindingContext(s[e])}}return a.runWithPreprocessors(()=>{const o=r.withContext({view:f,appComponent:d},()=>{const r={models:{"sap.fe.i18n":f.getModel("sap.fe.i18n"),converterContext:f.getModel("_pageModel")??new u},appComponent:d,isRuntimeInstantiation:true};const o=new t(n,{},r);O(o,f.getController());if(e.fragmentXML){if(e.dependents){for(const t of e.dependents){e.fragmentXML.addDependent(t)}delete e.dependents}if(e.customDataHolder){for(const t of e.customDataHolder){e.fragmentXML.addCustomData(t)}delete e.customDataHolder}if(e.layoutData){e.fragmentXML.setAggregation("layoutData",e.layoutData);delete e.layoutData}}return o.getContent?.(f,d,e.fragmentXML)});if(!this._bAsync){this._aContent=o}return o},{id:function(t){return e.containingView.createId(t)},settings:function(t){const n=this.getMetadata().getAllAssociations();for(const r of Object.keys(n)){if(t[r]!==undefined){if(n[r].multiple){const n=Array.isArray(t[r])?t[r]:[t[r]];t[r]=n.map(t=>typeof t==="string"?e.containingView.createId(t):t)}else{const n=t[r];t[r]=typeof n==="string"?e.containingView.createId(n):n}}}return t}})}});return D},false);
//# sourceMappingURL=RuntimeBuildingBlockFragment.js.map