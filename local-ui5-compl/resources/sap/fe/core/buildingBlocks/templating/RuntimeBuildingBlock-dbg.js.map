{"version":3,"names":["RuntimeBuildingBlock","_BuildingBlockTemplat","apply","arguments","_exports","_inheritsLoose","_proto","prototype","getContent","containingView","appComponent","defaultAggregationContent","register","registerBuildingBlock","storeRuntimeBlock","load","metadata","libraries","Promise","all","map","libraryName","Library","name","e","errorMessage","join","Log","error","Error","resolve","getTemplate","_oNode","getRuntimeBuildingBlockTemplate","constructor","className","namespace","publicNamespace","extraProps","functionHolderDefinition","propertiesAssignedToFunction","functionStringInOrder","propertiesKey","properties","propertyValue","undefined","isContext","getPath","type","push","xml","length","innerTemplate","id","addConditionally","BuildingBlockTemplatingBase","isRuntime"],"sourceRoot":".","sources":["RuntimeBuildingBlock.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { XMLProcessorTypeValue } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport { registerBuildingBlock, xml } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport BuildingBlockTemplatingBase from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplatingBase\";\nimport { storeRuntimeBlock } from \"sap/fe/core/buildingBlocks/templating/RuntimeBuildingBlockFragment\";\nimport { isContext } from \"sap/fe/core/helpers/TypeGuards\";\nimport type Control from \"sap/ui/core/Control\";\nimport Library from \"sap/ui/core/Lib\";\nimport type View from \"sap/ui/core/mvc/View\";\n\n/**\n * Base class for runtime building blocks\n */\nexport default class RuntimeBuildingBlock extends BuildingBlockTemplatingBase {\n\tpublic static readonly isRuntime = true;\n\n\tgetContent?(containingView: View, appComponent: AppComponent, defaultAggregationContent?: Control): Control | undefined {\n\t\treturn defaultAggregationContent;\n\t}\n\n\tstatic register(): void {\n\t\tregisterBuildingBlock(this);\n\t\tstoreRuntimeBlock(this);\n\t}\n\n\tpublic static async load(): Promise<typeof this> {\n\t\tif (this.metadata.libraries) {\n\t\t\t// Required before usage to ensure the library is loaded and not each file individually\n\t\t\ttry {\n\t\t\t\tawait Promise.all(this.metadata.libraries.map(async (libraryName) => Library.load({ name: libraryName })));\n\t\t\t} catch (e) {\n\t\t\t\tconst errorMessage = `Couldn't load building block ${\n\t\t\t\t\tthis.metadata.name\n\t\t\t\t} please make sure the following libraries are available ${this.metadata.libraries.join(\",\")}`;\n\t\t\t\tLog.error(errorMessage);\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(this);\n\t}\n\n\tpublic getTemplate(_oNode?: Element): string {\n\t\treturn \"\";\n\t}\n\n\tpublic getRuntimeBuildingBlockTemplate(_oNode?: Element): string | Promise<string | undefined> | undefined {\n\t\tconst metadata = (this.constructor as typeof BuildingBlockTemplatingBase).metadata;\n\n\t\tconst className = `${metadata.namespace ?? metadata.publicNamespace}.${metadata.name}`;\n\t\tconst extraProps = [];\n\t\t// Function are defined as string but need to be resolved by UI5, as such we store them in an `event` property and will redispatch them later\n\t\tconst functionHolderDefinition = [];\n\t\tconst propertiesAssignedToFunction = [];\n\t\tconst functionStringInOrder = [];\n\t\tfor (const propertiesKey in metadata.properties) {\n\t\t\tlet propertyValue = this[propertiesKey as keyof this] as unknown as XMLProcessorTypeValue;\n\t\t\tif (propertyValue !== undefined && propertyValue !== null) {\n\t\t\t\tif (isContext(propertyValue)) {\n\t\t\t\t\tpropertyValue = propertyValue.getPath();\n\t\t\t\t}\n\t\t\t\tif (metadata.properties[propertiesKey].type === \"function\") {\n\t\t\t\t\tfunctionHolderDefinition.push(propertyValue);\n\t\t\t\t\tfunctionStringInOrder.push(propertyValue);\n\t\t\t\t\tpropertiesAssignedToFunction.push(propertiesKey);\n\t\t\t\t} else {\n\t\t\t\t\textraProps.push(xml`feBB:${propertiesKey}=\"${propertyValue}\"`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (functionHolderDefinition.length > 0) {\n\t\t\textraProps.push(xml`functionHolder=\"${functionHolderDefinition.join(\";\")}\"`);\n\t\t\textraProps.push(xml`feBB:functionStringInOrder=\"${functionStringInOrder.join(\",\")}\"`);\n\t\t\textraProps.push(xml`feBB:propertiesAssignedToFunction=\"${propertiesAssignedToFunction.join(\",\")}\"`);\n\t\t}\n\t\tconst innerTemplate = this.getTemplate(_oNode);\n\t\treturn xml`<feBB:RuntimeBuildingBlockFragment\n\t\t\t\t\txmlns:core=\"sap.ui.core\"\n\t\t\t\t\txmlns:feBB=\"sap.fe.core.buildingBlocks.templating\"\n\t\t\t\t\tfragmentName=\"${className}\"\n\t\t\t\t\tid=\"${this.id}\"\n\t\t\t\t\ttype=\"FE_COMPONENTS\"\n\t\t\t\t\t${extraProps.length > 0 ? extraProps : \"\"}\n\t\t\t\t>\n\t\t\t\t${this.addConditionally(\n\t\t\t\t\tinnerTemplate.length > 0,\n\t\t\t\t\t`<feBB:fragmentXML>\n\t\t\t\t\t\t${innerTemplate}\n\t\t\t\t\t</feBB:fragmentXML>`\n\t\t\t\t)}\n\t\t\t\t<feBB:dependents>\n\t\t\t\t\t<slot name=\"dependents\"/>\n\t\t\t\t</feBB:dependents>\n\t\t\t\t<feBB:customDataHolder>\n\t\t\t\t\t<slot name=\"customData\"/>\n\t\t\t\t</feBB:customDataHolder>\n\t\t\t\t<feBB:layoutData>\n\t\t\t\t\t<slot name=\"layoutData\"/>\n\t\t\t\t</feBB:layoutData>\n\t\t\t\t</feBB:RuntimeBuildingBlockFragment>`;\n\t}\n}\n"],"mappings":"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","ignoreList":[],"file":"RuntimeBuildingBlock-dbg.js"}