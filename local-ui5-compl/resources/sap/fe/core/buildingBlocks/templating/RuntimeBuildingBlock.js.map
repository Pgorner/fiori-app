{"version":3,"file":"RuntimeBuildingBlock.js","names":["RuntimeBuildingBlock","_BuildingBlockTemplat","apply","this","arguments","_exports","_inheritsLoose","_proto","prototype","getContent","containingView","appComponent","defaultAggregationContent","register","registerBuildingBlock","storeRuntimeBlock","load","async","metadata","libraries","Promise","all","map","Library","name","libraryName","e","errorMessage","join","Log","error","Error","resolve","getTemplate","_oNode","getRuntimeBuildingBlockTemplate","constructor","className","namespace","publicNamespace","extraProps","functionHolderDefinition","propertiesAssignedToFunction","functionStringInOrder","propertiesKey","properties","propertyValue","undefined","isContext","getPath","type","push","xml","length","innerTemplate","id","addConditionally","BuildingBlockTemplatingBase","isRuntime"],"sources":["./RuntimeBuildingBlock.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport type AppComponent from \"sap/fe/core/AppComponent\";\nimport type { XMLProcessorTypeValue } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport { registerBuildingBlock, xml } from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplateProcessor\";\nimport BuildingBlockTemplatingBase from \"sap/fe/core/buildingBlocks/templating/BuildingBlockTemplatingBase\";\nimport { storeRuntimeBlock } from \"sap/fe/core/buildingBlocks/templating/RuntimeBuildingBlockFragment\";\nimport { isContext } from \"sap/fe/core/helpers/TypeGuards\";\nimport type Control from \"sap/ui/core/Control\";\nimport Library from \"sap/ui/core/Lib\";\nimport type View from \"sap/ui/core/mvc/View\";\n\n/**\n * Base class for runtime building blocks\n */\nexport default class RuntimeBuildingBlock extends BuildingBlockTemplatingBase {\n\tpublic static readonly isRuntime = true;\n\n\tgetContent?(containingView: View, appComponent: AppComponent, defaultAggregationContent?: Control): Control | undefined {\n\t\treturn defaultAggregationContent;\n\t}\n\n\tstatic register(): void {\n\t\tregisterBuildingBlock(this);\n\t\tstoreRuntimeBlock(this);\n\t}\n\n\tpublic static async load(): Promise<typeof this> {\n\t\tif (this.metadata.libraries) {\n\t\t\t// Required before usage to ensure the library is loaded and not each file individually\n\t\t\ttry {\n\t\t\t\tawait Promise.all(this.metadata.libraries.map(async (libraryName) => Library.load({ name: libraryName })));\n\t\t\t} catch (e) {\n\t\t\t\tconst errorMessage = `Couldn't load building block ${\n\t\t\t\t\tthis.metadata.name\n\t\t\t\t} please make sure the following libraries are available ${this.metadata.libraries.join(\",\")}`;\n\t\t\t\tLog.error(errorMessage);\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t}\n\t\t}\n\t\treturn Promise.resolve(this);\n\t}\n\n\tpublic getTemplate(_oNode?: Element): string {\n\t\treturn \"\";\n\t}\n\n\tpublic getRuntimeBuildingBlockTemplate(_oNode?: Element): string | Promise<string | undefined> | undefined {\n\t\tconst metadata = (this.constructor as typeof BuildingBlockTemplatingBase).metadata;\n\n\t\tconst className = `${metadata.namespace ?? metadata.publicNamespace}.${metadata.name}`;\n\t\tconst extraProps = [];\n\t\t// Function are defined as string but need to be resolved by UI5, as such we store them in an `event` property and will redispatch them later\n\t\tconst functionHolderDefinition = [];\n\t\tconst propertiesAssignedToFunction = [];\n\t\tconst functionStringInOrder = [];\n\t\tfor (const propertiesKey in metadata.properties) {\n\t\t\tlet propertyValue = this[propertiesKey as keyof this] as unknown as XMLProcessorTypeValue;\n\t\t\tif (propertyValue !== undefined && propertyValue !== null) {\n\t\t\t\tif (isContext(propertyValue)) {\n\t\t\t\t\tpropertyValue = propertyValue.getPath();\n\t\t\t\t}\n\t\t\t\tif (metadata.properties[propertiesKey].type === \"function\") {\n\t\t\t\t\tfunctionHolderDefinition.push(propertyValue);\n\t\t\t\t\tfunctionStringInOrder.push(propertyValue);\n\t\t\t\t\tpropertiesAssignedToFunction.push(propertiesKey);\n\t\t\t\t} else {\n\t\t\t\t\textraProps.push(xml`feBB:${propertiesKey}=\"${propertyValue}\"`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (functionHolderDefinition.length > 0) {\n\t\t\textraProps.push(xml`functionHolder=\"${functionHolderDefinition.join(\";\")}\"`);\n\t\t\textraProps.push(xml`feBB:functionStringInOrder=\"${functionStringInOrder.join(\",\")}\"`);\n\t\t\textraProps.push(xml`feBB:propertiesAssignedToFunction=\"${propertiesAssignedToFunction.join(\",\")}\"`);\n\t\t}\n\t\tconst innerTemplate = this.getTemplate(_oNode);\n\t\treturn xml`<feBB:RuntimeBuildingBlockFragment\n\t\t\t\t\txmlns:core=\"sap.ui.core\"\n\t\t\t\t\txmlns:feBB=\"sap.fe.core.buildingBlocks.templating\"\n\t\t\t\t\tfragmentName=\"${className}\"\n\t\t\t\t\tid=\"${this.id}\"\n\t\t\t\t\ttype=\"FE_COMPONENTS\"\n\t\t\t\t\t${extraProps.length > 0 ? extraProps : \"\"}\n\t\t\t\t>\n\t\t\t\t${this.addConditionally(\n\t\t\t\t\tinnerTemplate.length > 0,\n\t\t\t\t\t`<feBB:fragmentXML>\n\t\t\t\t\t\t${innerTemplate}\n\t\t\t\t\t</feBB:fragmentXML>`\n\t\t\t\t)}\n\t\t\t\t<feBB:dependents>\n\t\t\t\t\t<slot name=\"dependents\"/>\n\t\t\t\t</feBB:dependents>\n\t\t\t\t<feBB:customDataHolder>\n\t\t\t\t\t<slot name=\"customData\"/>\n\t\t\t\t</feBB:customDataHolder>\n\t\t\t\t<feBB:layoutData>\n\t\t\t\t\t<slot name=\"layoutData\"/>\n\t\t\t\t</feBB:layoutData>\n\t\t\t\t</feBB:RuntimeBuildingBlockFragment>`;\n\t}\n}\n"],"mappings":";;;;qnBAWA,IAGqBA,EAAoB,SAAAC,GAAA,SAAAD,IAAA,OAAAC,EAAAC,MAAAC,KAAAC,YAAAD,IAAA,CAAAE,EAAAL,EAAAM,EAAAN,EAAAC,GAAA,IAAAM,EAAAP,EAAAQ,UAAAD,EAGxCE,WAAA,SAAAA,EAAYC,EAAsBC,EAA4BC,GAC7D,OAAOA,CACR,EAACZ,EAEMa,SAAP,SAAOA,IACNC,EAAsBX,MACtBY,EAAkBZ,KACnB,EAACH,EAEmBgB,KAApBC,eAAoBD,IACnB,GAAIb,KAAKe,SAASC,UAAW,CAE5B,UACOC,QAAQC,IAAIlB,KAAKe,SAASC,UAAUG,IAAIL,SAAuBM,EAAQP,KAAK,CAAEQ,KAAMC,KAC3F,CAAE,MAAOC,GACR,MAAMC,EAAe,gCACpBxB,KAAKe,SAASM,+DAC4CrB,KAAKe,SAASC,UAAUS,KAAK,OACxFC,EAAIC,MAAMH,GACV,MAAM,IAAII,MAAMJ,EACjB,CACD,CACA,OAAOP,QAAQY,QAAQ7B,KACxB,EAACI,EAEM0B,YAAP,SAAOA,EAAYC,GAClB,MAAO,EACR,EAAC3B,EAEM4B,gCAAP,SAAOA,EAAgCD,GACtC,MAAMhB,EAAYf,KAAKiC,YAAmDlB,SAE1E,MAAMmB,EAAY,GAAGnB,EAASoB,WAAapB,EAASqB,mBAAmBrB,EAASM,OAChF,MAAMgB,EAAa,GAEnB,MAAMC,EAA2B,GACjC,MAAMC,EAA+B,GACrC,MAAMC,EAAwB,GAC9B,IAAK,MAAMC,KAAiB1B,EAAS2B,WAAY,CAChD,IAAIC,EAAgB3C,KAAKyC,GACzB,GAAIE,IAAkBC,WAAaD,IAAkB,KAAM,CAC1D,GAAIE,EAAUF,GAAgB,CAC7BA,EAAgBA,EAAcG,SAC/B,CACA,GAAI/B,EAAS2B,WAAWD,GAAeM,OAAS,WAAY,CAC3DT,EAAyBU,KAAKL,GAC9BH,EAAsBQ,KAAKL,GAC3BJ,EAA6BS,KAAKP,EACnC,KAAO,CACNJ,EAAWW,KAAKC,CAAG,QAAQR,MAAkBE,KAC9C,CACD,CACD,CACA,GAAIL,EAAyBY,OAAS,EAAG,CACxCb,EAAWW,KAAKC,CAAG,mBAAmBX,EAAyBb,KAAK,SACpEY,EAAWW,KAAKC,CAAG,+BAA+BT,EAAsBf,KAAK,SAC7EY,EAAWW,KAAKC,CAAG,sCAAsCV,EAA6Bd,KAAK,QAC5F,CACA,MAAM0B,EAAgBnD,KAAK8B,YAAYC,GACvC,OAAOkB,CAAG;;;qBAGSf;WACVlC,KAAKoD;;OAETf,EAAWa,OAAS,EAAIb,EAAa;;MAEtCrC,KAAKqD,iBACNF,EAAcD,OAAS,EACvB,mCACGC;;;;;;;;;;yCAaP,EAAC,OAAAtD,CAAA,CAtFuC,CAASyD,GAA7BzD,EACG0D,UAAY,KAAIrD,EAAAL,EAAA,OAAAK,CAAA","ignoreList":[]}