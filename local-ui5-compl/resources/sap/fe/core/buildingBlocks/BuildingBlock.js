/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/BuildingBlockBase","sap/fe/base/ClassSupport","sap/fe/base/HookSupport","sap/fe/core/converters/MetaModelConverter","sap/fe/core/helpers/MetaPath","sap/fe/core/helpers/StableIdHelper","sap/ui/core/Component","sap/ui/core/ElementRegistry"],function(e,t,n,r,o,i,a,s,l){"use strict";var c,h,u,f,d,g;var p=a.generate;var b=o.getInvolvedDataModelObjectsForTargetPath;var v=o.convertTypes;var m=r.initControllerExtensionHookHandlers;var w=n.property;var C=n.defineUI5Class;function M(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function y(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,O(e,t)}function O(e,t){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},O(e,t)}function _(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(e,t,i),null):i}function P(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let x=(c=C("sap.fe.core.buildingBlocks.BuildingBlock"),h=w({type:"string"}),c(u=(f=(g=function(t){function n(e,n){var r;r=t.call(this,e,n)||this;M(r,"metaModel",d,r);r._applyingSettings=false;r.notifyBBObservers();return r}y(n,t);var r=n.prototype;r.applySettings=function e(n,r){this._applyingSettings=true;t.prototype.applySettings.call(this,n,r);this._applyingSettings=false;this._checkIfMetadataReady(true);return this};r.notifyBBObservers=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const r=n._bbobserverMap.get(this.getId());if(r&&r.length>0){for(const e of r){if(t){if(e.onDestroy){e.onDestroy(this)}}else if(e.onAvailable){e.onAvailable(this)}}}};n.observeBuildingBlock=function e(t,r){const o=l.get(t);if(o){if(r.onAvailable){r.onAvailable(o)}}else{const e=n._bbobserverMap.get(t);if(e){e.push(r)}else{n._bbobserverMap.set(t,[r])}}};r._getOwner=function e(){let t=this;let n=s.getOwnerComponentFor(t);while(!n&&t&&!t.isA("sap.ui.core.mvc.View")){t=t.getParent();if(t){n=s.getOwnerComponentFor(t)}}if(n?.isA("sap.fe.core.TemplateComponent")){return n}if(n?.isA("sap.fe.core.buildingBlocks.IBuildingBlockOwnerComponent")){return n}};r.getPageController=function e(){return this._getOwner()?.getRootController?.()};r.getMetaModel=function e(){return this._getOwner()?.getMetaModel(this.metaModel)};r.destroy=function e(n){if(this.isA("sap.fe.core.controllerextensions.viewState.IViewStateContributor")){this.getPageController()?.viewState?.deregisterStateContributor(this)}this.notifyBBObservers(true);t.prototype.destroy.call(this,n)};r._checkIfMetadataReady=function t(){let n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const r=this._getOwner();if(r){this.onMetadataAvailable(r);if(this.isA("sap.fe.core.controllerextensions.viewState.IViewStateContributor")){this.getPageController()?.viewState.registerStateContributor(this)}if(this.getPageController()){m(this,this.getPageController())}if(this._modelContextChangeEventHandler){this.detachEvent("modelContextChange",this._modelContextChangeEventHandler)}}else{if(!n&&!this.content){e.warning("The building block was not created within an ExtensionAPI.runWithFPMContext call, for performance reason it's recommended to do so.",this)}if(!this._modelContextChangeEventHandler){this._modelContextChangeEventHandler=function(){this._checkIfMetadataReady()};this.attachEvent("modelContextChange",this._modelContextChangeEventHandler)}}};r.onMetadataAvailable=function e(t){};r.getAppComponent=function e(){const t=this._getOwner();return t?.getAppComponent()};r.getDataModelObjectPath=function e(t){const n=this._getOwner();const r=n.getMetaModel(this.metaModel);const o=t??this.getOwnerContextPath();return b(o,r)};r.getOwnerContextPath=function e(){const t=this._getOwner();return t.getFullContextPath(this.metaModel)};r.getDataModelObjectForMetaPath=function e(t,n){const r=this._getOwner();const i=r.getMetaModel(this.metaModel);let a=n??this.getOwnerContextPath();a=a?.startsWith("/")?a:undefined;if(!i||!(a||t.charAt(0)==="/")){throw new Error("No metamodel or metapath is not reachable with contextPath")}let s=a?i.createBindingContext(a):undefined;s=s?s:undefined;const l=i.createBindingContext(t,s);return l?o.getInvolvedDataModelObjects(l,s):undefined};r.getMetaPathObject=function t(n,r){const o=this._getOwner();const a=o.getMetaModel(this.metaModel);let s=r??this.getOwnerContextPath();s=s?.startsWith("/")?s:undefined;if(!a||!(s||n.charAt(0)==="/")){e.warning(`No metamodel or metaPath is not reachable with ${r}:${n}`);return null}try{return new i(v(a),n,s)}catch(t){e.warning(`No metamodel or metaPath is not reachable with ${r}:${n}`);return null}};r.createId=function e(){if(this.getId()){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return p([this.getId(),...n])}return undefined};r.getTranslatedText=function e(t,n,r){return(this.getModel("sap.fe.i18n")??this._getOwner()?.getModel("sap.fe.i18n"))?.getText(t,n,r)||t};return n}(t),g._bbobserverMap=new Map,g),d=_(f.prototype,"metaModel",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),f))||u);return x},false);
//# sourceMappingURL=BuildingBlock.js.map