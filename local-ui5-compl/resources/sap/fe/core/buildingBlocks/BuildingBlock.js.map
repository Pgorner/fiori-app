{"version":3,"file":"BuildingBlock.js","names":["BuildingBlock","_dec","defineUI5Class","_dec2","property","type","_class","_class2","_BuildingBlock","_BuildingBlockBase","settings","others","_this","call","this","_initializerDefineProperty","_descriptor","_applyingSettings","notifyBBObservers","_inheritsLoose","_proto","prototype","applySettings","mSettings","oScope","_checkIfMetadataReady","destroy","arguments","length","undefined","bbobserverMap","_bbobserverMap","get","getId","observeBB","onDestroy","onAvailable","observeBuildingBlock","id","parameters","element","ElementRegistry","push","set","_getOwner","control","owner","Component","getOwnerComponentFor","isA","getParent","getPageController","getRootController","getMetaModel","metaModel","suppressInvalidate","viewState","deregisterStateContributor","fromApplySettings","onMetadataAvailable","registerStateContributor","initControllerExtensionHookHandlers","_modelContextChangeEventHandler","detachEvent","content","Log","warning","attachEvent","_ownerComponent","getAppComponent","getDataModelObjectPath","targetPath","targetPathToUse","getOwnerContextPath","getInvolvedDataModelObjectsForTargetPath","getFullContextPath","getDataModelObjectForMetaPath","metapath","contextPath","contextPathToUse","startsWith","charAt","Error","metaContext","createBindingContext","metaPathContext","MetaModelConverter","getInvolvedDataModelObjects","getMetaPathObject","metaPath","MetaPath","convertTypes","e","createId","_len","stringParts","Array","_key","generate","getTranslatedText","textID","getModel","getText","BuildingBlockBase","Map","_applyDecoratedDescriptor","configurable","enumerable","writable","initializer"],"sources":["./BuildingBlock.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport BuildingBlockBase from \"sap/fe/base/BuildingBlockBase\";\nimport type { PropertiesOf } from \"sap/fe/base/ClassSupport\";\nimport { defineUI5Class, property } from \"sap/fe/base/ClassSupport\";\nimport { initControllerExtensionHookHandlers } from \"sap/fe/base/HookSupport\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport type PageController from \"sap/fe/core/PageController\";\nimport type ResourceModel from \"sap/fe/core/ResourceModel\";\nimport type TemplateComponent from \"sap/fe/core/TemplateComponent\";\nimport type IViewStateContributor from \"sap/fe/core/controllerextensions/viewState/IViewStateContributor\";\nimport * as MetaModelConverter from \"sap/fe/core/converters/MetaModelConverter\";\nimport { convertTypes, getInvolvedDataModelObjectsForTargetPath } from \"sap/fe/core/converters/MetaModelConverter\";\nimport MetaPath from \"sap/fe/core/helpers/MetaPath\";\nimport type { AuthorizedIdAnnotationsType } from \"sap/fe/core/helpers/StableIdHelper\";\nimport { generate } from \"sap/fe/core/helpers/StableIdHelper\";\nimport type { DataModelObjectPath } from \"sap/fe/core/templating/DataModelPathHelper\";\nimport type ManagedObject from \"sap/ui/base/ManagedObject\";\nimport type { $ManagedObjectSettings } from \"sap/ui/base/ManagedObject\";\nimport Component from \"sap/ui/core/Component\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport ElementRegistry from \"sap/ui/core/ElementRegistry\";\nimport type ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type AppComponent from \"../AppComponent\";\n\nexport type ObserveBuildingBlock = {\n\tonAvailable?: (bb: UI5Element) => void;\n\tonDestroy?: (bb: UI5Element) => void;\n};\n/**\n * Defines a control that will not exist in the DOM.\n * Instead, only its child will be there and this control will forward all DOM related instruction to it.\n * @experimental\n * @since 1.121.0\n * @public\n */\n@defineUI5Class(\"sap.fe.core.buildingBlocks.BuildingBlock\")\nclass BuildingBlock<T extends UI5Element = Control, K extends object = {}> extends BuildingBlockBase<T, K> {\n\t/**\n\t * The metamodel name or id to be used for this building block\n\t */\n\t@property({ type: \"string\" })\n\tmetaModel?: string;\n\n\tprotected _applyingSettings = false;\n\n\tprivate _modelContextChangeEventHandler?: Function;\n\n\tprivate static _bbobserverMap: Map<string, ObserveBuildingBlock[]> = new Map();\n\n\tconstructor(settings?: string | PropertiesOf<BuildingBlockBase<T>>, others?: PropertiesOf<BuildingBlockBase<T>>) {\n\t\tsuper(settings, others);\n\t\tthis.notifyBBObservers();\n\t}\n\n\toverride applySettings(mSettings: $ManagedObjectSettings, oScope?: object): this {\n\t\tthis._applyingSettings = true;\n\t\tsuper.applySettings(mSettings, oScope);\n\t\tthis._applyingSettings = false;\n\t\tthis._checkIfMetadataReady(true);\n\n\t\treturn this;\n\t}\n\n\tnotifyBBObservers(destroy = false): void {\n\t\tconst bbobserverMap = BuildingBlock._bbobserverMap.get(this.getId());\n\t\tif (bbobserverMap && bbobserverMap.length > 0) {\n\t\t\tfor (const observeBB of bbobserverMap) {\n\t\t\t\tif (destroy) {\n\t\t\t\t\tif (observeBB.onDestroy) {\n\t\t\t\t\t\tobserveBB.onDestroy(this);\n\t\t\t\t\t}\n\t\t\t\t} else if (observeBB.onAvailable) {\n\t\t\t\t\tobserveBB.onAvailable(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Allows to observe building block once it is created.\n\t * @param id The id of the building block which will be observed\n\t * @param parameters The id of the building block which is being requsted\n\t * @param parameters.onAvailable Callback which is called with the instance of the BB when it is available\n\t * @param parameters.onDestroy Callback which is called with the instance of the BB when it is destroyed\n\t */\n\tstatic observeBuildingBlock(id: string, parameters: ObserveBuildingBlock): void {\n\t\t//if (parameters)\n\t\tconst element = ElementRegistry.get(id);\n\t\t// if the element is already registered\n\t\tif (element) {\n\t\t\tif (parameters.onAvailable) {\n\t\t\t\tparameters.onAvailable(element);\n\t\t\t}\n\t\t} else {\n\t\t\tconst bbobserverMap = BuildingBlock._bbobserverMap.get(id);\n\t\t\tif (bbobserverMap) {\n\t\t\t\tbbobserverMap.push(parameters);\n\t\t\t} else {\n\t\t\t\tBuildingBlock._bbobserverMap.set(id, [parameters]);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get the instance of a building block based once it is registered.\n\t * @param id The id of the building block which is being requsted\n\t * @returns Promise resolved with an instance of the building block once it is registered/instantied.\n\t * \t The promise is resolved when the building block is intantied hence it recommended to only await on the promise\n\t * \t when it is known that the building block will be available. In cases here the building block might not be available,\n\t * \t for example becuase of lazy loading, then it is recommended not to await on the promise and instead use Promise.then().\n\t */\n\n\t_getOwner(): TemplateComponent | undefined {\n\t\t//eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tlet control: Control | undefined = this;\n\t\tlet owner = Component.getOwnerComponentFor(control);\n\t\twhile (!owner && control && !control.isA<FEView>(\"sap.ui.core.mvc.View\")) {\n\t\t\tcontrol = control.getParent() as Control | undefined;\n\t\t\tif (control) {\n\t\t\t\towner = Component.getOwnerComponentFor(control);\n\t\t\t}\n\t\t}\n\t\tif (owner?.isA<TemplateComponent>(\"sap.fe.core.TemplateComponent\")) {\n\t\t\treturn owner;\n\t\t}\n\t\tif (owner?.isA<TemplateComponent>(\"sap.fe.core.buildingBlocks.IBuildingBlockOwnerComponent\")) {\n\t\t\treturn owner;\n\t\t}\n\t}\n\n\tgetPageController(): PageController | undefined {\n\t\treturn this._getOwner()?.getRootController?.();\n\t}\n\n\tgetMetaModel(): ODataMetaModel | undefined {\n\t\treturn this._getOwner()?.getMetaModel(this.metaModel);\n\t}\n\n\toverride destroy(suppressInvalidate?: boolean): void {\n\t\tif (this.isA<IViewStateContributor<unknown> & ManagedObject>(\"sap.fe.core.controllerextensions.viewState.IViewStateContributor\")) {\n\t\t\tthis.getPageController()?.viewState?.deregisterStateContributor(this);\n\t\t}\n\t\tthis.notifyBBObservers(true);\n\t\tsuper.destroy(suppressInvalidate);\n\t}\n\n\t_checkIfMetadataReady(fromApplySettings = false): void {\n\t\tconst owner = this._getOwner();\n\t\tif (owner) {\n\t\t\tthis.onMetadataAvailable(owner);\n\t\t\tif (\n\t\t\t\tthis.isA<IViewStateContributor<unknown> & ManagedObject>(\"sap.fe.core.controllerextensions.viewState.IViewStateContributor\")\n\t\t\t) {\n\t\t\t\tthis.getPageController()?.viewState.registerStateContributor(this);\n\t\t\t}\n\t\t\tif (this.getPageController()) {\n\t\t\t\tinitControllerExtensionHookHandlers(this, this.getPageController()!);\n\t\t\t}\n\n\t\t\tif (this._modelContextChangeEventHandler) {\n\t\t\t\tthis.detachEvent(\"modelContextChange\", this._modelContextChangeEventHandler);\n\t\t\t}\n\t\t} else {\n\t\t\tif (!fromApplySettings && !this.content) {\n\t\t\t\t// In case couldn't create the content during the applySettings, try again\n\t\t\t\tLog.warning(\n\t\t\t\t\t\"The building block was not created within an ExtensionAPI.runWithFPMContext call, for performance reason it's recommended to do so.\",\n\t\t\t\t\tthis as unknown as string\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (!this._modelContextChangeEventHandler) {\n\t\t\t\tthis._modelContextChangeEventHandler = function (): void {\n\t\t\t\t\tthis._checkIfMetadataReady();\n\t\t\t\t};\n\t\t\t\tthis.attachEvent(\"modelContextChange\", this._modelContextChangeEventHandler);\n\t\t\t}\n\t\t}\n\t}\n\n\tonMetadataAvailable(_ownerComponent: TemplateComponent): void {\n\t\t// To be overriden by the child class\n\t}\n\n\tgetAppComponent(): AppComponent | undefined {\n\t\tconst owner = this._getOwner();\n\t\treturn owner?.getAppComponent();\n\t}\n\n\tgetDataModelObjectPath<N>(targetPath?: string): DataModelObjectPath<N> | undefined {\n\t\tconst owner = this._getOwner()!;\n\t\tconst metaModel = owner.getMetaModel(this.metaModel);\n\t\tconst targetPathToUse = targetPath ?? this.getOwnerContextPath();\n\t\treturn getInvolvedDataModelObjectsForTargetPath(targetPathToUse!, metaModel);\n\t}\n\n\t/**\n\t * Retrieves the context path from the owner component.\n\t * @returns The context path\n\t */\n\tgetOwnerContextPath(): string | undefined {\n\t\tconst owner = this._getOwner()!;\n\t\treturn owner.getFullContextPath(this.metaModel);\n\t}\n\n\t/**\n\t * Get the data model object for the given metapath and optional contextPath.\n\t * @param metapath\n\t * @param contextPath\n\t * @returns The data model object path\n\t */\n\tgetDataModelObjectForMetaPath<ExpectedDataModelType>(\n\t\tmetapath: string,\n\t\tcontextPath?: string\n\t): DataModelObjectPath<ExpectedDataModelType> | undefined {\n\t\tconst owner = this._getOwner()!;\n\t\tconst metaModel = owner.getMetaModel(this.metaModel);\n\t\tlet contextPathToUse = contextPath ?? this.getOwnerContextPath();\n\t\tcontextPathToUse = contextPathToUse?.startsWith(\"/\") ? contextPathToUse : undefined;\n\t\tif (!metaModel || !(contextPathToUse || metapath.charAt(0) === \"/\")) {\n\t\t\tthrow new Error(\"No metamodel or metapath is not reachable with contextPath\");\n\t\t}\n\t\tlet metaContext = contextPathToUse ? metaModel.createBindingContext(contextPathToUse) : undefined;\n\t\tmetaContext = metaContext ? metaContext : undefined;\n\t\tconst metaPathContext = metaModel.createBindingContext(metapath, metaContext);\n\t\treturn metaPathContext\n\t\t\t? MetaModelConverter.getInvolvedDataModelObjects<ExpectedDataModelType>(metaPathContext, metaContext)\n\t\t\t: undefined;\n\t}\n\n\t/**\n\t * Retrieves the MetaPath object for the given metaPath and optional contextPath.\n\t * @param metaPath\n\t * @param contextPath\n\t * @returns A MetaPath pointing to the target {metaPath, contextPath}\n\t */\n\tgetMetaPathObject<ExpectedDataModelType>(metaPath: string, contextPath?: string): MetaPath<ExpectedDataModelType> | null {\n\t\tconst owner = this._getOwner()!;\n\t\tconst metaModel = owner.getMetaModel(this.metaModel);\n\t\tlet contextPathToUse = contextPath ?? this.getOwnerContextPath();\n\t\tcontextPathToUse = contextPathToUse?.startsWith(\"/\") ? contextPathToUse : undefined;\n\t\tif (!metaModel || !(contextPathToUse || metaPath.charAt(0) === \"/\")) {\n\t\t\tLog.warning(`No metamodel or metaPath is not reachable with ${contextPath}:${metaPath}`);\n\t\t\treturn null;\n\t\t}\n\t\ttry {\n\t\t\treturn new MetaPath(convertTypes(metaModel), metaPath, contextPathToUse!);\n\t\t} catch (e) {\n\t\t\tLog.warning(`No metamodel or metaPath is not reachable with ${contextPath}:${metaPath}`);\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprotected createId(...stringParts: (string | undefined | DataModelObjectPath<AuthorizedIdAnnotationsType>)[]): string | undefined {\n\t\t// If the child instance has an ID property use it otherwise return undefined\n\t\tif (this.getId()) {\n\t\t\treturn generate([this.getId(), ...stringParts]);\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tgetTranslatedText(textID: string, parameters?: unknown[], metaPath?: string): string {\n\t\treturn (\n\t\t\t((this.getModel(\"sap.fe.i18n\") ?? this._getOwner()?.getModel(\"sap.fe.i18n\")) as ResourceModel)?.getText(\n\t\t\t\ttextID,\n\t\t\t\tparameters,\n\t\t\t\tmetaPath\n\t\t\t) || textID\n\t\t);\n\t}\n}\n\ninterface BuildingBlock<T extends UI5Element> {\n\tgetContent(): T | undefined;\n\tgetAriaLabelledBy(): string[];\n}\n\nexport default BuildingBlock;\n"],"mappings":"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","ignoreList":[]}