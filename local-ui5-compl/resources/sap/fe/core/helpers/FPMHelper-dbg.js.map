{"version":3,"names":["FPMHelper","loadModuleAndCallMethod","module","method","view","_len","arguments","length","args","Array","_key","Promise","resolve","extensionAPI","getControllerName","getController","getExtensionAPI","startsWith","fnTarget","ObjectPath","get","replace","substring","sap","ui","require","loadedModule","bind","actionWrapper","oEvent","sModule","sMethod","oParameters","Log","debug","oSource","getSource","oView","CommonUtils","getTargetView","oBindingContext","getBindingContext","listBinding","aSelectedContexts","undefined","contexts","getParent","isA","getMdcTable","getRowBinding","control","parent","validationWrapper","oValidationContexts","getCustomFunction","moduleName","functionName","source","customFunction","controllerExt","error"],"sourceRoot":".","sources":["FPMHelper.ts"],"sourcesContent":["import Log from \"sap/base/Log\";\nimport ObjectPath from \"sap/base/util/ObjectPath\";\nimport type { FEView } from \"sap/fe/core/BaseController\";\nimport CommonUtils from \"sap/fe/core/CommonUtils\";\nimport type ExtensionAPI from \"sap/fe/core/ExtensionAPI\";\nimport type UI5Event from \"sap/ui/base/Event\";\nimport type EventProvider from \"sap/ui/base/EventProvider\";\nimport type Control from \"sap/ui/core/Control\";\nimport type UI5Element from \"sap/ui/core/Element\";\nimport type View from \"sap/ui/core/mvc/View\";\nimport type MdcTable from \"sap/ui/mdc/Table\";\nimport type Context from \"sap/ui/model/Context\";\nimport type ODataListBinding from \"sap/ui/model/odata/v4/ODataListBinding\";\n\nconst FPMHelper = {\n\tloadModuleAndCallMethod: async function (module: string, method: string, view: View, ...args: unknown[]): Promise<unknown> {\n\t\treturn new Promise(function (resolve: (value: unknown) => void) {\n\t\t\tlet extensionAPI: ExtensionAPI | undefined;\n\t\t\tif (\n\t\t\t\tview.getControllerName() === \"sap.fe.templates.ObjectPage.ObjectPageController\" ||\n\t\t\t\tview.getControllerName() === \"sap.fe.templates.ListReport.ListReportController\"\n\t\t\t) {\n\t\t\t\textensionAPI = (view as FEView).getController().getExtensionAPI();\n\t\t\t}\n\n\t\t\tif (module.startsWith(\"/extension/\")) {\n\t\t\t\tconst fnTarget = ObjectPath.get(module.replace(/\\//g, \".\").substring(1), extensionAPI);\n\t\t\t\tresolve(fnTarget[method](...args));\n\t\t\t} else {\n\t\t\t\tsap.ui.require([module], function (loadedModule: Record<string, Function>) {\n\t\t\t\t\t// - we bind the action to the extensionAPI of the controller so it has the same scope as a custom section\n\t\t\t\t\t// - we provide the context as API, maybe if needed further properties\n\t\t\t\t\tresolve(loadedModule[method].bind(extensionAPI)(...args));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tactionWrapper: async function (\n\t\toEvent: UI5Event,\n\t\tsModule?: string,\n\t\tsMethod?: string,\n\t\toParameters?: { contexts?: Context[] }\n\t): Promise<unknown> {\n\t\tif (!sModule || !sMethod) {\n\t\t\tLog.debug(\"Both the module and the method must be defined to execute a custom action\");\n\t\t\treturn;\n\t\t}\n\n\t\t//The source would be command execution, in case a command is defined for the action in the manifest.\n\t\tconst oSource = (oEvent.getSource ? oEvent.getSource() : (oEvent as { oSource?: EventProvider }).oSource) as Control,\n\t\t\toView = CommonUtils.getTargetView(oSource),\n\t\t\toBindingContext = oSource.getBindingContext()!;\n\n\t\tlet listBinding: ODataListBinding | undefined;\n\t\tlet aSelectedContexts: Context[];\n\n\t\tif (oParameters !== undefined) {\n\t\t\taSelectedContexts = oParameters.contexts || [];\n\t\t} else if (oBindingContext !== undefined) {\n\t\t\taSelectedContexts = [oBindingContext];\n\t\t} else {\n\t\t\taSelectedContexts = [];\n\t\t}\n\t\tif (oSource.getParent()?.isA(\"sap.ui.mdc.actiontoolbar.ActionToolbarAction\") || oSource.getParent()?.isA(\"sap.m.Menu\")) {\n\t\t\tlistBinding = FPMHelper.getMdcTable(oSource)?.getRowBinding();\n\t\t}\n\n\t\treturn FPMHelper.loadModuleAndCallMethod(sModule, sMethod, oView, oBindingContext, aSelectedContexts, listBinding);\n\t},\n\tgetMdcTable: function (control: UI5Element): MdcTable | null | undefined {\n\t\tconst parent = control.getParent();\n\t\tif (!parent || parent.isA<MdcTable>(\"sap.ui.mdc.Table\")) {\n\t\t\treturn parent;\n\t\t}\n\t\treturn FPMHelper.getMdcTable(parent as Control);\n\t},\n\tvalidationWrapper: async function (\n\t\tsModule: string,\n\t\tsMethod: string,\n\t\toValidationContexts: Record<string, unknown>,\n\t\toView: View,\n\t\toBindingContext: Context\n\t): Promise<{ messageTarget?: string; messageText: string }[]> {\n\t\treturn FPMHelper.loadModuleAndCallMethod(sModule, sMethod, oView, oBindingContext, oValidationContexts) as Promise<\n\t\t\t{ messageTarget?: string; messageText: string }[]\n\t\t>;\n\t},\n\t/**\n\t * Returns an external custom function defined either in a custom controller extension or in an external module.\n\t * @param moduleName The external module name, or /extension/<path to the custom controller extension module>\n\t * @param functionName The name of the function\n\t * @param source A control in the view or an event triggered by a control in the view\n\t * @returns The function (or undefined if it couldn't be found)\n\t */\n\tgetCustomFunction<FunctionType>(\n\t\tmoduleName: string,\n\t\tfunctionName: string,\n\t\tsource: Control | UI5Event<{}, Control>\n\t): FunctionType | undefined {\n\t\tlet control: Control;\n\t\tif (source.isA<UI5Event>(\"sap.ui.base.Event\")) {\n\t\t\tcontrol = source.getSource();\n\t\t} else {\n\t\t\tcontrol = source;\n\t\t}\n\t\tconst view = CommonUtils.getTargetView(control);\n\t\tconst extensionAPI = view.getController().getExtensionAPI();\n\n\t\tlet customFunction: FunctionType | undefined;\n\n\t\tif (moduleName.startsWith(\"/extension/\")) {\n\t\t\tconst controllerExt = ObjectPath.get(moduleName.replace(/\\//g, \".\").substring(1), extensionAPI);\n\t\t\tcustomFunction = controllerExt ? controllerExt[functionName] : undefined;\n\t\t} else {\n\t\t\tconst module = sap.ui.require(moduleName);\n\t\t\tcustomFunction = module ? module[functionName]?.bind(extensionAPI) : undefined;\n\t\t}\n\n\t\tif (!customFunction) {\n\t\t\tLog.error(`Couldn't find method ${functionName} in ${moduleName}`);\n\t\t}\n\t\treturn customFunction;\n\t}\n};\n\nexport default FPMHelper;\n"],"mappings":"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","ignoreList":[],"file":"FPMHelper-dbg.js"}