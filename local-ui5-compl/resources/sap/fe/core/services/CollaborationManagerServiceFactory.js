/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/ui/core/service/Service","sap/ui/core/service/ServiceFactory"],function(e,t,i){"use strict";function s(e){return new Promise((t,i)=>{sap.ui.require([e],i=>{if(!(i&&i.__esModule)){i=i===null||!(typeof i==="object"&&e.endsWith("/library"))?{default:i}:i;Object.defineProperty(i,"__esModule",{value:true})}t(i)},e=>{i(e)})})}var r={};function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}let o=function(t){function i(){var e;for(var i=arguments.length,s=new Array(i),r=0;r<i;r++){s[r]=arguments[r]}e=t.call(this,...s)||this;e.__implements__sap_insights_ICardProvider=true;e.registered=false;return e}r.CollaborationManagerService=i;n(i,t);var a=i.prototype;a.init=function e(){this.initPromise=new Promise(e=>{this.appComponent=this.getContext().scopeObject;e(this)})};a.getCardsChannel=async function e(){const{default:t}=await s("sap/insights/CardHelper");const i=await t.getServiceAsync("UIService");return i.getCardsChannel()};a.connect=async function t(i,s){try{const e=await this.getCardsChannel();if(e.isEnabled()){this.onRetrieveAvailableCards=s;this.channel=e;this.id=i;this.consumers={};this.sharedCards=[];if(this.registered!==true){await this.registerProvider()}this.updateConsumers()}}catch(t){e.debug("Collaboration Manager connection failed",t)}return this};a.onConsumerConnected=async function e(t){if(!this.consumers[t]){this.consumers[t]=true;await(this.onRetrieveAvailableCards?.());this.shareAvailableCards(t)}return Promise.resolve(Object.keys(this.consumers).length)};a.onConsumerDisconnected=async function e(t){if(this.consumers[t]){delete this.consumers[t]}return Promise.resolve(Object.keys(this.consumers).length)};a.onCardRequested=function e(t,i){const s=this.sharedCards.find(e=>e?.id===i);s?.callback?.(s.card);return s};a.onViewUpdate=async function e(t){if(this.registered!==t){if(t){await this.registerProvider();this.updateConsumers()}else{await this.unregisterProvider()}}else if(this.registered){this.updateConsumers()}};a.registerProvider=async function e(){if(this.channel){await this.channel.registerProvider(this.id,this);this.registered=true}};a.unregisterProvider=async function e(){if(this.channel){await this.channel.unregister(this.id);this.registered=false;this.consumers={};this.sharedCards=[];this.onRetrieveAvailableCards=undefined}};a.updateConsumers=function e(){this.shareAvailableCards()};a.shareAvailableCards=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"*";this?.channel?.publishAvailableCards(this.id,this.sharedCards,t)};a.addCardsToCollaborationManager=function e(t,i){this.sharedCards=[];for(const[e,s]of Object.entries(t)){this.sharedCards.push({id:e,title:s.title,parentAppId:i,callback:s.callback,card:s.card})}};a.getDesignTimeCard=async function t(i){const r=await s("sap/cards/ap/common/services/RetrieveCard");let n;const a=this.appComponent;try{n=await r.getObjectPageCardManifestForPreview(a,{cardType:i})}catch(t){e.error(t)}return n};a.publishCard=function e(t){this.channel.publishCard(this.id,{id:t["sap.app"].id,descriptorContent:t},"*")};return i}(t);r.CollaborationManagerService=o;let c=function(e){function t(){return e.apply(this,arguments)||this}r=t;n(t,e);var i=t.prototype;i.createInstance=async function e(t){this.instance=new o(t);return this.instance.initPromise};i.getInstance=function e(){return this.instance};i.shareAvailableCards=function e(){this.instance.shareAvailableCards()};return t}(i);c.serviceClass=o;r=c;return r},false);
//# sourceMappingURL=CollaborationManagerServiceFactory.js.map