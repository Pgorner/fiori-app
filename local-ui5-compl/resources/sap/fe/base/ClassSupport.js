/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/ObjectPath","sap/base/util/deepClone","sap/base/util/merge","sap/base/util/uid","sap/fe/base/HookSupport","sap/ui/base/Metadata","sap/ui/base/Object","sap/ui/core/mvc/ControllerMetadata","sap/ui/model/json/JSONModel"],function(t,e,n,r,i,o,a,s,c){"use strict";var f={};var u=i.hookable;const p=function(t){t.metadata=n({controllerExtensions:{},properties:{},aggregations:{},references:{},associations:{},methods:{},events:{},interfaces:[]},t.metadata??{});return t.metadata};function d(t){return function(e){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:t.getMetadata().getName();let r=e.getSource();if(t._getAPIExtension){r=t._getAPIExtension(r)??r}while(r&&!r.isA(n)&&r.getParent){if(this.isDependentBound){const t=r.getDependents();const e=t.find(t=>t.isA(n));if(e){r=e}else{r=r.getParent()}}else{r=r.getParent()}}if(!r||!r.isA(n)){const t=this.instanceMap.get(this);r=t?.[t.length-1]}let i;if(r&&r.isA(n)){i=r}return i}}const l=function(t){if(!t.__apiRegistered){t.__apiRegistered=true;t.instanceMap=new WeakMap;t.registerInstance=function(t){if(!this.instanceMap.get(t.constructor)){this.instanceMap.set(t.constructor,[])}this.instanceMap.get(t.constructor).push(t)};t.getAPI=d(t)}};function g(){return function(t,e,n){const r=p(t);if(r.stateProperty!==undefined){throw new Error("Only one state property per control is allowed")}r.stateProperty=e;delete n.writable;r.statePropertyDefaultValue??=n.initializer?.();delete n.initializer;return n}}f.defineState=g;function h(t){return function(e,n){if(!e.override){e.override={}}if(!e.overrides){e.overrides={}}let r=e.overrides;if(t){if(!r.extension){r.extension={}}if(!r.extension[t]){r.extension[t]={}}r=r.extension[t]}r[n.toString()]=e[n.toString()]}}f.methodOverride=h;function m(t){return function(e,n,r){const i=p(e);if(!i.methods[n.toString()]){i.methods[n.toString()]={}}i.methods[n.toString()].overrideExecution=t;if(t!=="Instead"){u(t)(e,n,r)}}}f.extensible=m;function y(){return function(t,e,n){const r=p(t);n.enumerable=true;if(!r.methods[e.toString()]){r.methods[e.toString()]={}}r.methods[e.toString()].public=true}}f.publicExtension=y;function b(){return function(t,e,n){const r=p(t);n.enumerable=true;if(!r.methods[e.toString()]){r.methods[e.toString()]={}}r.methods[e.toString()].public=false}}f.privateExtension=b;function P(){return function(t,e,n){const r=p(t);n.enumerable=true;if(!r.methods[e.toString()]){r.methods[e.toString()]={}}r.methods[e.toString()].final=true}}f.finalExtension=P;function S(t){return function(e,n,r){const i=p(e);delete r.initializer;i.controllerExtensions[n.toString()]=t;return r}}f.usingExtension=S;function _(){return function(t,e){const n=p(t);if(!n.events[e.toString()]){n.events[e.toString()]={}}}}f.event=_;function v(t){return function(e,n,r){const i=p(e);if(t.bindable===undefined){t.bindable=true}if(t.isBindingInfo===true){t.bindable=false;t.group="Data"}if(!i.properties[n]){i.properties[n]=t}delete r.writable;t.defaultValue??=r.initializer?.();delete r.initializer;return r}}f.property=v;function x(t){return function(e,n,r){const i=p(e);if(t.multiple===undefined){t.multiple=false}if(!i.aggregations[n]){i.aggregations[n]=t}if(t.isDefault){i.defaultAggregation=n}delete r.writable;t.defaultValue??=r.initializer?.();delete r.initializer;return r}}f.aggregation=x;function O(t){return function(e,n,r){const i=p(e);if(!i.associations[n]){i.associations[n]=t}delete r.writable;delete r.initializer;return r}}f.association=O;function A(t){return function(e){const n=p(e);n.interfaces.push(t)}}f.implementInterface=A;function E(){return function(t,e){const n=t.constructor;l(n);n[e.toString()]=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++){r[i]=arguments[i]}if(r?.length){const t=n.getAPI(r[0]);t?.[e.toString()](...r)}}}}f.xmlEventHandler=E;function j(t,e){return function(n){if(!n.prototype.metadata){n.prototype.metadata={}}if(e){for(const t in e){if(n.prototype.metadata[t]){if(Array.isArray(n.prototype.metadata[t])){n.prototype.metadata[t]=n.prototype.metadata[t].concat(e[t])}else{n.prototype.metadata[t]={...n.prototype.metadata[t],...e[t]}}}else{n.prototype.metadata[t]=e[t]}}}return z(n,t,n.prototype)}}f.defineUI5Class=j;function w(t){return function(e){if(e.prototype.extend){throw new Error("The mixinInterface decorator must be placed after `defineUi5Class`")}const n=p(e.prototype);const r=t.prototype.getInterfaceName?.();if(r){n.interfaces.push(r)}Object.getOwnPropertyNames(t.prototype).forEach(n=>{if(n!=="constructor"&&n!=="setupMixin"){Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}});t.prototype.setupMixin?.(e);return e}}f.mixin=w;function M(){return{current:undefined,setCurrent:function(t){this.current=t}}}f.createReference=M;function I(){return function(t,e,n){const r=p(t);delete n.writable;delete n.initializer;if(a.isObjectA(t,"sap.ui.core.Control")){if(!r.references[e]){r.references[e]=true}}else{n.initializer=M}return n}}f.defineReference=I;function D(t,n){const r=`/${n.toString()}`;const i=e(t.getObject(r));let o;if(n==="__bindingInfo"){return{model:"$componentState"}}if(typeof i==="string"){o=i}else if(typeof i==="number"){o=i}else if(typeof i==="boolean"){o=i}else if(Array.isArray(i)){o=new Proxy(i,{get(t,e,n){const r=Reflect.get(t,e,n);if(typeof r==="function"){return r.bind(t)}else if(r===undefined&&isNaN(Number(e.toString()))){return{__bindingInfo:{model:"$componentState",path:e}}}return r}})}else{o={...i}}if(typeof o==="object"){o.__bindingInfo={model:"$componentState",path:r}}return o}function $(t,e){if(t.metadata?.stateProperty||e?.getModel&&e.getModel("$componentState")){if(t.metadata?.stateProperty){e.setModel(new c,"$componentState")}const n=e.getModel("$componentState");let r=false;const i=[];for(const e in t.metadata?.properties){const n=t.metadata.properties[e];if(n.bindToState){i.push(e)}}const o=n.getProperty("/__boundProperties")??[];n.setProperty("/__boundProperties",[...o,...i]);n.attachPropertyChange(t=>{const n=t.getParameter("path")?.substring(1);if(n&&i.includes(n)){e.setProperty(n,t.getParameter("value"))}});if(t.metadata?.stateProperty){e._updateState=async function(){delete this._updateStateTimer;if(!r){r=true;await(this.onStateChange?.(this._changedProps));this._changedProps=[];r=false}};e._updateStateDebounced=function(t){this._changedProps??=[];if(!this._changedProps.includes(t)){this._changedProps.push(t)}if(!this._updateStateTimer&&!r){this._updateStateTimer=setTimeout(()=>{this._updateState()},200)}};Object.defineProperty(e,t.metadata.stateProperty,{configurable:true,get:()=>new Proxy(n,{get:(t,e)=>D(t,e),set:(t,n,r)=>{const i=t.getProperty("/__boundProperties")??[];if(i.includes(n.toString())){e._ignoreStatePropertyUpdate=true;e.setProperty(n.toString(),r);e._ignoreStatePropertyUpdate=false}const o=t.setProperty(`/${n.toString()}`,r);e._updateStateDebounced(n.toString());return o}}),set:function(t){const e=n.getProperty("/__boundProperties")??[];n.setProperty(`/`,t);n.setProperty("/__boundProperties",e)}});if(t.metadata.statePropertyDefaultValue){e[t.metadata.stateProperty]={...t.metadata.statePropertyDefaultValue}}const i=e.applySettings;e.applySettings=function(t){delete t?.models?.$componentState;return i.call(this,t)}}const a=e.setProperty;if(i.length>0){e.setProperty=function(t,r,o){if(i.includes(t)&&!this._ignoreStatePropertyUpdate){n.setProperty(`/${t}`,r);e._updateStateDebounced(t)}return a.call(this,t,r,o)}}}}function z(e,n,i){if(e.getMetadata?.().isA("sap.ui.core.mvc.ControllerExtension")){Object.getOwnPropertyNames(i).forEach(t=>{const e=Object.getOwnPropertyDescriptor(i,t);if(e&&!e.enumerable){e.enumerable=true}})}const a={};a.metadata=i.metadata||{};a.override=i.override;a.constructor=e;a.metadata.baseType=Object.getPrototypeOf(e.prototype).getMetadata().getName();if(e?.getMetadata()?.getStereotype()==="control"){const t=i.renderer||e.renderer||e.render;a.renderer={apiVersion:2};if(typeof t==="function"){a.renderer.render=t}else if(t!=undefined){a.renderer=t}}a.metadata.interfaces=i.metadata?.interfaces||e.metadata?.interfaces;Object.keys(e.prototype).forEach(t=>{if(t!=="metadata"){try{a[t]=e.prototype[t]}catch(t){}}});if(a.metadata?.controllerExtensions&&Object.keys(a.metadata.controllerExtensions).length>0){for(const t in a.metadata.controllerExtensions){a[t]=a.metadata.controllerExtensions[t]}}const c=e.extend(n,a);const f=c.prototype.init;const u=c.prototype.afterInit;c.prototype.init=function(){var t=this;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++){r[i]=arguments[i]}if(f){f.apply(this,r)}if(e.registerInstance){e.registerInstance(this)}this.metadata=a.metadata;if(a.metadata.properties){const t=Object.keys(a.metadata.properties);t.forEach(t=>{const e=a.metadata.properties[t];const n=this[t]??e.defaultValue;if(e.isBindingInfo===true){this._bindingProperties??={};Object.defineProperty(this,t,{configurable:true,set:e=>{this._bindingProperties[t]=e;this.mProperties[t]=e;return this},get(){const e=this.getProperty(t);const n=this._bindingProperties[t];if(e&&e!==n){this._bindingProperties[t]=e}const r=this._bindingProperties[t];if(typeof r==="object"){return{...r}}else{return r}}})}else{Object.defineProperty(this,t,{configurable:true,set:e=>this.setProperty(t,e),get:()=>this.getProperty(t)})}if(n!==undefined&&this[t]!==n){this._applyingSettings=true;this[t]=n;this._applyingSettings=false;delete this._applyingSettings}});const e=Object.keys(a.metadata.aggregations);e.forEach(t=>{const e=a.metadata.aggregations[t];const n=this[t]??e.defaultValue;Object.defineProperty(this,t,{configurable:true,set:e=>this.setAggregation(t,e),get:()=>{const e=this.getAggregation(t);if(a.metadata.aggregations[t].multiple){return e||[]}else{return e}}});if(n&&n?.isA){this._applyingSettings=true;this[t]=n;this._applyingSettings=false;delete this._applyingSettings}});const n=Object.keys(a.metadata.associations);n.forEach(t=>{Object.defineProperty(this,t,{configurable:true,set:e=>this.setAssociation(t,e),get:()=>{const e=this.getAssociation(t);if(a.metadata.associations[t].multiple){return e||[]}else{return e}}})})}if(a.metadata.references){const t=Object.keys(a.metadata.references);t.forEach(t=>{Object.defineProperty(this,t,{configurable:true,value:M()})})}if(a.metadata.methods){for(const e in a.metadata.methods){const n=a.metadata.methods[e];if(n.overrideExecution==="AfterAsync"||n.overrideExecution==="BeforeAsync"){if(!this.methodHolder){this.methodHolder=[]}this.methodHolder[e]=[this[e]];Object.defineProperty(this,e,{configurable:true,set:t=>this.methodHolder[e].push(t),get:()=>async function(){const r=t.methodHolder[e];if(n.overrideExecution==="BeforeAsync"){r.reverse()}for(var i=arguments.length,o=new Array(i),a=0;a<i;a++){o[a]=arguments[a]}for(const e of r){await e.apply(t,o)}}})}}}$(a,this);if(u){u.apply(this,r)}};e.override=function(t){const n={};n.constructor=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++){n[r]=arguments[r]}return e.apply(this,n)};const i=o.createClass(e,`anonymousExtension~${r()}`,n,s);i.getMetadata()._staticOverride=t;i.getMetadata()._override=e.getMetadata()._override;return i};t.set(n,c);return c}return f},false);
//# sourceMappingURL=ClassSupport.js.map