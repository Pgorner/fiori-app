/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/base/ClassSupport","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/PageController","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/KPIManagement","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/SideEffects","sap/fe/core/helpers/DeleteHelper","sap/fe/core/helpers/EditState","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/ResourceModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/chart/ChartUtils","sap/fe/macros/filter/FilterUtils","sap/fe/navigation/SelectionVariant","sap/fe/templates/ListReport/ExtensionAPI","sap/fe/templates/ListReport/overrides/SideEffects","sap/fe/templates/TableScroller","sap/ui/Device","sap/ui/base/ManagedObject","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/mvc/OverrideExecution","sap/ui/mdc/p13n/StateUtil","sap/ui/thirdparty/hasher","./AnalyticalPageTemplating"],function(t,e,i,n,r,o,a,s,l,g,c,d,u,p,h,f,y,C,b,P,_,m,A,w,I,V,F,S,T,B,M,v){"use strict";var x,E,D,R,O,L,H,N,z,k,j,U,$,K,J,q,W,X,G,Q,Y;var Z=S.InvisibleMessageMode;var tt=V.bindingParser;var et=p.getResourceModel;var it=i.usingExtension;var nt=i.publicExtension;var rt=i.privateExtension;var ot=i.finalExtension;var at=i.extensible;var st=i.defineUI5Class;function lt(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function gt(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,ct(t,e)}function ct(t,e){return ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ct(t,e)}function dt(t,e,i,n,r){var o={};return Object.keys(n).forEach(function(t){o[t]=n[t]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer?(Object.defineProperty(t,e,o),null):o}function ut(t,e){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}const pt=f.TemplateContentView,ht=f.InitialLoadMode;let ft=(x=st("sap.fe.ina.templates.AnalyticalPage.AnalyticalPageController"),E=it(a.override({getEntitySet:function(){return this.base.getCurrentEntitySet()}})),D=it(g.override(A)),R=it(s),O=it(l),L=nt(),H=ot(),N=rt(),z=at("After"),k=nt(),j=at(T.After),U=nt(),$=at(T.After),K=nt(),J=at(T.After),x(q=(W=function(i){function a(){var e;for(var n=arguments.length,r=new Array(n),o=0;o<n;o++){r[o]=arguments[o]}e=i.call(this,...r)||this;lt(e,"_intentBasedNavigation",X,e);lt(e,"_sideEffects",G,e);lt(e,"kpiManagement",Q,e);lt(e,"placeholder",Y,e);e.formatters={setALPControlMessageStrip(t,e,i){let n="";e=e==="true"||e===true;const r=this._getFilterBarControl();if(r&&Array.isArray(t)&&t.length>0&&e){const o=u.getLabels(t,r.data("entityType"),r,et(r));const a=!i?.enableSearch;n=e?u.getALPText(o,r,a):u.getText(o,r,"");return n}}};e.handlers={onFilterSearch(){const t=this._getFilterBarControl().getParent();t.triggerSearch()},onFiltersChanged(t){const e=this._getFilterBarControl();if(e){const i=this.getView().getBindingContext("internal");this.onPendingFilters();const n=e.getAssignedFiltersText().filtersText;const r=tt(n);const o=false;const a=this._isFilterBarHidden()||o;if(r&&!a){this.getView().byId("fe::appliedFiltersText")?.bindText(r)}else if(!a){this.getView().byId("fe::appliedFiltersText")?.setText(n)}if(i&&t.getParameter("conditionsBased")){i.setProperty("hasPendingFilters",true)}if(i){this._storeFilterBarSelectionVariant(e,i)}}},onVariantSelected(t){const e=t.getSource();const i=t.getParameter("key");const n=this._getMultiModeControl();if(n&&!e?.getParent()?.isA("sap.ui.mdc.ActionToolbar")){n?.invalidateContent();n?.setFreezeContent(true)}setTimeout(()=>{const t=this._getFilterBarControl();const r=this._getDynamicListReportControl();const o=t?.getFilterItems().find(function(t){return t.getRequired()&&t.getConditions().length===0});if(o){r.setHeaderExpanded(true)}if(this._shouldAutoTriggerSearch(e)){const t=this._getFilterBarControl().getParent();t.triggerSearch()}else if(!this._getApplyAutomaticallyOnVariant(e,i)){n?.setFreezeContent(false);this.getExtensionAPI().updateAppState();r.setHeaderExpanded(true)}},0)},onVariantSaved(){setTimeout(()=>{this.getExtensionAPI().updateAppState()},1e3)},onSearch(){const e=this._getFilterBarControl();const i=this.getView().getBindingContext("internal");const n=this.getChartControl();const r=P.getEditStateIsHideDraft(e.getConditions());i.setProperty("hasPendingFilters",false);i.setProperty("hideDraftInfo",r);const o=this._getDynamicListReportControl();if(!this._getMultiModeControl()){this._updateALPNotApplicableFields(i,e)}if(n){n.getBindingContext("internal").setProperty("",{});const t=n.getBindingContext("pageInternal");const e=t.getProperty(`${t.getPath()}/alpContentView`);if(e===pt.Chart){this.hasPendingChartChanges=true}if(e===pt.Table){this.hasPendingTableChanges=true}}if(!I.system.desktop&&i.getProperty("searchTriggeredByInitialLoad")===true){if(o.getHeaderExpanded()!==false){o.setHeaderExpanded(false)}i.setProperty("searchTriggeredByInitialLoad",false)}B.retrieveExternalState(e).then(t=>{this.filterBarConditions=t.filter;return}).catch(function(e){t.error("Error while retrieving the external state",e)});if(!this.getView().getViewData().liveMode){this.getExtensionAPI().updateAppState()}if(I.system.phone){const t=this._getDynamicListReportControl();if(!this._isInitLoadEnabled()){t.setHeaderExpanded(true)}else{t.setHeaderExpanded(false);this.setFilterToggleVisibility(false)}}},async onChevronPressNavigateOutBound(t,e,i,n){return t._intentBasedNavigation.onChevronPressNavigateOutBound(t,e,i,n)},onChartSelectionChanged(t){const e=t.getSource().getContent(),i=this._getTable(),n=t.getParameter("data"),r=this.getView().getBindingContext("internal");if(n){b.setChartFilters(e)}const o=r.getProperty(`${r.getPath()}/alpContentView`);if(o===pt.Chart){this.hasPendingChartChanges=true}else if(i){i.rebind();this.hasPendingChartChanges=false}},onDynamicPageTitleStateChanged(t){const e=this._getFilterBarControl();if(e){this.setFilterToggleVisibility(!!t.getParameter("isExpanded"));if(t.getParameter("isExpanded")===false){F.getInstance().announce(e.getAssignedFiltersText().filtersText,Z.Assertive)}}}};return e}gt(a,i);var s=a.prototype;s.getExtensionAPI=function t(){if(!this.extensionAPI){this.extensionAPI=new m(this)}return this.extensionAPI};s.onInit=function t(){o.prototype.onInit.apply(this);const e=this.getView().getBindingContext("internal");const i=this._getFilterBarControl();if(i){this._storeFilterBarSelectionVariant(i,e)}e.setProperty("hasPendingFilters",true);e.setProperty("hideDraftInfo",false);e.setProperty("uom",{});e.setProperty("scalefactor",{});e.setProperty("scalefactorNumber",{});e.setProperty("currency",{});e.setProperty("isInsightsSupported",false);if(this._hasMultiVisualizations()){let t=this._getDefaultPath();if(!I.system.desktop&&t===pt.Hybrid){t=pt.Chart}e.setProperty("alpContentView",t)}this.filterBarConditions={};this.getAppComponent().getRouterProxy().waitForRouteMatchBeforeNavigation();this._setInitLoad()};s.onExit=function t(){delete this.filterBarConditions;if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI};s._onAfterBinding=function e(){const i=this._getControls("table");if(d.isEditStateDirty()){this._getMultiModeControl()?.invalidateContent();const t=this._getTable();const e=t?.getRowBinding();if(e){const n=t?.getParent();const o=()=>{if(n.getTableDefinition().control.type==="TreeTable"){this.getModel().resetChanges()}n.refresh()};if(r.getAppComponent(this.getView())._isFclEnabled()){o()}else{if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(()=>{o();delete this.sUpdateTimer},0)}const t=()=>{this._updateTableActions(i);e.detachDataReceived(t)};e.attachDataReceived(t)}}d.setEditStateProcessed()}if(!this.sUpdateTimer){this._updateTableActions(i)}const n=this.getView().getBindingContext("internal");if(!n.getProperty("initialVariantApplied")){const t=this.getView().getId();this.pageReady.waitFor(this._applyAppState(t));n.setProperty("initialVariantApplied",true)}const o=r.getAppComponent(this.getView()).getEnvironmentCapabilities();o.isInsightsEnabled().then(t=>{n.setProperty("isInsightsSupported",t);return}).catch(e=>{t.error("Error while checking if insights are enabled",e)})};s.onPageReady=async function t(){await this.getAppComponent().getShellServices().setBackNavigation(undefined);this._initMultiDimModelChangeHandler()};s._initMultiDimModelChangeHandler=function t(){const e=this.getView().getModel("mdm");const i=this.getView().byId("MultiDimModelChangeHandler");i?.registerMultiDimModel(e)};s.onViewNeedsRefresh=function t(e){};s.onPendingFilters=function t(){};s.getCurrentEntitySet=function t(){return this._getTable()?.data("targetCollectionPath").slice(1)};s.onAfterClear=function t(){};s._updateTableActions=function t(e){let i=[];e.forEach(function(t){i=r.getIBNActions(t,i);const e=t.getBindingContext("internal");const o=JSON.parse(y.parseCustomData(C.getCustomData(t,"operationAvailableMap"))),a=t.getSelectedContexts();e.setProperty("selectedContexts",a);e.setProperty("numberOfSelectedContexts",a.length);c.updateDeleteInfoForSelectedContexts(e,a);n.setActionEnablement(e,o,a,"table")});r.updateDataFieldForIBNButtonsVisibility(i,this.getView())};s._scrollTablesToRow=function t(e){this._getControls("table").forEach(function(t){w.scrollTableToRow(t,e)})};s._focusSilent=function t(e){const i=e.getFocusInfo();i.targetInfo={silent:true};e.focus(i)};s._setInitialFocus=function e(){const i=this._getDynamicListReportControl(),n=i.getHeaderExpanded(),r=this._getFilterBarControl();if(r){if(!r.getShowMessages()){r.setShowMessages(true)}if(n){const t=r.getFilterItems().find(function(t){return t.getRequired()&&t.getConditions().length===0});if(t){if(t.isA("sap.ui.mdc.FilterField")){this._focusSilent(t)}else{t.focus()}}else if(this._isInitLoadEnabled()&&r.getFilterItems().length>0){const t=r.getFilterItems()[0];if(t.isA("sap.ui.mdc.FilterField")){this._focusSilent(t)}else{t.focus()}}else{this.getView().byId(`${this._getFilterBarControlId()}-btnSearch`)?.focus()}}else if(this._isInitLoadEnabled()){this._getTable()?.focusRow(0).catch(function(e){t.error("Error while setting initial focus on the table ",e)})}}else{this._getTable()?.focusRow(0).catch(function(e){t.error("Error while setting initial focus on the table ",e)})}};s._getPageTitleInformation=function t(){const e=this.getAppComponent().getManifestEntry("sap.app");return{title:e.title,subtitle:e.subTitle||"",intent:"",icon:""}};s._getFilterBarControl=function t(){return this.getView().byId(this._getFilterBarControlId())};s._getDynamicListReportControl=function t(){return this.getView().byId(this._getDynamicListReportControlId())};s._getAdaptationFilterBarControl=function t(){const e=this._getFilterBarControl().getInbuiltFilter?.();return e?.getParent()?e:undefined};s._applyAppState=async function t(e){await this.getAppComponent().getAppStateHandler().applyAppState(e,this.getView())};s._getSegmentedButton=function t(e){const i=(e==="Chart"?this.getChartControl():this._getTable())?.data("segmentedButtonId");return this.getView().byId(i)};s._getControlFromPageModelProperty=function t(e){const i=this._getPageModel()?.getProperty(e);return i?this.getView().byId(i):undefined};s._getDynamicListReportControlId=function t(){return this._getPageModel()?.getProperty("/dynamicListReportId")||""};s._getFilterBarControlId=function t(){return this._getPageModel()?.getProperty("/filterBarId")||""};s.getChartControl=function t(){return this._getControlFromPageModelProperty("/singleChartId")};s._getVisualFilterBarControl=function t(){const e=h.generate(["visualFilter",this._getFilterBarControlId()]);return e?this.getView().byId(e):undefined};s._getFilterBarVariantControl=function t(){return this._getControlFromPageModelProperty("/variantManagement/id")};s._getMultiModeControl=function t(){return this.getView().byId("fe::TabMultipleMode::Control")};s._getIconTabBar=function t(){return this.getView().byId("fe::TabMultipleMode")};s._getTable=function t(){if(this._isMultiMode()){const t=this._getMultiModeControl()?.getSelectedInnerControl()?.content;return t?.isA("sap.ui.mdc.Table")?t:undefined}else{return this._getControlFromPageModelProperty("/singleTableId")}};s._getControls=function t(e){if(this._isMultiMode()){const t=[];const i=this._getMultiModeControl().content;i.getItems().forEach(i=>{const n=this.getView().byId(i.getKey());if(n&&e){if(i.getKey().includes(`fe::${e}`)){t.push(n)}}else if(n!==undefined&&n!==null){t.push(n)}});return t}else if(e==="Chart"){const t=this.getChartControl();return t?[t]:[]}else{const t=this._getTable();return t?[t]:[]}};s._getDefaultPath=function t(){const e=v.getDefaultPath(this._getPageModel()?.getProperty("/views")||[]);switch(e){case"primary":return pt.Chart;case"secondary":return pt.Table;case"both":default:return pt.Hybrid}};s._isMultiMode=function t(){return!!this._getPageModel()?.getProperty("/multiViewsControl")};s._isInitLoadEnabled=function t(){const e=this.getView().getViewData().initialLoad;return e===ht.Enabled};s._hasMultiVisualizations=function t(){return this._getPageModel()?.getProperty("/hasMultiVisualizations")};s._applyAutomaticallyOnStandardVariant=function t(){return false};s._setInitLoad=function t(){const e=v.getVariantBackReference(this.getView().getViewData(),this._getPageModel()?.getData());const i=e&&this.getView().byId(e);if(i){i?.registerApplyAutomaticallyOnStandardVariant?.(this._applyAutomaticallyOnStandardVariant.bind(this))}};s._setShareModel=function t(){const i=e.get("sap.ushell.Container.getUser");const n={bookmarkTitle:document.title,bookmarkCustomUrl:function(){const t=M.getHash();return t?`#${t}`:window.location.href},isShareInJamActive:!!i&&i().isJamActive()};const r=this.getOwnerComponent().getModel("_templPriv");r.setProperty("/listReport/share",n)};s._updateALPNotApplicableFields=function t(e,i){const n={};const r={},o=this._getControls("table"),a=this._getControls("Chart");if(!o.length||!a.length){return}a.forEach(function(t){const e=t.data("targetCollectionPath"),o=e.slice(1),a=`${o}Chart`;if(!n[a]){n[a]=P.getNotApplicableFilters(i,t)}r[a]=n[a]});e.setProperty("controls/ignoredFields",r)};s._isFilterBarHidden=function t(){return this.getView().getViewData().hideFilterBar||false};s._getApplyAutomaticallyOnVariant=function t(e,i){if(!e||!i){return false}const n=e.getVariants();const r=n.find(function(t){return t&&t.key===i});return r&&r.executeOnSelect||false};s._shouldAutoTriggerSearch=function t(e){if(this.getView().getViewData().initialLoad===ht.Auto&&(!e||e.getStandardVariantKey()===e.getCurrentVariantKey())){const t=this._getFilterBarControl();if(t){const i=t.getConditions();for(const t in i){if(e&&!t.startsWith("$")&&Array.isArray(i[t])&&i[t].length){const t=e.getVariants().find(t=>t.key===e.getCurrentVariantKey());return t&&t.executeOnSelect}}}}return false};s._updateTable=function t(e){if(!e.isTableBound()||this.hasPendingChartChanges){e.rebind();this.hasPendingChartChanges=false}};s._updateChart=function t(e){const i=e.getControlDelegate()._getChart(e);if(!(i&&i.isBound("data"))||this.hasPendingTableChanges){e.getControlDelegate().rebind(e,i.getBindingInfo("data"));this.hasPendingTableChanges=false}};s.setFilterToggleVisibility=function t(e){const i=this._getFilterBarControl();i?.getSegmentedButton()?.setVisible(e)};s.onAfterRendering=function t(){const e=this._getControls();const i=this.getView().getViewData().entitySet;const n=et(this.getView()).getText("T_TABLE_AND_CHART_NO_DATA_TEXT",undefined,i);e.forEach(function(t){if(t.isA("sap.ui.mdc.Table")){t.setNoData(n)}})};s._storeFilterBarSelectionVariant=async function e(i,n){try{const t=i.getParent();const e=await t.getSelectionVariant();n.setProperty("filterBarSelectionVariant",e)}catch(e){const i=e instanceof Error?e.message:String(e);t.error(`FE : Error fetching selection variant on filter change: ${i}`)}};s.getFilterBarSelectionVariant=function t(){const e=this.getView().getBindingContext("internal");return e?.getProperty("filterBarSelectionVariant")||new _};return a}(o),X=dt(W.prototype,"_intentBasedNavigation",[E],{configurable:true,enumerable:true,writable:true,initializer:null}),G=dt(W.prototype,"_sideEffects",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=dt(W.prototype,"kpiManagement",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=dt(W.prototype,"placeholder",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),dt(W.prototype,"getExtensionAPI",[L,H],Object.getOwnPropertyDescriptor(W.prototype,"getExtensionAPI"),W.prototype),dt(W.prototype,"onPageReady",[N,z],Object.getOwnPropertyDescriptor(W.prototype,"onPageReady"),W.prototype),dt(W.prototype,"onViewNeedsRefresh",[k,j],Object.getOwnPropertyDescriptor(W.prototype,"onViewNeedsRefresh"),W.prototype),dt(W.prototype,"onPendingFilters",[U,$],Object.getOwnPropertyDescriptor(W.prototype,"onPendingFilters"),W.prototype),dt(W.prototype,"onAfterClear",[K,J],Object.getOwnPropertyDescriptor(W.prototype,"onAfterClear"),W.prototype),W))||q);return ft},false);
//# sourceMappingURL=AnalyticalPageController.controller.js.map