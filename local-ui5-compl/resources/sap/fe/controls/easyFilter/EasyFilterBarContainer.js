/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/base/jsx-runtime/jsx","sap/fe/controls/easyFilter/Token","sap/m/Button","sap/m/FlexBox","sap/m/Popover","sap/m/Tokenizer","sap/m/VBox","sap/m/library","sap/ui/core/Control","sap/ui/core/CustomData","sap/ui/core/Lib","sap/ui/core/library","sap/base/util/deepClone","sap/fe/base/BindingToolkit","sap/fe/controls/easyFilter/EasyFilterInput","sap/m/MessageStrip","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/performance/trace/FESRHelper","./AINotice","./utils","sap/fe/base/jsx-runtime/jsx","sap/fe/base/jsx-runtime/Fragment","sap/fe/base/jsx-runtime/jsxs"],function(e,t,r,i,n,s,a,o,l,u,c,h,p,d,f,y,g,b,k,S,m,v,F,T,E,I){"use strict";var P,M,C,w,V,B,R,_,z,x,A,L,O,j,q,K,D,U,N,Y,G,H,Q,W,J,$,X,Z,ee,te,re,ie,ne;function se(e){return new Promise((t,r)=>{sap.ui.require([e],r=>{if(!(r&&r.__esModule)){r=r===null||!(typeof r==="object"&&e.endsWith("/library"))?{default:r}:r;Object.defineProperty(r,"__esModule",{value:true})}t(r)},e=>{r(e)})})}var ae={};var oe=y.bindState;var le=y.and;var ue=d.ValueState;var ce=u.PlacementType;var he=u.FlexWrap;var pe=u.FlexJustifyContent;var de=u.FlexAlignItems;var fe=u.ButtonType;var ye=t.property;var ge=t.event;var be=t.defineUI5Class;var ke=t.defineState;var Se=t.defineReference;var me=t.createReference;var ve=t.aggregation;function Fe(e,t,r,i){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Te(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Ee(e,t)}function Ee(e,t){return Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ee(e,t)}function Ie(e,t,r,i,n){var s={};return Object.keys(i).forEach(function(e){s[e]=i[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},s),n&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(n):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function Pe(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let Me=(P=be("sap.fe.controls.easyFilter.EasyFilterBarContainer"),M=ye({type:"string"}),C=ye({type:"string"}),w=ye({type:"string"}),V=ye({type:"array"}),B=ye({type:"array"}),R=Se(),_=Se(),z=ve({type:"sap.ui.core.Control"}),x=ge(),A=ge(),L=ge(),O=ge(),j=ge(),q=ge(),K=ke(),P(D=(U=function(t){function u(e,r){var i;i=t.call(this,e,r)||this;Fe(i,"contextPath",N,i);Fe(i,"appId",Y,i);Fe(i,"easyFilterLib",G,i);Fe(i,"filterBarMetadata",H,i);Fe(i,"recommendedValues",Q,i);Fe(i,"easyFilterInput",W,i);Fe(i,"tokenizer",J,i);Fe(i,"content",$,i);Fe(i,"tokensChanged",X,i);Fe(i,"queryChanged",Z,i);Fe(i,"showValueHelp",ee,i);Fe(i,"clearFilters",te,i);Fe(i,"beforeQueryProcessing",re,i);Fe(i,"afterQueryProcessing",ie,i);Fe(i,"state",ne,i);i.shouldTokenChangeEventFired=true;i.inputFieldReady=new Promise(e=>{i.resolveContentReady=e});i.initialize();return i}ae=u;Te(u,t);var c=u.prototype;c.setEasyFilterLib=function e(t){this.setProperty("easyFilterLib",t);if(this.easyFilterLib){this.easyfilter=se(this.easyFilterLib)}};c.setAppId=async function e(t){if(!this.appId){this.setProperty("appId",t,true);await this.inputFieldReady;this.easyFilterInput.current?.setProperty("appId",t,true);await(this.easyFilterInput.current?.initShellHistoryProvider())}};c.setFilterBarMetadata=function e(t){if(!this.filterBarMetadata){this.setProperty("filterBarMetadata",t,true);const e=this.getDefaultTokens();if(!this.innerControlPopover){this.innerControlPopover=this.createPopoverForInnerControls();this.addDependent(this.innerControlPopover)}this.state.tokens=e;this.state.showResult=e.length>0;this.isMandatoryCheckRequired=true;this.shouldTokenChangeEventFired=false}};c.init=function e(){this.resourceBundle=p.getResourceBundleFor("sap.fe.controls")};c.initialize=function e(){this.content=this.createContent();this.resolveContentReady();if(!this.innerControlPopover){this.innerControlPopover=this.createPopoverForInnerControls();this.addDependent(this.innerControlPopover)}this.isMandatoryCheckRequired=true;this.shouldTokenChangeEventFired=false};c.getDefaultTokens=function e(){const t=[];if(!this.mandatoryKeyMap){this.mandatoryKeyMap={}}this.filterBarMetadata?.forEach(e=>{const r=e.required;if(r){this.mandatoryKeyMap[e.name]=true;t.push({key:e.name,label:e.label,keySpecificSelectedValues:e.defaultValue??[],type:e.type,isRequired:r})}});return t};c.onEnterPressed=function e(t){this.onGoPress(t.getParameter("query"))};c.checkIfAllMandatoryTokensFilled=function e(){const t=this.getUnSetMandatoryTokensInCurrentState();if(t.length!==0){const e=this.getActualTokensFromState(t);e?.forEach(e=>{e.setProperty("valueState",ue.Error);e.setProperty("valueStateText",this.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_ERROR"));e.openValueStateMessage()});return false}return true};c.closeAllMandatoryValueStateMessages=function e(){const t=this.tokenizer.current?.getTokens();t.forEach(e=>e.closeValueStateMessage())};c.onGoPress=async function t(r){if(!r){this.resetState();return}this.state.tokenizerEditable=true;const i=await this.easyfilter;if(!i){return}this.fireEvent("beforeQueryProcessing");const n={version:1,entitySet:this.contextPath,fields:this.filterBarMetadata};const s=await i.easyFilter(r,n);if(s.success){if(this.easyFilterInput.current?.isHistoryEnabled()??false){this.easyFilterInput.current?.addRecentQuery(r)}if(s.data.version===1){this.handleV1Success(s)}else if(s.data.version===2){}}else{this.easyFilterInput.current?.setAsInvalid(s.message);this.removeNonMandatoryTokens();e.error("Error while generating filter criteria: ",s.message)}this.fireEvent("afterQueryProcessing")};c.handleV1Success=function t(r){if(r.data.unclear){this.easyFilterInput.current?.setAsInvalid(this.resourceBundle.getText("M_EASY_FILTER_UNCLEAR_INPUT",[r.data.unclear]))}if(r.data.filter){e.debug("Filter criteria generated: ",JSON.stringify(r.data.filter,null,2));const t=[...this.state.tokens].filter(e=>e.isRequired);F.formatData(t,r.data.filter,this.filterBarMetadata);const i=this.verifySingleSelectTokenValues(t);this.state.showResult=true;this.state.tokens=i}};c.verifySingleSelectTokenValues=function e(t){const r=[];t.forEach(e=>{if(e.type==="MenuWithSingleSelect"){if(e.keySpecificSelectedValues[0].selectedValues.length>1){r.push(e.label);e.keySpecificSelectedValues[0].selectedValues.splice(1)}}});if(r.length){this.state.singleValueMessageStripText=this.resourceBundle.getText("M_EASY_FILTER_SINGLE_VALUE_MESSAGE",[`<strong>${r.join(", ")}</strong>`]);this.state.showSingleValueMessageStrip=true}return t};c.createPopoverForInnerControls=function e(){if(!this.innerControlPopover){this.innerControlPopover=T(a,{id:this.getId()+"-innerPopover",showArrow:false,showHeader:true,placement:ce.Bottom,children:{footer:this.getToolbar()}})}return this.innerControlPopover};c.getToolbar=function e(){if(!this.toolbar){const e=this.getOkButton();const t=this.getShowAllButton();this.toolbar=T(k,{children:{content:I(E,{children:[T(S,{}),e,t]})}})}return this.toolbar};c.getOkButton=function e(){if(!this.okButton){this.okButton=T(n,{text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_OK"),type:fe.Emphasized})}return this.okButton};c.getShowAllButton=function e(){if(!this.showAllButton){this.showAllButton=T(n,{text:this.resourceBundle.getText("M_EASY_FILTER_POPOVER_SHOW_ALL_ITEMS")})}return this.showAllButton};c.onStateChange=function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(t.includes("tokens")){if(this.shouldTokenChangeEventFired){this.fireEvent("tokensChanged",{tokens:this.state.tokens.map(e=>f(e))})}this.state.showResult=this.state.tokens.length>0;if(!(this.isMandatoryCheckRequired??false)){this.checkIfAllMandatoryTokensFilled()}}this.isMandatoryCheckRequired=false;this.shouldTokenChangeEventFired=true};c.createContent=function e(){const t=me();const r=I(l,{children:[I(s,{renderType:"Bare",children:[T(g,{recommendedValues:this.recommendedValues,ref:this.easyFilterInput,enterPressed:this.onEnterPressed.bind(this),queryChanged:e=>{this.fireEvent("queryChanged",{query:e.getParameter("query")})},liveChange:()=>{this.state.tokenizerEditable=false}}),T(n,{icon:"sap-icon://ai",class:"sapUiSmallMarginBegin",ref:t,text:this.resourceBundle.getText("M_EASY_FILTER_GO"),type:fe.Emphasized,press:this.onGoButtonPress.bind(this)})]}),T(s,{renderType:"Bare",visible:oe(this.state,"showResult"),alignItems:de.Center,wrap:he.Wrap,justifyContent:pe.SpaceBetween,class:"sapUiTinyMarginTop",children:I(s,{class:"sapFeControlsGap8px",renderType:"Bare",alignItems:de.Center,wrap:he.Wrap,children:[T(v,{resourceBundle:this.resourceBundle}),T(o,{editable:le(oe(this.state,"tokenizerEditable"),true),class:"sapFeControlsTokenizer",tokens:oe(this.state,"tokens"),ref:this.tokenizer,children:{tokens:(e,t)=>{const r=t.getObject();return T(i,{label:this.state.tokens.label,items:this.state.tokens.keySpecificSelectedValues,mandatory:this.isKeyMandatory(r.key),delete:()=>{const e=this.state.tokens.findIndex(e=>e.key===r.key);const t=this.state.tokens.concat();t.splice(e,1);this.state.tokens=t;this.updateFilterInput("tokenUpdated")},children:{customData:[T(h,{value:r},"TokenInfo"),T(h,{value:this.innerControlPopover},"popover"),T(h,{value:this},"easyFilterBarContainer"),T(h,{value:this.filterBarMetadata?.find(e=>e.name===r.key)?.codeList},"codeList")]}},this.state.tokens.key)}}}),T(n,{text:this.resourceBundle.getText("M_EASY_FILTER_RESET"),type:fe.Transparent,press:()=>{this.resetState();this.easyFilterInput.current?.$searchInput.focus()}})]})}),T(s,{renderType:"Bare",children:T(b,{text:oe(this.state,"singleValueMessageStripText"),showIcon:true,enableFormattedText:true,visible:oe(this.state,"showSingleValueMessageStrip"),showCloseButton:true,close:()=>{this.state.showSingleValueMessageStrip=false}})})]});m.setSemanticStepname(t.current,"press","fe:ai:search");return r};c.onGoButtonPress=async function e(){this.state.tokenizerEditable=true;let t=this.easyFilterInput.current?.getValue();const r=this.easyFilterInput.current?.getPlaceholder();if(t===""&&r!==this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER")){this.easyFilterInput.current?.setValue(r||"");t=r}await this.onGoPress(t)};c.resetState=function e(){this.fireEvent("clearFilters");this.state.tokens=this.getDefaultTokens();this.updateFilterInput("tokenReset");this.state.tokenizerEditable=true;this.isMandatoryCheckRequired=true;this.tokenizer.current?.getTokens().forEach(e=>e.setProperty("valueState",ue.None));this.tokenizer.current?.getTokens().forEach(e=>e.setProperty("valueStateText",null))};c.updateTokenArray=function t(r,i,n){const s=this.state.tokens.map(e=>({...e,keySpecificSelectedValues:[...e.keySpecificSelectedValues]}));const a=s.findIndex(e=>e.key===n);const o=s[a];if(a!=-1){switch(r){case"setSelectedValues":this.setSelectedValues(o,i,a,s);o.keySpecificSelectedValues=i;if(!this.isKeyMandatory(o.key)&&o.keySpecificSelectedValues.length===0){s.splice(a,1)}break;default:e.error("Specifying a setter that is out of the boundary");break}this.state.tokens=s;this.state.showResult=s.length>0;this.updateFilterInput("tokenUpdated")}};c.closeInnerControlPopover=function e(){this.innerControlPopover?.close()};c.setSelectedValues=function e(t,r,i,n){t.keySpecificSelectedValues=r;if(!this.isKeyMandatory(t.key)&&t.keySpecificSelectedValues.length===0){n.splice(i,1)}};c.isKeyMandatory=function e(t){if(!this.mandatoryKeyMap){this.mandatoryKeyMap={}}return this.mandatoryKeyMap[t]?true:false};c.removeNonMandatoryTokens=function e(){const t=this.state.tokens.filter(e=>this.isKeyMandatory(e.key));this.state.tokens=t;return this};c.updateFilterInput=function e(t){const r=this.easyFilterInput.current?.getValue()||"";if(t==="tokenUpdated"&&r!==""){this.easyFilterInput.current?.setValue("");this.easyFilterInput.current?.setPlaceholder(r)}else if(t==="tokenReset"){this.easyFilterInput.current?.setValue("");this.easyFilterInput.current?.setPlaceholder(this.resourceBundle.getText("M_EASY_FILTER_PLACEHOLDER"))}};c.getTokensInInitialState=function e(){const t=this.state.tokens.map(e=>({...e,keySpecificSelectedValues:[...e.keySpecificSelectedValues]}));const r=t.filter(e=>{if(this.isKeyMandatory(e.key)){return true}});return r.map(e=>({...e,keySpecificSelectedValues:[]}))};c.getUnSetMandatoryTokensInCurrentState=function e(){return this.state.tokens.filter(e=>{const t=this.isKeyMandatory(e.key);if(t){return e.keySpecificSelectedValues.length===0}})};c.getActualTokensFromState=function e(t){const r=t.map(e=>e.key);return this.tokenizer.current?.getTokens().filter(e=>r.includes(e.getKey()))};u.render=function e(t,i){return r.renderUsingRenderManager(t,i,()=>T("span",{ref:i,children:i.getAggregation("content")}))};return u}(c),N=Ie(U.prototype,"contextPath",[M],{configurable:true,enumerable:true,writable:true,initializer:null}),Y=Ie(U.prototype,"appId",[C],{configurable:true,enumerable:true,writable:true,initializer:null}),G=Ie(U.prototype,"easyFilterLib",[w],{configurable:true,enumerable:true,writable:true,initializer:null}),H=Ie(U.prototype,"filterBarMetadata",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=Ie(U.prototype,"recommendedValues",[B],{configurable:true,enumerable:true,writable:true,initializer:null}),W=Ie(U.prototype,"easyFilterInput",[R],{configurable:true,enumerable:true,writable:true,initializer:null}),J=Ie(U.prototype,"tokenizer",[_],{configurable:true,enumerable:true,writable:true,initializer:null}),$=Ie(U.prototype,"content",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),X=Ie(U.prototype,"tokensChanged",[x],{configurable:true,enumerable:true,writable:true,initializer:null}),Z=Ie(U.prototype,"queryChanged",[A],{configurable:true,enumerable:true,writable:true,initializer:null}),ee=Ie(U.prototype,"showValueHelp",[L],{configurable:true,enumerable:true,writable:true,initializer:null}),te=Ie(U.prototype,"clearFilters",[O],{configurable:true,enumerable:true,writable:true,initializer:null}),re=Ie(U.prototype,"beforeQueryProcessing",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),ie=Ie(U.prototype,"afterQueryProcessing",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),ne=Ie(U.prototype,"state",[K],{configurable:true,enumerable:true,writable:true,initializer:function(){return{showResult:false,tokens:[],tokenizerEditable:true,showSingleValueMessageStrip:false,singleValueMessageStripText:""}}}),U))||D);ae=Me;return ae},false);
//# sourceMappingURL=EasyFilterBarContainer.js.map