/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/base/ClassSupport","sap/fe/base/jsx-runtime/jsx","sap/m/Token","sap/m/delegate/ValueStateMessage","sap/ui/core/Lib","sap/ui/core/library","sap/ui/model/FilterOperator","./innerControls/CalendarFactory","./innerControls/MenuWithCheckBoxFactory","./innerControls/MenuWithSingleSelectFactory","./innerControls/TimeFactory","./innerControls/ValueHelpPreviewFactory","./utils","sap/fe/base/jsx-runtime/jsxs","sap/fe/base/jsx-runtime/jsx"],function(e,t,i,n,o,s,a,r,l,u,h,c,p,d,f,g){"use strict";var C,m,v,y,b,k,S,V,D,T,B,w,F,M,P,A,O,E,x,H,W;var z={};var _=a.ValueState;var I=t.property;var L=t.defineUI5Class;function j(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function R(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,K(e,t)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}function N(e,t,i,n,o){var s={};return Object.keys(n).forEach(function(e){s[e]=n[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce(function(i,n){return n(e,t,i)||i},s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer?(Object.defineProperty(e,t,s),null):s}function Y(e,t){throw Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}let U=(C=L("sap.fe.controls.easyFilter.Token"),m=I({type:"string"}),v=I({type:"string"}),y=I({type:"string"}),b=I({type:"string",defaultValue:null}),k=I({type:"boolean"}),S=I({type:"array"}),V=I({type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:_.None}),D=I({type:"int",visibility:"hidden"}),T=I({type:"int",visibility:"hidden"}),C(B=(w=function(t){function a(e,i){var n;n=t.call(this,e,i)||this;j(n,"label",F,n);j(n,"titlePopover",M,n);j(n,"value",P,n);j(n,"valueStateText",A,n);j(n,"mandatory",O,n);j(n,"items",E,n);j(n,"valueState",x,n);j(n,"posinset",H,n);j(n,"setsize",W,n);n.resourceBundle=s.getResourceBundleFor("sap.fe.controls");n.eventAttached=false;n.isDescriptionFetched=false;n.valueStateMessage=new o(n);n.attachCloseHandlersForValueStateMessagePopup();return n}z=a;R(a,t);var C=a.prototype;C.firePress=function e(t){const i=this.getParent();if(!i.getEditable()){return this}this.fireEvent("press");this.valueStateMessage?.close();const n=this.getCustomDataValue("easyFilterBarContainer");const o=this.getCustomDataValue("popover");const{key:s,type:r,keySpecificSelectedValues:l}=this.getCustomDataValue("TokenInfo");if(o.isOpen()){if(a.prevTokenKey===s){return this}else{a.prevTokenKey=s;o.close()}}else{a.prevTokenKey=s}o?.setShowHeader(true);o?.getFooter()?.setVisible(true);if(r==="Calendar"&&this.shouldOpenDefaultFragment(l)){this.invokeCalendar()}else if(r==="Time"&&this.shouldOpenDefaultFragment(l)){this.invokeTime()}else if(r==="MenuWithCheckBox"){this.invokeMenuWithCheckBox()}else if(r==="MenuWithSingleSelect"){this.invokeMenuWithSingleSelect()}else{this.invokeValueHelpPreview()}const u=n?.getOkButton();const h=n?.getShowAllButton();if(!(this.eventAttached??false)){u?.attachPress(this.handleOkClick.bind(this));h?.attachPress(this.handleShowAllClick.bind(this));o.attachAfterClose(this.handleAttachAfterClose.bind(this));this.eventAttached=true}return this};C.getCustomDataValue=function e(t){return this.getCustomData().find(e=>e.getKey()===t)?.getValue()};C.onBeforeRendering=function e(t){n.prototype.onBeforeRendering.apply(this,[t]);if(!this.isDescriptionFetched){this.setValueForToken()}this.isDescriptionFetched=false};C.attachCloseHandlersForValueStateMessagePopup=function e(){document.addEventListener("click",()=>{if(this?.valueStateMessage){this.valueStateMessage.close()}});document.addEventListener("touchstart",()=>{if(this?.valueStateMessage){this.valueStateMessage.close()}})};C.setValueForToken=function e(){const t=this.items;if(t.length>0){const e=t[0].selectedValues;const i=t[0]?.operator;const n=e[0];const o=t?.reduce((e,t)=>{if(d.isBetweenSelectedValues(t.operator)){return++e}else{return e+t.selectedValues.length}},0);if(o===1){const t=this.getCustomDataValue("TokenInfo");const o=this.getCustomDataValue("easyFilterBarContainer");const s=o?.filterBarMetadata?.find(e=>e.name===this.getKey());if(!s){return}const{type:a,dataType:r}=s;if(t){const{key:o}=t;if(a==="MenuWithCheckBox"||a==="MenuWithSingleSelect"){this.setValueForMenu(o);return}if(d.isBetweenSelectedValues(i)){this.setProperty("value",d.mapOperatorForBetweenOperator(i,e,a,r==="Edm.DateTimeOffset"),true)}else{this.setProperty("value",d.mapOperator(i,n,a,r==="Edm.DateTimeOffset"),true)}}}else{this.setProperty("value",this.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_ITEMS",[o],true))}}else{this.setProperty("value",this.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_SELECT_VALUE"),true)}};C.setValueForMenu=function t(i){const n=this.getCustomDataValue("easyFilterBarContainer");this.setBusy(true);(async()=>{try{const e=await this.getDescriptionByKey(n.filterBarMetadata?.find(e=>e.name===i),this.items);this.setProperty("value",e);this.isDescriptionFetched=true;this.setBusy(false)}catch(t){e.error("Error while fetching codeList",t)}})()};C.getDomRefForValueStateMessage=function e(){return this.getDomRef()};C.getDescriptionByKey=async function e(t,i){const n=await d.getCodeListArray(t.codeList);return n?.find(e=>e.value===i[0].selectedValues[0])?.description};C.invokeMenuWithCheckBox=async function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");const n=this.getCustomDataValue("codeList");const{keySpecificSelectedValues:o}=this.getCustomDataValue("TokenInfo");if(!this.menuWithCheckBox){this.menuWithCheckBox=new u(t,this)}this.innerControl=this.menuWithCheckBox.getControl();this.addDependent(this.innerControl);await this.menuWithCheckBox.setItems(n,o);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(false);this.openPopover()};C.invokeMenuWithSingleSelect=async function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");const n=this.getCustomDataValue("codeList");const{keySpecificSelectedValues:o}=this.getCustomDataValue("TokenInfo");if(!this.menuWithSingleSelect){this.menuWithSingleSelect=new h(t,this)}this.innerControl=this.menuWithSingleSelect.getControl();this.addDependent(this.innerControl);await this.menuWithSingleSelect.setItems(n,o);i.setShowHeader(false);i.getFooter()?.setVisible(false);i?.removeAllContent();i?.addContent(this.innerControl);this.openPopover()};C.invokeCalendar=function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");if(!this.calender){this.calender=new l(t,this)}this.innerControl=this.calender.getControl();this.addDependent(this.innerControl);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(true);this.openPopover()};C.invokeTime=function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");if(!this.time){this.time=new c(t,this)}this.innerControl=this.time.getControl();this.addDependent(this.innerControl);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(true);this.openPopover()};C.invokeValueHelpPreview=function e(){const t=this.getCustomDataValue("easyFilterBarContainer");const i=this.getCustomDataValue("popover");if(!this.valueHelpPreview){this.valueHelpPreview=new p(t,this)}const{type:n,dataType:o}=t.filterBarMetadata?.find(e=>e.name===this.getKey());this.valueHelpPreview.setItems(this.items,n,o==="Edm.DateTimeOffset");this.innerControl=this.valueHelpPreview.getControl();this.addDependent(this.innerControl);i?.removeAllContent();i?.addContent(this.innerControl);t?.getShowAllButton()?.setVisible(true);this.openPopover()};C.openPopover=function e(){const t=this.getCustomDataValue("popover");t?.setTitle(this.label);t?.openBy(this)};C.handleOkClick=function e(){if(!this.innerControl?.getDomRef()){return}const{type:t,keySpecificSelectedValues:i}=this.getCustomDataValue("TokenInfo");const n=this.getCustomDataValue("popover");let o;if(t==="Calendar"&&this.shouldOpenDefaultFragment(i)){o=this.calender?.invokeOkButtonHandler.bind(this.calender)}else if(t==="Time"&&this.shouldOpenDefaultFragment(i)){o=this.time?.invokeOkButtonHandler.bind(this.time)}else if(t==="MenuWithCheckBox"){o=this.menuWithCheckBox?.invokeOkButtonHandler.bind(this.menuWithCheckBox)}else{o=this.valueHelpPreview?.invokeOkButtonHandler.bind(this.valueHelpPreview)}if(o){o()}n?.close()};C.handleShowAllClick=function e(){if(!this.innerControl?.getDomRef()){return}const t=this.getCustomDataValue("popover");const{type:i,keySpecificSelectedValues:n}=this.getCustomDataValue("TokenInfo");t.close();let o;if(i==="Calendar"&&this.shouldOpenDefaultFragment(n)){o=this.calender?.invokeShowAllButtonHandler.bind(this.calender)}else if(i==="Time"&&this.shouldOpenDefaultFragment(n)){o=this.time?.invokeShowAllButtonHandler.bind(this.time)}else{o=this.valueHelpPreview?.invokeShowAllButtonHandler.bind(this.valueHelpPreview)}if(o){(()=>{o()})()}};C.handleAttachAfterClose=function e(){if(!this.innerControl?.getDomRef()){return}const t=this.getCustomDataValue("TokenInfo");if(t){const{type:e,keySpecificSelectedValues:t}=this.getCustomDataValue("TokenInfo");if(e==="ValueHelp"||(e==="Calendar"||e==="Time")&&!this.shouldOpenDefaultFragment(t)){this.valueHelpPreview?.invokePopupCloseHandler()}else if(e==="MenuWithCheckBox"){this.menuWithCheckBox?.invokePopupCloseHandler()}}};C.getInnerControl=function e(){return this.innerControl};C.openValueStateMessage=function e(){this.valueStateMessage?.open()};C.closeValueStateMessage=function e(){this.valueStateMessage?.close()};C.shouldOpenDefaultFragment=function e(t){const i=t.find(e=>e.operator===r.BT||e.operator===r.NB);return t.length===0||t.length===1&&t[0].selectedValues.length===1&&!i};C.focusout=function e(){this.valueStateMessage?.close()};a.render=function e(t,n){return i.renderUsingRenderManager(t,n,()=>{const e=n.getParent();const t=["sapMToken","sapFeControlsToken"];const i=["sapMTokenText","sapFeControlsTokenPropertyName"];const o=["sapMTokenText","sapFeControlsTokenPropertyValues"];const s=n.getMandatory();if(typeof e?.getEditable==="function"&&e?.getEditable()){t.push("sapFEControlsPointer")}if(n.getSelected()){t.push("sapMTokenSelected")}if(s??false){t.push("sapFeControlsTokenMandatory");if(n.getValue()===n.resourceBundle.getText("M_EASY_FILTER_MANDATORY_TOKEN_SELECT_VALUE")){o.push("sapFeControlsTokenMandatory")}}if(n.getValueState()===_.Error){t.push("sapFeTokenError")}return f("div",{ref:n,class:t.join(" "),"aria-selected":n.getSelected(),tabindex:-1,"aria-posinset":n.getProperty("posinset"),"aria-setsize":n.getProperty("setsize"),children:[f("span",{class:i.join(" "),children:[n.getLabel(),":"]}),g("span",{class:o.join(" "),children:n.getValue()}),s===true?null:n.getAggregation("deleteIcon")]})})};return a}(n),F=N(w.prototype,"label",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),M=N(w.prototype,"titlePopover",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),P=N(w.prototype,"value",[y],{configurable:true,enumerable:true,writable:true,initializer:null}),A=N(w.prototype,"valueStateText",[b],{configurable:true,enumerable:true,writable:true,initializer:null}),O=N(w.prototype,"mandatory",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),E=N(w.prototype,"items",[S],{configurable:true,enumerable:true,writable:true,initializer:null}),x=N(w.prototype,"valueState",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),H=N(w.prototype,"posinset",[D],{configurable:true,enumerable:true,writable:true,initializer:null}),W=N(w.prototype,"setsize",[T],{configurable:true,enumerable:true,writable:true,initializer:null}),w))||B);z=U;return z},false);
//# sourceMappingURL=Token.js.map