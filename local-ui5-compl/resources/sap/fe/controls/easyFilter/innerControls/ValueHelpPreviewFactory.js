/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2024 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/fe/controls/easyFilter/innerControls/BaseFactory","sap/fe/controls/easyFilter/utils","sap/m/List","sap/m/StandardListItem","sap/m/library","sap/ui/core/CustomData"],function(e,t,s,o,r,n,a,i){"use strict";var l=a.ListSeparators;var c=a.ListMode;var u=s.BaseFactory;function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,f(e,t)}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}let g=function(s){function a(e,t){var o;o=s.call(this,e,t)||this;o.setControl(new r({delete:o.onDelete.bind(o),mode:c.Delete,showSeparators:l.None}));return o}p(a,s);var u=a.prototype;u.setItems=function e(t,s,r){if(o.areItemsSame(t,this.items)){return}this.items=t;const n=this.getControl();n?.destroyAggregation("items");t.forEach((e,t)=>{const{operator:a,selectedValues:i}=e;let l="";if(o.isBetweenSelectedValues(a)){l=o.mapOperatorForBetweenOperator(a,i,s,r);this.insertItem(n,l,[t])}else{i.forEach((e,i)=>{l=o.mapOperator(a,e,s,r);this.insertItem(n,l,[t,i])})}})};u.insertItem=function e(t,s,o){t?.addItem(new n({title:s,customData:new i({key:"arrayIndex",value:o})}))};u.onDelete=function e(t){const s=this.getToken()?.getCustomDataValue("popover");t.getParameter("listItem")?.setVisible(false);s.focus()};u.normalizeString=function e(t){const s=/^(>=|<=|!=|>|<)+/;return t.replace(s,"")};u.invokeOkButtonHandler=function e(){const s=this.getToken()?.getCustomDataValue("popover");const o=this.getToken();const r=this.getEasyFilter();const n=o?.getItems()?.map(e=>({operator:JSON.parse(JSON.stringify(e.operator)),selectedValues:t(e.selectedValues)}));const a=[];this.getControl()?.getItems().forEach(e=>{if(!e.getVisible()){const[t=Infinity,s=Infinity]=e?.getCustomData()?.find(e=>e?.getKey()==="arrayIndex")?.getValue()??[];if(t===Infinity||!n){return}a.push([t,s])}});a.sort((e,t)=>t[0]-e[0]||t[1]-e[1]);a.forEach(e=>{let[t,s]=e;if(n){if(s===Infinity){n.splice(t,1);return}n[t].selectedValues.splice(s,1);if(n[t].selectedValues.length===0){n.splice(t,1)}}});r.updateTokenArray("setSelectedValues",n,o?.getKey());s.close()};u.invokeShowAllButtonHandler=async function t(){const s=this.getToken();const o=s?.getKey();const r=new Promise((e,t)=>{this.getEasyFilter()?.fireEvent("showValueHelp",{key:o,selectedValues:s?.getItems(),resolve:e,reject:t})});try{const e=await r;this.getEasyFilter()?.updateTokenArray("setSelectedValues",e,o)}catch(t){if(t instanceof Error){e.error("Error while fetching new tokens",t.message)}else{e.error("Error while fetching new tokens",String(t))}}};u.invokePopupCloseHandler=function e(){this.getControl()?.getItems().forEach(e=>e.setVisible(true))};return a}(u);return g},false);
//# sourceMappingURL=ValueHelpPreviewFactory.js.map