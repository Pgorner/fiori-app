/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/ui/base/BindingParser","../config/FormatterOptions","./Formatter"],function(t,e,r,n){"use strict";const s=r["getFormatterConfiguration"];const i=n["createFormatterExpression"];function a(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";return t.startsWith("{")}function o(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";return t.startsWith("{{")&&t.endsWith("}}")}function c(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";return t.startsWith("{=")&&t.endsWith("}")}function f(t){let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];const r=e.find(function(e){return e.property===t||"{"+e.property+"}"===t});if(r){return i(r)}return t}function l(t,e){const{unitOfMeasures:r,textArrangements:n,propertyValueFormatters:s}=e;const i=t.startsWith("{");t=t.replace(/[{}]/g,"");const a=r.find(function(e){return e.name===t});const o=a?.value?.replace(/[{}]/g,"");const c=n.find(function(e){if(e.value&&e.textArrangement){return e.name===t}});const l=c?.value?.replace(/[{}]/g,"");let u=false;let m=false;let g=false;const h=t;t=t&&f(t,s);if(t!==h){u=true}const d=a&&f(o??"",s);if(o!==d){m=true}const x=l&&f(l,s);if(l!==x){g=true}let y="";if(a&&c){switch(c.textArrangement){case"TextLast":y+=u?"{= "+t+"}":"{"+t+"}";y+=m?" {= "+d+"}":" {"+o+"}";y=p(y,u,m);y+=g?" ("+"{= "+x+"}"+")":" ("+"{"+l+"}"+")";break;case"TextFirst":y=g?"{= "+x+"}"+" (":"{"+l+"}"+" (";y+=u?"{= "+t+"}":"{"+t+"}";y+=m?" {= "+d+"}":" {"+o+"}";const e=y.indexOf(" (");const r=p(y.slice(e+2),u,m);y=y.slice(0,e+2)+r;y+=")";break;case"TextSeparate":y+=u?"{= "+t+"}":"{"+t+"}";y+=m?" {= "+d+"}":" {"+o+"}";y=p(y,u,m);break;case"TextOnly":y+=g?"{= "+x+"}":"{"+l+"}";break;default:break}return y}else if(a&&o){y=u?"{= "+t+"}":"{"+t+"}";if(!d?.startsWith("format.unit(")){y+=m?" {= "+d+"}":" {"+o+"}"}return p(y,u,m)}else if(c){switch(c.textArrangement){case"TextLast":y+=u?"{= "+t+"}":"{"+t+"}";y+=g?" ("+"{= "+x+"}"+")":" ("+"{"+l+"}"+")";break;case"TextFirst":y=g?"{= "+x+"}"+" (":"{"+l+"}"+" (";y+=u?"{= "+t+"}":"{"+t+"}";y+=")";break;case"TextSeparate":y+=u?"{= "+t+"}":"{"+t+"}";break;case"TextOnly":y=g?"{= "+x+"}":"{"+l+"}";break;default:break}return y}return i?u?"{= "+t+"}":"{"+t+"}":t}function p(t,e,r){const n=t.split(" ");let s="",i="";if(n.length===2){s=n[0];i=n[1]}if(e){const e=t.startsWith("{= format.float(");const n=t.startsWith("{= format.unit(");if((e||n)&&!r){const r=t.indexOf("} ");let n=t.slice(0,r+1);const s=t.slice(r+2);n=n.replace("format.float(","format.unit(");const i=n.split(", ");if(i.length===2){if(e){t=n.replace(", {",", $"+s+", {")}else{t=i[0].concat(", $"+s+")}")}}else if(i.length===3){if(s){t=i[0].concat(", $"+s+", ");t=t.concat(i[2])}else{t=n}}return t}return t}return"{= format.unit($"+s+", $"+i+")}"}function u(t){return m(t).replace(/[{}]/g,"")}function m(t){const e=t.includes("} {");return e?t.substring(0,t.indexOf("} {")+1):t}function g(t){const e=["{=","{","(","${"];const r=["}",")"];const n=[];let s=0,i="",a=false;for(let o=0;o<t.length;o++){if(a){a=false;continue}if(e.includes(t[o])){if(t[o]==="{"&&t[o+1]==="="){i+="{=";a=true}else{i+=t[o]}s++}else if(r.includes(t[o])){i+=t[o];s--}else{i+=t[o]}if(s===0){if(i.trim().length!==0){n.push(i)}i=""}}return n}function h(t,e){const r=x(e);const n=g(t);let s=-1;const i=[];const a=[];n.forEach((t,e)=>{const r=t.trim().startsWith("(")&&t.trim().endsWith(")");if(r){s=e;const r=c(t.slice(1,-1));if(r){a.push(t.slice(1,-1))}t=r?y(t.slice(1,-1)).propertyPath:t.slice(1,-1);t="({"+t+"})"}else if(c(t)){a.push(t);t="{"+y(t).propertyPath+"}"}i.push(t)});if(s>-1){let t=i.slice(0,s).concat(i.slice(s+1)).join(" ");const e=i.slice(s,s+1)[0];const n=e.trim().replace(/[({})]/g,"");const o=r.find(t=>n===t.name);if(o&&o.arrangementType==="TextFirst"){t=t.replace(o.value,o.name)}return{propertyPath:t,formatterExpression:a}}else{const e=u(t);const n=r.find(t=>e===t.value);if(n&&n.arrangementType==="TextOnly"){return{propertyPath:`{${n.name}}`,formatterExpression:a}}}return{propertyPath:t,formatterExpression:a}}function d(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";let e=arguments.length>1?arguments[1]:undefined;let{propertyPath:r}=h(t,e);const n=a(t)||c(t);if(a(r)&&!c(r)){r=u(r)}if(a(r)&&c(r)){const t=m(r);const e=b(t);r=e.property||""}return n?`{${r}}`:r}function x(t){const e=t["sap.card"].configuration?.parameters?._propertyFormatting;if(!e){return[]}const r=[];Object.keys(e).forEach(t=>{const n=e[t].arrangements.text;const s=Object.keys(n).find(t=>n[t])||"TextLast";let i=n.path;let a=false;let o=false;let c="";let f="";let l="";if(t.includes("/")){c=t.split("/")[0];f=t.split("/")[1];a=true}if(i?.includes("/")){i=n.path.split("/")[0];l=n.path.split("/")[1];o=true}r.push({name:t,arrangementType:s,value:n.path,propertyKeyForDescription:i,propertyKeyForId:t.includes("/")?c:t,textArrangement:s,isNavigationForId:a,isNavigationForDescription:o,navigationKeyForId:f,navigationKeyForDescription:l,navigationalPropertiesForDescription:[],navigationalPropertiesForId:[]})});return r}function y(){let r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";const n=s();const i=r.split("{=")[1]?.split("(")[0]?.trim();if(!i){return{formatterName:"",propertyPath:"",parameters:[]}}const a=n.find(t=>t.formatterName===i);const o=e.complexParser(r);const c=o.parts[0].path;const f="${"+c+"}";const l=[];let p=r;p=r.trim().replace("{=","");p=p.substring(0,p.lastIndexOf("}"));p=p.replace(`${i}(`,"");p=p.substring(0,p.lastIndexOf(")"));let u=p.replace(`${f}`,"").trim();const m=u.length>0;if(m){const e=a?.parameters||[];for(const r of e){if(r.type==="object"){const e=u.indexOf("{");const r=u.indexOf("}");const n=u.substring(e,r+1);u=u.substring(r+1);try{l.push(JSON.parse(n))}catch{t.error("Error in parsing the formatter options")}}if(r.type==="string"){const t=u.indexOf(",");u=u.substring(t+1);let e=u.indexOf(",");let r;if(e!==-1){r=u.substring(0,e).trim()}else{e=u.indexOf("}");r=u.substring(0,e+1).trim()}u=u.substring(e+1);l.push(r.replace(/['"]+/g,""))}}}return{formatterName:i,propertyPath:c,parameters:l}}function b(t){const e=s();const r=y(t);const n={...e.find(t=>t.formatterName===r.formatterName)};n.property=r.propertyPath;if(!n.parameters?.length){return n}const i=n.parameters.length;for(let t=0;t<i;t++){const e=r.parameters;if(n.parameters[t].type==="object"&&typeof e[t]==="object"){F(n,e,t)}if(n.parameters[t].type==="string"&&typeof e[t]==="string"){n.parameters[t].value=e[t]}}return n}function F(t,e,r){const n=t.parameters[r].properties;n?.forEach(t=>{if(t.type==="boolean"){t["selected"]=e[r][t.name]}else if(t.type==="enum"){t["selectedKey"]=e[r][t.name]}else{t["value"]=typeof e==="object"?e[r][t.name]:e[r]}})}var O={__esModule:true};O.isExpression=a;O.isI18nExpression=o;O.hasFormatter=c;O.getArrangements=l;O.extractPathWithoutUOM=u;O.extractPathExpressionWithoutUOM=m;O.getExpressionParts=g;O.extractPropertyConfigurationWithoutTextArrangement=h;O.resolvePropertyPathFromExpression=d;O.getTextArrangementFromCardManifest=x;O.parseFormatterExpression=y;O.updateAndGetSelectedFormatters=b;return O});
//# sourceMappingURL=PropertyExpression.js.map