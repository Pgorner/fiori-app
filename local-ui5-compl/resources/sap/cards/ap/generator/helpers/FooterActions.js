/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/m/library","sap/ui/core/Lib","../helpers/ApplicationInfo","../helpers/I18nHelper"],function(e,t,n,r,o){"use strict";const a=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function i(e,t,n){if(!e.s){if(n instanceof s){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=i.bind(null,e,t);return}}if(n&&n.then){n.then(i.bind(null,e,t),i.bind(null,e,2));return}e.s=t;e.v=n;const r=e.o;if(r){r(e)}}}const s=function(){function e(){}e.prototype.then=function(t,n){const r=new e;const o=this.s;if(o){const e=o&1?t:n;if(e){try{i(r,1,e(this.v))}catch(e){i(r,2,e)}return r}else{return this}}this.o=function(e){try{const o=e.v;if(e.s&1){i(r,1,t?t(o):o)}else if(n){i(r,1,n(o))}else{i(r,2,o)}}catch(e){i(r,2,e)}};return r};return e}();function c(e){return e instanceof s&&e.s&1}function l(e,t,n){var r=-1,o,a;function l(u){try{while(++r<e.length&&(!n||!n())){u=t(r);if(u&&u.then){if(c(u)){u=u.v}else{u.then(l,a||(a=i.bind(null,o=new s,2)));return}}}if(o){i(o,1,u)}else{o=u}}catch(e){i(o||(o=new s),2,e)}}l();return o}const u=function(e,t,n){try{const r=n.dialog.getModel().getProperty("/configuration/actions/bODataV4");const o=n.appModel.getMetaModel();return Promise.resolve(j(t,r,o,n)).then(function(n){A(e,n,t)})}catch(e){return Promise.reject(e)}};function f(e,t,n){if(typeof e[a]==="function"){var r=e[a](),o,u,f;function v(e){try{while(!(o=r.next()).done&&(!n||!n())){e=t(o.value);if(e&&e.then){if(c(e)){e=e.v}else{e.then(v,f||(f=i.bind(null,u=new s,2)));return}}}if(u){i(u,1,e)}else{u=e}}catch(e){i(u||(u=new s),2,e)}}v();if(r.return){var m=function(e){try{if(!o.done){r.return()}}catch(e){}return e};if(u&&u.then){return u.then(m,function(e){throw m(e)})}m()}return u}if(!("length"in e)){throw new TypeError("Object is not iterable")}var p=[];for(var d=0;d<e.length;d++){p.push(e[d])}return l(p,function(e){return t(p[e])},n)}const m=t["ButtonType"];const p=r["ApplicationInfo"];const d=r["ODataModelVersion"];const v=o["resolveI18nTextFromResourceModel"];function P(e,t,n,r){let o={isConfirmationRequired:false,enablePath:""};if(t){o=H(e,n,r)}else{o=G(e,n)}return{label:t?e.Label:e.Label.String,action:t?e.Action:e.Action.String.split("/")[1],isConfirmationRequired:o.isConfirmationRequired||false,enablePath:o.enablePath}}function h(e){if(e==="Positive"){return m.Accept}if(e==="Negative"){return m.Reject}return m.Default}function y(e,t,n){if(!e["sap.card"].configuration){e["sap.card"].configuration={parameters:{footerActionParameters:{},_adaptiveFooterActionParameters:{}}}}else if(e["sap.card"].configuration&&!e["sap.card"].configuration.parameters){e["sap.card"].configuration.parameters={footerActionParameters:{},_adaptiveFooterActionParameters:{}}}const r=e["sap.card"].configuration;const o=r.parameters;if(o&&!o._adaptiveFooterActionParameters){o._adaptiveFooterActionParameters={}}if(o&&!o.footerActionParameters){o.footerActionParameters={}}if(o?._adaptiveFooterActionParameters&&o?.footerActionParameters){o.footerActionParameters[n.titleKey]=t.parameters||{};o._adaptiveFooterActionParameters[n.titleKey]=t||{}}}function g(e,t){const n=e["sap.card"].configuration;const r=n?.parameters;if(r?._adaptiveFooterActionParameters&&r?.footerActionParameters){delete r.footerActionParameters[t.titleKey];delete r._adaptiveFooterActionParameters[t.titleKey]}}function b(e,t,n,r){const o=e["sap.card"].configuration;const a=o?.parameters;if(a?._adaptiveFooterActionParameters&&a?.footerActionParameters){const e=a._adaptiveFooterActionParameters[t.titleKey];e.style=n;e.enablePath=r}}function A(e,t,n){let r=e["sap.card"].footer;if(!r){e["sap.card"].footer={actionsStrip:[]};r=e["sap.card"].footer}const o=r.actionsStrip.length;if(o<2){r.actionsStrip.push({type:"Button",visible:false,text:t.label,buttonType:h(t.style),actions:[{type:"custom",enabled:t.enablePath?"${"+t.enablePath+"}":"true",parameters:"{{parameters.footerActionParameters."+n.titleKey+"}}"}]});y(e,t,n)}}function $(){const e=[{name:"Default",label:"Default",labelWithValue:"Default"},{name:"Positive",label:"Positive",labelWithValue:"Positive"},{name:"Negative",label:"Negative",labelWithValue:"Negative"}];return e}function T(e,t,n,r){const o=[];const a="com.sap.vocabularies.UI.v1.DataFieldForAction";e?.filter(function(e){const n=t?e?.$Type:e?.RecordType;return n===a}).map(function(e){const a=P(e,t,n,r);o.push(a)});return o}const O=function(e,t,n){try{return Promise.resolve(f(e,function(e){if(n){e.label=v(e.label,n);e.errorMessage=v(e?.errorMessage||"",n);e.placeholder=v(e?.placeholder||"",n)}const r=e.configuration;const o=r?.entitySet;const a=function(){if(o){return Promise.resolve(U(t,r?.serviceUrl,o)).then(function(){})}}();if(a&&a.then)return a.then(function(){})}))}catch(e){return Promise.reject(e)}};const C=function(e,t,n){try{let r=false;function o(e){return r?e:[{title:"",titleKey:"",style:"Default",enablePathKey:"",isStyleControlEnabled:false}]}const a=e["sap.card"].configuration;const i=a?.parameters;const s=[];const c=function(){if(i?._adaptiveFooterActionParameters){function e(){r=true;return s}const o=i._adaptiveFooterActionParameters;const a=Object.keys(o);const c=f(a,function(e){function r(){let t="Default";if(a.style==="positive"){t="Positive"}else if(a.style==="destructive"){t="Negative"}const n={title:a.label,titleKey:e,style:t,enablePathKey:a.enablePath,isStyleControlEnabled:true,isConfirmationRequired:a.data?.isConfirmationRequired||false,triggerActionText:a.triggerActionText};s.push(n)}const a=o[e];if(n){a.label=v(a.label,n);a.triggerActionText=v(a.triggerActionText,n)}const i=function(){if(a.actionParameters?.length){return Promise.resolve(O(a.actionParameters,t,n)).then(function(){})}}();return i&&i.then?i.then(r):r(i)});return c&&c.then?c.then(e):e(c)}}();return Promise.resolve(c&&c.then?c.then(o):o(c))}catch(l){return Promise.reject(l)}};const S=function(e,t,n){try{let r=false;function o(e){return r?e:[{title:"",titleKey:"",style:"Default",enablePathKey:"",isStyleControlEnabled:false}]}const a=function(){if(n&&t){return Promise.resolve(C(n,t,e)).then(function(e){r=true;return e})}}();return Promise.resolve(a&&a.then?a.then(o):o(a))}catch(i){return Promise.reject(i)}};function E(e,t,n){const r=n?e.getModel():e.getModel(),o=r.getMetaModel(),a=n?o.getObject("/"+t):o.getODataEntitySet(t),i=n?a?.$Type:a?.entityType,s=n?o.getObject("/"+i):o.getODataEntityType(i),c=n?"@com.sap.vocabularies.UI.v1.Identification":"com.sap.vocabularies.UI.v1.Identification";let l={};if(n){l=o.getObject("/"+i+"@")}const u=n?Object.keys(l):Object.keys(s);const f=u?.filter(e=>e===c);let m=[];if(f?.length){m=n?l[c]:s[c]}return T(m,n,o,t)}function R(e,t){const n=e["sap.card"]?.footer;const r=n?.actionsStrip.length;if(r&&n){const r=n.actionsStrip.filter(e=>{const n=e.actions[0].parameters;return n!=="{{parameters.footerActionParameters."+t.titleKey+"}}"});if(r.length){n.actionsStrip=r}else{delete e["sap.card"]?.footer}g(e,t)}}function M(e){e["sap.card"].footer={actionsStrip:[]};const t=e["sap.card"].configuration;const n=t?.parameters;if(n){n._adaptiveFooterActionParameters={};n.footerActionParameters={}}}function _(e,t){const n=e["sap.card"].footer;const r=n?.actionsStrip.length;if(r&&n){n.actionsStrip.forEach(n=>{const r=n.actions[0];const o=r.parameters;if(o==="{{parameters.footerActionParameters."+t.titleKey+"}}"){const o=t.enablePathKey?"${"+t.enablePathKey+"}":"true";const a=D(t);n.buttonType=h(t.style);r.enabled=o;b(e,t,a,t.enablePathKey||"")}})}}function D(e){let t="default";if(e.style==="Positive"){t="positive"}else if(e.style==="Negative"){t="destructive"}return t}const I=function(e,t){try{const r=[];const o=n.getResourceBundleFor("sap.cards.ap.generator.i18n");const a=f(e,function(e){function n(){r.push(s)}const a=e?.["com.sap.vocabularies.Common.v1.FieldControl"]?.EnumMember;const i=a==="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory"||e?.nullable==="false";const s={label:e?.["sap:label"]||e?.name||"",id:e?.name||"",isRequired:i,errorMessage:i?o.getText("GENERATOR_ADAPTIVE_CARD_ACTION_PARAMETERS_ERROR_MESSAGE"):"",placeholder:""};const c=function(){if(e?.["sap:value-list"]==="fixed-values"){return Promise.resolve(Z(e,t)).then(function(e){if(e?.entitySet){s.configuration=e;s.placeholder=o.getText("GENERATOR_ADAPTIVE_CARD_ACTION_PARAMETERS_PLACEHOLDER")}})}}();return c&&c.then?c.then(n):n(c)});return Promise.resolve(a&&a.then?a.then(function(){return r}):r)}catch(e){return Promise.reject(e)}};const j=function(e,t,r,o){try{const a=n.getResourceBundleFor("sap.cards.ap.generator.i18n");const i=D(e);let s=[];let c;const l={isConfirmationRequired:e.isConfirmationRequired||false};const u=e.enablePathKey;const f={style:i,verb:"",label:e.title,actionParameters:[],data:l,enablePath:u||"",triggerActionText:a.getText("GENERATOR_ADAPTIVE_CARD_SUBMIT_ACTION_OK_BUTTON")};if(t){return Promise.resolve(W(e,r,o)).then(function(t){s=t;f.verb=z(e,r);f.actionParameters=s||[];return f})}else{c=J(e,r,o);f.verb=e.titleKey;f.parameters=c?.mActionParams?.parameterData;return Promise.resolve(I(c?.mActionParams?.additionalParameters,o)).then(function(e){f.actionParameters=e;l.actionParams={keys:Object.keys(c?.mActionParams?.parameterData)};f.data=l;return f})}}catch(e){return Promise.reject(e)}};function x(e,t){return e?.filter(e=>{const n=e?.$IsBound;if(n){return e?.$Parameter?.some(e=>t===e?.$Type)}})}function L(e){return e?.filter(e=>!e?.$IsBound)}const F=function(e,t,n){try{return Promise.resolve(e.requestValueListInfo(t,true)).then(function(e){const t=e?.[""];const r=t?.$model;const o=N(t,n||"");const a=t?.["CollectionPath"];const i=r?.getMetaModel()?.getObject(`/${a}/${o}@`);return{valueHelpAnnotation:i,valueListPropertyName:o,valueHelpEntitySet:a,valueListModelServiceUrl:r?.getServiceUrl()}})}catch(e){return Promise.reject(e)}};const K=function(e,t,n){try{let r=false;return Promise.resolve(function(){if(n){function o(e){return r?e:l?.["@com.sap.vocabularies.Common.v1.Label"]||n}const a=e.entitySet;const i=e.appModel.getMetaModel();const s=`/${a}/${t}/${n}`;const c=i.getObject("/"+e?.entitySet);const l=i.getObject("/"+c?.$Type+"/"+n+"@");const u=function(){if(i.getObject(`${s}@`)?.["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]){return Promise.resolve(F(i,s,n)).then(function(e){let{valueHelpAnnotation:t}=e;const n=l?.["@com.sap.vocabularies.Common.v1.Label"]||t?.["@com.sap.vocabularies.Common.v1.Label"];r=true;return n})}}();return u&&u.then?u.then(o):o(u)}}())}catch(e){return Promise.reject(e)}};function N(e,t){const n=e?.Parameters.find(function(e){return e?.LocalDataProperty?.$PropertyPath===t});return n?.ValueListProperty}function V(e,t,n){if(n==="TextOnly"){return"${"+t+"}"}else if(n==="TextLast"){return"${"+e+"}"+" ("+"${"+t+"}"+")"}else if(n==="TextSeparate"){return"${"+e+"}"}return"${"+t+"}"+" (${"+e+"})"}const U=function(e,t,n){try{return Promise.resolve(fetch(t)).then(function(t){const{odataModel:r}=p.getInstance().fetchDetails();const o=r===d.V4;const a=function(){if(t&&typeof t.json==="function"){return Promise.resolve(t.json()).then(function(t){const r=o?t?.value:t?.d?.results;if(r?.length){e[n]=r}})}}();if(a&&a.then)return a.then(function(){})})}catch(e){return Promise.reject(e)}};const w=function(e,t,n){try{const r={serviceUrl:"",value:"",entitySet:"",title:""};if(!n){return Promise.resolve(r)}const o=e.entitySet;const a=e.dialog.getModel();const i=e.appModel.getMetaModel();const s=`/${o}/${t}/${n}`;const c=i.getObject(`${s}@`);if(!c?.["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]){return Promise.resolve(r)}return Promise.resolve(F(i,s,n)).then(function(e){let{valueHelpAnnotation:t,valueListPropertyName:n,valueHelpEntitySet:r,valueListModelServiceUrl:o}=e;const i=t?.["@com.sap.vocabularies.Common.v1.Text"]?.$Path;const s=t?.["@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement"];const c=s?.$EnumMember&&n&&i||n&&i?V(n,i,s?.$EnumMember?.split("/")[1]):"${"+n+"}";let l=o;l=n&&i?`${l}${r}?$select=${n},${i}`:`${l}${r}?$select=${n}`;l=`${l}&skip=0&$top=20`;const u=a.getProperty("/configuration/$data");return Promise.resolve(U(u,l,r)).then(function(){a.setProperty("/configuration/$data",u);return{entitySet:r,serviceUrl:l,value:c,title:"${"+n+"}"}})})}catch(e){return Promise.reject(e)}};const B=function(e,t,r,o){try{let a=false;const i=[];let s=0;return Promise.resolve(function(){if(e&&e.$Parameter){const c=n.getResourceBundleFor("sap.cards.ap.generator.i18n");return f(e.$Parameter,function(n){function l(){s++;if(s===e.$Parameter.length){a=true;return i}}const u=!o||o&&s>0;const f=function(){if(u){const e=n.$Nullable===false;const o=n.$Name;return Promise.resolve(K(t,r,n.$Name)).then(function(a){const s={isRequired:e,id:o,label:a,errorMessage:e?c.getText("GENERATOR_ADAPTIVE_CARD_ACTION_PARAMETERS_ERROR_MESSAGE"):"",placeholder:""};return Promise.resolve(w(t,r,n.$Name)).then(function(e){const t=e;if(t?.entitySet){s["configuration"]=t;s.placeholder=c.getText("GENERATOR_ADAPTIVE_CARD_ACTION_PARAMETERS_PLACEHOLDER")}i.push(s)})})}}();return f&&f.then?f.then(l):l(f)},function(){return a})}}())}catch(e){return Promise.reject(e)}};function q(e){if(e){const t=e["@Org.OData.Core.V1.OperationAvailable"];if(t?.$Path){return t.$Path}else if(t?.Bool){return t.Bool}}return""}function k(e){if(!e){return false}if(e.Bool===undefined){return true}const t=e.Bool;if(typeof t==="string"){const e=t.toLowerCase();return!(e=="false"||e==""||e==" ")}return!!t}function H(e,t,n){const r=e.Action;const o=r.indexOf("(")>-1?r.split("(")[0]:r;const a=t.getObject("/"+n+"/"+o+"@");const i=q(a);const s=k(a?.["@com.sap.vocabularies.UI.v1.Critical"]);return{enablePath:i,isConfirmationRequired:s}}function G(e,t){const n=e.Action.String.split("/")[1];const r=t.getODataFunctionImport(n);return{enablePath:r?.["sap:applicable-path"]||"",isConfirmationRequired:k(r?.["com.sap.vocabularies.Common.v1.IsActionCritical"])}}const W=function(e,t,n){try{const r=e.titleKey||"";const o=r.indexOf("(")>-1?r.split("(")[0]:r;const a=t.getObject(`/${n.entitySet}/${o}`);let i=r.indexOf("(")>-1?r?.split("(")[1]:"";i=i.indexOf(")")>-1?i.replace(")",""):i;if(a?.$kind==="ActionImport"&&a?.$Action){const e=t.getObject("/"+a?.$Action);const r=L(e);return B(r[0],n,o)}const s=x(a,i);return Promise.resolve(function(){if(s?.length&&s[0]?.$Parameter!=null&&s[0]?.$Parameter.length>1){return Promise.resolve(B(s[0],n,o,true))}}())}catch(e){return Promise.reject(e)}};function z(e,t){const n=e.titleKey||"";const r=n.indexOf("(")>-1?n.split("(")[0]:n;const o=t.getObject("/"+r)||[];let a=n.indexOf("(")>-1?n.split("(")[1]:"";a=a.indexOf(")")>-1?a.replace(")",""):a;if(o?.$kind==="ActionImport"&&o?.$Action){return n?.split("/")[1]}const i=x(o,a);if(i?.length){return r}return r}function J(t,n,r){const o=t.titleKey;const a=n.getODataFunctionImport(o);const i=r.dialog.getModel().getProperty("/configuration/$data");const s=n.getODataEntitySet(r?.entitySet);const c=n.getODataEntityType(s?.entityType);const l=Q(c);const u={};const f={parameterData:{},additionalParameters:[]};a?.parameter?.forEach(function(t){X(t,c,n);const r=t?.name||"";const o=!!l[r];let s;if(i?.hasOwnProperty(r)){s=i[r]}else if(o&&i&&a["sap:action-for"]){e.error("Key parameter of action not found in current context: "+r);throw new Error("Key parameter of action not found in current context: "+r)}f.parameterData[r]=s;const m=!!u[r];if(!m&&(!o||!a["sap:action-for"])&&t.mode.toUpperCase()=="IN"){f.additionalParameters.push(t)}});return{mActionParams:f,functionImport:a}}const Q=function(e){const t={};e.key.propertyRef.forEach(e=>{if(e.name){t[e.name]=true}});return t};const X=function(e,t,n){if(t&&e&&!e["com.sap.vocabularies.Common.v1.Label"]){const r=n.getODataProperty(t,e.name,false);if(r&&r["com.sap.vocabularies.Common.v1.Label"]){e["com.sap.vocabularies.Common.v1.Label"]=r["com.sap.vocabularies.Common.v1.Label"]}}};function Y(e,t){const n=[];let r="",o="";t.forEach(e=>{const t=e?.ValueListProperty?.String;if(t){n.push(t);o=e?.RecordType==="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly"?t:o;r=e?.RecordType==="com.sap.vocabularies.Common.v1.ValueListParameterInOut"?t:r}});const a=`${e}?$select=${n.join(",")}`;return{serviceUrl:a,valueListPropertyPath:r,descriptionPath:o}}const Z=function(e,t){try{const n={serviceUrl:"",value:"",entitySet:"",title:""};if(!e){return Promise.resolve(n)}const r=e?.["com.sap.vocabularies.Common.v1.ValueList"];const o=r?.Parameters;const a=r?.CollectionPath?.String;const{serviceUrl:i,valueListPropertyPath:s,descriptionPath:c}=Y(`${t.appModel.sServiceUrl}/${a}`,o);let l="TextOnly";if(e?.["com.sap.vocabularies.UI.v1.TextArrangement"]){l=e["com.sap.vocabularies.UI.v1.TextArrangement"]?.EnumMember?.split("/")[1]}const u=s&&c?V(s,c,l):"${"+s+"}";const f=t.dialog.getModel();const m=f.getProperty("/configuration/$data");return Promise.resolve(U(m,i,a)).then(function(){f.setProperty("/configuration/$data",m);return{entitySet:a,serviceUrl:i,value:u,title:"${"+s+"}"}})}catch(e){return Promise.reject(e)}};var ee={__esModule:true};ee.getActionStyles=$;ee.getDefaultAction=S;ee.getCardActions=E;ee.addActionToCardManifest=u;ee.removeActionFromManifest=R;ee.resetCardActions=M;ee.updateCardManifestAction=_;ee.getActionParameterValue=V;ee.updateModelData=U;ee.getActionParameterConfigurationV2=Z;return ee});
//# sourceMappingURL=FooterActions.js.map