/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/cards/ap/common/services/RetrieveCard","sap/ui/core/Lib","sap/ui/model/json/JSONModel","../odata/ODataUtils","./ApplicationInfo","./FooterActions","./Formatter","./IntegrationCardHelper","./NavigationProperty","./PropertyExpression"],function(t,e,n,o,r,i,a,s,c,l){"use strict";const u=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function f(t,e,n){if(!t.s){if(n instanceof p){if(n.s){if(e&1){e=n.s}n=n.v}else{n.o=f.bind(null,t,e);return}}if(n&&n.then){n.then(f.bind(null,t,e),f.bind(null,t,2));return}t.s=e;t.v=n;const o=t.o;if(o){o(t)}}}const p=function(){function t(){}t.prototype.then=function(e,n){const o=new t;const r=this.s;if(r){const t=r&1?e:n;if(t){try{f(o,1,t(this.v))}catch(t){f(o,2,t)}return o}else{return this}}this.o=function(t){try{const r=t.v;if(t.s&1){f(o,1,e?e(r):r)}else if(n){f(o,1,n(r))}else{f(o,2,r)}}catch(t){f(o,2,t)}};return o};return t}();function d(t){return t instanceof p&&t.s&1}function m(t,e,n){var o=-1,r,i;function a(s){try{while(++o<t.length&&(!n||!n())){s=e(o);if(s&&s.then){if(d(s)){s=s.v}else{s.then(a,i||(i=f.bind(null,r=new p,2)));return}}}if(r){f(r,1,s)}else{r=s}}catch(t){f(r||(r=new p),2,t)}}a();return r}const g=function(t,e,n,o){try{function r(t){return{annotationActions:c,addedActions:t,bODataV4:s,styles:M(),isAddActionEnabled:true,actionExists:c.length>0}}const{odataModel:i,entitySet:a}=O.getInstance().fetchDetails();const s=i===D.V4;const c=N(t,a,s);const l=c.length>0;return Promise.resolve(l?Promise.resolve(C(n,e,o)).then(r):r([]))}catch(u){return Promise.reject(u)}};function y(t,e,n){if(typeof t[u]==="function"){var o=t[u](),r,i,a;function g(t){try{while(!(r=o.next()).done&&(!n||!n())){t=e(r.value);if(t&&t.then){if(d(t)){t=t.v}else{t.then(g,a||(a=f.bind(null,i=new p,2)));return}}}if(i){f(i,1,t)}else{i=t}}catch(t){f(i||(i=new p),2,t)}}g();if(o.return){var s=function(t){try{if(!r.done){o.return()}}catch(t){}return t};if(i&&i.then){return i.then(s,function(t){throw s(t)})}s()}return i}if(!("length"in t)){throw new TypeError("Object is not iterable")}var c=[];for(var l=0;l<t.length;l++){c.push(t[l])}return m(c,function(t){return e(c[t])},n)}const h=t["getKeyParameters"];const v=o["createPathWithEntityContext"];const P=o["fetchDataAsync"];const b=o["getLabelForEntitySet"];const F=o["getNavigationPropertyInfoFromEntity"];const I=o["getPropertyInfoFromEntity"];const O=r["ApplicationInfo"];const D=r["ODataModelVersion"];const M=i["getActionStyles"];const N=i["getCardActions"];const C=i["getDefaultAction"];const E=a["formatPropertyDropdownValues"];const S=a["getDefaultPropertyFormatterConfig"];const A=a["getDefaultPropertyFormatterConfigForNavProperties"];const V=s["parseCard"];const K=c["getNavigationPropertiesWithLabel"];const U=l["resolvePropertyPathFromExpression"];const w=[{Name:"K",Value:"K"},{Name:"%",Value:"%"}];function W(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];let e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];const n=[...e];for(const e of t){if(!n.find(t=>t.property===e.property)){n.push({...e})}}return n}function x(t,e){e.forEach(e=>{const n=t.find(t=>t.name===e.property);let o=e.parameters?.[0].value?.replace(/\$\{/g,"");o=o?.replace(/\}/g,"");const r=e.property;if(n&&o){n.propertyKeyForDescription=o;n.value=o}else if(o&&r){t.push({propertyKeyForDescription:o,name:r,propertyKeyForId:r,value:o})}});return t}const L=function(t,o){try{const r=O.getInstance().fetchDetails();const i=e.getResourceBundleFor("sap.cards.ap.generator.i18n");const a=t.getManifest();const s=t.getModel();const c=a["sap.app"].title;const l=a["sap.app"].description;const{entitySetWithObjectContext:u,serviceUrl:f,semanticObject:p,action:d}=r;const m=r.entitySet;const M=r.odataModel===D.V4;const N=b(M?s:s,m);const C=I(M?s:s,m,false);const E=I(M?s:s,m,true,i);const L=F(M?s:s,m);const R=C.map(t=>t.name);let _={};if(R.length){_={$select:R.join(",")}}return Promise.resolve(v(u,s,M)).then(function(e){return Promise.resolve(P(f,e,M,_)).then(function(r){function a(){m=W(m,P?.formatterConfigurationFromCardManifest);$(E,r,u,s);const a=P?.mainIndicatorOptions;const y=a?.criticalityOptions||[];const v=y.length?y[0].criticality:"";const b=P?.mainIndicatorOptions.mainIndicatorStatusKey||"";const F=P?.mainIndicatorOptions.trendOptions;const I=P?.sideIndicatorOptions;const O=P?.mainIndicatorOptions.mainIndicatorNavigationSelectedKey||"";const D=P?.mainIndicatorOptions.navigationValue||"";const S=[];return Promise.resolve(K(t,b,e)).then(function(e){let{propertiesWithLabel:r,navigationPropertyData:A}=e;const V={name:b,value:r};j(L,b,V.value);if(b.length>0&&(u[b]===null||u[b]===undefined)){u[b]=A[b]}if(V.name){S.push(V)}const K=V.value.find(t=>t.name===O)?.labelWithValue||"";const U=P?.formatterConfigurationFromCardManifest.filter(t=>t.formatterName==="format.unit")||[];const W={unitOfMeasures:U.length>0?x(s,U):s,textArrangements:P?.textArrangementsFromCardManifest||[],propertyValueFormatters:m,sourceCriticalityProperty:[],targetFormatterProperty:"",sourceUoMProperty:a?.mainIndicatorStatusKey||"",selectedKeyCriticality:v,textArrangementSourceProperty:b,isPropertyFormattingEnabled:!!(b&&O==="")};const $=b&&E.find(t=>t.name===b)?.labelWithValue||"";const R=`${N}`,_=P?.groups||[{title:i?.getText("GENERATOR_DEFAULT_GROUP_NAME",[1]),items:[{label:"",value:"",isEnabled:false,name:"",navigationProperty:"",isNavigationEnabled:false}]}],T=F,G=P?.headerUOM||"",H=P?.subtitle||l,k=P?.title||c;return Promise.resolve(g(t,u,t.getModel("i18n"),o)).then(function(e){return Promise.resolve(h(t)).then(function(t){const o={title:R,configuration:{title:k,subtitle:H,headerUOM:G,mainIndicatorOptions:{criticality:y},advancedFormattingOptions:W,trendOptions:T,indicatorsValue:I,selectedTrendOptions:F?[F]:[],selectedIndicatorOptions:I?[I]:[],selectedNavigationPropertyHeader:V,selectedContentNavigation:[],selectedHeaderNavigation:[],navigationProperty:L,mainIndicatorNavigationSelectedValue:K,mainIndicatorStatusKey:b,navigationValue:D,mainIndicatorNavigationSelectedKey:O,mainIndicatorStatusUnit:$,selectedNavigationalProperties:S,entitySet:N,oDataV4:M,serviceUrl:f,properties:C,propertiesWithNavigation:E,groups:_,$data:u,targetUnit:w,deviationUnit:w,errorControls:[],actions:e,groupLimitReached:false,keyParameters:t,appIntent:`${p}-${d}`}};const r=new n(o);return r})})})}const s=[];const u={};$(C,r,u,s);let m=S(i,C);const v=A(i,L);m=W(m,v);let P;const b=function(){if(o){function n(){return y(P.groups,function(n){return y(n.items,function(n){const r=U(n.value,o);const i=function(){if(r?.includes("/")){const[o,i]=r.replace(/[{}]/g,"").split("/");return Promise.resolve(K(t,o,e)).then(function(t){let{propertiesWithLabel:e,navigationPropertyData:r}=t;n.navigationalProperties=e;n.isNavigationEnabled=true;n.isEnabled=false;n.navigationProperty=i;j(L,o,n.navigationalProperties);if(u[o]===null||u[o]===undefined){u[o]=r[o]}})}}();if(i&&i.then)return i.then(function(){})})})}P=V(o,t.getModel("i18n"),C);const r=y(P.textArrangementsFromCardManifest,function(n){function o(){const o=function(){if(n.isNavigationForId){const o=n.propertyKeyForId;return Promise.resolve(K(t,o,e)).then(function(t){let{propertiesWithLabel:e,navigationPropertyData:r}=t;n.navigationalPropertiesForId=e;j(L,o,n.navigationalPropertiesForId);if(u[o]===null||u[o]===undefined){u[o]=r[o]}})}}();if(o&&o.then)return o.then(function(){})}const r=function(){if(n.isNavigationForDescription){const o=n.propertyKeyForDescription;return Promise.resolve(K(t,o,e)).then(function(t){let{propertiesWithLabel:e,navigationPropertyData:r}=t;n.navigationalPropertiesForDescription=e;j(L,o,n.navigationalPropertiesForDescription);if(u[o]===null||u[o]===undefined){u[o]=r[o]}})}}();return r&&r.then?r.then(o):o(r)});return r&&r.then?r.then(n):n(r)}}();return b&&b.then?b.then(a):a(b)})})}catch(t){return Promise.reject(t)}};function $(t,e,n,o){t.forEach(t=>{if(t.name&&e[t.name]!==undefined&&e[t.name]!==null){const r=E(t,e[t.name]);t.value=e[t.name];t.labelWithValue=r;const i=o.find(e=>e.name===t.name);if(t.UOM&&t.name&&!i){o.push({propertyKeyForDescription:t.UOM,name:t.name,propertyKeyForId:t.name,value:t.UOM})}n[t.name]=e[t.name]}else{t.labelWithValue=t.category?`${t.label}`:`${t.label} (<empty>)`}})}function j(t,e,n){const o=t.find(t=>t.name===e);if(!o){return}o.properties=[...n]}var R={__esModule:true};R._mergePropertyFormatters=W;R.getCardActionInfo=g;R.updateUnitOfMeasures=x;R.getCardGeneratorDialogModel=L;R.addLabelsForProperties=$;return R});
//# sourceMappingURL=CardGeneratorModel-dbg.js.map