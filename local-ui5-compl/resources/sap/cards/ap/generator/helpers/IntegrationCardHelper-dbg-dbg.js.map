{"version":3,"file":"IntegrationCardHelper-dbg-dbg.js","names":["sap","ui","define","sap_cards_ap_generator_odata_v2_MetadataAnalyzer","sap_cards_ap_generator_odata_v4_MetadataAnalyzer","VersionInfo","CoreElement","V2OdataUtils","V4ODataUtils","___odata_ODataUtils","___types_CommonTypes","___utils_CommonUtils","___ApplicationInfo","___Batch","___I18nHelper","___PropertyExpression","enhanceManifestWithInsights","mCardManifest","rootComponent","Promise","resolve","sapAppId","getManifest","id","load","library","then","_VersionInfo$load","sapCoreVersionInfo","templateName","parentAppId","cardType","versions","ui5","version","buildTimestamp","e","reject","getPropertyReference","getPropertyReferenceKey","getDataType","isODataV4Model","ColorIndicator","getColorForGroup","ApplicationInfo","ODataModelVersion","updateManifestWithExpandQueryParams","updateManifestWithSelectQueryParams","resolveI18nTextFromResourceModel","extractPathExpressionWithoutUOM","extractPathWithoutUOM","extractPropertyConfigurationWithoutTextArrangement","getTextArrangementFromCardManifest","hasFormatter","isExpression","isI18nExpression","updateAndGetSelectedFormatters","manifest","formatterConfigurationFromCardManifest","createInitialManifest","props","title","subTitle","description","service","serviceModel","entitySetName","data","bODataV4","dataPath","dataPathHeader","propertyReferenceKeys","entityKeyPropertiesParameters","forEach","keyProp","name","type","value","entityKeyProperties","map","_version","i18n","applicationVersion","technology","icons","icon","extension","configuration","parameters","_contentSelectQuery","length","join","_headerSelectQuery","_contentExpandQuery","_headerExpandQuery","_entitySet","destinations","defaultUrl","csrfTokens","token1","request","url","method","headers","batch","header","getHeaderBatchUrl","Accept","retryAfter","content","getContentBatchUrl","path","unitOfMeasurement","mainIndicator","number","unit","groups","contentDensities","compact","cozy","dependencies","libs","lazy","getObjectPageContext","entitySet","getInstance","fetchDetails","appModel","getModel","contextParameters","keyProperties","property","parameter","formatLiteral","push","formatValue","getCurrentCardManifest","renderCardPreview","newManifest","oModel","oCard","getElementById","setBaseUrl","setManifest","refresh","updateCardGroups","configurationGroups","getProperty","advancedPanelCriticallity","items","filter","configurationItem","matchedCriticallity","columnItem","updatedColorState","criticality","criticalityValue","activeCalculation","item","label","state","hasActions","actions","resolvePropertyLabelFromExpression","resourceModel","properties","propertyPath","find","labelWithValue","formatterExpression","selectedFormatter","handleFormatter","getMainIndicator","mManifest","mainIndicatorKey","trendOptions","referenceValue","downDifference","upDifference","criticalityOptions","updateCriticalityBasedOnGroups","mainIndicatorStatusKey","mainIndicatorNavigationSelectedKey","navigationValue","formatterExpressions","trend","trendValue","regex","match","criticalityConfig","updateCriticalityOptions","includes","split","group","criticallityState","getCriticallityStateForGroup","itemExists","some","option","None","getSideIndicators","sideIndicators","targetValue","targetUnit","deviationValue","deviationUnit","targetIndicator","deviationIndicator","formatter","f","getGroupItemValue","getCardGroups","groupItem","isEnabled","isNavigationEnabled","enhanceManifestWithConfigurationParameters","oDialogModel","sapCard","applicationInfo","getRootComponent","odataModel","V4","configurationParameters","textArrangements","propertyFormatting","arrangement","Object","keys","arrangementType","arrangements","text","addQueryParametersToManifest","cardManifest","cardManifestCopy","JSON","parse","stringify","batchRequest","selectQueryHeader","selectQueryContent","expandQueryHeader","expandQueryContent","headerUrl","contentUrl","indexOf","configParameters","updateConfigurationParametersWithKeyProperties","updateHeaderDataPath","headerData","updateExistingCardManifest","undefined","componentName","parseCard","integrationCardManifest","subtitle","uom","splice","textArrangementsFromCardManifest","headerUOM","mainIndicatorOptions","sideIndicatorOptions","__exports","__esModule"],"sources":["IntegrationCardHelper.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport { getPropertyReference } from \"sap/cards/ap/generator/odata/v2/MetadataAnalyzer\";\nimport { getPropertyReferenceKey } from \"sap/cards/ap/generator/odata/v4/MetadataAnalyzer\";\nimport VersionInfo from \"sap/ui/VersionInfo\";\nimport Component from \"sap/ui/core/Component\";\nimport CoreElement from \"sap/ui/core/Element\";\nimport Card, { CardManifest, Group, GroupItems, ObjectContent, PropertyFormattingParameters } from \"sap/ui/integration/widgets/Card\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport V2OdataUtils from \"sap/ui/model/odata/ODataUtils\";\nimport { default as V2ODataModel } from \"sap/ui/model/odata/v2/ODataModel\";\nimport { default as V4ODataModel } from \"sap/ui/model/odata/v4/ODataModel\";\nimport V4ODataUtils from \"sap/ui/model/odata/v4/ODataUtils\";\nimport ResourceModel from \"sap/ui/model/resource/ResourceModel\";\nimport { ArrangementOptions } from \"../app/controls/ArrangementsEditor\";\nimport { PropertyInfoMap } from \"../odata/ODataTypes\";\nimport { getDataType, isODataV4Model } from \"../odata/ODataUtils\";\nimport { ColorIndicator } from \"../types/CommonTypes\";\nimport { getColorForGroup } from \"../utils/CommonUtils\";\nimport { ApplicationInfo, LibVersionInfo, ODataModelVersion } from \"./ApplicationInfo\";\nimport { updateManifestWithExpandQueryParams, updateManifestWithSelectQueryParams } from \"./Batch\";\nimport type { CriticalityOptions, SideIndicatorOptions, TrendOptions } from \"./CardGeneratorModel\";\nimport type { FormatterConfiguration, FormatterConfigurationMap } from \"./Formatter\";\nimport { resolveI18nTextFromResourceModel } from \"./I18nHelper\";\nimport {\n\textractPathExpressionWithoutUOM,\n\textractPathWithoutUOM,\n\textractPropertyConfigurationWithoutTextArrangement,\n\tgetTextArrangementFromCardManifest,\n\thasFormatter,\n\tisExpression,\n\tisI18nExpression,\n\tupdateAndGetSelectedFormatters\n} from \"./PropertyExpression\";\n\nexport type ParsedManifest = {\n\ttitle: string;\n\tsubtitle: string;\n\theaderUOM: string;\n\tmainIndicatorOptions: {\n\t\tmainIndicatorStatusKey: string;\n\t\tcriticalityOptions: Array<object>;\n\t\tmainIndicatorNavigationSelectedKey: string;\n\t\tnavigationValue: string;\n\t\ttrendOptions: TrendOptions;\n\t};\n\tsideIndicatorOptions: SideIndicatorOptions;\n\tgroups: Array<object>;\n\tformatterConfigurationFromCardManifest: FormatterConfigurationMap;\n\ttextArrangementsFromCardManifest: Array<ArrangementOptions>;\n};\nlet manifest: CardManifest;\nconst formatterConfigurationFromCardManifest: FormatterConfigurationMap = [];\n\nexport function createInitialManifest(props: any) {\n\tconst { title, subTitle, description, service, serviceModel, sapAppId, sapCoreVersionInfo, entitySetName, data } = props;\n\tconst bODataV4 = isODataV4Model(serviceModel);\n\tconst dataPath = bODataV4 ? \"/content/\" : \"/content/d/\";\n\tconst dataPathHeader = bODataV4 ? \"/header/\" : \"/header/d/\";\n\tconst propertyReferenceKeys = bODataV4\n\t\t? getPropertyReferenceKey(serviceModel, entitySetName)\n\t\t: getPropertyReference(serviceModel, entitySetName);\n\tconst entityKeyPropertiesParameters: Record<string, { type: string; value: string }> = {};\n\n\tpropertyReferenceKeys.forEach((keyProp) => {\n\t\tentityKeyPropertiesParameters[keyProp.name] = {\n\t\t\ttype: getDataType(keyProp.type),\n\t\t\tvalue: data[keyProp.name]\n\t\t};\n\t});\n\n\tconst entityKeyProperties = propertyReferenceKeys.map((keyProp) => keyProp.name);\n\n\tmanifest = {\n\t\t_version: \"1.15.0\",\n\t\t\"sap.app\": {\n\t\t\tid: sapAppId,\n\t\t\ttype: \"card\",\n\t\t\ti18n: \"../../../i18n/i18n.properties\",\n\t\t\ttitle: title,\n\t\t\tsubTitle: subTitle,\n\t\t\tdescription: description,\n\t\t\tapplicationVersion: {\n\t\t\t\tversion: \"1.0.0\"\n\t\t\t}\n\t\t},\n\t\t\"sap.ui\": {\n\t\t\ttechnology: \"UI5\",\n\t\t\ticons: {\n\t\t\t\ticon: \"sap-icon://switch-classes\"\n\t\t\t}\n\t\t},\n\t\t\"sap.card\": {\n\t\t\textension: \"module:sap/cards/ap/common/extensions/BaseIntegrationCardExtension\",\n\t\t\ttype: \"Object\",\n\t\t\tconfiguration: {\n\t\t\t\tparameters: {\n\t\t\t\t\t...entityKeyPropertiesParameters,\n\t\t\t\t\t_contentSelectQuery: {\n\t\t\t\t\t\tvalue: entityKeyProperties?.length ? `$select=${entityKeyProperties.join(\",\")}` : \"\"\n\t\t\t\t\t},\n\t\t\t\t\t_headerSelectQuery: {\n\t\t\t\t\t\tvalue: entityKeyProperties?.length ? `$select=${entityKeyProperties.join(\",\")}` : \"\"\n\t\t\t\t\t},\n\t\t\t\t\t_contentExpandQuery: {\n\t\t\t\t\t\tvalue: \"\"\n\t\t\t\t\t},\n\t\t\t\t\t_headerExpandQuery: {\n\t\t\t\t\t\tvalue: \"\"\n\t\t\t\t\t},\n\t\t\t\t\t_entitySet: {\n\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\tvalue: entitySetName\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdestinations: {\n\t\t\t\t\tservice: {\n\t\t\t\t\t\tname: \"(default)\",\n\t\t\t\t\t\tdefaultUrl: \"/\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcsrfTokens: {\n\t\t\t\t\ttoken1: {\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\trequest: {\n\t\t\t\t\t\t\t\turl: `{{destinations.service}}${service}`,\n\t\t\t\t\t\t\t\tmethod: \"HEAD\",\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\t\"X-CSRF-Token\": \"Fetch\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\trequest: {\n\t\t\t\t\turl: `{{destinations.service}}${service}/$batch`,\n\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"X-CSRF-Token\": \"{{csrfTokens.token1}}\",\n\t\t\t\t\t\t\"Accept-Language\": \"{{parameters.LOCALE}}\"\n\t\t\t\t\t},\n\t\t\t\t\tbatch: {\n\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\turl: getHeaderBatchUrl(),\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\tAccept: \"application/json\",\n\t\t\t\t\t\t\t\t\"Accept-Language\": \"{{parameters.LOCALE}}\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tretryAfter: 30\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcontent: {\n\t\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\t\turl: getContentBatchUrl(),\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\tAccept: \"application/json\",\n\t\t\t\t\t\t\t\t\"Accept-Language\": \"{{parameters.LOCALE}}\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\theader: {\n\t\t\t\tdata: {\n\t\t\t\t\tpath: dataPathHeader\n\t\t\t\t},\n\t\t\t\ttype: \"Numeric\",\n\t\t\t\ttitle: title,\n\t\t\t\tsubTitle: subTitle,\n\t\t\t\tunitOfMeasurement: \"\",\n\t\t\t\tmainIndicator: {\n\t\t\t\t\tnumber: \"\",\n\t\t\t\t\tunit: \"\"\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontent: {\n\t\t\t\tdata: {\n\t\t\t\t\tpath: dataPath\n\t\t\t\t},\n\t\t\t\tgroups: []\n\t\t\t}\n\t\t},\n\t\t\"sap.ui5\": {\n\t\t\t_version: \"1.1.0\",\n\t\t\tcontentDensities: {\n\t\t\t\tcompact: true,\n\t\t\t\tcozy: true\n\t\t\t},\n\t\t\tdependencies: {\n\t\t\t\tlibs: {\n\t\t\t\t\t\"sap.insights\": {\n\t\t\t\t\t\tlazy: false\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"sap.insights\": {\n\t\t\ttemplateName: \"ObjectPage\",\n\t\t\tparentAppId: sapAppId,\n\t\t\tcardType: \"LEAN_DT\",\n\t\t\tversions: {\n\t\t\t\tui5: sapCoreVersionInfo.version + \"-\" + sapCoreVersionInfo.buildTimestamp\n\t\t\t}\n\t\t}\n\t};\n\treturn manifest;\n}\n\nfunction getObjectPageContext() {\n\tconst { rootComponent, entitySet } = ApplicationInfo.getInstance().fetchDetails();\n\tconst appModel = rootComponent.getModel() as V2ODataModel | V4ODataModel;\n\tconst contextParameters: string[] = [];\n\tconst bODataV4 = isODataV4Model(appModel);\n\n\tif (bODataV4) {\n\t\tconst keyProperties = getPropertyReferenceKey(appModel as V4ODataModel, entitySet);\n\t\tkeyProperties.forEach((property) => {\n\t\t\tconst parameter = V4ODataUtils.formatLiteral(`{{parameters.${property.name}}}`, property.type);\n\t\t\tcontextParameters.push(`${property.name}=${parameter}`);\n\t\t});\n\t} else {\n\t\tconst keyProperties = getPropertyReference(appModel as V2ODataModel, entitySet);\n\t\tkeyProperties.forEach((property) => {\n\t\t\tconst parameter = V2OdataUtils.formatValue(`{{parameters.${property.name}}}`, property.type, true);\n\t\t\tcontextParameters.push(`${property.name}=${parameter}`);\n\t\t});\n\t}\n\n\treturn contextParameters.join(\",\");\n}\n\nfunction getHeaderBatchUrl() {\n\treturn `{{parameters._entitySet}}(${getObjectPageContext()})?{{parameters._headerSelectQuery}}{{parameters._headerExpandQuery}}`;\n}\n\nfunction getContentBatchUrl() {\n\treturn `{{parameters._entitySet}}(${getObjectPageContext()})?{{parameters._contentSelectQuery}}{{parameters._contentExpandQuery}}`;\n}\n\nexport function getCurrentCardManifest(): CardManifest {\n\treturn manifest || {};\n}\n\n/**\n * Render integration card preview\n *\n * @param {CardManifest} newManifest\n */\nexport function renderCardPreview(newManifest: CardManifest, oModel?: JSONModel) {\n\tmanifest = { ...newManifest };\n\tupdateManifestWithSelectQueryParams(manifest);\n\toModel && updateManifestWithExpandQueryParams(manifest);\n\tconst oCard = CoreElement.getElementById(\"cardGeneratorDialog--cardPreview\") as Card;\n\tif (oCard) {\n\t\toCard.setBaseUrl(\"./\");\n\t\toCard.setManifest(manifest);\n\t\toCard.refresh();\n\t}\n}\n\nexport function updateCardGroups(oModel: JSONModel) {\n\tconst configurationGroups: Group[] = oModel.getProperty(\"/configuration/groups\");\n\tconst advancedPanelCriticallity = oModel?.getProperty(\"/configuration/mainIndicatorOptions/criticality\");\n\n\tconst groups = configurationGroups.map(function (configuration) {\n\t\tconst items = configuration?.items\n\t\t\t?.filter(function (configurationItem) {\n\t\t\t\treturn configurationItem.name;\n\t\t\t})\n\t\t\t.map((configurationItem) => {\n\t\t\t\tconst matchedCriticallity = advancedPanelCriticallity?.filter(\n\t\t\t\t\t(columnItem: CriticalityOptions) => columnItem.name === configurationItem.name\n\t\t\t\t);\n\t\t\t\tlet updatedColorState;\n\t\t\t\tif (matchedCriticallity?.[0]?.criticality) {\n\t\t\t\t\tconst criticalityValue = matchedCriticallity[0]?.activeCalculation\n\t\t\t\t\t\t? matchedCriticallity[0]\n\t\t\t\t\t\t: matchedCriticallity[0]?.criticality;\n\t\t\t\t\tupdatedColorState = getColorForGroup(criticalityValue);\n\t\t\t\t}\n\t\t\t\tconst item: any = {\n\t\t\t\t\tlabel: configurationItem.label,\n\t\t\t\t\tvalue: configurationItem.value,\n\t\t\t\t\tname: configurationItem.name\n\t\t\t\t};\n\t\t\t\tif (updatedColorState) {\n\t\t\t\t\titem.state = updatedColorState;\n\t\t\t\t\titem.type = \"Status\";\n\t\t\t\t}\n\t\t\t\tif (configurationItem.hasActions) {\n\t\t\t\t\titem[\"actions\"] = configurationItem.actions;\n\t\t\t\t}\n\t\t\t\treturn item;\n\t\t\t});\n\t\treturn {\n\t\t\ttitle: configuration.title,\n\t\t\titems: items ? items : []\n\t\t};\n\t});\n\t(manifest[\"sap.card\"].content as ObjectContent).groups = groups;\n\trenderCardPreview(manifest, oModel);\n}\n\n/**\n *  Resolves the card header properties from stored manifest\n *  - If path is a string, return the resolved i18n text\n * \t- If path is an expression, resolve the expression then return the labelWithValue of the property\n *  - If path is an expression with formatter, update the formatter configuration and return the labelWithValue of the property\n * @param path\n * @param resourceModel\n * @param properties\n * @returns\n */\nexport function resolvePropertyLabelFromExpression(path: string, resourceModel: ResourceModel, properties: PropertyInfoMap) {\n\tif (isI18nExpression(path)) {\n\t\treturn resolveI18nTextFromResourceModel(path, resourceModel);\n\t}\n\n\tif (isExpression(path) && !hasFormatter(path)) {\n\t\tconst propertyPath = extractPathWithoutUOM(path);\n\t\treturn properties.find((property) => property.name === propertyPath)?.labelWithValue ?? \"\";\n\t}\n\n\tif (isExpression(path) && hasFormatter(path)) {\n\t\tconst formatterExpression = extractPathExpressionWithoutUOM(path);\n\t\tconst selectedFormatter = updateAndGetSelectedFormatters(formatterExpression);\n\t\thandleFormatter(selectedFormatter);\n\t\treturn properties.find((property) => property.name === selectedFormatter.property)?.labelWithValue ?? \"\";\n\t}\n\n\treturn path;\n}\n\nfunction getMainIndicator(mManifest: CardManifest) {\n\tconst mainIndicator = mManifest[\"sap.card\"].header.mainIndicator;\n\tlet mainIndicatorKey = \"\";\n\tlet trendOptions: TrendOptions = {\n\t\treferenceValue: \"\",\n\t\tdownDifference: \"\",\n\t\tupDifference: \"\"\n\t};\n\tconst criticalityOptions: CriticalityOptions[] = [];\n\tconst groups = (mManifest[\"sap.card\"].content as ObjectContent).groups;\n\n\tif (groups.length > 0) {\n\t\tupdateCriticalityBasedOnGroups(mManifest, criticalityOptions);\n\t}\n\n\tif (!mainIndicator || !mainIndicator.number) {\n\t\treturn {\n\t\t\tmainIndicatorStatusKey: \"\",\n\t\t\tmainIndicatorNavigationSelectedKey: \"\",\n\t\t\tcriticalityOptions,\n\t\t\tnavigationValue: \"\",\n\t\t\ttrendOptions\n\t\t};\n\t}\n\n\tconst { propertyPath, formatterExpression } = extractPropertyConfigurationWithoutTextArrangement(mainIndicator.number, mManifest);\n\tconst state = mainIndicator.state;\n\n\tif (formatterExpression.length) {\n\t\tconst formatterExpressions = formatterExpression.map(updateAndGetSelectedFormatters);\n\t\tformatterExpressions.forEach(handleFormatter);\n\t}\n\n\tif (isExpression(propertyPath) && !hasFormatter(propertyPath)) {\n\t\tmainIndicatorKey = extractPathWithoutUOM(propertyPath);\n\t}\n\tif (mainIndicator.trend && mainIndicator.trend !== \"None\") {\n\t\tconst trendValue = mainIndicator.trend;\n\t\tconst regex = /\"referenceValue\":(\\d+),\"downDifference\":(\\d+),\"upDifference\":(\\d+)/;\n\t\tconst match = trendValue.match(regex);\n\n\t\tif (match) {\n\t\t\ttrendOptions = {\n\t\t\t\treferenceValue: match[1] || \"\",\n\t\t\t\tdownDifference: match[2] || \"\",\n\t\t\t\tupDifference: match[3] || \"\"\n\t\t\t};\n\t\t}\n\t}\n\n\tif (isExpression(propertyPath) && hasFormatter(propertyPath)) {\n\t\tconst formatterExpression = extractPathExpressionWithoutUOM(propertyPath);\n\t\tconst selectedFormatter = updateAndGetSelectedFormatters(formatterExpression);\n\t\thandleFormatter(selectedFormatter);\n\t\tmainIndicatorKey = selectedFormatter.property || \"\";\n\t}\n\tlet criticalityConfig: CriticalityOptions = {\n\t\tcriticality: \"\",\n\t\tname: \"\",\n\t\tactiveCalculation: false\n\t};\n\tif (state && hasFormatter(state)) {\n\t\tconst formatterExpression = extractPathExpressionWithoutUOM(state);\n\t\tconst selectedFormatter = updateAndGetSelectedFormatters(formatterExpression);\n\t\thandleFormatter(selectedFormatter);\n\t\tcriticalityConfig = {\n\t\t\tcriticality: \"{\" + selectedFormatter.property + \"}\",\n\t\t\tname: mainIndicatorKey,\n\t\t\tactiveCalculation: false\n\t\t};\n\t} else if (state && state !== \"None\") {\n\t\tcriticalityConfig = {\n\t\t\tcriticality: state,\n\t\t\tname: mainIndicatorKey,\n\t\t\tactiveCalculation: false\n\t\t};\n\t}\n\tif (criticalityConfig.name.length) {\n\t\tupdateCriticalityOptions(criticalityOptions, criticalityConfig);\n\t}\n\n\tlet mainIndicatorNavigationSelectedKey = \"\";\n\tlet mainIndicatorStatusKey = mainIndicatorKey;\n\tif (mainIndicatorKey.includes(\"/\")) {\n\t\tmainIndicatorStatusKey = mainIndicatorKey.split(\"/\")[0];\n\t\tmainIndicatorNavigationSelectedKey = mainIndicatorKey.split(\"/\")[1];\n\t}\n\treturn {\n\t\tmainIndicatorStatusKey,\n\t\tmainIndicatorNavigationSelectedKey,\n\t\tcriticalityOptions,\n\t\tnavigationValue: mainIndicatorKey,\n\t\ttrendOptions\n\t};\n}\n/**\n * Updates the criticality options based on the groups in the provided CardManifest.\n * @param {CardManifest} mManifest - The card manifest containing the groups and their items.\n * @param {CriticalityOptions[]} criticalityOptions - An array of criticality options to be updated.\n */\n\nfunction updateCriticalityBasedOnGroups(mManifest: CardManifest, criticalityOptions: CriticalityOptions[]) {\n\tconst groups = (mManifest[\"sap.card\"].content as ObjectContent).groups;\n\tgroups.forEach((group) => {\n\t\tgroup.items.forEach((item) => {\n\t\t\tif (item.state) {\n\t\t\t\tconst criticallityState = getCriticallityStateForGroup(item.state);\n\t\t\t\tconst criticalityConfig: CriticalityOptions = {\n\t\t\t\t\tcriticality: criticallityState,\n\t\t\t\t\tname: item.name,\n\t\t\t\t\tactiveCalculation: false\n\t\t\t\t};\n\t\t\t\tupdateCriticalityOptions(criticalityOptions, criticalityConfig);\n\t\t\t}\n\t\t});\n\t});\n}\n\n/**\n * Update the criticality options\n * @param criticalityOptions\n * @param criticalityConfig\n */\nfunction updateCriticalityOptions(criticalityOptions: CriticalityOptions[], criticalityConfig: CriticalityOptions) {\n\tconst itemExists = criticalityOptions.some((option) => option.name === criticalityConfig.name);\n\tif (!itemExists) {\n\t\tcriticalityOptions.push(criticalityConfig);\n\t}\n}\n\n/**\n * Gets the criticality state for a group based on the provided state string.\n *\n * This function checks if the state has a formatter associated with it.\n * If so, it processes the formatter and returns its property in a specific format.\n * If the state corresponds to a known criticality state, it returns the corresponding\n * color indicator. If the state is not recognized, it defaults to the 'None' indicator.\n *\n * @param {string} state - The state string to evaluate for criticality.\n * @returns {string} - The criticality state as a string based on the ColorIndicator enum.\n *                    Possible return values include:\n *                    - ColorIndicator.Error\n *                    - ColorIndicator.Success\n *                    - ColorIndicator.None\n *                    - ColorIndicator.Warning\n */\nexport function getCriticallityStateForGroup(state: string) {\n\tif (state && hasFormatter(state)) {\n\t\tconst formatterExpression = extractPathExpressionWithoutUOM(state);\n\t\tconst selectedFormatter = updateAndGetSelectedFormatters(formatterExpression);\n\t\thandleFormatter(selectedFormatter);\n\t\treturn \"{\" + selectedFormatter.property + \"}\";\n\t}\n\n\tif (state && state in ColorIndicator) {\n\t\treturn ColorIndicator[state as keyof typeof ColorIndicator];\n\t}\n\n\treturn ColorIndicator.None;\n}\n\nfunction getSideIndicators(mManifest: CardManifest): SideIndicatorOptions {\n\tconst sideIndicators = mManifest[\"sap.card\"].header.sideIndicators || [];\n\n\tif (sideIndicators.length === 0 || !sideIndicators[0].number) {\n\t\treturn {\n\t\t\ttargetValue: \"\",\n\t\t\ttargetUnit: \"\",\n\t\t\tdeviationValue: \"\",\n\t\t\tdeviationUnit: \"\"\n\t\t};\n\t}\n\n\tconst [targetIndicator = {}, deviationIndicator = {}] = sideIndicators;\n\tconst { number: targetValue = \"\", unit: targetUnit = \"\" } = targetIndicator;\n\n\tconst { number: deviationValue = \"\", unit: deviationUnit = \"\" } = deviationIndicator;\n\n\treturn {\n\t\ttargetValue,\n\t\ttargetUnit,\n\t\tdeviationValue,\n\t\tdeviationUnit\n\t};\n}\n\nfunction handleFormatter(formatter: FormatterConfiguration) {\n\tif (\n\t\tformatterConfigurationFromCardManifest.length === 0 ||\n\t\t!formatterConfigurationFromCardManifest.find((f) => f.property === formatter.property)\n\t) {\n\t\tformatterConfigurationFromCardManifest.push({ ...formatter });\n\t}\n}\n\nfunction getGroupItemValue(value: string, mManifest: CardManifest) {\n\tconst { formatterExpression } = extractPropertyConfigurationWithoutTextArrangement(value, mManifest);\n\n\tif (formatterExpression.length) {\n\t\tconst formatterExpressions = formatterExpression.map(updateAndGetSelectedFormatters);\n\t\tformatterExpressions.forEach(handleFormatter);\n\t}\n\n\treturn value;\n}\n\nfunction getCardGroups(mManifest: CardManifest, resourceModel: ResourceModel) {\n\tconst groups = (mManifest[\"sap.card\"].content as ObjectContent).groups;\n\tif (groups.length === 0) {\n\t\treturn [];\n\t}\n\n\treturn groups.map((group) => {\n\t\treturn {\n\t\t\ttitle: resolveI18nTextFromResourceModel(group.title, resourceModel),\n\t\t\titems: group.items.map((item) => {\n\t\t\t\tconst groupItem: GroupItems = {\n\t\t\t\t\tlabel: resolveI18nTextFromResourceModel(item.label, resourceModel),\n\t\t\t\t\tvalue: getGroupItemValue(item.value, mManifest),\n\t\t\t\t\tname: item.name,\n\t\t\t\t\tisEnabled: true,\n\t\t\t\t\tisNavigationEnabled: false\n\t\t\t\t};\n\t\t\t\tif (item.state) {\n\t\t\t\t\tgroupItem.type = \"Status\";\n\t\t\t\t\tgroupItem.state = item.state;\n\t\t\t\t}\n\t\t\t\treturn groupItem;\n\t\t\t})\n\t\t};\n\t});\n}\n\n/**\n * This is a fix for cards which are generated without \"sap.insights\" manifest property or with cardType as \"DT\".\n *  - When the card is regenerated \"sap.insight\" property will be set/updated existing in the manifest.\n *\n * @param mCardManifest\n * @param rootComponent\n * @returns\n */\nexport async function enhanceManifestWithInsights(mCardManifest: CardManifest | undefined, rootComponent: Component) {\n\tif (!mCardManifest) {\n\t\treturn;\n\t}\n\tconst sapAppId = rootComponent.getManifest()[\"sap.app\"].id;\n\tconst sapCoreVersionInfo = (await VersionInfo.load({\n\t\tlibrary: \"sap.ui.core\"\n\t})) as LibVersionInfo;\n\n\tmCardManifest[\"sap.insights\"] = {\n\t\ttemplateName: \"ObjectPage\",\n\t\tparentAppId: sapAppId,\n\t\tcardType: \"LEAN_DT\",\n\t\tversions: {\n\t\t\tui5: sapCoreVersionInfo.version + \"-\" + sapCoreVersionInfo.buildTimestamp\n\t\t}\n\t};\n}\n\n/**\n * Enhance the card manifest configuration parameters with property formatting configuration\n * \t- add text arrangements properties\n *\n * @param mCardManifest\n * @param oDialogModel\n */\nexport function enhanceManifestWithConfigurationParameters(mCardManifest: CardManifest, oDialogModel: JSONModel) {\n\tconst sapCard = mCardManifest[\"sap.card\"];\n\tconst applicationInfo = ApplicationInfo.getInstance();\n\tconst rootComponent = applicationInfo.getRootComponent();\n\tconst appModel = rootComponent.getModel();\n\tconst { odataModel, entitySet } = applicationInfo.fetchDetails();\n\tconst keyProperties: string[] = [];\n\n\tif (odataModel === ODataModelVersion.V4) {\n\t\tgetPropertyReferenceKey(appModel as V4ODataModel, entitySet).forEach((property) => keyProperties.push(property.name));\n\t} else {\n\t\tgetPropertyReference(appModel as V2ODataModel, entitySet).forEach((property) => keyProperties.push(property.name));\n\t}\n\n\tif (!sapCard.configuration) {\n\t\tsapCard.configuration = {\n\t\t\tparameters: {}\n\t\t};\n\t}\n\n\tif (!sapCard.configuration.parameters) {\n\t\tsapCard.configuration.parameters = {};\n\t}\n\n\tconst configurationParameters = sapCard.configuration.parameters;\n\tconfigurationParameters[\"_propertyFormatting\"] = {};\n\tconst textArrangements = oDialogModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\") as ArrangementOptions[];\n\n\tconst propertyFormatting: PropertyFormattingParameters = {};\n\ttextArrangements.forEach((arrangement) => {\n\t\tif (Object.keys(arrangement).length > 0) {\n\t\t\tconst { name, arrangementType, value } = arrangement;\n\n\t\t\tpropertyFormatting[name] = {\n\t\t\t\tarrangements: {\n\t\t\t\t\ttext: {\n\t\t\t\t\t\t[arrangementType]: true,\n\t\t\t\t\t\tpath: value\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t});\n\tif (Object.keys(propertyFormatting).length > 0) {\n\t\tconfigurationParameters[\"_propertyFormatting\"] = propertyFormatting;\n\t}\n\n\tconfigurationParameters[\"_mandatoryODataParameters\"] = {\n\t\tvalue: keyProperties\n\t};\n\n\tconfigurationParameters[\"_entitySet\"] = {\n\t\tvalue: entitySet,\n\t\ttype: \"string\"\n\t};\n\n\tkeyProperties.forEach((keyProp) => {\n\t\tconfigurationParameters[keyProp] = {\n\t\t\ttype: getDataType(keyProp),\n\t\t\tvalue: \"\"\n\t\t};\n\t});\n}\n\n/**\n * Adds query parameters to the URLs in the manifest's batch request.\n *\n * @param {CardManifest} cardManifest - The card manifest.\n * @returns {CardManifest} A copy of the original card manifest with query parameters added to the URLs.\n */\n\nexport const addQueryParametersToManifest = (cardManifest?: CardManifest): CardManifest => {\n\tconst cardManifestCopy = JSON.parse(JSON.stringify(cardManifest));\n\tconst batchRequest = cardManifestCopy[\"sap.card\"].data?.request?.batch;\n\tconst selectQueryHeader = \"?{{parameters._headerSelectQuery}}\";\n\tconst selectQueryContent = \"?{{parameters._contentSelectQuery}}\";\n\tconst expandQueryHeader = \"{{parameters._headerExpandQuery}}\";\n\tconst expandQueryContent = \"{{parameters._contentExpandQuery}}\";\n\tconst headerUrl = batchRequest?.header?.url;\n\tconst contentUrl = batchRequest?.content?.url;\n\n\tif (headerUrl?.indexOf(selectQueryHeader) === -1) {\n\t\tbatchRequest.header.url = `${batchRequest.header.url}${selectQueryHeader}${expandQueryHeader}`;\n\t} else if (headerUrl?.indexOf(expandQueryHeader) === -1) {\n\t\tbatchRequest.header.url = `${batchRequest.header.url}${expandQueryHeader}`;\n\t}\n\tif (contentUrl?.indexOf(selectQueryContent) === -1) {\n\t\tbatchRequest.content.url = `${batchRequest.content.url}${selectQueryContent}${expandQueryContent}`;\n\t} else if (contentUrl?.indexOf(expandQueryContent) === -1) {\n\t\tbatchRequest.content.url = `${batchRequest.content.url}${expandQueryContent}`;\n\t}\n\n\tconst configParameters = cardManifestCopy[\"sap.card\"].configuration?.parameters;\n\tconfigParameters._contentSelectQuery = configParameters?._contentSelectQuery ?? { value: \"\" };\n\tconfigParameters._headerSelectQuery = configParameters?._headerSelectQuery ?? { value: \"\" };\n\tconfigParameters._contentExpandQuery = configParameters?._contentExpandQuery ?? { value: \"\" };\n\tconfigParameters._headerExpandQuery = configParameters?._headerExpandQuery ?? { value: \"\" };\n\n\treturn cardManifestCopy;\n};\n\nconst updateConfigurationParametersWithKeyProperties = (cardManifest: CardManifest, data: Record<string, any>) => {\n\tconst applicationInfo = ApplicationInfo.getInstance();\n\tconst rootComponent = applicationInfo.getRootComponent();\n\tconst appModel = rootComponent.getModel();\n\tconst { odataModel, entitySet } = applicationInfo.fetchDetails();\n\tconst propertyReferenceKeys =\n\t\todataModel === ODataModelVersion.V4\n\t\t\t? getPropertyReferenceKey(appModel as V4ODataModel, entitySet)\n\t\t\t: getPropertyReference(appModel as V2ODataModel, entitySet);\n\n\tconst sapCard = cardManifest[\"sap.card\"];\n\tif (!sapCard.configuration) {\n\t\tsapCard.configuration = {\n\t\t\tparameters: {}\n\t\t};\n\t}\n\n\tif (!sapCard.configuration.parameters) {\n\t\tsapCard.configuration.parameters = {};\n\t}\n\tconst configurationParameters = sapCard.configuration.parameters;\n\n\tconfigurationParameters[\"_entitySet\"] = {\n\t\tvalue: entitySet,\n\t\ttype: \"string\"\n\t};\n\n\tpropertyReferenceKeys.forEach((keyProp) => {\n\t\tconfigurationParameters[keyProp.name] = {\n\t\t\ttype: getDataType(keyProp.type),\n\t\t\tvalue: data[keyProp.name]\n\t\t};\n\t});\n};\n\n/**\n * Updates the data path of the card header in the provided card manifest by reference.\n *\n * @param {CardManifest} cardManifest - The card manifest object that contains the header data.\n */\nfunction updateHeaderDataPath(cardManifest: CardManifest) {\n\tconst headerData = cardManifest[\"sap.card\"].header.data;\n\n\tif (headerData?.path && headerData.path !== \"/header/d/\") {\n\t\theaderData.path = \"/header/d/\";\n\t}\n}\n\n/**\n * This method is used to perform updates on existing integration card manifest.\n * Updates will include adding,\n * \t- Query parameters to the URLs in the target manifest's batch request.\n * \t- sap.app.id to the manifest.\n * @param cardManifest\n */\nexport const updateExistingCardManifest = (cardManifest?: CardManifest, data: Record<string, any>): CardManifest | undefined => {\n\tif (!cardManifest) {\n\t\treturn cardManifest;\n\t}\n\n\tcardManifest = addQueryParametersToManifest(cardManifest);\n\tconst batch = cardManifest[\"sap.card\"].data.request?.batch;\n\n\tif (batch !== undefined) {\n\t\tbatch.header.url = getHeaderBatchUrl();\n\t\tbatch.content.url = getContentBatchUrl();\n\t}\n\tcardManifest[\"sap.app\"].id = ApplicationInfo.getInstance().fetchDetails().componentName;\n\tcardManifest[\"sap.app\"].i18n = cardManifest[\"sap.app\"].i18n || \"../../../i18n/i18n.properties\";\n\tupdateConfigurationParametersWithKeyProperties(cardManifest, data);\n\tupdateHeaderDataPath(cardManifest);\n\treturn cardManifest;\n};\n\nexport function parseCard(\n\tintegrationCardManifest: CardManifest,\n\tresourceModel: ResourceModel,\n\tproperties: PropertyInfoMap\n): ParsedManifest {\n\tconst title = integrationCardManifest[\"sap.card\"].header.title ?? \"\";\n\tconst subtitle = integrationCardManifest[\"sap.card\"].header.subTitle ?? \"\";\n\tconst uom = integrationCardManifest[\"sap.card\"].header.unitOfMeasurement ?? \"\";\n\tformatterConfigurationFromCardManifest.splice(0, formatterConfigurationFromCardManifest.length);\n\tconst textArrangementsFromCardManifest: Array<ArrangementOptions> = getTextArrangementFromCardManifest(integrationCardManifest);\n\n\treturn {\n\t\ttitle: resolvePropertyLabelFromExpression(title, resourceModel, properties),\n\t\tsubtitle: resolvePropertyLabelFromExpression(subtitle, resourceModel, properties),\n\t\theaderUOM: resolvePropertyLabelFromExpression(uom, resourceModel, properties),\n\t\tmainIndicatorOptions: getMainIndicator(integrationCardManifest),\n\t\tsideIndicatorOptions: getSideIndicators(integrationCardManifest),\n\t\tgroups: getCardGroups(integrationCardManifest, resourceModel),\n\t\tformatterConfigurationFromCardManifest,\n\t\ttextArrangementsFromCardManifest\n\t};\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AAHA;;AAAAA,GAAA,CAAAC,EAAA,CAAAC,MAAA,sXAAAC,gDAAA,EAAAC,gDAAA,EAAAC,WAAA,EAAAC,WAAA,EAAAC,YAAA,EAAAC,YAAA,EAAAC,mBAAA,EAAAC,oBAAA,EAAAC,oBAAA,EAAAC,kBAAA,EAAAC,QAAA,EAAAC,aAAA,EAAAC,qBAAA;EAAA;;EA0jBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAPA,MAQsBC,2BAA2B,YAAAA,CAACC,aAAuC,EAAEC,aAAwB;IAAA,IAAE;MACpH,IAAI,CAACD,aAAa,EAAE;QACnB,OAAAE,OAAA,CAAAC,OAAA;MACD;MACA,MAAMC,QAAQ,GAAGH,aAAa,CAACI,WAAW,CAAC,CAAC,CAAC,SAAS,CAAC,CAACC,EAAE;MAAC,OAAAJ,OAAA,CAAAC,OAAA,CACzBf,WAAW,CAACmB,IAAI,CAAC;QAClDC,OAAO,EAAE;MACV,CAAC,CAAC,EAAAC,IAAA,WAAAC,iBAAA;QAFF,MAAMC,kBAAkB,GAAAD,iBAEH;QAErBV,aAAa,CAAC,cAAc,CAAC,GAAG;UAC/BY,YAAY,EAAE,YAAY;UAC1BC,WAAW,EAAET,QAAQ;UACrBU,QAAQ,EAAE,SAAS;UACnBC,QAAQ,EAAE;YACTC,GAAG,EAAEL,kBAAkB,CAACM,OAAO,GAAG,GAAG,GAAGN,kBAAkB,CAACO;UAC5D;QACD,CAAC;MAAC;IACH,CAAC,QAAAC,CAAA;MAAA,OAAAjB,OAAA,CAAAkB,MAAA,CAAAD,CAAA;IAAA;EAAA;EAED;AACA;AACA;AACA;AACA;AACA;AACA;EANA,MAjlBSE,oBAAoB,GAAAnC,gDAAA;EAAA,MACpBoC,uBAAuB,GAAAnC,gDAAA;EAAA,MAavBoC,WAAW,GAAA/B,mBAAA;EAAA,MAAEgC,cAAc,GAAAhC,mBAAA;EAAA,MAC3BiC,cAAc,GAAAhC,oBAAA;EAAA,MACdiC,gBAAgB,GAAAhC,oBAAA;EAAA,MAChBiC,eAAe,GAAAhC,kBAAA;EAAA,MAAkBiC,iBAAiB,GAAAjC,kBAAA;EAAA,MAClDkC,mCAAmC,GAAAjC,QAAA;EAAA,MAAEkC,mCAAmC,GAAAlC,QAAA;EAAA,MAGxEmC,gCAAgC,GAAAlC,aAAA;EAAA,MAExCmC,+BAA+B,GAAAlC,qBAAA;EAAA,MAC/BmC,qBAAqB,GAAAnC,qBAAA;EAAA,MACrBoC,kDAAkD,GAAApC,qBAAA;EAAA,MAClDqC,kCAAkC,GAAArC,qBAAA;EAAA,MAClCsC,YAAY,GAAAtC,qBAAA;EAAA,MACZuC,YAAY,GAAAvC,qBAAA;EAAA,MACZwC,gBAAgB,GAAAxC,qBAAA;EAAA,MAChByC,8BAA8B,GAAAzC,qBAAA;EAmB/B,IAAI0C,QAAsB;EAC1B,MAAMC,sCAAiE,GAAG,EAAE;EAErE,SAASC,qBAAqBA,CAACC,KAAU,EAAE;IACjD,MAAM;MAAEC,KAAK;MAAEC,QAAQ;MAAEC,WAAW;MAAEC,OAAO;MAAEC,YAAY;MAAE5C,QAAQ;MAAEO,kBAAkB;MAAEsC,aAAa;MAAEC;IAAK,CAAC,GAAGP,KAAK;IACxH,MAAMQ,QAAQ,GAAG3B,cAAc,CAACwB,YAAY,CAAC;IAC7C,MAAMI,QAAQ,GAAGD,QAAQ,GAAG,WAAW,GAAG,aAAa;IACvD,MAAME,cAAc,GAAGF,QAAQ,GAAG,UAAU,GAAG,YAAY;IAC3D,MAAMG,qBAAqB,GAAGH,QAAQ,GACnC7B,uBAAuB,CAAC0B,YAAY,EAAEC,aAAa,CAAC,GACpD5B,oBAAoB,CAAC2B,YAAY,EAAEC,aAAa,CAAC;IACpD,MAAMM,6BAA8E,GAAG,CAAC,CAAC;IAEzFD,qBAAqB,CAACE,OAAO,CAAEC,OAAO,IAAK;MAC1CF,6BAA6B,CAACE,OAAO,CAACC,IAAI,CAAC,GAAG;QAC7CC,IAAI,EAAEpC,WAAW,CAACkC,OAAO,CAACE,IAAI,CAAC;QAC/BC,KAAK,EAAEV,IAAI,CAACO,OAAO,CAACC,IAAI;MACzB,CAAC;IACF,CAAC,CAAC;IAEF,MAAMG,mBAAmB,GAAGP,qBAAqB,CAACQ,GAAG,CAAEL,OAAO,IAAKA,OAAO,CAACC,IAAI,CAAC;IAEhFlB,QAAQ,GAAG;MACVuB,QAAQ,EAAE,QAAQ;MAClB,SAAS,EAAE;QACVzD,EAAE,EAAEF,QAAQ;QACZuD,IAAI,EAAE,MAAM;QACZK,IAAI,EAAE,+BAA+B;QACrCpB,KAAK,EAAEA,KAAK;QACZC,QAAQ,EAAEA,QAAQ;QAClBC,WAAW,EAAEA,WAAW;QACxBmB,kBAAkB,EAAE;UACnBhD,OAAO,EAAE;QACV;MACD,CAAC;MACD,QAAQ,EAAE;QACTiD,UAAU,EAAE,KAAK;QACjBC,KAAK,EAAE;UACNC,IAAI,EAAE;QACP;MACD,CAAC;MACD,UAAU,EAAE;QACXC,SAAS,EAAE,oEAAoE;QAC/EV,IAAI,EAAE,QAAQ;QACdW,aAAa,EAAE;UACdC,UAAU,EAAE;YACX,GAAGhB,6BAA6B;YAChCiB,mBAAmB,EAAE;cACpBZ,KAAK,EAAEC,mBAAmB,EAAEY,MAAM,GAAG,WAAWZ,mBAAmB,CAACa,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG;YACnF,CAAC;YACDC,kBAAkB,EAAE;cACnBf,KAAK,EAAEC,mBAAmB,EAAEY,MAAM,GAAG,WAAWZ,mBAAmB,CAACa,IAAI,CAAC,GAAG,CAAC,EAAE,GAAG;YACnF,CAAC;YACDE,mBAAmB,EAAE;cACpBhB,KAAK,EAAE;YACR,CAAC;YACDiB,kBAAkB,EAAE;cACnBjB,KAAK,EAAE;YACR,CAAC;YACDkB,UAAU,EAAE;cACXnB,IAAI,EAAE,QAAQ;cACdC,KAAK,EAAEX;YACR;UACD,CAAC;UACD8B,YAAY,EAAE;YACbhC,OAAO,EAAE;cACRW,IAAI,EAAE,WAAW;cACjBsB,UAAU,EAAE;YACb;UACD,CAAC;UACDC,UAAU,EAAE;YACXC,MAAM,EAAE;cACPhC,IAAI,EAAE;gBACLiC,OAAO,EAAE;kBACRC,GAAG,EAAE,2BAA2BrC,OAAO,EAAE;kBACzCsC,MAAM,EAAE,MAAM;kBACdC,OAAO,EAAE;oBACR,cAAc,EAAE;kBACjB;gBACD;cACD;YACD;UACD;QACD,CAAC;QACDpC,IAAI,EAAE;UACLiC,OAAO,EAAE;YACRC,GAAG,EAAE,2BAA2BrC,OAAO,SAAS;YAChDsC,MAAM,EAAE,MAAM;YACdC,OAAO,EAAE;cACR,cAAc,EAAE,uBAAuB;cACvC,iBAAiB,EAAE;YACpB,CAAC;YACDC,KAAK,EAAE;cACNC,MAAM,EAAE;gBACPH,MAAM,EAAE,KAAK;gBACbD,GAAG,EAAEK,iBAAiB,CAAC,CAAC;gBACxBH,OAAO,EAAE;kBACRI,MAAM,EAAE,kBAAkB;kBAC1B,iBAAiB,EAAE;gBACpB,CAAC;gBACDC,UAAU,EAAE;cACb,CAAC;cACDC,OAAO,EAAE;gBACRP,MAAM,EAAE,KAAK;gBACbD,GAAG,EAAES,kBAAkB,CAAC,CAAC;gBACzBP,OAAO,EAAE;kBACRI,MAAM,EAAE,kBAAkB;kBAC1B,iBAAiB,EAAE;gBACpB;cACD;YACD;UACD;QACD,CAAC;QACDF,MAAM,EAAE;UACPtC,IAAI,EAAE;YACL4C,IAAI,EAAEzC;UACP,CAAC;UACDM,IAAI,EAAE,SAAS;UACff,KAAK,EAAEA,KAAK;UACZC,QAAQ,EAAEA,QAAQ;UAClBkD,iBAAiB,EAAE,EAAE;UACrBC,aAAa,EAAE;YACdC,MAAM,EAAE,EAAE;YACVC,IAAI,EAAE;UACP;QACD,CAAC;QACDN,OAAO,EAAE;UACR1C,IAAI,EAAE;YACL4C,IAAI,EAAE1C;UACP,CAAC;UACD+C,MAAM,EAAE;QACT;MACD,CAAC;MACD,SAAS,EAAE;QACVpC,QAAQ,EAAE,OAAO;QACjBqC,gBAAgB,EAAE;UACjBC,OAAO,EAAE,IAAI;UACbC,IAAI,EAAE;QACP,CAAC;QACDC,YAAY,EAAE;UACbC,IAAI,EAAE;YACL,cAAc,EAAE;cACfC,IAAI,EAAE;YACP;UACD;QACD;MACD,CAAC;MACD,cAAc,EAAE;QACf7F,YAAY,EAAE,YAAY;QAC1BC,WAAW,EAAET,QAAQ;QACrBU,QAAQ,EAAE,SAAS;QACnBC,QAAQ,EAAE;UACTC,GAAG,EAAEL,kBAAkB,CAACM,OAAO,GAAG,GAAG,GAAGN,kBAAkB,CAACO;QAC5D;MACD;IACD,CAAC;IACD,OAAOsB,QAAQ;EAChB;EAEA,SAASkE,oBAAoBA,CAAA,EAAG;IAC/B,MAAM;MAAEzG,aAAa;MAAE0G;IAAU,CAAC,GAAGhF,eAAe,CAACiF,WAAW,CAAC,CAAC,CAACC,YAAY,CAAC,CAAC;IACjF,MAAMC,QAAQ,GAAG7G,aAAa,CAAC8G,QAAQ,CAAC,CAAgC;IACxE,MAAMC,iBAA2B,GAAG,EAAE;IACtC,MAAM7D,QAAQ,GAAG3B,cAAc,CAACsF,QAAQ,CAAC;IAEzC,IAAI3D,QAAQ,EAAE;MACb,MAAM8D,aAAa,GAAG3F,uBAAuB,CAACwF,QAAQ,EAAkBH,SAAS,CAAC;MAClFM,aAAa,CAACzD,OAAO,CAAE0D,QAAQ,IAAK;QACnC,MAAMC,SAAS,GAAG5H,YAAY,CAAC6H,aAAa,CAAC,gBAAgBF,QAAQ,CAACxD,IAAI,IAAI,EAAEwD,QAAQ,CAACvD,IAAI,CAAC;QAC9FqD,iBAAiB,CAACK,IAAI,CAAC,GAAGH,QAAQ,CAACxD,IAAI,IAAIyD,SAAS,EAAE,CAAC;MACxD,CAAC,CAAC;IACH,CAAC,MAAM;MACN,MAAMF,aAAa,GAAG5F,oBAAoB,CAACyF,QAAQ,EAAkBH,SAAS,CAAC;MAC/EM,aAAa,CAACzD,OAAO,CAAE0D,QAAQ,IAAK;QACnC,MAAMC,SAAS,GAAG7H,YAAY,CAACgI,WAAW,CAAC,gBAAgBJ,QAAQ,CAACxD,IAAI,IAAI,EAAEwD,QAAQ,CAACvD,IAAI,EAAE,IAAI,CAAC;QAClGqD,iBAAiB,CAACK,IAAI,CAAC,GAAGH,QAAQ,CAACxD,IAAI,IAAIyD,SAAS,EAAE,CAAC;MACxD,CAAC,CAAC;IACH;IAEA,OAAOH,iBAAiB,CAACtC,IAAI,CAAC,GAAG,CAAC;EACnC;EAEA,SAASe,iBAAiBA,CAAA,EAAG;IAC5B,OAAO,6BAA6BiB,oBAAoB,CAAC,CAAC,sEAAsE;EACjI;EAEA,SAASb,kBAAkBA,CAAA,EAAG;IAC7B,OAAO,6BAA6Ba,oBAAoB,CAAC,CAAC,wEAAwE;EACnI;EAEO,SAASa,sBAAsBA,CAAA,EAAiB;IACtD,OAAO/E,QAAQ,IAAI,CAAC,CAAC;EACtB;;EAEA;AACA;AACA;AACA;AACA;EACO,SAASgF,iBAAiBA,CAACC,WAAyB,EAAEC,MAAkB,EAAE;IAChFlF,QAAQ,GAAG;MAAE,GAAGiF;IAAY,CAAC;IAC7B3F,mCAAmC,CAACU,QAAQ,CAAC;IAC7CkF,MAAM,IAAI7F,mCAAmC,CAACW,QAAQ,CAAC;IACvD,MAAMmF,KAAK,GAAGtI,WAAW,CAACuI,cAAc,CAAC,kCAAkC,CAAS;IACpF,IAAID,KAAK,EAAE;MACVA,KAAK,CAACE,UAAU,CAAC,IAAI,CAAC;MACtBF,KAAK,CAACG,WAAW,CAACtF,QAAQ,CAAC;MAC3BmF,KAAK,CAACI,OAAO,CAAC,CAAC;IAChB;EACD;EAEO,SAASC,gBAAgBA,CAACN,MAAiB,EAAE;IACnD,MAAMO,mBAA4B,GAAGP,MAAM,CAACQ,WAAW,CAAC,uBAAuB,CAAC;IAChF,MAAMC,yBAAyB,GAAGT,MAAM,EAAEQ,WAAW,CAAC,iDAAiD,CAAC;IAExG,MAAM/B,MAAM,GAAG8B,mBAAmB,CAACnE,GAAG,CAAC,UAAUQ,aAAa,EAAE;MAC/D,MAAM8D,KAAK,GAAG9D,aAAa,EAAE8D,KAAK,EAC/BC,MAAM,CAAC,UAAUC,iBAAiB,EAAE;QACrC,OAAOA,iBAAiB,CAAC5E,IAAI;MAC9B,CAAC,CAAC,CACDI,GAAG,CAAEwE,iBAAiB,IAAK;QAC3B,MAAMC,mBAAmB,GAAGJ,yBAAyB,EAAEE,MAAM,CAC3DG,UAA8B,IAAKA,UAAU,CAAC9E,IAAI,KAAK4E,iBAAiB,CAAC5E,IAC3E,CAAC;QACD,IAAI+E,iBAAiB;QACrB,IAAIF,mBAAmB,GAAG,CAAC,CAAC,EAAEG,WAAW,EAAE;UAC1C,MAAMC,gBAAgB,GAAGJ,mBAAmB,CAAC,CAAC,CAAC,EAAEK,iBAAiB,GAC/DL,mBAAmB,CAAC,CAAC,CAAC,GACtBA,mBAAmB,CAAC,CAAC,CAAC,EAAEG,WAAW;UACtCD,iBAAiB,GAAG/G,gBAAgB,CAACiH,gBAAgB,CAAC;QACvD;QACA,MAAME,IAAS,GAAG;UACjBC,KAAK,EAAER,iBAAiB,CAACQ,KAAK;UAC9BlF,KAAK,EAAE0E,iBAAiB,CAAC1E,KAAK;UAC9BF,IAAI,EAAE4E,iBAAiB,CAAC5E;QACzB,CAAC;QACD,IAAI+E,iBAAiB,EAAE;UACtBI,IAAI,CAACE,KAAK,GAAGN,iBAAiB;UAC9BI,IAAI,CAAClF,IAAI,GAAG,QAAQ;QACrB;QACA,IAAI2E,iBAAiB,CAACU,UAAU,EAAE;UACjCH,IAAI,CAAC,SAAS,CAAC,GAAGP,iBAAiB,CAACW,OAAO;QAC5C;QACA,OAAOJ,IAAI;MACZ,CAAC,CAAC;MACH,OAAO;QACNjG,KAAK,EAAE0B,aAAa,CAAC1B,KAAK;QAC1BwF,KAAK,EAAEA,KAAK,GAAGA,KAAK,GAAG;MACxB,CAAC;IACF,CAAC,CAAC;IACD5F,QAAQ,CAAC,UAAU,CAAC,CAACoD,OAAO,CAAmBO,MAAM,GAAGA,MAAM;IAC/DqB,iBAAiB,CAAChF,QAAQ,EAAEkF,MAAM,CAAC;EACpC;;EAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACO,SAASwB,kCAAkCA,CAACpD,IAAY,EAAEqD,aAA4B,EAAEC,UAA2B,EAAE;IAC3H,IAAI9G,gBAAgB,CAACwD,IAAI,CAAC,EAAE;MAC3B,OAAO/D,gCAAgC,CAAC+D,IAAI,EAAEqD,aAAa,CAAC;IAC7D;IAEA,IAAI9G,YAAY,CAACyD,IAAI,CAAC,IAAI,CAAC1D,YAAY,CAAC0D,IAAI,CAAC,EAAE;MAC9C,MAAMuD,YAAY,GAAGpH,qBAAqB,CAAC6D,IAAI,CAAC;MAChD,OAAOsD,UAAU,CAACE,IAAI,CAAEpC,QAAQ,IAAKA,QAAQ,CAACxD,IAAI,KAAK2F,YAAY,CAAC,EAAEE,cAAc,IAAI,EAAE;IAC3F;IAEA,IAAIlH,YAAY,CAACyD,IAAI,CAAC,IAAI1D,YAAY,CAAC0D,IAAI,CAAC,EAAE;MAC7C,MAAM0D,mBAAmB,GAAGxH,+BAA+B,CAAC8D,IAAI,CAAC;MACjE,MAAM2D,iBAAiB,GAAGlH,8BAA8B,CAACiH,mBAAmB,CAAC;MAC7EE,eAAe,CAACD,iBAAiB,CAAC;MAClC,OAAOL,UAAU,CAACE,IAAI,CAAEpC,QAAQ,IAAKA,QAAQ,CAACxD,IAAI,KAAK+F,iBAAiB,CAACvC,QAAQ,CAAC,EAAEqC,cAAc,IAAI,EAAE;IACzG;IAEA,OAAOzD,IAAI;EACZ;EAEA,SAAS6D,gBAAgBA,CAACC,SAAuB,EAAE;IAClD,MAAM5D,aAAa,GAAG4D,SAAS,CAAC,UAAU,CAAC,CAACpE,MAAM,CAACQ,aAAa;IAChE,IAAI6D,gBAAgB,GAAG,EAAE;IACzB,IAAIC,YAA0B,GAAG;MAChCC,cAAc,EAAE,EAAE;MAClBC,cAAc,EAAE,EAAE;MAClBC,YAAY,EAAE;IACf,CAAC;IACD,MAAMC,kBAAwC,GAAG,EAAE;IACnD,MAAM/D,MAAM,GAAIyD,SAAS,CAAC,UAAU,CAAC,CAAChE,OAAO,CAAmBO,MAAM;IAEtE,IAAIA,MAAM,CAAC1B,MAAM,GAAG,CAAC,EAAE;MACtB0F,8BAA8B,CAACP,SAAS,EAAEM,kBAAkB,CAAC;IAC9D;IAEA,IAAI,CAAClE,aAAa,IAAI,CAACA,aAAa,CAACC,MAAM,EAAE;MAC5C,OAAO;QACNmE,sBAAsB,EAAE,EAAE;QAC1BC,kCAAkC,EAAE,EAAE;QACtCH,kBAAkB;QAClBI,eAAe,EAAE,EAAE;QACnBR;MACD,CAAC;IACF;IAEA,MAAM;MAAET,YAAY;MAAEG;IAAoB,CAAC,GAAGtH,kDAAkD,CAAC8D,aAAa,CAACC,MAAM,EAAE2D,SAAS,CAAC;IACjI,MAAMb,KAAK,GAAG/C,aAAa,CAAC+C,KAAK;IAEjC,IAAIS,mBAAmB,CAAC/E,MAAM,EAAE;MAC/B,MAAM8F,oBAAoB,GAAGf,mBAAmB,CAAC1F,GAAG,CAACvB,8BAA8B,CAAC;MACpFgI,oBAAoB,CAAC/G,OAAO,CAACkG,eAAe,CAAC;IAC9C;IAEA,IAAIrH,YAAY,CAACgH,YAAY,CAAC,IAAI,CAACjH,YAAY,CAACiH,YAAY,CAAC,EAAE;MAC9DQ,gBAAgB,GAAG5H,qBAAqB,CAACoH,YAAY,CAAC;IACvD;IACA,IAAIrD,aAAa,CAACwE,KAAK,IAAIxE,aAAa,CAACwE,KAAK,KAAK,MAAM,EAAE;MAC1D,MAAMC,UAAU,GAAGzE,aAAa,CAACwE,KAAK;MACtC,MAAME,KAAK,GAAG,oEAAoE;MAClF,MAAMC,KAAK,GAAGF,UAAU,CAACE,KAAK,CAACD,KAAK,CAAC;MAErC,IAAIC,KAAK,EAAE;QACVb,YAAY,GAAG;UACdC,cAAc,EAAEY,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE;UAC9BX,cAAc,EAAEW,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE;UAC9BV,YAAY,EAAEU,KAAK,CAAC,CAAC,CAAC,IAAI;QAC3B,CAAC;MACF;IACD;IAEA,IAAItI,YAAY,CAACgH,YAAY,CAAC,IAAIjH,YAAY,CAACiH,YAAY,CAAC,EAAE;MAC7D,MAAMG,mBAAmB,GAAGxH,+BAA+B,CAACqH,YAAY,CAAC;MACzE,MAAMI,iBAAiB,GAAGlH,8BAA8B,CAACiH,mBAAmB,CAAC;MAC7EE,eAAe,CAACD,iBAAiB,CAAC;MAClCI,gBAAgB,GAAGJ,iBAAiB,CAACvC,QAAQ,IAAI,EAAE;IACpD;IACA,IAAI0D,iBAAqC,GAAG;MAC3ClC,WAAW,EAAE,EAAE;MACfhF,IAAI,EAAE,EAAE;MACRkF,iBAAiB,EAAE;IACpB,CAAC;IACD,IAAIG,KAAK,IAAI3G,YAAY,CAAC2G,KAAK,CAAC,EAAE;MACjC,MAAMS,mBAAmB,GAAGxH,+BAA+B,CAAC+G,KAAK,CAAC;MAClE,MAAMU,iBAAiB,GAAGlH,8BAA8B,CAACiH,mBAAmB,CAAC;MAC7EE,eAAe,CAACD,iBAAiB,CAAC;MAClCmB,iBAAiB,GAAG;QACnBlC,WAAW,EAAE,GAAG,GAAGe,iBAAiB,CAACvC,QAAQ,GAAG,GAAG;QACnDxD,IAAI,EAAEmG,gBAAgB;QACtBjB,iBAAiB,EAAE;MACpB,CAAC;IACF,CAAC,MAAM,IAAIG,KAAK,IAAIA,KAAK,KAAK,MAAM,EAAE;MACrC6B,iBAAiB,GAAG;QACnBlC,WAAW,EAAEK,KAAK;QAClBrF,IAAI,EAAEmG,gBAAgB;QACtBjB,iBAAiB,EAAE;MACpB,CAAC;IACF;IACA,IAAIgC,iBAAiB,CAAClH,IAAI,CAACe,MAAM,EAAE;MAClCoG,wBAAwB,CAACX,kBAAkB,EAAEU,iBAAiB,CAAC;IAChE;IAEA,IAAIP,kCAAkC,GAAG,EAAE;IAC3C,IAAID,sBAAsB,GAAGP,gBAAgB;IAC7C,IAAIA,gBAAgB,CAACiB,QAAQ,CAAC,GAAG,CAAC,EAAE;MACnCV,sBAAsB,GAAGP,gBAAgB,CAACkB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;MACvDV,kCAAkC,GAAGR,gBAAgB,CAACkB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACpE;IACA,OAAO;MACNX,sBAAsB;MACtBC,kCAAkC;MAClCH,kBAAkB;MAClBI,eAAe,EAAET,gBAAgB;MACjCC;IACD,CAAC;EACF;EACA;AACA;AACA;AACA;AACA;;EAEA,SAASK,8BAA8BA,CAACP,SAAuB,EAAEM,kBAAwC,EAAE;IAC1G,MAAM/D,MAAM,GAAIyD,SAAS,CAAC,UAAU,CAAC,CAAChE,OAAO,CAAmBO,MAAM;IACtEA,MAAM,CAAC3C,OAAO,CAAEwH,KAAK,IAAK;MACzBA,KAAK,CAAC5C,KAAK,CAAC5E,OAAO,CAAEqF,IAAI,IAAK;QAC7B,IAAIA,IAAI,CAACE,KAAK,EAAE;UACf,MAAMkC,iBAAiB,GAAGC,4BAA4B,CAACrC,IAAI,CAACE,KAAK,CAAC;UAClE,MAAM6B,iBAAqC,GAAG;YAC7ClC,WAAW,EAAEuC,iBAAiB;YAC9BvH,IAAI,EAAEmF,IAAI,CAACnF,IAAI;YACfkF,iBAAiB,EAAE;UACpB,CAAC;UACDiC,wBAAwB,CAACX,kBAAkB,EAAEU,iBAAiB,CAAC;QAChE;MACD,CAAC,CAAC;IACH,CAAC,CAAC;EACH;;EAEA;AACA;AACA;AACA;AACA;EACA,SAASC,wBAAwBA,CAACX,kBAAwC,EAAEU,iBAAqC,EAAE;IAClH,MAAMO,UAAU,GAAGjB,kBAAkB,CAACkB,IAAI,CAAEC,MAAM,IAAKA,MAAM,CAAC3H,IAAI,KAAKkH,iBAAiB,CAAClH,IAAI,CAAC;IAC9F,IAAI,CAACyH,UAAU,EAAE;MAChBjB,kBAAkB,CAAC7C,IAAI,CAACuD,iBAAiB,CAAC;IAC3C;EACD;;EAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACO,SAASM,4BAA4BA,CAACnC,KAAa,EAAE;IAC3D,IAAIA,KAAK,IAAI3G,YAAY,CAAC2G,KAAK,CAAC,EAAE;MACjC,MAAMS,mBAAmB,GAAGxH,+BAA+B,CAAC+G,KAAK,CAAC;MAClE,MAAMU,iBAAiB,GAAGlH,8BAA8B,CAACiH,mBAAmB,CAAC;MAC7EE,eAAe,CAACD,iBAAiB,CAAC;MAClC,OAAO,GAAG,GAAGA,iBAAiB,CAACvC,QAAQ,GAAG,GAAG;IAC9C;IAEA,IAAI6B,KAAK,IAAIA,KAAK,IAAItH,cAAc,EAAE;MACrC,OAAOA,cAAc,CAACsH,KAAK,CAAgC;IAC5D;IAEA,OAAOtH,cAAc,CAAC6J,IAAI;EAC3B;EAEA,SAASC,iBAAiBA,CAAC3B,SAAuB,EAAwB;IACzE,MAAM4B,cAAc,GAAG5B,SAAS,CAAC,UAAU,CAAC,CAACpE,MAAM,CAACgG,cAAc,IAAI,EAAE;IAExE,IAAIA,cAAc,CAAC/G,MAAM,KAAK,CAAC,IAAI,CAAC+G,cAAc,CAAC,CAAC,CAAC,CAACvF,MAAM,EAAE;MAC7D,OAAO;QACNwF,WAAW,EAAE,EAAE;QACfC,UAAU,EAAE,EAAE;QACdC,cAAc,EAAE,EAAE;QAClBC,aAAa,EAAE;MAChB,CAAC;IACF;IAEA,MAAM,CAACC,eAAe,GAAG,CAAC,CAAC,EAAEC,kBAAkB,GAAG,CAAC,CAAC,CAAC,GAAGN,cAAc;IACtE,MAAM;MAAEvF,MAAM,EAAEwF,WAAW,GAAG,EAAE;MAAEvF,IAAI,EAAEwF,UAAU,GAAG;IAAG,CAAC,GAAGG,eAAe;IAE3E,MAAM;MAAE5F,MAAM,EAAE0F,cAAc,GAAG,EAAE;MAAEzF,IAAI,EAAE0F,aAAa,GAAG;IAAG,CAAC,GAAGE,kBAAkB;IAEpF,OAAO;MACNL,WAAW;MACXC,UAAU;MACVC,cAAc;MACdC;IACD,CAAC;EACF;EAEA,SAASlC,eAAeA,CAACqC,SAAiC,EAAE;IAC3D,IACCtJ,sCAAsC,CAACgC,MAAM,KAAK,CAAC,IACnD,CAAChC,sCAAsC,CAAC6G,IAAI,CAAE0C,CAAC,IAAKA,CAAC,CAAC9E,QAAQ,KAAK6E,SAAS,CAAC7E,QAAQ,CAAC,EACrF;MACDzE,sCAAsC,CAAC4E,IAAI,CAAC;QAAE,GAAG0E;MAAU,CAAC,CAAC;IAC9D;EACD;EAEA,SAASE,iBAAiBA,CAACrI,KAAa,EAAEgG,SAAuB,EAAE;IAClE,MAAM;MAAEJ;IAAoB,CAAC,GAAGtH,kDAAkD,CAAC0B,KAAK,EAAEgG,SAAS,CAAC;IAEpG,IAAIJ,mBAAmB,CAAC/E,MAAM,EAAE;MAC/B,MAAM8F,oBAAoB,GAAGf,mBAAmB,CAAC1F,GAAG,CAACvB,8BAA8B,CAAC;MACpFgI,oBAAoB,CAAC/G,OAAO,CAACkG,eAAe,CAAC;IAC9C;IAEA,OAAO9F,KAAK;EACb;EAEA,SAASsI,aAAaA,CAACtC,SAAuB,EAAET,aAA4B,EAAE;IAC7E,MAAMhD,MAAM,GAAIyD,SAAS,CAAC,UAAU,CAAC,CAAChE,OAAO,CAAmBO,MAAM;IACtE,IAAIA,MAAM,CAAC1B,MAAM,KAAK,CAAC,EAAE;MACxB,OAAO,EAAE;IACV;IAEA,OAAO0B,MAAM,CAACrC,GAAG,CAAEkH,KAAK,IAAK;MAC5B,OAAO;QACNpI,KAAK,EAAEb,gCAAgC,CAACiJ,KAAK,CAACpI,KAAK,EAAEuG,aAAa,CAAC;QACnEf,KAAK,EAAE4C,KAAK,CAAC5C,KAAK,CAACtE,GAAG,CAAE+E,IAAI,IAAK;UAChC,MAAMsD,SAAqB,GAAG;YAC7BrD,KAAK,EAAE/G,gCAAgC,CAAC8G,IAAI,CAACC,KAAK,EAAEK,aAAa,CAAC;YAClEvF,KAAK,EAAEqI,iBAAiB,CAACpD,IAAI,CAACjF,KAAK,EAAEgG,SAAS,CAAC;YAC/ClG,IAAI,EAAEmF,IAAI,CAACnF,IAAI;YACf0I,SAAS,EAAE,IAAI;YACfC,mBAAmB,EAAE;UACtB,CAAC;UACD,IAAIxD,IAAI,CAACE,KAAK,EAAE;YACfoD,SAAS,CAACxI,IAAI,GAAG,QAAQ;YACzBwI,SAAS,CAACpD,KAAK,GAAGF,IAAI,CAACE,KAAK;UAC7B;UACA,OAAOoD,SAAS;QACjB,CAAC;MACF,CAAC;IACF,CAAC,CAAC;EACH;EAoCO,SAASG,0CAA0CA,CAACtM,aAA2B,EAAEuM,YAAuB,EAAE;IAChH,MAAMC,OAAO,GAAGxM,aAAa,CAAC,UAAU,CAAC;IACzC,MAAMyM,eAAe,GAAG9K,eAAe,CAACiF,WAAW,CAAC,CAAC;IACrD,MAAM3G,aAAa,GAAGwM,eAAe,CAACC,gBAAgB,CAAC,CAAC;IACxD,MAAM5F,QAAQ,GAAG7G,aAAa,CAAC8G,QAAQ,CAAC,CAAC;IACzC,MAAM;MAAE4F,UAAU;MAAEhG;IAAU,CAAC,GAAG8F,eAAe,CAAC5F,YAAY,CAAC,CAAC;IAChE,MAAMI,aAAuB,GAAG,EAAE;IAElC,IAAI0F,UAAU,KAAK/K,iBAAiB,CAACgL,EAAE,EAAE;MACxCtL,uBAAuB,CAACwF,QAAQ,EAAkBH,SAAS,CAAC,CAACnD,OAAO,CAAE0D,QAAQ,IAAKD,aAAa,CAACI,IAAI,CAACH,QAAQ,CAACxD,IAAI,CAAC,CAAC;IACtH,CAAC,MAAM;MACNrC,oBAAoB,CAACyF,QAAQ,EAAkBH,SAAS,CAAC,CAACnD,OAAO,CAAE0D,QAAQ,IAAKD,aAAa,CAACI,IAAI,CAACH,QAAQ,CAACxD,IAAI,CAAC,CAAC;IACnH;IAEA,IAAI,CAAC8I,OAAO,CAAClI,aAAa,EAAE;MAC3BkI,OAAO,CAAClI,aAAa,GAAG;QACvBC,UAAU,EAAE,CAAC;MACd,CAAC;IACF;IAEA,IAAI,CAACiI,OAAO,CAAClI,aAAa,CAACC,UAAU,EAAE;MACtCiI,OAAO,CAAClI,aAAa,CAACC,UAAU,GAAG,CAAC,CAAC;IACtC;IAEA,MAAMsI,uBAAuB,GAAGL,OAAO,CAAClI,aAAa,CAACC,UAAU;IAChEsI,uBAAuB,CAAC,qBAAqB,CAAC,GAAG,CAAC,CAAC;IACnD,MAAMC,gBAAgB,GAAGP,YAAY,CAACrE,WAAW,CAAC,2DAA2D,CAAyB;IAEtI,MAAM6E,kBAAgD,GAAG,CAAC,CAAC;IAC3DD,gBAAgB,CAACtJ,OAAO,CAAEwJ,WAAW,IAAK;MACzC,IAAIC,MAAM,CAACC,IAAI,CAACF,WAAW,CAAC,CAACvI,MAAM,GAAG,CAAC,EAAE;QACxC,MAAM;UAAEf,IAAI;UAAEyJ,eAAe;UAAEvJ;QAAM,CAAC,GAAGoJ,WAAW;QAEpDD,kBAAkB,CAACrJ,IAAI,CAAC,GAAG;UAC1B0J,YAAY,EAAE;YACbC,IAAI,EAAE;cACL,CAACF,eAAe,GAAG,IAAI;cACvBrH,IAAI,EAAElC;YACP;UACD;QACD,CAAC;MACF;IACD,CAAC,CAAC;IACF,IAAIqJ,MAAM,CAACC,IAAI,CAACH,kBAAkB,CAAC,CAACtI,MAAM,GAAG,CAAC,EAAE;MAC/CoI,uBAAuB,CAAC,qBAAqB,CAAC,GAAGE,kBAAkB;IACpE;IAEAF,uBAAuB,CAAC,2BAA2B,CAAC,GAAG;MACtDjJ,KAAK,EAAEqD;IACR,CAAC;IAED4F,uBAAuB,CAAC,YAAY,CAAC,GAAG;MACvCjJ,KAAK,EAAE+C,SAAS;MAChBhD,IAAI,EAAE;IACP,CAAC;IAEDsD,aAAa,CAACzD,OAAO,CAAEC,OAAO,IAAK;MAClCoJ,uBAAuB,CAACpJ,OAAO,CAAC,GAAG;QAClCE,IAAI,EAAEpC,WAAW,CAACkC,OAAO,CAAC;QAC1BG,KAAK,EAAE;MACR,CAAC;IACF,CAAC,CAAC;EACH;;EAEA;AACA;AACA;AACA;AACA;AACA;;EAEO,MAAM0J,4BAA4B,GAAIC,YAA2B,IAAmB;IAC1F,MAAMC,gBAAgB,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACJ,YAAY,CAAC,CAAC;IACjE,MAAMK,YAAY,GAAGJ,gBAAgB,CAAC,UAAU,CAAC,CAACtK,IAAI,EAAEiC,OAAO,EAAEI,KAAK;IACtE,MAAMsI,iBAAiB,GAAG,oCAAoC;IAC9D,MAAMC,kBAAkB,GAAG,qCAAqC;IAChE,MAAMC,iBAAiB,GAAG,mCAAmC;IAC7D,MAAMC,kBAAkB,GAAG,oCAAoC;IAC/D,MAAMC,SAAS,GAAGL,YAAY,EAAEpI,MAAM,EAAEJ,GAAG;IAC3C,MAAM8I,UAAU,GAAGN,YAAY,EAAEhI,OAAO,EAAER,GAAG;IAE7C,IAAI6I,SAAS,EAAEE,OAAO,CAACN,iBAAiB,CAAC,KAAK,CAAC,CAAC,EAAE;MACjDD,YAAY,CAACpI,MAAM,CAACJ,GAAG,GAAG,GAAGwI,YAAY,CAACpI,MAAM,CAACJ,GAAG,GAAGyI,iBAAiB,GAAGE,iBAAiB,EAAE;IAC/F,CAAC,MAAM,IAAIE,SAAS,EAAEE,OAAO,CAACJ,iBAAiB,CAAC,KAAK,CAAC,CAAC,EAAE;MACxDH,YAAY,CAACpI,MAAM,CAACJ,GAAG,GAAG,GAAGwI,YAAY,CAACpI,MAAM,CAACJ,GAAG,GAAG2I,iBAAiB,EAAE;IAC3E;IACA,IAAIG,UAAU,EAAEC,OAAO,CAACL,kBAAkB,CAAC,KAAK,CAAC,CAAC,EAAE;MACnDF,YAAY,CAAChI,OAAO,CAACR,GAAG,GAAG,GAAGwI,YAAY,CAAChI,OAAO,CAACR,GAAG,GAAG0I,kBAAkB,GAAGE,kBAAkB,EAAE;IACnG,CAAC,MAAM,IAAIE,UAAU,EAAEC,OAAO,CAACH,kBAAkB,CAAC,KAAK,CAAC,CAAC,EAAE;MAC1DJ,YAAY,CAAChI,OAAO,CAACR,GAAG,GAAG,GAAGwI,YAAY,CAAChI,OAAO,CAACR,GAAG,GAAG4I,kBAAkB,EAAE;IAC9E;IAEA,MAAMI,gBAAgB,GAAGZ,gBAAgB,CAAC,UAAU,CAAC,CAAClJ,aAAa,EAAEC,UAAU;IAC/E6J,gBAAgB,CAAC5J,mBAAmB,GAAG4J,gBAAgB,EAAE5J,mBAAmB,IAAI;MAAEZ,KAAK,EAAE;IAAG,CAAC;IAC7FwK,gBAAgB,CAACzJ,kBAAkB,GAAGyJ,gBAAgB,EAAEzJ,kBAAkB,IAAI;MAAEf,KAAK,EAAE;IAAG,CAAC;IAC3FwK,gBAAgB,CAACxJ,mBAAmB,GAAGwJ,gBAAgB,EAAExJ,mBAAmB,IAAI;MAAEhB,KAAK,EAAE;IAAG,CAAC;IAC7FwK,gBAAgB,CAACvJ,kBAAkB,GAAGuJ,gBAAgB,EAAEvJ,kBAAkB,IAAI;MAAEjB,KAAK,EAAE;IAAG,CAAC;IAE3F,OAAO4J,gBAAgB;EACxB,CAAC;EAED,MAAMa,8CAA8C,GAAGA,CAACd,YAA0B,EAAErK,IAAyB,KAAK;IACjH,MAAMuJ,eAAe,GAAG9K,eAAe,CAACiF,WAAW,CAAC,CAAC;IACrD,MAAM3G,aAAa,GAAGwM,eAAe,CAACC,gBAAgB,CAAC,CAAC;IACxD,MAAM5F,QAAQ,GAAG7G,aAAa,CAAC8G,QAAQ,CAAC,CAAC;IACzC,MAAM;MAAE4F,UAAU;MAAEhG;IAAU,CAAC,GAAG8F,eAAe,CAAC5F,YAAY,CAAC,CAAC;IAChE,MAAMvD,qBAAqB,GAC1BqJ,UAAU,KAAK/K,iBAAiB,CAACgL,EAAE,GAChCtL,uBAAuB,CAACwF,QAAQ,EAAkBH,SAAS,CAAC,GAC5DtF,oBAAoB,CAACyF,QAAQ,EAAkBH,SAAS,CAAC;IAE7D,MAAM6F,OAAO,GAAGe,YAAY,CAAC,UAAU,CAAC;IACxC,IAAI,CAACf,OAAO,CAAClI,aAAa,EAAE;MAC3BkI,OAAO,CAAClI,aAAa,GAAG;QACvBC,UAAU,EAAE,CAAC;MACd,CAAC;IACF;IAEA,IAAI,CAACiI,OAAO,CAAClI,aAAa,CAACC,UAAU,EAAE;MACtCiI,OAAO,CAAClI,aAAa,CAACC,UAAU,GAAG,CAAC,CAAC;IACtC;IACA,MAAMsI,uBAAuB,GAAGL,OAAO,CAAClI,aAAa,CAACC,UAAU;IAEhEsI,uBAAuB,CAAC,YAAY,CAAC,GAAG;MACvCjJ,KAAK,EAAE+C,SAAS;MAChBhD,IAAI,EAAE;IACP,CAAC;IAEDL,qBAAqB,CAACE,OAAO,CAAEC,OAAO,IAAK;MAC1CoJ,uBAAuB,CAACpJ,OAAO,CAACC,IAAI,CAAC,GAAG;QACvCC,IAAI,EAAEpC,WAAW,CAACkC,OAAO,CAACE,IAAI,CAAC;QAC/BC,KAAK,EAAEV,IAAI,CAACO,OAAO,CAACC,IAAI;MACzB,CAAC;IACF,CAAC,CAAC;EACH,CAAC;;EAED;AACA;AACA;AACA;AACA;EACA,SAAS4K,oBAAoBA,CAACf,YAA0B,EAAE;IACzD,MAAMgB,UAAU,GAAGhB,YAAY,CAAC,UAAU,CAAC,CAAC/H,MAAM,CAACtC,IAAI;IAEvD,IAAIqL,UAAU,EAAEzI,IAAI,IAAIyI,UAAU,CAACzI,IAAI,KAAK,YAAY,EAAE;MACzDyI,UAAU,CAACzI,IAAI,GAAG,YAAY;IAC/B;EACD;;EAEA;AACA;AACA;AACA;AACA;AACA;AACA;EACO,MAAM0I,0BAA0B,GAAGA,CAACjB,YAA2B,EAAErK,IAAyB,KAA+B;IAC/H,IAAI,CAACqK,YAAY,EAAE;MAClB,OAAOA,YAAY;IACpB;IAEAA,YAAY,GAAGD,4BAA4B,CAACC,YAAY,CAAC;IACzD,MAAMhI,KAAK,GAAGgI,YAAY,CAAC,UAAU,CAAC,CAACrK,IAAI,CAACiC,OAAO,EAAEI,KAAK;IAE1D,IAAIA,KAAK,KAAKkJ,SAAS,EAAE;MACxBlJ,KAAK,CAACC,MAAM,CAACJ,GAAG,GAAGK,iBAAiB,CAAC,CAAC;MACtCF,KAAK,CAACK,OAAO,CAACR,GAAG,GAAGS,kBAAkB,CAAC,CAAC;IACzC;IACA0H,YAAY,CAAC,SAAS,CAAC,CAACjN,EAAE,GAAGqB,eAAe,CAACiF,WAAW,CAAC,CAAC,CAACC,YAAY,CAAC,CAAC,CAAC6H,aAAa;IACvFnB,YAAY,CAAC,SAAS,CAAC,CAACvJ,IAAI,GAAGuJ,YAAY,CAAC,SAAS,CAAC,CAACvJ,IAAI,IAAI,+BAA+B;IAC9FqK,8CAA8C,CAACd,YAAY,EAAErK,IAAI,CAAC;IAClEoL,oBAAoB,CAACf,YAAY,CAAC;IAClC,OAAOA,YAAY;EACpB,CAAC;EAEM,SAASoB,SAASA,CACxBC,uBAAqC,EACrCzF,aAA4B,EAC5BC,UAA2B,EACV;IACjB,MAAMxG,KAAK,GAAGgM,uBAAuB,CAAC,UAAU,CAAC,CAACpJ,MAAM,CAAC5C,KAAK,IAAI,EAAE;IACpE,MAAMiM,QAAQ,GAAGD,uBAAuB,CAAC,UAAU,CAAC,CAACpJ,MAAM,CAAC3C,QAAQ,IAAI,EAAE;IAC1E,MAAMiM,GAAG,GAAGF,uBAAuB,CAAC,UAAU,CAAC,CAACpJ,MAAM,CAACO,iBAAiB,IAAI,EAAE;IAC9EtD,sCAAsC,CAACsM,MAAM,CAAC,CAAC,EAAEtM,sCAAsC,CAACgC,MAAM,CAAC;IAC/F,MAAMuK,gCAA2D,GAAG7M,kCAAkC,CAACyM,uBAAuB,CAAC;IAE/H,OAAO;MACNhM,KAAK,EAAEsG,kCAAkC,CAACtG,KAAK,EAAEuG,aAAa,EAAEC,UAAU,CAAC;MAC3EyF,QAAQ,EAAE3F,kCAAkC,CAAC2F,QAAQ,EAAE1F,aAAa,EAAEC,UAAU,CAAC;MACjF6F,SAAS,EAAE/F,kCAAkC,CAAC4F,GAAG,EAAE3F,aAAa,EAAEC,UAAU,CAAC;MAC7E8F,oBAAoB,EAAEvF,gBAAgB,CAACiF,uBAAuB,CAAC;MAC/DO,oBAAoB,EAAE5D,iBAAiB,CAACqD,uBAAuB,CAAC;MAChEzI,MAAM,EAAE+F,aAAa,CAAC0C,uBAAuB,EAAEzF,aAAa,CAAC;MAC7D1G,sCAAsC;MACtCuM;IACD,CAAC;EACF;EAAC,IAAAI,SAAA;IAAAC,UAAA;EAAA;EAAAD,SAAA,CAAA1M,qBAAA,GAAAA,qBAAA;EAAA0M,SAAA,CAAA7H,sBAAA,GAAAA,sBAAA;EAAA6H,SAAA,CAAA5H,iBAAA,GAAAA,iBAAA;EAAA4H,SAAA,CAAApH,gBAAA,GAAAA,gBAAA;EAAAoH,SAAA,CAAAlG,kCAAA,GAAAA,kCAAA;EAAAkG,SAAA,CAAAlE,4BAAA,GAAAA,4BAAA;EAAAkE,SAAA,CAAArP,2BAAA,GAAAA,2BAAA;EAAAqP,SAAA,CAAA9C,0CAAA,GAAAA,0CAAA;EAAA8C,SAAA,CAAA9B,4BAAA,GAAAA,4BAAA;EAAA8B,SAAA,CAAAZ,0BAAA,GAAAA,0BAAA;EAAAY,SAAA,CAAAT,SAAA,GAAAA,SAAA;EAAA,OAAAS,SAAA;AAAA","ignoreList":[]}