/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/cards/ap/generator/odata/ODataUtils","sap/cards/ap/transpiler/cardTranspiler/Transpile","sap/m/MessageBox","sap/m/MessageToast","sap/ui/core/Element","sap/ui/core/Fragment","sap/ui/core/Popup","sap/ui/core/library","sap/ui/model/Filter","sap/ui/model/json/JSONModel","sap/ui/thirdparty/jquery","../config/PreviewOptions","../helpers/ApplicationInfo","../helpers/Batch","../helpers/FooterActions","../helpers/Formatter","../helpers/I18nHelper","../helpers/IntegrationCardHelper","../helpers/PropertyExpression","../helpers/Transpiler","../odata/ODataTypes","../utils/CommonUtils"],function(t,e,n,o,r,i,a,s,c,g,d,l,jQuery,u,p,f,y,m,P,v,h,O,S,M){"use strict";const C=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function E(t,e,n){if(!t.s){if(n instanceof F){if(n.s){if(e&1){e=n.s}n=n.v}else{n.o=E.bind(null,t,e);return}}if(n&&n.then){n.then(E.bind(null,t,e),E.bind(null,t,2));return}t.s=e;t.v=n;const o=t.o;if(o){o(t)}}}const F=function(){function t(){}t.prototype.then=function(e,n){const o=new t;const r=this.s;if(r){const t=r&1?e:n;if(t){try{E(o,1,t(this.v))}catch(t){E(o,2,t)}return o}else{return this}}this.o=function(t){try{const r=t.v;if(t.s&1){E(o,1,e?e(r):r)}else if(n){E(o,1,n(r))}else{E(o,2,r)}}catch(t){E(o,2,t)}};return o};return t}();function A(t){return t instanceof F&&t.s&1}function V(t,e,n){var o=-1,r,i;function a(s){try{while(++o<t.length&&(!n||!n())){s=e(o);if(s&&s.then){if(A(s)){s=s.v}else{s.then(a,i||(i=E.bind(null,r=new F,2)));return}}}if(r){E(r,1,s)}else{r=s}}catch(t){E(r||(r=new F),2,t)}}a();return r}const I=function(t){try{const e=t.getSource();e.setEnabled(false);const n=a.getElementById("cardGeneratorDialog--contentSplitter");const o={onCriticalityChange:t=>{Qt(t.getParameter("isCalcuationType")||false)},onArrangementsChange:function(t){return Promise.resolve(b(t)).then(function(){zt();const t=rt.dialog.getModel();const e=t.getProperty("/configuration/groups");for(let n=0;n<e?.[0].items.length;n++){const o=e[0].items[n];const r=o.value.split(" ")[1]&&o.value.split(" ")[1].slice(1,-1);if(r!=="undefined"&&r!==undefined){t.setProperty("/configuration/advancedFormattingOptions/targetProperty",r)}else if(r===undefined){t.setProperty("/configuration/advancedFormattingOptions/targetProperty","")}if(r!=="undefined"&&r!==undefined&&it?.indexOf(o?.name)===-1){it.push(o?.name)}}})},onPropertyFormatterChangeFromAdvancedSettings:function(){Yt()}};return Promise.resolve(s.load({name:"sap.cards.ap.generator.app.fragments.AdvancedSettings",controller:o}).then(function(t){if(!e.getPressed()){const t=n.getContentAreas()[1];n.removeContentArea(t)}else{n.insertContentArea(t,1)}e.setEnabled(true);setTimeout(()=>{et(rt.dialog.getModel())},0)})).then(function(){})}catch(t){return Promise.reject(t)}};function T(t,e,n){if(typeof t[C]==="function"){var o=t[C](),r,i,a;function d(t){try{while(!(r=o.next()).done&&(!n||!n())){t=e(r.value);if(t&&t.then){if(A(t)){t=t.v}else{t.then(d,a||(a=E.bind(null,i=new F,2)));return}}}if(i){E(i,1,t)}else{i=t}}catch(t){E(i||(i=new F),2,t)}}d();if(o.return){var s=function(t){try{if(!r.done){o.return()}}catch(t){}return t};if(i&&i.then){return i.then(s,function(t){throw s(t)})}s()}return i}if(!("length"in t)){throw new TypeError("Object is not iterable")}var c=[];for(var g=0;g<t.length;g++){c.push(t[g])}return V(c,function(t){return e(c[t])},n)}const b=function(t){try{const e=t.getParameters();const n=e.selectedItem;if(!n)return Promise.resolve();const o=rt.dialog.getModel();const r=o.getProperty("/configuration/navigationProperty")||[];const i=o.getProperty("/configuration/selectedNavigationalProperties")||[];const a=i.findIndex(t=>t.name===n.value);const s=r.find(t=>t.name===n.value);const{name:c="",properties:g=[]}=s||{};const d={name:c,value:g};if(a===-1&&s){i.push(d)}o.setProperty("/configuration/selectedNavigationalProperties",i);const l=function(){if(s){return Promise.resolve(R(s.name,d)).then(function(){if(e.textArrangementChanged){n.navigationalPropertiesForId=d.value;n.isNavigationForId=d.value.length>0;n.navigationKeyForId=""}else{n.navigationalPropertiesForDescription=d.value;n.isNavigationForDescription=d.value.length>0;n.navigationKeyForDescription=""}n.value=""})}else{if(e.textArrangementChanged){n.isNavigationForId=false;n.navigationKeyForId=""}else{n.isNavigationForDescription=false;n.navigationKeyForDescription=""}}}();return Promise.resolve(l&&l.then?l.then(function(){}):void 0)}catch(t){return Promise.reject(t)}};const x=function(t){try{const e=t.getSource();const o=e.getSelectedKey()||"";const r=t.getParameter("newValue");const i=o!==""?`{${o}}`:r;const a=rt.dialog.getModel();ft(t);return Promise.resolve(_(o,false)).then(function(){const t=a.getProperty("/configuration/selectedNavigationPropertiesContent");a.setProperty("/configuration/advancedFormattingOptions/sourceProperty",o);const r=e?.getBindingContext()?.getPath();const s=a.getProperty(r);if(!t?.value?.length){s.value=o&&Z(i,{unitOfMeasures:a.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),textArrangements:a.getProperty("/configuration/advancedFormattingOptions/textArrangements"),propertyValueFormatters:a.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")})}else{s.value="";s.navigationProperty="";s.navigationalProperties=t?.value}const c=n.getPropertyLabel(rt.appModel,rt.entitySet,o,nt.Property);s.label=t?.value?.length?"":c;s.isEnabled=c?.length>0&&!t?.value?.length||false;s.isNavigationEnabled=t?.value?.length>0;a.refresh();Q(a);et(rt.dialog.getModel())})}catch(t){return Promise.reject(t)}};const D=function(){try{const e=Et();if(e){return Promise.resolve()}const n=a.getElementById("cardGeneratorDialog--cardPreview");const o=n.getManifest();return Promise.resolve(q(o,rt.rootComponent)).then(function(){J(o,rt.dialog.getModel());X(o);L(o);const e=rt.dialog.getModel();const n=e.getProperty("/configuration/keyParameters");const a=e.getProperty("/configuration/appIntent");const s=B(o,a,n);delete o["sap.card"].configuration?.parameters?.contextParameters;const c={floorplan:"ObjectPage",localPath:`cards/op/${rt.entitySet}`,fileName:"manifest.json",manifests:[{type:"integration",manifest:o,default:true,entitySet:rt.entitySet},{type:"adaptive",manifest:s,default:true,entitySet:rt.entitySet}]};jQuery.ajax({type:"POST",url:"/cards/store",headers:{"Content-Type":"application/json"},data:JSON.stringify(c),success:function(){i.show(Mt("CARD_SAVE_SUCCESS_MESSAGE"))},error:function(e,n,o){const i=`Unable to save the card: ${n} - ${o} (Status: ${e.status} - ${e.statusText})`;t.error(i);r.error(Mt("CARD_SAVE_ERROR_MESSAGE"))}});rt.dialog.close()})}catch(t){return Promise.reject(t)}};const _=function(t,e){try{const n=rt.dialog.getModel();const o=n.getProperty("/configuration/navigationProperty")||[];const r=n.getProperty("/configuration/selectedNavigationalProperties")||[];const i=r.findIndex(e=>e.name===t);const a=o.find(e=>e.name===t);const s=a?.name||"";const c=a?.properties||[];const g={name:s,value:c};if(i===-1&&a){r.push(g)}n.setProperty("/configuration/selectedNavigationalProperties",r);if(e){n.setProperty("/configuration/selectedNavigationPropertyHeader",g)}else{n.setProperty("/configuration/selectedNavigationPropertiesContent",g)}const d=function(){if(a){return Promise.resolve(R(a.name,g)).then(function(){})}}();return Promise.resolve(d&&d.then?d.then(function(){}):void 0)}catch(t){return Promise.reject(t)}};const N=function(t){try{const e=t=>{const e=rt.dialog.getModel();return{"sap.card":{header:{mainIndicator:{state:dt(t),number:Z(t,{unitOfMeasures:e.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),textArrangements:e.getProperty("/configuration/advancedFormattingOptions/textArrangements"),propertyValueFormatters:e.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")})}}}}};const o=rt.dialog.getModel();const r=t.getSource();const i=r.getSelectedKey();return Promise.resolve(_(i,true)).then(function(){const r=o.getProperty("/configuration/selectedNavigationPropertyHeader");const a=t.getParameter("newValue");ft(t,"stateIndicator");const s=i!==""?`{${i}}`:a;o.setProperty("/configuration/mainIndicatorNavigationSelectedValue","");o.setProperty("/configuration/mainIndicatorNavigationSelectedKey","");o.setProperty("/configuration/advancedFormattingOptions/isPropertyFormattingEnabled",!!(i&&!r?.value?.length&&r?.name===""));const c=o.getProperty("/configuration/properties");const g=c.find(t=>t.name===i)?.type||"";const d=n.isPropertyTypeDate(g);const l=["Edm.Decimal","Edm.Int16","Edm.Int32","Edm.Double"].indexOf(g)>-1;o.setProperty("/configuration/mainIndicatorStatusKey",i);o.setProperty("/configuration/advancedFormattingOptions/isFormatterEnabled",d||l);o.setProperty("/configuration/advancedFormattingOptions/textArrangementSourceProperty",s);o.setProperty("/configuration/advancedFormattingOptions/textArrangementSelectedKey",i);if(o.getProperty("/configuration/trendOptions/sourceProperty")!==i){o.setProperty("/configuration/trendOptions",{});o.setProperty("/configuration/indicatorsValue",{})}o.setProperty("/configuration/trendOptions/sourceProperty",i);o.setProperty("/configuration/indicatorsValue/sourceProperty",i);Dt();_t();o.setProperty("/configuration/navigationValue","");if(!r?.value.length){ut(t,e,"mainIndicator")}else{ut(t,e,"navSelection")}})}catch(t){return Promise.reject(t)}};const R=function(t,e){try{const{entitySetWithObjectContext:o}=G.getInstance().fetchDetails();const r=rt.dialog.getModel();const{serviceUrl:i,oDataV4:a,$data:s}=r.getProperty("/configuration");const c={properties:[],navigationProperties:[{name:t,properties:e.value.map(t=>t.name)||[]}]};return Promise.resolve(n.fetchDataAsync(i,o,a,K(c))).then(function(n){Pt(e,n);s[t]=n[t];r.setProperty("/configuration/$data",s)})}catch(t){return Promise.reject(t)}};const B=o["convertIntegrationCardToAdaptive"];const w=g["ValueState"];const U=u["PREVIEW_OPTIONS"];const G=p["ApplicationInfo"];const K=f["createUrlParameters"];const L=f["updateManifestWithSelectQueryParams"];const $=y["addActionToCardManifest"];const k=y["removeActionFromManifest"];const H=y["resetCardActions"];const j=y["updateCardManifestAction"];const W=m["formatPropertyDropdownValues"];const X=P["createAndStoreGeneratedi18nKeys"];const J=v["enhanceManifestWithConfigurationParameters"];const q=v["enhanceManifestWithInsights"];const Y=v["getCurrentCardManifest"];const z=v["renderCardPreview"];const Q=v["updateCardGroups"];const Z=h["getArrangements"];const tt=h["resolvePropertyPathFromExpression"];const et=O["transpileIntegrationCardToAdaptive"];const nt=S["PropertyInfoType"];const ot=M["isBinding"];const rt={};const it=[];const at=5;const st=5;const ct={onActionAddClick:function(){const t=rt.dialog.getModel();const e=t.getProperty("/configuration/actions/addedActions");if(e.length<2){e.push({title:"",titleKey:"",style:"Default",enablePathKey:"",isStyleControlEnabled:false,isConfirmationRequired:false});t.setProperty("/configuration/actions/addedActions",e)}t.setProperty("/configuration/actions/isAddActionEnabled",e.length<2)},onAddedActionDelete:function(t){const e=rt.dialog.getModel();const n=t?.getSource();const o=n?.getBindingContext()?.getPath();const r=Number(o?.split("/configuration/actions/addedActions/")[1]);const i=e.getProperty("/configuration/actions/addedActions");const a=r!==undefined?i.splice(r,1):[];e.setProperty("/configuration/actions/addedActions",i);e.setProperty("/configuration/actions/isAddActionEnabled",i.length<2);const s=Y();k(s,a[0]);z(s,rt.dialog.getModel());et(rt.dialog.getModel())},validateSelectedAction:function(t){const e=rt.dialog.getModel();const n=e.getProperty("/configuration/actions/annotationActions");return n.some(e=>e.label===t.getValue()&&e.action===t.getSelectedKey())},updateRelativeproperties:function(t,e){const n=rt.dialog.getModel();const o=n.getProperty("/configuration/actions/annotationActions");const r=o.filter(e=>e.label===t.title&&e.action===t.titleKey);if(r.length){let e=r[0].enablePath;e=e?.indexOf("_it/")>-1?e?.replace("_it/",""):e;const n=r[0].isConfirmationRequired;if(e){t.enablePathKey=e}if(n){t.isConfirmationRequired=n}}if(e){n.setProperty(e,t)}},filterCardActions:function(t){const e=rt.dialog.getModel();const n=e.getProperty("/configuration/actions/addedActions");const o=t.getBinding("items");const r=t.getSelectedKey();const i=n.filter(t=>t.titleKey!==r);const a=i.length?new d("action","NE",i[0].titleKey):[];o.filter(a)},loadActions:function(t){const e=t.getSource();const n=e.getBinding("items");if(n?.isSuspended()){n.refresh(true);n.resume()}e.addEventDelegate({onBeforeRendering:this.filterCardActions.bind(null,e)})},onAddedActionTitleChange:function(t){try{const e=this;const n=rt.dialog.getModel();const o=t.getSource();const r=o?.getBindingContext()?.getPath();return Promise.resolve(function(){if(e.validateSelectedAction(o)){function t(){z(a,rt.dialog.getModel());et(rt.dialog.getModel())}const i=n.getProperty(r);i.titleKey=o.getSelectedKey();i.title=o.getValue();i.isStyleControlEnabled=true;e.updateRelativeproperties(i,r||"");o.setValueState(w.None);const a=Y();H(a);const s=n.getProperty("/configuration/actions/addedActions");const c=T(s,function(t){const e=function(){if(t.titleKey){return Promise.resolve($(a,t,rt)).then(function(){})}}();if(e&&e.then)return e.then(function(){})});return c&&c.then?c.then(t):t(c)}else{o.setValueState(w.Error);o.setValueStateText(Mt("GENERATOR_ACTION_ERROR_TEXT"));const g=n.getProperty("/configuration/errorControls");g?.push(o);o.focus()}}())}catch(t){return Promise.reject(t)}},onAddedActionStyleChange:function(t){const e=rt.dialog.getModel();const n=t.getSource();const o=n?.getBindingContext()?.getPath();const r=e.getProperty(o);r.style=n.getSelectedKey();e.setProperty(o,r);const i=Y();j(i,r);z(i,rt.dialog.getModel());et(rt.dialog.getModel())}};const gt={initialize:function(t,e,n){rt.rootComponent=t;rt.appModel=t.getModel();rt.dialog=e;rt.entitySet=n;const o=new l(U);rt?.dialog?.setModel(o,"previewOptions");const r=rt.dialog.getModel();Q(r)},okPressed:D,cancelPressed:Kt,onAddClick:Ct,onGroupAddClick:It,onGroupDeleteClick:Tt,onDeleteClick:xt,onPropertySelection:x,updateContentNavigationSelection:Ot,onPropertyLabelChange:Rt,onTitleSelection:pt,onSubTitleSelection:yt,onGroupTitleChange:bt,validateContol:ft,onDrop:Bt,onHeaderUOMSelection:mt,onStateIndicatorSelection:N,updateHeaderNavigationSelection:vt,onHeightChange:Ut,onWidthChange:Gt,onResetPressed:wt,onItemsActionsButtonPressed:Jt,onPreviewTypeChange:qt,toggleAdvancedSetting:I,getTranslatedText:Mt,onPropertyFormatting:$t,onActionAddClick:ct.onActionAddClick,onAddedActionDelete:ct.onAddedActionDelete,onAddedActionStyleChange:ct.onAddedActionStyleChange,onAddedActionTitleChange:ct.onAddedActionTitleChange,validateSelectedAction:ct.validateSelectedAction,updateRelativeproperties:ct.updateRelativeproperties,loadActions:ct.loadActions,filterCardActions:ct.filterCardActions,_updateTrendForCardHeader:Dt,_updateSideIndicatorsForHeader:_t,_setAdvancedFormattingOptionsEnablement:lt,_updateHeaderArrangements:Yt,_updateArrangements:zt,_updateCriticality:Qt,_validateHeader:Et,applyCriticality:Ht,applyUoMFormatting:jt,onTrendDelete:Wt,loadAdvancedFormattingConfigurationFragment:Xt,addLabelsForProperties:Pt,checkForNavigationProperty:b,disableOrEnableUOMAndTrend:ht};function dt(t,e){const n=rt?.dialog?.getModel();const o=n?.getProperty("/configuration/mainIndicatorOptions/criticality");const r=o?.find(function(e){return e?.name===t||"{"+e?.name+"}"===t});if(r){if(ot(r?.criticality)){return"{= extension.formatters.formatCriticality($"+r?.criticality+", 'color') }"}if(r?.activeCalculation||e){const t={deviationLow:r?.deviationRangeLowValue,deviationHigh:r?.deviationRangeHighValue,toleranceLow:r?.toleranceRangeLowValue,toleranceHigh:r?.toleranceRangeHighValue,sImprovementDirection:r?.improvementDirection,oCriticalityConfigValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};return"{= extension.formatters.formatValueColor(${"+r?.name+"},"+JSON.stringify(t)+") }"}return r?.criticality}return"None"}function lt(t){const e=rt.dialog.getModel();const o=e.getProperty("/configuration/mainIndicatorStatusKey");e.setProperty("/configuration/trendOptions/sourceProperty",o);e.setProperty("/configuration/indicatorsValue/sourceProperty",o);const r=e.getProperty("/configuration/properties");const i=e.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures")||[];const a=e.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")||[];const s=e.getProperty("/configuration/mainIndicatorOptions/criticality")||[];const c=e.getProperty("/configuration/selectedTrendOptions")||[];const g=e.getProperty("/configuration/selectedIndicatorOptions")||[];const d=r.find(e=>e.name===t)?.type||"";const l=n.isPropertyTypeDate(d);const u=["Edm.Decimal","Edm.Int16","Edm.Int32","Edm.Double"].indexOf(d)>-1;let p=a.some(function(e){return e.property===t||"{"+e.property+"}"===t});const f=a.filter(function(e){return e.property===t||"{"+e.property+"}"===t})[0];if(f?.formatterName==="format.unit"&&typeof f?.parameters[1].properties[0].value!=="number"){p=false}const y=i.some(function(e){return e.name===t});const m=s.some(e=>e.name===t);const P=c.some(function(e){return e.sourceProperty===t&&e.downDifference});const v=g.some(function(e){return e.sourceProperty===t&&e.targetUnit});e.setProperty("/configuration/advancedFormattingOptions/isFormatterApplied",p);e.setProperty("/configuration/advancedFormattingOptions/isFormatterEnabled",l||u);e.setProperty("/configuration/advancedFormattingOptions/isUOMApplied",y);e.setProperty("/configuration/advancedFormattingOptions/isCriticalityApplied",m);e.setProperty("/configuration/advancedFormattingOptions/isTrendApplied",P);e.setProperty("/configuration/advancedFormattingOptions/isIndicatorsApplied",v);const h=e.getProperty("/configuration/trendOptions");const O=e.getProperty("/configuration/indicatorsValue");if(h){const{referenceValue:t,downDifference:n,upDifference:o}=h;if(t&&n&&o){e.setProperty("/configuration/trendOptions/upDown",true)}}if(O){const{targetValue:t,deviationValue:n,targetUnit:o,deviationUnit:r}=O;if(t&&n&&o&&r){e.setProperty("/configuration/indicatorsValue/targetDeviation",true)}}}function ut(t,n,o){const r=t.getSource();const i=r.getSelectedKey()||"";const a=t.getParameter("newValue");let s=i!==""?`{${i}}`:a;const c=rt.dialog.getModel();if(o==="navSelection"){const t=c.getProperty("/configuration/navigationValue");s=t?`{${t}}`:""}if(!i&&o==="mainIndicator"){s=""}if(i!==""||s!==""){r.setValueState(w.None)}const g=n(s);const d=Y();const l=e(d,g);if(s===""&&o==="mainIndicator"){delete l["sap.card"].header.mainIndicator;delete l["sap.card"].header.sideIndicators}c.setProperty("/configuration/advancedFormattingOptions/sourceProperty",i);z(l,rt.dialog.getModel());et(rt.dialog.getModel())}function pt(t){const e=t=>({"sap.card":{header:{title:t}}});ft(t,"title");ut(t,e)}function ft(t,e){const n=t.getSource();const o=n.getSelectedKey();const r=t.getParameter("newValue");const i=rt.dialog.getModel();const a=i.getProperty("/configuration/errorControls");const s=rt.dialog.getModel("i18n").getResourceBundle();const c=t=>{switch(t){case"title":return s.getText("GENERATOR_CARD_TITLE");case"stateIndicator":return s.getText("GENERATOR_MAIN_INDICATOR");default:return s.getText("GENERATOR_GROUP_PROPERTY")}};const g=s.getText("GENERIC_ERR_MSG",[c(e??"")]);if(!o&&!r&&e==="title"){a?.push(n);n.setValueStateText(g)}else if(!o&&r){a?.push(n);n.setValueState(w.Error);n.setValueStateText(g)}else{a?.forEach((t,e)=>{if(n.getId()===t.getId()){a.splice(e,1)}});n.setValueState(w.None)}}function yt(t){const e=t=>{const e=rt.dialog.getModel();return{"sap.card":{header:{subTitle:Z(t,{unitOfMeasures:e.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),textArrangements:e.getProperty("/configuration/advancedFormattingOptions/textArrangements"),propertyValueFormatters:e.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")})}}}};ut(t,e)}function mt(t){const e=t=>{const e=rt.dialog.getModel();return{"sap.card":{header:{unitOfMeasurement:Z(t,{unitOfMeasures:e.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),textArrangements:e.getProperty("/configuration/advancedFormattingOptions/textArrangements"),propertyValueFormatters:e.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")})}}}};ut(t,e)}function Pt(t,e){if(t.name&&e[t.name]!==undefined&&e[t.name]!==null){const n=t?.value;n?.forEach(n=>{const o=e[t.name];if(o[n.name]!==undefined&&o[n.name]!==null){const t=o[n.name];const e=W(n,t);n.labelWithValue=e}else{n.labelWithValue=`${n.label} (<empty>)`}})}else{t.value=[]}}function vt(t){const e=rt.dialog.getModel();const n=t=>({"sap.card":{header:{mainIndicator:{number:Z(t,{unitOfMeasures:e.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),textArrangements:e.getProperty("/configuration/advancedFormattingOptions/textArrangements"),propertyValueFormatters:e.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")})}}}});const o=t.getSource();const r=o.getSelectedKey();const i=e.getProperty("/configuration/mainIndicatorStatusKey");St(r,i,e,"header");e.setProperty("/configuration/navigationValue",`${i}/${r}`);e.setProperty("/configuration/mainIndicatorNavigationSelectedKey",r);ut(t,n,"navSelection")}function ht(t,e){let o=true;const r=t.getProperty("/configuration/properties").find(t=>t.name===e)?.type;const i=t.getProperty("/configuration/$data")[e];if(r==="Edm.String"){o=!isNaN(Number(i))}const a=n.isPropertyTypeDate(r);const s=!(r==="Edm.Boolean"||r==="Edm.Guid"||a)&&o;const c=["Edm.Decimal","Edm.Int16","Edm.Int32","Edm.Double"].indexOf(r)>-1;t.setProperty("/configuration/advancedFormattingOptions/isUoMEnabled",s);t.setProperty("/configuration/advancedFormattingOptions/isTrendEnabled",c)}function Ot(t){const e=t.getSource();const o=e.getSelectedKey()||"";const r=rt.dialog.getModel();const i=e?.getBindingContext()?.getPath();const a=r.getProperty(i);const s=`{${a.name}/${o}}`;a.value=o&&Z(s,{unitOfMeasures:r.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),textArrangements:r.getProperty("/configuration/advancedFormattingOptions/textArrangements"),propertyValueFormatters:r.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")});St(o,a.name,r,"content");const c=n.getPropertyLabel(rt.appModel,rt.entitySet,a.name,nt.NavigationProperty);const g=c?.properties?.find(t=>t.name===o);const d=g?g.label:"";a.label=d;r.refresh();Q(r);et(rt.dialog.getModel())}function St(t,e,n,o){const r=o==="header"?n.getProperty("/configuration/selectedHeaderNavigation"):n.getProperty("/configuration/selectedContentNavigation");const i=r.findIndex(t=>t.name===e);if(i!==-1){const e=r[i];const n=e?.value?.includes(t)?e.value:[...e.value,t];r[i]={...e,value:n}}else{const n=e;r.push({name:n,value:[t]})}const a=o==="header"?"/configuration/selectedHeaderNavigation":"/configuration/selectedContentNavigation";n.setProperty(a,r)}function Mt(t){return rt.dialog.getModel("i18n").getObject(t)}function Ct(t){const e=rt.dialog.getModel();const n=t.getSource().getBindingContext().getPath();const o=e.getProperty(n);if(!o.items){o.items=[]}const r=e.getProperty(n).items.length;const i={label:null,value:`{/items/${r}}`,isEnabled:false,isNavigationEnabled:false,navigationalProperties:[]};e.getProperty(n).items.push(i);const a=e.getProperty(n).items.length;e.setProperty(n+"/enableAddMoreGroupItems",true);if(a===st){e.setProperty(n+"/enableAddMoreGroupItems",false)}e.refresh()}function Et(){let t=false;const e=rt.dialog.getModel();const n=e.getProperty("/configuration/errorControls");n?.forEach(e=>{if(!e.getValue()||e.getValueState()=="Error"){e.setValueState(w.Error);t=true}});return t}function Ft(t){const e=rt.dialog.getModel();const n=e.getProperty("/configuration/indicatorsValue");let o=false;const{targetValue:r,deviationValue:i,targetUnit:a,deviationUnit:s}=n;if(!r){e.setProperty("/configuration/indicatorsValue/targetValueState","Error");const n=t+"--targetInputValue";Vt(n,Mt("TARGET_VALUE_ERR_MSG"))}if(!i){e.setProperty("/configuration/indicatorsValue/deviationValueState","Error");const n=t+"--deviationInputValue";Vt(n,Mt("DEVIATION_VALUE_ERR_MSG"))}if(!a){e.setProperty("/configuration/indicatorsValue/targetUnitValueState","Error");const n=t+"--targetUnitInput";Vt(n,Mt("TARGET_UNIT_ERR_MSG"),true)}if(!s){e.setProperty("/configuration/indicatorsValue/deviationUnitValueState","Error");const n=t+"--deviationUnitInput";Vt(n,Mt("DEVIATION_UNIT_ERR_MSG"),true)}if(!r||!i||!a||!s){o=true}return o}function At(t){const e=rt.dialog.getModel();const n=e.getProperty("/configuration/trendOptions");let o=false;const{referenceValue:r,downDifference:i,upDifference:a}=n;if(!r){e.setProperty("/configuration/trendOptions/referenceValueState","Error");const n=t+"--trendReferenceValueInput";Vt(n,Mt("REF_ERR_MSG"))}if(!i){e.setProperty("/configuration/trendOptions/downDifferenceValueState","Error");const n=t+"--trendDownDifferenceInput";Vt(n,Mt("LOW_RANGE_ERR_MSG"))}if(!a){e.setProperty("/configuration/trendOptions/upDifferenceValueState","Error");const n=t+"--trendUpDifferenceInput";Vt(n,Mt("HIGH_RANGE_ERR_MSG"))}if(!r||!i||!a){o=true}return o}function Vt(t,e,n){const o=a?.getElementById(t);o.key=e;const r=n?!o?.getSelectedKey()||o.getValueState()=="Error":!o?.getValue()||o.getValueState()=="Error";if(r){const t=rt?.dialog?.getModel("i18n").getResourceBundle();const e=t?.getText("GENERIC_ERR_MSG",[o?.key]);o?.setValueStateText(e)}}function It(t){const e=rt.dialog.getModel();const n=e.getProperty("/configuration/groups").length;const o=rt?.dialog.getModel("i18n")?.getResourceBundle()?.getText("GENERATOR_DEFAULT_GROUP_NAME",[n+1]);e.getProperty("/configuration/groups").push({title:o,items:[{label:null,value:"{/items/0}",isEnabled:false,isNavigationEnabled:false,navigationalProperties:[]}],newItem:{label:null,value:null,isEnabled:false,isNavigationEnabled:false,navigationalProperties:[]}});const r=e.getProperty("/configuration/groups").length;if(r===at){e.setProperty("/configuration/groupLimitReached",true)}e.refresh();Q(e);et(rt.dialog.getModel())}function Tt(t){const e=rt.dialog.getModel();const n=t.getSource().getBindingContext().getPath();const o=n.split("/configuration/groups/")[1];e.getProperty("/configuration/groups").splice(o,1);const r=e.getProperty("/configuration/groups").length;if(r<at){e.setProperty("/configuration/groupLimitReached",false)}delete rt._itemActionsMenu;e.refresh();Q(e);et(rt.dialog.getModel())}function bt(t){const e=t.getParameters().newValue;const n=rt.dialog.getModel();const o=t.getSource().getBindingContext().getPath();const r=n.getProperty(o);r.title=e;n.refresh();Q(n);et(rt.dialog.getModel())}function xt(t){const e=rt.dialog.getModel();const n=t.getSource().getBindingContext().getPath();const[o,r]=n.match(/(\d+)/g).map(function(t){return Number(t)});e.getProperty("/configuration/groups/"+o).items.splice(r,1);const i=e.getProperty("/configuration/groups/"+o).items.length;if(i<st){e.setProperty("/configuration/groups/"+o+"/enableAddMoreGroupItems",true)}rt._itemActionsMenu?.destroy();delete rt._itemActionsMenu;e.refresh();Q(e);et(rt.dialog.getModel())}function Dt(){const t=rt.dialog.getModel();let n=t.getProperty("/configuration/trendOptions");const o=t.getProperty("/configuration/selectedTrendOptions");const r={"sap.card":{header:{mainIndicator:{trend:"None"}}}};let i=-1;o?.forEach((e,o)=>{if(e.sourceProperty===n.sourceProperty){i=o;n={...e,...n};t.setProperty("/configuration/trendOptions",n)}});const{referenceValue:a,downDifference:s,upDifference:c,sourceProperty:g}=n;if(a&&s&&c&&g){const t={referenceValue:a,downDifference:s,upDifference:c,sourceProperty:g};if(i!==-1){o[i]=t}else{o.push(t)}const e={referenceValue:Number(a),downDifference:Number(s),upDifference:Number(c)};r["sap.card"]["header"]["mainIndicator"]["trend"]=Nt(e)}const d=Y();const l=e(d,r);z(l,rt.dialog.getModel());et(rt.dialog.getModel())}function _t(){const t=rt.dialog.getModel();let n=t.getProperty("/configuration/indicatorsValue");const o=t.getProperty("/configuration/selectedIndicatorOptions");let r=-1;o?.forEach((e,o)=>{if(e.sourceProperty===n.sourceProperty){r=o;n={...e,...n};t.setProperty("/configuration/indicatorsValue",n)}});let i={"sap.card":{header:{sideIndicators:[{title:"",number:"",unit:""},{title:"",number:"",unit:""}]}}};const{targetValue:a,deviationValue:s,targetUnit:c,deviationUnit:g,sourceProperty:d}=n;if(a&&s&&c&&g&&d){const e={targetValue:a,deviationValue:s,targetUnit:c,deviationUnit:g,sourceProperty:d};if(r!==-1){o[r]=e}else{o.push(e)}t.setProperty("/configuration/indicatorsValue/targetDeviation",a);i={"sap.card":{header:{sideIndicators:[{title:"Target",number:a,unit:c},{title:"Deviation",number:s,unit:g}]}}}}const l=Y();const u=e(l,i);z(u,rt.dialog.getModel());t.refresh();et(rt.dialog.getModel())}function Nt(t){const e=rt.dialog.getModel();const n=e.getProperty("/configuration/mainIndicatorStatusKey");const o=e.getProperty("/configuration/trendOptions");const{referenceValue:r}=o;if(n&&t){e.setProperty("/configuration/trendOptions/upDown",r);return"{= extension.formatters.formatTrendIcon(${"+n+"},"+JSON.stringify(t)+") }"}return"None"}function Rt(t){const e=t.getParameters().newValue;const n=rt.dialog.getModel();const o=t.getSource().getBindingContext().getPath();const r=n.getProperty(o);r.label=e;n.refresh();Q(n);et(rt.dialog.getModel())}function Bt(t){const e=t.getParameter("draggedControl"),n=t.getParameter("droppedControl"),o=t.getParameter("dropPosition"),r=rt.dialog.getModel(),i=e.getParent(),a=n.getParent(),s=i.getBindingContext().getPath(),c=a.getBindingContext().getPath(),g=r.getProperty(s).items,d=r.getProperty(c).items,l=i.indexOfItem(e),u=a.indexOfItem(n);const p=g[l];if(o==="Before"&&d.length<st){g.splice(l,1);d.splice(u,0,p)}else if(o&&d.length<st){g.splice(l,1);d.splice(u+1,0,p)}if(g.length<st){r.setProperty(s+"/enableAddMoreGroupItems",true)}if(d.length===st){r.setProperty(c+"/enableAddMoreGroupItems",false)}r.refresh();Q(r);et(rt.dialog.getModel())}function wt(){const t=a.getElementById("cardGeneratorDialog--cardPreview");t.setWidth();t.setHeight();a.getElementById("cardGeneratorDialog--widthInput").setValue("");a.getElementById("cardGeneratorDialog--heightInput").setValue("");t.refresh()}function Ut(t){const e=a.getElementById("cardGeneratorDialog--cardPreview");const n=Number(t.getParameters().newValue);n>200?e.setHeight(n+"px"):e.setHeight("232px");e.refresh()}function Gt(t){const e=a.getElementById("cardGeneratorDialog--cardPreview");const n=Number(t.getParameters().newValue);n>200?e.setWidth(n+"px"):e.setWidth("582px");e.refresh()}function Kt(){const t=rt?.dialog?.getModel();const e=t.getProperty("/configuration/errorControls");e?.forEach(t=>{t.setValueState(w.None)});rt?.dialog?.close()}function Lt(t){const e=rt?.dialog?.getModel();const n=e?.getProperty("/configuration/mainIndicatorOptions/criticality");let o;const r=n?.filter(e=>e?.name===t);if(r){o=JSON.parse(JSON.stringify(r))}if(r?.length===1){o[0].hostCriticality=r[0].criticality;delete o.criticality;e?.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty",o)}else{e?.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty",[{name:t}])}}function $t(t){const e=t.getSource();const n=rt.dialog.getModel().getProperty("/configuration/mainIndicatorStatusKey");const o=rt?.dialog?.getModel();o?.setProperty("/configuration/advancedFormattingOptions/targetFormatterProperty",n);o?.setProperty("/configuration/advancedFormattingOptions/sourceUoMProperty",n);ht(o,n);Lt(n);lt(n);if(!rt._advancedFormattingOptionsPopover){s.load({id:"advancedFormattingOptions",name:"sap.cards.ap.generator.app.fragments.configuration.AdvancedFormattingOptions",controller:{onFormatTypeSelection:t=>{const n=t.getParameter("item");const o=rt.dialog.getModel();const r=n.getKey();o.setProperty("/configuration/popoverContentType",r);const i=o.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures");const a=o.getProperty("/configuration/advancedFormattingOptions/sourceUoMProperty");if(i.length>0){const t=i.filter(t=>t.name===a)[0];if(t){o.setProperty("/configuration/advancedFormattingOptions/targetProperty",t.value)}}if(it.indexOf(a)===-1){o.setProperty("/configuration/advancedFormattingOptions/targetProperty","")}kt(t,e)}}}).then(function(t){rt._advancedFormattingOptionsPopover=t;e.addDependent(t);return t}).then(function(t){const n=e.getBindingContext();t.setBindingContext(n);t.openBy(e)})}else{const t=e.getBindingContext();rt._advancedFormattingOptionsPopover.setBindingContext(t);rt._advancedFormattingOptionsPopover.openBy(e)}}function kt(t,e){const n=rt?.dialog?.getModel();const o={onPopoverClose:t=>{const e=t.getSource();e?.destroy()},onPropertyFormatterChange:()=>{zt();const t=e?.getId();const n=a.getElementById(t+"--advanceFormattingPopover");n?.close()},applyCriticality:()=>Ht(t),applyUoMFormatting:()=>jt(),applyFormatting:()=>{const t=e?.getId();a.getElementById(t+"--headerFormatterEditor").applyFormatter();et(rt.dialog.getModel())},resetValueState(t,e){const n=t.getSource();const o=!e?t.getParameters().newValue:n.getSelectedKey();if(o!==""){n.setValueState(w.None)}},onDownDifferenceChange(t){n.setProperty("/configuration/trendOptions/downDifferenceValueState","None");this.resetValueState(t)},onUpDifferenceChange(t){n.setProperty("/configuration/trendOptions/upDifferenceValueState","None");this.resetValueState(t)},onReferenceValInputChange(t){n.setProperty("/configuration/trendOptions/referenceValueState","None");this.resetValueState(t)},onTargetValueChange(t){n.setProperty("/configuration/indicatorsValue/targetValueState","None");this.resetValueState(t)},onDeviationValueChange(t){n.setProperty("/configuration/indicatorsValue/deviationValueState","None");this.resetValueState(t)},onTargetUnitChange(t){n.setProperty("/configuration/indicatorsValue/targetUnitValueState","None");this.resetValueState(t,true)},onDeviationUnitChange(t){n.setProperty("/configuration/indicatorsValue/deviationUnitValueState","None");this.resetValueState(t,true)},applyIndicators:()=>{const t=e?.getId();const n=Ft(t);if(!n){_t();rt?._advancedFormattingConfigurationPopover?.close()}},applyTrendCalculation:()=>{const t=e?.getId();const n=At(t);if(!n){Dt();rt?._advancedFormattingConfigurationPopover?.close()}},onDelete:()=>{const t=rt?.dialog?.getModel();const e=t?.getProperty("/configuration/advancedFormattingOptions/sourceUoMProperty");const n=it?.indexOf(e);it?.splice(n,1);t?.setProperty("/configuration/advancedFormattingOptions/targetProperty","");const o="/configuration/advancedFormattingOptions/unitOfMeasures",r=t?.getProperty(o);let i=-1;const a=t.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters");const s=a.filter(t=>t.property!==e);t.setProperty("/configuration/advancedFormattingOptions/propertyValueFormatters",s);for(let t=0;t<r.length;t++){if(r[t]?.name===e){i=t}}if(i>=0&&o){const e=o+"/"+i;r?.splice(e.slice(e.length-1),1);zt();t?.refresh()}rt?._advancedFormattingConfigurationPopover?.close()},onTrendDelete:()=>Wt(),onIndicatorsDelete:()=>{const t=rt?.dialog?.getModel();const e=t.getProperty("/configuration/indicatorsValue");const n=t.getProperty("/configuration/selectedIndicatorOptions");let o=-1;n?.forEach((t,n)=>{if(t.sourceProperty===e.sourceProperty){o=n}});if(o!==-1){n.splice(o,1)}t.setProperty("/configuration/indicatorsValue",{});_t();rt?._advancedFormattingConfigurationPopover?.close()},onDeleteFormatter:()=>{const t=e?.getId();a.getElementById(t+"--headerFormatterEditor").deleteFormatter();et(rt.dialog.getModel())},onDeleteCriticality:()=>{const t=rt.dialog.getModel();const n=e?.getId();a.getElementById(n+"--headerCriticalityEditor")._onDeleteButtonClicked();t.setProperty("/configuration/advancedFormattingOptions/selectedKeyCriticality","");Qt(false);rt?._advancedFormattingConfigurationPopover?.close()}};if(t?.getParameter("item")?.getKey?.()==="uom"){o.applyUoMFormatting()}if(t.getSource()?.getParent()?.close){t.getSource().getParent().close()}Xt(e,o)}function Ht(t){const e=rt?.dialog?.getModel();const n=e?.getProperty("/configuration/mainIndicatorOptions/criticality");let o=e?.getProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty");o=o?.[0];if(o?.hostCriticality!==o?.criticality){o.criticality=o.hostCriticality}const r=n?.some(t=>t?.name===o?.name);if(!r&&o){delete o.hostCriticality;n?.push(o)}else{for(let t=0;t<n.length;t++){if(n[t]?.name===o?.name){delete n[t];delete o.hostCriticality;n[t]=o}}}e?.setProperty("/configuration/mainIndicatorOptions/criticality",n);Qt(t.getParameter("isCalcuationType")||false);rt?._advancedFormattingConfigurationPopover?.close()}function jt(){const t=rt?.dialog?.getModel();const e=t?.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),n=t.getProperty("/configuration/advancedFormattingOptions/sourceUoMProperty");let o=e?.filter(t=>t?.name===n),r=t?.getProperty("/configuration/advancedFormattingOptions/targetProperty");o=o?.[0];if(!r&&o){t?.setProperty("/configuration/advancedFormattingOptions/targetProperty",o?.propertyKeyForDescription)}r=t?.getProperty("/configuration/advancedFormattingOptions/targetProperty");const i={propertyKeyForDescription:r,name:n,propertyKeyForId:n,value:r};let a=false;e.forEach(t=>{if(t.name===i.name){a=true;t.propertyKeyForDescription=i.value;t.value=i.value}});if(!a&&n&&r){e.push(i)}t.setProperty("/configuration/advancedFormattingOptions/unitOfMeasures",e);zt();for(let t=0;t<e.length;t++){if(e[t].value!==""&&it?.indexOf(e[t]?.name)===-1){it?.push(e[t]?.name)}}rt?._advancedFormattingConfigurationPopover?.close()}function Wt(){const t=rt?.dialog?.getModel();const e=t.getProperty("/configuration/trendOptions");const n=t.getProperty("/configuration/selectedTrendOptions");let o=-1;n?.forEach((t,n)=>{if(t.sourceProperty===e.sourceProperty){o=n}});if(o!==-1){n.splice(o,1)}t.setProperty("/configuration/trendOptions",{});Dt();rt?._advancedFormattingConfigurationPopover?.close()}function Xt(t,e){s.load({id:t.getId(),name:"sap.cards.ap.generator.app.fragments.configuration.AdvancedFormattingConfiguration",controller:e}).then(function(e){rt._advancedFormattingConfigurationPopover=e;const n=rt.dialog.getModel();const o=n.getProperty("/configuration/mainIndicatorStatusUnit");const r=rt.dialog.getModel("i18n").getResourceBundle();let i,a,s;if(t.getBindingContext()){const e=t.getBindingContext().sPath;const o=n.getProperty(e)?.label;const c=n.getProperty("/configuration/properties");const g=c?.filter(t=>t.label===o)[0].labelWithValue||o;i=r.getText("SELECT_UOM_TEXT",[g]);a=r.getText("SELECT_FORMATTER_TEXT",[g]);s=r.getText("SELECT_CRITICALITY_TEXT",[g])}else{i=r.getText("SELECT_UOM_TEXT",[o]);a=r.getText("SELECT_FORMATTER_TEXT",[o]);s=r.getText("SELECT_CRITICALITY_TEXT",[o])}const c=r.getText("SELECT_INDICATORS_TEXT",[o]);const g=r.getText("TREND_CALCULATION_TEXT",[o]);const d={uomText:i,criticalityText:s,formatterText:a,indicatorsText:c,trendCalculatorText:g};e.setModel(new l(d),"i18nLabelText");t.addDependent(e);return e}).then(function(e){const n=t.getBindingContext();e.setBindingContext(n);e.openBy(t);return e})}function Jt(t){const e=rt?.dialog?.getModel();const n=t?.getSource().getBindingContext().getPath();const o=e?.getProperty(n)?.name;const r=t.getSource();ht(e,o);lt(o);const i={onNavigationActionSelect:t=>{const e=t.getParameter("item").getId();const n=rt.dialog.getModel();if(e==="formatter"||e==="uom"){n.setProperty("/configuration/popoverContentType",e);const o=t.getSource().getBindingContext().getPath();n.setProperty("/configuration/advancedFormattingOptions/targetFormatterProperty",n.getProperty(o).name);n.setProperty("/configuration/advancedFormattingOptions/sourceUoMProperty",n.getProperty(o).name);const r=n.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures");const i=n.getProperty("/configuration/advancedFormattingOptions/sourceUoMProperty");if(r.length>0){const t=r.filter(t=>t.name===i)[0];if(t){n.setProperty("/configuration/advancedFormattingOptions/targetProperty",t.value)}}if(it.length&&it.indexOf(i)===-1){n.setProperty("/configuration/advancedFormattingOptions/targetProperty","")}kt(t,t.getSource().getParent())}else if(e==="criticality"){n.setProperty("/configuration/popoverContentType",e);const o=t.getSource().getBindingContext().getPath();if(n.getProperty(o)?.name){Lt(n.getProperty(o).name)}kt(t,t.getSource().getParent())}else if(e==="actions"){}else{const e=t.getParameter("item");const o=e.getCustomData();const r=o.filter(t=>t.getKey()==="action")[0];const i=r.getValue();const a=t.getSource();const s=a.getBindingContext().getPath();const[c,g]=s.match(/(\d+)/g).map(t=>Number(t));const d=n.getProperty("/configuration/groups/"+c);const l=d.items[g];if(i==="add"){let t="";const n=e.getId();switch(n){case"url":t=`${l.value}`;break;case"email":t=`mailto: ${l.value}`;break;case"tel":t=`tel: ${l.value}`;break;default:break}if(t===""){return}const o=[{type:"Navigation",parameters:{url:t}}];l["hasActions"]=true;l["actionType"]=n;l["actions"]=o}if(i==="remove"&&l.hasActions){delete l.hasActions;delete l.actionType;delete l.actions}}n.refresh();Q(n);et(rt.dialog.getModel())}};if(!rt._itemActionsMenu||rt?._itemActionsMenu?.isDestroyed()){s.load({name:"sap.cards.ap.generator.app.fragments.configuration.ItemActions",controller:i}).then(function(t){rt._itemActionsMenu=t;const e=r.getBindingContext();t.setBindingContext(e);r.addDependent(t);rt._itemActionsMenu.open(false,r,c.Dock.BeginTop,c.Dock.BeginBottom,r)}.bind(i))}else{const t=r.getBindingContext();rt._itemActionsMenu.setBindingContext(t);r.addDependent(rt._itemActionsMenu);rt._itemActionsMenu.open(false,r,c.Dock.BeginTop,c.Dock.BeginBottom,r)}}function qt(t){const e=t.getSource().getSelectedItem().getBindingContext("previewOptions").getProperty("type");const n=a.getElementById("cardGeneratorDialog--cardPreview");const o=a.getElementById("cardGeneratorDialog--adaptiveCardPreviewContainer");const r=a.getElementById("cardGeneratorDialog--custom-entry");n.setVisible(false);o.setVisible(false);r.setVisible(false);switch(e){case"adaptive":o.setVisible(true);setTimeout(()=>{et(rt.dialog.getModel())},0);break;case"custom":n.setVisible(true);r.setVisible(true);break;case"integration":n.setVisible(true);n.setWidth(t.getSource().getSelectedItem().getBindingContext("previewOptions").getProperty("width"));n.setHeight(t.getSource().getSelectedItem().getBindingContext("previewOptions").getProperty("height"));break;default:n.setVisible(true);n.setWidth(t.getSource().getSelectedItem().getBindingContext("previewOptions").getProperty("width"));n.setHeight(t.getSource().getSelectedItem().getBindingContext("previewOptions").getProperty("height"));break}}function Yt(){const t=rt.dialog.getModel();const n=Y();const o=n["sap.card"].header;const r=tt(o.subTitle,n);const i=tt(o.unitOfMeasurement,n);const a=t.getProperty("/configuration/navigationValue")||t.getProperty("/configuration/mainIndicatorStatusKey");const s=t.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures");const c=t.getProperty("/configuration/advancedFormattingOptions/textArrangements");const g=t.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters");const d={"sap.card":{header:{mainIndicator:{number:a&&Z(`{${a}}`,{unitOfMeasures:s,textArrangements:c,propertyValueFormatters:g})},subTitle:Z(r,{unitOfMeasures:s,textArrangements:c,propertyValueFormatters:g}),unitOfMeasurement:Z(i,{unitOfMeasures:s,textArrangements:c,propertyValueFormatters:g})}}};const l=e(n,d);z(l,rt.dialog.getModel())}function zt(){const t=rt.dialog.getModel();Yt();const e=t.getProperty("/configuration/groups");e?.forEach(function(e){e?.items?.forEach(e=>{if(e.name&&e.name!==""){const n=e.isNavigationEnabled?`${e.name}/${e.navigationProperty}`:e.name;e.value=Z(`{${n}}`,{unitOfMeasures:t.getProperty("/configuration/advancedFormattingOptions/unitOfMeasures"),textArrangements:t.getProperty("/configuration/advancedFormattingOptions/textArrangements"),propertyValueFormatters:t.getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters")})}})});t.refresh();Q(t);et(rt.dialog.getModel())}function Qt(t){const n=Y();const o=rt.dialog.getModel();const r=n["sap.card"].header.mainIndicator;const i=n["sap.card"].content.groups;if(!r&&i.length<1){return}let a;if(r){const o=tt(r.number,n);const i={"sap.card":{header:{mainIndicator:{state:dt(o||r.number,t)}}}};a=e(n,i)}else{a=n}z(a,rt.dialog.getModel());Q(o);et(rt.dialog.getModel())}var Zt={__esModule:true};Zt.CardGeneratorDialogController=gt;Zt.getCriticality=dt;return Zt});
//# sourceMappingURL=CardGeneratorDialogController.js.map