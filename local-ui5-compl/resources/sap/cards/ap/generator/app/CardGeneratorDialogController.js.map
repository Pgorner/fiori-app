{"version":3,"file":"CardGeneratorDialogController.js","names":["sap","ui","define","Log","merge","ODataUtils","sap_cards_ap_transpiler_cardTranspiler_Transpile","MessageBox","MessageToast","CoreElement","Fragment","Popup","sap_ui_core_library","Filter","JSONModel","jQuery","___config_PreviewOptions","___helpers_ApplicationInfo","___helpers_Batch","___helpers_FooterActions","___helpers_Formatter","___helpers_I18nHelper","___helpers_IntegrationCardHelper","___helpers_PropertyExpression","___helpers_Transpiler","___odata_ODataTypes","___utils_CommonUtils","_iteratorSymbol","Symbol","iterator","_settle","pact","state","value","s","_Pact","v","o","bind","then","observer","prototype","onFulfilled","onRejected","result","this","callback","e","_this","_isSettledPact","thenable","_forTo","array","body","check","i","reject","_cycle","length","toggleAdvancedSetting","toggleEvent","toggleButton","getSource","setEnabled","splitter","getElementById","controller","onCriticalityChange","criticalityChangeEvent","updateCriticality","getParameter","onArrangementsChange","arrangementChangeEvent","Promise","resolve","checkForNavigationProperty","updateArrangements","dialogModel","context","dialog","getModel","groups","getProperty","items","item","uom","split","slice","undefined","setProperty","aPropsWithUoM","indexOf","name","push","onPropertyFormatterChangeFromAdvancedSettings","updateHeaderArrangements","load","advancedSettings","getPressed","lastContentArea","getContentAreas","removeContentArea","insertContentArea","setTimeout","transpileIntegrationCardToAdaptive","_forOf","target","step","next","done","return","_fixup","TypeError","values","event","selectedParameters","getParameters","selectedItem","model","navigationProperties","selectedNavigationalProperties","existingIndex","findIndex","navItem","selectedProperty","find","prop","selectedPropertyName","properties","selectedPropertyValues","data","_temp5","updateCardConfigurationData","textArrangementChanged","navigationalPropertiesForId","isNavigationForId","navigationKeyForId","navigationalPropertiesForDescription","isNavigationForDescription","navigationKeyForDescription","onPropertySelection","oEvent","control","selectedKey","getSelectedKey","newValue","currentValue","oModel","validateContol","updateSelectedNavigationProperty","selectedNavigationPropertiesContent","sPath","getBindingContext","getPath","group","getArrangements","unitOfMeasures","textArrangements","propertyValueFormatters","navigationProperty","navigationalProperties","propertyLabel","getPropertyLabel","appModel","entitySet","PropertyInfoType","Property","label","isEnabled","isNavigationEnabled","refresh","updateCardGroups","okPressed","hasError","validateHeader","oCard","mManifest","getManifest","enhanceManifestWithInsights","rootComponent","enhanceManifestWithConfigurationParameters","createAndStoreGeneratedi18nKeys","updateManifestWithSelectQueryParams","keyParameters","appIntent","oAdaptiveCardManifest","convertIntegrationCardToAdaptive","configuration","parameters","contextParameters","payload","floorplan","localPath","fileName","manifests","type","manifest","default","ajax","url","headers","JSON","stringify","success","show","getTranslatedText","error","jqXHR","textStatus","errorThrown","errorMessage","status","statusText","close","isHeader","_temp4","onStateIndicatorSelection","getHeaderConfiguration","header","mainIndicator","getCriticality","number","selectedNavigationPropertyHeader","selectedValue","dataType","isDateType","isPropertyTypeDate","isNumberType","updateTrendForCardHeader","updateSideIndicatorsForHeader","updateCardHeader","selectedNavigationProperty","entitySetWithObjectContext","ApplicationInfo","getInstance","fetchDetails","serviceUrl","oDataV4","$data","queryParameters","map","property","fetchDataAsync","createUrlParameters","addLabelsForProperties","ValueState","PREVIEW_OPTIONS","addActionToCardManifest","removeActionFromManifest","resetCardActions","updateCardManifestAction","formatPropertyDropdownValues","getCurrentCardManifest","renderCardPreview","resolvePropertyPathFromExpression","isBinding","MAX_GROUPS","MAX_GROUP_ITEMS","cardActionHandlers","onActionAddClick","addedActions","title","titleKey","style","enablePathKey","isStyleControlEnabled","isConfirmationRequired","onAddedActionDelete","actionIndex","Number","deletedAction","splice","validateSelectedAction","annotationActions","some","annotationAction","getValue","action","updateRelativeproperties","addedAction","relatedAnnotationAction","filter","enabledPath","enablePath","replace","filterCardActions","comboBox","itemsBinding","getBinding","actionToFilter","loadActions","controlEvent","isSuspended","resume","addEventDelegate","onBeforeRendering","onAddedActionTitleChange","path","_temp3","setValueState","None","_temp2","_temp","Error","setValueStateText","errorControls","focus","onAddedActionStyleChange","CardGeneratorDialogController","initialize","setModel","oModelDialog","cancelPressed","closeDialog","onAddClick","onGroupAddClick","onGroupDeleteClick","onDeleteClick","updateContentNavigationSelection","onPropertyLabelChange","onTitleSelection","onSubTitleSelection","onGroupTitleChange","onDrop","onHeaderUOMSelection","updateHeaderNavigationSelection","onHeightChange","onWidthChange","onResetPressed","onItemsActionsButtonPressed","onPreviewTypeChange","onPropertyFormatting","_updateTrendForCardHeader","_updateSideIndicatorsForHeader","_setAdvancedFormattingOptionsEnablement","setAdvancedFormattingOptionsEnablement","_updateHeaderArrangements","_updateArrangements","_updateCriticality","_validateHeader","applyCriticality","applyUoMFormatting","onTrendDelete","loadAdvancedFormattingConfigurationFragment","disableOrEnableUOMAndTrend","sPropertyName","isCalcuationType","aMainIndicatorCriticality","oMatchedCriticality","oCriticality","criticality","activeCalculation","staticValues","deviationLow","deviationRangeLowValue","deviationHigh","deviationRangeHighValue","toleranceLow","toleranceRangeLowValue","toleranceHigh","toleranceRangeHighValue","sImprovementDirection","improvementDirection","oCriticalityConfigValues","Negative","Critical","Positive","sourceProperty","mainIndicatorProperty","unitsOfMeasure","mainIndicatorCriticality","selectedTrendOptions","selectedIndicatorOptions","isFormatterApplied","formatterDetail","formatterApplied","formatterName","isUOMApplied","arrangementDetail","isCriticalityApplied","indicatorCriticality","isTrendApplied","trendDetail","downDifference","isIndicatorsApplied","indicatorDetail","targetUnit","trendOptions","indicatorsValue","referenceValue","upDifference","targetValue","deviationValue","deviationUnit","fnGetHeaderConfig","key","navigationValue","sapCardHeader","currentManifest","oManifest","sideIndicators","controlName","resourceBundle","getResourceBundle","getKey","getText","controlErrorText","forEach","errorControl","index","getId","subTitle","unitOfMeasurement","propVal","ele","propertyValue","labelWithValue","updateSelectedNavigation","typeSupported","propertyType","isNaN","isUoMEnabled","navProperty","NavigationProperty","oProperty","source","selectedNavigation","existingItem","navValues","includes","propertyPath","sKey","getObject","nextItemNumber","newItem","iItemsAdded","getValueState","validateIndicatorsValues","buttonId","targetInputId","setValueStateTextForControl","deviationInputId","targetUnitInputId","deviationUnitInputId","validateTrendValues","trendValues","referenceInputId","trendDownDifferenceInputId","trendUpDifferenceInputId","controlId","isSelectControl","elementControl","validateControl","validationText","iLength","currentDefaultValue","groupLength","groupIndex","_itemActionsMenu","itemIndex","match","sValue","destroy","trend","selectedTrendOptionIndex","selectedTrendOption","newTrendValues","getTrendDirection","selectedIndicatorOptionIndex","selectedIndicatorOption","unit","indicatorsValueToAdd","mainIndicatorKey","oDragged","oDropped","sInsertPosition","oDragPos","getParent","oDropPos","sDraggedPath","sDroppedPath","aDragItems","aDropItems","iDragPosition","indexOfItem","iDropPosition","oSelectedItem","setWidth","setHeight","setValue","setCriticalitySourceProperty","sProperty","relavantCriticality","relavantProperty","parse","hostCriticality","oSource","_advancedFormattingOptionsPopover","id","onFormatTypeSelection","sourceItem","aUom","sSourceUoMProperty","aSourceUom","onAdvancedFormattingConfigOpen","oPopover","addDependent","oContext","setBindingContext","openBy","oConfigurationController","onPopoverClose","onPropertyFormatterChange","applyFormatting","applyFormatter","resetValueState","onDownDifferenceChange","onUpDifferenceChange","onReferenceValInputChange","onTargetValueChange","onDeviationValueChange","onTargetUnitChange","onDeviationUnitChange","applyIndicators","hasIndicatorsError","_advancedFormattingConfigurationPopover","applyTrendCalculation","hasTrendError","onDelete","sourceUoMProperty","iIndex","itemsBindingPath","relativeIndex","updatedPropertyValueFormatters","formatter","onIndicatorsDelete","selectedIndicatorValues","onDeleteFormatter","deleteFormatter","onDeleteCriticality","_onDeleteButtonClicked","sourceCriticalityProperty","propertyExists","targetProperty","propertyKeyForDescription","oData","propertyKeyForId","bMatchingProperty","oUom","selectedTrendValues","mainIndicatorUnitText","oResourceBundle","sUomText","sFormatterText","criticalityText","sSelectedGroupItemPath","sSelectedGroupProperty","sProperties","propertyLabelWithValue","sIndicatorsText","sTrendCalculatorText","mLabels","uomText","formatterText","indicatorsText","trendCalculatorText","oController","onNavigationActionSelect","sId","customData","getCustomData","customAction","custom","actionType","actions","hasActions","isDestroyed","oMenu","open","Dock","BeginTop","BeginBottom","selectedCardType","getSelectedItem","oAdaptiveCardContainer","oCustomSize","setVisible","subtitle","mainIndicatorValue","aUnitOfMeasures","aTextArrangements","aPropertyValueFormatters","groupItem","groupItemValue","content","__exports","__esModule"],"sources":["CardGeneratorDialogController.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport Log from \"sap/base/Log\";\nimport merge from \"sap/base/util/merge\";\nimport * as ODataUtils from \"sap/cards/ap/generator/odata/ODataUtils\";\nimport { convertIntegrationCardToAdaptive } from \"sap/cards/ap/transpiler/cardTranspiler/Transpile\";\nimport type ComboBox from \"sap/m/ComboBox\";\nimport MessageBox from \"sap/m/MessageBox\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport type Event from \"sap/ui/base/Event\";\nimport type EventProvider from \"sap/ui/base/EventProvider\";\nimport CoreElement from \"sap/ui/core/Element\";\nimport Fragment from \"sap/ui/core/Fragment\";\nimport Popup from \"sap/ui/core/Popup\";\nimport { ValueState } from \"sap/ui/core/library\";\nimport type { CardManifest, ObjectContent } from \"sap/ui/integration/widgets/Card\";\nimport Card from \"sap/ui/integration/widgets/Card\";\nimport Filter from \"sap/ui/model/Filter\";\nimport ListBinding from \"sap/ui/model/ListBinding\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport jQuery from \"sap/ui/thirdparty/jquery\";\nimport { PREVIEW_OPTIONS } from \"../config/PreviewOptions\";\nimport { ApplicationInfo } from \"../helpers/ApplicationInfo\";\nimport { QueryParameters, createUrlParameters, updateManifestWithSelectQueryParams } from \"../helpers/Batch\";\nimport type {\n\tGroupItem,\n\tNavigationParameter,\n\tNavigationalData,\n\tObjectCardGroups,\n\tSideIndicatorOptions,\n\tTrendOptions,\n\tTrendOrIndicatorOptions\n} from \"../helpers/CardGeneratorModel\";\nimport { addActionToCardManifest, removeActionFromManifest, resetCardActions, updateCardManifestAction } from \"../helpers/FooterActions\";\nimport { formatPropertyDropdownValues, type FormatterConfigurationMap } from \"../helpers/Formatter\";\nimport { createAndStoreGeneratedi18nKeys } from \"../helpers/I18nHelper\";\nimport {\n\tenhanceManifestWithConfigurationParameters,\n\tenhanceManifestWithInsights,\n\tgetCurrentCardManifest,\n\trenderCardPreview,\n\tupdateCardGroups\n} from \"../helpers/IntegrationCardHelper\";\nimport { getArrangements, resolvePropertyPathFromExpression } from \"../helpers/PropertyExpression\";\nimport { transpileIntegrationCardToAdaptive } from \"../helpers/Transpiler\";\nimport { PropertyInfo, PropertyInfoMap, PropertyInfoType } from \"../odata/ODataTypes\";\nimport type { AnnotationAction, ControlProperties } from \"../types/ActionTypes\";\nimport { isBinding } from \"../utils/CommonUtils\";\nimport { ArrangementOptions } from \"./controls/ArrangementsEditor\";\nimport ToggleButton from \"sap/m/ToggleButton\";\nimport Control from \"sap/ui/core/Control\";\nimport Splitter from \"sap/ui/layout/Splitter\";\n\ntype UnitOfMeasures = {\n\tpropertyKeyForDescription: string;\n\tname: string;\n\tpropertyKeyForId: string;\n\tvalue: string;\n};\ntype ValueFormatter = {\n\tproperty: string;\n};\ntype Criticality = {\n\tcriticality: string;\n\tname: string;\n};\n\ntype Property = {\n\tname: string;\n};\ntype EventParameters = {\n\tselectedItem: ArrangementOptions;\n\ttextArrangementChanged: boolean;\n};\n\nconst context: any = {};\nconst aPropsWithUoM: any = [];\nconst MAX_GROUPS = 5;\nconst MAX_GROUP_ITEMS = 5;\n\nconst cardActionHandlers = {\n\tonActionAddClick: function () {\n\t\tconst oModel = context.dialog.getModel();\n\t\tconst addedActions: Array<ControlProperties> = oModel.getProperty(\"/configuration/actions/addedActions\");\n\n\t\tif (addedActions.length < 2) {\n\t\t\taddedActions.push({\n\t\t\t\ttitle: \"\",\n\t\t\t\ttitleKey: \"\",\n\t\t\t\tstyle: \"Default\",\n\t\t\t\tenablePathKey: \"\",\n\t\t\t\tisStyleControlEnabled: false,\n\t\t\t\tisConfirmationRequired: false\n\t\t\t});\n\t\t\toModel.setProperty(\"/configuration/actions/addedActions\", addedActions);\n\t\t}\n\t\toModel.setProperty(\"/configuration/actions/isAddActionEnabled\", addedActions.length < 2);\n\t},\n\tonAddedActionDelete: function (oEvent: Event) {\n\t\tconst oModel = context.dialog.getModel();\n\t\tconst control: ComboBox = oEvent?.getSource();\n\t\tconst sPath = control?.getBindingContext()?.getPath();\n\t\tconst actionIndex = Number(sPath?.split(\"/configuration/actions/addedActions/\")[1]);\n\t\tconst addedActions: Array<ControlProperties> = oModel.getProperty(\"/configuration/actions/addedActions\");\n\t\tconst deletedAction = actionIndex !== undefined ? addedActions.splice(actionIndex, 1) : [];\n\t\toModel.setProperty(\"/configuration/actions/addedActions\", addedActions);\n\t\toModel.setProperty(\"/configuration/actions/isAddActionEnabled\", addedActions.length < 2);\n\t\tconst manifest = getCurrentCardManifest();\n\t\tremoveActionFromManifest(manifest, deletedAction[0]);\n\t\trenderCardPreview(manifest, context.dialog.getModel());\n\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t},\n\tvalidateSelectedAction: function (control: ComboBox) {\n\t\tconst oModel = context.dialog.getModel();\n\t\tconst annotationActions: Array<AnnotationAction> = oModel.getProperty(\"/configuration/actions/annotationActions\");\n\t\treturn annotationActions.some((annotationAction) => {\n\t\t\treturn annotationAction.label === control.getValue() && annotationAction.action === control.getSelectedKey();\n\t\t});\n\t},\n\tupdateRelativeproperties: function (addedAction: ControlProperties, sPath: string) {\n\t\tconst oModel = context.dialog.getModel();\n\t\tconst annotationActions: Array<AnnotationAction> = oModel.getProperty(\"/configuration/actions/annotationActions\");\n\t\tconst relatedAnnotationAction = annotationActions.filter((annotationAction) => {\n\t\t\treturn annotationAction.label === addedAction.title && annotationAction.action === addedAction.titleKey;\n\t\t});\n\n\t\tif (relatedAnnotationAction.length) {\n\t\t\tlet enabledPath = relatedAnnotationAction[0].enablePath;\n\t\t\tenabledPath = enabledPath?.indexOf(\"_it/\") > -1 ? enabledPath?.replace(\"_it/\", \"\") : enabledPath; // Remove instance of _it/ from the path\n\t\t\tconst isConfirmationRequired = relatedAnnotationAction[0].isConfirmationRequired;\n\t\t\tif (enabledPath) {\n\t\t\t\taddedAction.enablePathKey = enabledPath;\n\t\t\t}\n\n\t\t\tif (isConfirmationRequired) {\n\t\t\t\taddedAction.isConfirmationRequired = isConfirmationRequired;\n\t\t\t}\n\t\t}\n\t\tif (sPath) {\n\t\t\toModel.setProperty(sPath, addedAction);\n\t\t}\n\t},\n\n\tfilterCardActions: function (comboBox: ComboBox) {\n\t\tconst dialogModel = context.dialog.getModel();\n\t\tconst addedActions: ControlProperties[] = dialogModel.getProperty(\"/configuration/actions/addedActions\");\n\t\tconst itemsBinding = comboBox.getBinding(\"items\");\n\t\tconst titleKey = comboBox.getSelectedKey();\n\t\tconst actionToFilter = addedActions.filter((addedAction) => addedAction.titleKey !== titleKey);\n\t\tconst filter = actionToFilter.length ? new Filter(\"action\", \"NE\", actionToFilter[0].titleKey) : [];\n\t\t(itemsBinding as ListBinding).filter(filter);\n\t},\n\n\tloadActions: function (controlEvent: Event) {\n\t\tconst comboBox: ComboBox = controlEvent.getSource();\n\t\tconst itemsBinding = comboBox.getBinding(\"items\");\n\n\t\tif (itemsBinding?.isSuspended()) {\n\t\t\titemsBinding.refresh(true);\n\t\t\titemsBinding.resume();\n\t\t}\n\n\t\tcomboBox.addEventDelegate({\n\t\t\tonBeforeRendering: this.filterCardActions.bind(null, comboBox)\n\t\t});\n\t},\n\n\tonAddedActionTitleChange: async function (oEvent: Event) {\n\t\tconst oModel = context.dialog.getModel();\n\t\tconst control: ComboBox = oEvent.getSource();\n\t\tconst path = control?.getBindingContext()?.getPath();\n\n\t\tif (this.validateSelectedAction(control)) {\n\t\t\tconst addedAction: ControlProperties = oModel.getProperty(path);\n\t\t\taddedAction.titleKey = control.getSelectedKey();\n\t\t\taddedAction.title = control.getValue();\n\t\t\taddedAction.isStyleControlEnabled = true;\n\t\t\tthis.updateRelativeproperties(addedAction, path || \"\");\n\t\t\tcontrol.setValueState(ValueState.None);\n\t\t\tconst manifest = getCurrentCardManifest();\n\n\t\t\tresetCardActions(manifest);\n\t\t\tconst addedActions: ControlProperties[] = oModel.getProperty(\"/configuration/actions/addedActions\");\n\t\t\tfor (const action of addedActions) {\n\t\t\t\tif (action.titleKey) {\n\t\t\t\t\tawait addActionToCardManifest(manifest, action, context);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trenderCardPreview(manifest, context.dialog.getModel());\n\t\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t\t} else {\n\t\t\tcontrol.setValueState(ValueState.Error);\n\t\t\tcontrol.setValueStateText(getTranslatedText(\"GENERATOR_ACTION_ERROR_TEXT\"));\n\t\t\tconst errorControls = oModel.getProperty(\"/configuration/errorControls\");\n\t\t\terrorControls?.push(control);\n\t\t\tcontrol.focus();\n\t\t}\n\t},\n\n\tonAddedActionStyleChange: function (oEvent: Event) {\n\t\tconst oModel = context.dialog.getModel();\n\t\tconst control: ComboBox = oEvent.getSource();\n\t\tconst sPath = control?.getBindingContext()?.getPath();\n\t\tconst addedAction: ControlProperties = oModel.getProperty(sPath);\n\t\taddedAction.style = control.getSelectedKey();\n\t\toModel.setProperty(sPath, addedAction);\n\t\tconst manifest = getCurrentCardManifest();\n\t\tupdateCardManifestAction(manifest, addedAction);\n\t\trenderCardPreview(manifest, context.dialog.getModel());\n\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t}\n};\n\nexport const CardGeneratorDialogController = {\n\tinitialize: function (rootComponent: any, control: any, entitySet: string) {\n\t\tcontext.rootComponent = rootComponent;\n\t\tcontext.appModel = rootComponent.getModel();\n\t\tcontext.dialog = control;\n\t\tcontext.entitySet = entitySet;\n\t\tconst oModel = new JSONModel(PREVIEW_OPTIONS);\n\t\tcontext?.dialog?.setModel(oModel, \"previewOptions\");\n\t\tconst oModelDialog = context.dialog.getModel();\n\t\tupdateCardGroups(oModelDialog);\n\t},\n\tokPressed,\n\tcancelPressed: closeDialog,\n\tonAddClick,\n\tonGroupAddClick,\n\tonGroupDeleteClick,\n\tonDeleteClick,\n\tonPropertySelection,\n\tupdateContentNavigationSelection,\n\tonPropertyLabelChange,\n\tonTitleSelection,\n\tonSubTitleSelection,\n\tonGroupTitleChange,\n\tvalidateContol,\n\tonDrop,\n\tonHeaderUOMSelection,\n\tonStateIndicatorSelection,\n\tupdateHeaderNavigationSelection,\n\tonHeightChange,\n\tonWidthChange,\n\tonResetPressed,\n\tonItemsActionsButtonPressed,\n\tonPreviewTypeChange,\n\ttoggleAdvancedSetting,\n\tgetTranslatedText,\n\tonPropertyFormatting,\n\tonActionAddClick: cardActionHandlers.onActionAddClick,\n\tonAddedActionDelete: cardActionHandlers.onAddedActionDelete,\n\tonAddedActionStyleChange: cardActionHandlers.onAddedActionStyleChange,\n\tonAddedActionTitleChange: cardActionHandlers.onAddedActionTitleChange,\n\tvalidateSelectedAction: cardActionHandlers.validateSelectedAction,\n\tupdateRelativeproperties: cardActionHandlers.updateRelativeproperties,\n\tloadActions: cardActionHandlers.loadActions,\n\tfilterCardActions: cardActionHandlers.filterCardActions,\n\t/* Methods exposed for testing */\n\t_updateTrendForCardHeader: updateTrendForCardHeader,\n\t_updateSideIndicatorsForHeader: updateSideIndicatorsForHeader,\n\t_setAdvancedFormattingOptionsEnablement: setAdvancedFormattingOptionsEnablement,\n\t_updateHeaderArrangements: updateHeaderArrangements,\n\t_updateArrangements: updateArrangements,\n\t_updateCriticality: updateCriticality,\n\t_validateHeader: validateHeader,\n\tapplyCriticality: applyCriticality,\n\tapplyUoMFormatting: applyUoMFormatting,\n\tonTrendDelete: onTrendDelete,\n\tloadAdvancedFormattingConfigurationFragment: loadAdvancedFormattingConfigurationFragment,\n\taddLabelsForProperties: addLabelsForProperties,\n\tcheckForNavigationProperty: checkForNavigationProperty,\n\tdisableOrEnableUOMAndTrend: disableOrEnableUOMAndTrend\n};\nexport function getCriticality(sPropertyName: string, isCalcuationType?: boolean) {\n\tconst oModel = context?.dialog?.getModel();\n\tconst aMainIndicatorCriticality = oModel?.getProperty(\"/configuration/mainIndicatorOptions/criticality\");\n\tconst oMatchedCriticality = aMainIndicatorCriticality?.find(function (oCriticality: any) {\n\t\treturn oCriticality?.name === sPropertyName || \"{\" + oCriticality?.name + \"}\" === sPropertyName;\n\t});\n\tif (oMatchedCriticality) {\n\t\tif (isBinding(oMatchedCriticality?.criticality)) {\n\t\t\treturn \"{= extension.formatters.formatCriticality($\" + oMatchedCriticality?.criticality + \", 'color') }\";\n\t\t}\n\t\tif (oMatchedCriticality?.activeCalculation || isCalcuationType) {\n\t\t\tconst staticValues = {\n\t\t\t\tdeviationLow: oMatchedCriticality?.deviationRangeLowValue,\n\t\t\t\tdeviationHigh: oMatchedCriticality?.deviationRangeHighValue,\n\t\t\t\ttoleranceLow: oMatchedCriticality?.toleranceRangeLowValue,\n\t\t\t\ttoleranceHigh: oMatchedCriticality?.toleranceRangeHighValue,\n\t\t\t\tsImprovementDirection: oMatchedCriticality?.improvementDirection,\n\t\t\t\toCriticalityConfigValues: { None: \"Neutral\", Negative: \"Error\", Critical: \"Critical\", Positive: \"Good\" }\n\t\t\t};\n\t\t\treturn \"{= extension.formatters.formatValueColor(${\" + oMatchedCriticality?.name + \"},\" + JSON.stringify(staticValues) + \") }\";\n\t\t}\n\t\treturn oMatchedCriticality?.criticality;\n\t}\n\treturn \"None\";\n}\n\n/**\n * This functions updates the enablement of the advanced formatting options based on the source property.\n * @param sourceProperty\n * @returns\n */\nfunction setAdvancedFormattingOptionsEnablement(sourceProperty: string) {\n\tconst oModel = context.dialog.getModel();\n\tconst mainIndicatorProperty = oModel.getProperty(\"/configuration/mainIndicatorStatusKey\");\n\toModel.setProperty(\"/configuration/trendOptions/sourceProperty\", mainIndicatorProperty);\n\toModel.setProperty(\"/configuration/indicatorsValue/sourceProperty\", mainIndicatorProperty);\n\tconst properties = oModel.getProperty(\"/configuration/properties\");\n\tconst unitsOfMeasure = oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\") || [];\n\tconst propertyValueFormatters = oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\") || [];\n\tconst mainIndicatorCriticality = oModel.getProperty(\"/configuration/mainIndicatorOptions/criticality\") || [];\n\tconst selectedTrendOptions = oModel.getProperty(\"/configuration/selectedTrendOptions\") || [];\n\tconst selectedIndicatorOptions = oModel.getProperty(\"/configuration/selectedIndicatorOptions\") || [];\n\tconst dataType = properties.find((property: Property) => property.name === sourceProperty)?.type || \"\";\n\tconst isDateType = ODataUtils.isPropertyTypeDate(dataType);\n\tconst isNumberType = [\"Edm.Decimal\", \"Edm.Int16\", \"Edm.Int32\", \"Edm.Double\"].indexOf(dataType) > -1;\n\n\tlet isFormatterApplied = propertyValueFormatters.some(function (formatterDetail: ValueFormatter) {\n\t\treturn formatterDetail.property === sourceProperty || \"{\" + formatterDetail.property + \"}\" === sourceProperty;\n\t});\n\n\tconst formatterApplied = propertyValueFormatters.filter(function (formatterDetail: ValueFormatter) {\n\t\treturn formatterDetail.property === sourceProperty || \"{\" + formatterDetail.property + \"}\" === sourceProperty;\n\t})[0];\n\n\tif (formatterApplied?.formatterName === \"format.unit\" && typeof formatterApplied?.parameters[1].properties[0].value !== \"number\") {\n\t\tisFormatterApplied = false;\n\t}\n\n\tconst isUOMApplied = unitsOfMeasure.some(function (arrangementDetail: UnitOfMeasures) {\n\t\treturn arrangementDetail.name === sourceProperty;\n\t});\n\tconst isCriticalityApplied = mainIndicatorCriticality.some((indicatorCriticality: Criticality) => {\n\t\treturn indicatorCriticality.name === sourceProperty;\n\t});\n\tconst isTrendApplied = selectedTrendOptions.some(function (trendDetail: TrendOptions) {\n\t\treturn trendDetail.sourceProperty === sourceProperty && trendDetail.downDifference;\n\t});\n\tconst isIndicatorsApplied = selectedIndicatorOptions.some(function (indicatorDetail: SideIndicatorOptions) {\n\t\treturn indicatorDetail.sourceProperty === sourceProperty && indicatorDetail.targetUnit;\n\t});\n\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/isFormatterApplied\", isFormatterApplied);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/isFormatterEnabled\", isDateType || isNumberType);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/isUOMApplied\", isUOMApplied);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/isCriticalityApplied\", isCriticalityApplied);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/isTrendApplied\", isTrendApplied);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/isIndicatorsApplied\", isIndicatorsApplied);\n\n\tconst trendOptions = oModel.getProperty(\"/configuration/trendOptions\") as TrendOptions;\n\tconst indicatorsValue = oModel.getProperty(\"/configuration/indicatorsValue\") as SideIndicatorOptions;\n\n\tif (trendOptions) {\n\t\tconst { referenceValue, downDifference, upDifference } = trendOptions;\n\t\tif (referenceValue && downDifference && upDifference) {\n\t\t\toModel.setProperty(\"/configuration/trendOptions/upDown\", true);\n\t\t}\n\t}\n\n\tif (indicatorsValue) {\n\t\tconst { targetValue, deviationValue, targetUnit, deviationUnit } = indicatorsValue;\n\t\tif (targetValue && deviationValue && targetUnit && deviationUnit) {\n\t\t\toModel.setProperty(\"/configuration/indicatorsValue/targetDeviation\", true);\n\t\t}\n\t}\n}\n\n/**\n * Updates \"sap.card.header\" property of integration card manifest and triggers rendering of the card preview.\n *\n * @param oEvent\n * @param key\n * @param fnGetHeaderConfig\n */\nfunction updateCardHeader(oEvent: Event, fnGetHeaderConfig: Function, key?: string) {\n\tconst control = oEvent.getSource() as ComboBox;\n\tconst selectedKey = control.getSelectedKey() || \"\";\n\tconst newValue = oEvent.getParameter(\"newValue\");\n\tlet currentValue = selectedKey !== \"\" ? `{${selectedKey}}` : newValue;\n\tconst oModel = context.dialog.getModel();\n\n\tif (key === \"navSelection\") {\n\t\tconst navigationValue = oModel.getProperty(\"/configuration/navigationValue\");\n\t\tcurrentValue = navigationValue ? `{${navigationValue}}` : \"\";\n\t}\n\n\tif (!selectedKey && key === \"mainIndicator\") {\n\t\tcurrentValue = \"\";\n\t}\n\n\tif (selectedKey !== \"\" || currentValue !== \"\") {\n\t\tcontrol.setValueState(ValueState.None);\n\t}\n\n\tconst sapCardHeader = fnGetHeaderConfig(currentValue);\n\tconst currentManifest = getCurrentCardManifest();\n\tconst oManifest = merge(currentManifest, sapCardHeader) as CardManifest;\n\n\tif (currentValue === \"\" && key === \"mainIndicator\") {\n\t\tdelete oManifest[\"sap.card\"].header.mainIndicator;\n\t\tdelete oManifest[\"sap.card\"].header.sideIndicators;\n\t}\n\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/sourceProperty\", selectedKey);\n\trenderCardPreview(oManifest, context.dialog.getModel());\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\n/**\n * Handles the change event for card title selection.\n * @param oEvent\n */\nfunction onTitleSelection(oEvent: Event) {\n\tconst getHeaderConfiguration = (value: string) => {\n\t\treturn {\n\t\t\t\"sap.card\": {\n\t\t\t\theader: {\n\t\t\t\t\ttitle: value\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\tvalidateContol(oEvent, \"title\");\n\tupdateCardHeader(oEvent, getHeaderConfiguration);\n}\n/**\n * Validates the control(control's selected key) based on the provided event and control name.\n * @param {Event} oEvent The event triggered by the control.\n * @param {string} [controlName] The name of the control being validated.\n */\nfunction validateContol(oEvent: Event, controlName?: string) {\n\tconst control: ComboBox = oEvent.getSource();\n\tconst selectedKey = control.getSelectedKey();\n\tconst value: string = oEvent.getParameter(\"newValue\");\n\n\tconst oModel = context.dialog.getModel();\n\tconst errorControls = oModel.getProperty(\"/configuration/errorControls\");\n\tconst resourceBundle = context.dialog.getModel(\"i18n\").getResourceBundle();\n\n\t/**\n\t * Gets the key for the given control name.\n\t * @param {string} name The name of the control.\n\t * @returns {string} The key associated with the control name.\n\t */\n\tconst getKey = (name: string): string => {\n\t\tswitch (name) {\n\t\t\tcase \"title\":\n\t\t\t\treturn resourceBundle.getText(\"GENERATOR_CARD_TITLE\");\n\t\t\tcase \"stateIndicator\":\n\t\t\t\treturn resourceBundle.getText(\"GENERATOR_MAIN_INDICATOR\");\n\t\t\tdefault:\n\t\t\t\treturn resourceBundle.getText(\"GENERATOR_GROUP_PROPERTY\");\n\t\t}\n\t};\n\n\tconst controlErrorText = resourceBundle.getText(\"GENERIC_ERR_MSG\", [getKey(controlName ?? \"\")]);\n\n\tif (!selectedKey && !value && controlName === \"title\") {\n\t\terrorControls?.push(control);\n\t\tcontrol.setValueStateText(controlErrorText);\n\t} else if (!selectedKey && value) {\n\t\terrorControls?.push(control);\n\t\tcontrol.setValueState(ValueState.Error);\n\t\tcontrol.setValueStateText(controlErrorText);\n\t} else {\n\t\terrorControls?.forEach((errorControl: ComboBox, index: number) => {\n\t\t\tif (control.getId() === errorControl.getId()) {\n\t\t\t\terrorControls.splice(index, 1);\n\t\t\t}\n\t\t});\n\t\tcontrol.setValueState(ValueState.None);\n\t}\n}\n\n/**\n * Handles the change event for card subtitle selection.\n * @param oEvent\n */\nfunction onSubTitleSelection(oEvent: Event) {\n\tconst getHeaderConfiguration = (value: string) => {\n\t\tconst oModel = context.dialog.getModel();\n\t\treturn {\n\t\t\t\"sap.card\": {\n\t\t\t\theader: {\n\t\t\t\t\tsubTitle: getArrangements(value, {\n\t\t\t\t\t\tunitOfMeasures: oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\t\t\t\t\ttextArrangements: oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\"),\n\t\t\t\t\t\tpropertyValueFormatters: oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\")\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\tupdateCardHeader(oEvent, getHeaderConfiguration);\n}\n\n/**\n * Handles the change event for card header UOM selection.\n * @param oEvent\n */\nfunction onHeaderUOMSelection(oEvent: Event) {\n\tconst getHeaderConfiguration = (value: string) => {\n\t\tconst oModel = context.dialog.getModel();\n\t\treturn {\n\t\t\t\"sap.card\": {\n\t\t\t\theader: {\n\t\t\t\t\tunitOfMeasurement: getArrangements(value, {\n\t\t\t\t\t\tunitOfMeasures: oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\t\t\t\t\ttextArrangements: oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\"),\n\t\t\t\t\t\tpropertyValueFormatters: oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\")\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\n\tupdateCardHeader(oEvent, getHeaderConfiguration);\n}\nfunction addLabelsForProperties(selectedNavigationProperty: NavigationalData, data: Record<string, unknown>) {\n\tif (\n\t\tselectedNavigationProperty.name &&\n\t\tdata[selectedNavigationProperty.name] !== undefined &&\n\t\tdata[selectedNavigationProperty.name] !== null\n\t) {\n\t\tconst propVal = selectedNavigationProperty?.value as unknown as PropertyInfoMap;\n\t\tpropVal?.forEach((ele: PropertyInfo) => {\n\t\t\tconst name = data[selectedNavigationProperty.name] as Record<string, unknown>;\n\t\t\tif (name[ele.name] !== undefined && name[ele.name] !== null) {\n\t\t\t\tconst propertyValue = name[ele.name] as string;\n\t\t\t\tconst value = formatPropertyDropdownValues(ele, propertyValue);\n\t\t\t\tele.labelWithValue = value;\n\t\t\t} else {\n\t\t\t\tele.labelWithValue = `${ele.label} (<empty>)`;\n\t\t\t}\n\t\t});\n\t} else {\n\t\tselectedNavigationProperty.value = [];\n\t}\n}\n\nasync function updateCardConfigurationData(selectedProperty: string, selectedNavigationProperty: NavigationalData) {\n\tconst { entitySetWithObjectContext } = ApplicationInfo.getInstance().fetchDetails();\n\tconst oModel = context.dialog.getModel();\n\tconst { serviceUrl, oDataV4, $data } = oModel.getProperty(\"/configuration\");\n\tconst queryParameters: QueryParameters = {\n\t\tproperties: [],\n\t\tnavigationProperties: [\n\t\t\t{\n\t\t\t\tname: selectedProperty,\n\t\t\t\tproperties: selectedNavigationProperty.value.map((property) => property.name) || []\n\t\t\t}\n\t\t]\n\t};\n\tconst result = await ODataUtils.fetchDataAsync(serviceUrl, entitySetWithObjectContext, oDataV4, createUrlParameters(queryParameters));\n\taddLabelsForProperties(selectedNavigationProperty, result);\n\t$data[selectedProperty] = result[selectedProperty];\n\toModel.setProperty(\"/configuration/$data\", $data);\n}\n\nfunction updateHeaderNavigationSelection(oEvent: Event) {\n\tconst oModel = context.dialog.getModel();\n\tconst getHeaderConfiguration = (value: string) => ({\n\t\t\"sap.card\": {\n\t\t\theader: {\n\t\t\t\tmainIndicator: {\n\t\t\t\t\tnumber: getArrangements(value, {\n\t\t\t\t\t\tunitOfMeasures: oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\t\t\t\t\ttextArrangements: oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\"),\n\t\t\t\t\t\tpropertyValueFormatters: oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\")\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\tconst control = oEvent.getSource() as ComboBox;\n\tconst selectedKey = control.getSelectedKey();\n\tconst sourceProperty = oModel.getProperty(\"/configuration/mainIndicatorStatusKey\");\n\tupdateSelectedNavigation(selectedKey, sourceProperty, oModel, \"header\");\n\n\toModel.setProperty(\"/configuration/navigationValue\", `${sourceProperty}/${selectedKey}`);\n\toModel.setProperty(\"/configuration/mainIndicatorNavigationSelectedKey\", selectedKey);\n\tupdateCardHeader(oEvent, getHeaderConfiguration, \"navSelection\");\n}\n\n/**\n * Handles the change event for card KPI value selection.\n * @param oEvent\n */\nasync function onStateIndicatorSelection(oEvent: Event) {\n\tconst getHeaderConfiguration = (value: string) => {\n\t\tconst oModel = context.dialog.getModel();\n\t\treturn {\n\t\t\t\"sap.card\": {\n\t\t\t\theader: {\n\t\t\t\t\tmainIndicator: {\n\t\t\t\t\t\tstate: getCriticality(value),\n\t\t\t\t\t\tnumber: getArrangements(value, {\n\t\t\t\t\t\t\tunitOfMeasures: oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\t\t\t\t\t\ttextArrangements: oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\"),\n\t\t\t\t\t\t\tpropertyValueFormatters: oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\")\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t};\n\tconst oModel = context.dialog.getModel();\n\tconst control = oEvent.getSource() as ComboBox;\n\tconst selectedKey = control.getSelectedKey();\n\tawait updateSelectedNavigationProperty(selectedKey, true);\n\tconst selectedNavigationPropertyHeader = oModel.getProperty(\"/configuration/selectedNavigationPropertyHeader\");\n\tconst selectedValue: string = oEvent.getParameter(\"newValue\");\n\tvalidateContol(oEvent, \"stateIndicator\");\n\tconst currentValue = selectedKey !== \"\" ? `{${selectedKey}}` : selectedValue;\n\toModel.setProperty(\"/configuration/mainIndicatorNavigationSelectedValue\", \"\");\n\toModel.setProperty(\"/configuration/mainIndicatorNavigationSelectedKey\", \"\");\n\toModel.setProperty(\n\t\t\"/configuration/advancedFormattingOptions/isPropertyFormattingEnabled\",\n\t\t!!(selectedKey && !selectedNavigationPropertyHeader?.value?.length && selectedNavigationPropertyHeader?.name === \"\")\n\t);\n\n\tconst properties = oModel.getProperty(\"/configuration/properties\");\n\tconst dataType = properties.find((prop: Property) => prop.name === selectedKey)?.type || \"\";\n\tconst isDateType = ODataUtils.isPropertyTypeDate(dataType);\n\tconst isNumberType = [\"Edm.Decimal\", \"Edm.Int16\", \"Edm.Int32\", \"Edm.Double\"].indexOf(dataType) > -1;\n\n\toModel.setProperty(\"/configuration/mainIndicatorStatusKey\", selectedKey);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/isFormatterEnabled\", isDateType || isNumberType);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/textArrangementSourceProperty\", currentValue);\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/textArrangementSelectedKey\", selectedKey);\n\n\tif (oModel.getProperty(\"/configuration/trendOptions/sourceProperty\") !== selectedKey) {\n\t\toModel.setProperty(\"/configuration/trendOptions\", {});\n\t\toModel.setProperty(\"/configuration/indicatorsValue\", {});\n\t}\n\n\toModel.setProperty(\"/configuration/trendOptions/sourceProperty\", selectedKey);\n\toModel.setProperty(\"/configuration/indicatorsValue/sourceProperty\", selectedKey);\n\n\tupdateTrendForCardHeader();\n\tupdateSideIndicatorsForHeader();\n\toModel.setProperty(\"/configuration/navigationValue\", \"\");\n\tif (!selectedNavigationPropertyHeader?.value.length) {\n\t\tupdateCardHeader(oEvent, getHeaderConfiguration, \"mainIndicator\");\n\t} else {\n\t\tupdateCardHeader(oEvent, getHeaderConfiguration, \"navSelection\");\n\t}\n}\n\n/**\n * Disables or enables the apply unit of measure based on the selected property.\n * @param {JSONModel} model - The JSON model containing the configuration.\n * @param {string} selectedProperty - The name of the selected property.\n */\nfunction disableOrEnableUOMAndTrend(model: JSONModel, selectedProperty: string) {\n\tlet typeSupported = true;\n\tconst propertyType = model.getProperty(\"/configuration/properties\").find((prop: Property) => prop.name === selectedProperty)?.type;\n\tconst selectedValue = model.getProperty(\"/configuration/$data\")[selectedProperty];\n\tif (propertyType === \"Edm.String\") {\n\t\ttypeSupported = !isNaN(Number(selectedValue));\n\t}\n\tconst isDateType = ODataUtils.isPropertyTypeDate(propertyType);\n\tconst isUoMEnabled = !(propertyType === \"Edm.Boolean\" || propertyType === \"Edm.Guid\" || isDateType) && typeSupported;\n\tconst isNumberType = [\"Edm.Decimal\", \"Edm.Int16\", \"Edm.Int32\", \"Edm.Double\"].indexOf(propertyType) > -1;\n\n\tmodel.setProperty(\"/configuration/advancedFormattingOptions/isUoMEnabled\", isUoMEnabled);\n\tmodel.setProperty(\"/configuration/advancedFormattingOptions/isTrendEnabled\", isNumberType);\n}\n\nfunction updateContentNavigationSelection(oEvent: Event) {\n\tconst control: ComboBox = oEvent.getSource();\n\tconst selectedKey = control.getSelectedKey() || \"\";\n\tconst oModel = context.dialog.getModel();\n\tconst sPath = control?.getBindingContext()?.getPath() as string;\n\tconst group: GroupItem = oModel.getProperty(sPath);\n\tconst currentValue = `{${group.name}/${selectedKey}}`;\n\tgroup.value =\n\t\tselectedKey &&\n\t\tgetArrangements(currentValue, {\n\t\t\tunitOfMeasures: oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\t\ttextArrangements: oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\"),\n\t\t\tpropertyValueFormatters: oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\")\n\t\t});\n\tupdateSelectedNavigation(selectedKey, group.name, oModel, \"content\");\n\n\tconst navProperty = ODataUtils.getPropertyLabel(\n\t\tcontext.appModel,\n\t\tcontext.entitySet,\n\t\tgroup.name,\n\t\tPropertyInfoType.NavigationProperty\n\t) as NavigationParameter;\n\tconst property = navProperty?.properties?.find((oProperty) => oProperty.name === selectedKey);\n\tconst propertyLabel = property ? property.label : \"\";\n\tgroup.label = propertyLabel;\n\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\nfunction updateSelectedNavigation(selectedKey: string, sourceProperty: string, oModel: JSONModel, source: string) {\n\tconst selectedNavigation: NavigationParameter[] =\n\t\tsource === \"header\"\n\t\t\t? oModel.getProperty(\"/configuration/selectedHeaderNavigation\")\n\t\t\t: oModel.getProperty(\"/configuration/selectedContentNavigation\");\n\tconst existingIndex = selectedNavigation.findIndex((navItem) => navItem.name === sourceProperty);\n\n\tif (existingIndex !== -1) {\n\t\tconst existingItem = selectedNavigation[existingIndex];\n\t\tconst navValues = existingItem?.value?.includes(selectedKey) ? existingItem.value : [...existingItem.value, selectedKey];\n\t\tselectedNavigation[existingIndex] = { ...existingItem, value: navValues };\n\t} else {\n\t\tconst name = sourceProperty;\n\t\tselectedNavigation.push({ name, value: [selectedKey] });\n\t}\n\n\tconst propertyPath = source === \"header\" ? \"/configuration/selectedHeaderNavigation\" : \"/configuration/selectedContentNavigation\";\n\toModel.setProperty(propertyPath, selectedNavigation);\n}\nasync function updateSelectedNavigationProperty(selectedKey: string, isHeader: boolean) {\n\tconst oModel = context.dialog.getModel();\n\tconst navigationProperty: NavigationParameter[] = oModel.getProperty(\"/configuration/navigationProperty\") || [];\n\tconst selectedNavigationalProperties: NavigationalData[] = oModel.getProperty(\"/configuration/selectedNavigationalProperties\") || [];\n\tconst existingIndex = selectedNavigationalProperties.findIndex((navItem) => navItem.name === selectedKey);\n\n\tconst selectedProperty = navigationProperty.find((prop) => prop.name === selectedKey);\n\tconst selectedPropertyName = selectedProperty?.name || \"\";\n\tconst selectedPropertyValues = selectedProperty?.properties || [];\n\n\tconst data: NavigationalData = {\n\t\tname: selectedPropertyName,\n\t\tvalue: selectedPropertyValues\n\t};\n\n\tif (existingIndex === -1 && selectedProperty) {\n\t\tselectedNavigationalProperties.push(data);\n\t}\n\toModel.setProperty(\"/configuration/selectedNavigationalProperties\", selectedNavigationalProperties);\n\tif (isHeader) {\n\t\toModel.setProperty(\"/configuration/selectedNavigationPropertyHeader\", data);\n\t} else {\n\t\toModel.setProperty(\"/configuration/selectedNavigationPropertiesContent\", data);\n\t}\n\n\tif (selectedProperty) {\n\t\tawait updateCardConfigurationData(selectedProperty.name, data);\n\t}\n}\n\nfunction getTranslatedText(sKey: string) {\n\treturn context.dialog.getModel(\"i18n\").getObject(sKey);\n}\n\nfunction onAddClick(oEvent: Event) {\n\tconst oModel = context.dialog.getModel();\n\tconst sPath = oEvent.getSource().getBindingContext().getPath();\n\tconst group = oModel.getProperty(sPath);\n\tif (!group.items) {\n\t\tgroup.items = [];\n\t}\n\tconst nextItemNumber = oModel.getProperty(sPath).items.length;\n\tconst newItem = {\n\t\tlabel: null,\n\t\tvalue: `{/items/${nextItemNumber}}`,\n\t\tisEnabled: false,\n\t\tisNavigationEnabled: false,\n\t\tnavigationalProperties: []\n\t};\n\toModel.getProperty(sPath).items.push(newItem);\n\tconst iItemsAdded = oModel.getProperty(sPath).items.length;\n\toModel.setProperty(sPath + \"/enableAddMoreGroupItems\", true);\n\tif (iItemsAdded === MAX_GROUP_ITEMS) {\n\t\toModel.setProperty(sPath + \"/enableAddMoreGroupItems\", false);\n\t}\n\toModel.refresh();\n}\n\nasync function okPressed() {\n\tconst hasError = validateHeader();\n\tif (hasError) {\n\t\treturn;\n\t}\n\n\tconst oCard = CoreElement.getElementById(\"cardGeneratorDialog--cardPreview\") as Card;\n\tconst mManifest = oCard.getManifest() as CardManifest;\n\n\tawait enhanceManifestWithInsights(mManifest, context.rootComponent);\n\tenhanceManifestWithConfigurationParameters(mManifest, context.dialog.getModel());\n\tcreateAndStoreGeneratedi18nKeys(mManifest);\n\tupdateManifestWithSelectQueryParams(mManifest);\n\n\tconst oModel = context.dialog.getModel();\n\tconst keyParameters = oModel.getProperty(\"/configuration/keyParameters\");\n\tconst appIntent = oModel.getProperty(\"/configuration/appIntent\");\n\tconst oAdaptiveCardManifest = convertIntegrationCardToAdaptive(mManifest, appIntent, keyParameters);\n\tdelete mManifest[\"sap.card\"].configuration?.parameters?.contextParameters;\n\tconst payload = {\n\t\tfloorplan: \"ObjectPage\",\n\t\tlocalPath: `cards/op/${context.entitySet}`,\n\t\tfileName: \"manifest.json\",\n\t\tmanifests: [\n\t\t\t{\n\t\t\t\ttype: \"integration\",\n\t\t\t\tmanifest: mManifest,\n\t\t\t\tdefault: true,\n\t\t\t\tentitySet: context.entitySet\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: \"adaptive\",\n\t\t\t\tmanifest: oAdaptiveCardManifest,\n\t\t\t\tdefault: true,\n\t\t\t\tentitySet: context.entitySet\n\t\t\t}\n\t\t]\n\t};\n\n\tjQuery.ajax({\n\t\ttype: \"POST\",\n\t\turl: \"/cards/store\",\n\t\theaders: {\n\t\t\t\"Content-Type\": \"application/json\"\n\t\t},\n\t\tdata: JSON.stringify(payload),\n\t\tsuccess: function () {\n\t\t\tMessageToast.show(getTranslatedText(\"CARD_SAVE_SUCCESS_MESSAGE\"));\n\t\t},\n\t\terror: function (jqXHR, textStatus, errorThrown) {\n\t\t\tconst errorMessage = `Unable to save the card: ${textStatus} - ${errorThrown} (Status: ${jqXHR.status} - ${jqXHR.statusText})`;\n\t\t\tLog.error(errorMessage);\n\t\t\tMessageBox.error(getTranslatedText(\"CARD_SAVE_ERROR_MESSAGE\"));\n\t\t}\n\t});\n\tcontext.dialog.close();\n}\n\nfunction validateHeader() {\n\tlet hasError = false;\n\tconst oModel = context.dialog.getModel();\n\tconst errorControls = oModel.getProperty(\"/configuration/errorControls\");\n\terrorControls?.forEach((ele: ComboBox) => {\n\t\tif (!ele.getValue() || ele.getValueState() == \"Error\") {\n\t\t\tele.setValueState(ValueState.Error);\n\t\t\thasError = true;\n\t\t}\n\t});\n\treturn hasError;\n}\n\nfunction validateIndicatorsValues(buttonId: string) {\n\tconst oModel = context.dialog.getModel();\n\tconst indicatorsValue = oModel.getProperty(\"/configuration/indicatorsValue\");\n\tlet hasError = false;\n\tconst { targetValue, deviationValue, targetUnit, deviationUnit } = indicatorsValue;\n\n\tif (!targetValue) {\n\t\toModel.setProperty(\"/configuration/indicatorsValue/targetValueState\", \"Error\");\n\t\tconst targetInputId = buttonId + \"--targetInputValue\";\n\t\tsetValueStateTextForControl(targetInputId, getTranslatedText(\"TARGET_VALUE_ERR_MSG\"));\n\t}\n\tif (!deviationValue) {\n\t\toModel.setProperty(\"/configuration/indicatorsValue/deviationValueState\", \"Error\");\n\t\tconst deviationInputId = buttonId + \"--deviationInputValue\";\n\t\tsetValueStateTextForControl(deviationInputId, getTranslatedText(\"DEVIATION_VALUE_ERR_MSG\"));\n\t}\n\tif (!targetUnit) {\n\t\toModel.setProperty(\"/configuration/indicatorsValue/targetUnitValueState\", \"Error\");\n\t\tconst targetUnitInputId = buttonId + \"--targetUnitInput\";\n\t\tsetValueStateTextForControl(targetUnitInputId, getTranslatedText(\"TARGET_UNIT_ERR_MSG\"), true);\n\t}\n\tif (!deviationUnit) {\n\t\toModel.setProperty(\"/configuration/indicatorsValue/deviationUnitValueState\", \"Error\");\n\t\tconst deviationUnitInputId = buttonId + \"--deviationUnitInput\";\n\t\tsetValueStateTextForControl(deviationUnitInputId, getTranslatedText(\"DEVIATION_UNIT_ERR_MSG\"), true);\n\t}\n\tif (!targetValue || !deviationValue || !targetUnit || !deviationUnit) {\n\t\thasError = true;\n\t}\n\treturn hasError;\n}\n\nfunction validateTrendValues(buttonId: string) {\n\tconst oModel = context.dialog.getModel();\n\tconst trendValues = oModel.getProperty(\"/configuration/trendOptions\");\n\tlet hasError = false;\n\tconst { referenceValue, downDifference, upDifference } = trendValues;\n\n\tif (!referenceValue) {\n\t\toModel.setProperty(\"/configuration/trendOptions/referenceValueState\", \"Error\");\n\t\tconst referenceInputId = buttonId + \"--trendReferenceValueInput\";\n\t\tsetValueStateTextForControl(referenceInputId, getTranslatedText(\"REF_ERR_MSG\"));\n\t}\n\tif (!downDifference) {\n\t\toModel.setProperty(\"/configuration/trendOptions/downDifferenceValueState\", \"Error\");\n\t\tconst trendDownDifferenceInputId = buttonId + \"--trendDownDifferenceInput\";\n\t\tsetValueStateTextForControl(trendDownDifferenceInputId, getTranslatedText(\"LOW_RANGE_ERR_MSG\"));\n\t}\n\tif (!upDifference) {\n\t\toModel.setProperty(\"/configuration/trendOptions/upDifferenceValueState\", \"Error\");\n\t\tconst trendUpDifferenceInputId = buttonId + \"--trendUpDifferenceInput\";\n\t\tsetValueStateTextForControl(trendUpDifferenceInputId, getTranslatedText(\"HIGH_RANGE_ERR_MSG\"));\n\t}\n\tif (!referenceValue || !downDifference || !upDifference) {\n\t\thasError = true;\n\t}\n\treturn hasError;\n}\n\nfunction setValueStateTextForControl(controlId: string, errorMessage: string, isSelectControl?: boolean) {\n\tconst elementControl = CoreElement?.getElementById(controlId);\n\telementControl.key = errorMessage;\n\tconst validateControl = isSelectControl\n\t\t? !elementControl?.getSelectedKey() || elementControl.getValueState() == \"Error\"\n\t\t: !elementControl?.getValue() || elementControl.getValueState() == \"Error\";\n\tif (validateControl) {\n\t\tconst resourceBundle = context?.dialog?.getModel(\"i18n\").getResourceBundle();\n\t\tconst validationText = resourceBundle?.getText(\"GENERIC_ERR_MSG\", [elementControl?.key]);\n\t\telementControl?.setValueStateText(validationText);\n\t}\n}\n\nfunction onGroupAddClick(oEvent: any) {\n\t//on click of Add new group.\n\tconst oModel = context.dialog.getModel();\n\tconst iLength = oModel.getProperty(\"/configuration/groups\").length;\n\tconst currentDefaultValue = context?.dialog\n\t\t.getModel(\"i18n\")\n\t\t?.getResourceBundle()\n\t\t?.getText(\"GENERATOR_DEFAULT_GROUP_NAME\", [iLength + 1]);\n\toModel.getProperty(\"/configuration/groups\").push({\n\t\ttitle: currentDefaultValue,\n\t\titems: [\n\t\t\t{\n\t\t\t\tlabel: null,\n\t\t\t\tvalue: \"{/items/0}\",\n\t\t\t\tisEnabled: false,\n\t\t\t\tisNavigationEnabled: false,\n\t\t\t\tnavigationalProperties: []\n\t\t\t}\n\t\t],\n\t\tnewItem: {\n\t\t\tlabel: null,\n\t\t\tvalue: null,\n\t\t\tisEnabled: false,\n\t\t\tisNavigationEnabled: false,\n\t\t\tnavigationalProperties: []\n\t\t}\n\t});\n\tconst groupLength = oModel.getProperty(\"/configuration/groups\").length;\n\tif (groupLength === MAX_GROUPS) {\n\t\toModel.setProperty(\"/configuration/groupLimitReached\", true);\n\t}\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\nfunction onGroupDeleteClick(oEvent: any) {\n\tconst oModel = context.dialog.getModel();\n\tconst sPath = oEvent.getSource().getBindingContext().getPath();\n\tconst groupIndex = sPath.split(\"/configuration/groups/\")[1];\n\toModel.getProperty(\"/configuration/groups\").splice(groupIndex, 1);\n\tconst groupLength = oModel.getProperty(\"/configuration/groups\").length;\n\tif (groupLength < MAX_GROUPS) {\n\t\toModel.setProperty(\"/configuration/groupLimitReached\", false);\n\t}\n\tdelete context._itemActionsMenu;\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\nfunction onGroupTitleChange(oEvent: any) {\n\tconst currentValue = oEvent.getParameters().newValue;\n\tconst oModel = context.dialog.getModel();\n\tconst sPath = oEvent.getSource().getBindingContext().getPath();\n\tconst group = oModel.getProperty(sPath);\n\tgroup.title = currentValue;\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\nfunction onDeleteClick(oEvent: any) {\n\tconst oModel = context.dialog.getModel();\n\tconst sPath = oEvent.getSource().getBindingContext().getPath();\n\tconst [groupIndex, itemIndex] = sPath.match(/(\\d+)/g).map(function (sValue: string) {\n\t\treturn Number(sValue);\n\t});\n\toModel.getProperty(\"/configuration/groups/\" + groupIndex).items.splice(itemIndex, 1);\n\tconst iLength = oModel.getProperty(\"/configuration/groups/\" + groupIndex).items.length;\n\tif (iLength < MAX_GROUP_ITEMS) {\n\t\toModel.setProperty(\"/configuration/groups/\" + groupIndex + \"/enableAddMoreGroupItems\", true);\n\t}\n\tcontext._itemActionsMenu?.destroy();\n\tdelete context._itemActionsMenu;\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\n/**\n * Updates the sap.card.header.mainIndicator.trend property of the integration card manifest and triggers rendering of the card preview.\n */\nfunction updateTrendForCardHeader() {\n\tconst oModel = context.dialog.getModel();\n\tlet trendOptions = oModel.getProperty(\"/configuration/trendOptions\");\n\tconst selectedTrendOptions = oModel.getProperty(\"/configuration/selectedTrendOptions\");\n\n\tconst sapCardHeader = {\n\t\t\"sap.card\": {\n\t\t\theader: {\n\t\t\t\tmainIndicator: {\n\t\t\t\t\ttrend: \"None\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tlet selectedTrendOptionIndex = -1;\n\tselectedTrendOptions?.forEach((selectedTrendOption: any, index: number) => {\n\t\tif (selectedTrendOption.sourceProperty === trendOptions.sourceProperty) {\n\t\t\tselectedTrendOptionIndex = index;\n\t\t\ttrendOptions = { ...selectedTrendOption, ...trendOptions };\n\t\t\toModel.setProperty(\"/configuration/trendOptions\", trendOptions);\n\t\t}\n\t});\n\tconst { referenceValue, downDifference, upDifference, sourceProperty } = trendOptions;\n\n\tif (referenceValue && downDifference && upDifference && sourceProperty) {\n\t\tconst newTrendValues = { referenceValue, downDifference, upDifference, sourceProperty };\n\t\tif (selectedTrendOptionIndex !== -1) {\n\t\t\tselectedTrendOptions[selectedTrendOptionIndex] = newTrendValues;\n\t\t} else {\n\t\t\tselectedTrendOptions.push(newTrendValues);\n\t\t}\n\t\tconst staticValues = {\n\t\t\treferenceValue: Number(referenceValue),\n\t\t\tdownDifference: Number(downDifference),\n\t\t\tupDifference: Number(upDifference)\n\t\t};\n\t\tsapCardHeader[\"sap.card\"][\"header\"][\"mainIndicator\"][\"trend\"] = getTrendDirection(staticValues);\n\t}\n\n\tconst currentManifest = getCurrentCardManifest();\n\tconst oManifest = merge(currentManifest, sapCardHeader) as CardManifest;\n\trenderCardPreview(oManifest, context.dialog.getModel());\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\n/**\n * Updates the sap.card.header.sideIndicators property of the integration card manifest and triggers rendering of the card preview.\n */\nfunction updateSideIndicatorsForHeader() {\n\tconst oModel = context.dialog.getModel();\n\tlet indicatorsValue = oModel.getProperty(\"/configuration/indicatorsValue\");\n\tconst selectedIndicatorOptions = oModel.getProperty(\"/configuration/selectedIndicatorOptions\");\n\n\tlet selectedIndicatorOptionIndex = -1;\n\tselectedIndicatorOptions?.forEach((selectedIndicatorOption: any, index: number) => {\n\t\tif (selectedIndicatorOption.sourceProperty === indicatorsValue.sourceProperty) {\n\t\t\tselectedIndicatorOptionIndex = index;\n\t\t\tindicatorsValue = { ...selectedIndicatorOption, ...indicatorsValue };\n\t\t\toModel.setProperty(\"/configuration/indicatorsValue\", indicatorsValue);\n\t\t}\n\t});\n\n\tlet sapCardHeader = {\n\t\t\"sap.card\": {\n\t\t\theader: {\n\t\t\t\tsideIndicators: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: \"\",\n\t\t\t\t\t\tnumber: \"\",\n\t\t\t\t\t\tunit: \"\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: \"\",\n\t\t\t\t\t\tnumber: \"\",\n\t\t\t\t\t\tunit: \"\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t};\n\tconst { targetValue, deviationValue, targetUnit, deviationUnit, sourceProperty } = indicatorsValue;\n\tif (targetValue && deviationValue && targetUnit && deviationUnit && sourceProperty) {\n\t\tconst indicatorsValueToAdd = { targetValue, deviationValue, targetUnit, deviationUnit, sourceProperty };\n\t\tif (selectedIndicatorOptionIndex !== -1) {\n\t\t\tselectedIndicatorOptions[selectedIndicatorOptionIndex] = indicatorsValueToAdd;\n\t\t} else {\n\t\t\tselectedIndicatorOptions.push(indicatorsValueToAdd);\n\t\t}\n\t\toModel.setProperty(\"/configuration/indicatorsValue/targetDeviation\", targetValue);\n\t\tsapCardHeader = {\n\t\t\t\"sap.card\": {\n\t\t\t\theader: {\n\t\t\t\t\tsideIndicators: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: \"Target\",\n\t\t\t\t\t\t\tnumber: targetValue,\n\t\t\t\t\t\t\tunit: targetUnit\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: \"Deviation\",\n\t\t\t\t\t\t\tnumber: deviationValue,\n\t\t\t\t\t\t\tunit: deviationUnit\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tconst currentManifest = getCurrentCardManifest();\n\tconst oManifest = merge(currentManifest, sapCardHeader) as CardManifest;\n\trenderCardPreview(oManifest, context.dialog.getModel());\n\toModel.refresh();\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\n/**\n * Get trend direction based on the static values.\n * @param staticValues\n * @returns\n */\nfunction getTrendDirection(staticValues: object | undefined) {\n\tconst oModel = context.dialog.getModel();\n\tconst mainIndicatorKey = oModel.getProperty(\"/configuration/mainIndicatorStatusKey\");\n\tconst trendValues = oModel.getProperty(\"/configuration/trendOptions\");\n\tconst { referenceValue } = trendValues;\n\n\tif (mainIndicatorKey && staticValues) {\n\t\toModel.setProperty(\"/configuration/trendOptions/upDown\", referenceValue);\n\t\treturn \"{= extension.formatters.formatTrendIcon(${\" + mainIndicatorKey + \"},\" + JSON.stringify(staticValues) + \") }\";\n\t}\n\treturn \"None\";\n}\n\nasync function onPropertySelection(oEvent: Event) {\n\tconst control: ComboBox = oEvent.getSource();\n\tconst selectedKey = control.getSelectedKey() || \"\";\n\tconst newValue = oEvent.getParameter(\"newValue\");\n\n\tconst currentValue = selectedKey !== \"\" ? `{${selectedKey}}` : newValue;\n\tconst oModel = context.dialog.getModel();\n\tvalidateContol(oEvent);\n\tawait updateSelectedNavigationProperty(selectedKey, false);\n\tconst selectedNavigationPropertiesContent = oModel.getProperty(\"/configuration/selectedNavigationPropertiesContent\");\n\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/sourceProperty\", selectedKey);\n\tconst sPath: string | undefined = control?.getBindingContext()?.getPath();\n\n\tconst group = oModel.getProperty(sPath);\n\n\tif (!selectedNavigationPropertiesContent?.value?.length) {\n\t\tgroup.value =\n\t\t\tselectedKey &&\n\t\t\tgetArrangements(currentValue, {\n\t\t\t\tunitOfMeasures: oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\t\t\ttextArrangements: oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\"),\n\t\t\t\tpropertyValueFormatters: oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\")\n\t\t\t});\n\t} else {\n\t\tgroup.value = \"\";\n\t\tgroup.navigationProperty = \"\";\n\t\tgroup.navigationalProperties = selectedNavigationPropertiesContent?.value;\n\t}\n\tconst propertyLabel = ODataUtils.getPropertyLabel(context.appModel, context.entitySet, selectedKey, PropertyInfoType.Property);\n\tgroup.label = selectedNavigationPropertiesContent?.value?.length ? \"\" : propertyLabel;\n\tgroup.isEnabled = (propertyLabel?.length > 0 && !selectedNavigationPropertiesContent?.value?.length) || false;\n\tgroup.isNavigationEnabled = selectedNavigationPropertiesContent?.value?.length > 0;\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\nfunction onPropertyLabelChange(oEvent: any) {\n\tconst currentValue = oEvent.getParameters().newValue;\n\tconst oModel = context.dialog.getModel();\n\tconst sPath = oEvent.getSource().getBindingContext().getPath();\n\tconst group = oModel.getProperty(sPath);\n\tgroup.label = currentValue;\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\nfunction onDrop(oEvent: any) {\n\tconst oDragged = oEvent.getParameter(\"draggedControl\"),\n\t\toDropped = oEvent.getParameter(\"droppedControl\"),\n\t\tsInsertPosition = oEvent.getParameter(\"dropPosition\"),\n\t\toModel = context.dialog.getModel(),\n\t\toDragPos = oDragged.getParent(),\n\t\toDropPos = oDropped.getParent(),\n\t\tsDraggedPath = oDragPos.getBindingContext().getPath(),\n\t\tsDroppedPath = oDropPos.getBindingContext().getPath(),\n\t\taDragItems = oModel.getProperty(sDraggedPath).items,\n\t\taDropItems = oModel.getProperty(sDroppedPath).items,\n\t\tiDragPosition = oDragPos.indexOfItem(oDragged),\n\t\tiDropPosition = oDropPos.indexOfItem(oDropped);\n\n\tconst oSelectedItem = aDragItems[iDragPosition];\n\t// insert the control in target aggregation, remove the item\n\tif (sInsertPosition === \"Before\" && aDropItems.length < MAX_GROUP_ITEMS) {\n\t\taDragItems.splice(iDragPosition, 1);\n\t\taDropItems.splice(iDropPosition, 0, oSelectedItem);\n\t} else if (sInsertPosition && aDropItems.length < MAX_GROUP_ITEMS) {\n\t\taDragItems.splice(iDragPosition, 1);\n\t\taDropItems.splice(iDropPosition + 1, 0, oSelectedItem);\n\t}\n\tif (aDragItems.length < MAX_GROUP_ITEMS) {\n\t\toModel.setProperty(sDraggedPath + \"/enableAddMoreGroupItems\", true);\n\t}\n\tif (aDropItems.length === MAX_GROUP_ITEMS) {\n\t\toModel.setProperty(sDroppedPath + \"/enableAddMoreGroupItems\", false);\n\t}\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\nfunction onResetPressed() {\n\tconst oCard: any = CoreElement.getElementById(\"cardGeneratorDialog--cardPreview\");\n\toCard.setWidth();\n\toCard.setHeight();\n\tCoreElement.getElementById(\"cardGeneratorDialog--widthInput\").setValue(\"\");\n\tCoreElement.getElementById(\"cardGeneratorDialog--heightInput\").setValue(\"\");\n\toCard.refresh();\n}\nfunction onHeightChange(oEvent: any) {\n\tconst oCard: any = CoreElement.getElementById(\"cardGeneratorDialog--cardPreview\");\n\tconst currentValue = Number(oEvent.getParameters().newValue);\n\tcurrentValue > 200 ? oCard.setHeight(currentValue + \"px\") : oCard.setHeight(\"232px\");\n\toCard.refresh();\n}\nfunction onWidthChange(oEvent: any) {\n\tconst oCard: any = CoreElement.getElementById(\"cardGeneratorDialog--cardPreview\");\n\tconst currentValue = Number(oEvent.getParameters().newValue);\n\tcurrentValue > 200 ? oCard.setWidth(currentValue + \"px\") : oCard.setWidth(\"582px\");\n\toCard.refresh();\n}\n\nfunction closeDialog() {\n\tconst oModel = context?.dialog?.getModel();\n\tconst errorControls = oModel.getProperty(\"/configuration/errorControls\");\n\terrorControls?.forEach((ele: ComboBox) => {\n\t\tele.setValueState(ValueState.None);\n\t});\n\tcontext?.dialog?.close();\n}\n\nfunction setCriticalitySourceProperty(sProperty: string) {\n\tconst oModel = context?.dialog?.getModel();\n\tconst mainIndicatorCriticality: any = oModel?.getProperty(\"/configuration/mainIndicatorOptions/criticality\");\n\tlet relavantCriticality;\n\n\tconst relavantProperty: any = mainIndicatorCriticality?.filter((indicatorCriticality: any) => {\n\t\treturn indicatorCriticality?.name === sProperty;\n\t});\n\tif (relavantProperty) {\n\t\trelavantCriticality = JSON.parse(JSON.stringify(relavantProperty));\n\t}\n\tif (relavantProperty?.length === 1) {\n\t\trelavantCriticality[0].hostCriticality = relavantProperty[0].criticality;\n\t\tdelete relavantCriticality.criticality;\n\t\toModel?.setProperty(\"/configuration/advancedFormattingOptions/sourceCriticalityProperty\", relavantCriticality);\n\t} else {\n\t\toModel?.setProperty(\"/configuration/advancedFormattingOptions/sourceCriticalityProperty\", [{ name: sProperty }]);\n\t}\n}\n\nfunction onPropertyFormatting(oEvent: any) {\n\tconst oSource = oEvent.getSource();\n\tconst sProperty = context.dialog.getModel().getProperty(\"/configuration/mainIndicatorStatusKey\");\n\tconst oModel = context?.dialog?.getModel();\n\n\toModel?.setProperty(\"/configuration/advancedFormattingOptions/targetFormatterProperty\", sProperty);\n\toModel?.setProperty(\"/configuration/advancedFormattingOptions/sourceUoMProperty\", sProperty);\n\n\tdisableOrEnableUOMAndTrend(oModel, sProperty);\n\tsetCriticalitySourceProperty(sProperty);\n\tsetAdvancedFormattingOptionsEnablement(sProperty);\n\n\tif (!context._advancedFormattingOptionsPopover) {\n\t\tFragment.load({\n\t\t\tid: \"advancedFormattingOptions\",\n\t\t\tname: \"sap.cards.ap.generator.app.fragments.configuration.AdvancedFormattingOptions\",\n\t\t\tcontroller: {\n\t\t\t\tonFormatTypeSelection: (oEvent: any) => {\n\t\t\t\t\tconst sourceItem = oEvent.getParameter(\"item\");\n\t\t\t\t\tconst oModel = context.dialog.getModel();\n\t\t\t\t\tconst key = sourceItem.getKey();\n\t\t\t\t\toModel.setProperty(\"/configuration/popoverContentType\", key);\n\t\t\t\t\tconst aUom = oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\");\n\t\t\t\t\tconst sSourceUoMProperty = oModel.getProperty(\"/configuration/advancedFormattingOptions/sourceUoMProperty\");\n\t\t\t\t\tif (aUom.length > 0) {\n\t\t\t\t\t\tconst aSourceUom = aUom.filter((oProperty: any) => {\n\t\t\t\t\t\t\treturn oProperty.name === sSourceUoMProperty;\n\t\t\t\t\t\t})[0];\n\t\t\t\t\t\tif (aSourceUom) {\n\t\t\t\t\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", aSourceUom.value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (aPropsWithUoM.indexOf(sSourceUoMProperty) === -1) {\n\t\t\t\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", \"\");\n\t\t\t\t\t}\n\t\t\t\t\tonAdvancedFormattingConfigOpen(oEvent, oSource);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t\t.then(function (oPopover: any) {\n\t\t\t\tcontext._advancedFormattingOptionsPopover = oPopover;\n\t\t\t\toSource.addDependent(oPopover);\n\t\t\t\treturn oPopover;\n\t\t\t})\n\t\t\t.then(function (oPopover) {\n\t\t\t\tconst oContext = oSource.getBindingContext();\n\t\t\t\toPopover.setBindingContext(oContext);\n\t\t\t\toPopover.openBy(oSource);\n\t\t\t});\n\t} else {\n\t\tconst oContext = oSource.getBindingContext();\n\t\tcontext._advancedFormattingOptionsPopover.setBindingContext(oContext);\n\t\tcontext._advancedFormattingOptionsPopover.openBy(oSource);\n\t}\n}\n\nfunction onAdvancedFormattingConfigOpen(oEvent: any, oSource: any) {\n\tconst oModel = context?.dialog?.getModel();\n\tconst oConfigurationController = {\n\t\tonPopoverClose: (oEvent: any) => {\n\t\t\tconst source = oEvent.getSource();\n\t\t\tsource?.destroy();\n\t\t},\n\t\t// applyCriticalityFormattingForHeader: () => { },\n\t\tonPropertyFormatterChange: () => {\n\t\t\tupdateArrangements();\n\t\t\tconst buttonId = oSource?.getId();\n\t\t\tconst oPopover = CoreElement.getElementById(buttonId + \"--advanceFormattingPopover\");\n\t\t\toPopover?.close();\n\t\t},\n\t\tapplyCriticality: () => applyCriticality(oEvent),\n\t\tapplyUoMFormatting: () => applyUoMFormatting(),\n\t\tapplyFormatting: () => {\n\t\t\tconst buttonId = oSource?.getId();\n\t\t\tCoreElement.getElementById(buttonId + \"--headerFormatterEditor\").applyFormatter();\n\t\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t\t},\n\t\tresetValueState(oEvent: any, isSelectControl?: boolean) {\n\t\t\tconst control = oEvent.getSource();\n\t\t\tconst currentValue = !isSelectControl ? oEvent.getParameters().newValue : control.getSelectedKey();\n\t\t\tif (currentValue !== \"\") {\n\t\t\t\tcontrol.setValueState(ValueState.None);\n\t\t\t}\n\t\t},\n\t\tonDownDifferenceChange(oEvent: any) {\n\t\t\toModel.setProperty(\"/configuration/trendOptions/downDifferenceValueState\", \"None\");\n\t\t\tthis.resetValueState(oEvent);\n\t\t},\n\t\tonUpDifferenceChange(oEvent: any) {\n\t\t\toModel.setProperty(\"/configuration/trendOptions/upDifferenceValueState\", \"None\");\n\t\t\tthis.resetValueState(oEvent);\n\t\t},\n\t\tonReferenceValInputChange(oEvent: any) {\n\t\t\toModel.setProperty(\"/configuration/trendOptions/referenceValueState\", \"None\");\n\t\t\tthis.resetValueState(oEvent);\n\t\t},\n\t\tonTargetValueChange(oEvent: any) {\n\t\t\toModel.setProperty(\"/configuration/indicatorsValue/targetValueState\", \"None\");\n\t\t\tthis.resetValueState(oEvent);\n\t\t},\n\t\tonDeviationValueChange(oEvent: any) {\n\t\t\toModel.setProperty(\"/configuration/indicatorsValue/deviationValueState\", \"None\");\n\t\t\tthis.resetValueState(oEvent);\n\t\t},\n\t\tonTargetUnitChange(oEvent: any) {\n\t\t\toModel.setProperty(\"/configuration/indicatorsValue/targetUnitValueState\", \"None\");\n\t\t\tthis.resetValueState(oEvent, true);\n\t\t},\n\t\tonDeviationUnitChange(oEvent: any) {\n\t\t\toModel.setProperty(\"/configuration/indicatorsValue/deviationUnitValueState\", \"None\");\n\t\t\tthis.resetValueState(oEvent, true);\n\t\t},\n\t\tapplyIndicators: () => {\n\t\t\tconst buttonId = oSource?.getId();\n\t\t\tconst hasIndicatorsError = validateIndicatorsValues(buttonId);\n\t\t\tif (!hasIndicatorsError) {\n\t\t\t\tupdateSideIndicatorsForHeader();\n\t\t\t\tcontext?._advancedFormattingConfigurationPopover?.close();\n\t\t\t}\n\t\t},\n\t\tapplyTrendCalculation: () => {\n\t\t\tconst buttonId = oSource?.getId();\n\t\t\tconst hasTrendError = validateTrendValues(buttonId);\n\t\t\tif (!hasTrendError) {\n\t\t\t\tupdateTrendForCardHeader();\n\t\t\t\tcontext?._advancedFormattingConfigurationPopover?.close();\n\t\t\t}\n\t\t},\n\t\tonDelete: () => {\n\t\t\tconst oModel = context?.dialog?.getModel();\n\t\t\tconst sourceUoMProperty: any = oModel?.getProperty(\"/configuration/advancedFormattingOptions/sourceUoMProperty\");\n\t\t\tconst iIndex = aPropsWithUoM?.indexOf(sourceUoMProperty);\n\t\t\taPropsWithUoM?.splice(iIndex, 1);\n\t\t\toModel?.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", \"\");\n\n\t\t\tconst itemsBindingPath: string = \"/configuration/advancedFormattingOptions/unitOfMeasures\",\n\t\t\t\tunitOfMeasures: any = oModel?.getProperty(itemsBindingPath);\n\t\t\tlet relativeIndex: number = -1;\n\n\t\t\tconst propertyValueFormatters = oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\");\n\t\t\tconst updatedPropertyValueFormatters = propertyValueFormatters.filter(\n\t\t\t\t(formatter: ValueFormatter) => formatter.property !== sourceUoMProperty\n\t\t\t);\n\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\", updatedPropertyValueFormatters);\n\t\t\tfor (let i = 0; i < unitOfMeasures.length; i++) {\n\t\t\t\tif (unitOfMeasures[i]?.name === sourceUoMProperty) {\n\t\t\t\t\trelativeIndex = i;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (relativeIndex >= 0 && itemsBindingPath) {\n\t\t\t\tconst sPath = itemsBindingPath + \"/\" + relativeIndex;\n\t\t\t\tunitOfMeasures?.splice(sPath.slice(sPath.length - 1), 1);\n\t\t\t\tupdateArrangements();\n\t\t\t\toModel?.refresh();\n\t\t\t}\n\t\t\tcontext?._advancedFormattingConfigurationPopover?.close();\n\t\t},\n\t\tonTrendDelete: () => onTrendDelete(),\n\t\tonIndicatorsDelete: () => {\n\t\t\tconst oModel = context?.dialog?.getModel();\n\t\t\tconst indicatorsValue = oModel.getProperty(\"/configuration/indicatorsValue\");\n\t\t\tconst selectedIndicatorValues = oModel.getProperty(\"/configuration/selectedIndicatorOptions\");\n\t\t\tlet iIndex: number = -1;\n\t\t\tselectedIndicatorValues?.forEach((trend: any, index: number) => {\n\t\t\t\tif (trend.sourceProperty === indicatorsValue.sourceProperty) {\n\t\t\t\t\tiIndex = index;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (iIndex !== -1) {\n\t\t\t\tselectedIndicatorValues.splice(iIndex, 1);\n\t\t\t}\n\t\t\toModel.setProperty(\"/configuration/indicatorsValue\", {});\n\t\t\tupdateSideIndicatorsForHeader();\n\t\t\tcontext?._advancedFormattingConfigurationPopover?.close();\n\t\t},\n\t\tonDeleteFormatter: () => {\n\t\t\tconst buttonId = oSource?.getId();\n\t\t\tCoreElement.getElementById(buttonId + \"--headerFormatterEditor\").deleteFormatter();\n\t\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t\t},\n\t\tonDeleteCriticality: () => {\n\t\t\tconst oModel = context.dialog.getModel();\n\t\t\tconst buttonId = oSource?.getId();\n\t\t\tCoreElement.getElementById(buttonId + \"--headerCriticalityEditor\")._onDeleteButtonClicked();\n\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/selectedKeyCriticality\", \"\");\n\t\t\tupdateCriticality(false);\n\t\t\tcontext?._advancedFormattingConfigurationPopover?.close();\n\t\t}\n\t};\n\n\tif (oEvent?.getParameter(\"item\")?.getKey?.() === \"uom\") {\n\t\toConfigurationController.applyUoMFormatting();\n\t}\n\tif (oEvent.getSource()?.getParent()?.close) {\n\t\toEvent.getSource().getParent().close();\n\t}\n\n\tloadAdvancedFormattingConfigurationFragment(oSource, oConfigurationController);\n}\n\nfunction applyCriticality(oEvent: Event) {\n\tconst oModel = context?.dialog?.getModel();\n\tconst mainIndicatorCriticality = oModel?.getProperty(\"/configuration/mainIndicatorOptions/criticality\");\n\tlet sourceCriticalityProperty = oModel?.getProperty(\"/configuration/advancedFormattingOptions/sourceCriticalityProperty\");\n\tsourceCriticalityProperty = sourceCriticalityProperty?.[0];\n\n\tif (sourceCriticalityProperty?.hostCriticality !== sourceCriticalityProperty?.criticality) {\n\t\tsourceCriticalityProperty.criticality = sourceCriticalityProperty.hostCriticality;\n\t}\n\n\tconst propertyExists: boolean = mainIndicatorCriticality?.some((indicatorCriticality: Property) => {\n\t\treturn indicatorCriticality?.name === sourceCriticalityProperty?.name;\n\t});\n\n\tif (!propertyExists && sourceCriticalityProperty) {\n\t\tdelete sourceCriticalityProperty.hostCriticality;\n\t\tmainIndicatorCriticality?.push(sourceCriticalityProperty);\n\t} else {\n\t\tfor (let i = 0; i < mainIndicatorCriticality.length; i++) {\n\t\t\tif (mainIndicatorCriticality[i]?.name === sourceCriticalityProperty?.name) {\n\t\t\t\tdelete mainIndicatorCriticality[i];\n\t\t\t\tdelete sourceCriticalityProperty.hostCriticality;\n\t\t\t\tmainIndicatorCriticality[i] = sourceCriticalityProperty;\n\t\t\t}\n\t\t}\n\t}\n\n\toModel?.setProperty(\"/configuration/mainIndicatorOptions/criticality\", mainIndicatorCriticality);\n\tupdateCriticality(oEvent.getParameter(\"isCalcuationType\") || false);\n\tcontext?._advancedFormattingConfigurationPopover?.close();\n}\n\nfunction applyUoMFormatting() {\n\tconst oModel = context?.dialog?.getModel();\n\tconst unitOfMeasures = oModel?.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\tsourceProperty: string = oModel.getProperty(\"/configuration/advancedFormattingOptions/sourceUoMProperty\");\n\tlet relavantProperty = unitOfMeasures?.filter((property: Property) => property?.name === sourceProperty),\n\t\ttargetProperty: string = oModel?.getProperty(\"/configuration/advancedFormattingOptions/targetProperty\");\n\trelavantProperty = relavantProperty?.[0];\n\n\tif (!targetProperty && relavantProperty) {\n\t\toModel?.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", relavantProperty?.propertyKeyForDescription);\n\t}\n\n\ttargetProperty = oModel?.getProperty(\"/configuration/advancedFormattingOptions/targetProperty\");\n\tconst oData = {\n\t\tpropertyKeyForDescription: targetProperty,\n\t\tname: sourceProperty,\n\t\tpropertyKeyForId: sourceProperty,\n\t\tvalue: targetProperty\n\t};\n\tlet bMatchingProperty = false;\n\tunitOfMeasures.forEach((oUom: any) => {\n\t\tif (oUom.name === oData.name) {\n\t\t\tbMatchingProperty = true;\n\t\t\toUom.propertyKeyForDescription = oData.value;\n\t\t\toUom.value = oData.value;\n\t\t}\n\t});\n\tif (!bMatchingProperty && sourceProperty && targetProperty) {\n\t\tunitOfMeasures.push(oData);\n\t}\n\toModel.setProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\", unitOfMeasures);\n\tupdateArrangements();\n\tfor (let i = 0; i < unitOfMeasures.length; i++) {\n\t\tif (unitOfMeasures[i].value !== \"\" && aPropsWithUoM?.indexOf(unitOfMeasures[i]?.name) === -1) {\n\t\t\taPropsWithUoM?.push(unitOfMeasures[i]?.name);\n\t\t}\n\t}\n\tcontext?._advancedFormattingConfigurationPopover?.close();\n}\n\nfunction onTrendDelete() {\n\tconst oModel = context?.dialog?.getModel();\n\tconst trendValues = oModel.getProperty(\"/configuration/trendOptions\");\n\tconst selectedTrendValues = oModel.getProperty(\"/configuration/selectedTrendOptions\");\n\tlet iIndex: number = -1;\n\tselectedTrendValues?.forEach((trend: TrendOrIndicatorOptions, index: number) => {\n\t\tif (trend.sourceProperty === trendValues.sourceProperty) {\n\t\t\tiIndex = index;\n\t\t}\n\t});\n\tif (iIndex !== -1) {\n\t\tselectedTrendValues.splice(iIndex, 1);\n\t}\n\toModel.setProperty(\"/configuration/trendOptions\", {});\n\tupdateTrendForCardHeader();\n\tcontext?._advancedFormattingConfigurationPopover?.close();\n}\n\nfunction loadAdvancedFormattingConfigurationFragment(oSource: EventProvider, oConfigurationController: object) {\n\tFragment.load({\n\t\tid: oSource.getId(),\n\t\tname: \"sap.cards.ap.generator.app.fragments.configuration.AdvancedFormattingConfiguration\",\n\t\tcontroller: oConfigurationController\n\t})\n\t\t.then(function (oPopover: any) {\n\t\t\tcontext._advancedFormattingConfigurationPopover = oPopover;\n\t\t\tconst model = context.dialog.getModel();\n\t\t\tconst mainIndicatorUnitText = model.getProperty(\"/configuration/mainIndicatorStatusUnit\");\n\t\t\tconst oResourceBundle = context.dialog.getModel(\"i18n\").getResourceBundle();\n\t\t\tlet sUomText, sFormatterText, criticalityText;\n\t\t\tif (oSource.getBindingContext()) {\n\t\t\t\tconst sSelectedGroupItemPath = oSource.getBindingContext().sPath;\n\t\t\t\tconst sSelectedGroupProperty = model.getProperty(sSelectedGroupItemPath)?.label;\n\t\t\t\tconst sProperties: PropertyInfoMap = model.getProperty(\"/configuration/properties\");\n\t\t\t\tconst propertyLabelWithValue =\n\t\t\t\t\tsProperties?.filter((property) => {\n\t\t\t\t\t\treturn property.label === sSelectedGroupProperty;\n\t\t\t\t\t})[0].labelWithValue || sSelectedGroupProperty;\n\t\t\t\tsUomText = oResourceBundle.getText(\"SELECT_UOM_TEXT\", [propertyLabelWithValue]);\n\t\t\t\tsFormatterText = oResourceBundle.getText(\"SELECT_FORMATTER_TEXT\", [propertyLabelWithValue]);\n\t\t\t\tcriticalityText = oResourceBundle.getText(\"SELECT_CRITICALITY_TEXT\", [propertyLabelWithValue]);\n\t\t\t} else {\n\t\t\t\tsUomText = oResourceBundle.getText(\"SELECT_UOM_TEXT\", [mainIndicatorUnitText]);\n\t\t\t\tsFormatterText = oResourceBundle.getText(\"SELECT_FORMATTER_TEXT\", [mainIndicatorUnitText]);\n\t\t\t\tcriticalityText = oResourceBundle.getText(\"SELECT_CRITICALITY_TEXT\", [mainIndicatorUnitText]);\n\t\t\t}\n\t\t\tconst sIndicatorsText = oResourceBundle.getText(\"SELECT_INDICATORS_TEXT\", [mainIndicatorUnitText]);\n\t\t\tconst sTrendCalculatorText = oResourceBundle.getText(\"TREND_CALCULATION_TEXT\", [mainIndicatorUnitText]);\n\n\t\t\tconst mLabels = {\n\t\t\t\tuomText: sUomText,\n\t\t\t\tcriticalityText: criticalityText,\n\t\t\t\tformatterText: sFormatterText,\n\t\t\t\tindicatorsText: sIndicatorsText,\n\t\t\t\ttrendCalculatorText: sTrendCalculatorText\n\t\t\t};\n\t\t\toPopover.setModel(new JSONModel(mLabels), \"i18nLabelText\");\n\t\t\toSource.addDependent(oPopover);\n\t\t\treturn oPopover;\n\t\t})\n\t\t.then(function (oPopover) {\n\t\t\tconst oContext = oSource.getBindingContext();\n\t\t\toPopover.setBindingContext(oContext);\n\t\t\toPopover.openBy(oSource);\n\t\t\treturn oPopover;\n\t\t});\n}\n\nfunction onItemsActionsButtonPressed(oEvent: any) {\n\tconst oModel = context?.dialog?.getModel();\n\tconst sPath = oEvent?.getSource().getBindingContext().getPath();\n\tconst sourceProperty = oModel?.getProperty(sPath)?.name;\n\tconst oSource = oEvent.getSource();\n\tdisableOrEnableUOMAndTrend(oModel, sourceProperty);\n\tsetAdvancedFormattingOptionsEnablement(sourceProperty);\n\tconst oController = {\n\t\tonNavigationActionSelect: (oEvent: any) => {\n\t\t\tconst sId = oEvent.getParameter(\"item\").getId();\n\t\t\tconst oModel = context.dialog.getModel();\n\t\t\tif (sId === \"formatter\" || sId === \"uom\") {\n\t\t\t\toModel.setProperty(\"/configuration/popoverContentType\", sId);\n\t\t\t\tconst sPath = oEvent.getSource().getBindingContext().getPath();\n\t\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/targetFormatterProperty\", oModel.getProperty(sPath).name);\n\t\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/sourceUoMProperty\", oModel.getProperty(sPath).name);\n\t\t\t\tconst aUom = oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\");\n\t\t\t\tconst sSourceUoMProperty = oModel.getProperty(\"/configuration/advancedFormattingOptions/sourceUoMProperty\");\n\t\t\t\tif (aUom.length > 0) {\n\t\t\t\t\tconst aSourceUom = aUom.filter((oProperty: any) => {\n\t\t\t\t\t\treturn oProperty.name === sSourceUoMProperty;\n\t\t\t\t\t})[0];\n\t\t\t\t\tif (aSourceUom) {\n\t\t\t\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", aSourceUom.value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (aPropsWithUoM.length && aPropsWithUoM.indexOf(sSourceUoMProperty) === -1) {\n\t\t\t\t\toModel.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", \"\");\n\t\t\t\t}\n\t\t\t\tonAdvancedFormattingConfigOpen(oEvent, oEvent.getSource().getParent());\n\t\t\t} else if (sId === \"criticality\") {\n\t\t\t\toModel.setProperty(\"/configuration/popoverContentType\", sId);\n\t\t\t\tconst sPath = oEvent.getSource().getBindingContext().getPath();\n\t\t\t\tif (oModel.getProperty(sPath)?.name) {\n\t\t\t\t\tsetCriticalitySourceProperty(oModel.getProperty(sPath).name);\n\t\t\t\t}\n\t\t\t\tonAdvancedFormattingConfigOpen(oEvent, oEvent.getSource().getParent());\n\t\t\t} else if (sId === \"actions\") {\n\t\t\t\t// do nothing\n\t\t\t} else {\n\t\t\t\tconst sourceItem = oEvent.getParameter(\"item\");\n\t\t\t\tconst customData = sourceItem.getCustomData();\n\t\t\t\tconst customAction = customData.filter((custom: any) => custom.getKey() === \"action\")[0];\n\t\t\t\tconst actionType = customAction.getValue();\n\t\t\t\tconst source = oEvent.getSource();\n\t\t\t\tconst sPath = source.getBindingContext().getPath();\n\t\t\t\tconst [groupIndex, itemIndex] = sPath.match(/(\\d+)/g).map((sValue: any) => Number(sValue));\n\t\t\t\tconst group = oModel.getProperty(\"/configuration/groups/\" + groupIndex);\n\t\t\t\tconst item = group.items[itemIndex];\n\n\t\t\t\tif (actionType === \"add\") {\n\t\t\t\t\tlet value = \"\";\n\t\t\t\t\tconst key = sourceItem.getId();\n\n\t\t\t\t\tswitch (key) {\n\t\t\t\t\t\tcase \"url\":\n\t\t\t\t\t\t\tvalue = `${item.value}`;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"email\":\n\t\t\t\t\t\t\tvalue = `mailto: ${item.value}`;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"tel\":\n\t\t\t\t\t\t\tvalue = `tel: ${item.value}`;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value === \"\") {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst actions = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"Navigation\",\n\t\t\t\t\t\t\tparameters: {\n\t\t\t\t\t\t\t\turl: value\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\n\t\t\t\t\titem[\"hasActions\"] = true;\n\t\t\t\t\titem[\"actionType\"] = key;\n\t\t\t\t\titem[\"actions\"] = actions;\n\t\t\t\t}\n\n\t\t\t\tif (actionType === \"remove\" && item.hasActions) {\n\t\t\t\t\tdelete item.hasActions;\n\t\t\t\t\tdelete item.actionType;\n\t\t\t\t\tdelete item.actions;\n\t\t\t\t}\n\t\t\t}\n\t\t\toModel.refresh();\n\t\t\tupdateCardGroups(oModel);\n\t\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t\t}\n\t};\n\tif (!context._itemActionsMenu || context?._itemActionsMenu?.isDestroyed()) {\n\t\tFragment.load({\n\t\t\tname: \"sap.cards.ap.generator.app.fragments.configuration.ItemActions\",\n\t\t\tcontroller: oController\n\t\t}).then(\n\t\t\tfunction (oMenu: any) {\n\t\t\t\tcontext._itemActionsMenu = oMenu;\n\t\t\t\tconst oContext = oSource.getBindingContext();\n\t\t\t\toMenu.setBindingContext(oContext);\n\t\t\t\toSource.addDependent(oMenu);\n\t\t\t\tcontext._itemActionsMenu.open(false, oSource, Popup.Dock.BeginTop, Popup.Dock.BeginBottom, oSource);\n\t\t\t}.bind(oController)\n\t\t);\n\t} else {\n\t\tconst oContext = oSource.getBindingContext();\n\t\tcontext._itemActionsMenu.setBindingContext(oContext);\n\t\toSource.addDependent(context._itemActionsMenu);\n\t\tcontext._itemActionsMenu.open(false, oSource, Popup.Dock.BeginTop, Popup.Dock.BeginBottom, oSource);\n\t}\n}\n\nfunction onPreviewTypeChange(oEvent: any) {\n\tconst selectedCardType = oEvent.getSource().getSelectedItem().getBindingContext(\"previewOptions\").getProperty(\"type\");\n\tconst oCard: any = CoreElement.getElementById(\"cardGeneratorDialog--cardPreview\");\n\tconst oAdaptiveCardContainer: any = CoreElement.getElementById(\"cardGeneratorDialog--adaptiveCardPreviewContainer\");\n\tconst oCustomSize: any = CoreElement.getElementById(\"cardGeneratorDialog--custom-entry\");\n\toCard.setVisible(false);\n\toAdaptiveCardContainer.setVisible(false);\n\toCustomSize.setVisible(false);\n\tswitch (selectedCardType) {\n\t\tcase \"adaptive\":\n\t\t\toAdaptiveCardContainer.setVisible(true);\n\t\t\tsetTimeout(() => {\n\t\t\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t\t\t}, 0);\n\t\t\tbreak;\n\t\tcase \"custom\":\n\t\t\toCard.setVisible(true);\n\t\t\toCustomSize.setVisible(true);\n\t\t\tbreak;\n\t\tcase \"integration\":\n\t\t\toCard.setVisible(true);\n\t\t\toCard.setWidth(oEvent.getSource().getSelectedItem().getBindingContext(\"previewOptions\").getProperty(\"width\"));\n\t\t\toCard.setHeight(oEvent.getSource().getSelectedItem().getBindingContext(\"previewOptions\").getProperty(\"height\"));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\toCard.setVisible(true);\n\t\t\toCard.setWidth(oEvent.getSource().getSelectedItem().getBindingContext(\"previewOptions\").getProperty(\"width\"));\n\t\t\toCard.setHeight(oEvent.getSource().getSelectedItem().getBindingContext(\"previewOptions\").getProperty(\"height\"));\n\t\t\tbreak;\n\t}\n}\n\n/**\n * Update the sap.card.header of the integration card manifest by appling latest text arrangements, unit of measurement and formatters and triggers rendering of the card preview.\n * - This method is triggered when text arrrangement, unit of measurement or formatters are changed.\n */\nfunction updateHeaderArrangements() {\n\tconst oModel = context.dialog.getModel();\n\tconst currentManifest = getCurrentCardManifest();\n\tconst header = currentManifest[\"sap.card\"].header;\n\tconst subtitle = resolvePropertyPathFromExpression(header.subTitle, currentManifest);\n\tconst unitOfMeasurement = resolvePropertyPathFromExpression(header.unitOfMeasurement, currentManifest);\n\tconst mainIndicatorValue =\n\t\toModel.getProperty(\"/configuration/navigationValue\") || oModel.getProperty(\"/configuration/mainIndicatorStatusKey\");\n\tconst aUnitOfMeasures = oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\");\n\tconst aTextArrangements = oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\");\n\tconst aPropertyValueFormatters: FormatterConfigurationMap = oModel.getProperty(\n\t\t\"/configuration/advancedFormattingOptions/propertyValueFormatters\"\n\t);\n\n\tconst sapCardHeader = {\n\t\t\"sap.card\": {\n\t\t\theader: {\n\t\t\t\tmainIndicator: {\n\t\t\t\t\tnumber:\n\t\t\t\t\t\tmainIndicatorValue &&\n\t\t\t\t\t\tgetArrangements(`{${mainIndicatorValue}}`, {\n\t\t\t\t\t\t\tunitOfMeasures: aUnitOfMeasures,\n\t\t\t\t\t\t\ttextArrangements: aTextArrangements,\n\t\t\t\t\t\t\tpropertyValueFormatters: aPropertyValueFormatters\n\t\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tsubTitle: getArrangements(subtitle, {\n\t\t\t\t\tunitOfMeasures: aUnitOfMeasures,\n\t\t\t\t\ttextArrangements: aTextArrangements,\n\t\t\t\t\tpropertyValueFormatters: aPropertyValueFormatters\n\t\t\t\t}),\n\t\t\t\tunitOfMeasurement: getArrangements(unitOfMeasurement, {\n\t\t\t\t\tunitOfMeasures: aUnitOfMeasures,\n\t\t\t\t\ttextArrangements: aTextArrangements,\n\t\t\t\t\tpropertyValueFormatters: aPropertyValueFormatters\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t};\n\t\n\tconst oManifest = merge(currentManifest, sapCardHeader) as CardManifest;\n\trenderCardPreview(oManifest, context.dialog.getModel());\n}\n\nfunction updateArrangements() {\n\tconst oModel = context.dialog.getModel();\n\tupdateHeaderArrangements();\n\tconst groups: ObjectCardGroups[] = oModel.getProperty(\"/configuration/groups\");\n\tgroups?.forEach(function (group) {\n\t\tgroup?.items?.forEach((groupItem) => {\n\t\t\tif (groupItem.name && groupItem.name !== \"\") {\n\t\t\t\tconst groupItemValue = groupItem.isNavigationEnabled ? `${groupItem.name}/${groupItem.navigationProperty}` : groupItem.name;\n\t\t\t\tgroupItem.value = getArrangements(`{${groupItemValue}}`, {\n\t\t\t\t\tunitOfMeasures: oModel.getProperty(\"/configuration/advancedFormattingOptions/unitOfMeasures\"),\n\t\t\t\t\ttextArrangements: oModel.getProperty(\"/configuration/advancedFormattingOptions/textArrangements\"),\n\t\t\t\t\tpropertyValueFormatters: oModel.getProperty(\"/configuration/advancedFormattingOptions/propertyValueFormatters\")\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t});\n\toModel.refresh();\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\nfunction updateCriticality(isCalcuationType: boolean) {\n\tconst currentManifest = getCurrentCardManifest();\n\tconst oModel = context.dialog.getModel();\n\tconst mainIndicator = currentManifest[\"sap.card\"].header.mainIndicator;\n\tconst groups = (currentManifest[\"sap.card\"].content as ObjectContent).groups;\n\n\tif (!mainIndicator && groups.length < 1) {\n\t\treturn;\n\t}\n\tlet oManifest;\n\tif (mainIndicator) {\n\t\tconst mainIndicatorValue = resolvePropertyPathFromExpression(mainIndicator.number, currentManifest);\n\t\tconst sapCardHeader = {\n\t\t\t\"sap.card\": {\n\t\t\t\theader: {\n\t\t\t\t\tmainIndicator: {\n\t\t\t\t\t\tstate: getCriticality(mainIndicatorValue || mainIndicator.number, isCalcuationType)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\toManifest = merge(currentManifest, sapCardHeader) as CardManifest;\n\t} else {\n\t\toManifest = currentManifest;\n\t}\n\n\trenderCardPreview(oManifest, context.dialog.getModel());\n\tupdateCardGroups(oModel);\n\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n}\n\nasync function checkForNavigationProperty(event: Event) {\n\tconst selectedParameters = event.getParameters() as EventParameters;\n\tconst selectedItem = selectedParameters.selectedItem;\n\tif (!selectedItem) return;\n\tconst model = context.dialog.getModel() as JSONModel;\n\tconst navigationProperties: NavigationParameter[] = model.getProperty(\"/configuration/navigationProperty\") || [];\n\tconst selectedNavigationalProperties: NavigationalData[] = model.getProperty(\"/configuration/selectedNavigationalProperties\") || [];\n\n\tconst existingIndex = selectedNavigationalProperties.findIndex((navItem) => navItem.name === selectedItem.value);\n\tconst selectedProperty = navigationProperties.find((prop) => prop.name === selectedItem.value);\n\n\tconst { name: selectedPropertyName = \"\", properties: selectedPropertyValues = [] } = selectedProperty || {};\n\n\tconst data: NavigationalData = { name: selectedPropertyName, value: selectedPropertyValues };\n\n\tif (existingIndex === -1 && selectedProperty) {\n\t\tselectedNavigationalProperties.push(data);\n\t}\n\tmodel.setProperty(\"/configuration/selectedNavigationalProperties\", selectedNavigationalProperties);\n\n\tif (selectedProperty) {\n\t\tawait updateCardConfigurationData(selectedProperty.name, data);\n\t\tif (selectedParameters.textArrangementChanged) {\n\t\t\tselectedItem.navigationalPropertiesForId = data.value;\n\t\t\tselectedItem.isNavigationForId = data.value.length > 0;\n\t\t\tselectedItem.navigationKeyForId = \"\";\n\t\t} else {\n\t\t\tselectedItem.navigationalPropertiesForDescription = data.value;\n\t\t\tselectedItem.isNavigationForDescription = data.value.length > 0;\n\t\t\tselectedItem.navigationKeyForDescription = \"\";\n\t\t}\n\t\tselectedItem.value = \"\"; // to reset navigation combobox value in the card and dropdown.\n\t} else {\n\t\tif (selectedParameters.textArrangementChanged) {\n\t\t\tselectedItem.isNavigationForId = false;\n\t\t\tselectedItem.navigationKeyForId = \"\";\n\t\t} else {\n\t\t\tselectedItem.isNavigationForDescription = false;\n\t\t\tselectedItem.navigationKeyForDescription = \"\";\n\t\t}\n\t}\n}\n\nasync function toggleAdvancedSetting(toggleEvent: Event) {\n\tconst toggleButton: ToggleButton = toggleEvent.getSource();\n\ttoggleButton.setEnabled(false);\n\t\n\tconst splitter = CoreElement.getElementById(\"cardGeneratorDialog--contentSplitter\") as Splitter;\n\tconst controller = {\n\t\tonCriticalityChange: (criticalityChangeEvent: Event<{ isCalcuationType: boolean }>) => {\n\t\t\tupdateCriticality(criticalityChangeEvent.getParameter(\"isCalcuationType\") || false);\n\t\t},\n\t\tonArrangementsChange: async (arrangementChangeEvent: Event) => {\n\t\t\tawait checkForNavigationProperty(arrangementChangeEvent);\n\t\t\tupdateArrangements();\n\t\t\tconst dialogModel = context.dialog.getModel();\n\t\t\tconst groups = dialogModel.getProperty(\"/configuration/groups\");\n\n\t\t\tfor (let i = 0; i < groups?.[0].items.length; i++) {\n\t\t\t\tconst item = groups[0].items[i];\n\t\t\t\tconst uom = item.value.split(\" \")[1] && item.value.split(\" \")[1].slice(1, -1);\n\n\t\t\t\tif (uom !== \"undefined\" && uom !== undefined) {\n\t\t\t\t\tdialogModel.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", uom);\n\t\t\t\t} else if (uom === undefined) {\n\t\t\t\t\tdialogModel.setProperty(\"/configuration/advancedFormattingOptions/targetProperty\", \"\");\n\t\t\t\t}\n\n\t\t\t\tif (uom !== \"undefined\" && uom !== undefined && aPropsWithUoM?.indexOf(item?.name) === -1) {\n\t\t\t\t\taPropsWithUoM.push(item?.name);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonPropertyFormatterChangeFromAdvancedSettings: function () {\n\t\t\tupdateHeaderArrangements();\n\t\t}\n\t};\n\n\t\n\tawait Fragment.load({\n\t\tname: \"sap.cards.ap.generator.app.fragments.AdvancedSettings\",\n\t\tcontroller: controller\n\t}).then(function (advancedSettings: Control | Control[]) {\n\t\tif (!toggleButton.getPressed()) {\n\t\t\tconst lastContentArea = splitter.getContentAreas()[1]; // position 1 is the advance panel\n\t\t\tsplitter.removeContentArea(lastContentArea);\n\t\t} else {\n\t\t\tsplitter.insertContentArea(advancedSettings as Control, 1); // position 1 is the advance panel\n\t\t}\n\t\ttoggleButton.setEnabled(true);\n\t\tsetTimeout(() => {\n\t\t\ttranspileIntegrationCardToAdaptive(context.dialog.getModel());\n\t\t}, 0);\n\t});\n}\n\n"],"mappings":"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","ignoreList":[]}