/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/util/deepClone","sap/m/Button","sap/m/CheckBox","sap/m/ComboBox","sap/m/CustomListItem","sap/m/FlexBox","sap/m/HBox","sap/m/Input","sap/m/List","sap/m/Select","sap/m/StepInput","sap/m/Text","sap/m/VBox","sap/ui/core/Control","sap/ui/core/Item","sap/ui/core/ListItem","sap/ui/model/json/JSONModel","../../config/FormatterOptions","../../odata/ODataUtils"],function(t,e,r,o,s,a,n,i,p,l,c,m,u,d,f,h,y,g,C){"use strict";const w=g["getFormatterConfiguration"];const F=d.extend("sap.cards.ap.generator.app.controls.CompactFormatterSelection",{renderer:{apiVersion:2,render:function(t,e){if(e.getType()==="COMPACT"){e._deleteButton.setVisible(false);e._applyButton.setVisible(false)}t.openStart("div",e);t.openEnd();t.renderControl(e._selectorControl);t.renderControl(e._deleteButton);t.renderControl(e._List);t.renderControl(e._applyButton);t.close("div")}},metadata:{properties:{type:"string",formatters:"object"},aggregations:{_list:{type:"sap.m.List",multiple:false,visibility:"hidden"}},events:{change:{parameters:{value:{type:"object"}}}}},constructor:function t(e){d.prototype.constructor.call(this,e)},init:function t(){this._List=new p;d.prototype.init.call(this)},setFormatters:function t(e){this.setAggregation("_list",this._List);this.setProperty("formatters",e,true);const r=this.getModel();const o=r.getProperty("/configuration/advancedFormattingOptions/targetFormatterProperty");const s={};let a=e.find(t=>t.property===o)||s;const n=r.getData().configuration.properties;const i=n.find(t=>t.name===o)?.type||"";this.createControl(i);if(a.formatterName==="format.unit"&&typeof a.parameters?.[1].properties?.[0].value==="number"){const t=this.getModel("i18n");a.formatterName="format.float";a.displayName=t.getObject("FORMAT_FLOAT");if(a.parameters){a.parameters[0]=a.parameters[1]}a.parameters?.splice(1,1)}else if(a.formatterName==="format.unit"){a=s}this._refreshControl(a);if(a.formatterName){this._selectorControl.setSelectedKey(a.formatterName)}},_refreshControl:function t(e){const r=new y({listItems:[e]});this._List.bindItems({path:"/listItems",template:new s({content:[new u({justifyContent:"SpaceAround"}).bindAggregation("items",{path:"parameters",factory:this._createParametersControl.bind(this)})]})}).setModel(r)},createControl:function r(s){const a=this.getModel("i18n");let n=t(w());const i=C.isPropertyTypeDate(s);const p=s==="Edm.Decimal"||s==="Edm.Int16"||s==="Edm.Int32"||s==="Edm.Double";n=n.filter(t=>t.visible===true);if(i){n=n.filter(t=>t.type==="Date")}else if(p){n=n.filter(t=>t.type==="numeric"||t.type==="string | numeric")}else{n=n.filter(t=>t.type==="string"||t.type==="string | numeric")}const l=new y({formattersList:n});this._selectorControl=new o({width:"80%",items:{path:"/formattersList",template:new h({key:"{formatterName}",text:"{displayName}"})},change:this.onFormatterSelected.bind(this)}).addStyleClass("sapUiTinyMarginBegin").setModel(l);this._deleteButton=new e({icon:"sap-icon://delete",type:"Transparent",press:this.deleteFormatter.bind(this)});this._applyButton=new e({text:a.getObject("FORMATTER_CONTROL_APPLY"),type:"Ghost",press:this.applyFormatter.bind(this)})},_createParametersControl:function t(e,o){const s=o.getProperty();const p=s.type;let l,u=[];if(p!=="object"){u=[new m({width:"200px",text:"{displayName} : "}).addStyleClass("sapUiTinyMarginTop sapUiTinyMarginBegin")]}switch(p){case"boolean":l=new r({width:"116px",selected:"{selected}"});break;case"enum":l=this._createSelectControl("{selectedKey}",s.options);break;case"object":{const t=[];for(let e=0;e<s.properties.length;e++){const o=s.properties[e];if(o&&typeof o.value!=="object"){const s=[];const a=o.displayName;const p=o.type;switch(p){case"boolean":l=new r({width:"116px",selected:{path:"properties/"+e+"/selected/"}});break;case"enum":l=this._createSelectControl("{properties/"+e+"/selectedKey}",o.options);break;case"number":this.setDefaultStepInputValue(o);const t={path:`properties/${e}/value`};l=new c({width:"116px",min:0,max:2,value:t});break;default:l=new i({width:"176px",value:"{properties/"+e+"/value}"})}s.push(new m({width:"200px",text:a+" : "}).addStyleClass("sapUiTinyMarginTop sapUiTinyMarginBegin"));s.push(l);const u=new n({justifyContent:"Start",items:s});t.push(u)}}return new a({items:t,direction:"Column"})}default:l=new i({width:"108px",value:"{value}"});break}u.push(l);return new n({justifyContent:"Start",items:u})},setDefaultStepInputValue:function t(e){e.value=e.value>=0?e.value:e.defaultValue;return e},_createSelectControl:function t(e,r){const o=new l({width:"108px",selectedKey:e});for(const t of r){o.addItem(new f({text:t.name,key:t.value}))}return o},onFormatterSelected:function e(r){const o=this.getModel();const s=o.getProperty("/configuration/advancedFormattingOptions/targetFormatterProperty");const a=r.getSource();const n=a.getSelectedKey();const i=w().find(t=>t.formatterName===n);const p=n&&i?true:false;o.setProperty("/configuration/advancedFormattingOptions/isFormatterApplied",p);this._refreshControl(Object.assign({property:s},t(i)))},applyFormatter:function t(){const e=this._List.getModel().getProperty("/listItems");this._updatePropertyValueFormatters(e[0]);const r=this.getModel().getProperty("/configuration/advancedFormattingOptions/propertyValueFormatters");this.fireEvent("change",{value:r})},deleteFormatter:function t(){const e=this.getModel();const r=e.getProperty("/configuration/advancedFormattingOptions/targetFormatterProperty");const o=this.getFormatters();let s=-1;o.forEach((t,e)=>{if(t.property===r){s=e}});if(s!==-1){o.splice(s,1)}e.setProperty("/configuration/advancedFormattingOptions/propertyValueFormatters",o);const a={};this._refreshControl(a);this.fireEvent("change",{value:o});this._selectorControl.setSelectedKey("")},_updatePropertyValueFormatters:function t(e){if(e.parameters){const t=e.parameters.length;for(let r=0;r<t;r++){if(e.parameters[r].type==="string"){e.parameters[r].value=e.parameters[r].value||e.parameters[r].defaultValue}}}const r=e.property;const o=this.getFormatters();let s=-1;o.forEach((t,e)=>{if(t.property===r){s=e}});if(s!==-1){o[s]=e}else{o.push(e)}this.getModel().setProperty("/configuration/advancedFormattingOptions/propertyValueFormatters",o)}});return F});
//# sourceMappingURL=CompactFormatterSelection-dbg.js.map