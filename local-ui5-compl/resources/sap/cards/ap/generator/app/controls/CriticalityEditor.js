/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/ListItem","sap/ui/model/json/JSONModel","sap/m/CustomListItem","sap/m/Text","sap/m/HBox","sap/m/VBox","sap/m/List","sap/m/ComboBox","sap/m/Button","sap/ui/model/Filter","sap/ui/model/Sorter","sap/m/Input"],function(t,e,i,a,n,o,s,r,l,c,C,g,d){"use strict";return t.extend("sap.cards.ap.generator.app.controls.CriticalityEditor",{metadata:{properties:{selectionKeys:{type:"object",defaultValue:{}},items:{type:"object",defaultValue:{}},type:{type:"string",defaultValue:""}},aggregations:{_list:{type:"sap.m.List",multiple:false,visibility:"hidden"}},events:{change:{parameters:{value:{type:"object"},isCalcuationType:{type:"boolean"}}}}},_isPotentialCriticality:function(t){switch(t.type){case"Edm.Date":case"Edm.Boolean":case"Edm.Guid":case"Edm.DateTimeOffset":return false;case"Edm.Decimal":case"Edm.Byte":case"Edm.Int32":if(t.value>-2&&t.value<6){return true}return false;case"Edm.String":switch(t.value){case null:case"-1":case"0":case"1":case"2":case"2":case"3":case"4":case"5":case"Positive":case"Neative":case"Neutral":case"Critical":case"VeryNegative":case"VeryPositive":case"Information":return true;default:return false}default:return false}},constructor:function(){t.apply(this,arguments)},onAfterRendering:function(){var t=this;var e=JSON.parse(JSON.stringify(this.getSelectionKeys()));e.forEach(function(e){if(t._isPotentialCriticality(e)){e.category=t.getModel("i18n").getObject("CRITICALITY_CONTROL_SELECT_PROP")}else{e.category=t.getModel("i18n").getObject("CRITICALITY_CONTROL_SELECT_OTHERS")}e.name="{"+e[t._setSelectionKeysMap.name]+"}";e.label=e[t._setSelectionKeysMap.label]});this.aStaticCriticality=[{name:"Neutral",label:"Neutral",category:this.getModel("i18n").getObject("CRITICALITY_CONTROL_SELECT_CRITICALITY")},{name:"Good",label:"Positive",category:this.getModel("i18n").getObject("CRITICALITY_CONTROL_SELECT_CRITICALITY")},{name:"Critical",label:"Critical",category:this.getModel("i18n").getObject("CRITICALITY_CONTROL_SELECT_CRITICALITY")},{name:"Error",label:"Negative",category:this.getModel("i18n").getObject("CRITICALITY_CONTROL_SELECT_CRITICALITY")},{name:"Calculation",label:this.getModel("i18n").getObject("CRITICALITY_CONTROL_CREATE_CALC"),category:"Calculation:"}];var i=e.concat(this.aStaticCriticality);var a=this._oCriticalityComboBox.getModel("internal");a.setData(i,true);a.refresh()},setItems:function(t){var e=this;this.setProperty("items",t,true);this._itemsMap=this.getBindingInfo("items").parameters;this._oPropertyComboBox.bindProperty("selectedKey",this._itemsMap.name);this._oCriticalityComboBox.bindProperty("selectedKey",this._itemsMap.value);if(this.getType()==="COMPACT"){this._oCriticalityComboBox.setWidth("300px");const t=this.oCricitalityCalculator.getItems()?.length;if(t>0){this.oCricitalityCalculator.getItems()[t-1].setVisible(false)}}this._oList.bindItems(this.getBindingPath("items"),new a({content:[new o({justifyContent:this.getType()==="COMPACT"?"Start":"SpaceAround",items:this.getType()==="COMPACT"?[this._oCriticalityComboBox]:[this._oPropertyComboBox,this._separatorColon,this._oCriticalityComboBox,this._deleteButton]}),new o({justifyContent:this.getType()==="COMPACT"?"Start":"SpaceAround",items:[this.oCricitalityCalculator]})]}))},_getCriticalityModel:function(){return new i(this.aStaticCriticality)},setSelectionKeys:function(t){var i=this;this.setProperty("selectionKeys",t);this._setSelectionKeysMap=this.getBindingInfo("selectionKeys").parameters;this._oPropertyFilter=new C({path:i._setSelectionKeysMap.name});this._oPropertyComboBox.bindAggregation("items",{path:this.getBindingPath("selectionKeys"),length:500,filters:this._oPropertyFilter,factory:function(){return new e({key:"{"+i._setSelectionKeysMap.name+"}",text:"{"+i._setSelectionKeysMap.label+"}"})}});this._oCriticalityComboBox.setModel(this._getCriticalityModel(),"internal");this._oCriticalityComboBox.bindAggregation("items",{path:"internal>/",sorter:new g("category",true,true),length:500,factory:function(){return new e({key:"{internal>name}",text:"{internal>label}"})}})},getItems:function(){return this.getModel().getProperty(this.getBindingPath("items"))},init:function(){var t=this;this._oList=new r;this.setAggregation("_list",this._oList);this._oPropertyComboBox=new l({change:function(e){var i=e.getSource().getBindingContext().getPath();t.fireEvent("change",{value:t.getItems(),isCalcuationType:t.getModel().getProperty(i).activeCalculation})}});this._separatorColon=new n({text:":"}).addStyleClass("sapUiTinyMarginTop");this._oCriticalityComboBox=new l({change:function(e){var i=e.getSource().getBindingContext();var a=i.getPath();var n=this.getModel();var o=e.getSource().getSelectedKey();if(t.getType()==="COMPACT"){var s="/configuration/advancedFormattingOptions/sourceCriticalityProperty/0/activeCalculation";n.setProperty(s,i.getObject("hostCriticality")==="Calculation");n.setProperty("/configuration/advancedFormattingOptions/selectedKeyCriticality",o)}else{n.getProperty(a).activeCalculation=i.getObject("criticality")==="Calculation";n.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty/0/hostCriticality",o)}const r=o?true:false;n.setProperty("/configuration/advancedFormattingOptions/isCriticalityApplied",r);t.fireEvent("change",{value:t.getItems(),isCalcuationType:t.getModel().getProperty(a).activeCalculation})}});this._deleteButton=new c({icon:"sap-icon://delete",type:"Transparent",press:this._onDeleteButtonClicked.bind(this)});this.oCricitalityCalculator=new s({visible:"{= !!${activeCalculation} }",items:[new o({justifyContent:"SpaceAround",items:[new n({textAlign:"End",width:"150px",text:"{i18n>CRITICALITY_CONTROL_TOL_RANGE}"}).addStyleClass("sapUiTinyMarginTop"),new d({value:"{toleranceRangeLowValue}",placeholder:"{i18n>CRITICALITY_CONTROL_LOW}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd"),new d({value:"{toleranceRangeHighValue}",placeholder:"{i18n>CRITICALITY_CONTROL_HIGH}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd")]}),new o({justifyContent:"SpaceAround",items:[new n({textAlign:"End",width:"150px",text:"{i18n>CRITICALITY_CONTROL_DEV_RANGE}"}).addStyleClass("sapUiTinyMarginTop"),new d({value:"{deviationRangeLowValue}",placeholder:"{i18n>CRITICALITY_CONTROL_LOW}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd"),new d({value:"{deviationRangeHighValue}",placeholder:"{i18n>CRITICALITY_CONTROL_HIGH}",width:"80px"}).addStyleClass("sapUiTinyMarginBeginEnd")]}),new o({justifyContent:"SpaceAround",items:[new n({textAlign:"End",width:"150px",text:"{i18n>CRITICALITY_CONTROL_IMP_DIRECTION}"}).addStyleClass("sapUiTinyMarginTop"),new l({value:"{improvementDirection}",width:"176px",items:[new e({key:"{i18n>CRITICALITY_CONTROL_MINIMIZE}",text:"Minimize"}),new e({key:"{i18n>CRITICALITY_CONTROL_TARGET}",text:"Target"}),new e({key:"{i18n>CRITICALITY_CONTROL_MAXIMIZE}",text:"Maximize"})]}).addStyleClass("sapUiTinyMarginBeginEnd")]}),new o({justifyContent:"End",items:[new c({text:"{i18n>CRITICALITY_CONTROL_APPLY}",width:"176px",type:"Ghost",press:function(e){var i=e.getSource().getBindingContext().getPath();t.fireEvent("change",{value:t.getItems(),isCalcuationType:t.getModel().getProperty(i).activeCalculation})}}).addStyleClass("sapUiTinyMarginBeginEnd")]})]}).addStyleClass("sapUiTinyMarginBottom");this._addButton=new c({icon:"sap-icon://add",type:"Transparent",press:this._onAddButtonClicked.bind(this)})},_onAddButtonClicked:function(){var t=this.getModel();if(t){var e=t.getProperty(this.getBindingPath("items"));if(!e){e=[]}e.push({});t.refresh()}},_onDeleteButtonClicked:function(t){var e=this,i=this.getBindingPath("items"),a=this.getModel(),n=a.getProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty")||[],o=a.getProperty("/configuration/mainIndicatorOptions/criticality"),s;if(this.getType()==="COMPACT"){var r;if(n&&n.length===1){n=n[0];for(var l=0;l<o.length;l++){if((o[l]&&o[l].name)===(n&&n.name)){r=l}}s=r!==undefined?"/configuration/mainIndicatorOptions/criticality/"+r:"";a.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty",[]);i="/configuration/mainIndicatorOptions/criticality"}}else{s=t.getSource().getBindingContext().getPath();var c=a.getProperty(s)&&a.getProperty(s).name,C=n&&n[0]&&n[0].name;if(c===C){a.setProperty("/configuration/advancedFormattingOptions/sourceCriticalityProperty",[])}}if(s&&i){a.getProperty(i).splice(s.slice(s.length-1),1);a.refresh();this.fireEvent("change",{value:e.getItems()})}},renderer:{render:function(t,e){if(e.getType()==="COMPACT"){e._addButton.setVisible(false);e._oList.addStyleClass("sapUiTinyMarginBegin")}t.write("<div");t.writeControlData(e);t.writeClasses();t.write(">");t.renderControl(e._oList);t.renderControl(e._addButton);t.write("</div>")}}})});
//# sourceMappingURL=CriticalityEditor.js.map