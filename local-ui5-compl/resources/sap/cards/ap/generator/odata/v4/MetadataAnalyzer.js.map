{"version":3,"file":"MetadataAnalyzer.js","names":["sap","ui","define","___v2_MetadataAnalyzer","checkForDateType","Annotations","label","isPotentiallySensitive","isoCurrency","unit","getNavigationPropertyInfoFromEntity","model","entitySetName","metaModel","getMetaModel","entitySet","getObject","entityTypeName","$Type","entityType","navigationalData","parameters","Object","keys","filter","property","propertyDef","$kind","$isCollection","forEach","navigationProp","navigationBinding","$NavigationPropertyBinding","navEntitySetName","navEntitySet","navEntityTypeName","navEntityType","data","createNavigationObject","navigationVal","name","properties","push","annotations","map","type","getPropertyInfoFromEntity","oModel","sEntitySet","withNavigation","arguments","length","undefined","resourceModel","oMetaModel","oEntitySet","sEntityType","oEntityType","metaModelPropertiesAsObject","getMetaModelObjectForEntitySet","info","propertyCategory","getText","isDate","ISOCurrency","unitOfMeasure","UOM","$Path","category","kind","navigationProperties","navigationProperty","concat","getLabelForEntitySet","getPropertyReferenceKey","oAppModel","entityContainer","entitySetType","propertyRefKey","$Key","includes","getPropertiesFromEntityType","navigationPropertyNames","propertyName","navigationEntitySet","navigationEntityTypeName","complexProperties","complexPropertyNames","startsWith","complexPropertyType","complexType","__exports","__esModule"],"sources":["MetadataAnalyzer.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport ResourceBundle from \"sap/base/i18n/ResourceBundle\";\nimport ODataMetaModel from \"sap/ui/model/odata/v4/ODataMetaModel\";\nimport type ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport type { RequestQueryComplexProperties, RequestQueryNavigationProperties, RequestQueryParameters } from \"../../helpers/Batch\";\nimport { EntityType, NavigationParameter, NavigationParameters } from \"../../helpers/CardGeneratorModel\";\nimport { PropertyInfo } from \"../ODataTypes\";\nimport { checkForDateType } from \"../v2/MetadataAnalyzer\";\n\nconst Annotations = {\n\tlabel: \"@com.sap.vocabularies.Common.v1.Label\",\n\tisPotentiallySensitive: \"@com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive\",\n\tisoCurrency: \"@Org.OData.Measures.V1.ISOCurrency\",\n\tunit: \"@Org.OData.Measures.V1.Unit\"\n};\n\nexport function getNavigationPropertyInfoFromEntity(model: ODataModel, entitySetName: string): NavigationParameter[] {\n\tconst metaModel: ODataMetaModel = model.getMetaModel();\n\tconst entitySet = metaModel.getObject(\"/\" + entitySetName);\n\tconst entityTypeName = entitySet.$Type;\n\tconst entityType = metaModel.getObject(\"/\" + entityTypeName);\n\tconst navigationalData: NavigationParameters = { parameters: [] };\n\tObject.keys(entityType)\n\t\t.filter((property) => {\n\t\t\tconst propertyDef = entityType[property];\n\t\t\treturn typeof propertyDef === \"object\" && propertyDef.$kind === \"NavigationProperty\" && !propertyDef.$isCollection;\n\t\t})\n\t\t.forEach((navigationProp) => {\n\t\t\tconst navigationBinding = entitySet.$NavigationPropertyBinding;\n\t\t\tif (navigationBinding && navigationProp in navigationBinding) {\n\t\t\t\tconst navEntitySetName = navigationBinding[navigationProp];\n\t\t\t\tif (navEntitySetName !== entitySetName) {\n\t\t\t\t\tconst navEntitySet = metaModel.getObject(\"/\" + navEntitySetName);\n\t\t\t\t\tconst navEntityTypeName = navEntitySet?.$Type;\n\t\t\t\t\tconst navEntityType = metaModel.getObject(\"/\" + navEntityTypeName);\n\t\t\t\t\tconst data = createNavigationObject(navEntityType, navEntityTypeName, metaModel);\n\t\t\t\t\tconst navigationVal: NavigationParameter = {\n\t\t\t\t\t\tname: navigationProp,\n\t\t\t\t\t\tproperties: data\n\t\t\t\t\t};\n\t\t\t\t\tnavigationalData.parameters.push(navigationVal);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\treturn navigationalData.parameters;\n}\n\nfunction createNavigationObject(entityType: EntityType, entityTypeName: string, metaModel: ODataMetaModel): PropertyInfo[] {\n\treturn Object.keys(entityType)\n\t\t.filter((property) => {\n\t\t\tconst propertyDef = entityType[property];\n\t\t\tconst annotations = metaModel.getObject(`/${entityTypeName}/${property}@`);\n\t\t\treturn (\n\t\t\t\tproperty !== \"SAP__Messages\" &&\n\t\t\t\ttypeof propertyDef === \"object\" &&\n\t\t\t\t(propertyDef.$kind === \"Property\" || propertyDef.$kind === \"NavigationProperty\") &&\n\t\t\t\t!annotations?.[Annotations.isPotentiallySensitive]\n\t\t\t);\n\t\t})\n\t\t.map((property) => {\n\t\t\tconst propertyDef = entityType[property];\n\t\t\tconst annotations = metaModel.getObject(`/${entityTypeName}/${property}@`);\n\t\t\treturn {\n\t\t\t\tlabel: annotations?.[Annotations.label] || property,\n\t\t\t\ttype: propertyDef.$Type,\n\t\t\t\tname: property\n\t\t\t};\n\t\t});\n}\n\nexport function getPropertyInfoFromEntity(\n\toModel: ODataModel,\n\tsEntitySet: string,\n\twithNavigation = false,\n\tresourceModel?: ResourceBundle\n): PropertyInfo[] {\n\tconst oMetaModel = oModel.getMetaModel();\n\tconst oEntitySet = oMetaModel.getObject(\"/\" + sEntitySet);\n\tconst sEntityType = oEntitySet.$Type;\n\tconst oEntityType = oMetaModel.getObject(\"/\" + sEntityType);\n\tconst metaModelPropertiesAsObject = getMetaModelObjectForEntitySet(oMetaModel, sEntitySet);\n\tlet info: PropertyInfo[] = [];\n\n\tconst properties = metaModelPropertiesAsObject.properties.map((propertyDef) => {\n\t\tconst propertyCategory = resourceModel?.getText(\"CRITICALITY_CONTROL_SELECT_PROP\");\n\t\tconst annotations = oMetaModel.getObject(`/${sEntityType}/${propertyDef.name}@`);\n\t\tconst isDate = checkForDateType(propertyDef);\n\t\tconst ISOCurrency = annotations?.[Annotations.isoCurrency];\n\t\tconst unitOfMeasure = annotations?.[Annotations.unit];\n\t\tlet UOM = \"\";\n\n\t\tif (ISOCurrency) {\n\t\t\tUOM = ISOCurrency?.$Path || ISOCurrency;\n\t\t} else if (unitOfMeasure) {\n\t\t\tUOM = unitOfMeasure?.$Path || unitOfMeasure;\n\t\t}\n\n\t\treturn {\n\t\t\tlabel: annotations?.[Annotations.label] || propertyDef.name,\n\t\t\ttype: propertyDef.$Type,\n\t\t\tname: propertyDef.name,\n\t\t\t...(withNavigation && { category: propertyCategory }),\n\t\t\tkind: propertyDef.$kind,\n\t\t\tUOM,\n\t\t\tisDate\n\t\t};\n\t});\n\n\tif (withNavigation) {\n\t\tconst navigationProperties = metaModelPropertiesAsObject.navigationProperties.map((navigationProperty) => {\n\t\t\tconst propertyDef = oEntityType[navigationProperty.name];\n\t\t\tconst propertyCategory = resourceModel?.getText(\"GENERATOR_CARD_SELECT_NAV_PROP\");\n\t\t\treturn {\n\t\t\t\tlabel: navigationProperty.name,\n\t\t\t\ttype: propertyDef.$Type,\n\t\t\t\tname: navigationProperty.name,\n\t\t\t\tcategory: propertyCategory,\n\t\t\t\tkind: propertyDef.$kind,\n\t\t\t\tUOM: \"\",\n\t\t\t\tisDate: false\n\t\t\t};\n\t\t});\n\t\tinfo = info.concat(navigationProperties);\n\t}\n\treturn info.concat(properties);\n}\n\nexport function getLabelForEntitySet(oModel: ODataModel, sEntitySet: string) {\n\tconst oMetaModel = oModel.getMetaModel();\n\tconst entitySet = oMetaModel.getObject(\"/\" + sEntitySet);\n\tconst sEntityType = entitySet.$Type;\n\tconst annotations = oMetaModel.getObject(\"/\" + sEntityType + \"@\");\n\treturn annotations[Annotations.label] || sEntitySet;\n}\n\nexport function getPropertyReferenceKey(oAppModel: ODataModel, entitySetName: string) {\n\tconst entityContainer = oAppModel.getMetaModel().getObject(\"/\");\n\tconst entitySet = entityContainer[entitySetName];\n\tconst entitySetType = entitySet?.$Type;\n\tconst propertyRefKey = oAppModel.getMetaModel().getObject(\"/\" + entitySetType)?.$Key;\n\tconst properties = getPropertyInfoFromEntity(oAppModel, entitySetName, false);\n\treturn properties.filter((property) => propertyRefKey.includes(property.name));\n}\n\nfunction getPropertiesFromEntityType(metaModel: ODataMetaModel, entityType: EntityType, entityTypeName: string): PropertyInfo[] {\n\tconst properties: PropertyInfo[] = [];\n\n\tObject.keys(entityType).forEach((property) => {\n\t\tconst propertyDef = entityType[property];\n\t\tconst isPotentiallySensitive = metaModel.getObject(`/${entityTypeName}/${property}@`)?.[Annotations.isPotentiallySensitive];\n\t\tif (\n\t\t\tproperty !== \"SAP__Messages\" &&\n\t\t\ttypeof propertyDef === \"object\" &&\n\t\t\tpropertyDef.$kind === \"Property\" &&\n\t\t\t!isPotentiallySensitive\n\t\t) {\n\t\t\tproperties.push({\n\t\t\t\t...propertyDef,\n\t\t\t\t...{ name: property }\n\t\t\t});\n\t\t}\n\t});\n\n\treturn properties;\n}\n\nexport function getMetaModelObjectForEntitySet(metaModel: ODataMetaModel, entitySetName: string): RequestQueryParameters {\n\tconst entitySet = metaModel.getObject(`/${entitySetName}`);\n\tconst entityTypeName = entitySet.$Type;\n\tconst entityType = metaModel.getObject(`/${entityTypeName}`);\n\tconst properties = getPropertiesFromEntityType(metaModel, entityType, entityTypeName);\n\n\tconst navigationPropertyNames = Object.keys(entityType).filter((property) => {\n\t\tconst propertyDef = entityType[property];\n\t\treturn typeof propertyDef === \"object\" && propertyDef.$kind === \"NavigationProperty\" && !propertyDef.$isCollection;\n\t});\n\n\tconst navigationProperties: RequestQueryNavigationProperties[] = [];\n\tnavigationPropertyNames.forEach((propertyName) => {\n\t\tconst navigationEntitySet = metaModel.getObject(`/${entitySetName}/${propertyName}`);\n\t\tconst navigationEntityTypeName = navigationEntitySet.$Type;\n\t\tconst entityType = metaModel.getObject(`/${entitySetName}/${navigationEntityTypeName}`);\n\t\tconst properties = getPropertiesFromEntityType(metaModel, entityType, navigationEntityTypeName);\n\t\tnavigationProperties.push({\n\t\t\tname: propertyName,\n\t\t\tproperties: properties\n\t\t});\n\t});\n\n\tconst complexProperties: RequestQueryComplexProperties[] = [];\n\tconst complexPropertyNames = Object.keys(entityType).filter((property) => {\n\t\tconst propertyDef = entityType[property];\n\t\treturn typeof propertyDef === \"object\" && propertyDef.$kind === \"Property\" && !propertyDef.$Type?.startsWith(\"Edm.\");\n\t});\n\n\tcomplexPropertyNames.forEach((propertyName) => {\n\t\tconst property = metaModel.getObject(`/${entitySetName}/${propertyName}`);\n\t\tconst complexPropertyType = property.$Type;\n\t\tconst complexType = metaModel.getObject(`/${entitySetName}/${complexPropertyType}`);\n\t\tconst properties = getPropertiesFromEntityType(metaModel, complexType, complexPropertyType);\n\t\tcomplexProperties.push({\n\t\t\tname: propertyName,\n\t\t\tproperties: properties\n\t\t});\n\t});\n\n\treturn {\n\t\tproperties,\n\t\tnavigationProperties,\n\t\tcomplexProperties\n\t};\n}\n"],"mappings":"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","ignoreList":[]}