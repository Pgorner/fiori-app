/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/cards/ap/transpiler/cardTranspiler/Transpile","sap/fe/navigation/SelectionVariant","../helpers/ApplicationInfo","../helpers/I18nHelper","../odata/ODataUtils"],function(e,t,n,r,a){"use strict";function o(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const s=e["convertIntegrationCardToAdaptive"];const i=n["ODataModelVersion"];const c=n["fetchApplicationInfo"];const l=r["resolvei18nTextsForIntegrationCard"];const u=a["createContextParameter"];var f=function(e){e["INTEGRATION"]="integration";e["ADAPTIVE"]="adaptive";return e}(f||{});const d=(e,t,n)=>{const r=e===f.INTEGRATION?"manifest.json":"adaptive-manifest.json";const a=n["sap.cards.ap"];if(a===undefined||Object.keys(a).length===0){return""}const o=a["embeds"]["ObjectPage"];if(o===undefined||Object.keys(o["manifests"]).length===0){return""}const s=o["manifests"][t||o.default][0];const i=s.localUri.endsWith("/")?s.localUri:s.localUri+"/";return"/"+i+r};const p=e=>{if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e};const h=function(e){return Promise.resolve(o(function(){return Promise.resolve(fetch(e)).then(function(e){return Promise.resolve(e.json())})},function(){return null}))};const m=function(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;try{function r(){const e=d(o||f.INTEGRATION,a,s);if(e.length===0){return Promise.reject("No cards available for this application")}const t=c.endsWith("/")?c.substring(0,c.length-1)+e:c+e;return h(t)}const{entitySet:a,cardType:o}=t;let s=e.getManifest();const i=s["sap.platform.abap"];const c=i?.uri||"";const l=function(){if(n){return Promise.resolve(h(c+"/manifest.json")).then(function(e){s=e})}}();return Promise.resolve(l&&l.then?l.then(r):r(l))}catch(u){return Promise.reject(u)}};const P=function(e,n){try{const{semanticObject:r,action:a,entitySetWithObjectContext:o,appModel:s,odataModel:c}=n;const l=e["sap.card"]["header"];const f={};const d=new t;const h=c===i.V4;return Promise.resolve(u(o,s,h)).then(function(e){e.split(",").forEach(function(e){const[t,n]=e.split("=");f[t]=n;d.addSelectOption(t,"I","EQ",n)});f["sap-xapp-state-data"]=JSON.stringify({selectionVariant:p(d.toJSONObject())});l.actions=[{type:"Navigation",parameters:{ibnTarget:{semanticObject:r,action:a},ibnParams:f}}]})}catch(e){return Promise.reject(e)}};const g=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;const n=e.getManifest();return!(!n["sap.cards.ap"]&&!t)};const v=function(e,t){const n=e.getManifest();const r=n["sap.cards.ap"]?.embeds.ObjectPage;if(r&&Object.keys(r["manifests"]).length>0){const e=r?.["default"];const n=e&&r["manifests"][e]?.[0]?.hideActions||false;const a=t?.["sap.card"]?.configuration?.parameters;if(n&&a?._adaptiveFooterActionParameters){delete a["_adaptiveFooterActionParameters"]}if(n&&a?.footerActionParameters){delete a["footerActionParameters"]}if(n&&t?.["sap.card"]?.footer){delete t["sap.card"]["footer"]}}};const O=function(e){try{return Promise.resolve(c(e)).then(function(e){const{entitySetWithObjectContext:t,appModel:n,odataModel:r}=e;const a=r===i.V4;return Promise.resolve(u(t,n,a)).then(function(e){return e.split(",").map(e=>{const[t,n]=e.split("=");const r=n.replace("guid","").replaceAll("'","");return{key:t,formattedValue:r}})})})}catch(e){return Promise.reject(e)}};function y(e){const t=e["sap.card"].header.data;if(t?.path&&t.path!=="/header/d/"){t.path="/header/d/"}}const j=function(e,t){try{const n=t?.isDesignMode;if(!g(e,n??false)){return Promise.reject("No cards available for this application")}return Promise.resolve(c(e,{isDesignMode:n})).then(function(n){const{componentName:r,entitySet:a,context:o,resourceBundle:i,semanticObject:c,action:u}=n;const d={cardType:f.INTEGRATION,componentName:r,entitySet:a,context:o};return Promise.resolve(m(e,d,t?.isDesignMode??false)).then(function(r){return!r||Object.keys(r).length===0?Promise.reject("No cards available for this application"):Promise.resolve(O(e)).then(function(a){if(t?.hideActions??true){v(e,r)}const o=t?.cardType||f.INTEGRATION;if(o===f.INTEGRATION){function p(){y(r);return l(r,i)}r["sap.card"]["data"]["request"]["headers"]["Accept-Language"]??="{{parameters.LOCALE}}";const h=r["sap.card"].configuration.parameters;const m=r["sap.card"]["data"];const g=m["request"]["batch"]["content"]["url"];if(g.includes("{{parameters.contextParameters}}")){r["sap.card"]["configuration"]["parameters"]["contextParameters"]={type:"string",value:d.context}}a.forEach(e=>{if(h[e.key]!==undefined){h[e.key]["value"]=e.formattedValue}});const O=function(){if(t?.includeActions??true){return Promise.resolve(P(r,n)).then(function(){})}}();return O&&O.then?O.then(p):p(O)}else{const j=l(r,i);return s(j,`${c}-${u}`,a)}})})})}catch(e){return Promise.reject(e)}};var b={__esModule:true};b.CardTypes=f;b.getCardPath=d;b.fetchManifest=h;b._getObjectPageCardManifest=m;b.getKeyParameters=O;b.getObjectPageCardManifestForPreview=j;return b});
//# sourceMappingURL=RetrieveCard-dbg.js.map