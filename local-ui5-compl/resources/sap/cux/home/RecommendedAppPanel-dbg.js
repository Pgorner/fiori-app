/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/IllustratedMessageType","sap/m/library","sap/m/Link","sap/m/MessageStrip","sap/m/MessageToast","sap/m/VBox","sap/ui/core/EventBus","./BaseAppPersPanel","./MenuItem","./utils/Constants","./utils/Device","./utils/FESRUtil","./utils/HttpHelper"],function(e,t,n,s,o,i,r,a,c,u,p,l,d,g,m){"use strict";function h(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function f(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const _=s["BackgroundDesign"];function R(e,t){try{var n=e()}catch(e){return t(true,e)}if(n&&n.then){return n.then(t.bind(null,false),t.bind(null,true))}return t(false,n)}const y=h(u);const E=h(p);const T=l["FEATURE_TOGGLES"];const S=l["REPO_BASE_URL"];const P=l["SETTINGS_PANELS_KEYS"];const M=d["DeviceType"];const v=g["addFESRId"];const A=h(m);const B={USER_PREFERENCE_SRVC_URL:`${S}UserPreference`,KEY:"recommendedApps"};const b=y.extend("sap.cux.home.RecommendedAppPanel",{metadata:{library:"sap.cux.home",defaultAggregation:"apps",aggregations:{apps:{type:"sap.cux.home.App",singularName:"app",multiple:true,visibility:"hidden"}}},constructor:function e(t,n){y.prototype.constructor.call(this,t,n);this.setSupported(false)},init:function e(){y.prototype.init.call(this);this.setProperty("key",B.KEY);this.setProperty("title",this._i18nBundle.getText("recommendedAppsTab"));const t=c.getInstance();t.subscribe("importChannel","recommendationSettingChanged",(e,t,n)=>{const s=n.showRecommendation;this.fireSupported({isSupported:s})});if(this.getDeviceType()!==M.Mobile){void this._enableRecommendationTab()}},_generateWrapper:function e(){const t=`${this.getId()}-recommendedPanelWrapper`;if(!this._controlMap.get(t)){this._controlMap.set(t,new a(t,{items:[this._generateMessageStrip(),y.prototype._generateWrapper.call(this)],backgroundDesign:_.Transparent}))}return this._controlMap.get(t)},loadApps:function e(){try{const e=this;return Promise.resolve(e.appManagerInstance.getRecommendedVisualizations(true)).then(function(t){t=t.map(t=>({...t,menuItems:e._getActions()}));e.destroyAggregation("apps",true);const n=e.generateApps(t);e.setApps(n)})}catch(e){return Promise.reject(e)}},_generateMessageStrip:function e(){const t=`${this.getId()}-messageStrip`;if(!this._controlMap.get(t)){this._controlMap.set(t,new i(t,{text:this._i18nBundle.getText("recommendationMessageStrip"),showIcon:true,showCloseButton:true,link:new o(`${t}-settings`,{text:this._i18nBundle.getText("settings"),press:()=>this.getParent()?._getLayout()?.openSettingsDialog(P.ADVANCED)}).addStyleClass("sapUiNoMargin")}).addStyleClass("sapUiNoMarginBegin sapUiTinyMarginBottom"))}return this._controlMap.get(t)},_getActions:function e(){const t=new E({title:this._i18nBundle.getText("addToFavorites"),icon:"sap-icon://add-favorite",press:e=>{void this._addAppToFavorites(e)}});v(t,"acceptRecommendation");const n=new E({title:this._i18nBundle.getText("notRelevantRecommendation"),icon:"sap-icon://decline",press:e=>{void this._rejectRecommendation(e)}});v(n,"rejectRecommendation");const s=[t,n];return s},_rejectRecommendation:function t(n){try{const t=this;t.setBusy(true);const s=R(function(){return f(function(){const e=n.getSource();const s=e.getParent();const o=s.getTitle();return Promise.resolve(t.appManagerInstance.getRecommendedVisualizations()).then(function(e){const n=e.find(e=>e.url===s.getUrl());const i=n?.fioriId;const a=function(){if(i){const e={AppId:i,Decision:1};return Promise.resolve(A.Post(B.USER_PREFERENCE_SRVC_URL,e)).then(function(){return Promise.resolve(t.refresh()).then(function(){const e=t._i18nBundle.getText("rejectRecommendationMsg",[o]);r.show(e)})})}}();if(a&&a.then)return a.then(function(){})})},function(t){e.error(t)})},function(e,n){t.setBusy(false);if(e)throw n;return n});return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_isRecommendationEnabled:function e(){try{const e=this;return Promise.resolve(e.appManagerInstance.isFeatureEnabled(T.RECOMMENDATION)).then(function(t){let n=false;const s=function(){if(t){return Promise.resolve(e.getPersonalization()).then(function(e){const t=e.showRecommendation??true;n=true;return t})}}();return s&&s.then?s.then(function(e){return n?e:false}):n?s:false})}catch(e){return Promise.reject(e)}},_enableRecommendationTab:function e(){try{const e=this;return Promise.resolve(e._isRecommendationEnabled()).then(function(t){e.setSupported(t);e.fireSupported({isSupported:t})})}catch(e){return Promise.reject(e)}},generateIllustratedMessage:function e(){const s=y.prototype.generateIllustratedMessage.call(this);s.setIllustrationType(n.Tent);s.setTitle(this._i18nBundle.getText("noRecommendationsTitle"));s.setDescription(this._i18nBundle.getText("noRecommendationsDescription"));s.addAdditionalContent(new t({text:this._i18nBundle.getText("settings"),tooltip:this._i18nBundle.getText("settings"),press:()=>this.getParent()?._getLayout()?.openSettingsDialog(P.ADVANCED),type:"Emphasized"}));return s}});return b});
//# sourceMappingURL=RecommendedAppPanel-dbg.js.map