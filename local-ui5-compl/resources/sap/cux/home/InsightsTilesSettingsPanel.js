/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/m/Button","sap/m/Column","sap/m/ColumnListItem","sap/m/FlexBox","sap/m/HBox","sap/m/MessageBox","sap/m/MessageToast","sap/m/ObjectIdentifier","sap/m/ScrollContainer","sap/m/SearchField","sap/m/Switch","sap/m/Table","sap/m/Text","sap/m/Title","sap/m/VBox","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/dnd/DragDropInfo","./BaseSettingsPanel","./TilesPanel","./utils/AppManager","./utils/Constants"],function(e,t,i,n,s,a,r,o,l,p,d,c,h,g,u,_,m,I,w,f,T,x){"use strict";function C(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const S=C(w);const v=f["DisplayFormat"];const B=C(T);const y=x["MYHOME_PAGE_ID"];const M=x["SETTINGS_PANELS_KEYS"];const $=S.extend("sap.cux.home.InsightsTilesSettingsPanel",{init:function e(){try{const e=this;S.prototype.init.call(e);e._controlMap=new Map;e.setProperty("key",M.INSIGHTS_TILES);e.setProperty("title",e._i18nBundle.getText("insightsTiles"));e.setProperty("icon","sap-icon://manager-insight");e.appManagerInstance=B.getInstance();return Promise.resolve(e.appManagerInstance.fetchInsightApps(true,e._i18nBundle.getText("insights"))).then(function(t){e._allInsightsApps=t;e._wrapperId=`${e.getId()}-tilesSettingsWrapper`;e._controlMap.set(e._wrapperId,new n(e._wrapperId,{alignItems:"Start",justifyContent:"Start",height:"100%",width:"100%",direction:"Column"}).addStyleClass("flexContainerCards"));e.addAggregation("content",e._controlMap.get(e._wrapperId));e._showMessageStrip();e._showToolbar();e._showTilesList();e.attachPanelNavigated(()=>{e._controlMap.get(`${e._wrapperId}--searchField`).setValue("");void e.appManagerInstance.fetchInsightApps(false,e._i18nBundle.getText("insights")).then(t=>{e._allInsightsApps=t;e._controlMap.get(`${e._wrapperId}--title`).setText(`${e._i18nBundle.getText("insightsTilesTitle")} (${e._allInsightsApps.length})`);e._createTableRows(e._allInsightsApps)})})})}catch(e){return Promise.reject(e)}},_showMessageStrip:function e(){const t=new u(`${this._wrapperId}--msgStripContainer`,{width:"calc(100% - 2rem)"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");t.addItem(new h(`${this._wrapperId}--msgStripText`,{text:this._i18nBundle.getText("insightAppsTabText")}));this._getWrapperFlexBox().addItem(t)},_showToolbar:function e(){this._controlMap.set(`${this._wrapperId}--title`,new g(`${this._wrapperId}--title`,{text:`${this._i18nBundle.getText("insightsTilesTitle")} (${this._allInsightsApps.length})`,titleStyle:"H5",width:"100%"}));this._controlMap.set(`${this._wrapperId}--searchField`,new p(`${this._wrapperId}--pagesListSearch`,{liveChange:e=>this._onTilesSearch(e),width:"100%"}).addStyleClass("sapUiTinyMarginTop"));const t=new s(`${this._wrapperId}--titleContainer`,{alignItems:"Center",justifyContent:"SpaceBetween",width:"100%"});t.addItem(this._controlMap.get(`${this._wrapperId}--title`));const i=new u(`${this._wrapperId}--toolbarContainer`,{width:"calc(100% - 2rem)",items:[t,this._controlMap.get(`${this._wrapperId}--searchField`)]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");this._getWrapperFlexBox().addItem(i)},_onTilesSearch:function e(t){const i=t.getSource().getValue().toLowerCase();const n=this._allInsightsApps.filter(e=>e.visualization?.title?.toLowerCase().includes(i));this._createTableRows(n)},_showTilesList:function e(){this._createTableWithContainer();this._createTableRows(this._allInsightsApps)},_createTableWithContainer:function e(){this._controlMap.set(`${this._wrapperId}-table`,new c(`${this._wrapperId}-table`,{columns:[new t(`${this._wrapperId}-table-dndIcon`,{hAlign:"Center",width:"6%"}),new t(`${this._wrapperId}-table-title`,{width:"94%"})],dragDropConfig:new I(`${this._wrapperId}-dragDropInfo`,{sourceAggregation:"items",targetAggregation:"items",groupName:"insightsTilesSettingsItems",dropPosition:"On",drop:e=>void this._handleTilesDrop(e)})}).addStyleClass("sapContrastPlus"));const i=new l(`${this._wrapperId}-scrollContainer`,{vertical:true,horizontal:false,height:"100%",width:"100%",content:[this._controlMap.get(`${this._wrapperId}-table`)]});const s=new u(`${this._wrapperId}-containerVBox`,{height:"100%",width:"100%",justifyContent:"Start",direction:"Column",items:[i]});const a=new n(`${this._wrapperId}-containerFlexBox`,{alignItems:"Start",justifyContent:"Start",height:"100%",width:"calc(100% - 2rem)",direction:"Row",items:[s]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginTop flexContainerCards");this._getWrapperFlexBox().addItem(a)},_handleTilesDrop:function e(t){try{const e=this;const i=t.getParameter?.("draggedControl")||t.draggedControl,n=i.getParent()?.indexOfItem(i),s=t.getParameter?.("droppedControl")||t.droppedControl,a=i.getParent()?.indexOfItem(s),r=i.data("persConfig"),o=s.data("persConfig");const l=function(){if(n!==a){e._getWrapperFlexBox().setBusy(true);const t={pageId:y,sourceSectionIndex:r.sectionIndex,sourceVisualizationIndex:r.visualizationIndex,targetSectionIndex:o.sectionIndex,targetVisualizationIndex:o.visualizationIndex};return Promise.resolve(e.appManagerInstance.moveVisualization(t)).then(function(){return Promise.resolve(e.appManagerInstance.fetchInsightApps(true,e._i18nBundle.getText("insights"))).then(function(t){e._allInsightsApps=t;e._createTableRows(e._allInsightsApps);return Promise.resolve(e._getTilePanel().refreshData()).then(function(){e._getWrapperFlexBox().setBusy(false)})})})}}();return Promise.resolve(l&&l.then?l.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_createTableRows:function e(t){const i=this._controlMap.get(`${this._wrapperId}-table`);i.removeAllItems();let n=t;const s=this._controlMap.get(`${this._wrapperId}--searchField`).getValue();if(s){n=this._allInsightsApps.filter(e=>e.visualization?.title?.toLowerCase().includes(s))}n.forEach((e,t)=>{i.addItem(this._createColumnListItem(e,t))})},_createColumnListItem:function t(n,a){const r=`insightsTiles-${a}-listItem`;const l=_.getElementById(r);if(l){l.destroy()}const p=new i({id:r,type:"Inactive"}).addStyleClass("insightsListItem insightsListMargin manageSectionsTable");p.addCell(new s({items:[new m({src:"sap-icon://BusinessSuiteInAppSymbols/icon-grip"}).addStyleClass("tilesDndIcon")]}));const c=n.visualization?.supportedDisplayFormats||"";let g;if((n.isCount||n.isSmartBusinessTile)&&c.length>1&&c.indexOf(v.Standard)>-1&&c.indexOf(v.StandardWide)>-1){g=new s({id:`${r}-convertSwitchContainer`,alignItems:"Center",items:[new h({id:`${r}-switchAppSizeLabel`,text:this._i18nBundle.getText("wide"),wrapping:false}),new d({id:`${r}-convertSwitch`,state:n.visualization?.displayFormatHint!==v.Standard,change:()=>void this._onConvertTilePress(n),customTextOn:" ",customTextOff:" ",tooltip:n.visualization?.displayFormatHint===v.Standard?this._i18nBundle.getText("ConvertToWideTile"):this._i18nBundle.getText("ConvertToTile")})]})}const u=new e({id:`${r}-deleteAppBtn`,type:"Transparent",icon:"sap-icon://decline",press:()=>this._onDeleteApp(n),tooltip:this._i18nBundle.getText("removeFromInsights")});const I=new s({id:`${r}-buttonsWrapper`,alignItems:"Center"}).addStyleClass("sapUiSmallMarginEnd");if(g){I.addItem(g)}I.addItem(u);p.addCell(new s({id:`${r}-cell`,alignItems:"Center",justifyContent:"SpaceBetween",items:[new o({title:n.visualization?.title,text:n.visualization?.subtitle,tooltip:n.visualization?.title}).addStyleClass("objectIdentifierMargin"),I]}));p.data("persConfig",n.persConfig);return p},_onConvertTilePress:function e(t){try{const e=this;const i=t.visualization?.displayFormatHint,n={pageId:y,sourceSectionIndex:t.persConfig?.sectionIndex,sourceVisualizationIndex:t.persConfig?.visualizationIndex,oVisualizationData:{displayFormatHint:i===v.Standard?v.StandardWide:v.Standard}};e._getWrapperFlexBox().setBusy(true);return Promise.resolve(e.appManagerInstance.updateVisualizations(n)).then(function(){return Promise.resolve(e._getTilePanel().refreshData()).then(function(){if(t.visualization){t.visualization.displayFormatHint=n.oVisualizationData.displayFormatHint}e._getWrapperFlexBox().setBusy(false)})})}catch(e){return Promise.reject(e)}},_onDeleteApp:function e(t){a.show(this._i18nBundle.getText("remove_tile_confirmation_title",[t.title]),{id:"removeTileConfirmation",styleClass:"msgBoxWidth",icon:a.Icon.QUESTION,title:this._i18nBundle.getText("remove"),actions:[this._i18nBundle.getText("remove"),a.Action.CANCEL],emphasizedAction:this._i18nBundle.getText("remove"),onClose:e=>this._handleDeleteApp(e,t)})},_handleDeleteApp:function e(t,i){try{const e=this;const n=function(){if(t===e._i18nBundle.getText("remove")){e._getWrapperFlexBox().setBusy(true);return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:i.persConfig?.sectionId,vizIds:[i.visualization?.id]})).then(function(){r.show(e._i18nBundle.getText("appRemovedInsights"));return Promise.resolve(e.appManagerInstance.fetchInsightApps(true,e._i18nBundle.getText("insights"))).then(function(t){e._allInsightsApps=t;e._controlMap.get(`${e._wrapperId}--title`).setText(`${e._i18nBundle.getText("insightsTilesTitle")} (${e._allInsightsApps.length})`);e._createTableRows(e._allInsightsApps);return Promise.resolve(e._getTilePanel().refreshData()).then(function(){e._getWrapperFlexBox().setBusy(false)})})})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_getWrapperFlexBox:function e(){return this._controlMap.get(this._wrapperId)},_getTilePanel:function e(){return this._getPanel()}});return $});
//# sourceMappingURL=InsightsTilesSettingsPanel.js.map