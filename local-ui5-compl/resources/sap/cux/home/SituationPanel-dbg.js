/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/base/i18n/Formatting","sap/fe/navigation/NavigationHandler","sap/fe/navigation/SelectionVariant","sap/m/GenericTile","sap/m/Text","sap/m/TileContent","sap/m/library","sap/ui/core/Component","sap/ui/core/format/DateFormat","sap/ui/core/format/NumberFormat","sap/ui/model/odata/v4/ODataModel","sap/ushell/api/S4MyHome","./ToDoPanel"],function(t,e,n,i,a,r,o,s,c,u,l,m,g,f){"use strict";function p(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}function d(t,e){try{var n=t()}catch(t){return e(t)}if(n&&n.then){return n.then(void 0,e)}return n}const S=s["LoadState"];const h=s["URLHelper"];const _=s["ValueColor"];const b=p(f);class N{}const P=b.extend("sap.cux.home.SituationPanel",{constructor:function t(e,n){b.prototype.constructor.call(this,e,n)},init:function t(){b.prototype.init.call(this);this.setProperty("key","situations");this.setProperty("title",this._i18nBundle.getText("situationsTabTitle"))},generateRequestUrls:function t(n){const i=e.getLanguageTag().language||"";return[this.getCountUrl(),`${this.getDataUrl()}&$expand=_InstanceAttribute($expand=_InstanceAttributeValue($filter=(Language eq '${i.toUpperCase()}' or Language eq ''))),_InstanceText($filter=(Language eq '${i.toUpperCase()}' or Language eq ''))&$skip=0&$top=${n}`]},generateCardTemplate:function t(e,n){return new a(`${e}-actionTile`,{mode:"ActionMode",frameType:"TwoByOne",pressEnabled:true,header:this._getSituationMessage(n.getProperty("_InstanceText/0/SituationTitle"),n.getProperty("_InstanceAttribute")),headerImage:"sap-icon://alert",valueColor:_.Critical,state:n.getProperty("status"),press:t=>{void this._onPressSituation(t)},tileContent:[new o(`${e}-actionTileContent`,{content:new r(`${e}-text`,{text:this._getSituationMessage(n.getProperty("_InstanceText/0/SituationText"),n.getProperty("_InstanceAttribute"))}),footer:g.formatDate(n.getProperty("SitnInstceCreatedAtDateTime"))})]})},_getSituationMessage:function t(e){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!e?.split){return e}let i=e.replaceAll("\n"," ");n.forEach(t=>{if(t.SitnInstceAttribName?.length>0){const e=`0${t.SitnInstceAttribSource}`;const n=`${e}.${t.SitnInstceAttribName}`;const a=t._InstanceAttributeValue.reduce(function(e,n){if(n.SitnInstceAttribSource===t.SitnInstceAttribSource&&n.SitnInstceAttribName===t.SitnInstceAttribName){e.push(n)}return e},[]);const r=[];a.forEach(e=>{let n=e?.SitnInstceAttribValue?.trim()||"";let i;switch(t.SitnInstceAttribEntityType){case"Edm.DateTime":i=this._getDateFormatter().format(this._getDateFormatter().parse(n));break;case"Edm.Decimal":if(n.endsWith("-")){n=`-${n.substring(0,n.length-1)}`}i=this._getNumberFormatter().format(Number(n));break;default:i=n}r.push(i)});i=i.split(`{${n}}`).join(r.join(", "))}});return i},_getDateFormatter:function t(){if(!this._dateFormatter){const t=e.getDatePattern("medium")||"dd/MM/yyyy";this._dateFormatter=u.getDateInstance({pattern:t})}return this._dateFormatter},_getNumberFormatter:function t(){if(!this._decimalFormatter){this._decimalFormatter=l.getFloatInstance({decimalSeparator:e.getNumberSymbol("decimal")||".",groupingSeparator:e.getNumberSymbol("group")||",",groupingEnabled:true})}return this._decimalFormatter},_onPressSituation:function t(e){try{const t=this;const n=e.getSource();const i=n.getBindingContext();const{status:a,SitnInstceKey:r,SitnEngineType:o}=i?.getObject();const s=t.getTargetAppUrl();const u=function(){if(a!==S.Loading){const e=function(){if(r){const e=d(function(){return Promise.resolve(t._fetchNavigationTargetData(r,o)).then(function(e){const n=e;return Promise.resolve(t._executeNavigation(n,c.getOwnerComponentFor(t.getParent()))).then(function(){})})},function(e){if(e instanceof N&&o==="1"&&e._sErrorCode==="NavigationHandler.isIntentSupported.notSupported"){h.redirect(t.getTargetAppUrl(),false)}});if(e&&e.then)return e.then(function(){})}else{h.redirect(s,false)}}();if(e&&e.then)return e.then(function(){})}}();return Promise.resolve(u&&u.then?u.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},_getSituationsModel:function t(){if(!this._situationsModel){this._situationsModel=new m({serviceUrl:"/sap/opu/odata4/sap/a_sitn2mblinstce_v4/srvd/sap/a_sitn2mblinstce_srv/0002/"})}return this._situationsModel},_fetchNavigationTargetData:function e(n,i){try{const e=this;return Promise.resolve(d(function(){if(i==="1"){const t=e._getSituationsModel().bindContext(`/Navigation/${n}`,undefined,{$expand:{_NavigationParam:{$select:["SituationNotifParamName","SituationNotifParameterVal"]}},$select:["SitnInstanceID","SitnSemanticObject","SitnSemanticObjectAction"]});return Promise.resolve(t.requestObject()).then(function(t){return t})}else{return Promise.resolve({SitnInstanceID:n,SitnSemanticObject:"SituationInstance",SitnSemanticObjectAction:"display",_NavigationParam:[{SituationNotifParamName:"ui-type",SituationNotifParameterVal:"extended"},{SituationNotifParamName:"SitnInstceKey",SituationNotifParameterVal:n}]})}},function(e){t.error(e instanceof Error?e.message:"")}))}catch(t){return Promise.reject(t)}},_executeNavigation:function t(e,a){return new Promise((t,r)=>{const o=new n(a);const s=new i;e._NavigationParam?.map(function(t){if(t.SituationNotifParamName){s.addSelectOption(t.SituationNotifParamName,"I","EQ",t.SituationNotifParameterVal)}});const c=s.toJSONString();o.navigate(e.SitnSemanticObject,e.SitnSemanticObjectAction,c,t,t=>r(t))})},getNoDataText:function t(){return this._i18nBundle.getText("noSituationTitle")}});return P});
//# sourceMappingURL=SituationPanel-dbg.js.map