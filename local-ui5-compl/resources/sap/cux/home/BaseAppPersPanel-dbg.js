/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/ui/core/EventBus","sap/ushell/Container","./BaseAppPanel","./utils/Constants","./utils/DataFormatUtils","./utils/PageManager","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,n,o,r,i,s,a,c){"use strict";function u(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function l(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const p=u(o);const f=r["DEFAULT_APP_ICON"];const g=r["DEFAULT_BG_COLOR"];const d=r["FALLBACK_ICON"];const P=r["MYHOME_PAGE_ID"];const h=u(i);const I=u(s);const v=u(a);const m=u(c);const _=p.extend("sap.cux.home.BaseAppPersPanel",{metadata:{library:"sap.cux.home",properties:{persContainerId:{type:"string",group:"Misc",defaultValue:"",visibility:"hidden"}}},constructor:function e(t,n){p.prototype.constructor.call(this,t,n);this._favPageVisualizations=[]},init:function e(){p.prototype.init.call(this);this.setProperty("persContainerId",v.getPersContainerId(this));this._pageManagerInstance=I.getInstance(v.getPersContainerId(this),v.getOwnerComponent(this));this._eventBus=t.getInstance();this._eventBus.subscribe("pageChannel","pageUpdated",()=>{void this.applyPersonalization()},this)},_getPersonalizer:function e(){try{const e=this;const t=e.getProperty("persContainerId");if(!t){throw new Error("No Container ID Provided for personalisation!")}return Promise.resolve(m?.getInstance(t,v.getOwnerComponent(e)))}catch(e){return Promise.reject(e)}},getPersonalization:function e(){try{const e=this;return Promise.resolve(e._getPersonalizer()).then(function(e){return Promise.resolve(e?.read())})}catch(e){return Promise.reject(e)}},setPersonalization:function e(t){try{const e=this;return Promise.resolve(e._getPersonalizer()).then(function(e){return Promise.resolve(e.write(t)).then(function(){})})}catch(e){return Promise.reject(e)}},_getAppPersonalization:function e(){try{const e=this;return Promise.resolve(e.getPersonalization()).then(function(e){return e?.favoriteApps||[]})}catch(e){return Promise.reject(e)}},setFavAppsPersonalization:function e(t){try{const e=this;return Promise.resolve(e.getPersonalization()).then(function(n){const o=function(){if(n){n.favoriteApps=t;return Promise.resolve(e.setPersonalization(n)).then(function(){})}}();if(o&&o.then)return o.then(function(){})})}catch(e){return Promise.reject(e)}},applyPersonalization:function e(){try{const e=this;let t=e.fetchTileVisualization();return Promise.resolve(e._applyTilesPersonalization(t))}catch(e){return Promise.reject(e)}},_applyTilesPersonalization:function e(t,n){let o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;try{const e=this;return Promise.resolve(Promise.all([e._getAppPersonalization(),e._getFavPages()])).then(function(r){let[i,s]=r;return Promise.resolve(e._getAllFavPageApps(s,o)).then(function(o){const r=e.getAggregation("groups")||[];const s=n?e._getGroup(n)?.getApps()||[]:e.getApps()||[];for(const a of t){const t=e._getItem(a,r,s);const{color:c,icon:u}=e._getItemPersonalization(t,i,o,n);if(c){t?.setProperty("bgColor",c,true);a.setBackgroundColor(c)}if(u){t?.setProperty("icon",u,true);a.setTileIcon(u)}}})})}catch(e){return Promise.reject(e)}},_getItem:function e(t,n,o){const r=t.data("groupId");if(r){return n.find(e=>e.getGroupId()===r)}else{return o.find(e=>h.getLeanURL(e.getUrl())===t.getUrl())}},_getItemPersonalization:function e(t,n,o,r){let i="";let s="";if(!t)return{color:i,icon:s};if(t.isA("sap.cux.home.Group")){const e=n?.find(e=>e.isSection&&e.sectionId===t.getGroupId());i=e?.BGColor}else{const e=t;const a=[e.getUrl()];const c=e.data("oldAppId");if(c){a.push(c)}const u=e.getVizId();const l=r?n?.find(e=>!e.isSection&&e.sectionId===r&&e.appId&&a.includes(e.appId)):n?.find(e=>e.isRecentlyAddedApp&&e.appId&&a.includes(e.appId));const p=o.find(e=>e.vizId===u||e.appId&&a.includes(e.appId));i=l?.BGColor||p?.BGColor||g().key;s=this?.isA("sap.cux.home.FavAppPanel")?this._getFavAppIcon(e,p?.icon):this.getAppIcon()}return{color:i,icon:s}},_getFavPages:function e(){try{const e=this;return Promise.resolve(e._pageManagerInstance.getFavoritePages()).then(function(e){return e.concat({pageId:P,BGColor:g().key})})}catch(e){return Promise.reject(e)}},_getAllFavPageApps:function t(n,o){try{let t=false;const r=this;return Promise.resolve(l(function(){function e(e){return t?e:[]}const i=function(){if(n){r._favPageVisualizations=r._favPageVisualizations||[];const e=r._favPageVisualizations.reduce((e,t)=>{if(t.pageId&&!e.includes(t.pageId)){e.push(t.pageId)}return e},[]);const i=n.map(e=>e.pageId);const s=e.length===0||!e.every(e=>i.includes(e));if(!o&&!s){const e=r._favPageVisualizations;t=true;return e}else{return Promise.resolve(r._loadAllPageVisualizations(n)).then(function(e){r._favPageVisualizations=e;const n=r._favPageVisualizations;t=true;return n})}}}();return i&&i.then?i.then(e):e(i)},function(t){e.error(t);return[]}))}catch(e){return Promise.reject(e)}},_loadAllPageVisualizations:function t(o){let r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;try{const t=e=>o.find(t=>t.pageId===e)?.BGColor??g().key;return Promise.resolve(l(function(){const e=[];return Promise.resolve(n.getServiceAsync("SpaceContent")).then(function(n){return Promise.resolve(n.getPages(o.map(e=>e.pageId))).then(function(n){const o=Object.values(n);for(const n of o){const o=n.sections||[];for(const i of o){const o=i.visualizations||[];for(const i of o){const o={appId:i.targetURL,vizId:i.vizId,icon:i.icon,BGColor:t(n.id),pageId:n.id};if(!r||!e.some(e=>e.appId===o.appId)){e.push(o)}}}}return e})})},function(t){e.error(t);return[]}))}catch(e){return Promise.reject(e)}},getAppIcon:function e(){return f},_getFavAppIcon:function e(t,n){return n||t?.getIcon()||d}});return _});
//# sourceMappingURL=BaseAppPersPanel-dbg.js.map