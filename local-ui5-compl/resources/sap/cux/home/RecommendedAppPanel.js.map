{"version":3,"file":"RecommendedAppPanel.js","names":["sap","ui","define","Log","Button","IllustratedMessageType","sap_m_library","Link","MessageStrip","MessageToast","VBox","EventBus","__BaseAppPersPanel","__MenuItem","___utils_Constants","___utils_Device","___utils_FESRUtil","__HttpHelper","_interopRequireDefault","obj","__esModule","default","_catch","body","recover","result","e","then","BackgroundDesign","_finallyRethrows","finalizer","bind","BaseAppPersPanel","MenuItem","FEATURE_TOGGLES","REPO_BASE_URL","SETTINGS_PANELS_KEYS","DeviceType","addFESRId","HttpHelper","CONSTANTS","USER_PREFERENCE_SRVC_URL","KEY","RecommendedAppPanel","extend","metadata","library","defaultAggregation","aggregations","apps","type","singularName","multiple","visibility","constructor","_constructor","id","settings","BaseAppPersPanel.prototype.constructor.call","this","setSupported","init","_init","BaseAppPersPanel.prototype.init.call","setProperty","_i18nBundle","getText","eventBus","getInstance","subscribe","channelId","eventId","data","showRecommendation","fireSupported","isSupported","getDeviceType","Mobile","_enableRecommendationTab","_generateWrapper","wrapperId","getId","_controlMap","get","set","items","_generateMessageStrip","BaseAppPersPanel.prototype._generateWrapper.call","backgroundDesign","Transparent","loadApps","_loadApps","_this","Promise","resolve","appManagerInstance","getRecommendedVisualizations","recommendedVisualizations","map","visualization","menuItems","_getActions","destroyAggregation","recommendedApps","generateApps","setApps","reject","messageStripId","text","showIcon","showCloseButton","link","press","getParent","_getLayout","openSettingsDialog","ADVANCED","addStyleClass","addToFavoritesItem","title","icon","event","_addAppToFavorites","notRelevantItem","_rejectRecommendation","actions","_this2","setBusy","_temp2","source","getSource","app","getTitle","find","viz","url","getUrl","fioriId","_temp","rejectPayload","AppId","Decision","Post","refresh","message","show","error","_wasThrown","_result","_isRecommendationEnabled","_this3","isFeatureEnabled","RECOMMENDATION","recommendationEnabled","_exit","_temp4","getPersonalization","personalisation","_temp3","_result2","_this4","generateIllustratedMessage","_generateIllustratedMessage","illustratedMessage","BaseAppPersPanel.prototype.generateIllustratedMessage.call","setIllustrationType","Tent","setTitle","setDescription","addAdditionalContent","tooltip"],"sources":["RecommendedAppPanel.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\nimport Log from \"sap/base/Log\";\nimport Button from \"sap/m/Button\";\nimport IllustratedMessageType from \"sap/m/IllustratedMessageType\";\nimport { BackgroundDesign } from \"sap/m/library\";\nimport Link from \"sap/m/Link\";\nimport MessageStrip from \"sap/m/MessageStrip\";\nimport MessageToast from \"sap/m/MessageToast\";\nimport VBox from \"sap/m/VBox\";\nimport type { MetadataOptions } from \"sap/ui/core/Element\";\nimport EventBus from \"sap/ui/core/EventBus\";\nimport App from \"./App\";\nimport BaseAppPersPanel, { $BaseAppPersPanelSettings } from \"./BaseAppPersPanel\";\nimport BaseContainer from \"./BaseContainer\";\nimport MenuItem, { MenuItem$PressEvent } from \"./MenuItem\";\nimport { FEATURE_TOGGLES, REPO_BASE_URL, SETTINGS_PANELS_KEYS } from \"./utils/Constants\";\nimport { DeviceType } from \"./utils/Device\";\nimport { addFESRId } from \"./utils/FESRUtil\";\nimport HttpHelper from \"./utils/HttpHelper\";\n\nconst CONSTANTS = {\n\tUSER_PREFERENCE_SRVC_URL: `${REPO_BASE_URL}UserPreference`,\n\tKEY: \"recommendedApps\"\n};\n\n/**\n *\n * Provides the RecommendedAppPanel Class.\n *\n * @extends sap.cux.home.BaseAppPersPanel\n *\n * @author SAP SE\n * @version 0.0.1\n * @since 1.128.0\n *\n * @private\n * @experimental\n * @hidden\n *\n * @alias sap.cux.home.RecommendedAppPanel\n */\nexport default class RecommendedAppPanel extends BaseAppPersPanel {\n\tstatic readonly metadata: MetadataOptions = {\n\t\tlibrary: \"sap.cux.home\",\n\t\tdefaultAggregation: \"apps\",\n\t\taggregations: {\n\t\t\t/**\n\t\t\t * Apps aggregation for Recommended apps\n\t\t\t */\n\t\t\tapps: { type: \"sap.cux.home.App\", singularName: \"app\", multiple: true, visibility: \"hidden\" }\n\t\t}\n\t};\n\n\tpublic constructor(id?: string, settings?: $BaseAppPersPanelSettings) {\n\t\tsuper(id, settings);\n\t\tthis.setSupported(false);\n\t}\n\n\tpublic init() {\n\t\tsuper.init();\n\t\tthis.setProperty(\"key\", CONSTANTS.KEY);\n\t\tthis.setProperty(\"title\", this._i18nBundle.getText(\"recommendedAppsTab\"));\n\t\t//subscribe to recommendation setting change event\n\t\tconst eventBus = EventBus.getInstance();\n\t\teventBus.subscribe(\"importChannel\", \"recommendationSettingChanged\", (channelId?: string, eventId?: string, data?: object) => {\n\t\t\tconst showRecommendation = (data as { showRecommendation: boolean }).showRecommendation;\n\t\t\tthis.fireSupported({ isSupported: showRecommendation });\n\t\t});\n\t\tif (this.getDeviceType() !== DeviceType.Mobile) {\n\t\t\tvoid this._enableRecommendationTab();\n\t\t}\n\t}\n\n\t/**\n\t * Overrides the wrapper for the apps panel to add message strip.\n\t *\n\t * @private\n\t * @returns {sap.m.VBox} The apps panel wrapper.\n\t */\n\tprotected _generateWrapper() {\n\t\tconst wrapperId = `${this.getId()}-recommendedPanelWrapper`;\n\t\tif (!this._controlMap.get(wrapperId)) {\n\t\t\tthis._controlMap.set(\n\t\t\t\twrapperId,\n\t\t\t\tnew VBox(wrapperId, {\n\t\t\t\t\titems: [this._generateMessageStrip(), super._generateWrapper()],\n\t\t\t\t\tbackgroundDesign: BackgroundDesign.Transparent\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t\treturn this._controlMap.get(wrapperId) as VBox;\n\t}\n\n\t/**\n\t * Fetch recommended apps and set apps aggregation\n\t * @private\n\t */\n\tpublic async loadApps() {\n\t\tlet recommendedVisualizations = await this.appManagerInstance.getRecommendedVisualizations(true);\n\t\trecommendedVisualizations = recommendedVisualizations.map((visualization) => {\n\t\t\treturn {\n\t\t\t\t...visualization,\n\t\t\t\tmenuItems: this._getActions()\n\t\t\t};\n\t\t});\n\t\tthis.destroyAggregation(\"apps\", true);\n\t\t//convert apps objects array to apps instances\n\t\tconst recommendedApps = this.generateApps(recommendedVisualizations);\n\t\tthis.setApps(recommendedApps);\n\t}\n\n\t/**\n\t * Returns message strip for recommended tab\n\t * @private\n\t * @returns {sap.cux.home.MessageStrip} - Message strip control.\n\t */\n\tprivate _generateMessageStrip() {\n\t\tconst messageStripId = `${this.getId()}-messageStrip`;\n\t\tif (!this._controlMap.get(messageStripId)) {\n\t\t\tthis._controlMap.set(\n\t\t\t\tmessageStripId,\n\t\t\t\tnew MessageStrip(messageStripId, {\n\t\t\t\t\ttext: this._i18nBundle.getText(\"recommendationMessageStrip\"),\n\t\t\t\t\tshowIcon: true,\n\t\t\t\t\tshowCloseButton: true,\n\t\t\t\t\tlink: new Link(`${messageStripId}-settings`, {\n\t\t\t\t\t\ttext: this._i18nBundle.getText(\"settings\"),\n\t\t\t\t\t\tpress: () => (this.getParent() as BaseContainer)?._getLayout()?.openSettingsDialog(SETTINGS_PANELS_KEYS.ADVANCED)\n\t\t\t\t\t}).addStyleClass(\"sapUiNoMargin\")\n\t\t\t\t}).addStyleClass(\"sapUiNoMarginBegin sapUiTinyMarginBottom\")\n\t\t\t);\n\t\t}\n\t\treturn this._controlMap.get(messageStripId) as MessageStrip;\n\t}\n\n\t/**\n\t * Returns list of actions available for selected app\n\t * @private\n\t * @returns {sap.cux.home.MenuItem[]} - Array of list items.\n\t */\n\tprivate _getActions(): MenuItem[] {\n\t\tconst addToFavoritesItem = new MenuItem({\n\t\t\ttitle: this._i18nBundle.getText(\"addToFavorites\"),\n\t\t\ticon: \"sap-icon://add-favorite\",\n\t\t\tpress: (event) => {\n\t\t\t\tvoid this._addAppToFavorites(event);\n\t\t\t}\n\t\t});\n\t\taddFESRId(addToFavoritesItem, \"acceptRecommendation\");\n\t\tconst notRelevantItem = new MenuItem({\n\t\t\ttitle: this._i18nBundle.getText(\"notRelevantRecommendation\"),\n\t\t\ticon: \"sap-icon://decline\",\n\t\t\tpress: (event) => {\n\t\t\t\tvoid this._rejectRecommendation(event);\n\t\t\t}\n\t\t});\n\t\taddFESRId(notRelevantItem, \"rejectRecommendation\");\n\t\tconst actions = [addToFavoritesItem, notRelevantItem];\n\t\treturn actions;\n\t}\n\n\t/**\n\t * Rejects the selected app as recommendation\n\t * @private\n\t * @param {sap.ui.base.MenuItem$PressEvent} event - Event object.\n\t */\n\tprivate async _rejectRecommendation(event: MenuItem$PressEvent) {\n\t\tthis.setBusy(true);\n\t\ttry {\n\t\t\tconst source = event.getSource<MenuItem>();\n\t\t\tconst app = source.getParent() as App;\n\t\t\tconst title = app.getTitle();\n\t\t\tconst recommendedVisualizations = await this.appManagerInstance.getRecommendedVisualizations();\n\t\t\tconst visualization = recommendedVisualizations.find((viz) => viz.url === app.getUrl());\n\t\t\tconst fioriId = visualization?.fioriId;\n\t\t\tif (fioriId) {\n\t\t\t\tconst rejectPayload = {\n\t\t\t\t\tAppId: fioriId,\n\t\t\t\t\tDecision: 1\n\t\t\t\t};\n\t\t\t\tawait HttpHelper.Post(CONSTANTS.USER_PREFERENCE_SRVC_URL, rejectPayload);\n\t\t\t\tawait this.refresh();\n\t\t\t\tconst message = this._i18nBundle.getText(\"rejectRecommendationMsg\", [title]) as string;\n\t\t\t\tMessageToast.show(message);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tLog.error(error as string);\n\t\t} finally {\n\t\t\tthis.setBusy(false);\n\t\t}\n\t}\n\n\t/**\n\t * Checks if recommendation is enabled based on recommendation feature toggle and user personalization.\n\t * @private\n\t * @returns {Boolean} - Returns true if recommendation is enabled otherwise false.\n\t */\n\tprivate async _isRecommendationEnabled() {\n\t\tconst recommendationEnabled = await this.appManagerInstance.isFeatureEnabled(FEATURE_TOGGLES.RECOMMENDATION);\n\t\tif (recommendationEnabled) {\n\t\t\tconst personalisation = await this.getPersonalization();\n\t\t\treturn personalisation.showRecommendation ?? true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Show recommendation tab if recommendation is enabled\n\t * @private\n\t */\n\tprivate async _enableRecommendationTab() {\n\t\tconst isSupported = await this._isRecommendationEnabled();\n\t\tthis.setSupported(isSupported);\n\t\tthis.fireSupported({ isSupported });\n\t}\n\n\t/**\n\t * Generates illustrated message for recommended apps panel.\n\t * @private\n\t * @override\n\t * @returns {sap.m.IllustratedMessage} Illustrated error message.\n\t */\n\tprotected generateIllustratedMessage() {\n\t\tconst illustratedMessage = super.generateIllustratedMessage();\n\t\t//overrride the default illustrated message, title, description and add additional content\n\t\tillustratedMessage.setIllustrationType(IllustratedMessageType.Tent);\n\t\tillustratedMessage.setTitle(this._i18nBundle.getText(\"noRecommendationsTitle\"));\n\t\tillustratedMessage.setDescription(this._i18nBundle.getText(\"noRecommendationsDescription\"));\n\t\tillustratedMessage.addAdditionalContent(\n\t\t\tnew Button({\n\t\t\t\ttext: this._i18nBundle.getText(\"settings\"),\n\t\t\t\ttooltip: this._i18nBundle.getText(\"settings\"),\n\t\t\t\tpress: () => (this.getParent() as BaseContainer)?._getLayout()?.openSettingsDialog(SETTINGS_PANELS_KEYS.ADVANCED),\n\t\t\t\ttype: \"Emphasized\"\n\t\t\t})\n\t\t);\n\t\treturn illustratedMessage;\n\t}\n}\n"],"mappings":";;;;AAAA,aAAAA,IAAAC,GAAAC,OAAA,kSAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,GAAA,sBAAAC,EAAAC,GAAA,OAAAA,KAAAC,mBAAAD,EAAAE,UAAA,YAAAF,EAAAE,QAAAF,CAAA,CAkjBO,SAAAG,EAAgBC,EAAMC,GAC5B,IACC,IAAIC,EAASF,GACd,CAAE,MAAMG,GACP,OAAOF,EAAQE,EAChB,CACA,GAAID,GAAUA,EAAOE,KAAM,CAC1B,OAAOF,EAAOE,UAAU,EAAGH,EAC5B,CACA,OAAOC,CACR,CAAC,MArjBQG,EAAgBtB,EAAA,oBAwjBlB,SAASuB,EAAiBN,EAAMO,GACtC,IACC,IAAIL,EAASF,GACd,CAAE,MAAOG,GACR,OAAOI,EAAU,KAAMJ,EACxB,CACA,GAAID,GAAUA,EAAOE,KAAM,CAC1B,OAAOF,EAAOE,KAAKG,EAAUC,KAAK,KAAM,OAAQD,EAAUC,KAAK,KAAM,MACtE,CACA,OAAOD,EAAU,MAAOL,EACzB,CAAC,MA1jBMO,EAAgBd,EAAAN,GAAA,MAEhBqB,EAAQf,EAAAL,GAAA,MACNqB,EAAepB,EAAA,yBAAEqB,EAAarB,EAAA,uBAAEsB,EAAoBtB,EAAA,8BACpDuB,EAAUtB,EAAA,oBACVuB,EAAStB,EAAA,mBACXuB,EAAUrB,EAAAD,GAEjB,MAAMuB,EAAY,CACjBC,yBAA0B,GAAGN,kBAC7BO,IAAK,mBAGN,MAgBqBC,EAA4BX,EAAgBY,OAAA,oCAChDC,SAA4B,CAC3CC,QAAS,eACTC,mBAAoB,OACpBC,aAAc,CAIbC,KAAM,CAAEC,KAAM,mBAAoBC,aAAc,MAAOC,SAAU,KAAMC,WAAY,YAI9EC,YAAW,SAAAC,EAACC,EAAaC,GAC/BC,6BAAAC,KAAMH,EAAIC,GACVE,KAAKC,aAAa,MACnB,EAEOC,KAAI,SAAAC,IACVC,sBAAAJ,MACAA,KAAKK,YAAY,MAAOxB,EAAUE,KAClCiB,KAAKK,YAAY,QAASL,KAAKM,YAAYC,QAAQ,uBAEnD,MAAMC,EAAWxD,EAASyD,cAC1BD,EAASE,UAAU,gBAAiB,+BAAgC,CAACC,EAAoBC,EAAkBC,KAC1G,MAAMC,EAAsBD,EAAyCC,mBACrEd,KAAKe,cAAc,CAAEC,YAAaF,MAEnC,GAAId,KAAKiB,kBAAoBvC,EAAWwC,OAAQ,MAC1ClB,KAAKmB,0BACX,CACD,EAQUC,iBAAgB,SAAAA,IACzB,MAAMC,EAAY,GAAGrB,KAAKsB,kCAC1B,IAAKtB,KAAKuB,YAAYC,IAAIH,GAAY,CACrCrB,KAAKuB,YAAYE,IAChBJ,EACA,IAAItE,EAAKsE,EAAW,CACnBK,MAAO,CAAC1B,KAAK2B,wBAAuBC,kCAAA5B,OACpC6B,iBAAkB5D,EAAiB6D,cAGtC,CACA,OAAO9B,KAAKuB,YAAYC,IAAIH,EAC7B,EAMaU,SAAQ,SAAAC,IAAA,IAAG,MAAAC,EACejC,KAAI,OAAAkC,QAAAC,QAAJF,EAAKG,mBAAmBC,6BAA6B,OAAKrE,KAAA,SAA5FsE,GACJA,EAA4BA,EAA0BC,IAAKC,QAEtDA,EACHC,UAAWR,EAAKS,iBAGlBT,EAAKU,mBAAmB,OAAQ,MAEhC,MAAMC,EAAkBX,EAAKY,aAAaP,GAC1CL,EAAKa,QAAQF,EAAiB,EAC/B,CAAC,MAAA7E,GAAA,OAAAmE,QAAAa,OAAAhF,EAAA,GAOO4D,sBAAqB,SAAAA,IAC5B,MAAMqB,EAAiB,GAAGhD,KAAKsB,uBAC/B,IAAKtB,KAAKuB,YAAYC,IAAIwB,GAAiB,CAC1ChD,KAAKuB,YAAYE,IAChBuB,EACA,IAAInG,EAAamG,EAAgB,CAChCC,KAAMjD,KAAKM,YAAYC,QAAQ,8BAC/B2C,SAAU,KACVC,gBAAiB,KACjBC,KAAM,IAAIxG,EAAK,GAAGoG,aAA2B,CAC5CC,KAAMjD,KAAKM,YAAYC,QAAQ,YAC/B8C,MAAOA,IAAOrD,KAAKsD,aAA+BC,cAAcC,mBAAmB/E,EAAqBgF,YACtGC,cAAc,mBACfA,cAAc,4CAEnB,CACA,OAAO1D,KAAKuB,YAAYC,IAAIwB,EAC7B,EAOQN,YAAW,SAAAA,IAClB,MAAMiB,EAAqB,IAAIrF,EAAS,CACvCsF,MAAO5D,KAAKM,YAAYC,QAAQ,kBAChCsD,KAAM,0BACNR,MAAQS,SACF9D,KAAK+D,mBAAmBD,MAG/BnF,EAAUgF,EAAoB,wBAC9B,MAAMK,EAAkB,IAAI1F,EAAS,CACpCsF,MAAO5D,KAAKM,YAAYC,QAAQ,6BAChCsD,KAAM,qBACNR,MAAQS,SACF9D,KAAKiE,sBAAsBH,MAGlCnF,EAAUqF,EAAiB,wBAC3B,MAAME,EAAU,CAACP,EAAoBK,GACrC,OAAOE,CACR,EAOcD,sBAAqB,SAAAA,EAACH,GAA0B,IAAE,MAAAK,EAC/DnE,KAAAmE,EAAKC,QAAQ,MAAM,MAAAC,EAAAnG,EAAA,kBAAAP,EAAA,WAElB,MAAM2G,EAASR,EAAMS,YACrB,MAAMC,EAAMF,EAAOhB,YACnB,MAAMM,EAAQY,EAAIC,WAAW,OAAAvC,QAAAC,QACWgC,EAAK/B,mBAAmBC,gCAA8BrE,KAAA,SAAxFsE,GACN,MAAME,EAAgBF,EAA0BoC,KAAMC,GAAQA,EAAIC,MAAQJ,EAAIK,UAC9E,MAAMC,EAAUtC,GAAesC,QAAQ,MAAAC,EAAA,cACnCD,EAAO,CACV,MAAME,EAAgB,CACrBC,MAAOH,EACPI,SAAU,GACT,OAAAhD,QAAAC,QACIvD,EAAWuG,KAAKtG,EAAUC,yBAA0BkG,IAAchH,KAAA,kBAAAkE,QAAAC,QAClEgC,EAAKiB,WAASpH,KAAA,WACpB,MAAMqH,EAAUlB,EAAK7D,YAAYC,QAAQ,0BAA2B,CAACqD,IACrE9G,EAAawI,KAAKD,EAAS,MATW,GASX,GAAAN,KAAA/G,KAAA,OAAA+G,EAAA/G,KAAA,eAE7B,EAAC,SAAQuH,GACR/I,EAAI+I,MAAMA,EACX,EAAC,WAAAC,EAAAC,GACAtB,EAAKC,QAAQ,OAAO,GAAAoB,EAAA,MAAAC,EAAA,OAAAA,CAAA,UAAAvD,QAAAC,QAAAkC,KAAArG,KAAAqG,EAAArG,KAAA,qBAEtB,CAAC,MAAAD,GAAA,OAAAmE,QAAAa,OAAAhF,EAAA,GAOa2H,yBAAwB,SAAAA,IAAA,IAAG,MAAAC,EACJ3F,KAAI,OAAAkC,QAAAC,QAAJwD,EAAKvD,mBAAmBwD,iBAAiBrH,EAAgBsH,iBAAe7H,KAAA,SAAtG8H,GAAqB,IAAAC,EAAA,YAAAC,EAAA,cACvBF,EAAqB,QAAA5D,QAAAC,QACMwD,EAAKM,sBAAoBjI,KAAA,SAAjDkI,GAAe,MAAAC,EACdD,EAAgBpF,oBAAsB,KAAIiF,EAAA,YAAAI,CAAA,IAHvB,GAGuB,OAAAH,KAAAhI,KAAAgI,EAAAhI,KAAA,SAAAoI,GAAA,OAAAL,EAAAK,EAE3C,KAAK,GAAAL,EAAAC,EAAL,KAAK,EACb,CAAC,MAAAjI,GAAA,OAAAmE,QAAAa,OAAAhF,EAAA,GAMaoD,yBAAwB,SAAAA,IAAA,IAAG,MAAAkF,EACdrG,KAAI,OAAAkC,QAAAC,QAAJkE,EAAKX,4BAA0B1H,KAAA,SAAnDgD,GACNqF,EAAKpG,aAAae,GAClBqF,EAAKtF,cAAc,CAAEC,eAAe,EACrC,CAAC,MAAAjD,GAAA,OAAAmE,QAAAa,OAAAhF,EAAA,GAQSuI,2BAA0B,SAAAC,IACnC,MAAMC,EAAkBC,4CAAAzG,MAExBwG,EAAmBE,oBAAoBhK,EAAuBiK,MAC9DH,EAAmBI,SAAS5G,KAAKM,YAAYC,QAAQ,2BACrDiG,EAAmBK,eAAe7G,KAAKM,YAAYC,QAAQ,iCAC3DiG,EAAmBM,qBAClB,IAAIrK,EAAO,CACVwG,KAAMjD,KAAKM,YAAYC,QAAQ,YAC/BwG,QAAS/G,KAAKM,YAAYC,QAAQ,YAClC8C,MAAOA,IAAOrD,KAAKsD,aAA+BC,cAAcC,mBAAmB/E,EAAqBgF,UACxGlE,KAAM,gBAGR,OAAOiH,CACR,IAAC,OApMmBxH,CAAmB","ignoreList":[]}