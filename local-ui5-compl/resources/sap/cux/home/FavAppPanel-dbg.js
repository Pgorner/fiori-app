/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/f/GridContainer","sap/f/GridContainerSettings","sap/m/Button","sap/m/ColorPalette","sap/m/ColorPalettePopover","sap/m/CustomListItem","sap/m/Dialog","sap/m/HBox","sap/m/IllustratedMessage","sap/m/Input","sap/m/Label","sap/m/List","sap/m/MessageBox","sap/m/MessageStrip","sap/m/MessageToast","sap/m/NavContainer","sap/m/ObjectIdentifier","sap/m/Page","sap/m/Popover","sap/m/ScrollContainer","sap/m/SearchField","sap/m/StandardListItem","sap/m/Text","sap/m/Title","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/VBox","sap/m/library","sap/ui/base/Event","sap/ui/core/Element","sap/ui/core/EventBus","sap/ui/core/Icon","sap/ui/core/dnd/DragDropInfo","sap/ui/core/library","sap/ui/core/message/MessageType","sap/ui/core/theming/Parameters","sap/ui/layout/form/SimpleForm","sap/ui/layout/library","sap/ushell/Config","sap/ushell/Container","sap/ushell/components/pages/MyHomeImport","sap/ushell/components/pages/controller/PageRuntime.controller","./BaseApp","./BaseAppPersPanel","./Group","./MenuItem","./utils/Constants","./utils/DataFormatUtils","./utils/DragDropUtils","./utils/FESRUtil"],function(e,t,n,o,i,s,r,a,p,l,c,u,d,g,h,f,m,_,I,v,A,P,C,G,B,M,y,x,D,T,S,$,w,b,z,E,F,U,N,V,R,L,j,H,k,O,K,W,q,J,Q){"use strict";function Y(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function X(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const Z=D["ButtonType"];function ee(e,t){try{var n=e()}catch(e){return t(true,e)}if(n&&n.then){return n.then(t.bind(null,false),t.bind(null,true))}return t(false,n)}const te=D["ListType"];const ne=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function oe(e,t,n){if(!e.s){if(n instanceof ie){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=oe.bind(null,e,t);return}}if(n&&n.then){n.then(oe.bind(null,e,t),oe.bind(null,e,2));return}e.s=t;e.v=n;const o=e.o;if(o){o(e)}}}const ie=function(){function e(){}e.prototype.then=function(t,n){const o=new e;const i=this.s;if(i){const e=i&1?t:n;if(e){try{oe(o,1,e(this.v))}catch(e){oe(o,2,e)}return o}else{return this}}this.o=function(e){try{const i=e.v;if(e.s&1){oe(o,1,t?t(i):i)}else if(n){oe(o,1,n(i))}else{oe(o,2,i)}}catch(e){oe(o,2,e)}};return o};return e}();function se(e){return e instanceof ie&&e.s&1}function re(e,t,n){var o=-1,i,s;function r(a){try{while(++o<e.length&&(!n||!n())){a=t(o);if(a&&a.then){if(se(a)){a=a.v}else{a.then(r,s||(s=oe.bind(null,i=new ie,2)));return}}}if(i){oe(i,1,a)}else{i=a}}catch(e){oe(i||(i=new ie),2,e)}}r();return i}const ae=D["PlacementType"];function pe(e,t,n){if(typeof e[ne]==="function"){var o=e[ne](),i,s,r;function c(e){try{while(!(i=o.next()).done&&(!n||!n())){e=t(i.value);if(e&&e.then){if(se(e)){e=e.v}else{e.then(c,r||(r=oe.bind(null,s=new ie,2)));return}}}if(s){oe(s,1,e)}else{s=e}}catch(e){oe(s||(s=new ie),2,e)}}c();if(o.return){var a=function(e){try{if(!i.done){o.return()}}catch(e){}return e};if(s&&s.then){return s.then(a,function(e){throw a(e)})}a()}return s}if(!("length"in e)){throw new TypeError("Object is not iterable")}var p=[];for(var l=0;l<e.length;l++){p.push(e[l])}return re(p,function(e){return t(p[e])},n)}const le=z["dnd"];const ce=N["form"];const ue=H["ActionsPopover"];const de=Y(k);const ge=Y(O);const he=Y(K);const fe=W["DEFAULT_BG_COLOR"];const me=W["END_USER_COLORS"];const _e=W["MYHOME_PAGE_ID"];const Ie=Y(q);const ve=J["attachKeyboardHandler"];const Ae=Q["addFESRId"];const Pe=Q["addFESRSemanticStepName"];const Ce=()=>V.last("/core/shell/enablePersonalization")||V.last("/core/catalog/enabled");const Ge=de.extend("sap.cux.home.FavAppPanel",{constructor:function e(){de.prototype.constructor.apply(this,arguments);this._selectedApps=[];this._updateAppColorPersonalization=(e,t)=>{const{visualization:n,color:o}=t;const{appId:i,oldAppId:s,persConfig:r}=n;const a=r?.sectionId;const p=r?.isDefaultSection;const l=this._getPersonalizationIndex(e,{appId:i,oldAppId:s,sectionId:a,isRecentlyAddedApp:p});if(l>-1){e[l].BGColor=o}else{e.push({BGColor:o,sectionId:a,isRecentlyAddedApp:p,appId:i,isSection:false})}}},metadata:{library:"sap.cux.home",defaultAggregation:"apps",aggregations:{apps:{type:"sap.cux.home.App",singularName:"app",multiple:true,visibility:"hidden"},groups:{type:"sap.cux.home.Group",singularName:"group",multiple:true,visibility:"hidden"}}},init:function e(){de.prototype.init.call(this);this.setProperty("key","favApps");this.setProperty("title",this._i18nBundle.getText("favoritesTab"));this.setProperty("tooltip",this._i18nBundle.getText("favAppsInfo"));void this._createActionButtons();this._createHeaderMenuItems();this._generateAppsWrapper()?.addDragDropConfig(new b(`${this.getId()}-dragDropInfo`,{sourceAggregation:"items",targetAggregation:"items",dropPosition:le.DropPosition.OnOrBetween,dropLayout:le.DropLayout.Horizontal,drop:e=>{void this._onFavItemDrop(e)}})).attachBrowserEvent("keydown",e=>{const t=e.metaKey||e.ctrlKey;void ve(e,t,e=>this._onFavItemDrop(e))}).attachBrowserEvent("keydown",e=>this._handleKeyboardMoveApp(e));this.oEventBus=$.getInstance();this.oEventBus.subscribe("importChannel","appsImport",(e,t,n)=>{const o=this;const i=n;i.forEach(function(e){try{return Promise.resolve(o.appManagerInstance.addSection({id:e.id,title:e.title,default:e.default,preset:e.preset,visualizations:e.visualizations})).then(function(){})}catch(e){return Promise.reject(e)}});this._importdone()},this);this.oEventBus.subscribe("importChannel","resetImported",()=>{this.setImportButtonVisibility(true)},this);this.attachNavigated(()=>{if(this._selectedGroupId){void this._showGroupDetailDialog(this._selectedGroupId)}});document.addEventListener("click",e=>this._resetCutElement(e));document.addEventListener("keydown",e=>this._resetCutElement(e))},_importdone:function e(){const t={status:true};this.oEventBus.publish("importChannel","appsImported",t)},loadApps:function e(){try{const e=this;return Promise.resolve(e.appManagerInstance.fetchFavVizs(true,false)).then(function(t){e.destroyAggregation("groups",true);const n=t.filter(e=>e.isSection).map(t=>({...t,menuItems:e._getGroupActions(t)}));const o=e._generateGroups(n);e._setGroups(o);e.destroyAggregation("apps",true);const i=t.filter(e=>!e.isSection).map(t=>({...t,menuItems:e._getAppActions()}));const s=e.generateApps(i);e.setApps(s);if(e._selectedGroupId){void e._setGroupDetailDialogApps(e._selectedGroupId)}const r=e.getParent();r.toggleMenuListItem(e._createGroupMenuItem,e.getApps().length>0)})}catch(e){return Promise.reject(e)}},_generateGroups:function e(t){return t.map((e,t)=>{const n=new ge(`${this.getId()}-group-${t}`,{title:e.title,bgColor:e.BGColor,status:e.status,icon:e.icon,number:e.badge,groupId:e.id,press:this._handleGroupPress.bind(this)});e.menuItems?.forEach(e=>{n.addAggregation("menuItems",e)});return n})},_setGroups:function e(t){t.forEach(e=>{this.addAggregation("groups",e,true)})},_getAppActions:function e(t){const n=t?.getGroupId();const o=!n;const i=[];const s=new he("",{title:this._i18nBundle.getText("selectColor"),type:te.Navigation,press:this._openColorPopover.bind(this)});i.push(s);Ae(s,"changeColor");if(this._getAllowedMoveGroups(n)?.length>=1){const e=new he("",{title:this._i18nBundle.getText("moveTo"),type:te.Navigation,press:e=>this._openMoveToGroupPopover(e,t)});i.push(e);Ae(e,"moveToGroup")}if(o){const e=new he({title:this._i18nBundle.getText("createGroup"),press:e=>{const t=e.getSource();const n=t.getParent();this._selectedApps=[n];this._openCreateGroupDialog()}});i.push(e);Ae(e,"createGroupDialog")}const r=new he({title:this._i18nBundle.getText("removeFromMyHome"),press:e=>{const n=e.getSource();const o=n.getParent();this._handleRemove(o,t)}});i.push(r);Ae(r,"removeFromMyHome");if(!o){const e=new he({title:this._i18nBundle.getText("removeFromGroup"),press:e=>{const t=e.getSource();const o=t.getParent();void this._handleMoveToGroup(o,n)}});i.push(e);Ae(e,"ungroupApp")}return i},_getGroupActions:function e(t){const n=new he(`id-${t.id}-renameGroup`,{title:this._i18nBundle.getText("renameGroup"),press:this._onRenameGroup.bind(this)});Ae(n,"renameGroup");const o=new he(`id-${t.id}-selectColor`,{title:this._i18nBundle.getText("selectColor"),type:te.Navigation,press:this._openColorPopover.bind(this)});Ae(o,"changeColor");const i=new he(`id-${t.id}-removeAllApps`,{title:this._i18nBundle.getText("removeAllApps"),press:this._handleUngroupApps.bind(this,t)});Ae(i,"removeAllApps");const s=[n,o,i];if(!t.isPresetSection){const e=new he(`id-${t.id}-delete`,{title:this._i18nBundle.getText("delete"),press:this._onDeleteGroup.bind(this)});Ae(e,"deleteGroup");s.push(e)}return s},_createActionButtons:function e(){try{const e=this;if(!e._actionButtons){e._actionButtons=[];if(Ce()){const t=new o(`${e.getId()}-addAppsBtn`,{icon:"sap-icon://action",tooltip:e._i18nBundle.getText("addAppsTooltip"),text:e._i18nBundle.getText("addApps"),press:()=>{void e.navigateToAppFinder()}});Ae(t,"addAppsBtn");e._actionButtons.push(t)}}e._actionButtons.forEach(t=>{e.addAggregation("actionButtons",t)});return Promise.resolve(e._validateAppsMigration()).then(function(t){if(t){e._createImportButton()}})}catch(e){return Promise.reject(e)}},_createImportButton:function e(){if(!this._importButton){this._importButton=new o(`${this.getId()}-importAppsBtn`,{tooltip:this._i18nBundle.getText("importAppsNow"),text:this._i18nBundle.getText("importAppsNow"),press:this._openImportAppsDialog.bind(this)});Ae(this._importButton,"importAppsDialog");this._actionButtons.push(this._importButton);this.insertAggregation("actionButtons",this._importButton,0)}return this._importButton},setImportButtonVisibility:function e(t){this._createImportButton().setVisible(t)},_createHeaderMenuItems:function e(){if(!this._menuItems){this._createGroupMenuItem=new he(`${this.getId()}-createGrpMenuBtn`,{title:this._i18nBundle.getText("createGroup"),icon:"sap-icon://add",press:()=>this._openCreateGroupDialog()});this._menuItems=[this._createGroupMenuItem];if(Ce()){this._menuItems.push(new he(`${this.getId()}-addAppsMenuBtn`,{title:this._i18nBundle.getText("addApps"),icon:"sap-icon://action",press:()=>{void this.navigateToAppFinder()}}))}this._menuItems.push(new he(`${this.getId()}-addInsightsMenuBtn`,{title:this._i18nBundle.getText("addFromInsights"),icon:"sap-icon://duplicate",press:()=>{void this._handleAddFromInsights()}}));Ae(this._createGroupMenuItem,"createGroupDialog");const e=this._menuItems.find(e=>e.getId()===`${this.getId()}-addAppsMenuBtn`);if(e){Ae(e,"appsAppFinder")}const t=this._menuItems.find(e=>e.getId()===`${this.getId()}-addInsightsMenuBtn`);if(t){Ae(t,"staticTilesDialog")}this._menuItems.forEach(e=>{this.addAggregation("menuItems",e,true)})}},_getDragDropInfo:function e(t,n){try{const e=this;const o=t.getParameter?.("draggedControl"),i=t.getParameter?.("droppedControl"),s=t.getParameter?.("dropPosition"),r=o.getParent(),a=r.indexOfItem(o),p=r.indexOfItem(i),l=e._getTileItem(o,n),c=e._getTileItem(i,n);const u={dragItem:l,dropItem:c,dropPosition:s,dropControl:r,dragItemIndex:a,dropItemIndex:p};const d=function(){if(a!==p){const t=function(){if(!l?.isA("sap.cux.home.Group")&&!c?.isA("sap.cux.home.Group")){return Promise.resolve(e._adjustAppDragDropInfo(u,n)).then(function(){})}else{const t=function(){if(l?.isA("sap.cux.home.Group")){return Promise.resolve(e._adjustGroupDragDropInfo(u)).then(function(){})}}();if(t&&t.then)return t.then(function(){})}}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(d&&d.then?d.then(function(){return u}):u)}catch(e){return Promise.reject(e)}},_adjustAppDragDropInfo:function e(t,n){try{const e=this;let o=false;const i=t.dragItem;const s=t.dropItem;return Promise.resolve(Promise.all([e.appManagerInstance.getVisualization(i.getUrl(),n),e.appManagerInstance.getVisualization(s.getUrl(),n)])).then(function(i){let[s,r]=i;if(t.dropPosition===le.RelativeDropPosition.Before){if(t.dragItemIndex===t.dropItemIndex-1){t.dropItemIndex--}if(t.dragItemIndex<t.dropItemIndex&&s?.persConfig?.sectionIndex===r?.persConfig?.sectionIndex){t.dropItemIndex--;o=true}}else if(t.dropPosition===le.RelativeDropPosition.After){if(t.dragItemIndex===t.dropItemIndex+1){t.dropItemIndex++}if(t.dragItemIndex>t.dropItemIndex&&s?.persConfig?.sectionIndex===r?.persConfig?.sectionIndex){t.dropItemIndex++;o=true}}if(o){const o=t.dropControl.getItems()[t.dropItemIndex];const i=e._getTileItem(o,n);if(i){t.dropItem=i}}})}catch(e){return Promise.reject(e)}},_getTileItem:function e(t,n){const o=t.data("groupId");if(o){return this._getGroup(o)}else{const e=n?this._getGroup(n):null;const o=e?e.getApps():this.getApps();return o.find(e=>Ie.getLeanURL(e.getUrl())===t.getUrl())}},_adjustGroupDragDropInfo:function e(t){try{const e=this;return Promise.resolve(e.appManagerInstance._getSections()).then(function(n){let o;t.dragItemIndex=n.findIndex(e=>e.id===t.dragItem.getGroupId());if(!t.dropItem.isA("sap.cux.home.Group")){const n=e.getAggregation("groups").length;t.dropItemIndex=t.dropPosition===le.RelativeDropPosition.Before&&t.dropItemIndex===n&&t.dragItemIndex!==n?n+1:t.dragItemIndex}else{o=n.findIndex(e=>e.id===t.dropItem.getGroupId());t.dropItemIndex=o}if(t.dropPosition===le.RelativeDropPosition.Before&&t.dragItemIndex===t.dropItemIndex-1){t.dropItemIndex--}else if(t.dropPosition===le.RelativeDropPosition.After&&(t.dragItemIndex!==t.dropItemIndex||o&&t.dropItemIndex>=o)){t.dropItemIndex++}})}catch(e){return Promise.reject(e)}},_onFavItemDrop:function e(t,n){try{const e=this;const o=t.getParameter?.("draggedControl");return Promise.resolve(e._getDragDropInfo(t,n)).then(function(t){function i(){o.removeStyleClass("sapMGTPressActive")}const{dragItemIndex:s,dropItemIndex:r,dropPosition:a,dragItem:p,dropItem:l}=t;if(s===r)return;const c=function(){if(a===le.RelativeDropPosition.On){return Promise.resolve(e._handleOnItemDrop(p,l)).then(function(){void e.refresh()})}else{const o=function(){if(a===le.RelativeDropPosition.After||a===le.RelativeDropPosition.Before){e._setBusy(true);return Promise.resolve(e._handleItemsReorder(t,n)).then(function(){return Promise.resolve(e.refresh()).then(function(){if(n){void e._setGroupDetailDialogApps(n)}e._setBusy(false)})})}}();if(o&&o.then)return o.then(function(){})}}();return c&&c.then?c.then(i):i(c)})}catch(e){return Promise.reject(e)}},_handleOnItemDrop:function e(t,n){try{const e=this;if(t.isA("sap.cux.home.Group"))return Promise.resolve();const o=function(){if(!n.isA("sap.cux.home.Group")){const o=t;const i=n;e._selectedApps=[o,i];e._openCreateGroupDialog(true)}else{const o=n.getGroupId();e._setBusy(true);return Promise.resolve(e._handleMoveToGroup(t,undefined,o)).then(function(){e._setBusy(false)})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_handleItemsReorder:function e(t,n){try{const e=this;const{dragItem:o,dropItem:i,dragItemIndex:s,dropItemIndex:r}=t;const a=o.isA("sap.cux.home.Group");const p=i.isA("sap.cux.home.Group");const l=function(){if(!a&&!p){const t=o;const s=i;return Promise.resolve(Promise.all([e.appManagerInstance.getVisualization(t.getUrl(),n),e.appManagerInstance.getVisualization(s.getUrl(),n)])).then(function(t){let[n,o]=t;return Promise.resolve(e.appManagerInstance.moveVisualization({sourceSectionIndex:n?.persConfig?.sectionIndex,sourceVisualizationIndex:n?.persConfig?.visualizationIndex,targetSectionIndex:o?.persConfig?.sectionIndex,targetVisualizationIndex:o?.persConfig?.visualizationIndex})).then(function(){})})}else{const t=function(){if(a&&p){return Promise.resolve(e.appManagerInstance.moveSection(s,r)).then(function(){})}}();if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(l&&l.then?l.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},navigateToAppFinder:function e(t){try{return Promise.resolve(R.getServiceAsync("Navigation")).then(function(e){const n={pageID:_e};if(t){n.sectionID=t}return Promise.resolve(e.navigate({target:{shellHash:`Shell-appfinder?&/catalog/${JSON.stringify(n)}`}})).then(function(){})})}catch(e){return Promise.reject(e)}},_validateAppsMigration:function e(){try{return Promise.resolve(L.isImportEnabled())}catch(e){return Promise.reject(e)}},_openImportAppsDialog:function e(){const t=new j;t.onImportDialogPress()},_openCreateGroupDialog:function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const n=this._generateCreateGroupDialog(t);const o=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-scrollContainer-apps`);o.destroyItems();const i=[...this.getApps()].map(e=>{const t=e.clone();t._onPress=e=>this._highlightApp(e,t);return this.getParent()._getAppTile(t)});this._setAggregation(o,i);let s=this.getApps();this.getParent().fireEvent("appsLoaded",{apps:s,tiles:i});this._updateSelectedAppCount();n.open()},_closeCreateGroupDialog:function e(){const t=this._generateCreateGroupDialog();t?.close();this._resetCreateGroupDialog()},_resetCreateGroupDialog:function e(){const t=this._generateCreateGroupNavContainer();const n=this._controlMap.get(`${this.getId()}-createGroupDialog-mainPage-form-groupName-input`);const o=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-search`);n.setValue("");t.to(t.getInitialPage());this._selectedApps=[];o.setValue("");this._setNoAppsSelectedError(false);this._selectedGroupColor=undefined},_generateCreateGroupDialog:function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;const n=`${this.getId()}-createGroupDialog`;const i=this._generateCreateGroupNavContainer();const s=e=>{const t=this._controlMap.get(`${n}-nextBtn`);const o=this._controlMap.get(`${n}-backBtn`);const s=this._controlMap.get(`${n}-createBtn`);const r=i.indexOfPage(i.getCurrentPage());t.setVisible(r!==i.getPages().length-1&&!e);o.setVisible(r!==0&&!e);s.setVisible(r===i.getPages().length-1||e)};if(!this._controlMap.get(n)){this._controlMap.set(`${n}-nextBtn`,new o({id:`${n}-nextBtn`,text:this._i18nBundle.getText("nextButton"),press:()=>{if(this._validateGroupName()){i.to(this._generateCreateGroupAppsPage());s(t);this._highlightSelectedApps()}},type:"Emphasized"}));const e=this._controlMap.get(`${n}-nextBtn`);Pe(e,"press","createGroupNextBtn");this._controlMap.set(`${n}-backBtn`,new o({id:`${n}-backBtn`,text:this._i18nBundle.getText("backButton"),press:()=>{i.back();s(t)}}));const r=this._controlMap.get(`${n}-backBtn`);Pe(r,"press","createGroupBackBtn");this._controlMap.set(`${n}-createBtn`,new o({id:`${n}-createBtn`,text:this._i18nBundle.getText("createButton"),press:()=>{void this._onPressGroupCreate()},type:"Emphasized"}));const p=this._controlMap.get(`${n}-createBtn`);Pe(p,"press","addCreateGroup");this._controlMap.set(n,new a(n,{title:this._i18nBundle.getText("createGroup"),content:i,escapeHandler:this._closeCreateGroupDialog.bind(this),contentHeight:"25rem",contentWidth:"41.75rem",buttons:[e,r,p,new o({id:`${n}-cancelBtn`,text:this._i18nBundle.getText("cancelBtn"),press:this._closeCreateGroupDialog.bind(this)})]}).addStyleClass("sapCuxCreateGroupDialog sapContrastPlus"))}s(t);return this._controlMap.get(n)},_highlightApp:function e(t,n){const o=t.getSource(),i=!o.hasStyleClass("sapCuxHighlightApp"),s=this._generateAppsScrollContainer();this._selectedApps=this._selectedApps||[];if(i){this._selectedApps.push(n)}else{this._selectedApps.splice(this._selectedApps.findIndex(e=>n.getUrl()===e.getUrl()),1)}this._updateSelectedAppCount();o.toggleStyleClass("sapCuxHighlightApp",i);this._setNoAppsSelectedError(this._selectedApps.length<1);s.setHeight(this._selectedApps.length<1?"15.3rem":"17.5rem")},_generateAppsScrollContainer:function e(){const o=`${this.getId()}-createGroupDialog-appsPage-scrollContainer`;if(!this._controlMap.get(o)){this._controlMap.set(`${o}-apps`,new t({id:`${o}-apps`,layout:new n({columnSize:"19rem",gap:"0.5rem"})}).addStyleClass("sapCuxAppsGridContainerPadding"));this._controlMap.set(o,new A(o,{id:o,vertical:true,visible:true,height:"17.5rem",content:[this._controlMap.get(`${o}-apps`)]}).addStyleClass("sapUiSmallMarginBeginEnd"))}return this._controlMap.get(o)},_updateSelectedAppCount:function e(){const t=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-headerContainer-count`);t.setText(this._i18nBundle.getText("selectedAppsCount",[this._selectedApps?.length||this._i18nBundle.getText("noAppSelected")]))},_generateCreateGroupNavContainer:function e(){const t=`${this.getId()}-createGroupDialog-wrapper`;if(!this._controlMap.get(t)){this._controlMap.set(t,new m(t,{initialPage:`${this.getId()}-createGroupDialog-mainPage`,pages:[this._generateCreateGroupMainPage(),this._generateCreateGroupAppsPage()]}))}return this._controlMap.get(t)},_generateCreateGroupMainPage:function e(){const t=`${this.getId()}-createGroupDialog-mainPage`;if(!this._controlMap.get(t)){this._controlMap.set(`${t}-form-groupName-input`,new c({id:`${t}-form-groupName-input`,width:"13.75rem",required:true,liveChange:this._validateGroupName.bind(this)}));this._controlMap.set(t,new I({id:t,showHeader:false,enableScrolling:false,backgroundDesign:"List",content:[new x({id:`${t}-headerContainer`,items:[new B({id:`${t}-title`,text:this._i18nBundle.getText("settings")}),new G({id:`${t}-description`,text:this._i18nBundle.getText("settingsDescription")})]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBeginEnd sapUiTinyMarginBottom"),new U(`${t}-form`,{layout:ce.SimpleFormLayout.ResponsiveGridLayout,labelSpanS:4,labelSpanM:4,content:[new u({id:`${t}-form-groupName-label`,text:this._i18nBundle.getText("groupNameLbl")}).addStyleClass("sapUiTinyMarginTop"),this._controlMap.get(`${t}-form-groupName-input`),new u({id:`${t}-form-groupColor-label`,text:this._i18nBundle.getText("groupColorLbl")}).addStyleClass("sapUiTinyMarginTop"),new i(`${t}-form-groupColor-pallet`,{colors:me().map(e=>e.value),colorSelect:this._onColorSelect.bind(this)})]}).addStyleClass("sapUiMediumMarginTop")]}))}return this._controlMap.get(t)},_generateCreateGroupAppsPage:function e(){const t=`${this.getId()}-createGroupDialog-appsPage`;if(!this._controlMap.get(t)){this._controlMap.set(`${t}-search`,new P({id:`${t}-search`,liveChange:this._onCreateAppSearch.bind(this)}).addStyleClass("sapUiTinyMarginTopBottom"));this._controlMap.set(`${t}-errorMessageStrip`,new h(`${t}-errorMessageStrip`,{id:`${t}-errorMessageStrip`,type:E.Error,showIcon:true,text:this._i18nBundle.getText("selectionErrorMessage"),visible:false}));this._controlMap.set(`${t}-headerContainer-count`,new G({id:`${t}-headerContainer-count`}));this._controlMap.set(t,new I(t,{showHeader:false,backgroundDesign:"List",enableScrolling:false,content:[new x(`${t}-headerContainer`,{items:[new p(`${t}-headerContainer-titleCount`,{id:`${t}-headerContainer-titleCount`,items:[new B({id:`${t}-headerContainer-title`,text:this._i18nBundle.getText("selectedAppsTitle")}).addStyleClass("sapUiTinyMarginEnd"),this._controlMap.get(`${t}-headerContainer-count`)]}),new G({id:`${t}-description`,text:this._i18nBundle.getText("appsSelectionDescription")}).addStyleClass("sapUiTinyMarginBottom"),this._controlMap.get(`${t}-search`),this._controlMap.get(`${t}-errorMessageStrip`)]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBeginEnd sapUiTinyMarginBottom"),this._generateAppsScrollContainer(),this._generateCreateGroupErrorMsg()]}))}return this._controlMap.get(t)},_generateCreateGroupErrorMsg:function e(){const t=`${this.getId()}-createGroupDialog-appsPage-noFilterApps`;if(!this._controlMap.get(t)){this._controlMap.set(t,new l({id:t,illustrationSize:"Spot",illustrationType:"sapIllus-SearchFolder",title:this._i18nBundle.getText("noSearchedAppTitle"),description:this._i18nBundle.getText("noSearchedAppDes"),visible:false}))}return this._controlMap.get(t)},_onColorSelect:function e(t){this._selectedGroupColor=this._getLegendColor(t.getParameter("value")).key},_getLegendColor:function e(t){return me().find(e=>e.value===t)||fe()},_setNoAppsSelectedError:function e(t){const n=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-errorMessageStrip`);n.setVisible(t)},_validateGroupName:function e(){const t=this._controlMap.get(`${this.getId()}-createGroupDialog-mainPage-form-groupName-input`);const n=t.getValue().trim();t.setValueState(n?"None":"Error");t.setValueStateText(n?"":this._i18nBundle.getText("invalidGroupName"));return n?true:false},_highlightSelectedApps:function e(){const t=this._selectedApps||[];const n=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-scrollContainer-apps`);const o=n.getItems()||[];o.forEach(e=>{e.toggleStyleClass("sapCuxHighlightApp",t.some(t=>Ie.getLeanURL(t.getUrl())===e.getUrl()))})},_onCreateAppSearch:function e(t){const n=this._controlMap.get(`${this.getId()}-createGroupDialog-appsPage-scrollContainer-apps`),o=t.getSource().getValue(),i=n.getItems()||[],s=new RegExp(o,"i");i.forEach(e=>{e.setVisible(s.test(e.getHeader()))});const r=i.filter(e=>e.getVisible());const a=r.length>0;this._generateAppsScrollContainer()?.setVisible(a);this._generateCreateGroupErrorMsg()?.setVisible(!a)},_onPressGroupCreate:function e(){try{const e=this;const t=e._controlMap.get(`${e.getId()}-createGroupDialog-mainPage-form-groupName-input`);const n=function(){if(e._validateGroupName()){const n=function(){if(e._selectedApps?.length){e._setBusy(true);return Promise.resolve(e._createGroup({selectedApps:e._selectedApps,groupName:t.getValue(),groupColor:e._getGroupColor()})).then(function(){return Promise.resolve(e.refresh()).then(function(){e._setBusy(false);e._closeCreateGroupDialog();f.show(e._i18nBundle.getText("newGroupCreated"),{of:e._controlMap.get(`${e.getId()}-createGroupDialog`),offset:"0 80"});const t=e.getAggregation("groups")||[];void e._showGroupDetailDialog(t[0]?.getGroupId())})})}else{e._setNoAppsSelectedError(true)}}();if(n&&n.then)return n.then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_createGroup:function e(t){try{const e=this;const{selectedApps:n,groupName:o,groupColor:i}=t;return Promise.resolve(e.appManagerInstance.getSectionVisualizations()).then(function(t){const s=n.reduce((e,n)=>{const o=t.find(e=>e.url===n.getUrl());if(o){e.push(o)}return e},[]);const r=s[0].persConfig.sectionId;return Promise.resolve(e.appManagerInstance.addSection({sectionIndex:1,sectionProperties:{title:o||e._i18nBundle.getText("newGroup"),visible:true,visualizations:s.map(e=>e.visualization)}})).then(function(){const t=s.reduce((e,t)=>{if(t.visualization?.id){const n=(t.persConfig?.duplicateApps||[]).map(e=>e.visualization?.id);e=e.concat([t.visualization?.id],n)}return e},[]);return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:r,vizIds:t})).then(function(){return Promise.resolve(e.appManagerInstance._getSections(true)).then(function(t){const n=t.find(e=>e.default);const o=t[n?1:0]?.id;return Promise.resolve(e._updateAppPersonalization(s.map(e=>({visualization:e,targetGroupId:o})))).then(function(){return Promise.resolve(e._updateGroupPersonalization(o,i)).then(function(){})})})})})})}catch(e){return Promise.reject(e)}},_getGroupColor:function e(){const t=fe().key;const n=this._selectedApps[0];const o=this._selectedApps.some(e=>e.getBgColor()!==n.getBgColor());return this._selectedGroupColor||(o?t:n.getBgColor())},_openColorPopover:function e(t){const n=`${this.getId()}-colorPopover`,o=me().map(e=>e.value);const i=t.getSource();this._currentItem=i.getParent();let r=this._controlMap.get(n);if(!r){r=new s(n,{id:n,colors:o,showDefaultColorButton:false,showMoreColorsButton:false,showRecentColorsSection:false,colorSelect:e=>{ue._closeActionsPopover();const t=e.getParameter("value");void this._handleColorSelect(this._currentItem,t)}}).addStyleClass("sapContrastPlus");r._oPopover.setPlacement(ae.HorizontalPreferredRight);this._controlMap.set(n,r)}r.openBy(t.getParameter("listItem"))},_handleColorSelect:function e(t,n){try{const e=this;const o=e._getLegendColor(n).key;t.setProperty("bgColor",o,true);const i=t.isA("sap.cux.home.Group")?t.getGroupId():null;const s=!i&&t.getParent()?.isA("sap.cux.home.Group");if(s){e._refreshGroupDetailDialog(t,false)}else{e._applyUngroupedTileColor(t,n)}const r=function(){if(i){void e._updateGroupPersonalization(i,o);const t=e._controlMap.get(`${e.getId()}-detailDialog-toolbar-color`);t?.setColor(n)}else{const n=t;const i=s?n.getParent().getGroupId():undefined;return Promise.resolve(e.appManagerInstance.getVisualization(n.getUrl(),i)).then(function(t){if(t){void e._updateAppPersonalization([{visualization:t,color:o}])}})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_applyUngroupedTileColor:function e(t,n){const o=this.fetchTileVisualization();const i=t.isA("sap.cux.home.Group")?t.getGroupId():null;const s=o.findIndex(e=>i?e.data("groupId")===i:e.getUrl()===Ie.getLeanURL(t.getUrl()));o[s].setBackgroundColor(n)},_getAllowedMoveGroups:function e(t){let n=this.getAggregation("groups")||[];if(t){n=n.filter(e=>e.getGroupId()!==t)}return n},_setBusy:function e(t){[this._generateGroupDetailDialog(),this._generateCreateGroupDialog(),this._generateAddFromInsightsDialog()].forEach(e=>{e.setBusy(t)});de.prototype.setBusy.call(this,t)},_openMoveToGroupPopover:function e(t,n){const o=`${this.getId()}-moveToGroupPopover`,i=t?.getSource(),s=i?.getParent(),r=n?.getGroupId();let a=this._controlMap.get(`${o}-list`),p=this._controlMap.get(o);if(!p){a=new d({id:`${o}-list`,itemPress:()=>ue._closeActionsPopover()});this._controlMap.set(`${o}-list`,a);p=new v({id:o,showHeader:false,placement:ae.HorizontalPreferredRight,content:[a]}).addStyleClass("sapContrastPlus");this._controlMap.set(o,p)}a.removeAllItems();this._getAllowedMoveGroups(r).forEach(e=>a.addItem(new C({title:e.getTitle(),type:"Active",press:()=>{void this._handleMoveToGroup(s,r,e.getGroupId())}})));p.openBy(t.getParameter("listItem"))},_handleRemove:function e(t,n){const o=this;const i=n?.getApps()?.length===1;let s=this._i18nBundle.getText("removeAppMessage",[t.getTitle()]),r=this._i18nBundle.getText("remove"),a=this._i18nBundle.getText("remove"),p=g.Icon.QUESTION;if(i){s=this._i18nBundle.getText("removeFromMyHomeMessage",[t.getTitle()]);r=this._i18nBundle.getText("delete");a=this._i18nBundle.getText("delete");p=g.Icon.WARNING}g.show(s,{icon:p,title:r,actions:[a,g.Action.CANCEL],emphasizedAction:a,onClose:function(e){try{const s=function(){if(e===a){o._setBusy(true);return Promise.resolve(o._removeApp(t,n)).then(function(){if(i){o._closeGroupDetailDialog()}if(n){o._refreshGroupDetailDialog(t)}return Promise.resolve(o.getParent()._refreshAllPanels()).then(function(){f.show(o._i18nBundle.getText("appRemoved"));o._setBusy(false)})})}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}})},_removeApp:function e(t,n){try{const e=this;const o=n?.getApps()?.length===1,i=n?.getGroupId(),s=t.getUrl();return Promise.resolve(e.appManagerInstance.getVisualization(s,i)).then(function(t){const n=function(){if(o){return Promise.resolve(e._deleteGroup(i)).then(function(){})}else{let n=[t?.visualization?.id];if(!i){n=n.concat(t?.persConfig?.duplicateApps?.map(e=>e.visualization?.id))}const o=function(){if(t?.persConfig?.sectionId&&n.length>0){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:t.persConfig.sectionId,vizIds:n})).then(function(){void e._deletePersonalization({appId:s,oldAppId:t?.oldAppId,sectionId:t?.persConfig?.sectionId,isRecentlyAddedApp:t?.persConfig?.isDefaultSection})})}}();if(o&&o.then)return o.then(function(){})}}();if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}},_handleMoveToGroup:function e(t,n,o){try{const e=this;const i=n?e._getGroup(n):undefined,s=i?.getApps()?.length===1;const r=function(){if(s){const i=e._i18nBundle.getText("moveAppMessage",[t.getTitle()]);const s=e._i18nBundle.getText("delete");g.show(i,{icon:g.Icon.WARNING,title:s,actions:[s,g.Action.CANCEL],emphasizedAction:s,onClose:i=>{if(i===s){void e._moveAppAndHandleGroupChanges(t,n,o)}}})}else{return Promise.resolve(e._moveAppAndHandleGroupChanges(t,n,o)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_moveAppAndHandleGroupChanges:function t(n,o,i){try{const t=this;const s=o?t._getGroup(o):null,r=i?t._getGroup(i):null,a=r?.getTitle(),p=s?.getApps()?.length===1;const l=ee(function(){return X(function(){t._setBusy(true);return Promise.resolve(t._moveAppToGroup(n,o,i)).then(function(){function e(){if(o){t._refreshGroupDetailDialog(n)}const e=a?t._i18nBundle.getText("appMoved",[a]):t._i18nBundle.getText("appUngrouped");f.show(e);return Promise.resolve(t.refresh()).then(function(){})}const i=function(){if(p&&o){return Promise.resolve(t._deleteGroup(o)).then(function(){t._closeGroupDetailDialog()})}}();return i&&i.then?i.then(e):e(i)})},function(t){e.error(t)})},function(e,n){t._setBusy(false);if(e)throw n;return n});return Promise.resolve(l&&l.then?l.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_refreshGroupDetailDialog:function e(t){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;const o=this._controlMap.get(`${this.getId()}-detailDialog-apps`);const i=o.getItems();const s=t.getParent();const r=s.getApps();if(n){const e=r.findIndex(e=>e.getUrl()===t.getUrl());r[e].destroy(true);i[e].destroy(true)}else{r.forEach((e,n)=>{if(e.getUrl()===t.getUrl()){e.setProperty("bgColor",t.getBgColor(),true);i[n].setBackgroundColor(t.getBgColor())}})}},_moveAppToGroup:function e(t,n,o){try{const e=this;const i=t.getUrl();return Promise.resolve(Promise.all([e.appManagerInstance.getSectionVisualizations(n),e.appManagerInstance._getSections()])).then(function(t){let[s,r]=t;const a=s.find(e=>e.url===i),p=a?.persConfig?.visualizationIndex??-1,l=a?.persConfig?.sectionIndex;const c=!o;const u=!n;const d=r.findIndex(e=>!o?e.default:e.id===o);const g=p>-1?s[p]:null;const h=function(){if(g!==null){function t(){return Promise.resolve(e.appManagerInstance._getSections(true)).then(function(t){const n=t.find(e=>e.default);return Promise.resolve(e._updateAppPersonalization([{visualization:g,targetGroupId:o??n?.id,isTargetGroupDefault:c}])).then(function(){})})}const n=function(){if(c){return Promise.resolve(e._moveAppToDefaultGroup(g)).then(function(){})}else{function t(){return Promise.resolve(e.appManagerInstance.moveVisualization({sourceSectionIndex:l,sourceVisualizationIndex:p,targetSectionIndex:d,targetVisualizationIndex:-1})).then(function(){})}const n=function(){if(u){return Promise.resolve(e._removeDuplicateVisualizations(g)).then(function(){})}}();return n&&n.then?n.then(t):t(n)}}();return n&&n.then?n.then(t):t(n)}}();if(h&&h.then)return h.then(function(){})})}catch(e){return Promise.reject(e)}},_moveAppToDefaultGroup:function e(t){try{const e=this;return Promise.resolve(e._addVisualization(t)).then(function(){const n=function(){if(t.persConfig?.sectionId&&t.visualization?.id){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:t.persConfig?.sectionId,vizIds:[t.visualization?.id]})).then(function(){})}}();if(n&&n.then)return n.then(function(){})})}catch(e){return Promise.reject(e)}},_removeDuplicateVisualizations:function e(t){try{const e=this;const n=t?.persConfig?.duplicateApps?.map(e=>e.visualization?.id)||[];const o=function(){if(t.persConfig?.sectionId&&n.length>0){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:t.persConfig?.sectionId,vizIds:n})).then(function(){})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_onRenameGroup:function e(t){const n=t.getSource()?.getParent();void this._showGroupDetailDialog(n.getGroupId(),true)},_handleUngroupApps:function e(t){const n=this._i18nBundle.getText("ungroupAppsMessage",[t.title]),o=this._i18nBundle.getText("delete"),i=this._i18nBundle.getText("delete");g.show(n,{icon:g.Icon.WARNING,title:o,actions:[i,g.Action.CANCEL],emphasizedAction:i,onClose:e=>{if(e===i){void this._ungroupApps(t.id)}}})},_onDeleteGroup:function e(t){const n=this;const o=t.getSource()?.getParent(),i=this._i18nBundle.getText("deleteGroupMessage",[o.getTitle()]),s=this._i18nBundle.getText("delete"),r=this._i18nBundle.getText("delete"),a=this._i18nBundle.getText("moveApps");g.show(i,{icon:g.Icon.WARNING,title:s,actions:[r,this._i18nBundle.getText("moveApps"),g.Action.CANCEL],emphasizedAction:r,onClose:function(e){try{const t=function(){if(e===r){n._setBusy(true);return Promise.resolve(n._deleteGroup(o.getGroupId())).then(function(){f.show(n._i18nBundle.getText("groupDeleted"));void n.refresh();n._closeGroupDetailDialog();n._setBusy(false)})}else if(e===a){void n._ungroupApps(o.getGroupId())}}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}})},_ungroupApps:function e(t){try{const e=this;e._setBusy(true);return Promise.resolve(e.appManagerInstance.getSectionVisualizations(t)).then(function(n){return Promise.resolve(e.appManagerInstance._getSections()).then(function(o){const i=o.find(e=>e.id===t);return Promise.resolve(Promise.all(n.map(t=>e._addVisualization(t)))).then(function(){return Promise.resolve(e.appManagerInstance._getSections(true)).then(function(o){const s=o.find(e=>e.default);return Promise.resolve(e._updateAppPersonalization(n.map(e=>({visualization:e,targetGroupId:s?.id,isTargetGroupDefault:true})))).then(function(){function o(){e._setBusy(false);f.show(e._i18nBundle.getText("appsUngrouped")??"");e._closeGroupDetailDialog();return Promise.resolve(e.refresh()).then(function(){})}const s=function(){if(i?.preset){return Promise.resolve(e.appManagerInstance.removeVisualizations({sectionId:t,vizIds:n.map(e=>e.visualization?.id)})).then(function(){})}else{return Promise.resolve(e._deleteGroup(t)).then(function(){})}}();return s&&s.then?s.then(o):o(s)})})})})})}catch(e){return Promise.reject(e)}},_showGroupDetailDialog:function e(t){let n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;try{const e=this;const o=e._getGroup(t);if(!o){return Promise.resolve()}e._selectedGroupId=t;const i=e._generateGroupDetailDialog();const s=e._controlMap.get(`${e.getId()}-detailDialog-toolbar-color`);s.setColor(F.get({name:o.getBgColor()}));return Promise.resolve(e._setGroupDetailDialogApps(t)).then(function(){i.open();e._setGroupNameControl(o.getTitle(),n)})}catch(e){return Promise.reject(e)}},_setGroupDetailDialogApps:function e(t){try{const e=this;const n=e._getGroup(t);const o=function(){if(n){return Promise.resolve(e.appManagerInstance.getSectionVisualizations(t,false)).then(function(o){o=o.map(t=>({...t,menuItems:e._getAppActions(n)}));n.destroyAggregation("apps",true);const i=e.generateApps(o);const s=e._controlMap.get(`${e.getId()}-detailDialog-apps`);e._setAggregation(n,i,"apps");s.destroyItems();e._setAggregation(s,n.getApps().map(t=>e.getParent()._getAppTile(t)));e._applyGroupedAppsPersonalization(t);e._dispatchAppsLoadedEvent(i)})}}();return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_applyGroupedAppsPersonalization:function e(t){const n=this._controlMap.get(`${this.getId()}-detailDialog-apps`);const o=n?.getItems()||[];void this._applyTilesPersonalization(o,t,false)},_dispatchAppsLoadedEvent:function e(t){const n=this._controlMap.get(`${this.getId()}-detailDialog-apps`);const o=n?.getItems()||[];this.getParent().fireEvent("appsLoaded",{apps:t,tiles:o})},_generateGroupDetailDialog:function e(){const i=`${this.getId()}-detailDialog`;if(!this._controlMap.get(i)){this._controlMap.set(`${i}-toolbar-color`,new w({id:`${i}-toolbar-color`,src:"sap-icon://color-fill",size:"1.25rem"}).addStyleClass("sapUiTinyMarginEnd"));this._controlMap.set(`${i}-toolbar-title`,new B({id:`${i}-toolbar-title`,visible:true}));const e=new c({id:`${i}-toolbar-title-edit`,width:"13.75rem",visible:false});this._controlMap.set(`${i}-toolbar-title-edit`,e);e.onsapfocusleave=()=>{void this._onGroupEditName(e.getValue())};this._controlMap.set(`${i}-apps`,new t({id:`${i}-apps`,layout:new n({columnSize:"19rem",gap:"0.5rem"})})?.addDragDropConfig(new b(`${i}-apps-dragDropInfo`,{sourceAggregation:"items",targetAggregation:"items",dropPosition:le.DropPosition.Between,dropLayout:le.DropLayout.Horizontal,drop:e=>{void this._onFavItemDrop(e,this._selectedGroupId)}})).attachBrowserEvent("keydown",e=>{const t=e.metaKey||e.ctrlKey;void ve(e,t,e=>this._onFavItemDrop(e,this._selectedGroupId))}).addStyleClass("sapCuxAppsContainerBorder sapCuxAppsDetailContainerPadding"));this._controlMap.set(`${i}-addAppsBtn`,new o(`${i}-addAppsBtn`,{text:this._i18nBundle.getText("addApps"),icon:"sap-icon://action",visible:Ce(),press:()=>{const e=this._selectedGroupId;this._closeGroupDetailDialog();this._selectedGroupId=e;void this.navigateToAppFinder(e)}}));this._controlMap.set(i,new a(i,{content:this._controlMap.get(`${i}-apps`),contentWidth:"60.75rem",endButton:new o({id:`${i}-groupDetailCloseBtn`,text:this._i18nBundle.getText("closeBtn"),press:this._closeGroupDetailDialog.bind(this)}),escapeHandler:this._closeGroupDetailDialog.bind(this),customHeader:new M(`${this.getId()}-toolbar`,{content:[this._controlMap.get(`${i}-toolbar-color`),this._controlMap.get(`${i}-toolbar-title`),this._controlMap.get(`${i}-toolbar-title-edit`),new y({id:`${this.getId()}-toolbarSpacer`}),this._controlMap.get(`${i}-addAppsBtn`),new o({id:"overflowBtn",icon:"sap-icon://overflow",type:"Transparent",press:e=>{const t=e.getSource();const n=this._selectedGroupId?this._getGroup(this._selectedGroupId):null;const o=n?.getAggregation("menuItems");const i=ue.get(o);i.openBy(t)}})]})}).addStyleClass("sapCuxGroupDetailDialog"))}return this._controlMap.get(i)},_closeGroupDetailDialog:function e(){const t=this._controlMap.get(`${this.getId()}-detailDialog`);this._selectedGroupId=undefined;t?.close()},_onGroupEditName:function e(t){try{const n=this;function o(){n._setGroupNameControl(t,false);n._setBusy(false)}n._setBusy(true);const i=n._selectedGroupId,s=n._getGroup(i),r=s?.getTitle();const a=function(){if(t&&t!==r){return Promise.resolve(n._renameGroup(i,t)).then(function(){s?.setProperty("title",t,true);void n.refresh();f.show(n._i18nBundle.getText("groupNameChanged")||"")})}}();return Promise.resolve(a&&a.then?a.then(o):o(a))}catch(p){return Promise.reject(p)}},_renameGroup:function e(t,n){try{return Promise.resolve(R.getServiceAsync("Pages")).then(function(e){const o=e.getPageIndex(_e),i=e.getModel().getProperty(`/pages/${o}/sections/`),s=i.findIndex(e=>e.id===t);const r=function(){if(s>-1){return Promise.resolve(e.renameSection(o,s,n)).then(function(){})}}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},_setGroupNameControl:function e(t,n){const o=this._controlMap.get(`${this.getId()}-detailDialog`);const i=this._controlMap.get(`${this.getId()}-detailDialog-toolbar-title`);const s=this._controlMap.get(`${this.getId()}-detailDialog-toolbar-title-edit`);s.setValue(t);i.setText(t);s?.setVisible(n);i?.setVisible(!n);if(n){o.setInitialFocus(s)}},_generateAddFromInsightsDialog:function e(){const t=`${this.getId()}-addFromInsightsDialog`;const n=()=>{const e=this._getSelectedInsights();this._controlMap.get(`${t}-addBtn`).setEnabled(e.length>0)};if(!this._controlMap.get(t)){const e=(e,t)=>{const n=new o(e,{icon:"sap-icon://action",text:this._i18nBundle.getText("appFinderBtn"),press:()=>{this._closeAddFromInsightsDialog();void this.navigateToAppFinder()},visible:Ce(),type:t||Z.Default});Pe(n,"press","appsAppFinder");return n};this._controlMap.set(`${t}-list`,new d({id:`${t}-list`,mode:"MultiSelect",selectionChange:n}));this._controlMap.set(`${t}-addBtn`,new o({id:`${t}-addBtn`,text:this._i18nBundle.getText("addFromInsightsDialogBtn"),type:"Emphasized",press:()=>{void this._addFromInsights()},enabled:false}));const i=this._controlMap.get(`${t}-addBtn`);Pe(i,"press","addStaticTiles");this._controlMap.set(`${t}-errorMessage`,new l({id:`${t}-errorMessage`,illustrationSize:"Spot",illustrationType:"sapIllus-AddColumn",title:this._i18nBundle.getText("noAppsTitle"),description:this._i18nBundle.getText("noDataMsgInsightTiles"),visible:true}).addStyleClass("sapUiLargeMarginTop"));this._controlMap.set(t,new a(t,{title:this._i18nBundle.getText("addFromInsights"),content:[new u({id:`${t}-label`,text:this._i18nBundle.getText("addFromInsightsDialogLabel"),wrapping:true}).addStyleClass("sapMTitleAlign sapUiTinyMarginTopBottom sapUiSmallMarginBeginEnd"),new p({id:`${t}-textContainer`,justifyContent:"SpaceBetween",alignItems:"Center",items:[new B({id:`${t}-text`,text:this._i18nBundle.getText("addFromInsightsDialogTitle")}),e(`${t}-addAppsBtn`,Z.Transparent)]}).addStyleClass("sapUiTinyMarginTop dialogHeader sapUiSmallMarginBeginEnd"),this._controlMap.get(`${t}-list`),this._controlMap.get(`${t}-errorMessage`)],contentWidth:"42.75rem",contentHeight:"32.5rem",endButton:new o({id:`${t}-addFromInsightsCloseBtn`,text:this._i18nBundle.getText("closeBtn"),press:this._closeAddFromInsightsDialog.bind(this)}),escapeHandler:this._closeAddFromInsightsDialog.bind(this),buttons:[this._controlMap.get(`${t}-addBtn`),new o({id:`${t}-cancelBtn`,text:this._i18nBundle.getText("cancelBtn"),press:this._closeAddFromInsightsDialog.bind(this)})]}).addStyleClass("sapContrastPlus sapCuxAddFromInsightsDialog"))}n();return this._controlMap.get(t)},_handleAddFromInsights:function e(){try{const e=this;return Promise.resolve(e._getInsightTilesToAdd()).then(function(t){const n=e._generateAddFromInsightsDialog();e._controlMap.get(`${e.getId()}-addFromInsightsDialog-errorMessage`)?.setVisible(t.length===0);e._generateInsightListItems(t);n.open()})}catch(e){return Promise.reject(e)}},_generateInsightListItems:function e(t){const n=this._controlMap.get(`${this.getId()}-addFromInsightsDialog-list`);if(t.length){n.destroyItems();const e=t.map((e,t)=>new r({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}`,content:[new p({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}-content`,alignItems:"Center",items:[new w({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}-content-icon`,src:e.icon,backgroundColor:this._getLegendColor(e.BGColor||"").value,color:"white",width:"2.25rem",height:"2.25rem",size:"1.25rem"}).addStyleClass("sapUiRoundedBorder sapUiTinyMargin"),new _({id:`${this.getId()}-addFromInsightsDialog-listItem-${t}-content-identifier`,title:e.title,text:e.subtitle,tooltip:e.title}).addStyleClass("sapUiTinyMargin")]})]}).addStyleClass("sapUiContentPadding").data("vizId",e.visualization?.vizId));this._setAggregation(n,e)}n?.setVisible(t.length!==0)},_getInsightTilesToAdd:function e(){try{const e=this;return Promise.resolve(Promise.all([e.appManagerInstance.fetchInsightApps(true,e._i18nBundle.getText("insights")),e.appManagerInstance.fetchFavVizs(false,true)])).then(function(t){let[n,o]=t;const i=n.reduce((e,t)=>{if(!t.isCount&&!t.isSmartBusinessTile){const n=o.findIndex(e=>e.visualization?.vizId===t.visualization?.vizId||e.appId===t.appId);if(n===-1){e.push(t)}}return e},[]);return e.appManagerInstance._filterDuplicateVizs(i,false)})}catch(e){return Promise.reject(e)}},_closeAddFromInsightsDialog:function e(){const t=this._generateAddFromInsightsDialog();const n=this._controlMap.get(`${this.getId()}-addFromInsightsDialog-list`);n.removeSelections();t?.close()},_getSelectedInsights:function e(){const t=this._controlMap.get(`${this.getId()}-addFromInsightsDialog-list`);return t.getSelectedItems()||[]},_addFromInsights:function e(){try{const t=this;function n(){t._closeAddFromInsightsDialog();f.show(t._i18nBundle.getText(o.length===1?"addFromInsightTileSuccess":"addFromInsightTilesSuccess",[o.length]));return Promise.resolve(t.getParent()._refreshAllPanels()).then(function(){t._setBusy(false)})}t._setBusy(true);const o=t._getSelectedInsights();const i=pe(o,function(e){return Promise.resolve(t.appManagerInstance.addVisualization(e.data("vizId"))).then(function(){})});return Promise.resolve(i&&i.then?i.then(n):n(i))}catch(s){return Promise.reject(s)}},_updateAppPersonalization:function e(t){try{const e=this;return Promise.resolve(e._getAppPersonalization()).then(function(n){for(const o of t){const{visualization:t}=o;const{persConfig:i}=t;const s=i?.sectionId;const r=o.targetGroupId??s;if(s!==r){e._updateMoveAppPersonalization(n,o)}else{e._updateAppColorPersonalization(n,o)}}return Promise.resolve(e.setFavAppsPersonalization(n)).then(function(){})})}catch(e){return Promise.reject(e)}},_updateMoveAppPersonalization:function e(t,n){const{visualization:o,isTargetGroupDefault:i}=n;const{appId:s,oldAppId:r,persConfig:a}=o;const p=a?.sectionId;const l=a?.isDefaultSection;const c=a?.duplicateApps||[];const u=n.targetGroupId??p;const d=this._getPersonalizationIndex(t,{appId:s,oldAppId:r,sectionId:p,isRecentlyAddedApp:l});if(d>-1){const e={...t[d],sectionId:u,isRecentlyAddedApp:i,isSection:false};if(c.length===0){t.splice(d,1)}const n=this._getPersonalizationIndex(t,{appId:s,oldAppId:r,sectionId:u,isRecentlyAddedApp:i});if(n>-1){t.splice(n,1)}t.push(e)}},_updateGroupPersonalization:function e(t,n){try{const e=this;return Promise.resolve(e._getAppPersonalization()).then(function(o){const i=e._getPersonalizationIndex(o,{isSection:true,sectionId:t});const s={BGColor:n,isSection:true,sectionId:t,isRecentlyAddedApp:false};if(i>-1){o[i]=s}else{o.push(s)}return Promise.resolve(e.setFavAppsPersonalization(o)).then(function(){})})}catch(e){return Promise.reject(e)}},_getPersonalizationIndex:function e(t,n){const{appId:o,oldAppId:i,sectionId:s,isSection:r,isRecentlyAddedApp:a}=n;return t.findIndex(e=>{if(r){return e.sectionId===s&&e.isSection}else{return a?(e.appId===o||e.appId===i)&&e.isRecentlyAddedApp:(e.appId===o||e.appId===i)&&e.sectionId===s}})},_addVisualization:function e(t){if(t.visualization){return t.visualization.isBookmark?this.appManagerInstance.addBookMark(t.visualization):this.appManagerInstance.addVisualization(t.visualization.vizId)}return Promise.reject(new Error("No visualization provided to add"))},_deleteGroup:function e(t){try{const e=this;return Promise.resolve(R.getServiceAsync("Pages")).then(function(n){const o=n.getPageIndex(_e),i=n.getModel().getProperty(`/pages/${o}/sections/`),s=i.findIndex(e=>e.id===t);const r=function(){if(s>-1){return Promise.resolve(n.deleteSection(o,s)).then(function(){void e._deletePersonalization({sectionId:t,isSection:true})})}}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},_deletePersonalization:function e(t){try{const e=this;const{isSection:n,sectionId:o}=t;return Promise.resolve(e._getAppPersonalization()).then(function(i){if(!n){const n=e._getPersonalizationIndex(i,t);if(n>-1){i.splice(n,1)}}else{i=i.filter(e=>e.sectionId!==o)}void e.setFavAppsPersonalization(i)})}catch(e){return Promise.reject(e)}},_handleGroupPress:function e(t){const n=t.getParameter("groupId");if(n){void this._showGroupDetailDialog(n)}},_handleKeyboardMoveApp:function e(t,n){try{const e=this;const o=S.closestTo(t.target.firstElementChild);const i=o.getParent();const s=function(){if(t.metaKey||t.ctrlKey){if(t.key==="x"&&!o.data("groupId")&&!e._cutApp&&!n){o.$().css("opacity",.6);o._oMoreIcon.setEnabled(false);e._cutApp=o}const s=function(){if(t.key==="v"&&e._cutApp&&!n){const t=new T("keyboardDragDropEvent",i,{draggedControl:e._cutApp,droppedControl:o,dropPosition:le.RelativeDropPosition.On});return Promise.resolve(e._onFavItemDrop(t)).then(function(){e._cutApp=undefined})}}();if(s&&s.then)return s.then(function(){})}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_resetCutElement:function e(t){const n=this._generateAppsWrapper().getId();if(!t.target.id.includes(n)){this._cutApp?.$().css("opacity","");this._cutApp=undefined}},generateIllustratedMessage:function e(){const t=de.prototype.generateIllustratedMessage.call(this);t.setDescription(this._i18nBundle.getText("noFavAppsDescription"));t.addAdditionalContent(new o(`${this.getId()}-errorMessage-addApps`,{text:this._i18nBundle.getText("addApps"),tooltip:this._i18nBundle.getText("addAppsTooltip"),icon:"sap-icon://action",visible:Ce(),press:()=>{void this.navigateToAppFinder()},type:"Emphasized"}));return t}});return Ge});
//# sourceMappingURL=FavAppPanel-dbg.js.map