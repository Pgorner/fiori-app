/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/f/GridContainer","sap/f/GridContainerSettings","sap/m/HeaderContainer","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/m/MessageToast","sap/m/VBox","sap/m/library","sap/ushell/Config","sap/ushell/Container","./App","./BasePanel","./utils/AppManager","./utils/Device"],function(e,t,i,r,n,s,a,o,p,l,u,c,h,g,d,f){"use strict";function _(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function A(e,t){try{var i=e()}catch(e){return t(e)}if(i&&i.then){return i.then(void 0,t)}return i}const v=l["BackgroundDesign"];function m(e,t){try{var i=e()}catch(e){return t(true,e)}if(i&&i.then){return i.then(t.bind(null,false),t.bind(null,true))}return t(false,i)}const y=_(h);const I=_(g);const M=_(d);const b=f["DeviceType"];const z=I.extend("sap.cux.home.BaseAppPanel",{metadata:{library:"sap.cux.home",defaultAggregation:"apps",aggregations:{apps:{type:"sap.cux.home.App",singularName:"app",multiple:true}},events:{navigated:{},supported:{parameters:{isSupported:{type:"boolean"}}}}},constructor:function e(t,i){I.prototype.constructor.call(this,t,i);this._isDirty=true;this._isMobileDirty=true;this._isLoaded=false;this._isSupported=true;this._setAggregation=function(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];let i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"items";t.forEach(t=>{e.addAggregation(i,t,true)})}},init:function e(){I.prototype.init.call(this);this.appManagerInstance=M.getInstance();this._controlMap=new Map;this._appsPanelWrapper=this._generateWrapper();this._addContent(this._appsPanelWrapper)},_generateWrapper:function e(){if(!this._appsPanelWrapper){this._appsPanelWrapper=new p(`${this.getId()}-appsPanelWrapper`,{items:[this._generateDesktopAppsWrapper(),this._generateMobileAppsWrapper(),this._generateErrorMessage()],width:"100%"}).addStyleClass("sapCuxAppsPanel sapCuxAppsContainerBorder")}return this._appsPanelWrapper},_generateDesktopAppsWrapper:function e(){const t=`${this.getId()}-desktopAppsWrapper`;if(!this._controlMap.get(t)){this._controlMap.set(t,new p({id:`${this.getId()}-desktopAppsWrapper`,items:[this._generateAppsWrapper()],visible:this.getDeviceType()!==b.Mobile,backgroundDesign:v.Solid}).addStyleClass("sapCuxAppsPanel sapCuxAppsContainerBorder"))}return this._controlMap.get(t)},_generateAppsWrapper:function e(){if(!this._appsWrapper){this._appsWrapper=new t({id:`${this.getId()}-appsWrapper`,layout:new i({columnSize:"19rem",gap:"0.5rem"}),visible:this.getDeviceType()!==b.Mobile})}return this._appsWrapper},_generateMobileAppsWrapper:function e(){if(!this._mobileAppsWrapper){this._mobileAppsWrapper=new r({id:`${this.getId()}-mobileAppsWrapper`,gridLayout:true,showDividers:false,height:"23.5rem",content:[],visible:this.getDeviceType()===b.Mobile}).addStyleClass("sapUiMargin-26Bottom sapMHeaderContainerAlign")}return this._mobileAppsWrapper},_generateErrorMessage:function e(){if(!this._errorCard){this._errorCard=new p(`${this.getId()}-errorCard`,{wrap:"Wrap",backgroundDesign:"Solid",items:[this.generateIllustratedMessage()],visible:this.getApps().length===0,justifyContent:"Center"}).addStyleClass("sapCuxAppsPanel")}this._errorCard.setHeight(this.getDeviceType()===b.Mobile?"23.5rem":"auto");return this._errorCard},generateApps:function e(t){return t.map(e=>{const t=new y("",{title:e.title,subTitle:e.subtitle,bgColor:e.BGColor,icon:e.icon,url:e.url,vizId:e.vizId||e.visualization?.vizId,status:e.status});if(e.oldAppId){t.data("oldAppId",e.oldAppId)}e.menuItems?.forEach(e=>{t.addAggregation("menuItems",e,true)});return t})},setApps:function e(t){t.forEach(e=>{this.addAggregation("apps",e,true)})},fetchTileVisualization:function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(this.getDeviceType()===b.Mobile){const e=this._generateMobileAppsWrapper()?.getContent()||[];for(const i of e){t=t.concat(i?.getContent()||[])}}else{t=this._generateAppsWrapper()?.getItems()||[]}return t},convertActivitiesToVisualizations:function e(t){try{const e=this;return Promise.resolve(Promise.all([e._getAllAvailableVisualizations(),c.getServiceAsync("URLParsing")])).then(function(i){let[r,n]=i;const s=t.filter(e=>e.appType==="Application").map(e=>{e.orgAppId=e.appId;e.appId=e.url;return e});const a=s.map(t=>e._convertToVisualization(t,r,n)).filter(e=>e!==undefined);return Promise.resolve(e._updateVisualizationAvailability(a))})}catch(e){return Promise.reject(e)}},_getAllAvailableVisualizations:function e(){try{const t=this;function i(){return t._allAvailableVisualizations}const r=function(){if(!t._allAvailableVisualizations){return Promise.resolve(t.appManagerInstance._getCatalogApps()).then(function(e){t._allAvailableVisualizations=e.reduce((e,t)=>e.concat(t.visualizations||[]),[])})}}();return Promise.resolve(r&&r.then?r.then(i):i(r))}catch(n){return Promise.reject(n)}},_updateVisualizationAvailability:function e(t){try{const e=this;return Promise.resolve(e.appManagerInstance.fetchFavVizs(true,true)).then(function(e){t.forEach(t=>{t.addedInFavorites=e.some(e=>e.oldAppId===t.orgAppId)});return t})}catch(e){return Promise.reject(e)}},_updateActivityInfo:function e(t,i){this._catalogVisualizationCache=this._catalogVisualizationCache||new Map;t.targetURL=i.targetURL;t.vizId=i.vizId;this._catalogVisualizationCache.set(t.orgAppId,i);return t},_findBestMatchingVisualization:function e(t,i,r){const n=i.find(e=>e.targetURL===t.url);if(n){return this._updateActivityInfo(t,n)}else{const e=new Map;const n=[];i.forEach(t=>{const i=t.targetURL;if(!e.get(i)){const s={viz:t,params:r.parseShellHash(t.targetURL).params,prio:0};e.set(i,s);n.push(s)}});const s=n.filter(e=>this._filterMatchingVisualization(t,e,r));if(s.length){s.sort((e,t)=>e.prio-t.prio);return this._updateActivityInfo(t,s[0].viz)}}},_filterMatchingVisualization:function e(t,i,r){const n=r.parseShellHash(t.url);const s=n.params;const a=Object.keys(s);const o=i.params;const p=Object.keys(o).filter(e=>e!=="allItems");if(p.length===a.length){const e=a.every(e=>p.includes(e)&&o[e][0]===s[e][0]);if(e){i.prio=1;return true}return false}else if(!p.length){i.prio=Object.keys(i.params).length?2:3;return true}return false},_convertToVisualization:function e(t,i,r){this._catalogVisualizationCache=this._catalogVisualizationCache||new Map;const n=this._catalogVisualizationCache.get(t.orgAppId);if(n){return this._updateActivityInfo(t,n)}else{const e=i.filter(e=>e.vizId&&`#${e.target?.semanticObject}-${e.target?.action}`===t.orgAppId);if(e.length>1){return this._findBestMatchingVisualization(t,e,r)}else if(e.length===1){return this._updateActivityInfo(t,e[0])}}},_addAppToFavorites:function t(i){try{const t=this;t.setBusy(true);return Promise.resolve(m(function(){return A(function(){const e=i.getSource();const r=e.getParent();const n=r.getVizId?.();const s=function(){if(n){return Promise.resolve(t.appManagerInstance.addVisualization(n)).then(function(){return Promise.resolve((t.getParent?.())._refreshAllPanels()).then(function(){const e=t._i18nBundle.getText("appMovedToFavorites",[r.getTitle()]);o.show(e)})})}}();if(s&&s.then)return s.then(function(){})},function(t){e.error(t)})},function(e,i){t.setBusy(false);if(e)throw i;return i}))}catch(e){return Promise.reject(e)}},isLoaded:function e(){return this._isLoaded},setLoaded:function e(t){this._isLoaded=t},isDirty:function e(){return this._isDirty},setDesktopViewDirty:function e(t){this._isDirty=t},isMobileDirty:function e(){return this._isMobileDirty},setMobileViewDirty:function e(t){this._isMobileDirty=t},setBusy:function e(t){const i=this._generateAppsWrapper();i.setBusy(t)},_getGroup:function e(t){const i=this.getAggregation("groups")||[];return i.find(e=>e.getGroupId()===t)},isSupported:function e(){return this._isSupported},setSupported:function e(t){this._isSupported=t},_attachUserActivityTracking:function e(){if(u.last("/core/shell/enableRecentActivity")){u.on("/core/shell/model/enableTrackingActivity").do(e=>{this.fireSupported({isSupported:e})})}},refresh:function e(){try{const e=this;return Promise.resolve(e.getParent().refreshPanel(e)).then(function(){})}catch(e){return Promise.reject(e)}},generateIllustratedMessage:function e(){if(!this._errorMessage){this._errorMessage=new n(`${this.getId()}-errorMessage`,{illustrationSize:s.Spot,illustrationType:a.AddColumn,title:this._i18nBundle.getText("noAppsTitle"),description:this._i18nBundle.getText("noData")})}return this._errorMessage}});return z});
//# sourceMappingURL=BaseAppPanel-dbg.js.map