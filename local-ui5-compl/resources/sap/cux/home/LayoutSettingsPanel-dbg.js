/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/Column","sap/m/ColumnListItem","sap/m/HBox","sap/m/MessageBox","sap/m/ObjectIdentifier","sap/m/Table","sap/m/Text","sap/m/ToggleButton","sap/m/VBox","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/Lib","sap/ui/core/dnd/DragDropInfo","sap/ui/model/json/JSONModel","./BaseSettingsPanel","./flexibility/Layout.flexibility","./utils/Constants","./utils/PersonalisationUtils"],function(e,t,n,s,o,i,a,r,l,c,g,d,u,h,m,p,_,f,y,I){"use strict";function S(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const C=S(_);const P=f["CHANGE_TYPES"];const E=y["SETTINGS_PANELS_KEYS"];const T=S(I);const x=C.extend("sap.cux.home.LayoutSettingsPanel",{metadata:{library:"sap.cux.home"},constructor:function e(t,n){C.prototype.constructor.call(this,t,n);this._isCollapseHandlerAttached=false},init:function e(){C.prototype.init.call(this);this.setProperty("key",E.LAYOUT);this.setProperty("title",this._i18nBundle.getText("layout"));this.setProperty("icon","sap-icon://grid");this.addAggregation("content",this._getContent());this.addAggregation("actionButtons",new t({id:`${this.getId()}-layoutResetBtn`,text:this._i18nBundle.getText("resetButton"),press:()=>{this.resetMyhomeSettings()}}));this.attachPanelNavigated(()=>void this._loadSections());this._manageSectionsChanges=[]},createShowHideChangeFile:function e(t){try{const e=this;const n=t.getSource();const s=!n.getPressed();const o=n.getBindingContext()?.getObject();o.visible=s;e._getPanel().getSections().find(e=>e.completeId===o.completeId).visible=s;const i=s?P.UNHIDE:P.HIDE;const a=d.getElementById(o.completeId);e._manageSectionsChanges.push({selectorElement:a,changeSpecificData:{changeType:i}});return Promise.resolve(e._saveManageSectionsDialog()).then(function(){setTimeout(()=>a.adjustLayout());if(!s){e._switchToCollapsedViewIfRequired([a])}})}catch(e){return Promise.reject(e)}},_switchToCollapsedViewIfRequired:function e(t){const n=this._getPanel();const s=n.getProperty("expanded");if(s){t.forEach(e=>{n.toggleFullScreen(e._getSelectedPanel())})}},_loadSections:function e(){try{const e=this;const t=e._getPanel();return Promise.resolve(t._calculateSectionsState()).then(function(){e._orderedSections=JSON.parse(JSON.stringify(t.getSections()));e._orderedSections.forEach(t=>{if(t.sContainerType==="sap.cux.home.InsightsContainer"&&!t.title){t.title=String(e._i18nBundle?.getText("insights"))}});e._controlModel=new p(e._orderedSections);e._layoutTable.setModel(e._controlModel);e._layoutTable.bindItems({path:"/",template:new s({type:"Inactive",cells:[new o({alignItems:"Center",items:[new u({src:"sap-icon://vertical-grip"}).addStyleClass("sapUiSmallMarginEnd"),new o({justifyContent:"SpaceBetween",alignItems:"Center",width:"100%",items:[new a({title:"{title}",text:"{text}",tooltip:"{title}"}),new c({tooltip:"{= ${visible} ? '"+e._i18nBundle.getText("hideBtn")+"' : '"+e._i18nBundle.getText("showBtn")+"' }",icon:"sap-icon://show",type:"Emphasized",enabled:"{= !${blocked}}",press:t=>{void e.createShowHideChangeFile(t)},pressed:"{= !${visible}}",ariaLabelledBy:["selectLabel"]}).addStyleClass("sapUiTinyMarginEnd sapUiTinyMarginTop")]})],width:"100%"})]}).addStyleClass("insightsListItem insightsListMargin")});if(!e._isCollapseHandlerAttached){t.attachEvent("onCollapse",()=>e._rearrangeLayoutIfRequired())}})}catch(e){return Promise.reject(e)}},_rearrangeLayoutIfRequired:function e(){const t=this._getPanel();const n=t.getItems();if(Array.isArray(this._allLayoutElements)&&n.length===this._allLayoutElements.length){const e=n.some((e,t)=>e.getId()!==this._allLayoutElements[t].getId());if(e){t.removeAllItems();this._allLayoutElements.forEach(e=>{t.addItem(e)})}}},_getContent:function e(){const t=this._setHeaderIntro();const n=this.setLayoutTable();const s=new g(this.getId()+"--idNewsPageOuterVBoX",{alignItems:"Start",justifyContent:"SpaceBetween",renderType:"Bare",items:[t,n]});return s},_setHeaderIntro:function e(){const t=new l(this.getId()+"--idCustLayoutText",{text:this._i18nBundle.getText("layoutIntroMsg")});const n=new g(this.getId()+"--idLayoutIntroText",{backgroundDesign:"Solid",alignItems:"Start",justifyContent:"SpaceBetween",items:[t],renderType:"Bare"}).addStyleClass("sapUiSmallMargin");return n},setLayoutTable:function e(){if(!this._layoutTable){this._layoutTable=new r(this.getId()+"--idManageSectionsTable",{width:"calc(100% - 2rem)",items:[],columns:[new n(this.getId()+"--idSectionTitleColumn",{width:"100%"})],dragDropConfig:new m(this.getId()+"--idManageSectionsDragInfo",{sourceAggregation:"items",targetAggregation:"items",groupName:"manageSectionsItems",dropPosition:"On",drop:e=>{void this.onDropManageSections(e)}})}).addStyleClass("sapContrastPlus sapUiSmallMarginBeginEnd sapUiTinyMarginBottom")}return this._layoutTable},_saveManageSectionsDialog:function e(){try{const e=this;return Promise.resolve(e._persistUserChanges({changes:e._manageSectionsChanges,appComponent:T.getOwnerComponent(e._getPanel())}).then(()=>{const t=e._layoutTable.getModel();t.refresh();e._controlModel.refresh()}).finally(()=>{e._manageSectionsChanges=[]}))}catch(e){return Promise.reject(e)}},_persistUserChanges:function t(n){return h.load({name:"sap.ui.fl"}).then(function(){return new Promise(function(t,s){sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],function(o){o.add({changes:n.changes,ignoreVariantManagement:true}).then(function(e){return t(o.save({selector:{appComponent:n.appComponent},changes:e}))}).catch(function(t){if(t instanceof Error){e.error("Unable to Save User Change: "+t.message);return s(t)}})})})})},_getActualIndex:function e(t){const n=this._getPanel();this._allLayoutElements=this._allLayoutElements||[...n.getItems()];const s=n.getProperty("expanded");const o=n._getCurrentExpandedElement();if(s&&o){if(!this._allLayoutElements.some(e=>e.getId()===o.targetContainer.getId())){this._allLayoutElements.splice(n.indexOfItem(o.targetContainer),0,o.targetContainer)}}return this._allLayoutElements.findIndex(e=>e.getId()===t)},_rearrangeLayoutElements:function e(t,n){const s=this._allLayoutElements.splice(t,1)[0];this._allLayoutElements.splice(n,0,s)},onDropManageSections:function e(t){try{const e=this;const n=e._getPanel();const s=n.getId();const o=t.getParameter?.("draggedControl")||t.draggedControl;const i=o.getParent()?.indexOfItem(o);const a=t.getParameter?.("droppedControl")||t.droppedControl;const r=o.getParent()?.indexOfItem(a);const l=function(){if(i!==r){const t=e._orderedSections;const l=o.getBindingContext()?.getObject();const c=a.getBindingContext()?.getObject();const g=e._getActualIndex(l.completeId);const u=e._getActualIndex(c.completeId);e._rearrangeLayoutElements(g,u);t.splice(i,1);t.splice(r,0,l);n.setSections(t);e._manageSectionsChanges.push({selectorElement:n,changeSpecificData:{changeType:P.MOVE,movedElements:[{id:l.completeId,sourceIndex:g,targetIndex:u}],source:{id:s,aggregation:"items"},target:{id:s,aggregation:"items"}}});return Promise.resolve(e._saveManageSectionsDialog()).then(function(){const t=d.getElementById(l.completeId);const n=d.getElementById(c.completeId);e._switchToCollapsedViewIfRequired([t,n])})}}();return Promise.resolve(l&&l.then?l.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},resetMyhomeSettings:function e(){const t=this;i.show(this._i18nBundle.getText("reset_cards_confirmation_msg"),{id:"resetCardsConfirmation",icon:i.Icon.QUESTION,title:this._i18nBundle.getText("reset_cards_confirmation_title"),actions:[this._i18nBundle.getText("reset_cards_button"),i.Action.CANCEL],onClose:function(e){try{const n=function(){if(e===t._i18nBundle.getText("reset_cards_button")){const e=[];for(let n of t._orderedSections){const t=d.getElementById(n.completeId);e.push(t)}e.push(t._getPanel());return Promise.resolve(h.load({name:"sap.ui.fl"}).then(()=>{sap.ui.require(["sap/ui/fl/write/api/ControlPersonalizationWriteAPI"],n=>{void n.reset({selectors:e,changeTypes:[P.MOVE,P.UNHIDE,P.HIDE]}).finally(()=>{const e=t._getPanel();e.resetSections();e.closeSettingsDialog()})})})).then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}})}});return x});
//# sourceMappingURL=LayoutSettingsPanel-dbg.js.map