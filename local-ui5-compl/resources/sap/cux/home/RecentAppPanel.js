/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/CustomListItem","sap/m/Dialog","sap/m/GroupHeaderListItem","sap/m/library","sap/m/List","sap/m/OverflowToolbar","sap/m/Select","sap/m/StandardListItem","sap/m/ToolbarSpacer","sap/m/VBox","sap/ui/core/format/DateFormat","sap/ui/core/Item","sap/ushell/Container","sap/ushell/EventHub","./BaseAppPersPanel","./MenuItem","./utils/FESRUtil"],function(t,e,s,n,i,a,r,o,p,c,l,d,h,u,g,m,y,_,A){"use strict";function T(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}function f(t,e){try{var s=t()}catch(t){return e(t)}if(s&&s.then){return s.then(void 0,e)}return s}const D=a["URLHelper"];const E=T(y);const w=T(_);const S=A["addFESRId"];var I=function(t){t["ALL"]="ALL";t["TODAY"]="TODAY";t["WEEK"]="WEEK";t["TWO_WEEK"]="TWO_WEEK";t["THREE_WEEK"]="THREE_WEEK";return t}(I||{});const L=h.getDateInstance({pattern:"MMMM d, yyyy"});const M={OLDER_DATE_TIMESTAMP:Number.MIN_SAFE_INTEGER};const H=t=>t.setHours(12,0,0,0);const v=t=>{const e=new Date;const s=new Date(e);const n=s.setDate(e.getDate()-e.getDay()-7*t);const i=new Date(s);const a=i.setDate(s.getDate()+6);return{startDate:n,endDate:a}};const b=(t,e)=>{const s=new Date(t);const n=s.setDate(s.getDate()-e);return H(new Date(n))};const x=(t,e,s)=>t>=e&&t<=s;const R=E.extend("sap.cux.home.RecentAppPanel",{metadata:{library:"sap.cux.home",defaultAggregation:"apps",aggregations:{apps:{type:"sap.cux.home.App",singularName:"app",multiple:true,visibility:"hidden"}}},constructor:function t(e,s){E.prototype.constructor.call(this,e,s);this._recentApps=[];this.setSupported(false)},init:function t(){E.prototype.init.call(this);this.setProperty("key","recentApps");this.setProperty("title",this._i18nBundle.getText("recentlyUsedTab"));this.setProperty("tooltip",this._i18nBundle.getText("recentAppsInfo"));this._attachUserActivityTracking();m.on("userRecentsCleared").do(()=>{void this.refresh()});const e=new w(`${this.getId()}-show-history-btn`,{title:this._i18nBundle.getText("showHistoryBtn"),icon:"sap-icon://history",press:this._openHistoryDialog.bind(this)});S(e,"showHistory");this.insertAggregation("menuItems",e,0)},loadApps:function t(){try{const t=this;return Promise.resolve(t._getRecentApps()).then(function(e){e=e.map(e=>({...e,menuItems:t._getAppActions(e.addedInFavorites)}));t.destroyAggregation("apps",true);t.setApps(t.generateApps(e))})}catch(t){return Promise.reject(t)}},_getRecentApps:function e(){try{const e=this;return Promise.resolve(f(function(){return Promise.resolve(g.getServiceAsync("UserRecents")).then(function(t){return Promise.resolve(Promise.all([t?.getRecentActivity().then(t=>t||[]),t?.oRecentActivity._getRecentActivitiesFromLoadedData().then(t=>t||{})])).then(function(t){let[s,n]=t;return Promise.resolve(e.convertActivitiesToVisualizations(s)).then(function(t){e._recentApps=t;let s=new Date(n?.recentDay);e._recentDayTimeStamp=H(s);const i=n?.recentUsageArray||[];const a=new Map;i.forEach(t=>{if(t.oItem?.appId){a.set(t.oItem.appId,t.aUsageArray)}});e._recentApps.forEach(t=>{t.dateStamp=H(new Date(t.timestamp));if(a.size){t.usageArray=a.get(t.orgAppId)}});return e._recentApps||[]})})})},function(e){t.error(e);return[]}))}catch(t){return Promise.reject(t)}},_getAppActions:function t(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;const s=new w({title:this._i18nBundle.getText("resumeLastActivity"),icon:"sap-icon://past",press:this._resumeAppActivity.bind(this)});S(s,"resumeActivity");const n=[s];if(!e){const t=new w({title:this._i18nBundle.getText("addToFavorites"),icon:"sap-icon://add-favorite",press:t=>{void this._addAppToFavorites(t)}});S(t,"addFavFromRecent");n.push(t)}return n},_resumeAppActivity:function t(e){const s=e.getSource();const n=s.getParent();const i=n.getUrl?.();D.redirect(i,false)},_generateHistoryDialog:function t(){const s=`${this.getId()}-history-dialog`;if(!this._controlMap.get(s)){this._controlMap.set(s,new n(s,{title:this._i18nBundle.getText("showHistoryTitle"),content:new d({id:`${s}-container`,height:"100%",items:[this._generateAppHistoryList()]}).addStyleClass("sapUiTinyMargin"),escapeHandler:this._closeHistoryDialog.bind(this),contentHeight:"29rem",contentWidth:"25rem",buttons:[new e({id:`${s}-cancel-btn`,text:this._i18nBundle.getText("cancelBtn"),press:this._closeHistoryDialog.bind(this)})]}).addStyleClass("sapContrastPlus"))}return this._controlMap.get(s)},_generateAppHistoryList:function t(){const e=`${this.getId()}-history-dialog-list`;if(!this._controlMap.get(e)){this._controlMap.set(e,new r({id:e,growing:true,growingScrollToLoad:true,headerToolbar:new o({id:`${e}-header-toolbar`,style:"Clear",height:"1.75rem",content:[new l({id:`${e}-header-toolbar-spacer`}),this._generateAppHistoryListFilter()]})}).addStyleClass("sapMListShowSeparatorsNone recentAppList"))}return this._controlMap.get(e)},_generateAppHistoryListFilter:function t(){const e=`${this.getId()}-history-dialog-list-filter`;if(!this._controlMap.get(e)){this._controlMap.set(e,new p({id:e,selectedKey:I.ALL,change:t=>this._onDateFilterChange(t),items:[new u({id:`${e}-month`,key:I.ALL,text:this._i18nBundle.getText("dateThirty")}),new u({id:`${e}-today`,key:I.TODAY,text:this._i18nBundle.getText("dateToday")}),new u({id:`${e}-week`,key:I.WEEK,text:this._i18nBundle.getText("dateWeek")}),new u({id:`${e}-twoWeek`,key:I.TWO_WEEK,text:this._i18nBundle.getText("dateTwoWeek")}),new u({id:`${e}-threeWeek`,key:I.THREE_WEEK,text:this._i18nBundle.getText("dateThreeWeek")})]}))}return this._controlMap.get(e)},_generateAppHistoryListItems:function t(e){const n=this._generateAppHistoryList();n?.destroyItems();e.forEach(t=>{n.addItem(this._getGroupHeader(t.dateStamp));n.addItem(new s({id:`date-${t.dateStamp}-lisItem`,type:"Inactive",content:[new r({id:`date-${t.dateStamp}-appList`,items:(t.apps||[]).map(t=>new c({title:t.name,type:"Inactive"}).addStyleClass("sapUiTinyMarginBeginEnd recentAppList sapUiSmallMarginTop"))}).addStyleClass("sapMListShowSeparatorsNone sapUiTinyMarginBottom")]}))})},_openHistoryDialog:function t(){const e=this._generateHistoryDialog();const s=this._getAppHistory();this._generateAppHistoryListItems(s);e.open()},_closeHistoryDialog:function t(){const e=this._generateHistoryDialog();e.close()},_onDateFilterChange:function t(e){const s=e.getParameter("selectedItem")?.getKey();const n=this._getFilteredAppHistory(s);this._generateAppHistoryListItems(n)},_getGroupHeader:function t(e){let s="";switch(e){case M.OLDER_DATE_TIMESTAMP:s=this._i18nBundle.getText("dateLater");break;case H(new Date):s=this._i18nBundle.getText("dateToday");break;default:s=L.format(new Date(e));break}return new i({title:s}).addStyleClass("sapUiTinyMarginBeginEnd recentAppListHeader")},_getAppHistory:function t(){if(this._recentDayTimeStamp&&this._recentApps?.length){const t={};const e=b(this._recentDayTimeStamp,30);this._recentApps.forEach(s=>{const n=H(new Date(s.dateStamp));if(n<e){if(!t[M.OLDER_DATE_TIMESTAMP]){t[M.OLDER_DATE_TIMESTAMP]={dateStamp:M.OLDER_DATE_TIMESTAMP,apps:[]}}t[M.OLDER_DATE_TIMESTAMP]?.apps.push({name:s.title})}else{const e=s.usageArray||[];e.forEach((n,i)=>{if(n>0){const n=b(this._recentDayTimeStamp,e.length-1-i);if(!t[n]){t[n]={dateStamp:n,apps:[]}}t[n]?.apps.push({name:s.title})}})}});const s=Object.values(t);s.sort((t,e)=>e.dateStamp-t.dateStamp);return s}return[]},_getFilteredAppHistory:function t(e){const s=this._getAppHistory();let n=[];switch(e){case I.TODAY:{n=s.filter(t=>t.dateStamp===H(new Date));break}case I.WEEK:{const{startDate:t,endDate:e}=v(0);n=s.filter(s=>x(s.dateStamp,t,e));break}case I.TWO_WEEK:{const{startDate:t}=v(1);const{endDate:e}=v(0);n=s.filter(s=>x(s.dateStamp,t,e));break}case I.THREE_WEEK:{const{startDate:t}=v(2);const{endDate:e}=v(0);n=s.filter(s=>x(s.dateStamp,t,e));break}default:n=[...s];break}return n},generateIllustratedMessage:function t(){const e=E.prototype.generateIllustratedMessage.call(this);e.setDescription(this._i18nBundle.getText("noRecentAppsDescription"));return e}});return R});
//# sourceMappingURL=RecentAppPanel.js.map