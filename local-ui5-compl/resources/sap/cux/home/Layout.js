/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/ushell/api/S4MyHome","sap/ushell/Container","./AdvancedSettingsPanel","./AppsContainer","./BaseLayout","./BaseLayoutRenderer","./InsightsCardsSettingsPanel","./InsightsTilesSettingsPanel","./KeyUserLayoutSettingsPanel","./KeyUserNewsPagesSettingsPanel","./KeyUserSettingsDialog","./LayoutSettingsPanel","./NewsAndPagesContainer","./NewsSettingsPanel","./NoDataContainer","./PagePanel","./PageSettingsPanel","./SettingsDialog","./ToDosContainer","./utils/Constants","./utils/KeyUserPersonalization","./utils/PersonalisationUtils"],function(t,e,n,s,i,o,a,r,c,l,u,g,f,h,d,P,_,p,y,S,m,D,v){"use strict";function b(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const A=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function w(t,e,n){if(!t.s){if(n instanceof C){if(n.s){if(e&1){e=n.s}n=n.v}else{n.o=w.bind(null,t,e);return}}if(n&&n.then){n.then(w.bind(null,t,e),w.bind(null,t,2));return}t.s=e;t.v=n;const s=t.o;if(s){s(t)}}}const C=function(){function t(){}t.prototype.then=function(e,n){const s=new t;const i=this.s;if(i){const t=i&1?e:n;if(t){try{w(s,1,t(this.v))}catch(t){w(s,2,t)}return s}else{return this}}this.o=function(t){try{const i=t.v;if(t.s&1){w(s,1,e?e(i):i)}else if(n){w(s,1,n(i))}else{w(s,2,i)}}catch(t){w(s,2,t)}};return s};return t}();function I(t){return t instanceof C&&t.s&1}function k(t,e,n){var s=-1,i,o;function a(r){try{while(++s<t.length&&(!n||!n())){r=e(s);if(r&&r.then){if(I(r)){r=r.v}else{r.then(a,o||(o=w.bind(null,i=new C,2)));return}}}if(i){w(i,1,r)}else{i=r}}catch(t){w(i||(i=new C),2,t)}}a();return i}const T=b(s);function U(t,e,n){if(typeof t[A]==="function"){var s=t[A](),i,o,a;function u(t){try{while(!(i=s.next()).done&&(!n||!n())){t=e(i.value);if(t&&t.then){if(I(t)){t=t.v}else{t.then(u,a||(a=w.bind(null,o=new C,2)));return}}}if(o){w(o,1,t)}else{o=t}}catch(t){w(o||(o=new C),2,t)}}u();if(s.return){var r=function(t){try{if(!i.done){s.return()}}catch(t){}return t};if(o&&o.then){return o.then(r,function(t){throw r(t)})}r()}return o}if(!("length"in t)){throw new TypeError("Object is not iterable")}var c=[];for(var l=0;l<t.length;l++){c.push(t[l])}return k(c,function(t){return e(c[t])},n)}const x=b(i);function N(t,e){try{var n=t()}catch(t){return e(t)}if(n&&n.then){return n.then(void 0,e)}return n}const B=b(o);const E=b(a);const L=b(r);const O=b(c);const $=b(l);const M=b(u);const V=b(g);const j=b(f);const H=b(h);const K=b(d);const R=b(P);const z=b(_);const F=b(p);const G=b(y);const Y=b(S);const q=m["SETTINGS_PANELS_KEYS"];const J=b(D);const Q=b(v);const W=B.extend("sap.cux.home.Layout",{renderer:E,metadata:{designtime:"sap/cux/home/designtime/Layout.designtime"},constructor:function t(e,n){B.prototype.constructor.call(this,e,n);this._shellUserActions=[];this._isDefaultSettingsDialog=false;this._customNoDataContainerPresent=true},init:function t(){B.prototype.init.call(this);this.setProperty("enableSettings",true);this.setProperty("enableFullScreen",true);this._keyUserPersonalization=new J(Q.getOwnerComponent(this),this._i18nBundle)},_addUserActions:function s(){try{const s=this;return Promise.resolve(N(function(){const t=function(){if(s.getVisible()&&!s._userActionsAdded){s._userActionsAdded=true;const t=[{id:`${s.getId()}-homeSettingsBtn`,icon:"sap-icon://edit",text:s._i18nBundle.getText("myHomeSettings"),tooltip:s._i18nBundle.getText("myHomeSettings"),press:()=>{void s.openSettingsDialog()}}];return Promise.resolve(s._keyUserPersonalization.getRTAUserAction()).then(function(i){if(i){t.push(i)}return Promise.resolve(n.getServiceAsync("Extension")).then(function(n){function i(){const t=t=>{const e=t.getParameter("isMyHomeRoute");s._shellUserActions.forEach(function(t){if(e){t.showOnHome()}else{t.hideOnHome()}})};e.attachRouteMatched({},t,s)}const o=U(t,function(t){return Promise.resolve(n.createUserAction(t,{controlType:"sap.ushell.ui.launchpad.ActionItem"})).then(function(t){t.showOnHome();s._shellUserActions.push(t)})});return o&&o.then?o.then(i):i(o)})})}}();if(t&&t.then)return t.then(function(){})},function(e){t.warning("Unable to add User Actions",e instanceof Error?e.message:"")}))}catch(t){return Promise.reject(t)}},openSettingsDialog:function t(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";let n=arguments.length>1?arguments[1]:undefined;try{const t=this;const s=t.getAggregation("settingsDialog");if(s.getPanels().length!==t._getSettingsPanels().length){t._addPanelsToSettingsDialog()}return Promise.resolve(t._calculateSectionsState()).then(function(){B.prototype.openSettingsDialog.call(t,e,n)})}catch(t){return Promise.reject(t)}},closeSettingsDialog:function t(){const e=this.getAggregation("settingsDialog");e?.close()},onBeforeRendering:function t(e){try{const t=this;B.prototype.onBeforeRendering.call(t,e);if(!t._noDataContainer){t._noDataContainer=t.getItems().find(t=>t instanceof R);if(!t._noDataContainer){t._customNoDataContainerPresent=false;t._noDataContainer=new R(`${t.getId()}-noDataContainer`)}t._noDataContainer.setVisible(false)}if(!t._aOrderedSections){setTimeout(t._prepareLayoutData.bind(t))}t._setupSettingsDialog();t._setupKeyUserSettingsDialog();return Promise.resolve(t._addUserActions()).then(function(){})}catch(t){return Promise.reject(t)}},_setupSettingsDialog:function t(){const e=[];(this.getItems()||[]).forEach(t=>{t.setAssociation("layout",this);t.getContent().forEach(t=>{e.push(t);const n=t.getProperty("enableSettings");t.setProperty("enableSettings",n!==undefined?n:true)})});const n=this.getProperty("enableSettings");const s=this.getAggregation("settingsDialog");if(!s){this._isDefaultSettingsDialog=true;if(n){const t=this._getDefaultSettingsDialog(e);this.setSettingsDialog(t)}}},_getDefaultSettingsDialog:function t(e){const n=new G(`${this.getId()}-settings-dialog`);e.forEach(t=>{const e=this._getDefaultSettingsPanel(t);if(e){n.addPanel(e)}});const s=this._sortPanels(n.getPanels());n.removeAllPanels();s.forEach(t=>n.addPanel(t));n.insertPanel(this._getLayoutSettingsPanel(),0);n.addPanel(this._getAdvancedSettingsPanel());return n},_getDefaultSettingsPanel:function t(e){let n;const s=e.getMetadata().getName();switch(s){case"sap.cux.home.NewsPanel":n=new K(`${e.getId()}-news-settings`);break;case"sap.cux.home.PagePanel":n=new F(`${e.getId()}-page-settings`);break;case"sap.cux.home.TilesPanel":n=new O(`${e.getId()}-tiles-settings`);break;case"sap.cux.home.CardsPanel":n=new L(`${e.getId()}-cards-settings`);break;default:break}n?.setAssociation("panel",e);return n},_addPanelsToSettingsDialog:function t(){const e=this.getAggregation("settingsDialog");const n=this._sortPanels(e.getPanels());e.removeAllPanels();n.forEach(t=>e.addPanel(t));if(this._isDefaultSettingsDialog){e.insertPanel(this._getLayoutSettingsPanel(),0);e.addPanel(this._getAdvancedSettingsPanel())}e.addPanel(this._getAdvancedSettingsPanel());this._addSettingsPanel(e.getPanels(),true)},_sortPanels:function t(e){return Object.keys(q).map(t=>e.find(e=>e?.getProperty("key")===t)).filter(Boolean)},_getAdvancedSettingsPanel:function t(){if(!this._advancedSettingsPanel){this._advancedSettingsPanel=new T(`${this.getId()}-advanced-settings`);this._advancedSettingsPanel.setAssociation("panel",this)}return this._advancedSettingsPanel},_getLayoutSettingsPanel:function t(){if(!this._layoutSettingsPanel){this._layoutSettingsPanel=new j(`${this.getId()}-layout-settings`);this._layoutSettingsPanel.setAssociation("panel",this)}return this._layoutSettingsPanel},_prepareLayoutData:function t(){let e=false;const n=this.getItems();const s=[];n.forEach(t=>{if(t!==this._noDataContainer){const n=t.getId();let i=t.getProperty("title");if(!i){i=t.getTooltip()}const o=t.getVisible();s.push({completeId:n,sContainerType:t.getMetadata().getName(),blocked:false,visible:t.getProperty("visible"),title:t instanceof H?this._i18nBundle.getText("myInterestMsg"):i,text:this._setTextValue(t)});if(o){e=true}}});this._aOrderedSections=s;if(!this.getProperty("expanded")){this.setNoDataContainerVisibility(!e)}},_setTextValue:function t(e){if(e instanceof Y){return this._i18nBundle.getText("forMeTodayMsg")}else if(e instanceof x){return this._i18nBundle.getText("myAppMsg")}return""},setNoDataContainerVisibility:function t(e){this._noDataContainer?.setVisible(e);if(!this._customNoDataContainerPresent){if(e){this.insertItem(this._noDataContainer,0)}else{this.removeItem(this._noDataContainer)}}},_calculateSectionsState:function t(){try{const t=this;const e=t.getAggregation("settingsDialog");const n=e.getPanels();t._isCustomNews=false;n.forEach(e=>{if(e instanceof K){t._isCustomNews=true}if(e instanceof T){e.resetImportModel(true)}});return Promise.resolve(t.setSectionDetails()).then(function(){})}catch(t){return Promise.reject(t)}},setSectionDetails:function t(){try{const t=this;const e=t.getItems();const n=U(e,function(e){function n(){t._aOrderedSections?.forEach(t=>{if(t.completeId===i){t.blocked=s;t.visible=e.getVisible()}})}let s=false;const i=e.getId();const o=function(){if(e instanceof H&&e.getVisible()){function n(t){s=t}const i=e.getContent();const o=i.length;return o?Promise.resolve(t.checkPagesBlocked(i)).then(n):n(false)}else if(e instanceof Y){s=t.checkToDoBlocked(e)}}();return o&&o.then?o.then(n):n(o)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},checkPagesBlocked:function t(e){try{const n=this;function s(){return!n._pagesAvailable&&!n._isCustomNews?true:false}const i=U(e,function(t){const e=function(){if(t instanceof z){return Promise.resolve(t.getUserAvailablePages()).then(function(t){if(t.length){n._pagesAvailable=true}})}}();if(e&&e.then)return e.then(function(){})});return Promise.resolve(i&&i.then?i.then(s):s(i))}catch(o){return Promise.reject(o)}},checkToDoBlocked:function t(e){if(!e.getVisible()){const t=e.getContent();if(t.length===0){this._toDoAccessible=false;return true}}return false},_setupKeyUserSettingsDialog:function t(){const e=this.getAggregation("keyUserSettingsDialog");if(!e){const t=new V(`${this.getId()}-keyUser-settings-dialog`);const e=new $(`${this.getId()}-keyUser-layout-settings`);e.setAssociation("panel",this);t.addPanel(e);(this.getItems()||[]).forEach(e=>{if(e instanceof H){const n=new M(`${this.getId()}-keyUser-news-pages-settings`);n.setAssociation("panel",e.getContent()?.[0]);t.addPanel(n)}});this.setAggregation("keyUserSettingsDialog",t)}},getpagesAvailable:function t(){return this._pagesAvailable},isToDoAccessible:function t(){return this._toDoAccessible},customNewAvailable:function t(){return this._isCustomNews},getSections:function t(){return this._aOrderedSections},setSections:function t(e){this._aOrderedSections=e},resetSections:function t(){this._aOrderedSections=undefined;this._prepareLayoutData()}});return W});
//# sourceMappingURL=Layout.js.map