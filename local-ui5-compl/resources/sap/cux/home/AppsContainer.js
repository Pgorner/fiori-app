/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/m/GenericTile","sap/m/Panel","sap/m/library","sap/ui/core/EventBus","sap/ui/core/theming/Parameters","./BaseContainer","./library","./utils/DataFormatUtils","./utils/Device"],function(e,t,n,s,i,o,r,a,l){"use strict";function c(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const p=n["BackgroundDesign"];const u=n["FrameType"];const g=n["GenericTileMode"];const h=n["GenericTileScope"];const d=n["TileSizeBehavior"];const f=c(o);const y=r["LayoutType"];const _=c(a);const P=l["DeviceType"];const b=()=>{const e="sapLegendColor9";return{key:e,value:i.get({name:e}),assigned:false}};const T={PLACEHOLDER_ITEMS_COUNT:5};const m=f.extend("sap.cux.home.AppsContainer",{metadata:{events:{appsLoaded:{parameters:{apps:{type:"App[]"},tiles:{type:"GenericTile[]"}}}}},renderer:{...f.renderer,apiVersion:2},constructor:function e(t,n){f.prototype.constructor.call(this,t,n);this._isInitialRender=true},init:function e(){f.prototype.init.call(this);this.setProperty("title",this._i18nBundle?.getText("appsTitle"));if(this.getDeviceType()===P.Mobile){this.setProperty("layout",y.Vertical)}this._shellNavigationHandler=()=>this._onShellNavigated();this._oEventBus=s.getInstance();this._oEventBus?.subscribe("sap.ushell","navigated",this._shellNavigationHandler);this.addStyleClass("sapCuxAppsContainer")},exit:function e(){this._oEventBus?.unsubscribe("sap.ushell","navigated",this._shellNavigationHandler)},onBeforeRendering:function e(){f.prototype.onBeforeRendering.call(this);if(this._isInitialRender){this._isInitialRender=false;this._attachPanelSupportedEvent();this._removeUnsupportedPanels()}const t=this.getDeviceType()===P.Mobile;const n=t?this.getContent():[this._getSelectedPanel()];for(const e of n){e.fireNavigated();void this._setApps(e)}},_onShellNavigated:function e(){this._setPanelsDirty()},_setPanelsDirty:function e(){const t=this.getContent();for(const e of t){e.setDesktopViewDirty(true);e.setMobileViewDirty(true)}},_generatePlaceholder:function e(t){if(!t.isLoaded()){const e=t.generateApps(new Array(T.PLACEHOLDER_ITEMS_COUNT).fill({status:"Loading"}));t.destroyAggregation("apps",true);t.setApps(e);this._updatePanelContent(t)}},_setApps:function e(t){try{const e=this;const n=function(){if(t.isDirty()&&t.isMobileDirty()){e._generatePlaceholder(t);return Promise.resolve(t.loadApps?.()).then(function(){function n(){let n=[];let s=t.getApps();n=t.fetchTileVisualization(n);e.fireEvent("appsLoaded",{apps:s,tiles:n})}if(e.getDeviceType()===P.Mobile){t.setMobileViewDirty(false)}else{t.setDesktopViewDirty(false)}t.setLoaded(true);e._updatePanelContent(t);const s=function(){if(t.isA("sap.cux.home.BaseAppPersPanel")){return Promise.resolve(t.applyPersonalization()).then(function(){})}}();return s&&s.then?s.then(n):n(s)})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_updatePanelContent:function e(t){const n=t.getApps()||[];const s=t.getAggregation("groups")||[];const i=this.getDeviceType()===P.Mobile;const o=i?t._generateMobileAppsWrapper():t._generateAppsWrapper();const r=i?"content":"items";o.destroyAggregation(r);let a=i?this._generateMobileCards([...s,...n]):this._generateTiles([...s,...n]);this._addWrapperContent(o,a,r);this._updatePanelContentVisibility(t)},_updatePanelContentVisibility:function e(t){const n=t.getApps()||[];const s=t.getAggregation("groups")||[];const i=this.getDeviceType()===P.Mobile;const o=t._generateDesktopAppsWrapper();const r=t._generateMobileAppsWrapper();const a=t._generateErrorMessage();const l=[...n,...s].length!==0;o.setVisible(l&&!i);r.setVisible(l&&i);r.getParent().setWidth(i&&l?"100%":"auto");a.setVisible(!l)},_getAppTile:function t(n){const s=this.getDeviceType()===P.Mobile;const i=n.getAggregation("menuItems")||[];return new e("",{scope:i.length&&!s?h.ActionMore:h.Display,state:n.getStatus(),mode:g.IconMode,sizeBehavior:d.Small,header:n.getTitle(),backgroundColor:n.getBgColor()||b()?.key,tileIcon:n.getIcon(),url:_.getLeanURL(n.getUrl()),frameType:u.TwoByHalf,renderOnThemeChange:true,dropAreaOffset:4,subheader:n.getSubTitle(),press:e=>n._onPress(e),width:s?"15rem":"auto"}).addStyleClass("sapMGTTwoByHalf tileLayout")},_getGroupTile:function t(n){const s=this.getDeviceType()===P.Mobile;const i=n.getAggregation("menuItems")||[];return new e("",{scope:i.length&&!s?h.ActionMore:h.Display,state:n.getStatus(),mode:g.IconMode,sizeBehavior:d.Small,header:n.getTitle(),backgroundColor:n.getBgColor()||b()?.key,tileIcon:n.getIcon(),frameType:u.TwoByHalf,renderOnThemeChange:true,dropAreaOffset:4,tileBadge:n.getNumber(),press:e=>n._onPress(e),width:s?"15rem":"auto"}).addStyleClass("sapMGTTwoByHalf tileLayout").data("groupId",n.getGroupId())},_onPanelSelect:function e(t){try{const e=this;f.prototype._onPanelSelect.call(e,t);const n=e._getSelectedPanel();return Promise.resolve(e._setApps(n)).then(function(){})}catch(e){return Promise.reject(e)}},_refreshAllPanels:function e(){try{const e=this;e._setPanelsDirty();return Promise.resolve(e._setApps(e._getSelectedPanel())).then(function(){})}catch(e){return Promise.reject(e)}},refreshPanel:function e(t){try{const e=this;t.setMobileViewDirty(true);t.setDesktopViewDirty(true);return Promise.resolve(e._setApps(t)).then(function(){})}catch(e){return Promise.reject(e)}},_toggleTabView:function e(){if(this.getDeviceType()!==P.Mobile){const e=this.getContent();const t=e.filter(e=>e.isSupported());const n=this._getInnerControl();n?.toggleStyleClass("sapUiITBHide",t.length===1)}},_onPanelSupported:function e(t,n){const s=n.getParameter("isSupported");t.setSupported(s);this._togglePanelVisibility(t,s);this._toggleTabView()},_togglePanelVisibility:function e(t,n){if(this.getDeviceType()===P.Mobile){const e=this._getPanelContentWrapper(t);e.setVisible(n)}else{const e=this._getInnerControl();const s=e?.getItems()||[];const i=s.find(e=>e.getKey()===t.getKey());i?.setVisible(n)}},_removeUnsupportedPanels:function e(){const t=this.getContent();const n=t.filter(e=>!e.isSupported());for(const e of n){this._togglePanelVisibility(e,false)}this._toggleTabView()},_attachPanelSupportedEvent:function e(){const t=this.getContent();for(const e of t){if(!e.hasListeners("supported")){e.attachSupported(this._onPanelSupported.bind(this,e))}}},adjustLayout:function e(){const t=this.getDeviceType()===P.Mobile;const n=this.getProperty("layout");const s=t?y.Vertical:y.SideBySide;const i=n!==s;if(!i){return}this.setProperty("layout",s);const o=this.getContent();o.forEach(e=>{if(!e.isDirty()&&!e.isMobileDirty()){this._updatePanelContentVisibility(e)}else if(e.isDirty()!==e.isMobileDirty()){e.setDesktopViewDirty(false);e.setMobileViewDirty(false);this._updatePanelContent(e)}});this.toggleActionButtons(!t);this._removeUnsupportedPanels()},_generateMobileCards:function e(n){const s=[];for(let e=0;e<n.length;e+=7){const i=n.slice(e,e+7);const o=new t({backgroundDesign:p.Solid,height:"23.5rem",width:"17rem",content:this._generateTiles(i)}).addStyleClass("sapUiMobileAppsCard");s.push(o)}return s},_generateTiles:function e(t){return t.map(e=>e.isA("sap.cux.home.Group")?this._getGroupTile(e):this._getAppTile(e))},_addWrapperContent:function e(t,n,s){t.destroyAggregation(s);n.forEach(e=>{t.addAggregation(s,e)})}});return m});
//# sourceMappingURL=AppsContainer.js.map