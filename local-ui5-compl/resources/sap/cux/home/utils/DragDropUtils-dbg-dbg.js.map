{"version":3,"file":"DragDropUtils-dbg-dbg.js","names":["sap","ui","define","GridContainer","FlexBox","Event","Element","sap_ui_core_library","attachKeyboardHandler","event","disablenavigation","callback","draggedControl","closestTo","target","firstElementChild","container","getParent","isMetaKey","metaKey","ctrlKey","items","getItems","currentIndex","findIndex","item","document","activeElement","getDomRef","setTabIndexForItems","map","includes","key","Promise","resolve","preventDefault","stopPropagation","currentItemIndex","indexOfItem","reverseItems","reverse","_getClosestElementYIndex","data","length","droppedControl","_temp3","_temp2","focusDraggedItem","dragDropEvent","dropPosition","dnd","RelativeDropPosition","Before","After","_temp","then","e","reject","dropItemIndex","draggedItemDomRef","aWrapperItemsDomRef","$","children","each","iIndex","oWrapperItem","classList","contains","push","setAttribute","focus","keyCode","fnElementPositionX","element","getBoundingClientRect","x","fnElementPositionY","y","minIndex","minDistance","Number","MAX_SAFE_INTEGER","forEach","index","currentDist","Math","sqrt","pow","isAllowed","aItems","tabIndex","__exports","__esModule"],"sources":["DragDropUtils.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\n\nimport GridContainer from \"sap/f/GridContainer\";\nimport FlexBox from \"sap/m/FlexBox\";\nimport Event from \"sap/ui/base/Event\";\nimport Control from \"sap/ui/core/Control\";\nimport Element from \"sap/ui/core/Element\";\nimport { dnd } from \"sap/ui/core/library\";\n\n/**\n * Handles keyboard events for navigation and drag and drop functionality.\n * @param {KeyboardEvent} event - The keyboard event object.\n * @param {boolean} disablenavigation - Whether navigation is allowed.\n * @param {Function} callback - The callback function to execute when a drag and drop event occurs.\n * @returns {Promise<void>} A Promise that resolves when the handling is complete.\n */\n\nexport async function attachKeyboardHandler(\n\tevent: KeyboardEvent,\n\tdisablenavigation: boolean,\n\tcallback?: (dragDropEvent: Event) => Promise<void> | void\n) {\n\tconst draggedControl = Element.closestTo((event.target as HTMLElement).firstElementChild as HTMLElement) as Control;\n\tconst container = draggedControl.getParent() as GridContainer | FlexBox;\n\tconst isMetaKey = event.metaKey || event.ctrlKey;\n\tconst items = container.getItems();\n\tconst currentIndex = items.findIndex((item) => document.activeElement === item.getDomRef());\n\tsetTabIndexForItems(\n\t\titems.map((item) => item.getDomRef() as HTMLElement),\n\t\tcurrentIndex\n\t);\n\n\tif (\n\t\t!draggedControl ||\n\t\t!container ||\n\t\t!(disablenavigation && [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\", \"Home\", \"End\"].includes(event.key))\n\t) {\n\t\treturn;\n\t}\n\n\tevent.preventDefault();\n\tevent.stopPropagation();\n\n\tlet currentItemIndex = container.indexOfItem(draggedControl);\n\tconst reverseItems = [...items].reverse();\n\tswitch (event.key) {\n\t\tcase \"ArrowRight\":\n\t\t\tcurrentItemIndex += 1;\n\t\t\tbreak;\n\t\tcase \"ArrowLeft\":\n\t\t\tcurrentItemIndex -= 1;\n\t\t\tbreak;\n\t\tcase \"ArrowUp\":\n\t\tcase \"ArrowDown\":\n\t\t\tcurrentItemIndex = _getClosestElementYIndex(container, currentItemIndex, event.key);\n\t\t\tbreak;\n\t\tcase \"Home\":\n\t\t\tcurrentItemIndex = draggedControl.data(\"groupId\")\n\t\t\t\t? items.findIndex((item) => item.data(\"groupId\"))\n\t\t\t\t: items.findIndex((item) => !item.data(\"groupId\"));\n\t\t\tbreak;\n\t\tcase \"End\":\n\t\t\tcurrentItemIndex =\n\t\t\t\titems.length -\n\t\t\t\t1 -\n\t\t\t\t(draggedControl.data(\"groupId\")\n\t\t\t\t\t? reverseItems.findIndex((item) => item.data(\"groupId\"))\n\t\t\t\t\t: reverseItems.findIndex((item) => !item.data(\"groupId\")));\n\t\t\tbreak;\n\t}\n\tconst droppedControl = currentItemIndex > -1 && currentItemIndex < items.length ? items[currentItemIndex] : null;\n\tif (draggedControl && droppedControl) {\n\t\tconst dragDropEvent = new Event(\"keyboardDragDropEvent\", container, {\n\t\t\tdraggedControl,\n\t\t\tdroppedControl,\n\t\t\tdropPosition: [\"ArrowLeft\", \"ArrowUp\", \"Home\"].includes(event.key)\n\t\t\t\t? dnd.RelativeDropPosition.Before\n\t\t\t\t: dnd.RelativeDropPosition.After\n\t\t});\n\t\tsetTabIndexForItems(\n\t\t\titems.map((item) => item.getDomRef() as HTMLElement),\n\t\t\tcurrentItemIndex\n\t\t);\n\t\tif (callback && isMetaKey) {\n\t\t\tawait callback(dragDropEvent);\n\t\t}\n\t\tfocusDraggedItem(container, currentItemIndex);\n\t}\n}\n\n/**\n * Gathers all DOM elements representing individual tiles in the grid container\n * that have the \"sapFGridContainerItemWrapper\" class, stores them in an array,\n * and then focuses the DOM element corresponding to the card that was just moved\n * during a drag-and-drop operation by setting its \"tabindex\" to \"0\" for\n * accessibility and navigation purposes.\n * @param {GridContainer | FlexBox} container - The container containing the items.\n * @param {number} dropItemIndex - The index of the item to focus after drag-and-drop.\n */\nconst focusDraggedItem = (container: GridContainer | FlexBox, dropItemIndex: number): void => {\n\tlet draggedItemDomRef: HTMLElement | null = null;\n\tif (container instanceof GridContainer) {\n\t\tconst aWrapperItemsDomRef: HTMLElement[] = [];\n\t\tcontainer\n\t\t\t.$(\"listUl\")\n\t\t\t.children()\n\t\t\t.each(function (iIndex, oWrapperItem) {\n\t\t\t\tif (oWrapperItem.classList.contains(\"sapFGridContainerItemWrapper\")) {\n\t\t\t\t\taWrapperItemsDomRef.push(oWrapperItem);\n\t\t\t\t}\n\t\t\t});\n\t\tdraggedItemDomRef = aWrapperItemsDomRef[dropItemIndex];\n\t} else if (container instanceof FlexBox) {\n\t\tdraggedItemDomRef = container.getItems()[dropItemIndex].getDomRef() as HTMLElement;\n\t}\n\tif (draggedItemDomRef) {\n\t\tdraggedItemDomRef.setAttribute(\"tabindex\", \"0\");\n\t\tdraggedItemDomRef.focus();\n\t}\n};\n\n/**\n * Gets the index of the closest element in the Y direction within a grid container.\n * @param {GridContainer | FlexBox} container - The container (either GridContainer or FlexBox).\n * @param {number} currentIndex - The index of the current element.\n * @param {string} keyCode - The key code representing the direction (ArrowUp or ArrowDown).\n * @returns {number} The index of the closest element in the Y direction.\n */\n\nconst _getClosestElementYIndex = (container: GridContainer | FlexBox, currentIndex: number, keyCode: string) => {\n\tconst fnElementPositionX = function (element: HTMLElement) {\n\t\treturn element.getBoundingClientRect().x;\n\t};\n\n\tconst fnElementPositionY = function (element: HTMLElement) {\n\t\treturn element.getBoundingClientRect().y;\n\t};\n\n\tlet minIndex = currentIndex;\n\tlet minDistance = Number.MAX_SAFE_INTEGER;\n\tconst items = container.getItems().map((item) => item.getDomRef()) as HTMLElement[];\n\titems.forEach(function (item, index) {\n\t\tconst currentDist = Math.sqrt(\n\t\t\tMath.pow(fnElementPositionX(items[currentIndex]) - fnElementPositionX(item), 2) +\n\t\t\t\tMath.pow(fnElementPositionY(items[currentIndex]) - fnElementPositionY(item), 2)\n\t\t);\n\t\tconst isAllowed = (keyCode === \"ArrowDown\" && index > currentIndex) || (keyCode === \"ArrowUp\" && index < currentIndex);\n\t\tif (isAllowed && currentDist < minDistance && fnElementPositionY(item) !== fnElementPositionY(items[currentIndex])) {\n\t\t\tminDistance = currentDist;\n\t\t\tminIndex = index;\n\t\t}\n\t});\n\treturn minIndex;\n};\n\nconst setTabIndexForItems = (aItems: HTMLElement[], currentIndex: number) => {\n\taItems.forEach((x, index) => {\n\t\tx.tabIndex = index === currentIndex ? 0 : -1;\n\t});\n};\n"],"mappings":"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","ignoreList":[]}