/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/base/Log","sap/base/i18n/Formatting","sap/base/i18n/ResourceBundle","sap/ui/VersionInfo","sap/ui/base/Object","sap/ui/model/odata/v2/ODataModel","sap/ushell/Config","sap/ushell/Container","./CardSkeleton","./Constants","./DataFormatUtils","./HttpHelper"],function(e,t,n,i,r,s,o,a,c,u,l,f){"use strict";function d(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function p(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}const m=c["CardSkeleton"];const h=typeof Symbol!=="undefined"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function g(e,t,n){if(!e.s){if(n instanceof v){if(n.s){if(t&1){t=n.s}n=n.v}else{n.o=g.bind(null,e,t);return}}if(n&&n.then){n.then(g.bind(null,e,t),g.bind(null,e,2));return}e.s=t;e.v=n;const i=e.o;if(i){i(e)}}}const v=function(){function e(){}e.prototype.then=function(t,n){const i=new e;const r=this.s;if(r){const e=r&1?t:n;if(e){try{g(i,1,e(this.v))}catch(e){g(i,2,e)}return i}else{return this}}this.o=function(e){try{const r=e.v;if(e.s&1){g(i,1,t?t(r):r)}else if(n){g(i,1,n(r))}else{g(i,2,r)}}catch(e){g(i,2,e)}};return i};return e}();function P(e){return e instanceof v&&e.s&1}function y(e,t,n){var i=-1,r,s;function o(a){try{while(++i<e.length&&(!n||!n())){a=t(i);if(a&&a.then){if(P(a)){a=a.v}else{a.then(o,s||(s=g.bind(null,r=new v,2)));return}}}if(r){g(r,1,a)}else{r=a}}catch(e){g(r||(r=new v),2,e)}}o();return r}const S=u["DEFAULT_BG_COLOR"];function I(e,t,n){if(typeof e[h]==="function"){var i=e[h](),r,s,o;function l(e){try{while(!(r=i.next()).done&&(!n||!n())){e=t(r.value);if(e&&e.then){if(P(e)){e=e.v}else{e.then(l,o||(o=g.bind(null,s=new v,2)));return}}}if(s){g(s,1,e)}else{s=e}}catch(e){g(s||(s=new v),2,e)}}l();if(i.return){var a=function(e){try{if(!r.done){i.return()}}catch(e){}return e};if(s&&s.then){return s.then(a,function(e){throw a(e)})}a()}return s}if(!("length"in e)){throw new TypeError("Object is not iterable")}var c=[];for(var u=0;u<e.length;u++){c.push(e[u])}return y(c,function(e){return t(c[e])},n)}const b=u["FALLBACK_ICON"];const _=u["FEATURE_TOGGLES"];const C=u["FEATURE_TOGGLE_SRVC_URL"];const O=u["MYHOME_PAGE_ID"];const D=u["MYHOME_SPACE_ID"];const E=u["MYINSIGHT_SECTION_ID"];const M=u["RECOMMENDATION_SRVC_URL"];const z=u["RECOMMENDED_CARD_LIMIT"];const T=d(l);const V=d(f);const A={MUST_INCLUDE_RECOMMEDED_APPS:["F0862","F1823"]};const j=t=>{let n={};if(t){if(typeof t==="object"){n=t}else{try{n=JSON.parse(t)}catch(t){e.error(t instanceof Error?t.message:String(t));n=undefined}}}return n};const R=e=>{let t={};if(e?._instantiationData?.chip?.configuration){const n=j(e._instantiationData.chip.configuration);if(n?.tileConfiguration){const e=j(n.tileConfiguration);if(e){t=j(e.TILE_PROPERTIES)}}}return t};const x=e=>{let t="";let n={};if(e?.target?.semanticObject&&e?.target?.action){t=`#${e.target.semanticObject}-${e.target.action}`}else if(e?._instantiationData?.chip?.configuration){n=R(e);if(n?.semanticObject&&n?.semanticAction){t=`#${n?.semanticObject}-${n?.semanticAction}`}}return t};const L=e=>{let t=x(e)||"";const n=R(e);if(n?.evaluationId){t+="?EvaluationId="+n.evaluationId}return t};const U=e=>e.vizType?.startsWith("X-SAP-UI2-CHIP:SSB");const F=(e,t)=>{const n=t?._instantiationData?.chip?.bags?.sb_tileProperties?.texts;return{title:e.title?e.title:n?.title||"",subtitle:e.subtitle?e.subtitle:n?.description||""}};const N=e=>{e.forEach(t=>{e.filter(e=>e.appId===t.appId&&e?.visualization?.id!==t?.visualization?.id&&e.persConfig?.sectionIndex===t.persConfig?.sectionIndex).forEach(e=>{e?.persConfig?.duplicateApps?.push(t)})});return e};const w=e=>e?.target?.parameters?.["sap-ui-tech-hint"]?.value?.value==="GUI";const B=e=>e.fioriId&&A.MUST_INCLUDE_RECOMMEDED_APPS.includes(e.fioriId);const $=(e,t)=>!t.some(t=>t.visualization?.target?.semanticObject===e.visualization?.target?.semanticObject&&t.visualization?.target?.action===e.visualization?.target?.action);class k extends r{aRequestQueue=[];bInsightsSectionPresent=false;vizDataModified=false;constructor(){super()}static getInstance(){if(!k.Instance){k.Instance=new k}return k.Instance}_fetchRequestFromQueue(e){try{const t=this;return Promise.resolve(a.getServiceAsync("SpaceContent")).then(function(n){let i;t.aRequestQueue=t.aRequestQueue||[];const r=t.aRequestQueue.find(e=>e.pageId===O);if(!r||e===true||t.vizDataModified===true){t.vizDataModified=false;i=n.getPage(O);if(r){r.pageLoadPromise=i}else{t.aRequestQueue.push({pageId:O,pageLoadPromise:i})}}else{i=r.pageLoadPromise}return i})}catch(e){return Promise.reject(e)}}_fetchDynamicVizs(e){return this.fetchFavVizs(e,true).then(e=>e.filter(e=>e.isCount||e.isSmartBusinessTile))}_getSections(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const t=this;return Promise.resolve(t._fetchRequestFromQueue(e)).then(function(e){const n=e&&e.sections||[],i=n.findIndex(e=>e.default);if(i>0){function r(){return t._getSections(true)}const s=function(){if(t._oMoveAppsPromise!==undefined){t._oMoveAppsPromise=t.moveSection(i,0);return Promise.resolve(t._oMoveAppsPromise).then(function(){})}}();return s&&s.then?s.then(r):r(s)}else{return n}})}catch(e){return Promise.reject(e)}}_fetchMyHomeVizs(e){try{const t=this;const n=[];return Promise.resolve(t._getSections(e)).then(function(e){e.forEach((e,t)=>{e?.visualizations?.forEach((i,r)=>{const s=i.vizConfig,o=s?.["sap.app"]||{title:"?"},a={};a.oldAppId=x(s?.["sap.flp"]);a.appId=i?.targetURL;a.url=i?.targetURL;if(!a.url&&U(i)){a.url=L(s?.["sap.flp"])}a.leanURL=T.getLeanURL(a.url);a.title=i?.title||F(o,i)?.title;a.subtitle=i.subtitle||F(o,i).subtitle;a.BGColor=S().key;a.isFav=true;a.isSection=false;a.icon=s?.["sap.ui"]?.icons?.icon||b;if(i?.indicatorDataSource){a.isCount=true;a.indicatorDataSource=i.indicatorDataSource.path;a.contentProviderId=i.contentProviderId}a.isSmartBusinessTile=U(i);a.persConfig={pageId:O,sectionTitle:e.title,sectionId:e.id,sectionIndex:t,visualizationIndex:r,isDefaultSection:e.default,isPresetSection:e.preset,duplicateApps:[]};a.visualization=i;a.visualization.title=a.title;a.visualization.subtitle=a.subtitle;n.push(a)})});return n})}catch(e){return Promise.reject(e)}}_copyDynamicVizs(){try{const e=this;return Promise.resolve(e._fetchDynamicVizs(true)).then(function(t){return Promise.all(t.map(t=>e.addVisualization(t.visualization.vizId,E)))})}catch(e){return Promise.reject(e)}}fetchFavVizs(e,t){try{const n=this;return Promise.resolve(n._fetchMyHomeVizs(e)).then(function(e){const i=e.filter(e=>e.persConfig&&e.persConfig.sectionId!==E&&e.url&&e.title);if(t){return n._filterDuplicateVizs(N(i),false)}else{return n._addGroupInformation(i)}})}catch(e){return Promise.reject(e)}}fetchInsightApps(e,t){try{const n=this;function i(){return Promise.resolve(r())}const r=function(){try{return Promise.resolve(n._fetchMyHomeVizs(e)).then(function(e){return e.filter(e=>e.persConfig?.sectionId===E&&e.url&&e.title)})}catch(e){return Promise.reject(e)}};const s=function(){if(!n.bInsightsSectionPresent){return Promise.resolve(n._getSections(e)).then(function(e){n.insightsSectionIndex=e.findIndex(function(e){return e.id===E});const i=function(){if(n.insightsSectionIndex===-1&&(o.last("/core/shell/enablePersonalization")||o.last("/core/catalog/enabled"))&&n.bInsightsSectionPresent===false){n.bInsightsSectionPresent=true;return Promise.resolve(n.addSection({sectionIndex:e?.length,sectionProperties:{id:E,title:t}})).then(function(){return Promise.resolve(n._copyDynamicVizs()).then(function(){})})}else{n.bInsightsSectionPresent=true}}();if(i&&i.then)return i.then(function(){})})}}();return Promise.resolve(s&&s.then?s.then(i):i(s))}catch(a){return Promise.reject(a)}}addVisualization(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:undefined;try{return Promise.resolve(a.getServiceAsync("SpaceContent")).then(function(n){return Promise.resolve(n.addVisualization(O,t,e)).then(function(){})})}catch(e){return Promise.reject(e)}}removeVisualizations(t){let{sectionId:n,vizIds:i}=t;try{const t=this;return Promise.resolve(a.getServiceAsync("SpaceContent")).then(function(r){return I(i,function(i){const s=p(function(){return Promise.resolve(t._getSections(true)).then(function(e){const t=e.findIndex(e=>e.id===n);const s=t>-1?e[t]:null;const o=s?.visualizations?.findIndex(e=>e.id===i)??-1;const a=function(){if(o>-1){return Promise.resolve(r.deleteVisualization(O,t,o)).then(function(){})}}();if(a&&a.then)return a.then(function(){})})},function(t){e.error(t)});if(s&&s.then)return s.then(function(){})})})}catch(e){return Promise.reject(e)}}updateVisualizations(e){let{pageId:t,sourceSectionIndex:n,sourceVisualizationIndex:i,oVisualizationData:r}=e;try{return Promise.resolve(a.getServiceAsync("SpaceContent")).then(function(e){return e.updateVisualization(t,n,i,r)})}catch(e){return Promise.reject(e)}}createInsightSection(e){try{let t=false;const n=this;function i(e){return t?e:Promise.resolve()}const r=function(){if(!n.bInsightsSectionPresent){return Promise.resolve(n._getSections()).then(function(i){const r=i.findIndex(function(e){return e.id===E});if(r===-1&&(o.last("/core/shell/enablePersonalization")||o.last("/core/catalog/enabled"))){const r=n.addSection({sectionIndex:i.length,sectionProperties:{id:E,title:e,visible:true}});t=true;return r}})}}();return Promise.resolve(r&&r.then?r.then(i):i(r))}catch(s){return Promise.reject(s)}}addSection(e){try{const{sectionIndex:t,sectionProperties:n}=e;return Promise.resolve(a.getServiceAsync("SpaceContent")).then(function(e){return Promise.resolve(e.addSection(O,t,{...n,visible:true})).then(function(){})})}catch(e){return Promise.reject(e)}}getSectionVisualizations(e){let t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;try{const n=this;return Promise.resolve(n.fetchFavVizs(t)).then(function(t){if(e){return t.find(t=>t.isSection&&t.id===e)?.apps||[]}else{return t.filter(e=>!e.isSection)}})}catch(e){return Promise.reject(e)}}addBookMark(e,t){try{const n=this;return Promise.resolve(a.getServiceAsync("BookmarkV2")).then(function(i){return Promise.resolve(i.getContentNodes()).then(function(r){const s=r.find(e=>e.id===D);const o=s?.children?.find(e=>e.id===O);return Promise.resolve(i.addBookmark(T.createBookMarkData(e),o)).then(function(){return t?n.moveVisualization(t):Promise.resolve()})})})}catch(e){return Promise.reject(e)}}getVisualization(e,t){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;try{const i=this;return Promise.resolve(i.getSectionVisualizations(t,n)).then(function(t){return t.find(t=>t.appId===e)})}catch(e){return Promise.reject(e)}}moveVisualization(e){try{const t=this;return Promise.resolve(a.getServiceAsync("SpaceContent")).then(function(n){t.vizDataModified=true;return n.moveVisualization(O,e.sourceSectionIndex,e.sourceVisualizationIndex,e.targetSectionIndex,e.targetVisualizationIndex)})}catch(e){return Promise.reject(e)}}_filterDuplicateVizs(e,t){return e.filter((e,n,i)=>{const r=i.findIndex(t=>t.appId===e.appId);return t?r!==n:r===n})}_addGroupInformation(e){const t=[],n=[];let i;N(e).forEach(e=>{if(e.persConfig?.isDefaultSection){t.push(e)}else{i=n.find(t=>t.isSection&&t.id===e.persConfig?.sectionId);if(!i){n.push({id:e.persConfig?.sectionId,index:e.persConfig?.sectionIndex,title:e.persConfig?.sectionTitle||"",badge:"1",BGColor:S().key,icon:"sap-icon://folder-full",isSection:true,isPresetSection:e.persConfig?.isPresetSection,apps:[e]})}else{i.apps?.push(e);i.badge=i.apps?.length.toString()}}});return[...n,...this._filterDuplicateVizs(t,false)]}moveSection(e,t){try{return Promise.resolve(a.getServiceAsync("Pages").then(function(n){const i=n.getPageIndex(O);return n.moveSection(i,e,t)}))}catch(e){return Promise.reject(e)}}_getFeatureToggles(){try{let e=C+"?$filter=";const t=Object.keys(_);const n=t.map(e=>"ToggleId eq '"+_[e]+"'").join(" or ");e=e+"("+n+")";return Promise.resolve(V.GetJSON(e)).then(function(e){const t=e;if(t?.error){throw new Error(t.error.message)}return t?.value||[]})}catch(e){return Promise.reject(e)}}isFeatureEnabled(t){try{const n=this;return Promise.resolve(p(function(){return Promise.resolve(n._getFeatureToggles()).then(function(e){const n=e.find(e=>e.ToggleId===t);return n&&n.State===""?false:true})},function(t){e.error("Unable to load feature toggles: "+t.message);return false}))}catch(e){return Promise.reject(e)}}_getRecommenedFioriIds(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const n=this;return Promise.resolve(n.isFeatureEnabled(_.RECOMMENDATION)).then(function(i){let r=false;function s(e){return r?e:n.recommendedFioriIds}if(!i){return Promise.resolve([])}const o=function(){if(!n.recommendedFioriIds||t){return p(function(){return Promise.resolve(V.GetJSON(M)).then(function(e){const t=e;n.recommendedFioriIds=t?.value?.map(e=>e.app_id)||[]})},function(t){e.error("Unable to load feature toggles: "+t.message);const n=Promise.resolve([]);r=true;return n})}}();return o&&o.then?o.then(s):s(o)})}catch(e){return Promise.reject(e)}}_getCatalogApps(){try{return Promise.resolve(p(function(){return Promise.resolve(a.getServiceAsync("SearchableContent")).then(function(e){return e.getApps({includeAppsWithoutVisualizations:false})})},function(t){e.error("Error while fetching catalog apps: "+t.message);return[]}))}catch(e){return Promise.reject(e)}}_isListReport(e){return e?.component?.name==="sap.suite.ui.generic.template.ListReport"}isAddCardToInsightsHidden(e){return e?.component?.settings?.tableSettings?.addCardtoInsightsHidden}_checkValidManifests(e){const t=e["sap.ui.generic.app"]&&e["sap.app"]?.dataSources?.mainService;if(!t){return false}const n=e["sap.ui.generic.app"]?.pages;if(Array.isArray(n)){return this._isListReport(n[0])&&!this.isAddCardToInsightsHidden(n[0])}else if(Object.keys(n).length){return Object.keys(n).some(e=>{if(n[e]){return this._isListReport(n[e])&&!this.isAddCardToInsightsHidden(n[e])}})}return false}_getOdataModel(e){return new Promise(function(t){const n=e?.["sap.app"]?.dataSources;const i=n?.mainService;const r=i?.settings?.annotations.map(e=>{if(n&&n[e]){return n[e]?.uri}}).filter(e=>e!==undefined);const o=new s(i?.uri,{annotationURI:r,loadAnnotationsJoined:true});o.attachMetadataLoaded(()=>{t(o)});o.attachMetadataFailed(()=>{t(o)})})}_getEntitySet(e){const t=e["sap.ui.generic.app"]?.pages;if(Array.isArray(t)){return t[0].entitySet}else if(t){for(const e in t){const n=t[e];if(n.component&&n.component?.name==="sap.suite.ui.generic.template.ListReport"){return n.entitySet}}}return undefined}_hasMandatoryProperties(e,t){if(e?.["Org.OData.Capabilities.V1.FilterRestrictions"]?.["RequiredProperties"]?.length){return true}else if(t?.length){return t.some(e=>Object.keys(e).length&&(e["sap:parameter"]==="mandatory"||e["sap:required-in-filter"]==="true"))}}_getParametersisedEntitySetParams(e,t,n){if(!e){throw new Error("OData Model needs to be passed as an argument")}const i={entitySetName:null,parameters:[],navPropertyName:null};const r=e.getODataEntitySet(t);const s=e.getODataEntityType(r.entityType);const o=s.navigationProperty;if(!o){return i}o.forEach(function(t){const o=e.getODataAssociationEnd(s,t.name);const a=o&&e.getODataEntityType(o.type);if(a?.["sap:semantics"]!=="parameters"||!a.key){return}i.entitySetName=e.getODataAssociationSetEnd(s,t.name)?.entitySet;for(let r of a.key.propertyRef){if(n){const n=a.property;for(let o of n){if(o.name===r.name){i.parameters.push(o);i.entitySetName=e.getODataAssociationSetEnd(s,t.name)?.entitySet}}}else{i.parameters.push(r.name)}}const c=a.navigationProperty;const u=c?.some(function(t){const n=e.getODataAssociationEnd(a,t.name)?.type;i.navPropertyName=n===r.entityType?t.name:null;return i.navPropertyName});return u&&i.navPropertyName&&i.entitySetName});return i}_getColumnDetail(e,t,n){let i,r={};if(n.Value?.Path){i=t.getODataProperty(e,n.Value.Path)}if(!i||i["com.sap.vocabularies.UI.v1.Hidden"]?.Bool||n["com.sap.vocabularies.UI.v1.Hidden"]?.Bool){return r}if(i["com.sap.vocabularies.Common.v1.FieldControl"]?.Path){return undefined}let s=i["com.sap.vocabularies.Common.v1.Text"]?.Path||"";s="{"+s+"}";let o="{"+i.name+"}";let a="";const c=e["com.sap.vocabularies.Common.v1.SemanticKey"];const u=!!c&&c.some(function(e){return e.PropertyPath===i.name});if(i["Org.OData.Measures.V1.ISOCurrency"]?.Path){o=o.concat(" "+"{"+a+i["Org.OData.Measures.V1.ISOCurrency"].Path+"}")}if(i["Org.OData.Measures.V1.Unit"]?.Path){o=o.concat(" "+"{"+a+i["Org.OData.Measures.V1.Unit"].Path+"}")}if(i["com.sap.vocabularies.Common.v1.Text"]?.Path){let t=i["com.sap.vocabularies.Common.v1.Text"]["com.sap.vocabularies.UI.v1.TextArrangement"];if(!t){t=e["com.sap.vocabularies.UI.v1.TextArrangement"]}this._setColumnTextValue(t,r,s,o)}else{r["value"]=o;if(u){r.identifier=u}}r.path=i["com.sap.vocabularies.Common.v1.Text"]?i["com.sap.vocabularies.Common.v1.Text"].Path:i.name;r.importance=n["com.sap.vocabularies.UI.v1.Importance"];r.type=i.type;return r}_setColumnTextValue(e,t,n,i){const r=e?.EnumMember.split("/")[1];if(r==="TextOnly"){t["value"]="{= $"+n+" === '' ? '' : $"+n+"}"}else if(r==="TextLast"){t["value"]="{= $"+i+" === '' ? '' : $"+i+"}"+"{= $"+n+" === '' ? '' : ' (' + ($"+n+") + ')'}"}else if(r==="TextSeparate"){t["value"]="{= $"+i+" === '' ? '' : $"+i+"}"}else{t["value"]="{= $"+n+" === '' ? '' : $"+n+"}"+"{= $"+i+" === '' ? '' : ' (' + ($"+i+") + ')'}"}}_getManifestCardData(e,t,n,i,r,s){const o=e?.["sap.app"]?.dataSources.mainService.uri;const a=o?.[o.length-1]==="/"?o+i:o+"/"+i;const c=n?.map(e=>this._getColumnDetail(t,s,e)).filter(function(e){return e!==undefined&&e.path.split("/").length<=1});const u=T.sortCollectionByImportance(c).map(e=>({path:e.path,type:e.type,value:e.value})).splice(0,4);return{cardTitle:e?.["sap.app"]?.title,subTitle:t["com.sap.vocabularies.Common.v1.Label"]?"Top 5 "+t["com.sap.vocabularies.Common.v1.Label"].String:"",url:a+"?$top=5&skip=0",semanticObject:r.semanticObject,action:r.action,id:e?.["sap.app"]?.id,columns:u}}loadI18n(e,t){try{const i=this;function r(){return i._RBManifestMap[o]}const s=e?.["sap.app"]?.["i18n"]["bundleUrl"];const o=new URL(s,t).href;i._RBManifestMap=i._RBManifestMap||{};const a=function(){if(!i._RBManifestMap[o]){return Promise.resolve(n.create({bundleUrl:o,async:true,terminologies:e["sap.app"]?.["i18n"]["terminologies"]})).then(function(e){i._RBManifestMap[o]=e})}}();return Promise.resolve(a&&a.then?a.then(r):r(a))}catch(c){return Promise.reject(c)}}getI18nValueOrDefaultString(e,t){let n="";if(e&&e.startsWith("{{")){n=e.substring(2,e.length-2)}else if(e&&e.startsWith("{")){n=e.substring(1,e.length-1)}return n?t.getText(n):e}_getAttributeValue(e){let n=!e.value.startsWith("{")?"{= extension.formatters.stringFormatter(${"+e.path+"}) }":e.value;if(e.type==="Edm.Date"||e.type==="Edm.DateTime"){const i=JSON.stringify({pattern:t.getDatePattern("short")});n="{=${"+e.path+"}?format.dateTime(${"+e.path+"}, "+i+") : ''}"}return n}_getManifest(e){const t=JSON.parse(JSON.stringify(m));const n=t["sap.app"];const i=t["sap.card"];if(n){n.id="user."+e.id+"."+Date.now();n.title=i.header.title=e.cardTitle;n.subTitle=i.header.subTitle=e.subTitle}const r=i.content;r.item.title=this._getAttributeValue(e.columns[0]);r.item.description=this._getAttributeValue(e.columns[1]);r.item.attributes[0]={value:this._getAttributeValue(e.columns[2]),visible:"{= !!${"+e.columns[2].path+"} }"};r.data.request.url=e.url;r.item.actions=i.header.actions=[{type:"Navigation",parameters:{ibnTarget:{semanticObject:e.semanticObject,action:e.action}}}];t["sap.insights"]={parentAppId:e.id,cardType:"RT",versions:{ui5:this.versionInfo.version+"-"+this.versionInfo.buildTimestamp},visible:true};return t}_getCardMainfest(t){try{const n=this;return Promise.resolve(Promise.all([n._getInboundApps(),n._getCatalogApps()])).then(function(r){let[s,o]=r;return Promise.resolve(i.load()).then(function(i){n.versionInfo=i;let r=t.map(e=>{const t=s.find(t=>t?.signature?.parameters?.["sap-fiori-id"]?.defaultValue?.value===e);if(t){const e=o.find(e=>t.semanticObject===e.target?.semanticObject&&t.action===e.target?.action);return e&&t?.resolutionResult?.applicationDependencies?.manifest}return undefined}).filter(e=>e!==undefined);const a=r.map(function(e){try{return Promise.resolve(fetch(String(e))).then(function(e){return Promise.resolve(e.json()).then(function(t){const n=t;return{url:e.url,manifest:n}})})}catch(e){return Promise.reject(e)}});return Promise.resolve(Promise.all(a)).then(function(t){const i=t.filter(e=>n._checkValidManifests(e.manifest));const r=i.map(e=>n._getOdataModel(e.manifest).then(e=>e.getMetaModel()));return Promise.resolve(Promise.all(r)).then(function(t){const r=i.map(function(i,r){try{let o=false;return Promise.resolve(p(function(){function e(e){return o?e:n._getManifest(m)}const a=t[r];const c=n._getEntitySet(i.manifest);if(!c){return undefined}const u=a.getODataEntitySet(c);const l=a.getODataEntityType(u.entityType);const f=l["com.sap.vocabularies.UI.v1.LineItem"];if(!f||n._hasMandatoryProperties(u,l.property)){return undefined}const d=n._getParametersisedEntitySetParams(a,c,true);if(d&&d.entitySetName&&d.parameters.length){const e=a.getODataEntitySet(d.entitySetName);if(n._hasMandatoryProperties(e,d.parameters)){return undefined}}const p=s.find(function(e){return e.resolutionResult&&e.resolutionResult.ui5ComponentName===i?.manifest?.["sap.app"]?.id});const m=n._getManifestCardData(i.manifest,l,f,c,p,a);if(m.columns.length<3){return undefined}const h=function(){if(typeof i?.manifest?.["sap.app"]?.i18n==="object"){const e=i.manifest["sap.app"].i18n.bundleUrl;return function(){if(e&&(i.manifest["sap.app"].title.startsWith("i18n>")||i.manifest["sap.app"].title.startsWith("{"))){return Promise.resolve(n.loadI18n(i.manifest,i.url)).then(function(e){m.cardTitle=n.getI18nValueOrDefaultString(m.cardTitle,e);const t=n._getManifest(m);o=true;return t})}}()}}();return h&&h.then?h.then(e):e(h)},function(t){e.error(t);return undefined}))}catch(e){return Promise.reject(e)}});return Promise.resolve(Promise.all(r)).then(function(e){return e.filter(e=>e!==undefined)})})})})})}catch(e){return Promise.reject(e)}}_removeDuplicateCards(e){const t={};const n=[];e.forEach(e=>{const i=e?.descriptorContent?.["sap.card"]?.header?.title||"";if(!t[i]){n.push(e);t[i]=true}});return n}getRecommenedCards(){try{const t=this;return Promise.resolve(p(function(){return Promise.resolve(t._getRecommenedFioriIds()).then(function(e){return Promise.resolve(t._getCardMainfest(e)).then(function(e){const n=e.slice(0,z);const i=n.map(e=>{let t;if(e){e["sap.card"].rec=true;t=e["sap.app"]?.id}return{id:t,descriptorContent:e}});return t._removeDuplicateCards(i)})})},function(t){e.error("Error while fetching recommended cards: "+t.message);return[]}))}catch(e){return Promise.reject(e)}}getRecommendedVisualizations(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const t=this;function n(){return t._recommendedVisualizations}const i=function(){if(!t._recommendedVisualizations||e){return Promise.resolve(t._getRecommenedFioriIds(e)).then(function(n){const i=function(){if(n.length){let i=[];let r=[];return Promise.resolve(Promise.all([t._getVisualizationsByFioriIds(n),t._fetchMyHomeVizs(e)])).then(function(e){let[n,s]=e;n=n.filter(e=>$(e,s));n.forEach(e=>{if(B(e)){r.push(e)}else{i.push(e)}});t._recommendedVisualizations=i.slice(0,10-r.length).concat(r)})}else{t._recommendedVisualizations=[]}}();if(i&&i.then)return i.then(function(){})})}}();return Promise.resolve(i&&i.then?i.then(n):n(i))}catch(r){return Promise.reject(r)}}_getInboundApps(){try{return Promise.resolve(p(function(){return Promise.resolve(a.getServiceAsync("ClientSideTargetResolution")).then(function(e){return e?._oAdapter?._aInbounds||[]})},function(t){e.error("Error while fetching inbound apps: "+t.message);return[]}))}catch(e){return Promise.reject(e)}}_getVisualizationsByFioriIds(e){try{const t=this;const n=[];const i=new Map;return Promise.resolve(Promise.all([t._getInboundApps(),t._getCatalogApps()])).then(function(t){let[r,s]=t;e.forEach(e=>{const t=r.filter(function(t){return t?.signature.parameters["sap-fiori-id"]?.defaultValue?.value===e});t.forEach(t=>{let r=s.filter(e=>e?.target?.semanticObject===t.semanticObject&&e.target.action===t.action);const o=r.filter(e=>w(e));const a=r.filter(e=>!w(e));if(o.length>0&&a.length>0){r=[...a]}r.forEach(t=>{let r=t.visualizations[0];let s={title:r.title,subtitle:r.subtitle,icon:r.icon,url:r.targetURL,vizId:r.vizId,fioriId:e,visualization:r};if(!i.has(s.url)||!i.has(s.title)){i.set(s.url,true);i.set(s.title,true);n.push(s)}})})});return n})}catch(e){return Promise.reject(e)}}}return k});
//# sourceMappingURL=AppManager-dbg.js.map