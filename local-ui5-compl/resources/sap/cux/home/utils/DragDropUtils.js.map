{"version":3,"file":"DragDropUtils.js","names":["sap","ui","define","GridContainer","FlexBox","Event","Element","sap_ui_core_library","attachKeyboardHandler","event","disablenavigation","callback","draggedControl","closestTo","target","firstElementChild","container","getParent","isMetaKey","metaKey","ctrlKey","items","getItems","currentIndex","findIndex","item","document","activeElement","getDomRef","setTabIndexForItems","map","includes","key","Promise","resolve","preventDefault","stopPropagation","currentItemIndex","indexOfItem","reverseItems","reverse","_getClosestElementYIndex","data","length","droppedControl","_temp3","_temp2","focusDraggedItem","dragDropEvent","dropPosition","dnd","RelativeDropPosition","Before","After","_temp","then","e","reject","dropItemIndex","draggedItemDomRef","aWrapperItemsDomRef","$","children","each","iIndex","oWrapperItem","classList","contains","push","setAttribute","focus","keyCode","fnElementPositionX","element","getBoundingClientRect","x","fnElementPositionY","y","minIndex","minDistance","Number","MAX_SAFE_INTEGER","forEach","index","currentDist","Math","sqrt","pow","isAllowed","aItems","tabIndex","__exports","__esModule"],"sources":["DragDropUtils.ts"],"sourcesContent":["/*!\n * SAP UI development toolkit for HTML5 (SAPUI5)\n *  * (c) Copyright 2009-2025 SAP SE. All rights reserved\n */\n\nimport GridContainer from \"sap/f/GridContainer\";\nimport FlexBox from \"sap/m/FlexBox\";\nimport Event from \"sap/ui/base/Event\";\nimport Control from \"sap/ui/core/Control\";\nimport Element from \"sap/ui/core/Element\";\nimport { dnd } from \"sap/ui/core/library\";\n\n/**\n * Handles keyboard events for navigation and drag and drop functionality.\n * @param {KeyboardEvent} event - The keyboard event object.\n * @param {boolean} disablenavigation - Whether navigation is allowed.\n * @param {Function} callback - The callback function to execute when a drag and drop event occurs.\n * @returns {Promise<void>} A Promise that resolves when the handling is complete.\n */\n\nexport async function attachKeyboardHandler(\n\tevent: KeyboardEvent,\n\tdisablenavigation: boolean,\n\tcallback?: (dragDropEvent: Event) => Promise<void> | void\n) {\n\tconst draggedControl = Element.closestTo((event.target as HTMLElement).firstElementChild as HTMLElement) as Control;\n\tconst container = draggedControl.getParent() as GridContainer | FlexBox;\n\tconst isMetaKey = event.metaKey || event.ctrlKey;\n\tconst items = container.getItems();\n\tconst currentIndex = items.findIndex((item) => document.activeElement === item.getDomRef());\n\tsetTabIndexForItems(\n\t\titems.map((item) => item.getDomRef() as HTMLElement),\n\t\tcurrentIndex\n\t);\n\n\tif (\n\t\t!draggedControl ||\n\t\t!container ||\n\t\t!(disablenavigation && [\"ArrowRight\", \"ArrowLeft\", \"ArrowUp\", \"ArrowDown\", \"Home\", \"End\"].includes(event.key))\n\t) {\n\t\treturn;\n\t}\n\n\tevent.preventDefault();\n\tevent.stopPropagation();\n\n\tlet currentItemIndex = container.indexOfItem(draggedControl);\n\tconst reverseItems = [...items].reverse();\n\tswitch (event.key) {\n\t\tcase \"ArrowRight\":\n\t\t\tcurrentItemIndex += 1;\n\t\t\tbreak;\n\t\tcase \"ArrowLeft\":\n\t\t\tcurrentItemIndex -= 1;\n\t\t\tbreak;\n\t\tcase \"ArrowUp\":\n\t\tcase \"ArrowDown\":\n\t\t\tcurrentItemIndex = _getClosestElementYIndex(container, currentItemIndex, event.key);\n\t\t\tbreak;\n\t\tcase \"Home\":\n\t\t\tcurrentItemIndex = draggedControl.data(\"groupId\")\n\t\t\t\t? items.findIndex((item) => item.data(\"groupId\"))\n\t\t\t\t: items.findIndex((item) => !item.data(\"groupId\"));\n\t\t\tbreak;\n\t\tcase \"End\":\n\t\t\tcurrentItemIndex =\n\t\t\t\titems.length -\n\t\t\t\t1 -\n\t\t\t\t(draggedControl.data(\"groupId\")\n\t\t\t\t\t? reverseItems.findIndex((item) => item.data(\"groupId\"))\n\t\t\t\t\t: reverseItems.findIndex((item) => !item.data(\"groupId\")));\n\t\t\tbreak;\n\t}\n\tconst droppedControl = currentItemIndex > -1 && currentItemIndex < items.length ? items[currentItemIndex] : null;\n\tif (draggedControl && droppedControl) {\n\t\tconst dragDropEvent = new Event(\"keyboardDragDropEvent\", container, {\n\t\t\tdraggedControl,\n\t\t\tdroppedControl,\n\t\t\tdropPosition: [\"ArrowLeft\", \"ArrowUp\", \"Home\"].includes(event.key)\n\t\t\t\t? dnd.RelativeDropPosition.Before\n\t\t\t\t: dnd.RelativeDropPosition.After\n\t\t});\n\t\tsetTabIndexForItems(\n\t\t\titems.map((item) => item.getDomRef() as HTMLElement),\n\t\t\tcurrentItemIndex\n\t\t);\n\t\tif (callback && isMetaKey) {\n\t\t\tawait callback(dragDropEvent);\n\t\t}\n\t\tfocusDraggedItem(container, currentItemIndex);\n\t}\n}\n\n/**\n * Gathers all DOM elements representing individual tiles in the grid container\n * that have the \"sapFGridContainerItemWrapper\" class, stores them in an array,\n * and then focuses the DOM element corresponding to the card that was just moved\n * during a drag-and-drop operation by setting its \"tabindex\" to \"0\" for\n * accessibility and navigation purposes.\n * @param {GridContainer | FlexBox} container - The container containing the items.\n * @param {number} dropItemIndex - The index of the item to focus after drag-and-drop.\n */\nconst focusDraggedItem = (container: GridContainer | FlexBox, dropItemIndex: number): void => {\n\tlet draggedItemDomRef: HTMLElement | null = null;\n\tif (container instanceof GridContainer) {\n\t\tconst aWrapperItemsDomRef: HTMLElement[] = [];\n\t\tcontainer\n\t\t\t.$(\"listUl\")\n\t\t\t.children()\n\t\t\t.each(function (iIndex, oWrapperItem) {\n\t\t\t\tif (oWrapperItem.classList.contains(\"sapFGridContainerItemWrapper\")) {\n\t\t\t\t\taWrapperItemsDomRef.push(oWrapperItem);\n\t\t\t\t}\n\t\t\t});\n\t\tdraggedItemDomRef = aWrapperItemsDomRef[dropItemIndex];\n\t} else if (container instanceof FlexBox) {\n\t\tdraggedItemDomRef = container.getItems()[dropItemIndex].getDomRef() as HTMLElement;\n\t}\n\tif (draggedItemDomRef) {\n\t\tdraggedItemDomRef.setAttribute(\"tabindex\", \"0\");\n\t\tdraggedItemDomRef.focus();\n\t}\n};\n\n/**\n * Gets the index of the closest element in the Y direction within a grid container.\n * @param {GridContainer | FlexBox} container - The container (either GridContainer or FlexBox).\n * @param {number} currentIndex - The index of the current element.\n * @param {string} keyCode - The key code representing the direction (ArrowUp or ArrowDown).\n * @returns {number} The index of the closest element in the Y direction.\n */\n\nconst _getClosestElementYIndex = (container: GridContainer | FlexBox, currentIndex: number, keyCode: string) => {\n\tconst fnElementPositionX = function (element: HTMLElement) {\n\t\treturn element.getBoundingClientRect().x;\n\t};\n\n\tconst fnElementPositionY = function (element: HTMLElement) {\n\t\treturn element.getBoundingClientRect().y;\n\t};\n\n\tlet minIndex = currentIndex;\n\tlet minDistance = Number.MAX_SAFE_INTEGER;\n\tconst items = container.getItems().map((item) => item.getDomRef()) as HTMLElement[];\n\titems.forEach(function (item, index) {\n\t\tconst currentDist = Math.sqrt(\n\t\t\tMath.pow(fnElementPositionX(items[currentIndex]) - fnElementPositionX(item), 2) +\n\t\t\t\tMath.pow(fnElementPositionY(items[currentIndex]) - fnElementPositionY(item), 2)\n\t\t);\n\t\tconst isAllowed = (keyCode === \"ArrowDown\" && index > currentIndex) || (keyCode === \"ArrowUp\" && index < currentIndex);\n\t\tif (isAllowed && currentDist < minDistance && fnElementPositionY(item) !== fnElementPositionY(items[currentIndex])) {\n\t\t\tminDistance = currentDist;\n\t\t\tminIndex = index;\n\t\t}\n\t});\n\treturn minIndex;\n};\n\nconst setTabIndexForItems = (aItems: HTMLElement[], currentIndex: number) => {\n\taItems.forEach((x, index) => {\n\t\tx.tabIndex = index === currentIndex ? 0 : -1;\n\t});\n};\n"],"mappings":"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","ignoreList":[]}