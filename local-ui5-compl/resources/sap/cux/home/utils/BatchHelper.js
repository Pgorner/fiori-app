/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/ui/base/Object"],function(t){"use strict";function e(t,e){try{var n=t()}catch(t){return e(t)}if(n&&n.then){return n.then(void 0,e)}return n}var n=function(t){t["GET"]="GET";t["POST"]="POST";t["PUT"]="PUT";t["PATCH"]="PATCH";t["DELETE"]="DELETE";t["HEAD"]="HEAD";return t}(n||{});class r{batchRequests=[];constructor(t,e){this.url=encodeURI(t);this.boundary=`batch_id_${Date.now()}_01`;this.options={headers:{"Content-Type":`multipart/mixed;boundary=${this.boundary}`},method:n.GET};if(e){this.options.headers["X-CSRF-Token"]=e}}_constructBody(){const t=`--${this.boundary}`;const e=`Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n`;const n=`Accept: application/json\r\n\r\n\r\n`;let r=`${t}\r\n`;for(let o=0;o<this.batchRequests.length;o++){const s=this.batchRequests[o];const c=o===this.batchRequests.length-1?"--\r\n":"\r\n";r+=`${e}\r\n`;r+=`${s.options.method} ${s.url} HTTP/1.1\r\n${n}`;r+=`${t}${c}`}return r}addRequest(t){this.batchRequests.push(t)}}const o=function(t){const e=t.split("\r\n").filter(t=>t!=="");const n=[];let r="";for(let t=1;t<e.length-1;t++){r=e[t].includes("Content-Type: ")?e[t].split("Content-Type: ")[1]:r;if(e[t+1].includes(e[0])){if(r==="application/json"){n.push(JSON.parse(e[t]))}else{n.push(e[t])}}}return n};const s=function(t){try{return Promise.resolve(e(function(){return Promise.resolve(fetch(t,{method:n.HEAD,headers:{"X-CSRF-Token":"Fetch"}})).then(function(t){if(t.ok){const e=t.headers.get("X-CSRF-Token");if(e){return e}}throw new Error("Cannot fetch X-CSRF-Token.")})},function(t){throw new Error(t.message)}))}catch(t){return Promise.reject(t)}};const c=t.extend("sap.cux.home.utils.BatchHelper",{fetchData:function t(e){try{const t=this;e.options.body=e._constructBody();e.options.method=n.POST;return Promise.resolve(fetch(t.url,e.options)).then(function(t){if(!t.ok){throw new Error("Failed to fetch data from the server.")}return Promise.resolve(t.text()).then(o)})}catch(t){return Promise.reject(t)}},buildMultipartRequest:function t(e,n){const o=new r(e[0],n);e.forEach(t=>{o.addRequest(new r(t,n))});return o}});c.createMultipartRequest=function t(e,n){try{if(!c.Instance){c.Instance=new c}c.Instance.url=`${e}$batch`;return Promise.resolve(s(e)).then(function(t){const e=c.Instance.buildMultipartRequest(n,t);return Promise.resolve(c.Instance.fetchData(e))})}catch(t){return Promise.reject(t)}};return c});
//# sourceMappingURL=BatchHelper.js.map