/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *  * (c) Copyright 2009-2025 SAP SE. All rights reserved
 */
"use strict";sap.ui.define(["sap/m/Button","sap/m/FlexBox","sap/m/GenericTile","sap/m/IllustratedMessage","sap/m/VBox","sap/ui/core/EventBus","sap/ui/core/dnd/DragDropInfo","sap/ui/core/library","./BasePagePanel","./MenuItem","./Page","./utils/Constants","./utils/Device","./utils/DragDropUtils","./utils/FESRUtil","./utils/PageManager","./utils/PersonalisationUtils","./utils/UshellPersonalizer"],function(e,t,n,s,o,a,i,r,l,g,d,c,h,p,u,P,m,f){"use strict";function I(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const v=r["dnd"];const y=I(l);const _=I(g);const x=I(d);const C=c["SETTINGS_PANELS_KEYS"];const B=h["DeviceType"];const F=p["attachKeyboardHandler"];const T=u["addFESRId"];const D=u["addFESRSemanticStepName"];const S=I(P);const b=I(m);const A=I(f);const E=15,W=7;const w=t.extend("sap.cux.home.CustomFlexBox",{renderer:{apiVersion:2},metadata:{library:"sap.cux.home",aggregations:{items:{type:"sap.ui.core.Control",multiple:true,singularName:"item",dnd:{draggable:true,droppable:true}}}},constructor:function e(n,s){t.prototype.constructor.call(this,n,s)}});const M=y.extend("sap.cux.home.PagePanel",{metadata:{library:"sap.cux.home",properties:{title:{type:"string",group:"Misc",visibility:"hidden"},key:{type:"string",group:"Misc",visibility:"hidden"}},aggregations:{pages:{type:"sap.cux.home.Page",singularName:"page",multiple:true,visibility:"hidden"}}},constructor:function e(t,n){y.prototype.constructor.call(this,t,n);this.persContainerId=b.getPersContainerId(this);this.PageManagerInstance=S.getInstance(this.persContainerId,b.getOwnerComponent(this))},init:function e(){y.prototype.init.call(this);this._oWrapperFlexBox=new w({justifyContent:"Start",height:"100%",width:"100%",direction:"Row",renderType:"Bare",wrap:"Wrap"}).addStyleClass("newsSlideFlexGap sapUiSmallMarginTop sapUiSmallMarginBottom");this._oWrapperFlexBox.addDragDropConfig(new i({sourceAggregation:"items",targetAggregation:"items",dropPosition:v.DropPosition.Between,dropLayout:v.DropLayout.Horizontal,drop:e=>void this._handlePageDnd(e)})).attachBrowserEvent("keydown",e=>F(e,true,e=>this._handlePageDnd(e)));this._addContent(this._oWrapperFlexBox);this.setProperty("title",this._i18nBundle.getText("pageTitle"));const t=new _(`${this.getId()}-managePages`,{title:this._i18nBundle.getText("mngPage"),icon:"sap-icon://edit",press:()=>this._handleEditPages()});this.addAggregation("menuItems",t);T(t,"managePages");this.oEventBus=a.getInstance();this.oEventBus.subscribe("importChannel","favPagesImport",(e,t,n)=>{this.aFavPages=n;this._getInnerControls();this._importdone()},this);this.oEventBus.subscribe("pageChannel","pageUpdated",()=>{void this.getData(true)},this)},_importdone:function e(){const t={status:true};this.oEventBus.publish("importChannel","favPagesImported",t)},getData:function e(){let t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{const n=this;function s(){return n.oPagePromise}const o=function(){if(n.oPagePromise===undefined||n.oPagePromise===null||t){n.oPagePromise=n.PageManagerInstance.getFavoritePages();return Promise.resolve(n.oPagePromise).then(function(e){n.aFavPages=e;n._getInnerControls();n.oPagePromise=null})}}();return Promise.resolve(o&&o.then?o.then(s):s(o))}catch(a){return Promise.reject(a)}},_handleEditPages:function e(){const t=this.getParent();t?._getLayout().openSettingsDialog(C.PAGES)},attachResizeHandler:function e(t,n,s,o){try{const e=this.aFavPages.length,a=s.getDomRef();let i=0;i=t?a.clientWidth:n;let r=0,l,g=i/16;const d=1,c=n||a.clientWidth;if(e===1){o.setAlignItems("Start")}if(t&&c>=1520){g=c/16-40.75}if(e>0){if(!t){const t=e*W+(e-1)*d;if(t<=g){r=e;l=(g-(r-1)*d)/r;l=l<=E?l:E;this._setPropertyValues({hBoxWidth:g+"rem",pagesTileWidth:l+"rem"});s.setWidth(g+"rem");return true}}r=this._handleResizeForDesktop(t,e,r);l=(g-(r-1)*d)/r;l=l<=E?l:E;const n=r===0?"100%":r*l+r*d+"rem";this._setPropertyValues({hBoxWidth:n,pagesTileWidth:l+"rem"});s.setWidth(g+"rem");return true}s.setWidth(g+"rem");return true}catch(e){if(e instanceof Error){}return false}},getUserAvailablePages:function e(){try{const e=this;return Promise.resolve(e.PageManagerInstance.fetchAllAvailablePages())}catch(e){return Promise.reject(e)}},_handleResizeForDesktop:function e(t,n,s){const o=this.getDeviceType();const a=Math.ceil(n>=8?4:n/2);if(o===B.Desktop||o===B.LargeDesktop){if(t){s=a}else{s=n<=4?n:a}}else if(o===B.Tablet){s=n<=4?n:a}return s},_getInnerControls:function e(){const t=[];this.oInnerControls=[];const s=this.getParent();if(this.aFavPages){this.aFavPages.forEach(e=>{t.push(new x("",{title:e.title,subTitle:e.title===e.spaceTitle?"":e.spaceTitle,icon:e.icon,bgColor:e.BGColor,pageId:e.pageId,spaceId:e.spaceId,spaceTitle:e.spaceTitle,url:"#Launchpad-openFLPPage?pageId="+e.pageId+"&spaceId="+e.spaceId}))});t.forEach(e=>{this.oInnerControls.push(new n({header:e.getTitle(),subheader:e.getSubTitle(),press:()=>void e.onPageTilePress(e),sizeBehavior:"Responsive",state:"Loaded",frameType:"OneByOne",mode:"IconMode",backgroundColor:e.getBgColor(),tileIcon:e.getIcon(),visible:true,renderOnThemeChange:true,ariaRole:"listitem",dropAreaOffset:8,url:e.getProperty("url")}));this.addAggregation("pages",e,true)});this._oWrapperFlexBox.setAlignItems(this.aFavPages.length==1?"Start":"Center");if(this.aFavPages.length){s?.panelLoadedFn("Page",{loaded:true,count:this.aFavPages.length});this._setFavPagesContent()}else{s?.panelLoadedFn("Page",{loaded:true,count:0});this._setNoPageContent()}}else{s?.panelLoadedFn("Page",{loaded:false,count:0});this.removeAggregation("content",this._oWrapperFlexBox)}},_setFavPagesContent:function e(){this._oWrapperFlexBox.removeAllItems();this.oInnerControls.forEach(e=>{this._oWrapperFlexBox.addItem(e)})},_createNoPageContent:function t(){if(!this._oIllusMsg){this._oIllusMsg=new s(this.getId()+"--idNoPages",{illustrationSize:"Spot",illustrationType:"sapIllus-SimpleNoSavedItems",title:this._i18nBundle.getText("noDataPageTitle"),description:this._i18nBundle.getText("noPageDescription")}).addStyleClass("myHomeIllustratedMsg myHomeIllustratedMessageAlign");this.oAddPageBtn=new e(this.getId()+"--idAddPageBtn",{text:this._i18nBundle.getText("addPage"),tooltip:this._i18nBundle.getText("addPage"),type:"Emphasized",press:()=>this._handleEditPages()});D(this.oAddPageBtn,"press","addPages")}},_setNoPageContent:function e(){const t=new o({width:"100%",height:"17rem",backgroundDesign:"Solid",justifyContent:"Center"}).addStyleClass("sapUiRoundedBorder noCardsBorder");this._createNoPageContent();this._oIllusMsg.addAdditionalContent(this.oAddPageBtn);this._oWrapperFlexBox.removeAllItems();this._oWrapperFlexBox.addStyleClass("pagesFlexBox");t.addItem(this._oIllusMsg);this._oWrapperFlexBox.addItem(t)},_setPropertyValues:function e(t){const n=Object.keys(t);n.forEach(e=>{if(e==="hBoxWidth"){this._oWrapperFlexBox.setProperty("width",t[e])}else if(e==="pagesTileWidth"&&this.oInnerControls.length){this.oInnerControls.forEach(function(n){n.setProperty("width",t[e])})}})},_handlePageDnd:function e(t){try{const e=this;const n=t.getParameter?.("dropPosition"),s=t?.getParameter?.("draggedControl"),o=t.getParameter("droppedControl"),a=s.getParent()?.indexOfItem(s);let i=s.getParent()?.indexOfItem(o);if(n==="Before"&&a===i-1){i--}else if(n==="After"&&a===i+1){i++}const r=function(){if(a!==i){return Promise.resolve(e._DragnDropPages(a,i,n)).then(function(){})}}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},_DragnDropPages:function e(t,n,s){try{const o=this;function a(){return Promise.resolve(o.oPersonalizer.read()).then(function(e){if(!e)e={favouritePages:[]};e.favouritePages=o.aFavPages;return Promise.resolve(o.oPersonalizer.write(e)).then(function(){})})}if(s==="Before"&&t<n){n--}else if(s==="After"&&t>n){n++}const i=o.aFavPages.splice(t,1)[0];o.aFavPages.splice(n,0,i);o._getInnerControls();const r=function(){if(o.oPersonalizer===undefined){return Promise.resolve(A.getInstance(o.persContainerId,b.getOwnerComponent(o))).then(function(e){o.oPersonalizer=e})}}();return Promise.resolve(r&&r.then?r.then(a):a(r))}catch(l){return Promise.reject(l)}},applyColorPersonalizations:function e(t){void this.PageManagerInstance?.applyColorPersonalizations(t)},applyIconPersonalizations:function e(t){void this.PageManagerInstance?.applyIconPersonalizations(t)}});return M});
//# sourceMappingURL=PagePanel.js.map