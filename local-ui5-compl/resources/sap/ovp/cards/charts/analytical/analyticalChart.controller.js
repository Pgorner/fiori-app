/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/BaseAnalyticalChart.controller","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/app/resources","sap/base/util/each","sap/ovp/filter/FilterUtils","sap/ui/Device","sap/ovp/cards/generic/base/analytical/Utils","sap/ui/core/EventBus"],function(t,e,a,i,s,r,o,n){"use strict";return t.extend("sap.ovp.cards.charts.analytical.analyticalChart",{onInit:function(){t.prototype.onInit.apply(this,arguments);var e=this;this.eventhandler=function(t,a,i){s.applyFiltersToV2Card(i,e)};this.GloabalEventBus=n.getInstance();if(this.oMainComponent&&this.oMainComponent.isMacroFilterBar){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",e.eventhandler)}},onDataReceived:function(t){var s=this;var n=this.getView().byId("analyticalChart");var l=this.getView().byId("bubbleText");var d=a.getText("BUBBLESIZE");this.oDataSet.bindData("analyticalmodel>/","");n.setDataset(this.oDataSet);var h=n.getParent();if(!this.isVizPropSet){e.buildVizAttributes(n,h,this);this.isVizPropSet=true;if(l!=undefined){var u=n.getFeeds();i(u,function(t,e){if(u[t].getUid()=="bubbleWidth"){l.setText(d+" "+u[t].getValues())}})}e.hideDateTimeAxis(n)}if(this.getCardPropertiesModel()&&this.getCardPropertiesModel().getData()&&this.getCardPropertiesModel().getData().colorPalette&&n.getVizType()==="stacked_column"){var c=n.getDataset().getDimensions(),p=n.getFeeds(),g,b;for(var v=0;v<p.length;v++){if(p[v].getUid()==="color"){g=p[v].getValues()[0];break}}for(var f=0;f<c.length;f++){if(c[f].getName()===g){b=c[f];break}}if(g&&b){var y={};y["bDescending"]=true;b.setSorter(y)}}var D=t?t.getParameter("data"):null;e.setChartUoMTitle(n,D);if(this.bFlag==true){this.bFlag=false;this.vbLayout.setBusy(false)}else{setTimeout(function(){s.vbLayout.setBusy(false);s.bdataLoadedToEnableAddToInsight=true},0)}e.checkNoData(t,this.getCardContentContainer(),n);if(r.system.phone){if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var C=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var m=Math.max(C.dashboardLayout.rowSpan,this.iPreviousRowSpan);this.iPreviousRowSpan=m}if(o.isDataSetEmpty(t)){n.setHeight(50+"px")}else{var P=this._calculateVizFrameHeight();if(P!==undefined&&typeof P==="number"){n.setHeight(P+"px")}}}}})});
//# sourceMappingURL=analyticalChart.controller.js.map