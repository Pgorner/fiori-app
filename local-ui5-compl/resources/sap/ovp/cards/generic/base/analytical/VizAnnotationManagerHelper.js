/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/AnnotationHelper","sap/ovp/app/OVPLogger","sap/ovp/cards/Constants","sap/ovp/app/resources","sap/ovp/cards/generic/base/analytical/Utils"],function(i,e,t,a,r){"use strict";var l=new e("OVP.charts.VizAnnotationManagerHelper");var n=t.errorMessages;var o=t.Annotations;function u(e,a){var l=e[e.measureNames];if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ImprovementDirection){var n=a.CriticalityCalculation.ImprovementDirection.EnumMember;var o=r.getPathFormedOrPrimitiveValue(a.CriticalityCalculation.DeviationRangeLowValue);var u=r.getPathFormedOrPrimitiveValue(a.CriticalityCalculation.DeviationRangeHighValue);var c=r.getPathFormedOrPrimitiveValue(a.CriticalityCalculation.ToleranceRangeLowValue);var g=r.getPathFormedOrPrimitiveValue(a.CriticalityCalculation.ToleranceRangeHighValue);return i._calculateCriticalityState(l,n,o,u,c,g,t.Criticality.StateValues)}else{var C=a.Criticality.EnumMember;var m=C?C.split("/"):[];if(m){return m[1]}}}function c(i,e){return i&&i.indexOf(e,i.length-e.length)!==-1}function g(i,e){if(i&&i.CriticalityCalculation&&i.CriticalityCalculation.ImprovementDirection&&i.CriticalityCalculation.ImprovementDirection.EnumMember){var t=i.CriticalityCalculation.ImprovementDirection.EnumMember;var a=r.getPathOrPrimitiveValue(i.CriticalityCalculation.DeviationRangeLowValue);var o=r.getPathOrPrimitiveValue(i.CriticalityCalculation.DeviationRangeHighValue);var u=r.getPathOrPrimitiveValue(i.CriticalityCalculation.ToleranceRangeLowValue);var g=r.getPathOrPrimitiveValue(i.CriticalityCalculation.ToleranceRangeHighValue);if(c(t,"Minimize")||c(t,"Minimizing")){if(g&&o){e.boolFlag=true;return false}else{l.warning(n.CARD_WARNING+n.INVALID_CRITICALITY)}}else if(c(t,"Maximize")||c(t,"Maximizing")){if(u&&a){e.boolFlag=true;return false}else{l.warning(n.CARD_WARNING+n.INVALID_CRITICALITY)}}else if(c(t,"Target")){if(u&&a&&g&&o){e.boolFlag=true;return false}else{l.warning(n.CARD_WARNING+n.INVALID_CRITICALITY)}}}else if(i&&i.Criticality){e.boolFlag=true;return false}else{l.warning(n.CARD_WARNING+n.INVALID_IMPROVEMENT_DIR)}}function C(i,e,t){var a;var r;var n;if(i&&i.indexOf("{")===0){i=i.slice(1,-1);if(i.indexOf(">")!=-1){n=i.split(">");a=n[0];r=n[1]}else if(i.indexOf("&gt;")!=-1){n=i.split("&gt;");a=n[0];r=n[1]}try{i=e.getModel(a).getProperty(r)}catch(e){i=t[i][o.LABEL_KEY_V4].String;l.error("Unable to read labels from resource file",e)}}return i}function m(i,e,t){var a=i.Measure.PropertyPath;if(e[a]){if(e[a][o.LABEL_KEY_V4]){a=C(e[a][o.LABEL_KEY_V4].String?e[a][o.LABEL_KEY_V4].String:e[a][o.LABEL_KEY_V4].Path,t,e)}else if(e[a][o.LABEL_KEY]){a=e[a][o.LABEL_KEY]}else if(a){a=a}}return a}function I(i,e,t){var l=[null,null];if(!i.CriticalityCalculation||!i.CriticalityCalculation.ImprovementDirection||!i.CriticalityCalculation.ImprovementDirection.EnumMember){return l}var n=i.CriticalityCalculation.ImprovementDirection.EnumMember;var o=r.getPathOrPrimitiveValue(i.CriticalityCalculation.DeviationRangeLowValue,e);var u=r.getPathOrPrimitiveValue(i.CriticalityCalculation.DeviationRangeHighValue,e);var g=r.getPathOrPrimitiveValue(i.CriticalityCalculation.ToleranceRangeLowValue,e);var C=r.getPathOrPrimitiveValue(i.CriticalityCalculation.ToleranceRangeHighValue,e);if(c(n,"Minimize")||c(n,"Minimizing")){if(C&&u){l[0]=a.getText("MINIMIZING_LESS",[t,C]);l[1]=a.getText("MINIMIZING_MORE",[t,u]);l[2]=a.getText("MINIMIZING_CRITICAL",[C,t,u])}}else if(c(n,"Maximize")||c(n,"Maximizing")){if(g&&o){l[0]=a.getText("MAXIMISING_MORE",[t,g]);l[1]=a.getText("MAXIMISING_LESS",[t,o]);l[2]=a.getText("MAXIMIZING_CRITICAL",[o,t,g])}}else if(c(n,"Target")){if(g&&o&&C&&u){l[0]=a.getText("TARGET_BETWEEN",[g,t,C]);l[1]=a.getText("TARGET_AROUND",[t,o,u]);l[2]=a.getText("TARGET_CRITICAL",[o,t,g,C,u])}}return l}return{formThePathForCriticalityStateCalculation:u,UpdateFlagValueForDataPoint:g,getMeasureName:m,getSemanticLegends:I,getLabelFromAnnotationPath:C}});
//# sourceMappingURL=VizAnnotationManagerHelper.js.map