/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/BaseAnalyticalChart.controller","sap/ovp/cards/v4/charts/VizAnnotationManager","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/app/resources","sap/base/util/each","sap/ovp/cards/Filterhelper","sap/ovp/cards/generic/base/analytical/Utils","sap/ovp/filter/FilterUtils","sap/ui/Device","sap/ui/model/json/JSONModel"],function(e,t,a,i,r,s,o,n,l,d,h){"use strict";return e.extend("sap.ovp.cards.charts.v4.analytical.analyticalChart",{onInit:function(){e.prototype.onInit.apply(this,arguments);var t=new h({error:false});this.getView().setModel(t,"oAnalyticalCardErrorModel")},onAfterRendering:function(){e.prototype.onAfterRendering.apply(this,arguments);if(!i.checkIfAPIIsUsed(this)){var t=this.getCardPropertiesModel();var a=this.getOwnerComponent().getModel("ui").getData().cards;this.selectionVaraintFilter=o.getSelectionVariantFilters(a,t,this.getEntityType())}},onDataReceived:function(e){if(n.checkIfDataExistInEvent(e)){var i=this;var o=this.getView().byId("analyticalChart");var l=this.getView().byId("bubbleText");var c=r.getText("BUBBLESIZE");var p=i.getMetaModel().getData()["$Annotations"];this.oDataSet.bindData("analyticalmodel>/","");o.setDataset(this.oDataSet);var g=o.getParent();if(!this.isVizPropSet){t.buildVizAttributes(o,g,this);this.isVizPropSet=true;if(l!=undefined){var u=o.getFeeds();s(u,function(e,t){if(u[e].getUid()=="bubbleWidth"){l.setText(c+" "+u[e].getValues())}})}a.hideDateTimeAxis(o)}if(this.getCardPropertiesModel()&&this.getCardPropertiesModel().getData()&&this.getCardPropertiesModel().getData().colorPalette&&o.getVizType()==="stacked_column"){var f=o.getDataset().getDimensions(),v=o.getFeeds(),y,b;for(var C=0;C<v.length;C++){if(v[C].getUid()==="color"){y=v[C].getValues()[0];break}}for(var D=0;D<f.length;D++){if(f[D].getName()===y){b=f[D];break}}if(y&&b){var M={};M["bDescending"]=true;b.setSorter(M)}}var P=e?e.getSource().getCurrentContexts().map(function(e){return e&&e.getObject()}):null;t.setChartUoMTitle(o,P,p);if(this.bFlag==true){this.bFlag=false;this.vbLayout.setBusy(false)}else{setTimeout(function(){i.vbLayout.setBusy(false);i.bdataLoadedToEnableAddToInsight=true},0)}a.checkNoData(e,this.getCardContentContainer(),o);if(d.system.phone){if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var V=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var m=Math.max(V.dashboardLayout.rowSpan,this.iPreviousRowSpan);this.iPreviousRowSpan=m}if(n.isDataSetEmpty(e)){o.setHeight(50+"px")}else{var A=this._calculateVizFrameHeight();if(A!==undefined&&typeof A==="number"){o.setHeight(A+"px")}}}}else if(e&&e.getParameters().error){this.vbLayout.setBusy(false);var I=new h({error:true});this.getView().setModel(I,"oAnalyticalCardErrorModel")}}})});
//# sourceMappingURL=analyticalChart.controller.js.map