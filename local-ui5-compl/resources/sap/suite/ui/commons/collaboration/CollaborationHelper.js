/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/base/Object","sap/ui/core/Element"],function(e,t,n){"use strict";var r="sap-url-hash";var i="&sap-ui-cardTitle";var s="&sap-stageview-hash";var a="&sap-ui-cardId";var o="&sap-ui-xx-cardId";var c="transient";var l=e.getLogger("sap.suite.ui.commons.collaboration.CollaborationHelper");var u=t.extend("sap.suite.ui.commons.collaboration.CollaborationHelper");u.compactHash=function(e){const t=sap.ui.require("sap/ushell/Container");if(!t){return{url:e}}return t&&t.getServiceAsync("AppState").then(async function(t){var n=t.createEmptyAppState(undefined,false);var i=this._getNextKey(n);if(!this._isEligibleForBackendPersistency(t)){l.warning("Transient flag is true. URL will not be shortened");return{url:e}}var s=this._extractURLBeforeHash(e);var a=await this._extractSemanticObjectAndAction(e);var o=false;try{o=await this._isMinificationFeasible(e)}catch(e){}if(!a||!o){return{url:e}}return this._storeUrl(e,n).then(function(){return{url:s+"#"+a+"&/"+r+"="+i}}).catch(function(t){l.warning("URL is not shortened due to an error."+t.toString());return{url:e}})}.bind(this))};u._getCurrentUrl=function(){const e=sap.ui.require("sap/ushell/Container");return e&&e?new Promise(function(t){e.getFLPUrlAsync(true).then(function(e){t(e)})}):Promise.resolve(document.URL)};u.processAndExpandHash=function(){this._hideAvatarFromShellbar();return this._getCurrentUrl().then(function(e){if(e.indexOf(r)>-1){var t=e.split(r)[1].split("=")[1];if(e.indexOf(s)>0){t=t.split(s)[0]}else if(e.indexOf(a)>0||e.indexOf(o)>0){if(e.indexOf(a)>0){t=t.split(a)[0]}else{t=t.split(o)[0]}}else if(e.indexOf(i)>0){t=t.split(i)[0]}return this._retrieveURL(t).then(function(t){if(t.getData()){window.location.replace(t.getData())}else{const t=e.split(r)[0];window.location.replace(t)}return Promise.resolve()})}else if(e.indexOf(a)>-1){const t=e.split(a)[0];window.location.replace(t)}else if(e.indexOf(i)>-1){const t=e.split(i)[0];window.location.replace(t)}return Promise.resolve()}.bind(this))};u._hideAvatarFromShellbar=function(){this.isTeamsModeActive().then(function(e){if(e){var t=n.getElementById("userActionsMenuHeaderButton");if(t){t.setVisible(false)}}})};u.isTeamsModeActive=function(){var e=false;const t=sap.ui.require("sap/ushell/Container");if(t){return t.getServiceAsync("URLParsing").then(function(t){return this._getCurrentUrl().then(function(n){var r=n.split("#")[0];if(r.indexOf("?")!==-1){var i=t&&t.parseParameters(r.substring(r.indexOf("?")));if(i&&i["sap-collaboration-teams"]&&i["sap-collaboration-teams"][0]&&i["sap-collaboration-teams"][0]==="true"){e=true}var s=false;if(i&&i["sap-ushell-config"]&&i["sap-ushell-config"][0]&&i["sap-ushell-config"][0]==="lean"){s=true}return Promise.resolve(e&&s)}else{return Promise.resolve(false)}})}.bind(this))}else{return Promise.resolve(false)}};u._retrieveURL=function(e){const t=sap.ui.require("sap/ushell/Container");return t&&t.getServiceAsync("AppState").then(function(t){return t.getAppState(e)})};u._isEligibleForBackendPersistency=function(e){return e&&e._oConfig&&c in e._oConfig&&!e._oConfig[c]};u._getNextKey=function(e){return e.getKey()};u._extractSemanticObjectAndAction=function(e){const t=sap.ui.require("sap/ushell/Container");return t&&t.getServiceAsync("URLParsing").then(function(t){var n=t.parseShellHash(this._extractURLHash(e));if(n){return Promise.resolve(n.contextRaw?n.semanticObject+"-"+n.action+"~"+n.contextRaw:n.semanticObject+"-"+n.action)}}.bind(this))};u._isMinificationFeasible=async function(e){const t=sap.ui.require("sap/ushell/Container");if(t){const i=await t.getServiceAsync("NavTargetResolution");const s=await t.getServiceAsync("URLParsing");var n=s.parseShellHash(this._extractURLHash(e));var r=Object.keys(n.params).length;if(r>0){return i.resolveHashFragment(`#${n.semanticObject}-${n.action}`).then(function(e){return true}).catch(function(e){return false})}else{return Promise.resolve(true)}}return Promise.resolve(false)};u._extractURLBeforeHash=function(e){var t=e.split("#")[0];return t};u._extractURLHash=function(e){var t=e.substring(e.indexOf("#"));return t};u._storeUrl=function(e,t){t.setData(e);return t.save()};return u});
//# sourceMappingURL=CollaborationHelper.js.map