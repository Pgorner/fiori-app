sap.ui.define(["sap/base/util/extend","sap/base/util/ObjectPath","sap/m/MessageBox","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/base/Object","sap/ui/base/Event"],function(e,t,n,r,o,a,i){"use strict";var u=new o("lib.ContextMenuHandler").getLogger();var s=10;var l=["btnPersonalisation","btnExcelExport"];function c(o,a,c,v,f){var g=o.getView();var p=g.getModel("_templPriv");var d=a.oCommonUtils;var b=a.oComponentUtils;var m="/generic/controlProperties/"+g.getLocalId(v.getId());if(!p.getProperty(m)){p.setProperty(m,{})}var h=m+"/contextMenu";var x=h+"/items";p.setProperty(h,{items:[]});var C=a.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(v);var P=b.canNavigateToSubEntitySet(v.getEntitySet());var E;var I=0;var y=v.getTable().getContextMenu().data("CrossNavigation");var A=y&&k(y);function T(e,t,n,r,o,a,i){I++;var u="ContextMenuKey"+I;var s=t.length;i=i||[];if(a){a.then(function(t){if(t){E[u]=t;p.setProperty(e+"/"+s+"/enabled",true)}})}else if(i.length>0){var l=i.map(function(e){return e.handlerPromise});Promise.all(l).then(function(t){var n=false;t.forEach(function(t,r){if(t){p.setProperty(e+"/"+s+"/children/"+r+"/enabled",true);n=true}});p.setProperty(e+"/"+s+"/enabled",n)})}o=o&&t.length>0;t.push({text:n,icon:r,key:u,enabled:false,startsSection:o,children:i,handlerPromise:a})}var M=T.bind(null,x);function O(t,n,r){c.oFocusInfo=e(t,{smartControlId:v.getId()});if(n.command){S(n)}else{N(n,r)}c.oFocusInfo=null}function S(e){var t=v.getDependents().find(function(t){return t.isA("sap.ui.core.CommandExecution")&&t.getProperty("command")===e.command});if(!t){return}t.fireExecute()}function N(e,n){var r=e.press;var a=null;if(r.startsWith(".")){var u=r.substring(1);a=t.create(u,o)}else{a=o[r]}var s=n;var l=new i("press",s);a&&a.apply(o,[l])}function _(e,t,n){var r=function(r){return r&&f.executeAction.bind(null,e,t,n)};var o=d.getToolbarActionEnablementInfo(t,e.applicableContexts,v);if(o.enabledPromise){return o.enabledPromise.then(r)}return Promise.resolve(r(o.enabled))}function w(e,t,n){var r=function(r){return r&&O.bind(null,e,t,n)};if(t.excludeFromContextMenu||!t.requiresSelection){return}var o=d.isBreakoutActionEnabled(t,e.applicableContexts,v.getModel(),v,true);return Promise.resolve(r(o))}function B(e,t,n,r,o,a){var i=g.getLocalId(o.getId())||g.getLocalId(o.data("originalButtonId"));var u=null;var s=n.standardActions.find(function(e){return e.ID===i});var l=f.findBreakoutActionByLocalId(n.breakoutActions,i);if(s){u=_(t,s,o)}else if(l){u=w(t,l,o)}if(u){T(e,r,o.getText(),o.getIcon(),a,u);return true}return false}function F(e,t,n,r,o,a){var i=o.getMenu().getItems();var u=[];i.forEach(function(e){var r=e.getStartsSection();B(x,t,n,u,e,r)});if(u.length>0){T(e,r,o.getText(),o.getIcon(),a,null,u);return true}return false}function L(e,t){var n=d.getToolbarCustomData(v);var o=d.getBreakoutActions(v);var a=o?Object.values(o):[];var i={standardActions:n,breakoutActions:a};var u=v.getToolbar();var s=u.getContent();var c=true;s.forEach(function(n){if(!(n.getVisible&&n.getVisible())){return}var o=l.some(function(e){return n.getId().includes(e)});if(o){return}if(r.isButton(n)){c=!B(x,e,i,t,n,c)&&c}else if(r.isMenuButton(n)){c=!F(x,e,i,t,n,c)&&c}})}function D(e){var t=e.isInactive();return!t}function k(e){var t=o.getOwnerComponent().getAppComponent().getManifestEntry("sap.app");return t.crossNavigation.outbounds[e]}function H(e,t){u.error("Error while opening the context "+e.getPath()+"in new tab: "+t)}function U(e,t){if(e.applicableContexts.length>s){var r=d.getText("T_TABLE_NAVIGATION_TOO_MANY_ITEMS_SELECTED",[s]);n.warning(r);return}var o=v.getModel().hasPendingChanges()?a.oServices.oApplicationController.synchronizeDraftAsync():Promise.resolve();o.then(function(){t.forEach(function(e){if(A){var t=H.bind(null,e);a.oCommonEventHandlers.navigateIntentOnNewTab(A,e,c.oSmartFilterbar,t)}else{a.oCommonUtils.openContextInNewTabFromListItem(e)}})})}function j(e){var t=function(e,t,n){return e&&U.bind(null,t,n)};var n=a.oServices.oApplication.getEditFlowOfRoot()==="direct";var r=o.hasOwnProperty("onListNavigationExtension");var i=sap.ui.require("sap/ushell/Container");if(!P||n||r||!i){return}var u=e.applicableContexts.filter(D);var s=u.length>0;return Promise.resolve(t(s,e,u))}function V(e,t){var n=j(e);var r=true;if(n){M(t,d.getText("ST_OPEN_NEW_TAB_OR_WINDOW"),null,r,n)}}function W(e){var t=C.getFocusInfoForContextMenuEvent(e);E=Object.create(null);var n=[];L(t,n);V(t,n);return n}function q(e){var t=W(e);p.setProperty(h+"/items",t);if(t.length===0){e.preventDefault()}}function K(e){var t=e.getSource().getKey();var n=E[t];n()}return{beforeOpenContextMenu:q,onContextMenu:K}}return a.extend("sap.suite.ui.generic.template.lib.ContextMenuHandler",{constructor:function(t,n,r,o,a){e(this,c(t,n,r,o,a))}})});
//# sourceMappingURL=ContextMenuHandler.js.map