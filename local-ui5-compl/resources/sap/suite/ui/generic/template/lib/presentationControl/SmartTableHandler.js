sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/expressionHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/m/plugins/CellSelector"],function(e,t,n,r,i,a,o){"use strict";function u(e,t,u,l){var s=l.getTable();var c=r.isMTable(s);var f=r.isUiTable(s);var g=r.isTreeTable(s);var d=f?"rows":"items";var v;function m(){return s.getBinding(d)}function b(){return l.getTableBindingPath()}function p(e){return s.getColumns(e)}function C(){var e=r.getSelectionPluginForUITable(s);var t=(e||s).getSelectedIndices();return t||[]}function h(e){var t=[];e.forEach(function(e){var n=s.getContextByIndex(e);if(n){t.push(n)}});return t}function I(){if(c){return s.getSelectedContexts()}var e=C();return h(e)}function P(){var e=m();if(!e){return null}if(g){var t=e.getLength()>0?e.getLength():0;var n=[];for(var r=0;r<t;r++){var i=e.getContextByIndex(r);n.push(i)}return n}return e.getAllCurrentContexts()}function y(){return l.getModel()}function F(){var e=[];var t=l.getCustomData().find(function(e){return e.getKey()==="TemplateSortOrder"});var n=t&&t.getValue();if(n){n.split(", ").forEach(function(t){var n=t.split(" ");e.push({Property:n[0],Descending:n.length>1})})}return e}function T(){return s.getAggregation(d)}function x(){return t.setEnabledToolbarButtons(l)}function S(){return t.setEnabledFooterButtons(l)}function B(e){l.attachAfterVariantInitialise(function(){l.setCurrentVariantId(e)});l.setCurrentVariantId(e)}function R(){return s.getBindingInfo(d)}function w(e,t,n){e(n)}function O(t,n,r){var i=R();if(i&&i.binding){return new Promise(function(a,o){var l=function(e){i.binding.detachDataReceived(l);w(a,o,e);if(typeof r==="function"){(r||Function.prototype)()}};i.binding.attachDataReceived(l);if(t){i.binding.refresh(t)}else{i.binding.refresh()}if(!n&&e.getView().getModel("ui").getProperty("/editable")){u.messagesRefresh(t)}})}else{return V()}}function V(){return new Promise(function(e,t){var n=function(r){l.detachBeforeRebindTable(n);var i=r.getParameters().bindingParams;var a=i.events.dataReceived||Function.prototype;var o=function(n){a.call(this,n);w(e,t,n)};i.events.dataReceived=o};l.attachBeforeRebindTable(n);l.rebindTable()})}function E(t){var n=e.getOwnerComponent();var r=n.getModel().getMetaModel();var i=[];var a=r.getODataEntitySet(n.getEntitySet())["Org.OData.Capabilities.V1.SortRestrictions"];if(a&&a.NonSortableProperties){i=a.NonSortableProperties.map(function(e){return e.PropertyPath})}var o=t.filter(function(e){return!i.includes(e.Property)});var u=l.getUiState();var s=u.getPresentationVariant();if(!s.SortOrder){s.SortOrder=F()}s.SortOrder=s.SortOrder.concat(o);u.setPresentationVariant(s);l.setUiState(u)}function M(e){if(c){var t=s.getItems().findIndex(function(t){return t.getBindingContextPath()===e});if(t>-1){s.scrollToIndex(t)}}}function D(e){var t=e.getPath();var n=-2;for(var r=0;n===-2;r++){var i=s.getContextByIndex(r);var a=i&&i.getPath();if(a===t){n=r}else if(!i){n=-1}}return n}function U(e){var t=s.getFirstVisibleRow();var n=s.getRows().length;var r=e.getPath();for(var i=0;i<n;i++){if(s.getContextByIndex(t+i).getPath()===r){return s.getRows()[i]}}}function L(e){var t=e;var n,i;for(var a;t&&!n;t=n?t:a){var a=t.getParent();var i=r.isRow(a);n=(i||r.isColumnListItem(a))&&a}if(n){var o=n.indexOfCell(t);var u=s.getColumns();if(i){u=u.filter(function(e){return e.getVisible()})}return u[o]}}function A(e){return l._getColumnLabel(e)}a.testable(U,"getGridTableRow");a.testable(D,"getGridTableRowIndexFromContext");function H(e){var t=r.searchInTree(e,function(e){return r.isSmartField(e)?r.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e}):null});return Promise.resolve(t)}function G(e){H(e).then(function(t){r.focusUI5Control(t||e)})}function K(e){var t=s.getItems();var n=t.find(function(t){return e.getPath()===t.getBindingContext().getPath()});return n}function N(e){if(c){var t=K(e);if(t){setTimeout(function(){G(t)},0)}}else{var n=D(e);if(n!==-1){s.setFirstVisibleRow(n);setTimeout(function(){var t=U(e);G(t)},0)}}}function j(){return new Promise(function(e,t){Q(function(){Promise.resolve(r.searchInTree(s,function(e){if(r.isSmartField(e)){return r.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e})}})).then(e)})})}function _(){return c?s.getGrowingThreshold():s.getThreshold()}function q(){return l.getDataStateIndicator()}function z(){return c}function k(){return l.getToolbar()}function J(e){if(!e){return}var t=e.getModel();var n=l.getEntitySet();var r=l.getModel("@i18n");var a=r&&r.getResourceBundle();var o=i.getAnnotationFormatter(t,n,"/com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value",a);var u=o.format(e);o.done();o=i.getAnnotationFormatter(t,n,"/com.sap.vocabularies.UI.v1.HeaderInfo/Description/Value",a);var s=o.format(e);o.done();return{title:u,subTitle:s}}function Q(e){if(!s.getBusy()){e();return}var t=new n(s);var r=t.bindProperty("/busy");var i=function(){t.destroy();Q(e)};r.attachChange(i)}function W(){return new Promise(function(e){Q(e)})}function X(){return c||m().isLengthFinal()}function Y(){var e=T(),t=c?e.length:m().getLength();for(var n=0;n<t;n++){var r=c?e.at(n).getBindingContext():s.getContextByIndex(n);if(r.isInactive()){return r}}}function Z(){var e=Y();if(e){N(e)}}function $(){return c?"listItem":"item"}function ee(e){return c?K(e):U(e)}function te(e){var t;if(c){var n=e.getParameter("listItem");t=n&&n.getBindingContext()}else{var r=e.getParameter("rowIndex");var i=r<0?[]:h([r]);t=i[0]}var a=I();var o=!!t&&a.indexOf(t)>=0;var u=o||!t;var l=u?a:[t];return{focussedBindingContext:t,applicableContexts:l,doesApplicableEqualSelected:u}}function ne(){var e=c?s.getRenderedColumns():s._getVisibleColumns();return e.map(function(e){return e.data("p13nData").leadingProperty})}function re(e){var t=ne();return e.filter(function(e){return!t.includes(e)})}function ie(){if(v){return}v=new o;l.addDependent(v)}function ae(){return v&&v.getSelection()}function oe(t){var n=e.byId(t);var r=n.getEntitySet();var i=n.getModel();var a=i.getMetaModel();var o=a.getODataEntitySet(r);var u=a.getODataEntityType(o.entityType);var l=u.property;var s=[],c=[];l.forEach(function(e){var t=e["com.sap.vocabularies.Common.v1.FieldControl"]&&e["com.sap.vocabularies.Common.v1.FieldControl"];var n=t&&t.EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";var r=t&&t.Path;if(e["sap:updatable"]==="false"||n){s.push({name:e.name,label:e["sap:label"],ignoredFromPaste:false});return}var i=e["sap:field-control"];if(i||r){c.push({name:e.name,fieldControl:i||r})}});return{readOnlyFields:s,fieldControls:c}}function ue(e){var t,n,r,i,a;if(s){t=s.getColumns();r=t.length;for(i=0;i<r;i++){n=t[i];a=n.data("p13nData");if(a&&a.columnKey===e){return n}}}return null}function le(){return Promise.resolve()}return{getBinding:m,getBindingPath:b,getSelectedContexts:I,getCurrentContexts:P,getVisibleProperties:p,getItems:T,getBindingInfo:R,getModel:y,setEnabledToolbarButtons:x,setEnabledFooterButtons:S,setCurrentVariantId:B,setCurrentTableVariantId:B,setCurrentChartVariantId:Function.prototype,refresh:O,rebind:V,getUnbusyPromise:W,applyNavigationSortOrder:E,scrollToSelectedItemAsPerChildContext:M,getColumnForCell:L,getColumnLabel:A,getFirstFocussableEditableCellPromise:j,setFocusOnFirstEditableFieldInTableRow:N,getThreshold:_,getDataStateIndicator:q,getToolbar:k,getTitleInfoForItem:J,isLengthFinal:X,focusOnFirstTransientRow:Z,isMTable:z,getPressedItemParameter:$,findVisibleColumnProperties:ne,findHiddenColumnProperties:re,getRowForContext:ee,getFocusInfoForContextMenuEvent:te,addCellSelector:ie,getSelection:ae,getPotentiallyReadOnlyField:oe,getColumnByKey:ue,getInitializationPromise:le}}return e.extend("sap.suite.ui.generic.template.lib.presentationControl.SmartTableHandler",{constructor:function(e,n,r,i){t(this,u(e,n,r,i))}})});
//# sourceMappingURL=SmartTableHandler.js.map