sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/util/extend","sap/suite/ui/generic/template/lib/MessageUtils","sap/ui/model/json/JSONModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/ui/core/message/MessageType"],function(e,t,n,r,o,i,a,s){"use strict";var u=new t({filters:[new t({path:"type",operator:n.EQ,value1:s.Warning}),new t({path:"type",operator:n.EQ,value1:s.Error})],and:false});var l=new t({path:"type",operator:n.EQ,value1:s.Error});var c="model";function g(e,n,r,s){var g,f;var p;var v=function(){var t=n.getOwnerComponent();var r=e.componentRegistry[t.getId()];return!!(r.methods.showConfirmationOnDraftActivate&&r.methods.showConfirmationOnDraftActivate())}();function m(t){var n=e.oNavigationControllerProxy.getActiveComponents();var r;for(var o=0;o<n.length&&!r;o++){var i=n[o];var a=e.componentRegistry[i];r=a.viewLevel&&(a.methods.getScrollFunction||Function.prototype)(t)}return r||null}function y(v,y,d){var h=d&&d.messagesForUserDecison;var C,P;return r.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.MessageInfluencingCRUDAction",{onMessageSelect:function(){var e=C.getButtons().find(function(e){return e.isFocusable()});a.focusUI5Control(e);P.setProperty("/backbtnvisibility",true)},onBackButtonPress:function(){p.navigateBack();P.setProperty("/backbtnvisibility",false)},onAccept:function(){(g||Function.prototype)();C.close()},onReject:function(){(f||Function.prototype)();C.close()},isPositionable:function(e){return!!(e&&m(e))},titlePressed:function(e){C.close();var t=e.getParameter("item");var n=t.getBindingContext("msg").getObject();var r=m(n.controlIds);if(r){P.setProperty("/afterClose",r)}},afterClose:function(){g=null;f=null;P.setProperty("/messageToGroupName",Object.create(null));p.navigateBack();p.setModel(null,"msg");var e=P.getProperty("/afterClose");e()},getSeverityIconFromIconPool:o.getSeverityIconFromIconPool,getIconColor:o.getIconColor},c,function(e){p=e.getContent()[0]}).then(function(a){C=a;P=C.getModel(c);var g=h?new i(h):sap.ui.getCore().getMessageManager().getMessageModel();p.setModel(g,"msg");P.setProperty("/situation",v);P.setProperty("/afterClose",Function.prototype);var f=u;var m=l;var b=n.getOwnerComponent().getModel("ui");var w=b.getProperty("/createMode");var M=p.getBinding("items");if(!h){var A=[];var F=e.oNavigationControllerProxy.getActiveComponents();var E=v<3;for(var D=0;D<F.length;D++){var O=F[D];var x=e.componentRegistry[O];if(x.oController===n||v!==2){var I=(x.methods.getMessageFilters||Function.prototype)(E);A=I?A.concat(I):A}}if(A.length===0){return null}f=A.length===1?A[0]:new t({filters:A,and:false})}if(v===3){m=new t({filters:[f,l],and:true});f=new t({filters:[f,u],and:true});var S;switch(y){case"Delete":S=r.getText("DELETE");break;case"BOPFAction":S=d.actionName;break;default:if(w){S=r.getText("CREATE")}else{S=r.getText("SAVE")}}P.setProperty("/CRUDAction",S);if(M.filter(m).getLength()===0){P.setProperty("/situation",4)}}M.filter(f);if(M.getLength()===0){return null}var T=M.getAllCurrentContexts().map(function(e){return e.getObject()});var B=o.getMessageDialogTitleAndSeverity(T,e);P.setProperty("/title",B.sTitle);P.setProperty("/messageType",B.sSeverity);return s(T,M,P).then(function(){return C})})}function d(e){return new Promise(function(t,n){var r;y(e?1:2).then(function(o){r=o;if(r){r.open();return n()}if(!(e&&v)){return t()}y(3).then(function(e){r=e;if(r){g=t;f=n;r.open()}else{t()}})})})}function h(t,n){e.oApplicationProxy.performAfterSideEffectExecution(function(){d(t).then(n)},true)}function C(t,n,r,o){g=t;f=n;return y(3,r,o).then(function(t){if(t){e.oBusyHelper.getUnbusy().then(function(){t.open()},function(){t.open()})}else{n()}})}function P(e,t,n,r,o){if(e===4){return C(t,n,r,o)}else{return h(e===1,t)}}function b(){return new Promise(function e(t){y(1).then(function(e){t(!!e)})})}return{handleCRUDScenario:P,hasValidationMessageOnDetailsViews:b}}return e.extend("sap.suite.ui.generic.template.lib.CRUDActionHandler",{constructor:function(e,t,n,o){r(this,g(e,t,n,o))}})});
//# sourceMappingURL=CRUDActionHandler.js.map