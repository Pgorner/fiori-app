sap.ui.define(["sap/suite/ui/generic/template/js/AnnotationHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/base/util/deepExtend","sap/ui/comp/util/SharedUtil"],function(e,t,a,i){"use strict";var r={SINGLE_SOURCE_ONLY:"OnlySingleSource",SINLGE_AND_MULTIPLE_SOURCE:"SingleAndMultipleSource",MULTIPLE_SOURCE_ONLY:"OnlyMultipleSource",NO_SIDE_EFFECT:"NoSideEffect"};function n(e,i){var r;var n=a({},i);for(var o in i.entityType){if(o.startsWith("com.sap.vocabularies.Common.v1.SideEffects")){r=i.entityType[o];if(r.SourceProperties&&r.SourceProperties.length>1&&t.hasPropertyInSideEffect(r,i.path)){delete n.entityType[o]}}}return e._calculateFieldGroupIDs(n)}function o(t,a){var i;var o=function(){if(i){t.triggerValidateFieldGroup(i)}};var p=function(e,a){switch(e){case r.SINGLE_SOURCE_ONLY:var p=t.getInnerControls();i=p&&p[0]&&p[0].getFieldGroupIds&&p[0].getFieldGroupIds();o(i);break;case r.SINLGE_AND_MULTIPLE_SOURCE:if(a){i=n(t,a);o(i)}else{t._getComputedMetadata().then(function(e){i=n(t,e);o(i)})}break;case r.MULTIPLE_SOURCE_ONLY:break;default:break}};if(!a){t._getComputedMetadata().then(function(a){var i,n=a.entityType.namespace+"."+a.entityType.name;i=e.getSideEffectSourcePropertyType(a.path,true,t.getModel().getMetaModel(),n);if(i===r.NO_SIDE_EFFECT){return}p(i,a)})}else{p(a)}}function p(e,t,a){if(!t.isDraftEnabled()){return}var i=e.getParameter("changeEvent")&&e.getParameter("changeEvent").getSource?e.getParameter("changeEvent").getSource():e.getSource();if(a){var r=i.getCustomData().find(function(e){return e.getKey()==="SideEffectSourcePropertyType"});r=r&&r.getValue();o(i,r)}else{o(i)}}function l(e,t,i){e._getComputedMetadata().then(function(r){if(r&&r.navigationPath&&!!e.getBindingContext()){var n=a({},r);n.entitySet=t.getODataEntitySet(i);n.entityType=t.getODataEntityType(n.entitySet.entityType);var o=e._calculateFieldGroupIDs(n);if(o){e._setInternalFieldGroupIds(o)}}})}function u(e,t,a){var i;if(t&&t.Value&&t.Value.Path){i=t.Value.Path}else{i=t.Target.AnnotationPath.split("/")[0]+"/"+a}var r={sEntitySetName:e.name,sEntityTypeName:e.entityType,sLinkProperty:i};return JSON.stringify(r)}function s(e){var a=e.getCustomData();var r=e.getModel().getMetaModel();var n=a.find(e=>e.getKey()==="SideEffects"&&e.getValue());if(e.getBindingContext()&&n){var o=n.getValue();var p=o.sEntitySetName;var l=o.sEntityTypeName;var u=o.sLinkProperty;var s=t.getFieldSourcePropertiesType(u,r,l);if(s==="NoSideEffect"){return}var g=e;var y=r.getODataEntityType(l);var d=r.getODataEntitySet(p);var c=t.getPropertyMetadata(r,l,u);var f={entitySet:d,entityType:y,path:u,property:{property:c}};if(u.includes("/")){while(!g.isA("sap.ui.comp.smartform.Group")){g=g.getParent()}i.applyFieldGroupIDs(e,f,null,g.getBindingContext())}else{i.applyFieldGroupIDs(e,f)}}}function g(e,t,a,r){var n=r.getView().getModel().getMetaModel();var o=n.getODataEntitySet(a);var p=n.getODataEntityType(o.entityType);var l=n.getODataProperty(p,t);r.extensionAPI.attachPageDataLoaded(()=>{i.applyFieldGroupIDs(e,{entitySet:o,entityType:p,path:t,property:{property:l}})})}function y(e,t,a,i){var r=e.getModel().getMetaModel().getODataEntitySet(i);var n=e.getModel().getMetaModel().getODataEntityType(r.entityType);for(var o in n){if(o.includes("com.sap.vocabularies.Common.v1.SideEffects")){var p=n[o].SourceProperties;if(!p){continue}for(var l=0;l<p.length;l++){if(p[l].PropertyPath===a){var u=o.split("#")[1];t.oServices.oApplicationController.registerGroupChange(u)}}}}}return{handleSideEffectForField:p,assignFieldGroupIds:l,getPropsForLinkFields:u,assignFieldGroupIdsToLinkField:s,registerCustomFieldForSideEffect:g,fieldGroupChangeRegister:y}});
//# sourceMappingURL=SideEffectUtil.js.map