sap.ui.define(["sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiCard.controller","sap/ui/model/json/JSONModel","sap/ui/core/library","sap/ui/Device","sap/m/ResponsivePopover","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/mvc/View","sap/ui/core/Element"],function(e,t,a,i,r,n,o,s){"use strict";var l=new n("AnalyticalListPage.controller.KpiTagController").getLogger();var p,d;d=a.mvc.ViewType;var c={_kpiCards:[],init:function(e){var a=this;a.oState=e;a.oGenericModel=new t;var i={header:"Some Header",title:"Some Title",titleUrl:"",icon:"sap-icon://camera"};a.oGenericModel.setData(i);if(p===undefined){p=sap.ui.getCore().loadLibrary("sap.ovp",{async:true})}},openKpiCard:function(e){var t=this;var a;if(typeof e.currentTarget!="undefined"){a=s.getElementById(e.currentTarget.id)}else{a=e.getSource()}p.then(function(){t.createPopover(function(){t._openCard(a)}.bind(t,a),a)})},_openCard:function(e){var t=this;setTimeout(function(){t._kpiCards[e.getQualifier()].openBy(e)},0)},handleKpiPress:function(e){this.openKpiCard(e)},createPopover:function(a,n){var s=this;var p=n.getQualifier();var c=s.oState.oController.getOwnerComponent();var g=c.getKeyPerformanceIndicators();var u;for(var v in g){if(g[v].hasOwnProperty("qualifier")&&g[v].qualifier===p){u=g[v];break}}if(!u){l.error("KPI settings not found with qualifier.");return}var f=c.getAppComponent().getManifestEntry("/sap.app/crossNavigation/outbounds/"+u.detailNavigation);var C=c.getModel(u.model);C.getMetaModel().loaded().then(function(){var s=this;var l=new t;var c=arguments[0];s._oCardController=new e;var g=s.oState.oController.getOwnerComponent();var u=g.getModel(c.model);var v=u.getMetaModel();var C=v.getODataEntitySet(c.entitySet);c.metaModel=v;l.setData(c);var m=n.getFilterableKPISelectionVariant();o.create({preprocessors:{xml:{bindingContexts:{entityType:v.createBindingContext(v.getODataEntityType(C.entityType,true)),entitySet:v.createBindingContext(v.getODataEntitySet(c.entitySet,true))},models:{entitySet:v,entityType:v,parameter:l},dataModel:u,settings:l,preprocessorsData:g.getComponentData().preprocessorsData}},type:d.XML,viewName:"sap.suite.ui.generic.template.AnalyticalListPage.view.KpiCardSizeM",height:"100%"}).then(function(e){var o=n.kpiSettings.kpiPropertyPath;e.data({kpiTitle:n.getSmartKpiConfig().properties.title,qualifierSettings:c});if(o.selectionPresentationVariantPath){e.data({dataPointPath:o.dataPointPath,selectionPresentationVariantPath:o.selectionPresentationVariantPath})}else{e.data({kpiAnnotationPath:o.kpiAnnotationPath})}if(c.filterable){e.data({mergedSelectionVariant:m});e.data({searchQuery:n.getSmartFilterBarBasicSearchValue()})}else{e.data({selectionVariant:n.kpiSettings.selectionVariant})}e.setModel(g.getModel(c.model));var l=new t;var d={visible:c.detailNavigation?true:false};if(n.kpiSettings.navigation){d.target=n.kpiSettings.navigation.semanticObject;d.action=n.kpiSettings.navigation.action;d.parameters=JSON.stringify({EvaluationId:n.kpiSettings.navigation.kpiId})}else if(c.detailNavigation&&f){d.target=f.semanticObject;d.action=f.action;d.parameters=JSON.stringify(f.parameters?f.parameters:{})}else{d.visible=false}l.setData(d);e.setModel(l,"detailNavigation");if(typeof s._kpiCards[p]!="undefined"){s._kpiCards[p].destroy()}s._kpiCards[p]=new r;var u=i.system.phone?true:false;s._kpiCards[p].setShowHeader(u);if(!u){s._kpiCards[p].addStyleClass("sapSmartTemplatesAnalyticalListPageKpiCardStyle")}s._kpiCards[p].addAriaLabelledBy(n.getSmartKpiConfig().properties.title);s._kpiCards[p].setPlacement("Auto");s._kpiCards[p].addContent(e);s._oKpiCardController=e.getController();s._oKpiCardController._assignSmartTemplateDependencies(s.oState.oTemplateUtils,s.oState.oController);s.oState.oController.getView().addDependent(s._kpiCards[p]);a()})}.bind(this,u))},onExit:function(){if(this._oKpiCard){this._oKpiCard.destroy()}},_setModel:function(e){this._oKpiCard.setModel(e)}};return c});
//# sourceMappingURL=KpiTagController.js.map