sap.ui.define([],function(){"use strict";var t="sap.suite.ui.generic.template.customData",e="sap.suite.ui.generic.template.extensionData",a="sap.suite.ui.generic.template.genericData";function r(r,i,n){var s=false;var o=[];var l=[];var u,c,g;var f=new Promise(function(t){c=t});function m(){if(typeof r!=="string"){h(r)}f.then(function(){u.getInitializedPromise().then(function(){o=u.getAllFilterItems(true)})})}function p(r){u.attachBeforeVariantFetch(function(){var t=Object.create(null);t[a]=r.getManagedControlStates();t[a].customFilters=n.oCustomFiltersWrapper.getState();u.setCustomFilterData(t)});u.attachAfterVariantLoad(function(i){var s=u.getCustomFilterData();var o=s[a].customFilters||{editState:s[a].editStateFilter,appExtension:s[t],adaptationExtensions:s[e]};n.oCustomFiltersWrapper.setState(o);r.setManagedControlStates(s[a]);r.setHeaderState(!i.getParameter("executeOnSelect"));l=d()})}function d(){var t=u.getModel().getMetaModel(),e=u.getEntitySet(),a=t.getODataEntitySet(e),r=t.getODataEntityType(a.entityType),i=r["navigationProperty"],n=[];var s=u.getVariantManagement().getCurrentVariantId();var o=u.getVariantManagement().getAllVariants().find(function(t){return t.getId()===s});if(o===undefined||o.getContent()===undefined){return n}var l=JSON.parse(o.getContent().searchListReportVariant.filterBarVariant);delete l["_CUSTOM"];var c=[];for(var g in l){for(var f=0;f<i.length;f++){var m=i[f];if(g.startsWith(m.name)){if(l[g].ranges){c.push(l[g].ranges)}}}}if(c.length){var p=u.getNavigationProperties()||[];var d=c.filter(function(t){var e=t[0].keyField.split(".")[0];return!p.includes(e)});if(d.length){n=c}}return n}function S(){if(!u){return g}var t=u.getUiState();var e=t.getSelectionVariant().SelectOptions;e=e&&e.filter(function(t){return t.PropertyName!==a});return{selectOptions:e,parameters:t.getSelectionVariant().Parameters,semanticDates:t.getSemanticDates(),addedFilterItems:u.getAllFilterItems(true).filter(function(t){return t.getGroupName()!==sap.ui.comp.filterbar.FilterBar.INTERNAL_GROUP&&t.getVisibleInFilterBar()}).map(function(t){return t.getName()}),removedFilterItems:o.filter(function(t){return!t.getVisibleInFilterBar()}).map(function(t){return t.getName()}),customFilters:n.oCustomFiltersWrapper.getState()}}function F(t){if(JSON.stringify(t)===JSON.stringify(S())){return}s=true;g=t;f.then(function(){var t=u.getUiState(),e=u.getSmartVariant(),a=e.currentVariantGetModified();t.getSelectionVariant().SelectOptions=g&&g.selectOptions;t.getSelectionVariant().Parameters=g&&g.parameters;t.setSemanticDates(g&&g.semanticDates);u.setUiState(t,{replace:true,strictMode:true});n.oCustomFiltersWrapper.setState(g&&g.customFilters);u.getAllFilterItems().forEach(function(t){if(g&&g.addedFilterItems&&g.addedFilterItems.includes(t.getName())){t.setVisibleInFilterBar()}if(g&&g.removedFilterItems&&g.removedFilterItems.includes(t.getName())){t.setVisibleInFilterBar(false)}});e.currentVariantSetModified(a)});u.refreshFiltersCount();s=false}function v(t){function e(){if(!s){t()}}f.then(function(){u.attachFilterChange(function(){if(!u.isDialogOpen()){e()}});u.attachFiltersDialogClosed(e);n.oCustomFiltersWrapper.attachStateChanged(e)});u.attachFiltersDialogClosed(e);n.oCustomFiltersWrapper.attachStateChanged(function(){e();if(!s){u.getSmartVariant()&&u.getSmartVariant().currentVariantSetModified(true)}})}function h(t){u=t;c(u)}function V(){return l}m();return{getState:S,setState:F,setControl:h,attachStateChanged:v,setSVMWrapperCallbacks:p,bVMConnection:u.getSmartVariant(),suppressSelection:u.setSuppressSelection.bind(u),getMissingNavProperties:V}}return r});
//# sourceMappingURL=SmartFilterBarWrapper.js.map