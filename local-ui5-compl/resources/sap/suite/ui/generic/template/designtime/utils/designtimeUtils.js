/*!
* SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
*/
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/core/Component","sap/suite/ui/generic/template/genericUtilities/testableHelper"],function(e,t,n){"use strict";const a={Page:"Page",Control:"Control",Application:"Application"};const o={ChangePageConfiguration:"appdescr_ui_generic_app_changePageConfiguration",AddNewObjectPage:"appdescr_ui_generic_app_addNewObjectPage"};function i(e,t,n){return new Promise(function(a,o){sap.ui.require(["sap/ui/model/json/JSONModel","sap/m/InputListItem","sap/m/List","sap/m/MultiInput","sap/m/Input","sap/m/CheckBox","sap/ui/core/Item","sap/m/Select","sap/m/Token","sap/m/MultiComboBox"],function(o,i,s,r,c,d,u,l,p,g){const m=new o;m.setData(e);const f=new s;f.setModel(m);const h=new i({label:"{label}"});h.bindAggregation("content",{path:"control",factory:function(e,a){const o=a.getProperty("type");const i=a.getProperty("id");switch(o){case"string":if(a.getProperty("enum")){const e=new u({text:"{name}",key:"{id}"});const a=new l({selectedItem:"{value}",change:function(e){t[this.data("id")]=e.getParameter("selectedItem").getKey()},enabled:{path:"disabled",formatter:function(e){return!e}}}).data("id",i);a.bindItems({path:"enum",template:e});a.setSelectedKey(n[i]);return a}else{return new c({value:"{value}",change:function(e){t[this.data("id")]=e.getParameter("value")}}).data("id",i)}case"string[]":if(a.getProperty("enum")){const e=new u({text:"{name}",key:"{id}"});const a=new g({width:"60%",selectedKeys:t[i]||[],selectionChange:function(e){t[this.data("id")]=e.getSource().getSelectedKeys()},enabled:{path:"disabled",formatter:function(e){return!e}}}).data("id",i);a.bindItems({path:"enum",template:e});a.setSelectedKeys(n[i]||[]);return a}else{const e=new r({width:"70%",showValueHelp:false,showClearIcon:true,tokens:(t[i]||[]).map(function(e){return new p({text:e,key:e})}),tokenUpdate:function(e){const n=t[this.data("id")];if(e.getParameter("addedTokens").length>0){n.push(e.getParameter("addedTokens")[0].getKey())}else if(e.getParameter("removedTokens").length>0){const t=n.indexOf(e.getParameter("removedTokens")[0].getKey());if(t!==-1){n.splice(t,1)}}}}).data("id",i);e.addValidator(function(e){return new p({key:e.text,text:e.text})});return e}case"number":return new c({value:"{value}",type:"Number",change:function(e){t[this.data("id")]=parseFloat(e.getParameter("value"))}}).data("id",i);case"boolean":return new d({selected:"{value}",select:function(e){t[this.data("id")]=e.getParameter("selected")}}).data("id",i);case"booleanOrString":const e=new u({text:"{name}",key:"{id}"});const o=new l({selectedItem:"{value}",change:function(e){let n=e.getParameter("selectedItem").getKey();if(n.toLowerCase()==="false"||n.toLowerCase()==="true"){n=JSON.parse(n)}t[this.data("id")]=n}}).data("id",i);o.bindItems({path:"enum",template:e});o.setSelectedKey(n[i]);return o;case"booleanOrStringCheckbox":const s=a.getProperty("enum");const m=new d({selected:n[i]===s.find(e=>e.name==="true").id,select:function(e){const n=e.getParameter("selected");const a=n?s.find(e=>e.name==="true").id:s.find(e=>e.name==="false").id;t[this.data("id")]=a}}).data("id",i);return m;case"json":return new c({value:"{value}",change:function(e){try{t[this.data("id")]=JSON.parse(e.getParameter("value"))}catch(e){}}}).data("id",i);default:return null}}});f.bindItems({path:"/",template:h});a(f)})})}function s(e){return t.getOwnerComponentFor(e)}function r(e,t){return t.map(function(t){const n={label:t.name,tooltip:t.description,control:[]};const a={type:t.type,enum:t.enums,value:e[t.id],id:t.id};n.control.push(a);return n})}let c=function(e,t,n,a=o.ChangePageConfiguration,i=false){const s=e.getAppComponent();return{appComponent:s,selector:s,changeSpecificData:{appDescriptorChangeType:a,content:{parameters:{parentPage:{component:i?"sap.suite.ui.generic.template":e.getMetadata().getComponentName(),entitySet:!i?e.getEntitySet():undefined},entityPropertyChange:{propertyPath:t,operation:"UPSERT",propertyValue:n}}}}}};async function d(e,t,n,a,o,s){const r=await i(e,t,n);return new Promise(function(e,n){sap.ui.require(["sap/m/Dialog","sap/m/Button","sap/m/MessageStrip"],function(i,c,d){const u=new d({type:"Information",showIcon:true,text:"{i18n>RTA_CONFIGURATION_INFO_MESSAGE}"});u.addStyleClass("sapUiSmallMarginBottom");const l=new i({title:a,contentWidth:o?o.width:"550px",contentHeight:o?o.height:"300px",content:[u,r],resizable:true,buttons:[new c({text:"{i18n>RTA_CONFIGURATION_APPLY}",type:"Emphasized",press:function(){l.close();e(t)}}),new c({text:"{i18n>RTA_CONFIGURATION_CANCEL}",press:function(){l.close();n()}})]});l.setModel(s,"i18n");l.addStyleClass("sapUiContentPadding");l.addStyleClass("sapUiRTABorder");l.open()})})}let u=function(e,t,n,o){const i={};e.forEach(function(e){if(typeof t[e.id]!=="object"&&t[e.id]!==n[e.id]||typeof t[e.id]==="object"&&JSON.stringify(t[e.id])!==JSON.stringify(n[e.id])){const t=e.getPath?e.getPath(o):e.id;const s={};const r=!!e.bSupportsGlobalScope&&o.sScope===a.Application;if(e.writeObject?.length&&e.writeObjectFor===n[e.id]){e.writeObject.forEach(function(e){s[e.getPath?e.getPath(o):e.id]=n[e.id]});i[t]={value:s,bIsGlobalChange:r}}else if(!e.skipChange){i[t]={value:n[e.id],bIsGlobalChange:r}}}});return i};let l=function(e,t,n){const a=[];const o={};for(const[i,s]of Object.entries(e)){o[i]=s.value;a.push(c(t,i,s.value,n,s.bIsGlobalChange))}return a};function p(e,t,n,a,o){const i=u(n,t,e,o);return l(i,a,o.sChangeType)}function g(e){const t=s(e);return t.getRootControl().getLocalId(e.getId())}function m(t){const n=t.getManifest();const a=n["sap.ui.generic.app"]["settings"];const o=["tableSettings.createMode","statePreservationMode","flexibleColumnLayout","inBoundParameters"];const i={};o.forEach(function(t){const n=e.get(t,a);if(n){e.set(t,n,i)}});return i}function f(e,t){const n=s(e).getMetadata().getComponentName();return t.filter(e=>!e.restrictedTo||e.restrictedTo.includes(n))}u=n.testableStatic(u,"getChangedPropertyValues");l=n.testableStatic(l,"getChanges");c=n.testableStatic(c,"getChangeStructure");return{openAdaptionDialog:d,getSettings:r,extractChanges:p,getOwnerComponentFor:s,createAdaptionDialogContent:i,getLocalId:g,SettingScope:a,ChangeType:o,getSupportedGlobalManifestSettings:m,getAllowedDesigntimeSettings:f}});
//# sourceMappingURL=designtimeUtils.js.map