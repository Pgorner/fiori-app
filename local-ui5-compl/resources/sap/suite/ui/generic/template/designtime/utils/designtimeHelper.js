sap.ui.define(["sap/base/util/deepExtend","sap/base/util/merge","sap/suite/ui/generic/template/designtime/controls/SmartTable.designtime","sap/suite/ui/generic/template/designtime/controls/DynamicPage.designtime","sap/suite/ui/generic/template/designtime/controls/SmartFilterBar.designtime","sap/suite/ui/generic/template/designtime/controls/ObjectPageLayout.designtime","sap/ui/core/Element"],function(e,t,r,n,i,a,s){"use strict";var o={};var g=[];var c="fiori-tools-rta-mode";var u;function d(){var e=[];function t(t){if(o[t.getId()]){return}var r={};o[t.getId()]=r;r.designTimePromise=t.getMetadata().loadDesignTime(t);e.push(r.designTimePromise);r.designTimePromise.then(function(e){r.designTime=e})}function r(e){return!e||!e.id||o[e.id]?e:e.parentNode&&r(e.parentNode)}document.querySelectorAll(".sapUiXMLView").forEach(function(e){var n=s.getElementById(e.id);if(!n||!(n instanceof sap.ui.core.mvc.XMLView)||!(n.getController()instanceof sap.suite.ui.generic.template.lib.TemplateViewController)){return}g.push(n);n.findAggregatedObjects(true).forEach(t);var i=function(e){e.forEach(function(e){if(e.type==="childList"&&e.addedNodes.length>0){e.addedNodes.forEach(function(e){var n=r(e);var i=n&&s.getElementById(n.id);if(i){i.findAggregatedObjects(true).forEach(t)}})}})};if(!u){u=u||new MutationObserver(i);var a={childList:true,subtree:true};u.observe(e,a)}});return Promise.all(e)}function l(){u&&u.disconnect()}function f(){const e=new URLSearchParams(window.location.search);const t=e.get(c);return t}function m(e){var t=[e];while(!(e instanceof sap.ui.core.mvc.XMLView)){e=e.getParent();if(!e){return}t.push(e)}if(!(e.getController()instanceof sap.suite.ui.generic.template.lib.TemplateViewController)){return}return t}function p(e,t){return t===e||t.findAggregatedObjects&&t.findAggregatedObjects(true).includes(e)}function A(e,t){var r=Object.keys(o[e.sAncestorId].designTime.aggregations);return r.find(function(r){var n=e.oAncestor.getMetadata().getAggregation(r);var i=n&&n.get(e.oAncestor)||e.oAncestor.getAggregation(r);if(Array.isArray(i)){return i.find(p.bind(null,t))}else{return i&&p(t,i)}})}function v(r){if(r instanceof sap.ui.core.mvc.XMLView){return}var n=o[r.getId()];if(!n||n.designTimePromise&&!n.designTime){return}var i=e({},n.designTime);var a=m(r);if(!a){return}a.shift();a.pop();var s=a.map(function(e){return{oAncestor:e,sAncestorId:e.getId()}});s=s.filter(function(e){return o[e.sAncestorId]&&o[e.sAncestorId].designTime&&o[e.sAncestorId].designTime.aggregations});s.forEach(function(e){e.sAggregation=A(e,r)});n.pedigree=s.filter(function(e){return o[e.sAncestorId]&&o[e.sAncestorId].designTime.aggregations&&o[e.sAncestorId].designTime.aggregations[e.sAggregation]&&o[e.sAncestorId].designTime.aggregations[e.sAggregation].propagateMetadata});i=n.pedigree.reduce(function(e,n){return t(e,o[n.sAncestorId].designTime.aggregations[n.sAggregation].propagateMetadata(r,n.oAncestor))},i);return i}function b(e,t){var r=v(e);if(!r){return}var n=Object.create(null);if(r.actions&&typeof r.actions==="object"){n.actions=Object.create(null);for(var i in r.actions){n.actions[i]=t&&t.actions&&t.actions.includes(i)?r.actions[i]:null}}else{n.actions=r.actions}n.aggregations=Object.create(null);for(var a in r.aggregations){n.aggregations[a]={actions:Object.create(null)};for(var i in r.aggregations[a].actions){n.aggregations[a].actions[i]=t&&t.aggregations&&t.aggregations[a]&&t.aggregations[a].actions&&t.aggregations[a].actions.includes(i)?r.aggregations[a].actions[i]:null}}n.properties=Object.create(null);for(var s in e.getMetadata().getAllProperties()){n.properties[s]={ignore:!t||!t.properties||!t.properties.includes(s)||r.properties&&r.properties[s]&&r.properties[s].ignore}}return n}function T(e,s){return d().then(function(){var o={aggregations:{content:{propagateMetadata:function(o){var g=o.getMetadata().getElementName&&b(o,e[o.getMetadata().getElementName()]);var c={};if(s===M.ForAdaptation){switch(o.getMetadata().getElementName()){case"sap.uxap.ObjectPageLayout":c=a.getDesigntime(o);break;case"sap.ui.comp.smartfilterbar.SmartFilterBar":c=i.getDesigntime(o);break;case"sap.ui.comp.smarttable.SmartTable":c=r.getDesigntime(o);break;case"sap.f.DynamicPage":c=n.getDesigntime(o);break;default:break}}return t(g,c)}}}};return g.reduce(function(r,n){return t(b(n,e[n.getMetadata().getElementName()]),r)},o)})}function h(e){return e.reduce(function(e,t){if(!t){return e}if(!e){return t}if(Array.isArray(t)!==Array.isArray(e)){return true}if(Array.isArray(e)){return e.concat(t)}else{for(var r in t){e[r]=h([e[r],t[r]])}return e}})}const M={True:"true",ForAdaptation:"forAdaptation"};return{getMergedAllowList:h,getViewDesignTime:T,getRtaModeValue:f,stopMutationObserver:l,FioriToolsRtaMode:M}});
//# sourceMappingURL=designtimeHelper.js.map