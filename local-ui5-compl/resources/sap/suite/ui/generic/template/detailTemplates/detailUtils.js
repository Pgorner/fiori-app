sap.ui.define(["sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/UIComponent","sap/ui/core/routing/HashChanger","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/extensionAPI/NavigationController","sap/suite/ui/generic/template/lib/MessageButtonHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/detailTemplates/DiscardEditHandler","sap/suite/ui/generic/template/detailTemplates/PaginatorButtonsHelper","sap/suite/ui/generic/template/ObjectPage/extensionAPI/DraftTransactionController","sap/suite/ui/generic/template/ObjectPage/extensionAPI/NonDraftTransactionController","sap/ui/core/message/MessageType","sap/m/DraftIndicator"],function(e,t,n,a,o,r,i,s,l,c,u,p,g,f){"use strict";var v=new e("detailTemplates.detailUtils").getLogger();var d=sap.m.DraftIndicatorState;var m=new a({path:"persistent",operator:o.EQ,value1:false});function C(e,t,n){function a(){var e=t.getTemplatePrivateModel();e.setProperty("/objectPage",{displayMode:0,headerInfo:{objectTitle:"",objectSubtitle:""},messageStripInfo:{messageText:"",messageType:f.None},cancelEnabled:true})}function o(a,o){if(!t.isDraftEnabled()){var r=e.getModel("ui");var i=t.getTemplatePrivateModel();var s=r.getProperty("/createMode");i.setProperty("/objectPage/displayMode",s?4:1)}(n.onComponentActivate||Function.prototype)(a,o)}function r(t){var a=e.getModel("_templPrivGlobal");a.setProperty("/generic/draftIndicatorState",d.Clear);(n.applyHeaderContextToSmartTablesDynamicColumnHide||Function.prototype)(t)}function i(){n.navigateUp()}function s(e){return n.getMessageFilters(e)}function l(e){return n.getScrollFunction&&n.getScrollFunction(e)}function c(){return{callAlways:true}}return{init:a,onActivate:o,getTitle:t.getTitle,updateBindingContext:r,navigateUp:i,getMessageFilters:s,getScrollFunction:l,getStatePreserverSettings:c}}function b(e,a,o){var f;var d;function C(){var e=t.getRouterFor(o);return e?e.getHashChanger():n.getInstance()}function b(e){var t=!a.oComponentUtils.isDraftEnabled();if(t||!e){var n=o.getView().getModel("ui");n.setProperty("/editable",e)}}function y(){a.oServices.oApplication.onBackButtonPressed()}function P(){var t=a.oServices.oApplication.getLinksToUpperLayers();var n=a.oComponentUtils.getViewLevel();var o;if(a.oComponentUtils.isDraftEnabled()){var r=a.oComponentUtils.getTemplatePrivateModel();o=r.getProperty("/objectPage/displayMode")}else{o=1}e.navigateUp=t[n-1].navigate.bind(null,o,false);var i=e.aBreadCrumbs;var s=i?i.length:0;for(var l=0;l<s;l++){var c=i[l];var u=t[l+1];u.adaptBreadCrumbLink(c);var p={id:c.getId(),navigate:u.navigate.bind(null,o,true)};a.oInfoObjectHandler.initializeLinkInfoObject(p)}}function h(){e.navigateUp()}function B(e){var t=a.oServices.oApplication.getBusyHelper();var n=o.getView().getModel("ui");var r=a.oServices.oApplicationController.synchronizeDraftAsync().then(function(){h()},function(){t.getUnbusy().then(function(e){a.oCommonUtils.processDataLossTechnicalErrorConfirmation(function(){h();n.setProperty("/enabled",true)},Function.prototype,f.state,"LeavePage")})});t.setBusy(r)}function S(e){var t=e.getSource();var n=a.oComponentUtils.getCRUDActionHandler();n.handleCRUDScenario(2,B.bind(null,t))}var U;function H(t,n){U=U||new c(o,a,e,f.state);return U.discardEdit(t,n)}function M(){var e=a.oServices.oApplication.getBusyHelper();if(e.isBusy()){return}f.state.messageButtonHelper.toggleMessagePopover()}function F(e){return f.state.messageButtonHelper&&f.state.messageButtonHelper.getMessageFilters(e)}function T(){var e;return function(){e=e||new i(a,o,f.state);return e}}function I(){var e;return function(){if(!e){var t=a.oComponentUtils.isDraftEnabled()?p:g;e=new t(a,o,f.state)}return e}}function A(e){d.handleShowNextObject(e)}function w(){d.switchToNextObject()}function j(e){d.handleShowPrevObject(e)}var C=l.testable(C,"getHashChangerInstance");var P=l.testable(P,"adaptLinksToUpperLevels");f={onInit:function(t,n){if(!t||t.footerBar){var i=a.oComponentUtils.isODataBased();f.state.messageButtonHelper=new s(a,n||{controller:o},i);if(!a.oComponentUtils.isDraftEnabled()){var l=o.getOwnerComponent().getModel("ui");var c=l.bindProperty("/editable");var p=sap.ui.getCore().getMessageManager();var g=p.getMessageModel();c.attachChange(function(){if(!c.getValue()){var e=f.state.messageButtonHelper.getContextFilter(false);var t=g.bindList("/",null,null,[e,m]);var n=t.getContexts();var a=n.map(function(e){return e.getObject()});p.removeMessages(a)}})}a.oServices.oTemplateCapabilities.oMessageButtonHelper=f.state.messageButtonHelper;f.state.onCancel=H}if(!t||t.paginatorButtons){d=new u(f,o,a,e)}e.getScrollFunction=function(t){var n=a.oCommonUtils.getPositionableControlId(t,true);if(n){return function(){(e.prepareForControlNavigation||Function.prototype)(n);r.focusControl(n)}}}},handlers:{handleShowNextObject:A,handleShowPrevObject:j,onShowMessages:M,applyAndUp:S,onSave:function(){v.error("Save for this floorplan not implemented yet")},onBack:y},extensionAPI:{getNavigationControllerFunction:T,getTransactionControllerFunction:I},fclInfo:{isContainedInFCL:false},state:{},onComponentActivate:function(e,t){if(f.state.messageButtonHelper){f.state.messageButtonHelper.adaptToContext(e)}P();if(d){d.computeAndSetVisibleParamsForNavigationBtns()}},utils:{switchToNextObject:w}};e.navigateUp=h;e.setEditable=b;e.getMessageFilters=F;var D=a.oComponentUtils.getFclProxy();if(D.oActionButtonHandlers){f.handlers.fclActionButtonHandlers=D.oActionButtonHandlers;f.fclInfo.isContainedInFCL=true}return f}return{getComponentBase:C,getControllerBase:b}});
//# sourceMappingURL=detailUtils.js.map