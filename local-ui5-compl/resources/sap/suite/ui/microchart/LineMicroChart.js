/*!
 * SAPUI5
 * (c) Copyright 2009-2024 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes","sap/base/Log","sap/suite/ui/microchart/MicroChartUtils","sap/suite/ui/microchart/LineMicroChartLine","./LineMicroChartRenderer","sap/ui/core/Core","sap/ui/core/Theming","./LineMicroChartPoint"],function(jQuery,e,t,i,a,o,s,r,l,n,h,p){"use strict";const u=e.MicroChartColorType;var c=t.extend("sap.suite.ui.microchart.LineMicroChart",{metadata:{library:"sap.suite.ui.microchart",properties:{size:{type:"sap.m.Size",group:"Appearance",defaultValue:"Auto"},threshold:{type:"float",group:"Appearance",defaultValue:0},showThresholdLine:{type:"boolean",group:"Appearance",defaultValue:true},showThresholdValue:{type:"boolean",group:"Appearance",defaultValue:false},thresholdDisplayValue:{type:"string",group:"Appearance"},minXValue:{type:"float",group:"Appearance"},maxXValue:{type:"float",group:"Appearance"},minYValue:{type:"float",group:"Appearance"},maxYValue:{type:"float",group:"Appearance"},leftTopLabel:{type:"string",group:"Data",defaultValue:null},rightTopLabel:{type:"string",group:"Data",defaultValue:null},leftBottomLabel:{type:"string",group:"Data",defaultValue:null},rightBottomLabel:{type:"string",group:"Data",defaultValue:null},showTopLabels:{type:"boolean",defaultValue:true},showBottomLabels:{type:"boolean",defaultValue:true},color:{type:"any",group:"Appearance",defaultValue:"Neutral"},showPoints:{type:"boolean",group:"Appearance",defaultValue:false},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},hideOnNoData:{type:"boolean",group:"Appearance",defaultValue:false}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},defaultAggregation:"points",aggregations:{points:{type:"sap.suite.ui.microchart.LineMicroChartPoint",defaultClass:p,multiple:true,bindable:"bindable",forwarding:{getter:"_getInternalLine",aggregation:"points"}},lines:{type:"sap.suite.ui.microchart.LineMicroChartLine",defaultClass:r,multiple:true,bindable:"bindable"},_line:{type:"sap.suite.ui.microchart.LineMicroChartLine",defaultClass:r,multiple:false,visibility:"hidden"}},events:{press:{}}},renderer:l});c.THRESHOLD_LOOK_XS=1.125;c.THRESHOLD_LOOK_S=3.5;c.THRESHOLD_LOOK_M=4.5;c.THRESHOLD_LOOK_L=5.875;c.THRESHOLD_WIDTH_NO_LABEL=6;c.prototype.ontap=function(e){this.firePress()};c.prototype.onkeydown=function(e){if(e.which===a.SPACE){e.preventDefault()}};c.prototype.onkeyup=function(e){if(e.which===a.ENTER||e.which===a.SPACE){this.firePress();e.preventDefault()}};c.prototype.attachEvent=function(e,i,a,o){t.prototype.attachEvent.call(this,e,i,a,o);if(this.hasListeners("press")){this.$().attr("tabindex",0).addClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.detachEvent=function(e,i,a){t.prototype.detachEvent.call(this,e,i,a);if(!this.hasListeners("press")){this.$().removeAttr("tabindex").removeClass("sapSuiteUiMicroChartPointer")}return this};c.prototype.onclick=function(){this.firePress()};c.prototype.onsapspace=c.prototype.onclick;c.prototype.onsapenter=c.prototype.onclick;c.prototype.getThreshold=function(){if(this._bThresholdNull){return null}else{return this.getProperty("threshold")}};c.prototype.init=function(){this._minXScale=null;this._maxXScale=null;this._minYScale=null;this._maxYScale=null;this._fNormalizedThreshold=0;this._bScalingValid=false;this._bThresholdNull=false;this._bNoTopLabels=false;this._bNoBottomLabels=false;this._oRb=n.getLibraryResourceBundle("sap.suite.ui.microchart");this.setAggregation("tooltip","((AltText))",true);this._bThemeApplied=false;n.ready(this._handleCoreInitialized.bind(this))};c.prototype._handleCoreInitialized=function(){h.attachApplied(this._handleThemeApplied.bind(this))};c.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();h.detachApplied(this._handleThemeApplied.bind(this))};c.prototype.onBeforeRendering=function(){if(this._hasData()){this._setModeFlags();this._normalizePoints()}this._unbindMouseEnterLeaveHandler()};c.prototype.onAfterRendering=function(){this._sResizeHandlerId=i.register(this,this._onResize.bind(this));this._onResize();this._bindMouseEnterLeaveHandler()};c.prototype.exit=function(){this._deregisterResizeHandler()};c.prototype.validateProperty=function(e,i){if(e==="threshold"){this._bThresholdNull=i===null}if(i===null||i===undefined){return t.prototype.validateProperty.apply(this,[e,null])}if(e==="color"&&!this.isColorCorrect(i)){o.warning("Color property of LineMicroChart must be of type sap.m.ValueCSSColor either as single value or as composite value (above: value, below: value)");i=null}else if(["minXValue","maxXValue","minYValue","maxYValue"].indexOf(e)>=0){if(!jQuery.isNumeric(i)){o.warning("Property "+e+" of LineMicroChart is not numeric and it will be reset to default");i=null}}return t.prototype.validateProperty.apply(this,[e,i])};c.prototype._getInternalLine=function(){var e=this.getAggregation("_line");if(!e){e=new r;this.setAggregation("_line",e)}return e};c.prototype._getLines=function(){var e=this.getAggregation("_line");return e&&e._getPoints().length>0?[e]:this.getLines()};c.prototype._setModeFlags=function(){var e;this._minXScale=Infinity;this._maxXScale=-Infinity;if(this._bThresholdNull){this._minYScale=Infinity;this._maxYScale=-Infinity}else{this._minYScale=this._maxYScale=this.getThreshold()}this._getLines().forEach(function(t){e=t._getPoints();t._bFocusMode=false;t._bSemanticMode=false;for(var i=0;i<e.length;i++){this._minXScale=Math.min(e[i].getX(),this._minXScale);this._maxXScale=Math.max(e[i].getX(),this._maxXScale);this._minYScale=Math.min(e[i].getY(),this._minYScale);this._maxYScale=Math.max(e[i].getY(),this._maxYScale);if(e[i].getMetadata().getName()==="sap.suite.ui.microchart.LineMicroChartEmphasizedPoint"){t._bFocusMode=true;if(e[i].getColor()!==u["Neutral"]&&e[i].getShow()){t._bSemanticMode=true}}}if(!t._bFocusMode){t._bSemanticMode=t.getColor()&&t.getColor().above&&t.getColor().below&&!this._bThresholdNull}if(t._bFocusMode&&t._bSemanticMode&&t.getColor()!==u["Neutral"]){o.info("Property Color of LineMicroChart has no effect if EmphasizedPoints with colors different from Neutral are used.")}if(t._bFocusMode&&t.getShowPoints()){o.info("Property ShowPoints of LineMicroChart has no effect if EmphasizedPoints are used.")}if(t.getColor()&&t.getColor().above&&t.getColor().below&&this._bThresholdNull){o.info("Property Color of LineMicroChart has no effect if it is composed of colors for above and below when property Threshold is null")}},this);var t=this.getLeftTopLabel(),i=this.getRightTopLabel(),a=this.getLeftBottomLabel(),s=this.getRightBottomLabel();this._bNoBottomLabels=s.length===0&&a.length===0;this._bNoTopLabels=t.length===0&&i.length===0};c.prototype._normalizePoints=function(){var e=this._minXScale,t=this._maxXScale,i=this._minYScale,a=this._maxYScale;if(jQuery.isNumeric(this.getMinXValue())){this._minXScale=this.getMinXValue();if(!jQuery.isNumeric(this.getMaxXValue())&&this._minXScale>t){o.error("Property minXValue of LineMicroChart must be smaller to at least one X value of the points aggregation if property maxXValue is not set")}}if(jQuery.isNumeric(this.getMaxXValue())){this._maxXScale=this.getMaxXValue();if(!jQuery.isNumeric(this.getMinXValue())&&this._maxXScale<e){o.error("Property maxXValue of LineMicroChart must be greater to at least one X value of the points aggregation if property minXValue is not set")}}if(jQuery.isNumeric(this.getMinYValue())){this._minYScale=this.getMinYValue();if(!jQuery.isNumeric(this.getMaxYValue())&&this._minYScale>a){o.error("Property minYValue of LineMicroChart must be greater to threshold or at least one Y value of the points aggregation if property maxYValue is not set")}}if(jQuery.isNumeric(this.getMaxYValue())){this._maxYScale=this.getMaxYValue();if(!jQuery.isNumeric(this.getMinYValue())&&this._maxYScale<i){o.error("Property maxYValue of LineMicroChart must be smaller to threshold or at least one Y value of the points aggregation if property minYValue is not set")}}if(this.getMaxYValue()<this.getMinYValue()){o.error("Property maxYValue of LineMicroChart must not be smaller to minYValue")}if(this.getMaxXValue()<this.getMinXValue()){o.error("Property maxXValue of LineMicroChart must not be smaller to minXValue")}var s,r=this._maxXScale-this._minXScale,l=this._maxYScale-this._minYScale,n,h;this._bScalingValid=r>=0&&l>=0;if(this._bScalingValid){this._getLines().forEach(function(e){s=e._getPoints();e._aNormalizedPoints=[];for(var t=0;t<s.length;t++){if(this._minXScale===this._maxXScale&&s[t].getX()===this._maxXScale){n=50}else{n=(s[t].getX()-this._minXScale)/r*100}if(this._minYScale===this._maxYScale&&s[t].getY()===this._maxYScale){h=50}else{h=(s[t].getY()-this._minYScale)/l*100}e._aNormalizedPoints.push({x:n,y:h})}},this);this._fNormalizedThreshold=(this.getThreshold()-this._minYScale)/l*100}};c.prototype._onResize=function(){var e=this.$(),t=parseInt(e.width()),i=parseInt(e.height()),a=e.find(".sapSuiteLMCLeftTopLabel, .sapSuiteLMCRightTopLabel"),o=e.find(".sapSuiteLMCThresholdLabel");e.removeClass("sapSuiteLMCNoLabels sapSuiteLMCLookM sapSuiteLMCLookS sapSuiteLMCLookXS");if(t<=this.convertRemToPixels(c.THRESHOLD_WIDTH_NO_LABEL)){e.addClass("sapSuiteLMCNoLabels")}if(this.getShowTopLabels()){e.removeClass("sapSuiteLMCNoTopLabels")}if(this.getShowBottomLabels()){e.removeClass("sapSuiteLMCNoBottomLabels")}if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_S)){e.addClass("sapSuiteLMCLookXS")}else if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_M)){e.addClass("sapSuiteLMCLookS")}else if(i<this.convertRemToPixels(c.THRESHOLD_LOOK_L)){e.addClass("sapSuiteLMCLookM")}if(this.getShowThresholdValue()){e.removeClass("sapSuiteLMCNoThresholdLabel")}if(this._isAnyLabelTruncated(a)){e.addClass("sapSuiteLMCNoTopLabels")}if(this._isAnyLabelTruncated(o)){e.addClass("sapSuiteLMCNoThresholdLabel")}this._adjustThresholdLabelPos()};c.prototype._adjustThresholdLabelPos=function(){var e=this.$();var t=e.find(".sapSuiteLMCThresholdLabelWrapper").height();var i=e.find(".sapSuiteLMCThresholdLabel");var a=i.outerHeight();var o=t*(100-this._fNormalizedThreshold)*.01;var s=o-a/2;if(s<0){s=0}else if(s+a>t){s=t-a}i.css("top",s*100/t+"%")};c.prototype._getAltHeaderText=function(e){var t=this._oRb.getText("LINEMICROCHART");if(e){t+=" "+this._oRb.getText("IS_ACTIVE")}t+="\n";if(!this._hasData()){t+=this._oRb.getText("NO_DATA");return t}var i=this.getLeftTopLabel();var a=this.getLeftBottomLabel();var o=this.getRightTopLabel();var s=this.getRightBottomLabel();var r=true;if(i||a){t+=this._oRb.getText("LINEMICROCHART_START")+": "+a+" "+i;r=false}if(o||s){t+=(r?"":"\n")+this._oRb.getText("LINEMICROCHART_END")+": "+s+" "+o}return t};c.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString())}};c.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title")}};c.prototype._bindMouseEnterLeaveHandler=function(){this.$().on("mouseenter.tooltip",this._addTitleAttribute.bind(this));this.$().on("mouseleave.tooltip",this._removeTitleAttribute.bind(this))};c.prototype._unbindMouseEnterLeaveHandler=function(){this.$().off("mouseenter.tooltip");this.$().off("mouseleave.tooltip")};c.prototype._deregisterResizeHandler=function(){if(this._sResizeHandlerId){i.deregister(this._sResizeHandlerId);this._sResizeHandlerId=null}};c.prototype._hasData=function(){return this._getLines().length>0};c.prototype.firePress=function(){if(this._hasData()){t.prototype.fireEvent.call(this,"press",arguments)}};s.extendMicroChart(c);return c});
//# sourceMappingURL=LineMicroChart.js.map