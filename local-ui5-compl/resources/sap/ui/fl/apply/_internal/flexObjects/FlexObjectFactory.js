/* !
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_pick","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/ui/fl/apply/_internal/flexObjects/AnnotationChange","sap/ui/fl/apply/_internal/flexObjects/AppDescriptorChange","sap/ui/fl/apply/_internal/flexObjects/CompVariant","sap/ui/fl/apply/_internal/flexObjects/ControllerExtensionChange","sap/ui/fl/apply/_internal/flexObjects/FlexObject","sap/ui/fl/apply/_internal/flexObjects/FlVariant","sap/ui/fl/apply/_internal/flexObjects/getVariantAuthor","sap/ui/fl/apply/_internal/flexObjects/States","sap/ui/fl/apply/_internal/flexObjects/UIChange","sap/ui/fl/apply/_internal/flexObjects/UpdatableChange","sap/ui/fl/registry/Settings","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/Utils"],function(e,t,n,a,r,o,i,c,s,l,p,u,f,m,y,g,O){"use strict";const C={COMP_VARIANT_OBJECT:o,FL_VARIANT_OBJECT:s,CONTROLLER_EXTENSION:i,APP_DESCRIPTOR_CHANGE:r,ANNOTATION_CHANGE:a,UI_CHANGE:u,UPDATABLE_CHANGE:f};function d(e){return t(e)?{...e}:e}function N(e){if(e.fileType==="variant"){return C.COMP_VARIANT_OBJECT}else if(e.fileType==="ctrl_variant"){return C.FL_VARIANT_OBJECT}else if(e.changeType==="codeExt"){return C.CONTROLLER_EXTENSION}else if(e.appDescriptorChange){return C.APP_DESCRIPTOR_CHANGE}else if(e.fileType==="annotation_change"){return C.ANNOTATION_CHANGE}else if(e.fileType==="change"&&e.changeType==="defaultVariant"){return C.UPDATABLE_CHANGE}return C.UI_CHANGE}function x(e){const t=d(e);const n=t.type||t.changeType;let a=t.fileName||t.id;if(!a){a=O.createDefaultFileName(n);if(a.length>64){throw Error(`File name '${a}' must not exceed 64 characters`)}}const r=t.user||(!g.isDeveloperLayer(t.layer)?m.getInstanceOrUndef()&&m.getInstanceOrUndef().getUserId():undefined);return{id:a,adaptationId:t.adaptationId,layer:t.layer,content:d(t.content),texts:d(t.texts),supportInformation:{service:t.ODataService,oDataInformation:d(t.oDataInformation),command:t.command,compositeCommand:t.compositeCommand,generator:t.generator,sourceChangeFileName:t.support&&t.support.sourceChangeFileName,sourceSystem:t.sourceSystem,sourceClient:t.sourceClient,originalLanguage:t.originalLanguage,user:r},flexObjectMetadata:{changeType:n,reference:t.reference,packageName:t.packageName,projectId:t.projectId}}}const E={};E.createFromFileContent=function(e,t,a){const r={...e};var o=t||N(r);if(!o){throw new Error("Unknown file type")}r.support={generator:"FlexObjectFactory.createFromFileContent",...r.support||{}};const i=o.getMappingInfo();const s=c.mapFileContent(r,i);const l=Object.entries(s).reduce(function(e,t){n.set(t[0].split("."),t[1],e);return e},{});const u=new o(l);if(a){u.setProperty("state",p.LifecycleState.PERSISTED)}return u};E.createUIChange=function(e){e.packageName||="$TMP";const t=x(e);t.layer||=e.isUserDependent?y.USER:g.getCurrentLayer();t.selector=e.selector;t.jsOnly=e.jsOnly;t.variantReference=e.variantReference;t.isChangeOnStandardVariant=e.isChangeOnStandardVariant;t.fileType=e.fileType||"change";return new u(t)};E.createAppDescriptorChange=function(e){e.compositeCommand||=e.support&&e.support.compositeCommand;if(!(e.fileName||e.id)){const t=e.type||e.changeType;e.fileName=O.createDefaultFileName(t).substring(0,64)}const t=x(e);return new r(t)};E.createAnnotationChange=function(e){e.compositeCommand||=e.support&&e.support.compositeCommand;const t=x(e);t.serviceUrl=e.serviceUrl;return new a(t)};E.createControllerExtensionChange=function(e){e.generator||="FlexObjectFactory.createControllerExtensionChange";e.changeType="codeExt";e.content={codeRef:e.codeRef};const t=x(e);t.flexObjectMetadata.moduleName=e.moduleName;t.controllerName=e.controllerName;return new i(t)};E.createFlVariant=function(e){const t=d(e);t.generator||="FlexObjectFactory.createFlVariant";const n=x(t);n.variantManagementReference=t.variantManagementReference;n.variantReference=t.variantReference;n.contexts=t.contexts;n.texts={variantName:{value:t.variantName,type:"XFLD"}};n.author=l(n.supportInformation.user,n.layer,t.authors);return new s(n)};E.createCompVariant=function(e,t){const a=d(e);a.generator||="FlexObjectFactory.createCompVariant";a.user=n.get("support.user",a);const r=x(a);r.variantId=a.variantId||r.id;r.contexts=a.contexts;r.favorite=a.favorite;r.persisted=a.persisted;r.persistencyKey=a.persistencyKey||n.get("selector.persistencyKey",a);if(a.layer===y.VENDOR||a.layer===y.CUSTOMER_BASE){r.favorite=true}if(a.executeOnSelection!==undefined){r.executeOnSelection=a.executeOnSelection}else{r.executeOnSelection=r.content&&(r.content.executeOnSelect||r.content.executeOnSelection)}r.author=l(r.supportInformation.user,r.layer,t);return new o(r)};return E});
//# sourceMappingURL=FlexObjectFactory.js.map