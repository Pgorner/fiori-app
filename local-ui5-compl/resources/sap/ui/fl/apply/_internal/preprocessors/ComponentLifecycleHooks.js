/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Component","sap/ui/core/Lib","sap/ui/fl/apply/_internal/changes/descriptor/Applier","sap/ui/fl/apply/_internal/changes/descriptor/ApplyStrategyFactory","sap/ui/fl/apply/_internal/changes/Applier","sap/ui/fl/apply/_internal/flexState/FlexState","sap/ui/fl/apply/_internal/flexState/ManifestUtils","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/ui/fl/initial/_internal/changeHandlers/ChangeHandlerRegistration","sap/ui/fl/variants/VariantModel","sap/ui/fl/FlexControllerFactory","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/model/json/JSONModel","sap/ui/model/odata/ODataUtils","sap/ui/performance/Measurement"],function(e,n,t,o,a,i,r,s,l,c,p,g,f,d,u,m,C){"use strict";var h={};h._componentInstantiationPromises=new WeakMap;var y={};function v(n){if(d.getUshellContainer()){return Promise.resolve()}var o=window.sessionStorage.getItem(`sap.ui.rta.restart.${f.CUSTOMER}`);if(o){var a=s.getFlexReferenceForControl(n);if(o!==a&&o!=="true"){e.error(`an application component was started which does not match the component for which the restart was triggered:\n\t\t\t\t\tTriggering component: ${o}\n\t\t\t\t\tStarted component: ${a}`);return Promise.resolve()}return new Promise(function(e,o){Promise.all([t.load({name:"sap.ui.rta"}),n.rootControlLoaded()]).then(function(){sap.ui.require(["sap/ui/rta/api/startKeyUserAdaptation"],function(t){t({rootControl:n});e()})}).catch(function(e){o(e)})})}return Promise.resolve()}function M(e){const n=s.getFlexReferenceForControl(e);const t=r.getStorageResponse(n);if(t.messagebundle&&!e.getModel("i18nFlexVendor")&&t.changes?.changes?.some(e=>e.layer===f.VENDOR)){e.setModel(new u(t.messagebundle),"i18nFlexVendor")}}async function w(e){var n=g.createForControl(e);const t=s.getFlexReferenceForControl(e);var o;var a=i.applyAllChangesForControl.bind(i,e,t);a._bIsSapUiFlFlexControllerApplyChangesOnControl=true;e.addPropagationListener(a);o=h._createVariantModel(n,e);await o.initialize();C.end("flexProcessing");e.setModel(o,l.getVariantModelName());await v(e)}function F(e,n){if(d.isApplicationComponent(e)){var t=e.getId();var o=r.initialize({componentId:t,asyncHints:n.asyncHints}).then(w.bind(this,e)).then(M.bind(this,e)).then(function(){if(y[t]){y[t].forEach(function(n){var t=e.getModel(l.getVariantModelName());n.setModel(t,l.getVariantModelName())});delete y[t]}});h._componentInstantiationPromises.set(e,o);return o}else if(d.isEmbeddedComponent(e)){var a=d.getAppComponentForControl(e);if(h._componentInstantiationPromises.has(a)){return h._componentInstantiationPromises.get(a).then(function(){var n=a.getModel(l.getVariantModelName());e.setModel(n,l.getVariantModelName())})}y[a.getId()]=y[a.getId()]||[];y[a.getId()].push(e);return Promise.resolve()}return Promise.resolve()}function P(e,n){if(!d.isApplication(n)||!e.id){return Promise.resolve()}r.initialize({componentData:e.componentData||e.settings&&e.settings.componentData,asyncHints:e.asyncHints,manifest:n,componentId:e.id});return o.applyChangesIncludedInManifest(n,a.getRuntimeStrategy())}h._createVariantModel=function(e,n){return new p({},{flexController:e,appComponent:n})};h.instanceCreatedHook=function(...e){return F(...e)};h.componentLoadedHook=function(...e){return P(...e)};async function I(e){const t=e.owner&&n.get(e.owner.id);const o=e.owner?.id||e.factoryConfig.id||e.factoryConfig.settings?.id;const a=t?.getComponentData()||e.factoryConfig.componentData||e.factoryConfig.settings?.componentData;const i=s.getFlexReference({manifest:t?.getManifest()||e.manifest,componentData:a});await r.initialize({componentData:a,asyncHints:e.owner?.config.asyncHints||e.factoryConfig.asyncHints,componentId:o,reference:i});const l=m.removeOriginSegmentParameters(e.model.getServiceUrl());const p=r.getAnnotationChanges(i).filter(e=>e.getServiceUrl()===l);const g=[];for(const e of p){const n=await c.getAnnotationChangeHandler({changeType:e.getChangeType()});g.push(await n.applyChange(e))}return g}h.modelCreatedHook=function(e){e.model.setAnnotationChangePromise(I(e))};return h});
//# sourceMappingURL=ComponentLifecycleHooks.js.map