/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/core/Control","./Scene","./ContentResource","./ContentConnector","./dvl/ContentManager","./FlexibleControl","sap/m/VBox","sap/m/FlexItemData","sap/ui/layout/Splitter","sap/ui/layout/SplitterLayoutData","./DvlException","./Messages","sap/m/ProgressIndicator","./Notifications","./ViewStateManager","./Toolbar","./SceneTree","./StepNavigation","./ViewGallery","./ViewManager","./AnimationPlayer","./Viewport","./NativeViewport","./RedlineDesign","./ViewerRenderer","./SelectionMode","./DrawerToolbar","./getResourceBundle","./cssColorToColor","./colorToCSSColor","./abgrToColor","./colorToABGR","sap/base/Log","sap/base/i18n/Localization"],function(e,t,i,n,o,s,r,a,l,p,h,c,u,g,d,v,_,f,w,y,m,S,b,V,C,T,P,R,E,M,I,N,A,D,L,z){"use strict";var k=i.extend("sap.ui.vk.Viewer",{metadata:{library:"sap.ui.vk",properties:{enableOverlay:{type:"boolean",defaultValue:false},enableSceneTree:{type:"boolean",defaultValue:true},showSceneTree:{type:"boolean",defaultValue:true},enableStepNavigation:{type:"boolean",defaultValue:true},enableNotifications:{type:"boolean",defaultValue:true},showStepNavigation:{type:"boolean",defaultValue:false},showStepNavigationThumbnails:{type:"boolean",defaultValue:true},overlayStepNavigation:{type:"boolean",defaultValue:false},enableToolbar:{type:"boolean",defaultValue:true},enableProgressIndicator:{type:"boolean",defaultValue:true},showDrawerToolbar:{type:"boolean",defaultValue:true},enableMiniMap:{type:"boolean",defaultValue:true},showMiniMap:{type:"boolean",defaultValue:false},width:{type:"sap.ui.core.CSSSize",defaultValue:null},height:{type:"sap.ui.core.CSSSize",defaultValue:null},toolbarTitle:{type:"string",defaultValue:""},shouldTrackVisibilityChanges:{type:"boolean",defaultValue:false},recursiveSelection:{type:"boolean",defaultValue:false},runtimeSettings:{type:"object",defaultValue:{}},webGLContextAttributes:{type:"object",defaultValue:{antialias:true,alpha:true,premultipliedAlpha:false}},showAllHotspots:{type:"boolean",defaultValue:false},hotspotColorABGR:{type:"int",defaultValue:3221225727},hotspotColor:{type:"sap.ui.core.CSSColor",defaultValue:"rgba(255, 0, 0, 0.7529411764705882)"}},aggregations:{contentResources:{type:"sap.ui.vk.ContentResource",forwarding:{getter:"_getContentConnector",aggregation:"contentResources"}},overlay:{type:"sap.ui.vk.Overlay",multiple:false},progressIndicator:{type:"sap.m.ProgressIndicator",multiple:false,visibility:"hidden"},layout:{type:"sap.m.VBox",multiple:false,visibility:"hidden"},contentConnector:{type:"sap.ui.vk.ContentConnector",multiple:false,visibility:"hidden"},viewStateManager:{type:"sap.ui.vk.ViewStateManager",multiple:false,visibility:"hidden"}},defaultAggregation:"contentResources",events:{contentResourceChangesProcessed:{},sceneLoadingSucceeded:{parameters:{scene:{type:"sap.ui.vk.Scene"}}},sceneLoadingFailed:{parameters:{reason:{type:"object"}}},sceneDestroying:{parameters:{scene:{type:"sap.ui.vk.Scene"},preventGarbageCollection:{type:"function"}}},selectionChanged:{parameters:{selected:{type:"any[]"},unselected:{type:"any[]"}}},fullScreen:{parameters:{isFullScreen:{type:"boolean"}}},urlClicked:{parameters:{nodeRef:"any",url:"string"}},nodeClicked:{parameters:{nodeRef:"any",x:"int",y:"int"}}}}});k.prototype.applySettings=function(e){this._inApplySettings=true;i.prototype.applySettings.apply(this,arguments);delete this._inApplySettings;if(this._viewStateManager){this._viewStateManager.setShouldTrackVisibilityChanges(this.getShouldTrackVisibilityChanges());this._viewStateManager.setRecursiveSelection(this.getRecursiveSelection())}this._componentsState={sceneTree:{defaultEnable:this.getEnableSceneTree(),shouldBeEnabled:true,userInteractionShow:this.getShowSceneTree()},stepNavigation:{defaultEnable:this.getEnableStepNavigation(),userInteractionShow:this.getShowStepNavigation()},miniMap:{defaultEnable:this.getEnableMiniMap(),userInteractionShow:this.getShowMiniMap()},progressIndicator:{defaultEnable:this.getEnableProgressIndicator()},messagePopover:{defaultEnable:this.getEnableNotifications()}};this.setEnableSceneTree(false);this.setEnableStepNavigation(false)};k.prototype.init=function(){if(i.prototype.init){i.prototype.init.apply(this)}this._contentConnector=new s(this.getId()+"-contentconnector");this.setAggregation("contentConnector",this._contentConnector);this._contentConnector.attachContentReplaced(this._handleContentReplaced,this);this._contentConnector.attachContentChangesStarted(this._handleContentChangesStarted,this);this._contentConnector.attachContentChangesFinished(this._handleContentChangesFinished,this);this._contentConnector.attachContentChangesProgress(this._handleContentChangesProgress,this);this._viewStateManager=new _(this.getId()+"-viewstatemanager",{contentConnector:this._contentConnector});this.setAggregation("viewStateManager",this._viewStateManager);L.debug("sap.ui.vk.Viewer.init() called.");this._animationPlayer=new b({viewStateManager:this._viewStateManager});this._viewManager=new S({contentConnector:this._contentConnector,animationPlayer:this._animationPlayer});this._viewStateManager.setViewManager(this._viewManager);this._mainScene=null;this._busyIndicatorCounter=0;this._viewport=null;this._nativeViewport=null;this._redlineDesign=null;this._stepNavigation=null;this._sceneTree=null;this._drawerToolbar=null;this._overlayManager={initialized:false,changed:false,control:null,onNativeViewportMove:function(e){var t=e.getParameter("pan");var i=e.getParameter("zoom");this.control.setPanAndZoom(t.x,t.y,i)},onViewportZoom:function(e){var t=e.getParameter("zoomFactor");this.control.setPanAndZoom(0,0,t)},onViewportPan:function(e){var t=e.getParameter("dx");var i=e.getParameter("dy");this.control.setPanAndZoom(t,i,1)}};this._overlayManager.delegate={onAfterRendering:this._onAfterRenderingOverlay.bind(this,this._viewport,this._nativeViewport,this._overlayManager)};this._toolbar=new f({title:this.getToolbarTitle(),visible:this.getEnableToolbar(),viewer:this});this._stackedViewport=new a(this.getId()+"-stackedViewport",{width:"100%",height:"100%",layout:"Stacked",layoutData:new c({size:"auto",minSize:200})});this._splitter=new h(this.getId()+"-splitter",{layoutData:new p({growFactor:1,minHeight:"200px"}),contentAreas:[this._stackedViewport]}).addStyleClass("sapUiVizKitSplitter");this._messagePopover=new v(`${this.getId()}-notifications`,{visible:true});this._messagePopover.attachAllMessagesCleared(this._updateLayout,this);this._messagePopover.attachMessageAdded(this._updateLayout,this);this._layout=new l(this.getId()+"-vbox",{height:"100%",items:[this._toolbar,this._splitter,this._messagePopover]}).addStyleClass("sapUiVizKitLayout");this.setAggregation("layout",this._layout);this.setTooltip(M().getText("VIEWER_TITLE"));if(this.getEnableProgressIndicator()){this._progressIndicator=new d({displayAnimation:false,displayOnly:true,visible:false}).addStyleClass("sapUiVizKitProgressIndicator");this.setAggregation("progressIndicator",this._progressIndicator)}z.attachChange(this._onLocalizationChanged)};k.prototype.exit=function(){L.debug("sap.ui.vk.Viewer.exit() called.");z.detachChange(this._onLocalizationChanged);if(this._viewport){this._viewport.detachEvent("viewActivated",this._onViewportViewActivated,this);this._viewport.destroy();this._viewport=null}if(this._nativeViewport){this._nativeViewport.destroy();this._nativeViewport=null}this._setMainScene(null);this._toolbar=null;this._messagePopover=null;this._sceneTree=null;this._stepNavigation=null;this._drawerToolbar=null;this._componentsState=null;this._viewStateManager=null;this._contentConnector=null;this._viewManager=null;if(i.prototype.exit){i.prototype.exit.apply(this)}};k.prototype._setMainScene=function(e){if(e instanceof n){if(e!==this._mainScene){this._mainScene=e;this._showViewport();if(this._componentsState.sceneTree.defaultEnable){this._instantiateSceneTree();this.setEnableSceneTree(true);if(this._componentsState.sceneTree.userInteractionShow&&this._componentsState.sceneTree.shouldBeEnabled){this.setShowSceneTree(true);this._sceneTree.setVisible(true)}else{this.setShowSceneTree(false)}}else if(this._sceneTree&&this._viewStateManager){this._sceneTree.setScene(e,this._viewStateManager)}this.setEnableStepNavigation(this.getEnableStepNavigation()||this._componentsState.stepNavigation.defaultEnable);if(this.getEnableStepNavigation()){this._instantiateStepNavigation();this.setShowStepNavigation(this._componentsState.stepNavigation.userInteractionShow)}}if(this._stepNavigation){this._stepNavigation.refresh(e)}}else{this._mainScene=null;this.setEnableSceneTree(false);this.setEnableStepNavigation(false)}return this};k.prototype.getGraphicsCore=function(){return this._mainScene instanceof e.dvl.Scene?this._mainScene.getGraphicsCore():null};k.prototype.getScene=function(){return this._mainScene};k.prototype.getViewStateManager=function(){return this._viewStateManager};k.prototype.getViewport=function(){if(!this._viewport){this._viewport=new V(this.getId()+"-viewport",{viewStateManager:this._viewStateManager,selectionMode:R.Exclusive,contentConnector:this._contentConnector});this._viewport.attachEvent("viewActivated",this._onViewportViewActivated,this);this._drawerToolbar=new E({visible:this.getShowDrawerToolbar(),expanded:true,viewport:this._viewport});this._viewport.addContent(this._drawerToolbar)}return this._viewport};k.prototype.getNativeViewport=function(){if(this._nativeViewport){return this._nativeViewport}var t=this.getViewport().getImplementation();return t instanceof e.NativeViewport?t:null};k.prototype.getToolbar=function(){return this._toolbar};k.prototype.getSceneTree=function(){return this._sceneTree};k.prototype.getRedlineDesign=function(){return this._redlineDesign};k.prototype.getOverlay=function(){return this._overlayManager.control};k.prototype.setEnableOverlay=function(e){if(e!==this.getProperty("enableOverlay")){this.setProperty("enableOverlay",e);this._overlayManager.changed=true}return this};k.prototype.setEnableSceneTree=function(e){this.setProperty("enableSceneTree",e,true);if(!e){this.setProperty("showSceneTree",false)}this._updateLayout();return this};k.prototype.setEnableNotifications=function(e){this.setProperty("enableNotifications",e,true);this._messagePopover.setVisible(false);this._updateLayout();return this};k.prototype.setShowSceneTree=function(e){this.setProperty("showSceneTree",e,true);this._updateLayout();return this};k.prototype.setEnableStepNavigation=function(e){this.setProperty("enableStepNavigation",e,true);if(!e){this.setProperty("showStepNavigation",false)}this._updateLayout();return this};k.prototype.setShowStepNavigation=function(e){this.setProperty("showStepNavigation",e,true);this._updateLayout();return this};k.prototype.setShowMiniMap=function(e){this.setProperty("showMiniMap",e,true);this._updateLayout();return this};k.prototype.getEnableMiniMap=function(){return this.getProperty("enableMiniMap")&&this._viewport?.getImplementation()?.getMetadata().getName()==="sap.ui.vk.svg.Viewport"};k.prototype.setEnableToolbar=function(e){this.setProperty("enableToolbar",e,true);this._toolbar.setVisible(e);return this};k.prototype.setShowDrawerToolbar=function(e){this.setProperty("showDrawerToolbar",e,true);if(this._drawerToolbar){this._drawerToolbar.setVisible(e)}return this};k.prototype.setRecursiveSelection=function(e){this.setProperty("recursiveSelection",e,true);if(this._viewStateManager){this._viewStateManager.setRecursiveSelection(e)}return this};k.prototype.setToolbarTitle=function(e){this.setProperty("toolbarTitle",e);this._toolbar.setTitle(e);return this};k.prototype.activateFullScreenMode=function(e){var t=function(e){return!!(e.fullScreen||e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement)};if(e){if(!t(document)){if(!this._fullScreenHandler){var i=this;this._fullScreenHandler=function(e){var n=t(document);if(!n){i.removeStyleClass("sapVizKitViewerFullScreen");document.removeEventListener("fullscreenchange",i._fullScreenHandler);document.removeEventListener("mozfullscreenchange",i._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",i._fullScreenHandler);document.removeEventListener("MSFullscreenChange",i._fullScreenHandler)}i.fireFullScreen({isFullScreen:n})}}var n=document.getElementsByClassName("sapVizKitViewer");var o=document.getElementsByTagName("body")[0];if(n.length){var s=this.getViewport().getDomRef();for(var r=0;r<n.length;++r){if(n[r].contains(s)){o=n[r];break}}}else{return this}if(o.requestFullScreen){document.addEventListener("fullscreenchange",this._fullScreenHandler);o.requestFullScreen()}else if(o.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",this._fullScreenHandler);o.webkitRequestFullScreen()}else if(o.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",this._fullScreenHandler);o.mozRequestFullScreen()}else if(o.msRequestFullscreen){document.addEventListener("MSFullscreenChange",this._fullScreenHandler);o.msRequestFullscreen()}}this.addStyleClass("sapVizKitViewerFullScreen")}else{if(t(document)){if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}this.removeStyleClass("sapVizKitViewerFullScreen")}return this};k.prototype.getShowAllHotspots=function(){var e=this.getViewport().getImplementation();return e?e.getShowAllHotspots():this.getProperty("showAllHotspots")};k.prototype.setShowAllHotspots=function(e){this.setProperty("showAllHotspots",e,true);var t=this.getViewport().getImplementation();if(t){t.setShowAllHotspots(e)}return this};k.prototype.getHotspotColorABGR=function(){var e=this.getViewport().getImplementation();return e?e.getHotspotColorABGR():this.getProperty("hotspotColorABGR")};k.prototype.setHotspotColorABGR=function(e){this.setProperty("hotspotColorABGR",e,true);this.setProperty("hotspotColor",N(A(e)),true);var t=this.getViewport().getImplementation();if(t){t.setHotspotColorABGR(e)}return this};k.prototype.getHotspotColor=function(){var e=this.getViewport().getImplementation();return e?e.getHotspotColor():this.getProperty("hotspotColor")};k.prototype.setHotspotColor=function(e){this.setProperty("hotspotColor",e,true);this.setProperty("hotspotColorABGR",D(I(e)),true);var t=this.getViewport().getImplementation();if(t){t.setHotspotColor(e)}return this};k.prototype.setRuntimeSettings=function(e){if(this._inApplySettings){this.setProperty("runtimeSettings",e,true);r.setRuntimeSettings(e)}else{L.error(M().getText(g.VIT29.summary),g.VIT29.code,"sap.ui.vk.Viewer")}return this};k.prototype.setWebGLContextAttributes=function(e){if(this._inApplySettings){this.setProperty("webGLContextAttributes",e,true);r.setWebGLContextAttributes(e)}else{L.error(M().getText(g.VIT30.summary),g.VIT30.code,"sap.ui.vk.Viewer")}return this};k.prototype.invalidate=function(e){if(e instanceof o){this._contentConnector.invalidate(e);return}i.prototype.invalidate.apply(this,arguments)};k.prototype._getContentConnector=function(){return this._contentConnector};k.prototype.onBeforeRendering=function(){this._showOverlay()};k.prototype.isTreeBinding=function(e){return e==="contentResources"};k.prototype.setBusy=function(e){if(e){if(this._busyIndicatorCounter===0){this.setBusyIndicatorDelay(0);i.prototype.setBusy.call(this,true)}this._busyIndicatorCounter+=1}else{this._busyIndicatorCounter-=1;if(this._busyIndicatorCounter==0){i.prototype.setBusy.call(this,false)}}};k.prototype._updateLayout=function(){if(this._sceneTree){if(this.getShowSceneTree()&&this.getEnableSceneTree()){this._sceneTree.setVisible(true);if(this._splitter.indexOfContentArea(this._sceneTree)<0){this._splitter.insertContentArea(this._sceneTree,0)}}else{if(this._splitter.indexOfContentArea(this._sceneTree)>=0){this._splitter.removeContentArea(this._sceneTree)}this._sceneTree.setVisible(false)}}if(this._stepNavigation){this._stepNavigation.setVisible(this.getShowStepNavigation()&&this.getEnableStepNavigation())}if(this._messagePopover){this._messagePopover.setVisible(this.getEnableNotifications()&&this._messagePopover.getAggregation("_messagePopover").getItems().length>0)}if(this._toolbar){this._toolbar.refresh()}if(this.getEnableMiniMap()){this._viewport.getImplementation().getMiniMap()[this.getShowMiniMap()?"open":"close"]()}};k.prototype._instantiateSceneTree=function(){if(!this._sceneTree){this._sceneTree=new w({layoutData:new c({size:"320px",minSize:200}),viewStateManager:this._viewStateManager,contentConnector:this._contentConnector})}return this};k.prototype._instantiateStepNavigation=function(){if(this._stepNavigation){this._layout.removeItem(this._stepNavigation);this._viewport.removeContent(this._stepNavigation);this._splitter.detachResize(this._handleSplitterResize,this);this._stepNavigation.destroy();this._stepNavigation=null}var e=this._mainScene.getMetadata().getName();if(e==="sap.ui.vk.dvl.Scene"){this._stepNavigation=new y({showThumbnails:this.getShowStepNavigationThumbnails(),contentConnector:this._contentConnector});this._layout.insertItem(this._stepNavigation,3)}if(this._stepNavigation==null&&(e==="sap.ui.vk.threejs.Scene"||e==="sap.ui.vk.svg.Scene")){this._stepNavigation=new m({host:this.getViewport(),contentConnector:this._contentConnector,viewManager:this._viewManager});if(!this.getOverlayStepNavigation()){this._layout.insertItem(this._stepNavigation,3)}else{this._stepNavigation.addStyleClass("sapVizKitViewGallery");this._viewport.addContent(this._stepNavigation);this._splitter.attachResize(this._handleSplitterResize,this)}this._stepNavigation.setAnimationPlayer(this._animationPlayer)}return this};k.prototype._handleSplitterResize=function(){this._stepNavigation.resizeToolbarSpacer()};k.prototype._showViewport=function(){var e=this.getViewport().getImplementation();if(e){e.setHotspotColor(this.getProperty("hotspotColor"));e.setHotspotColorABGR(this.getProperty("hotspotColorABGR"));e.setShowAllHotspots(this.getProperty("showAllHotspots"))}if(this._nativeViewport){this._nativeViewport.setVisible(false)}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._viewport);this._viewport.setVisible(true);return this};k.prototype._showNativeViewport=function(){if(!this._nativeViewport){this._nativeViewport=new C(this.getId()+"-nativeViewport",{limitZoomOut:true,contentConnector:this._contentConnector})}if(this._viewport){this._viewport.setVisible(false)}this._stackedViewport.removeAllContent();this._stackedViewport.addContent(this._nativeViewport);this._nativeViewport.setVisible(true);return this};k.prototype._showOverlay=function(){var e=this._overlayManager;if(e.changed){var t;if(this.getEnableOverlay()){sap.ui.require(["sap/ui/vk/Overlay"],function(i){if(!e.initialized){if(!(t=this.getAggregation("overlay"))){t=new i}t.setZoomOnResize(false);e.control=t;e.initialized=true}else{t=e.control;t.reset()}if(this._nativeViewport&&this._nativeViewport.getVisible()){t.setTarget(this._nativeViewport);e.savedLimitZoomOutState=this._nativeViewport.getLimitZoomOut();this._nativeViewport.setLimitZoomOut(true);this._nativeViewport.attachEvent("move",e.onNativeViewportMove,e)}else if(this._viewport&&this._viewport.getVisible()){t.setTarget(this._viewport);e.savedLimitZoomOutState=false;this._viewport.attachEvent("zoom",e.onViewportZoom,e);this._viewport.attachEvent("pan",e.onViewportPan,e)}this._stackedViewport.addContent(t);this._stackedViewport.addDelegate(e.delegate)}.bind(this))}else{this._nativeViewport.detachEvent("move",e.onNativeViewportMove,e);this._stackedViewport.removeDelegate(e.delegate);this._stackedViewport.removeContent(e.control);this._nativeViewport.setLimitZoomOut(e.savedLimitZoomOutState)}e.changed=false}};k.prototype._onAfterRenderingOverlay=function(e){var t=this._overlayManager.control.getDomRef();if(t&&(this._nativeViewport||this._viewport)){var i=this._nativeViewport&&this._nativeViewport.getVisible()?this._nativeViewport.getDomRef():this._viewport.getDomRef();if(t.parentNode!==i){t.parentNode.style.display="none"}i.appendChild(t);t.style.width="100%";t.style.height="100%"}};k.prototype.setDecryptionHandler=function(e){this._contentConnector.setDecryptionHandler(e);return this};k.prototype.setAuthorizationHandler=function(e){this._contentConnector.setAuthorizationHandler(e);return this};k.prototype.setConsumptionScenario=function(e){this._contentConnector.setConsumptionScenario(e);return this};k.prototype._instantiateRedlineDesign=function(e){var t=this.getViewport().getImplementation();if(t&&t.getVisible()){var i=t&&t.getVisible()?t:null;var n=i.getOutputSize();this._redlineDesign=new T({visible:false,virtualTop:n.top,virtualLeft:n.left,virtualSideLength:n.sideLength,redlineElements:e});this._redlineDesign._setTargetViewport(i)}return this};k.prototype.activateRedlineDesign=function(t){var i=this.getViewport().getImplementation();if(i._activateRedline){i._activateRedline()}else if(i instanceof e.threejs.Viewport){i._viewportGestureHandler._activateRedline()}t=t||[];this._instantiateRedlineDesign(t);this.getRedlineDesign().placeAt(this._stackedViewport);this.getRedlineDesign().setVisible(true);var n=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i.pan(t,n);i.endGesture()})};var o=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),o=e.getParameter("zoomFactor");i.queueCommand(function(){i.beginGesture(t,n);i.zoom(o);i.endGesture()})};var s=function(e){var t=e.getParameter("deltaX"),n=e.getParameter("deltaY");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.pan(t,n);i._viewportGestureHandler._cameraController.endGesture()})};var r=function(e){var t=e.getParameter("originX"),n=e.getParameter("originY"),o=e.getParameter("zoomFactor");i.queueCommand(function(){i._viewportGestureHandler._cameraController.beginGesture(t,n);i._viewportGestureHandler._cameraController.zoom(o);i._viewportGestureHandler._cameraController.endGesture()})};if((i instanceof e.NativeViewport||i instanceof e.dvl.Viewport)&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",n.bind(this));this.getRedlineDesign().attachEvent("zoom",o.bind(this))}else if(i instanceof e.threejs.Viewport&&i.getVisible()){this.getRedlineDesign().attachEvent("pan",s.bind(this));this.getRedlineDesign().attachEvent("zoom",r.bind(this))}else{L.error("Error: Viewport not supported")}return this};k.prototype.destroyRedlineDesign=function(){if(this.getRedlineDesign()){var t=this.getViewport().getImplementation();if(t._deactivateRedline){t._deactivateRedline()}else if(t instanceof e.threejs.Viewport){t._viewportGestureHandler._deactivateRedline()}this.getRedlineDesign().destroy();this._redlineDesign=null}return this};k.prototype._onViewportViewActivated=function(e){this._componentsState.sceneTree.shouldBeEnabled=e.getParameter("type")==="3D"};k.prototype._removeProgressIndicator=function(){this._progressIndicator.setVisible(false);this._progressIndicator.setDisplayValue("");this._progressIndicator.setPercentValue(0);this._progressIndicator.rerender()};k.prototype._handleContentReplaced=function(e){var t=e.getParameter("newContent");if(t instanceof n||t instanceof HTMLImageElement||t instanceof HTMLObjectElement){this._showViewport();if(this.getRedlineDesign()){this.getRedlineDesign().updatePanningRatio()}this._setMainScene(t)}else{this._setMainScene(null);if(this._viewport){this._viewport.setVisible(false)}if(this._nativeViewport){this._nativeViewport.setVisible(false)}this._stackedViewport.removeAllContent()}};k.prototype._handleContentChangesStarted=function(e){this.setBusy(true);if(this._componentsState.progressIndicator.defaultEnable){this._progressIndicator.setPercentValue(0);this._progressIndicator.setVisible(true);this._progressIndicator.rerender()}};k.prototype._handleContentChangesFinished=function(e){L.info("Finished");this.setBusy(false);var t=e.getParameter("content");if(t){this.fireSceneLoadingSucceeded({scene:t})}var i=e.getParameter("failureReason");if(i){this.fireSceneLoadingFailed({reason:i});this._showNativeViewport();var n=M().getText("VIEWER_UNKNOWN_CONTENT_RESOURCE_TYPE_CAUSE");if(i.errorMessage===n){this._nativeViewport.loadFailed()}else{var o=M().getText("VIEWPORT_MESSAGEERRORLOADINGFILE");this._nativeViewport.loadFailed(o)}(Array.isArray(i)?i:[i]).forEach(function(e){L.error(M().getText(g.VIT13.summary),e.errorMessage,"sap.ui.vk.Viewer")})}if(i||this._progressIndicator.getPercentValue()===0){this._removeProgressIndicator()}this.fireContentResourceChangesProcessed();this._updateLayout()};var H=M().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE");k.prototype._handleContentChangesProgress=function(e){if(!this._progressIndicator.getVisible()){return}var t=e.getParameter("percentage");var i=e.getParameter("phase");this._progressIndicator.setPercentValue(t);this._progressIndicator.setDisplayValue(i+" / "+H+": "+(t?Math.floor(t)+"%":""));if(t>=100){this._removeProgressIndicator()}else{this._progressIndicator.rerender()}};k.prototype._handleContentDestroying=function(e){this.fireSceneDestroying({scene:e.getParameter("content").scene,preventGarbageCollection:e.getParameter("preventGarbageCollection")})};k.prototype._onLocalizationChanged=function(e){H=M().getText("PROGRESS_INDICATOR_TOTAL_PERCENT_DONE")};return k});
//# sourceMappingURL=Viewer.js.map