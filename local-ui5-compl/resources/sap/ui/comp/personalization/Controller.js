/*!
 * SAPUI5
 * (c) Copyright 2009-2024 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Element","sap/ui/core/Lib","sap/ui/thirdparty/jquery","sap/ui/base/ManagedObject","sap/m/library","sap/ui/comp/library","./ColumnsController","./FilterController","./GroupController","./SortController","./DimeasureController","./SelectionController","./Util","./ChartWrapper","./SelectionWrapper","./ColumnHelper","sap/m/MessageStrip","sap/m/P13nDialog","./Validator","sap/ui/model/json/JSONModel","sap/ui/Device","sap/ui/model/BindingMode","sap/ui/core/Lib"],function(t,e,n,jQuery,i,a,o,r,s,l,h,u,g,p,c,_,C,f,d,y,D,m,b,T){"use strict";var S=i.extend("sap.ui.comp.personalization.Controller",{constructor:function(t,e){i.apply(this,arguments)},metadata:{library:"sap.ui.comp",interfaces:["sap.m.p13n.modules.AdaptationProvider"],properties:{setting:{type:"object",defaultValue:{}},resetToInitialTableState:{type:"boolean",defaultValue:true},columnKeys:{type:"string[]",defaultValue:[]}},associations:{table:{type:"object",multiple:false}},events:{beforePotentialTableChange:{},afterPotentialTableChange:{},afterP13nModelDataChange:{parameters:{persistentData:{type:"object"},persistentDataChangeType:{type:"sap.ui.comp.personalization.ChangeType"},runtimeDeltaData:{type:"object"},runtimeDeltaDataChangeType:{type:"sap.ui.comp.personalization.ChangeType"}}},requestColumns:{parameters:{columnKeys:{type:"string"}}},dialogAfterClose:{parameters:{cancel:{type:"boolean"}}},dialogAfterOpen:{},dialogConfirmedReset:{}}}});S.prototype.applySettings=function(t){i.prototype.applySettings.apply(this,arguments);this._initialize()};S.prototype._initialize=function(){this._bInitCalled=true;var t,e=this.getTable();if(!e){throw"The table instance should be passed into constructor."}t=e.getParent();if(t&&t.isA("sap.ui.comp.smarttable.SmartTable")){this._aAvailablePanels=t._aAvailablePanels.map(function(t){return t.toLowerCase()})}this._createSettingCurrent(this.getSetting());var n=e.getColumns();if(!this.getColumnKeys().length){this.setProperty("columnKeys",p.getColumnKeys(n),true)}var i=this._createInternalModel(this.getColumnKeys());this._callControllers(this._oSettingCurrent,"initializeInternalModel",i);this._oColumnHelper=new C({callbackOnSetVisible:this._onSetVisible.bind(this),callbackOnSetSummed:this._onSetSummed.bind(this),callbackOnSetGrouped:e.fireGroup?this._onSetGrouped.bind(this):null});this._oColumnHelper.addColumns(n);this._callControllers(this._oSettingCurrent,"setColumnHelper",this._oColumnHelper);this._callControllers(this._oSettingCurrent,"setTriggerModelChangeOnColumnInvisible");this._callControllers(this._oSettingCurrent,"setTable",e);this._callControllers(this._oSettingCurrent,"setColumnKeys",this.getColumnKeys());this._callControllers(this._oSettingCurrent,"setIgnoreColumnKeys");this._callControllers(this._oSettingCurrent,"setStableColumnKeys");this._callControllers(this._oSettingCurrent,"checkConsistency");this._callControllers(this._oSettingCurrent,"calculateIgnoreData");var a=S._getOrderedColumnKeys(this._oColumnHelper.getColumnMap(),this.getColumnKeys());this._extendModelStructure(a);this._callControllers(this._oSettingCurrent,"calculateControlData");this._suspendTable();this._syncTableUi();this._resumeTable(true);this._fireChangeEvent()};S.prototype.init=function(){this._oDialog=null;this._bInitCalled=false;this._bSuspend=false;this._bUnconfirmedResetPressed=false;this._oColumnHelper=null;this._oSettingCurrent={}};S.prototype.setSetting=function(t){if(this._bInitCalled){throw"The setting instance should be passed only into constructor."}t=this.validateProperty("setting",t);this.setProperty("setting",t,true);return this};S.prototype.setResetToInitialTableState=function(t){if(this._bInitCalled){throw"The resetToInitialTableState property should be passed only into constructor."}t=this.validateProperty("resetToInitialTableState",t);this.setProperty("resetToInitialTableState",t,true);return this};S.prototype.setColumnKeys=function(e){if(this._bInitCalled){throw"The columnKeys array should be passed only into constructor."}e=this.validateProperty("columnKeys",e);var n=e.filter(function(n,i){var a=e.indexOf(n,i+1)>-1;if(a){t.warning("The provided columnKeys is inconsistent as columnKey "+n+" is not unique and therefore the duplicate entry is deleted from columnKeys.")}return!a});this.setProperty("columnKeys",n,true);return this};S.prototype.setTable=function(t){if(this._bInitCalled){throw"The table instance should be passed only into constructor."}this.setAssociation("table",t);return this};S.prototype._createSettingCurrent=function(t){var e=p.getTableType(this.getTable());var n,i;switch(e){case o.personalization.TableType.ChartWrapper:n=[a.P13nPanelType.dimeasure,a.P13nPanelType.sort,a.P13nPanelType.filter];break;case o.personalization.TableType.SelectionWrapper:n=[a.P13nPanelType.selection];break;default:n=[a.P13nPanelType.columns,a.P13nPanelType.sort,a.P13nPanelType.filter,a.P13nPanelType.group]}for(i in t){if(t[i].visible===false&&n.indexOf(i)>-1){n.splice(n.indexOf(i),1)}if(t[i].visible===true&&n.indexOf(i)<0){n.push(i)}}n.forEach(function(e){this._oSettingCurrent[e]={visible:true,controller:t[e]&&t[e].controller?t[e].controller:this._controllerFactory(e),payload:t[e]&&t[e].payload?t[e].payload:undefined,ignoreColumnKeys:t[e]&&t[e].ignoreColumnKeys?t[e].ignoreColumnKeys:[],triggerModelChangeOnColumnInvisible:t[e]&&t[e].triggerModelChangeOnColumnInvisible?t[e].triggerModelChangeOnColumnInvisible:undefined,createMessageStrip:t[e]&&t[e].createMessageStrip?t[e].createMessageStrip:undefined};if(e=="columns"){this._oSettingCurrent.columns.stableColumnKeys=t.stableColumnKeys}},this)};S.prototype._mixSetting=function(t,e){if(!e){return t}if(e.useAvailablePanels){return Object.assign(t,e)}for(var n in e){if(e[n].visible===true&&t[n]&&t[n].visible===true){e[n].controller=t[n].controller;e[n].payload=e[n].payload||t[n].payload}}return e};S.prototype.openLegacyDialog=function(t){this._suspendTable();this._prepareDialogUi();var e=this._mixSetting(this._oSettingCurrent,t);this._bCancelPressed=false;this._oDialog=new d(this.getId()+"-P13nDialog",{stretch:m.system.phone,showReset:t&&t.showReset!==undefined?t.showReset:true,showResetEnabled:{path:"$sapuicomppersonalizationBaseController>/isDirty"},initialVisiblePanelType:this._oInitialVisiblePanelType,validationExecutor:function(){var t=p.getTableType(this.getTable());var n=this._oColumnHelper.getColumnMap();var i=this._callControllers(e,"getUnionData",this._getControlDataInitial(),this._getControlDataReduce());return y.checkGroupAndColumns(t,e,n,i,[]).then(function(n){var i=this._callControllers(e,"getUnionData",this._getControlDataBase(),this._getControlDataReduce());var a=this._callControllers(e,"getUnionData",this._getControlDataInitial(),i);var o=this._callControllers(e,"getChangeData",a,this._getAlreadyKnownPersistentData());return y.checkSaveChanges(t,e,o,n)}.bind(this)).then(function(n){return y.checkChartConsistency(t,e,i,n)}).then(function(t){return t})}.bind(this)});this._oDialog.setModel(this._getInternalModel(),"$sapuicomppersonalizationBaseController");this._oDialog.toggleStyleClass("sapUiSizeCompact",!!jQuery(this.getTable().getDomRef()).closest(".sapUiSizeCompact").length);if(t&&t.contentWidth){this._oDialog.setContentWidth(t.contentWidth)}if(t&&t.contentHeight){this._oDialog.setContentHeight(t.contentHeight)}if(t&&t.styleClass){this._oDialog.addStyleClass(t.styleClass)}this._callControllers(this._oSettingCurrent,"setMessageStrip");var n=this._callControllers(e,"getPanel");var i=[];for(var a in n){if(n[a]){i.push(n[a])}}Promise.all(i).then(function(t){t.forEach(function(t){this._oDialog.addPanel(t)},this);this._oDialog.attachOk(this._handleDialogOk,this);this._oDialog.attachCancel(this._handleDialogCancel,this);this._oDialog.attachReset(this._handleDialogReset,this);this._oDialog.attachAfterClose(this._handleDialogAfterClose,this);this._oDialog.isPopupAdaptationAllowed=function(){return false};this._oDialog.setEscapeHandler(function(){this._handleDialogCancel().bind(this)}.bind(this));this._oDialog.open();this.fireDialogAfterOpen()}.bind(this))};S.prototype.getUISettings=function(){var t=this._oUISetting;var e=this._callControllers(t,"retrieveAdaptationUI");var i={resetEnabled:t.showReset,contentHeight:t.contentHeight,contentWidth:t.contentWidth};var a=[];var o=Object.keys(e);var r=n.getResourceBundleFor("sap.ui.mdc");var s={columns:r.getText("p13nDialog.TAB_Column"),dimeasure:r.getText("p13nDialog.TAB_Chart"),filter:r.getText("p13nDialog.TAB_Filter"),sort:r.getText("p13nDialog.TAB_Sort"),group:r.getText("p13nDialog.TAB_Group"),selection:r.getText("info.SELECTION_DIALOG_ALIGNEDTITLE")};var l=this._callControllers(t,"getResetWarningText");o.forEach(function(t){var n=s[t];var o=e[t];i[t]={resetEnabled:true,adaptationUI:o instanceof Promise?o:Promise.resolve(),reset:{warningText:l[t]},containerSettings:{title:n,tabText:n,contentHeight:i.contentHeight,contentWidth:i.contentWidth}};a.push(e[t])},this);Promise.all(a).then(function(t){this._callControllers(this._oSettingCurrent,"setModelFunction")}.bind(this));return i};S.prototype.initAdaptation=function(){return Promise.resolve()};S.prototype.reset=function(e,n){this._resetMessageStrip();return new Promise(function(n){this.resetPersonalization();this._syncDialogUi();this._callControllers(this._oSettingCurrent,"setBeforeOpenData2Model",this._getControlDataBase());for(var i in this._oSettingCurrent){var a=this._oSettingCurrent[i].controller;if(a&&a.getAdaptationUI()&&a.getAdaptationUI().setP13nData){a.getAdaptationUI().setP13nData(a.getAdaptationData())}}return new Promise(function(n){if(e){T.load("sap.ui.fl",{async:true}).then(function(){sap.ui.require(["sap/ui/comp/navpopover/FlexConnector"],function(i){return i.discardChangesForControl(e._container).then(function(){n(true)},function(e){t.error("Changes could not be discarded in LRep: "+e);n(false)})})})}else{n(false)}}).then(function(){this._syncDialogUi();for(var t in this._oSettingCurrent){var e=this._oSettingCurrent[t].controller;if(e&&e.getAdaptationUI()&&e.getAdaptationUI().setP13nData){e.getAdaptationUI().setP13nData(e.getAdaptationData())}}n()}.bind(this))}.bind(this))};S.prototype.validateP13n=function(t,e,n){var i=p.getTableType(this.getTable());var a=this._oColumnHelper.getColumnMap();var o=this._callControllers(this._oSettingCurrent,"getUnionData",this._getControlDataInitial(),this._getControlDataReduce());return y.checkGroupAndColumns(i,this._oSettingCurrent,a,o,[]).then(function(t){return y.checkChartConsistency(i,this._oSettingCurrent,o,t)}.bind(this)).then(function(t){return y.checkVisibleItemsThreshold(i,this._oSettingCurrent,o,t)}.bind(this)).then(function(t){if(t.length>0){t.forEach(function(t){for(var e in this._oSettingCurrent){var n=this._oSettingCurrent[e].controller;if(t.panelTypes.indexOf(e)>-1&&n){n.getAdaptationUI().setMessageStrip(new f({type:t.messageType,text:t.messageText}))}}}.bind(this))}else{this._resetMessageStrip()}}.bind(this))};S.prototype.preparePersonalization=function(){this._prepareDialogUi()};S.prototype.openDialog=function(t){var e;this._suspendTable();this._prepareDialogUi();this._oUISetting=this._mixSetting(this._oSettingCurrent,t);if(this._oUISetting&&this._oUISetting.showReset!==undefined){e={showReset:this._oUISetting.showReset}}this._callControllers(this._oSettingCurrent,"setMessageStrip");var n=Object.keys(this._getControllers());var i=Object.assign([],n);if(t&&t.useAvailablePanels!==true){var a=Object.keys(t);n.forEach(function(t,e){if(a.indexOf(t)<0){i.splice(i.indexOf(t),1)}})}if(!e&&i&&i.length===1&&this._aAvailablePanels&&this._aAvailablePanels.indexOf(i[0])>-1){e={showReset:false}}return T.load("sap.ui.mdc",{async:true}).then(function(){return new Promise(function(t,e){sap.ui.require(["sap/ui/comp/personalization/UIManager","sap/ui/comp/config/condition/DateRangeType"],function(e,n){t(e)},e)})}).then(function(n){if(!this._oUIManager){this._oUIManager=new n(this)}return this._oUIManager.show(this.getTable(),i,e).then(function(e){if(e.getCustomHeader()){var n=e.getCustomHeader().getContentRight()[0];if(n){n.bindProperty("enabled",{model:"$sapmP13nPanel",path:"/isDirty",formatter:function(t){return!!t}})}}e.getButtons()[1].attachPress(this._handleDialogCancel,this);e.attachAfterClose(this._handleDialogAfterClose,this);if(i.length>1&&this._sActivePanel){e.getContent()[0].switchView(this._sActivePanel)}if(t&&t.styleClass){e.addStyleClass(t.styleClass)}e.setModel(this._getInternalModel(),"$sapmP13nPanel");this._oDialog=e;this.fireDialogAfterOpen();return e}.bind(this))}.bind(this))};S.prototype.addColumns=function(t){var e=this.getTable();Object.keys(t).forEach(function(n){if(!t[n].getParent()){e.addDependent(t[n])}});this._oColumnHelper.addColumnMap(t)};S.prototype.getDataSuiteFormatSnapshot=function(){this._callControllers(this._oSettingCurrent,"calculateControlData");var t={};this._callControllers(this._oSettingCurrent,"getDataSuiteFormatSnapshot",t);return t};S.prototype.setDataSuiteFormatSnapshot=function(t,e,n){if(n){p.convertSelectOptions(t,this._oColumnHelper.getColumnMap());p.convertFilters(e,this._oColumnHelper.getColumnMap())}var i=this._callControllers(this._oSettingCurrent,"getDataSuiteFormat2Json",t);this._setRuntimeAndPersonalizationData(i,e)};S.prototype.setPersonalizationDataAsDataSuiteFormat=function(t,e){if(e){p.convertSelectOptions(t,this._oColumnHelper.getColumnMap())}var n=this._callControllers(this._oSettingCurrent,"getDataSuiteFormat2Json",t);this._setRuntimeAndPersonalizationData(n,n)};S.prototype.setPersonalizationData=function(t,e){this._extendModelStructure(this._requestMissingColumnsWithoutIgnore(t));if(e){p.convertFilters(t,this._oColumnHelper.getColumnMap())}this._setRuntimeAndPersonalizationData(t,t)};S.prototype._resetFilters=function(t){var e,n,i,a=this._oSettingCurrent&&this._oSettingCurrent.filter&&this._oSettingCurrent.filter.controller,o=this._getVariantData()&&this._getVariantData().filter&&this._getVariantData().filter.filterItems||[],r=this._getControlDataInitial()&&this._getControlDataInitial().filter&&this._getControlDataInitial().filter.filterItems;if(a){n=a.oFilterProvider;i=a.oFilterPanel}if(i&&this._oDialog&&this._oDialog.isOpen()){if(t){if(!this._getControlDataInitial()){if(n){n.clear()}e=e.map(function(t){t.active=false;return t});i.setP13nData(e)}else{this._resetToState(r,n,a,i)}}else{this._resetToState(o,n,a,i)}}};S.prototype._resetToState=function(t,e,n,i){var a,o,r,s,l,h,u,g,p=i.getP13nData();if(p&&t){for(a=0;a<p.length;a++){s=p[a];h=s.name;g=n._getFilterPropertyFromColumn(h);s.active=false;u=n._getControlByName(h);if(e){if(g&&g.includes("/")){l=e._oMetadataAnalyser.extractNavigationPropertyField(g,e.sEntitySet);l=e._createFieldMetadata(l)}else{l=e._getFieldMetadata(g)}if(l&&!l.control&&u){l.control=u}e._createInitialModelForField(e.getFilterData(),l)}if(u){if(u.setValue){u.setValue(null)}if(u.setTokens){u.setTokens([])}}for(o=0;o<t.length;o++){r=t[o];if(r.columnKey===h){s.active=true;break}}}i.setP13nData(p);if(e){n._updateFilterData(t)}else{n._updateBasicFilters(t)}}};S.prototype.resetPersonalization=function(t){t=this._determineResetType(t);if(t===o.personalization.ResetType.ResetFull){this._resetFull();this._resetFilters(true)}else{this._resetPartial();this._resetFilters(false)}this._setRuntimeAndPersonalizationData(this._getControlDataBase(),this._getVariantData())};S.prototype.addToSettingIgnoreColumnKeys=function(t){if(this._isEqualAdditionalIgnoreColumnKeys(t)){return this}this._callControllers(this._oSettingCurrent,"setAdditionalIgnoreColumnKeys",t);this._callControllers(this._oSettingCurrent,"calculateIgnoreData");this._requestMissingColumnsWithoutIgnore(this._getControlDataBase());this._suspendTable();this._syncTableUi();this._resumeTable(true);this._fireChangeEvent();return this};S.prototype._handleDialogReset=function(){this._bUnconfirmedResetPressed=true;var t=this._determineResetType();if(t===o.personalization.ResetType.ResetFull){this._resetFull()}else{this._resetPartial()}this._syncDialogUi()};S.prototype._handleDialogOk=function(){if(this._oDialog.isA("sap.m.P13nDialog")){this._oDialog.detachOk(this._handleDialogOk,this)}if(this._bUnconfirmedResetPressed){this.fireDialogConfirmedReset()}setTimeout(function(){this._postDialogUi(this._getControlDataReduce());this._syncTableUi();var t=function(t){var e=false;for(var n in this._oSettingCurrent){e=e||t.getParameter("runtimeDeltaDataChangeType")[n]==="ModelChanged";if(e){break}}var i=!e;this._resumeTable(i)};this.attachEventOnce("afterP13nModelDataChange",t,this);this._fireChangeEvent()}.bind(this),0);if(this._oDialog.isA("sap.m.P13nDialog")){this._oDialog.close()}};S.prototype.handleP13n=function(){return new Promise(function(t){var e=this._oDialog.getContent()[0];if(e.isA("sap.m.p13n.Container")){this._sActivePanel=e.getCurrentViewKey()}var n=p.getTableType(this.getTable());var i=this._callControllers(this._oSettingCurrent,"getUnionData",this._getControlDataBase(),this._getControlDataReduce());var a=this._callControllers(this._oSettingCurrent,"getUnionData",this._getControlDataInitial(),i);var o=this._callControllers(this._oSettingCurrent,"getChangeData",a,this._getAlreadyKnownPersistentData());this._handleDialogOk(true);return y.checkSaveChanges(n,this._oSettingCurrent,o,[]).then(function(){t()})}.bind(this))};S.prototype._handleDialogCancel=function(){if(this._oDialog.isA("sap.m.P13nDialog")){this._oDialog.detachCancel(this._handleDialogCancel,this)}setTimeout(function(){this._postDialogUi(this._getBeforeOpenData());this._resumeTable(false);this._callControllers(this._oSettingCurrent,"calculateControlData")}.bind(this),0);this._bCancelPressed=true;if(this._oDialog.isA("sap.m.P13nDialog")){this._oDialog.close()}};S.prototype._handleDialogAfterClose=function(){if(this._oDialog.isA("sap.m.P13nDialog")){this._oInitialVisiblePanelType=this._oDialog.getVisiblePanel()?this._oDialog.getVisiblePanel().getType():this._getInitialVisiblePanelType()}this._bUnconfirmedResetPressed=false;this.fireDialogAfterClose({cancel:this._bCancelPressed});if(this._oDialog){this._oDialog.destroy();this._oDialog=null}};S.prototype._getInitialVisiblePanelType=function(){for(var t in this._oSettingCurrent){return t}};S.prototype._suspendTable=function(){if(p.getTableBaseType(this.getTable())===o.personalization.TableType.Table){this._bSuspend=true}};S.prototype._resumeTable=function(t){t=t===undefined?true:t;var e=this.getTable();if(this._bSuspend){if(e){if(t){e.invalidate()}}this._bSuspend=false}};S.prototype._requestMissingColumnsWithoutIgnore=function(t){var e=this._callControllers(this._oSettingCurrent,"determineMissingColumnKeys",t);var n=p.getUnionOfColumnKeys(e);if(!n.length){return[]}this.fireRequestColumns({columnKeys:n});return n};S.prototype._extendModelStructure=function(t){if(!t.length){return}var e=this._callControllers(this._oSettingCurrent,"createColumnKeysStructure",t);var n=this._callControllers(this._oSettingCurrent,"getTable2Json",e);this._callControllers(this._oSettingCurrent,"extendControlDataInitial",n);this._callControllers(this._oSettingCurrent,"extendVariantDataInitial",n);this._callControllers(this._oSettingCurrent,"extendControlDataBase",n);this._callControllers(this._oSettingCurrent,"extendAlreadyKnownRuntimeData",n);this._callControllers(this._oSettingCurrent,"extendAlreadyKnownPersistentData",n)};S.prototype._setRuntimeAndPersonalizationData=function(t,e){t=t===null?{}:t;if(!this._sanityCheck(t)){return}e=e===null?{}:e;if(!this._sanityCheck(e)){return}if(typeof t?.columns?.fixedColumnCount==="undefined"&&typeof e?.columns?.fixedColumnCount!=="undefined"){t.columns.fixedColumnCount=e.columns.fixedColumnCount}this._setVariantData(e);this._extendModelStructure(this._requestMissingColumnsWithoutIgnore(t));var n=this._callControllers(this._oSettingCurrent,"getUnionData",this._getControlDataInitial(),e);this._callControllers(this._oSettingCurrent,"setVariantDataInitial2Model",n);var i=this._callControllers(this._oSettingCurrent,"getUnionData",this._getControlDataInitial(),t);this._callControllers(this._oSettingCurrent,"fixConflictWithIgnore",i,this._getIgnoreData());this._callControllers(this._oSettingCurrent,"setControlDataBase2Model",i);for(var a in this._oSettingCurrent){this._calculateChangeType(a,i)}this._suspendTable();this._syncTableUi();this._resumeTable(true);this._fireChangeEvent()};S.prototype._prepareDialogUi=function(){var t=this._callControllers(this._oSettingCurrent,"createColumnKeysStructure",this.getColumnKeys());this._extendModelStructure(this._requestMissingColumnsWithoutIgnore(t));this._callControllers(this._oSettingCurrent,"setBeforeOpenData2Model",this._getControlDataBase());this._callControllers(this._oSettingCurrent,"calculateControlDataReduce");var e=this._callControllers(this._oSettingCurrent,"getTable2JsonTransient",t);this._callControllers(this._oSettingCurrent,"calculateTransientData",e);this._callControllers(this._oSettingCurrent,"calculatePropertyInfo",e)};S.prototype._postDialogUi=function(t){this._callControllers(this._oSettingCurrent,"updateControlDataBaseFromJson",t);this._callControllers(this._oSettingCurrent,"setBeforeOpenData2Model",undefined);this._callControllers(this._oSettingCurrent,"setControlDataReduce2Model",undefined);this._callControllers(this._oSettingCurrent,"setTransientData2Model",undefined)};S.prototype._syncDialogUi=function(){this._callControllers(this._oSettingCurrent,"calculateControlDataReduce")};S.prototype._syncTableUi=function(){this._callControllers(this._oSettingCurrent,"calculateControlData");this._callControllers(this._oSettingCurrent,"syncJson2Table",this._getControlData())};S.prototype._resetFull=function(){this._setVariantData(undefined);this._callControllers(this._oSettingCurrent,"setControlDataBase2Model",this._getControlDataInitial())};S.prototype._resetPartial=function(){this._callControllers(this._oSettingCurrent,"setControlDataBase2Model",this._getVariantDataInitial())};S.prototype._calculateChangeType=function(t,e){var n={};n[t]=this._oSettingCurrent[t];this._callControllers(n,"calculatePersistentChangeTypesFromJson",e,this._determineResetType());var i=this._getPersistentDataChangeType();var a=false;for(t in this._oSettingCurrent){if(i[t]!==o.personalization.ChangeType.Unchanged){a=true}}this._setIsDirty(a)};S.prototype._fireChangeEvent=function(t){var e={};var n=this._callControllers(this._oSettingCurrent,"getUnionData",this._getControlDataInitial(),this._getControlData());e.runtimeDeltaDataChangeType=this._callControllers(this._oSettingCurrent,"getChangeType",n,this._getAlreadyKnownRuntimeData());e.persistentDeltaDataChangeType=this._getPersistentDeltaDataChangeType();e.persistentDataChangeType=this._getPersistentDataChangeType();if(!p.hasChangedType(e.runtimeDeltaDataChangeType)&&!p.hasChangedType(e.persistentDeltaDataChangeType)){return}var i=this._callControllers(this._oSettingCurrent,"getChangeData",n,this._getAlreadyKnownRuntimeData());e.runtimeDeltaData=p.removeEmptyProperty(p.copy(i));var a=this._callControllers(this._oSettingCurrent,"getChangeData",this._getControlDataBase(),this._getControlDataInitial());e.persistentData=p.removeEmptyProperty(a);this._callControllers(this._oSettingCurrent,"setAlreadyKnownRuntimeData2Model",this._getControlData());this._callControllers(this._oSettingCurrent,"setAlreadyKnownPersistentData2Model",this._getControlDataBase());delete e.persistentDeltaDataChangeType;this.fireAfterP13nModelDataChange(e)};S.prototype._onSetVisible=function(t,e){if(t){var n=p.getUnionOfAttribute(this._oSettingCurrent,"ignoreColumnKeys");if(n.indexOf(e)>-1){throw"The provided 'ignoreColumnKeys' are inconsistent. No column specified as ignored is allowed to be visible. "+this}}};S.prototype._onSetSummed=function(t,e){this._oSettingCurrent.columns.controller._onColumnTotal({column:e,isSummed:t})};S.prototype._onSetGrouped=function(t,e){this._oSettingCurrent.group.controller._setGroup(t,e)};S.prototype._getArgumentsByType=function(t,e){var n=[],i=null;if(t&&t.length&&e){t.forEach(function(t){if(t&&t[e]&&typeof t[e]!=="function"){i={};i[e]=t[e];n.push(i)}else{n.push(t)}})}return n};S.prototype._callControllers=function(t,e){var n,i,a;var o={},r=Array.prototype.slice.call(arguments,2);for(var s in t){n=i=a=null;n=t[s];i=n.controller;if(!i||!n.visible||!i[e]){continue}a=this._getArgumentsByType(r,s);if(e==="getPanel"||e==="retrieveAdaptationUI"){a.push(n.payload)}else if(e==="setIgnoreColumnKeys"){a.push(n.ignoreColumnKeys)}else if(e==="setTriggerModelChangeOnColumnInvisible"){a.push(n.triggerModelChangeOnColumnInvisible)}if(e==="setStableColumnKeys"&&s=="columns"){a.push(t.columns.stableColumnKeys)}if(e==="setMessageStrip"&&n.createMessageStrip){var l=n.createMessageStrip();a.push(l)}var h=i[e].apply(i,a);if(h!==null&&h!==undefined&&h[s]!==undefined){o[s]=h[s]}else{o[s]=h}}return o};S.prototype._sanityCheck=function(t){return true};S.prototype._createInternalModel=function(t){var e=new D;e.setDefaultBindingMode(b.TwoWay);e.setSizeLimit(1e4);this.setModel(e,"$sapuicomppersonalizationBaseController");return e};S.prototype._getInternalModel=function(){return this.getModel("$sapuicomppersonalizationBaseController")};S.prototype._getInternalModelData=function(t){return this._getInternalModel().getProperty("/"+t)};S.prototype._getControlDataInitial=function(){return this._getInternalModelData("controlDataInitial")};S.prototype._getControlDataBase=function(){return this._getInternalModelData("controlDataBase")};S.prototype._getIgnoreData=function(){return this._getInternalModelData("ignoreData")};S.prototype._getPersistentDataChangeType=function(){return this._getInternalModelData("persistentDataChangeType")};S.prototype._getPersistentDeltaDataChangeType=function(){return this._getInternalModelData("persistentDeltaDataChangeType")};S.prototype._getControlData=function(){return this._getInternalModelData("controlData")};S.prototype._getControlDataReduce=function(){return this._getInternalModelData("controlDataReduce")};S.prototype._getTransientData=function(){return this._getInternalModelData("transientData")};S.prototype._getAlreadyKnownRuntimeData=function(){return this._getInternalModelData("alreadyKnownRuntimeData")};S.prototype._getAlreadyKnownPersistentData=function(){return this._getInternalModelData("alreadyKnownPersistentData")};S.prototype._getVariantDataInitial=function(){return this._getInternalModelData("variantDataInitial")};S.prototype._getBeforeOpenData=function(){return this._getInternalModelData("beforeOpenData")};S.prototype._setVariantData=function(t){this._getInternalModel().setProperty("/variantData",t?p.copy(t):undefined)};S.prototype._setIsDirty=function(t){this._getInternalModel().setProperty("/isDirty",t)};S.prototype._getVariantData=function(){return this._getInternalModel().getProperty("/variantData")};S.prototype._getControllers=function(){var t={};Object.keys(this._oSettingCurrent).forEach(function(e){var n=this._oSettingCurrent[e];if(n.hasOwnProperty("controller")){t[e]=n}}.bind(this));return t};S.prototype._controllerFactory=function(t){var e=this;switch(t){case a.P13nPanelType.columns:return new r({afterColumnsModelDataChange:function(){var t=this.mEventRegistry.afterColumnsModelDataChange[0].fFunction;this.detachAfterColumnsModelDataChange(t);e._syncTableUi();this.attachAfterColumnsModelDataChange(t);e._fireChangeEvent()},beforePotentialTableChange:function(){e.fireBeforePotentialTableChange()},afterPotentialTableChange:function(){e.fireAfterPotentialTableChange()},afterPotentialModelChange:function(n){e._calculateChangeType(t,n.getParameter("json"))}});case a.P13nPanelType.sort:return new h({afterSortModelDataChange:function(){e._fireChangeEvent()},beforePotentialTableChange:function(){e.fireBeforePotentialTableChange()},afterPotentialTableChange:function(){e.fireAfterPotentialTableChange()},afterPotentialModelChange:function(n){e._calculateChangeType(t,n.getParameter("json"))}});case a.P13nPanelType.filter:return new s({afterFilterModelDataChange:function(){e._fireChangeEvent()},beforePotentialTableChange:function(){e.fireBeforePotentialTableChange()},afterPotentialTableChange:function(){e.fireAfterPotentialTableChange()},afterPotentialModelChange:function(n){e._calculateChangeType(t,n.getParameter("json"))}});case a.P13nPanelType.group:return new l({afterGroupModelDataChange:function(){e._fireChangeEvent()},beforePotentialTableChange:function(){e.fireBeforePotentialTableChange()},afterPotentialTableChange:function(){e.fireAfterPotentialTableChange()},afterPotentialModelChange:function(n){e._calculateChangeType(t,n.getParameter("json"))}});case a.P13nPanelType.dimeasure:return new u({afterDimeasureModelDataChange:function(){e._fireChangeEvent()},beforePotentialTableChange:function(){e.fireBeforePotentialTableChange()},afterPotentialTableChange:function(){e.fireAfterPotentialTableChange()},afterPotentialModelChange:function(n){e._calculateChangeType(t,n.getParameter("json"))}});case a.P13nPanelType.selection:return new g({afterSelectionModelDataChange:function(){e._fireChangeEvent()},beforePotentialTableChange:function(){e.fireBeforePotentialTableChange()},afterPotentialTableChange:function(){e.fireAfterPotentialTableChange()},afterPotentialModelChange:function(n){e._calculateChangeType(t,n.getParameter("json"))}});default:throw"Panel type '"+t+"' is not valid"}};S.prototype.getTable=function(){var t=this.getAssociation("table");if(typeof t==="string"){t=e.getElementById(t)}return t};S.prototype.getColumnMap=function(){return this._oColumnHelper?.getColumnMap()};S._getOrderedColumnKeys=function(t,e){var n=Object.keys(t);return e.reduce(function(t,e){if(n.indexOf(e)>-1){t.push(e)}return t},[])};S.prototype.exit=function(){var t;this._resumeTable(false);if(this._oDialog){this._oDialog.destroy();this._oDialog=null}if(this._oUIManager){this._oUIManager.destroy();this._oUIManager=null}this._oUISetting=null;this._callControllers(this._oSettingCurrent,"destroy");for(t in this._oSettingCurrent){this._oSettingCurrent[t]=null}this._oSettingCurrent=null;this._oColumnHelper=null};S.prototype._determineResetType=function(t){t=t||(this.getResetToInitialTableState()?o.personalization.ResetType.ResetFull:o.personalization.ResetType.ResetPartial);if(t===o.personalization.ResetType.ResetFull||this._getVariantData()===undefined){return o.personalization.ResetType.ResetFull}return o.personalization.ResetType.ResetPartial};S.prototype._isEqualAdditionalIgnoreColumnKeys=function(t){var e=this._callControllers(this._oSettingCurrent,"isEqualAdditionalIgnoreColumnKeys",t);var n=true;for(var i in e){n=n&&e[i]}return n};S.prototype._resetMessageStrip=function(t){for(var e in this._oSettingCurrent){var n=this._oSettingCurrent[e].controller;if(n&&n.getAdaptationUI()&&n.getAdaptationUI().isA("sap.m.p13n.BasePanel")){n.getAdaptationUI().setMessageStrip(undefined)}}};S.prototype._setShowDetails=function(t){this._callControllers(this._oSettingCurrent,"_updateInternalModelShowHide",t)};S.SyncReason={ResetFull:14,ResetPartial:15,NewModelDataMixedWithVariant:7};return S});
//# sourceMappingURL=Controller.js.map