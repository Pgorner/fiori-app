sap.ui.define(["../lib/sapvbi","./MapRenderer","./VectorUtils","sap/ui/unified/Menu","sap/ui/unified/MenuItem"],function(e,t,a,r,o){"use strict";VBI.VBITransformer={};VBI.vectorFlag=false;VBI.TransformedJSON=[];var i=[];var n={};var s=0;var l=0;var c;var B;var f;var p;var A;var V="iVBORw0KGgoAAAANSUhEUgAAABcAAAAfCAYAAAAMeVbNAAADGUlEQVRIia3WW2xMQRjA8f+Z3bWru622ulhVWtpQlzbFhrq1UQmpy4O+IO6C4kki4VHcIx5RJO7iSXgRSpG6e6hbo7WJRrShFVLqTtX5POxO1Wa3u9Z+ySTfnNn5zZyzc+aMISJEiDnApEDJBJ4CN4HqQAkfIhKubBORGuk+qkVkbTjDCDHzacAeIB/A9/IdN+pe8aSpldfvvzDInUR+lpuS/Aw8KU7d5zKwEmjqCgXjB4FVAHVNrRyuquPxi7ch71gpg+KRA1hWMoL+qU6ANqAEeBAKrwDKTVM4Wf2UU9d9mGbE/4MEu431cwqYmpehL43RA2h8NHBfBHafreHyo8aIaHCsK81nbmE2QD2QB/xSgbatAOfuNcQEA1RU1upHOBzYC6CAcUDpx6/tHL1aHxMMYJrC/gu1BJ5yOWBR+Ncxlx428vXHz5hxgIaWNmobOxfAbAVMBrjja/4vWMddX4tOJyugAOBZc1tc8IaWTqdAAa7v7R18a++IC9766btOPQqgvcOMCxxk2RWA02GLG+76Y31QQJNFGfRNTogLHtgKAJ4roAZgaHpKXPAcT7JOHyj8ezPenL5xwb05/XR6UwGVABNz+2O1qLCdoglPipPsPzO/pQAfcK1Xgp2iEen/hc/yZmEYAJwATD3VMwALi3OxKCMm2OWwMds7WFcPgX/jAv9eXj3Qncj0gsyY8PlThuolfR643RUHOAawtGQ4CXbrP8EZaYmUFebo6i6ddMWPAxd7JzpYPSMvatiiDDaWjcVmVQBH9KyDcYANADPHZDFhmCcqfEHRMHIHpIL/01betS0YrwcOGAZsKvOS3tvVLTx6SB8WF+fq6ibgrw9CqIW9BjjtdNjYuXhi2H1noDuRzfPGo/yr6xBQFfybcG/NcqAqPdXF9oUTsNssfzW6k3qyY1HnwKeB1aGQcPgPYAXwZNSgNLYsKKSH1T9AqsvBnmVT9IHoErAkjNHtcQ4RGSwiDSIij56/kVX7rkjzu8/6KHdFRJK76x8JR0SyRaReRMQ0O8+IlSKSFqlvNDgiYhWRigBcEWUffgN+ZuQK2lE/1gAAAABJRU5ErkJggg==";VBI.VBITransformer.init=function(){this._eventHandlers=[];this._actions=[];this._mapConfiguration={};this._clusterVOs=new Map;this._dataTypes={};this._data={};this._idKeyMap={};this._propsAnomalies=new Map};VBI.VBITransformer._extractMapProvider=e=>{if(!this.mVBIContext){this.mVBIContext=new VBI.VBIContext(this)}var t="DEFAULT";var a=[12.980846657174002,77.7154284936771];var r="0";var o="metric";var i="EN";if(e.SAPVB.Scenes){if(e.SAPVB.Scenes.Set.SceneGeo.refMapLayerStack){t=e.SAPVB.Scenes.Set.SceneGeo.refMapLayerStack;console.log(t);if(e.SAPVB.Scenes.Set.SceneGeo.initialStartPosition){a[0]=Number(e.SAPVB.Scenes.Set.SceneGeo.initialStartPosition.split(";")[0]);a[1]=Number(e.SAPVB.Scenes.Set.SceneGeo.initialStartPosition.split(";")[1])}if(e.SAPVB.Scenes.Set.SceneGeo.initialZoom){r=e.SAPVB.Scenes.Set.SceneGeo.initialZoom[0]}}if(e.SAPVB.Config){if(e.SAPVB.Config.Set){let t=e.SAPVB.Config.Set;if(Array.isArray(t.P)){for(const e in t.P){if(t.P.hasOwnProperty(e)){let a=t.P[e];switch(a.name){case"UnitOfLength":if(a.value=="nm"){o="nautical"}else if(a.value=="mi"){o="imperial"}else{o="metric"}break;case"language":i="EN";break;default:}}}}else{switch(t.P.name){case"UnitOfLength":if(t.P.value=="nm"){o="nautical"}else if(t.P.value=="mi"){o="imperial"}else{o="metric"}break;case"language":i="EN";break;default:}}}}if(e.SAPVB.MapProviders.Set.MapProvider){let s=e.SAPVB.MapProviders.Set.MapProvider;for(const e in s){if(s.hasOwnProperty(e)){let l=s[e];if(l.name==t&&l.type=="vector"){n={type:"MapProvider",provider:l.Source[0].url,center:a,zoom:Number(r),copyright:l.copyright,scaleType:o?o:"metric",language:i?i:"EN",header:Array.isArray(l.Header)?l.Header.reduce((e,{name:t,value:a})=>({...e,[t]:a}),{}):{}}}}}}}};VBI.VBITransformer._extractSpotsData=e=>{if(Array.isArray(e.E)){for(const t in e.E){if(e.E.hasOwnProperty(t)){let a=e.E[t];let r={GeoPosition:a.A?a.A:"",ToolTip:a.B?a.B:"",Label:a.L?a.L:"",LabelBGColor:a.LC?a.LC:"",LabelAlignment:a.LA?a.LA:"",Color:a.C?a.C:"",HotColor:a.HC?a.HC:"",SelectColor:a.SC?a.SC:"",Transformation:a.D?a.D:"",FixDir:a.E?a.E:"",FixSize:a.F?a.F:"",Icon:a.G?a.G:"",Image:a.I?a.I:"",base64:f.find(e=>e.name===a.I)?.value||V,Key:a.K?a.K:"",Scale:a.S?a.S:"",DisplayRole:a.R?a.R:"",DragData:a.DD?a.DD:"",Alignment:a.AL?a.AL:"",height:f.find(e=>e.name===a.I)?"45px":"30px",width:f.find(e=>e.name===a.I)?"45px":"24px",menu:A};let o=a.A.split(";");let n={coordinates:[Number(o[0]),Number(o[1])],type:"Point"};let l={type:"Feature",properties:r,geometry:n,id:s++};i.push(l)}}}else{let t=e.E;if(t){let e={GeoPosition:t.A?t.A:"",ToolTip:t.B?t.B:"",Label:t.L?t.L:"",LabelBGColor:t.LC?t.LC:"",LabelAlignment:t.LA?t.LA:"",Color:t.C?t.C:"",HotColor:t.HC?t.HC:"",SelectColor:t.SC?t.SC:"",Transformation:t.D?t.D:"",FixDir:t.E?t.E:"",FixSize:t.F?t.F:"",Icon:t.G?t.G:"",Image:t.I?t.I:"",base64:f.find(e=>e.name===t.I)?.value||V,Key:t.K?t.K:"",Scale:t.S?t.S:"",DisplayRole:t.R?t.R:"",DragData:t.DD?t.DD:"",Alignment:t.AL?t.AL:"",height:f.find(e=>e.name===t.I)?"45px":"30px",width:f.find(e=>e.name===t.I)?"45px":"24px"};let a=t.A.split(";");let r={coordinates:[Number(a[0]),Number(a[1])],type:"Point"};let o={type:"Feature",properties:e,geometry:r,id:s++};i.push(o)}}};VBI.VBITransformer._extractRoutesData=e=>{if(Array.isArray(e.E)){for(const t in e.E){if(e.E.hasOwnProperty(t)){let r=e.E[t];let o={GeoPosition:r.A?r.A:"",ToolTip:r.B?r.B:"",Label:r.L?r.L:"",LabelBGColor:r.LC?r.LC:"",LabelAlignment:r.LA?r.LA:"",Color:r.C?a.argbToRgba(r.C):"",BorderColor:r.D?a.argbToRgba(r.D):"",HotColor:r.HC?r.HC:"",SelectColor:r.SC?r.SC:"",PosList:r.H?r.H:"",StartStyle:r.Y?r.Y:"",EndStyle:r.Z?r.Z:"",Key:r.K?r.K:"",DisplayRole:r.R?r.R:"",LineWidth:r.LW?r.LW*1.5:"",BorderWidth:r.LW?r.LW*1.5+2:"",DotWidth:r.DW?r.DW:"",DotColor:r.DC?r.DC:"",LineDash:r.LD?r.LD:"",DirectionIndicator:r.DI?r.DI:"",DragData:r.DD?r.DD:""};let n=r.H.split(";");let s=[];for(let e=0;e<n.length;e=e+3){s.push([Number(n[e]),Number(n[e+1])])}let c={coordinates:s,type:"LineString"};let B={type:"Feature",properties:o,geometry:c,id:l++};i.push(B)}}}else{let t=e.E;if(t){let e={GeoPosition:t.A?t.A:"",ToolTip:t.B?t.B:"",Label:t.L?t.L:"",LabelBGColor:t.LC?t.LC:"",LabelAlignment:t.LA?t.LA:"",Color:t.C?a.argbToRgba(t.C):"",BorderColor:t.D?a.argbToRgba(t.D):"",HotColor:t.HC?t.HC:"",SelectColor:t.SC?t.SC:"",PosList:t.H?t.H:"",StartStyle:t.Y?t.Y:"",EndStyle:t.Z?t.Z:"",Key:t.K?t.K:"",DisplayRole:t.R?t.R:"",LineWidth:t.LW?t.LW*1.5:"",BorderWidth:t.LW?t.LW*1.5+2:"",DotWidth:t.DW?t.DW:"",DotColor:t.DC?t.DC:"",LineDash:t.LD?t.LD:"",DirectionIndicator:t.DI?t.DI:"",DragData:t.DD?t.DD:""};let r=t.H.split(";");let o=[];for(let e=0;e<r.length;e=e+3){o.push([Number(r[e]),Number(r[e+1])])}let n={coordinates:o,type:"LineString"};let s={type:"Feature",properties:e,geometry:n,id:l++};i.push(s)}}};VBI.VBITransformer._deleteSpotsData=e=>{if(Array.isArray(e.E)){for(const t in e.E){let a=e.E[t];for(const e in i){if(i[e].properties.Key==a.K){c=e;i.splice(c,1)}else{console.log("error")}}}}else{let t=e.E;for(const e in i){if(i[e].properties.Key==t.K){c=e}else{console.log("error")}}i.splice(c,1)}};VBI.VBITransformer._deleteRoutesData=e=>{if(Array.isArray(e.E)){for(const t in e.E){let a=e.E[t];for(const e in i){if(i[e].properties.Key==a.K){c=e;i.splice(c,1)}else{console.log("error")}}}}else{let t=e.E;for(const e in i){if(i[e].properties.Key==t.K){c=[e]}else{console.log("error")}}i.splice(c,1)}};VBI.VBITransformer._processAutomation=function(e,t){const a=t.SAPVB.Automation?.Menus?t.SAPVB.Automation.Menus:t.SAPVB?.Menus;if(a||a!=null){const r=new VBI.Menus;r.load(a,t.SAPVB.Automation.Call);VBI.MapRenderer.createMenu(r,e.Call)}};VBI.VBITransformer._createLegend=e=>{if(B.m_DataSource&&B.LegendChanged()){B.m_Data=[];if(B.m_oLegend&&B.m_oLegend.m_Table){while(B.m_oLegend.m_Table.rows.length>0){B.m_oLegend.m_Table.deleteRow(-1)}B.ApplyData();B.FillContent()}}if(e&&B.m_oLegend==null){B.m_oLegend=VBI.Utilities.CreateLegend(e+"-"+B.m_ID,0,B.m_Caption,5,false);B.RegisterEvents();B.m_Expanded=true;B.ApplyData();B.FillContent()}var t=document.getElementById(e);t.appendChild(B.m_oLegend.m_Div)};VBI.VBITransformer._extractDetailWindow=e=>{const{Windows:t}=e.SAPVB;const r=t.Set.Window;const o=t.Set.Window["pos.bind"];const i=o.split(".");const n=e.SAPVB.Data.Set.N.E[0].N.E;const s=e.SAPVB.Scenes.Set.Scene.VO;const l=e.SAPVB.Actions.Set;const c=a.createDetailWindowContainer(r);const B=document.createElement("div");c.appendChild(B);s.forEach(e=>{let t;switch(e.type){case"{00100000-2013-1000-1100-50059A6A47FA}":t=a.createSubCaption(e);B.appendChild(t);break;case"{00100000-2013-1000-3700-AD84DDBBB31B}":t=a.createLabel(e,n);B.appendChild(t);break;case"{00100000-2013-1000-2400-D305F7942B98}":t=a.createLink(e);B.appendChild(t);break;case"{00100000-2013-1000-2200-6B060A330B2C}":t=a.createImage(e,V,p);B.appendChild(t);break;case"{00100000-2013-1000-2400-D305F7942B98}":t=a.createButton(e,l);B.appendChild(t);break;default:console.error("Unknown element type:",e.type);break}});VBI.MapRenderer.createPopup(c,i)};VBI.VBITransformer._processDetailWindows=e=>{if(!this.mVBIContext.m_Windows){this.mVBIContext.m_Windows=new VBI.Windows}B=new VBI.LegendWindow;if(Array.isArray(e.SAPVB.Windows.Set.Window)){B.load(e.SAPVB.Windows.Set.Window.find(e=>e.id==="LEGEND"),this.mVBIContext)}};VBI.VBITransformer._extractData=e=>{if(!this.mVBIContext.m_DataProvider){this.mVBIContext.m_DataProvider=new VBI.DataProvider}this.mVBIContext.m_DataProvider.load(e.SAPVB.Data,this.mVBIContext);if(e.SAPVB.Data.Set){let t=e.SAPVB.Data.Set;if(Array.isArray(t)){for(const a in t){if(t.hasOwnProperty(a)){let r=t[a];switch(r.name){case"Spots":VBI.VBITransformer._extractSpotsData(r.N);break;case"Links":VBI.VBITransformer._extractRoutesData(r.N);break;case"DetailData":VBI.VBITransformer._extractDetailWindow(e);break;default:}}}}else{if(e.SAPVB.Data.Set.N){let t=e.SAPVB.Data.Set.N;if(Array.isArray(t)){for(const a in t){if(t.hasOwnProperty(a)){let r=t[a];switch(r.name){case"Spots":VBI.VBITransformer._extractSpotsData(r);break;case"Links":VBI.VBITransformer._extractRoutesData(r);break;case"DetailData":VBI.VBITransformer._extractDetailWindow(e);break;case"KeyPress":if(this._target!==this._adapter._map()){return false}this._event="keyDown";this._target.setKeyEventDelay(250);this._target.setAllowKeyEventRepeat(false);this._handler=this._adapter._getKeyboardHandler(this.name);break;default:}}}}else{switch(t.name){case"Spots":VBI.VBITransformer._extractSpotsData(t);break;case"Links":VBI.VBITransformer._extractRoutesData(t);break;case"DetailData":VBI.VBITransformer._extractDetailWindow(e);break;default:}}}}}else{if(e.SAPVB.Data.Remove){let t=e.SAPVB.Data.Remove;if(Array.isArray(t)){for(const e in t){if(t.hasOwnProperty(e)){let a=t[e];switch(a.name){case"Spo  ts":VBI.VBITransformer._deleteSpotsData(a.N);case"Links":VBI.VBITransformer._deleteRoutesData(a.N);break;default:}}}}else{if(e.SAPVB.Data.Remove.N){let t=e.SAPVB.Data.Remove.N;if(Array.isArray(t)){for(const e in t){if(t.hasOwnProperty(e)){let a=t[e];switch(a.name){case"Spots":VBI.VBITransformer._deleteSpotsData(a);break;case"Links":VBI.VBITransformer._deleteRoutesData(a);break;default:}}}}else{switch(t.name){case"Spots":VBI.VBITransformer._deleteSpotsData(t);break;case"Links":VBI.VBITransformer._deleteRoutesData(t);break;default:}}}}}}};VBI.VBITransformer._extractDataTypes=e=>{};VBI.VBITransformer._buildTransformedJSON=e=>{VBI.TransformedJSON=[n?n:{},{type:"FeatureCollection",features:e}]};VBI.VBITransformer.parseVBI=e=>{VBI.vectorFlag=true;if(e.SAPVB){if(e.SAPVB.MapProviders&&e.SAPVB.MapLayerStacks&&e.SAPVB.Scenes){VBI.VBITransformer._extractMapProvider(e)}if(e?.SAPVB?.Scenes?.Merge?.SceneGeo?.refMapLayerStack){const t=e.SAPVB.Scenes.Merge.SceneGeo.refMapLayerStack;const a=this._adapter._mapConfiguration.MapProvider.find(e=>e.name===t);const r=a.Source[0].url;n.provider=r;n.header=Array.isArray(a.Header)?a.Header.reduce((e,{name:t,value:a})=>({...e,[t]:a}),{}):{};VBI.MapRenderer.setRefMapLayerStack(r,n.header)}if(e.SAPVB.DataTypes){if(!this.mVBIContext.m_DataTypeProvider){this.mVBIContext.m_DataTypeProvider=new VBI.DataTypeProvider}this.mVBIContext.m_DataTypeProvider.load(e.SAPVB.DataTypes,this.mVBIContext)}if(e.SAPVB.Resources){f=e.SAPVB.Resources.Set.Resource;p=new Map(f.map(e=>[e.name,e.value]))}if(e.SAPVB.Automation&&e.SAPVB.Automation.Call){VBI.VBITransformer._processAutomation(e.SAPVB.Automation,e)}if(e.SAPVB.Menus&&Object.keys(e.SAPVB.Menus).length!=0){A=e.SAPVB.Menus.Set.Menu}if(e.SAPVB.Data){VBI.VBITransformer._extractData(e)}if(e.SAPVB.Actions){VBI.MapRenderer.actionName(e)}if(e.SAPVB.Windows){VBI.VBITransformer._processDetailWindows(e)}if(e.SAPVB.Automation){}return VBI.VBITransformer._buildTransformedJSON(i)}};VBI.VBITransformer.getTransformedJSON=()=>VBI.TransformedJSON;VBI.VBITransformer.clearTransformedJSON=()=>{VBI.TransformedJSON=[];i=[]};VBI.VBITransformer.getVectorFlag=()=>VBI.vectorFlag;VBI.VBITransformer._map=function(){return sap.ui.getCore().byId(_adapter.getMap())};VBI.VBITransformer._attachHandler=function(e,t,a){if(e in this.mEventRegistry&&this.mEventRegistry[e].length>0){return this}else{if(!a._eventHandlers.some(function(e){return e===t})){a._eventHandlers.push(t)}this.attachEvent(e,t,a);return this}}});
//# sourceMappingURL=VBITransformer.js.map