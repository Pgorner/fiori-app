/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_omit","sap/m/MessageBox","sap/ui/core/Fragment","sap/ui/core/Lib","sap/ui/dt/DOMUtil","sap/ui/dt/ElementUtil","sap/ui/dt/MetadataPropagationUtil","sap/ui/dt/OverlayUtil","sap/ui/fl/initial/api/Version","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/fl/Utils","sap/ui/model/json/JSONModel","sap/ui/rta/util/BindingsExtractor","sap/ui/rta/util/hasStableId"],function(e,t,r,n,a,i,s,l,o,u,c,g,f,v,d){"use strict";var y={};y.RESOLVED_PROMISE=Promise.resolve(true);y._sFocusableOverlayClass=".sapUiDtOverlaySelectable";y._sRtaStyleClassName="";y.getRtaStyleClassName=function(){return y._sRtaStyleClassName};y.setRtaStyleClassName=function(e){if(e===u.USER){y._sRtaStyleClassName=""}else if(c.getLayerIndex(e)>-1){y._sRtaStyleClassName="sapUiRTABorder"}};y.openRemoveConfirmationDialog=function(e,t){var a=n.getResourceBundleFor("sap.ui.rta");var i;return new Promise(function(e){i=a.getText("CTX_REMOVE_TITLE");var n={messageText:t,titleText:i,icon:"sap-icon://question-mark",removeText:a.getText("BTN_FREP_REMOVE"),cancelText:a.getText("BTN_FREP_CANCEL")};var s=new f;s.setData(n);var l;var o=function(){if(l){l.close();l.destroy();l=null}};var u={removeField(){o();e(true)},closeDialog(){o();e(false)}};if(!l){r.load({name:"sap.ui.rta.view.RemoveElementDialog",controller:u}).then(function(e){l=e;l.setModel(s);l.addStyleClass(y.getRtaStyleClassName());l.open()})}else{l.addStyleClass(y.getRtaStyleClassName());l.open()}})};y.isOverlaySelectable=function(e){return e.isSelectable()&&a.isVisible(e.getDomRef())};y.getFocusableParentOverlay=function(e){if(!e){return undefined}var t=e.getParentElementOverlay();while(t&&!t.getSelectable()){t=t.getParentElementOverlay()}return t};y.getFirstFocusableDescendantOverlay=function(e){return l.getFirstDescendantByCondition(e,this.isOverlaySelectable)};y.getLastFocusableDescendantOverlay=function(e){return l.getLastDescendantByCondition(e,this.isOverlaySelectable)};y.getNextFocusableSiblingOverlay=function(e){var t=true;var r=l.getNextSiblingOverlay(e);while(r&&!this.isOverlaySelectable(r)){r=l.getNextSiblingOverlay(r)}r||=this._findSiblingOverlay(e,t);return r};y.getPreviousFocusableSiblingOverlay=function(e){var t=false;var r=l.getPreviousSiblingOverlay(e);while(r&&!this.isOverlaySelectable(r)){r=l.getPreviousSiblingOverlay(r)}r||=this._findSiblingOverlay(e,t);return r};y._findSiblingOverlay=function(e,t){var r=e.getParentElementOverlay();if(r){var n=t?l.getNextSiblingOverlay(r):l.getPreviousSiblingOverlay(r);if(!n){return this._findSiblingOverlay(r,t)}var a=t?this.getFirstFocusableDescendantOverlay(n):this.getLastFocusableDescendantOverlay(n);return a}return undefined};y.getIndex=function(e,t,r,n){var a;if(n&&typeof n==="function"){a=n(e,t)}else{var i=e.getMetadata();var s=i.getAggregation(r);var l=s._sGetter;var o=e[l]();if(Array.isArray(o)&&t){a=o.indexOf(t)+1}else{a=0}}return a};y.isOriginalFioriToolbarAccessible=function(){var e=y.getFiori2Renderer();return e&&e.getRootControl&&e.getRootControl().getShellHeader()};y.getFiori2Renderer=function(){var e=g.getUshellContainer()||{};return typeof e.getRenderer==="function"?e.getRenderer("fiori2"):undefined};y.extendWith=function(e,t,r){if(!(typeof r==="function")){throw new Error("In order to use extendWith() utility function fnCustomizer should be provided!")}for(var n in t){if(t.hasOwnProperty(n)){if(r(e[n],t[n],n,e,t)){e[n]=t[n]}}}};y.showMessageBox=function(r,a,i){var s=n.getResourceBundleFor("sap.ui.rta");i||={};var l=s.getText(a,i.error?[i.error.userMessage||i.error.message||i.error]:undefined);var o=i.titleKey&&s.getText(i.titleKey);var u=i.actionKeys&&i.actionKeys.map(function(e){return s.getText(e)});var c=i.emphasizedActionKey?s.getText(i.emphasizedActionKey):undefined;var g=i.showCancel;var f=e(i,["titleKey","error","actionKeys","emphasizedAction","emphasizedActionKey","showCancel"]);f.title=o;f.styleClass=y.getRtaStyleClassName();f.actions||=u;f.emphasizedAction=c||i.emphasizedAction;if(g){f.actions.push(t.Action.CANCEL)}return m(r,l,f)};function m(e,r,n){return new Promise(function(a){n.onClose=a;t[e](r,n)})}y.checkSourceTargetBindingCompatibility=function(e,t,r){r||=e.getModel();var n=v.collectBindingPaths(e,r);var a;var i;if(n.bindingPaths.length===0){return true}a=v.getBindingContextPath(e);i=v.getBindingContextPath(t);if(a===i){return true}return false};y.doIfAllControlsAreAvailable=function(e,t){if(e.every(function(e){return e&&!e._bIsBeingDestroyed})){return t()}return undefined};y.checkTargetZone=function(e,t,r,n){function a(e,t,r,n){var a=e.getDesignTimeMetadata();var i=a.getAction("move",t);if(!i){return Promise.resolve(false)}return n.hasChangeHandler(i.changeType,r)}return i.checkTargetZone(e,t,n).then(function(n){if(!n){return false}var i=t.getElement();var l=e.getParent();var o=t.getRelevantContainer();if(!i||!l){return false}var u=l.getElement();var c=e.getDesignTimeMetadata();var g=s.getRelevantContainerForPropagation(c.getData(),i);g||=u;if(!o||!g||!d(l)||o!==g){return false}if(t.getParent().getElement()!==u&&!y.checkSourceTargetBindingCompatibility(i,u)){return false}return a(e,i,g,r)})};y.checkDraftOverwrite=function(e,r){var n=e.getProperty("/backendDraft");var a=e.getProperty("/displayedVersion")===o.Number.Draft;if(a||!n||r){return Promise.resolve(false)}return y.showMessageBox("warning","MSG_DRAFT_DISCARD_AND_CREATE_NEW_DIALOG",{titleKey:"TIT_DRAFT_DISCARD_DIALOG",actions:[t.Action.OK,t.Action.CANCEL],emphasizedAction:t.Action.OK}).then(function(e){if(e!==t.Action.OK){throw"cancel"}return true})};return y},true);
//# sourceMappingURL=Utils.js.map