/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/fl/apply/api/FlexRuntimeInfoAPI","sap/ui/fl/write/api/ReloadInfoAPI","sap/ui/fl/write/api/VersionsAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/Utils"],function(e,t,a,r,n,i,o){"use strict";var s={};var l={};var A={NOT_NEEDED:"NO_RELOAD",VIA_HASH:"CROSS_APP_NAVIGATION",RELOAD_PAGE:"HARD_RELOAD"};function _(e){var t;var a=e.layer===n.CUSTOMER;if(e.hasHigherLayerChanges&&e.isDraftAvailable){t=a?"MSG_VIEWS_OR_PERSONALIZATION_AND_DRAFT_EXISTS":"MSG_HIGHER_LAYER_CHANGES_AND_DRAFT_EXISTS"}else if(e.hasHigherLayerChanges&&e.allContexts){t="MSG_RESTRICTED_CONTEXT_EXIST_AND_PERSONALIZATION"}else if(e.hasHigherLayerChanges){t=a?"MSG_PERSONALIZATION_OR_PUBLIC_VIEWS_EXISTS":"MSG_HIGHER_LAYER_CHANGES_EXIST"}else if(e.isDraftAvailable){t="MSG_DRAFT_EXISTS"}else if(e.allContexts){t="MSG_RESTRICTED_CONTEXT_EXIST"}return t}function u(e){var t=e.layer===n.CUSTOMER;if(e.hasHigherLayerChanges){if(!t){return"MSG_RELOAD_WITH_ALL_CHANGES"}if(e.isDraftAvailable){return"MSG_RELOAD_WITH_VIEWS_PERSONALIZATION_AND_WITHOUT_DRAFT"}if(e.allContexts){return"MSG_RELOAD_WITH_PERSONALIZATION_AND_RESTRICTED_CONTEXT"}if(e.switchEndUserAdaptation){return"MSG_RELOAD_WITH_PERSONALIZATION_AND_CONTEXT_BASED_ADAPTATION"}return"MSG_RELOAD_WITH_PERSONALIZATION_AND_VIEWS"}if(e.changesNeedReload){return"MSG_RELOAD_NEEDED"}if(e.initialDraftGotActivated||e.activeVersionNotSelected){return"MSG_RELOAD_ACTIVATED_DRAFT"}if(e.isDraftAvailable){return"MSG_RELOAD_WITHOUT_DRAFT"}if(e.allContexts){return"MSG_RELOAD_WITHOUT_ALL_CONTEXT"}if(e.switchEndUserAdaptation){return"MSG_RELOAD_OTHER_CONTEXT_BASED_ADAPTATION"}return undefined}function E(e){var t=u(e);if(t){return o.showMessageBox("information",t,{titleKey:"HEADER_RELOAD_NEEDED"})}return Promise.resolve()}function f(e,t,a){return Promise.resolve().then(function(){if(l.Navigation&&t){if(e.isDraftAvailable){return r.loadDraftForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts,adaptationId:e.adaptationId})}return r.loadVersionForApplication({control:e.selector,layer:e.layer,allContexts:e.allContexts,adaptationId:e.adaptationId})}return undefined}).then(function(){var t=_(e);return a?undefined:o.showMessageBox("information",t)}).then(function(){s.enableAutomaticStart(e.layer,e.selector);e.onStart=true;return s.triggerReload(e)}).then(function(){return true})}s.setUShellServices=function(e){l=e};s.enableAutomaticStart=function(e,a){var r=t.getFlexReference({element:a});var n=r||true;window.sessionStorage.setItem(`sap.ui.rta.restart.${e}`,n)};s.disableAutomaticStart=function(e){window.sessionStorage.removeItem(`sap.ui.rta.restart.${e}`)};s.needsAutomaticStart=function(e){return!!window.sessionStorage.getItem(`sap.ui.rta.restart.${e}`)};s.setDontShowWhatsNewAfterReload=()=>{window.sessionStorage.setItem("sap.ui.rta.whatsNew",true)};s.getDontShowWhatsNewAfterReload=()=>window.sessionStorage.getItem("sap.ui.rta.whatsNew");s.removeDontShowWhatsNewAfterReload=()=>{window.sessionStorage.removeItem("sap.ui.rta.whatsNew")};s.triggerReload=function(e){if(e.onStart){a.handleReloadInfoOnStart(e)}else{a.handleReloadInfo(e)}if(i.getUshellContainer()){l.AppLifeCycle.reloadCurrentApp()}if(!i.getUshellContainer()||e.triggerHardReload){s.reloadPage()}};s.reloadPage=function(){window.location.reload()};s.setUriParameters=function(e){document.location.search=e};s.handleReloadOnStart=function(t){e(t,{hasHigherLayerChanges:false,isDraftAvailable:false,ignoreMaxLayerParameter:false,includeCtrlVariants:true,URLParsingService:l.URLParsing});return a.getReloadReasonsForStart(t).then(function(e){if(e.hasHigherLayerChanges||e.isDraftAvailable||e.allContexts||e.switchAdaptation){return f(e,t.versioningEnabled,t.developerMode)}return undefined})};s.checkReloadOnExit=function(e){return e.changesNeedReloadPromise.then(function(t){e.changesNeedReload=t;e.URLParsingService=l.URLParsing;var r=a.getReloadMethod(e);return E(r).then(function(){r.triggerHardReload=r.reloadMethod===A.RELOAD_PAGE;return r})})};s.handleReloadOnExit=function(e){if(e.reloadMethod!==A.NOT_NEEDED){e.removeVersionParameter=true;s.triggerReload(e)}};return s});
//# sourceMappingURL=ReloadManager.js.map