/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/Control","sap/ui/core/Lib","sap/ui/core/UIComponent","sap/ui/fl/write/api/FeaturesAPI","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/Layer","sap/ui/fl/Utils","sap/ui/rta/util/showMessageBox","sap/ui/rta/RuntimeAuthoring"],function(e,t,r,n,o,a,i,s,u,l){"use strict";function f(e){if(i.CUSTOMER===e){return o.isKeyUser().then(function(e){if(!e){var t=r.getResourceBundleFor("sap.ui.rta");var n=new Error(t.getText("MSG_NO_KEY_USER_RIGHTS_ERROR_MESSAGE"));n.reason="isKeyUser";throw n}})}return Promise.resolve()}function T(e){var t=new URLSearchParams(window.location.search).get("fiori-tools-rta-mode");if(!t||t==="false"){var r=e.getManifest()||{};var n=r["sap.ui5"]&&r["sap.ui5"].flexEnabled;if(n===false){var o=Error("This app is not enabled for key user adaptation");o.reason="flexEnabled";throw o}}}function c(e){const t=e.getComponentData?.();if(t?.startupParameters&&Array.isArray(t.startupParameters["sap-app-id"])){const t=e.getManifest();const n=t["sap.app"]?.ach;const o=r.getResourceBundleFor("sap.ui.rta");const a=o.getText("MSG_PSEUDO_APP_VARIANT_ERROR_MESSAGE",[n]);const i=Error(a);i.reason="pseudoAppVariant";throw i}}function p(o,p,A,_,E){var g;return Promise.resolve().then(function(){if(!(o.rootControl instanceof t)&&!(o.rootControl instanceof n)){var e=Error("An invalid root control was passed");e.reason="rootControl";throw e}o.rootControl=s.getAppComponentForControl(o.rootControl)}).then(f.bind(undefined,o.flexSettings.layer)).then(function(){return T(o.rootControl)}).then(c.bind(undefined,o.rootControl)).then(function(){g=new l(o);if(A){g.attachEvent("start",A)}if(_){g.attachEvent("failed",_)}var e=E||function(){g.destroy()};g.attachEvent("stop",e);if(p){return p(g)}return undefined}).then(function(){return g.start()}).then(function(){if(o.flexSettings.layer==="CUSTOMER"){var e={oComponent:o.rootControl,selector:o.rootControl,invalidateCache:false,includeCtrlVariants:true,currentLayer:i.CUSTOMER};a.getChangesWarning(e).then(function(e){if(e.showWarning){var t=r.getResourceBundleFor("sap.ui.rta");var n=e.warningType==="mixedChangesWarning"?{text:"MSG_ADAPTATION_STARTER_MIXED_CHANGES_WARNING",title:"TIT_ADAPTATION_STARTER_MIXED_CHANGES_TITLE"}:{text:"MSG_ADAPTATION_STARTER_NO_CHANGES_IN_P_WARNING",title:"TIT_ADAPTATION_STARTER_NO_CHANGES_IN_P_TITLE"};u(t.getText(n.text),{title:t.getText(n.title)},"warning")}})}return g}).catch(function(t){if(t.message!=="Reload triggered"&&!(s.getUshellContainer()&&t.reason==="flexEnabled")){var n=r.getResourceBundleFor("sap.ui.rta");if(t.reason==="isKeyUser"||t.reason==="pseudoAppVariant"){u(t.message,{title:n.getText("MSG_ADAPTATION_COULD_NOT_START")},"error")}else{u(n.getText("MSG_GENERIC_ERROR_MESSAGE",[t.message]),{title:n.getText("MSG_ADAPTATION_COULD_NOT_START")},"error")}e.error("UI Adaptation could not be started",t.message)}throw t})}return p});
//# sourceMappingURL=adaptationStarter.js.map