/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/base/Log","sap/ui/base/ManagedObject","sap/ui/core/Element","sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/fl/Layer"],function(e,t,n,a,r,o,i,m,c){"use strict";function d(e){var t=r.getAggregationInformation(e.getElement());if(t.elementId){var n=o.getOverlay(t.elementId);var a=n.getParentElementOverlay();var m=a?!!r.getAggregationInformation(a.getElement()).templateId:false;if(m){throw i.createError("CommandFactory#evaluateTemplateBinding","Multiple template bindings are not supported","sap.ui.rta")}var c=r.extractTemplateId(t);if(c){return{templateSelector:t.elementId,originalSelector:c,content:{boundAggregation:t.aggregation}}}}return undefined}function l(e,t){var n=typeof e==="string"?a.getElementById(e):e;var i=o.getOverlay(n);if(i){var m=r.getAggregationInformation(n);if(typeof t==="number"){m.stack[0].index=t}return r.extractTemplateId(m)}return n.getId()}function u(e){if(!e){throw new Error("adjustment for template failed")}}function s(e,n){var a;var r=false;var o=false;if(typeof n==="string"){a=n}else if(n){a=n.changeType;r=n.jsOnly===true;o=n.CAUTION_variantIndependent===true}if(!a){return false}e.setChangeType(a);e.setJsOnly(r);if(e.setVariantIndependent){e.setVariantIndependent(o)}else if(o){t.error("the variant independent Flag is not available for the action",a)}return true}function g(e,t,n){var a;if(n){a=n.getAction(t.name,e)}var r=a||{};Object.assign(r,{changeType:t.name});return r}function p(e){e.element=a.getElementById(l(e.element));u(e.element)}function f(e,t,n){var r=t.element||a.getElementById(t.element.id);var o=n.getActionDataFromAggregations("createContainer",r)[0];return o}function v(e){e.element=a.getElementById(l(e.element));u(e.element);e.parentId=l(e.parentId);u(e.parentId)}function y(e,t,n){var r=t.movedElements[0].element||a.getElementById(t.movedElements[0].id);var o=n.getAction("move",r);return o}function z(e){var t=e.movedElements.map(function(e){var t=a.getElementById(l(e.element,e.sourceIndex));u(t);return t});e.movedElements.forEach(function(e,n){e.element=t[n]});e.element=a.getElementById(l(e.element));u(e.element);e.source.parent=a.getElementById(l(e.source.parent));u(e.source.parent);e.target.parent=a.getElementById(l(e.target.parent));u(e.target.parent)}function E(e,t,n){return n.getAction("localReset",e)}function I(e,t,n){var a=t.renamedElement;var r=n.getAction("rename",a);return r}function C(e){e.element=a.getElementById(l(e.element));u(e.element);e.renamedElement=a.getElementById(l(e.renamedElement));u(e.renamedElement)}function B(e,t,a){var r=t.removedElement;if(!r){r=e}else if(!(r instanceof n)){throw new Error("No valid 'removedElement' found")}var o=a.getAction("remove",r);return o}function A(e){e.element=a.getElementById(l(e.element));u(e.element);e.removedElement=a.getElementById(l(e.removedElement));u(e.removedElement)}function h(e,t,n){var a=t.source;var r=n.getAction("combine",a);return r}function F(e){e.element=a.getElementById(l(e.element));u(e.element);e.source=a.getElementById(l(e.source));u(e.source);var t=e.combineElements.map(function(e){e=a.getElementById(l(e));u(e);return e});e.combineElements=t}function S(e,t,n){var a=t.source;var r=n.getAction("split",a);return r}function b(e){e.element=a.getElementById(l(e.element));u(e.element);e.parentElement=a.getElementById(l(e.parentElement));u(e.parentElement);e.source=a.getElementById(l(e.source));u(e.source)}function j(e,t,n){var a=t.element;return n.getAction("add",a,"delegate")}function V(e){e.element=a.getElementById(l(e.element));u(e.element);e.parentId=l(e.parentId);u(e.parentId)}function O(e,t,n){var a=t.element;var r=n.getAction("reveal",a);return r}function P(e){e.element=a.getElementById(l(e.element));u(e.element);if(e.revealedElementId){e.revealedElementId=l(e.revealedElementId);u(e.revealedElementId)}if(e.directParent){e.directParent=a.getElementById(l(e.directParent));u(e.directParent)}}function R(e,t,n){var a=n.getAction("add",t.element);if(a&&a.custom&&typeof a.custom.getItems==="function"){var r={...a.custom,changeOnRelevantContainer:t.changeOnRelevantContainer,changeType:t.changeType};delete t.changeOnRelevantContainer;return r}return undefined}function x(e,t,n){return n.getAction("addIFrame",t.element)||n.getActionDataFromAggregations("addIFrame",t.element)[0]}function T(){return"propertyBindingChange"}function w(){return"propertyChange"}var L={composite:{clazz:"sap/ui/rta/command/CompositeCommand",noSelector:true},property:{clazz:"sap/ui/rta/command/Property",adjustForBinding:p,configure:w},bindProperty:{clazz:"sap/ui/rta/command/BindProperty",configure:T},addXML:{clazz:"sap/ui/rta/command/AddXML",configure:g,adjustForBinding:p},addXMLAtExtensionPoint:{clazz:"sap/ui/rta/command/AddXMLAtExtensionPoint",configure:g,adjustForBinding:p},createContainer:{clazz:"sap/ui/rta/command/CreateContainer",configure:f,adjustForBinding:v},move:{clazz:"sap/ui/rta/command/Move",configure:y,adjustForBinding:z},remove:{clazz:"sap/ui/rta/command/Remove",configure:B,adjustForBinding:A},localReset:{clazz:"sap/ui/rta/command/LocalReset",configure:E},rename:{clazz:"sap/ui/rta/command/Rename",configure:I,adjustForBinding:C},addDelegateProperty:{clazz:"sap/ui/rta/command/AddProperty",configure:j,adjustForBinding:V},reveal:{clazz:"sap/ui/rta/command/Reveal",configure:O,adjustForBinding:P},customAdd:{clazz:"sap/ui/rta/command/CustomAdd",configure:R},combine:{clazz:"sap/ui/rta/command/Combine",configure:h,adjustForBinding:F},split:{clazz:"sap/ui/rta/command/Split",configure:S,adjustForBinding:b},resize:{clazz:"sap/ui/rta/command/Resize"},switch:{clazz:"sap/ui/rta/command/ControlVariantSwitch"},save:{clazz:"sap/ui/rta/command/ControlVariantSave"},saveAs:{clazz:"sap/ui/rta/command/ControlVariantSaveAs"},setTitle:{clazz:"sap/ui/rta/command/ControlVariantSetTitle"},configure:{clazz:"sap/ui/rta/command/ControlVariantConfigure"},settings:{clazz:"sap/ui/rta/command/Settings"},addLibrary:{clazz:"sap/ui/rta/command/appDescriptor/AddLibrary",noSelector:true},appDescriptor:{clazz:"sap/ui/rta/command/AppDescriptorCommand",noSelector:true},annotation:{clazz:"sap/ui/rta/command/AnnotationCommand",noSelector:true},addIFrame:{clazz:"sap/ui/rta/command/AddIFrame",configure:x},compVariantContent:{clazz:"sap/ui/rta/command/compVariant/CompVariantContent"},compVariantSaveAs:{clazz:"sap/ui/rta/command/compVariant/CompVariantSaveAs"},compVariantSwitch:{clazz:"sap/ui/rta/command/compVariant/CompVariantSwitch"},compVariantUpdate:{clazz:"sap/ui/rta/command/compVariant/CompVariantUpdate"}};function M(t,a,r,m,c,l){var u;a=a[0].toLowerCase()+a.slice(1);var g=L[a];var p=c;if(!g){return Promise.reject(i.createError("CommandFactory#getCommandFor",`Command '${a}' doesn't exist, check typing`,"sap.ui.rta"))}return new Promise(function(e){var t=g.clazz;sap.ui.require([t],function(t){e(t)})}).then(function(i){var c=t instanceof n;if(!g.noSelector&&!c){r={...r,selector:t}}r={...r,element:c?t:undefined,name:a};var f;if(g.configure){f=g.configure(t,r,m)}var v;if(c){v=o.getOverlay(t)}if(f&&f.changeOnRelevantContainer){Object.assign(r,{element:v.getRelevantContainer()});t=r.element;v=o.getOverlay(t)}var y;if(v&&t.sParentAggregationName){y=d(v)}if(y){if(g.adjustForBinding){g.adjustForBinding(r)}p=e(y,p)}u=new i(r);var z=true;if(g.configure){z=s(u,f)}if(z){return u.prepare(p,l,a)}return undefined}).then(function(e){if(e){return u}u.destroy();return undefined})}var U=n.extend("sap.ui.rta.command.CommandFactory",{metadata:{library:"sap.ui.rta",properties:{flexSettings:{type:"object"}}}});U.prototype.init=function(){this.setProperty("flexSettings",{layer:c.CUSTOMER,developerMode:true})};U.prototype.setFlexSettings=function(e){this.setProperty("flexSettings",{...this.getFlexSettings(),...e})};U.prototype.getCommandFor=function(e,t,n,a,r){return M(e,t,n,a,this.getFlexSettings(),r)};U.getCommandFor=function(e,t,n,a,r){r||={layer:c.CUSTOMER,developerMode:true};if(r.scenario||r.baseId){var o=m.buildLrepRootNamespace(r.baseId,r.scenario,r.projectId);r.rootNamespace=o;r.namespace=`${o}changes/`}return M(e,t,n,a,r)};return U},true);
//# sourceMappingURL=CommandFactory.js.map