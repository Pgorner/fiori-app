/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/dt/Util","sap/ui/fl/Utils","sap/ui/rta/plugin/Plugin","sap/ui/rta/Utils"],function(e,t,n,a,i){"use strict";var r=a.extend("sap.ui.rta.plugin.Settings",{metadata:{library:"sap.ui.rta",associations:{},events:{}}});var o="CTX_SETTINGS";r.prototype._isEditable=function(e){var t=this.getAction(e);if(t){if(t.handler){return this.hasStableId(e)}var n=Object.keys(t).some(function(n){var a=t[n];return a.handler&&this._checkRelevantContainerStableID(a,e)}.bind(this));if(n){return this.hasStableId(e)}}return false};r.prototype.isEnabled=function(e){const t=e[0];const n=this.getResponsibleElementOverlay(t);const a=this.getAction(n);if(!a){return false}if(typeof a.isEnabled!=="undefined"){if(typeof a.isEnabled==="function"){return a.isEnabled(n.getElement())}return a.isEnabled}return true};r.prototype._getUnsavedChanges=function(e,t){var n;var a=this.getCommandStack().getAllExecutedCommands().filter(function(a){n=a.getElementId&&a.getElementId()||a.getElement&&a.getElement().getId();return n===e&&t.indexOf(a.getChangeType())>=0}).map(function(e){return e.getPreparedChange()});return a};r.prototype._handleFlexChangeCommand=function(e,t,n,a){var i=e.changeSpecificData;var r;var o=e.selectorElement||e.selectorControl;var s;var u;if(o.controlType){s=o.controlType}else{u=o}return this.hasChangeHandler(i.changeType,u,s).then(function(e){if(t[0].getVariantManagement&&e&&!a.CAUTION_variantIndependent){r=t[0].getVariantManagement()}return this.getCommandFactory().getCommandFor(o,"settings",i,undefined,r)}.bind(this)).then(function(e){var t=a.runtimeOnly;if(e&&t){e.setRuntimeOnly(t)}return n.addCommand(e)})};r.prototype._handleAppDescriptorChangeCommand=function(e,t,n){var a=e.changeSpecificData;var i=e.appComponent;var r=i.getManifest();var o=r["sap.app"].id;return this.getCommandFactory().getCommandFor(t,"appDescriptor",{reference:o,appComponent:i,changeType:a.appDescriptorChangeType,parameters:a.content.parameters,texts:a.content.texts}).then(function(e){return n.addCommand(e)})};r.prototype._handleCompositeCommand=function(e,t,a,i){var r;return this.getCommandFactory().getCommandFor(t,"composite").then(function(e){r=e}).then(function(){return a.map(function(n){var a=n.changeSpecificData;if(a.changeType){return()=>this._handleFlexChangeCommand(n,e,r,i)}else if(a.appDescriptorChangeType){return()=>this._handleAppDescriptorChangeCommand(n,t,r)}return undefined},this)}.bind(this)).then(function(e){return n.execPromiseQueueSequentially(e)}).then(function(){if(r.getCommands().length>0){this.fireElementModified({command:r})}}.bind(this))};r.prototype.handler=function(e,n,a){n||={};var r=e[0].getElement();var{fnHandler:o}=n;o||=e[0].getDesignTimeMetadata().getAction("settings").handler;if(!o){throw new Error("Handler not found for settings action")}n.getUnsavedChanges=this._getUnsavedChanges.bind(this);n.styleClass=i.getRtaStyleClassName();return o(r,n).then(function(t){if(t.length>0){return this._handleCompositeCommand(e,r,t,a)}return undefined}.bind(this)).catch(function(e){throw t.propagateError(e,"Settings#handler","Error occurred during handler execution","sap.ui.rta.plugin")})};r.prototype.getMenuItems=async function(t){const n=t[0];const a=this.getResponsibleElementOverlay(n);let i=this.getAction(a);const r=[];if(i){const t=this.getRank("CTX_SETTINGS");if(i.handler){i={settings:i}}if(this._isEditableByPlugin(a)===undefined){await this.evaluateEditable([a],{onRegistration:false})}const n=Object.keys(i);n.forEach(function(n,d,c){const l=i[n];if(l.handler&&this._checkRelevantContainerStableID(l,a)&&this.isAvailable([a])){const e=c.length===1;r.push({id:e?o:o+d,rank:e?t:t+d,text:this.getActionText(a,l,o),icon:u(l),enabled:typeof l.isEnabled==="function"&&function(e){return l.isEnabled(e[0].getElement())}||l.isEnabled||this.isEnabled([a]),handler:function(e,t,n){n||={};n.fnHandler=e;return this.handler(t,n,l)}.bind(this,l.handler),submenu:s(l.submenu)})}else{e.warning(`Handler not found for settings action '${n}' or relevant container has no stable id`)}},this)}return r};function s(e){if(e){return e.map(function(e,t){return{id:e.key||`${o}_SUB_${t}`,icon:e.icon||"blank",text:e.name||"",enabled:e.hasOwnProperty("enabled")?e.enabled:true}})}return undefined}function u(t){var n="sap-icon://key-user-settings";var a=t.icon;if(!a){return n}if(typeof a!=="string"){e.error("Icon setting for settingsAction should be a string");return n}return a}r.prototype.getActionName=function(){return"settings"};return r});
//# sourceMappingURL=Settings.js.map