/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/dt/ElementUtil","sap/ui/fl/apply/api/DelegateMediatorAPI","sap/ui/rta/util/BindingsExtractor"],function(e,t,n,a,r,i){"use strict";function o(e,t,n){if(!e){return false}const a=e.getBindingInfo(t,n);let r=a&&a.path;if(!r){return false}if(r.indexOf(">")>-1){r=r.split(">").pop()}return r.indexOf("/")===0}function l(e,t,n,a){let r;if(t){r=e.getBindingInfo(n,a);if(typeof r.model==="string"&&r.model!==a){r=undefined}}else{r=e.getBindingContext(a)}return r}function u(e,t,n){const a=o(e,t,n);const r=l(e,a,t,n);if(r){return a?r.path:r.getPath()}}function c(e){const t=e.reduce(function(e,t){if(Array.isArray(t.properties)){e=e.concat(t.properties.map(function(e){e.parentPropertyName=t.label||t.name;return e}))}else{e.push(t)}return e},[]);return t}async function s(e,t,n){const a=await n.delegateInfo.delegate.getPropertyInfo({element:e,aggregationName:t,payload:n.delegateInfo.payload||{}});return c(a)}async function g(e,t){const a=await r.getReadDelegateForControl({control:e,modifier:n});if(a&&a.instance){return a.instance.getPropertyInfo({element:e,aggregationName:t,payload:a.payload||{}})}return[]}async function f(e,t,n){const a=n.addViaDelegate;let r;if(a){r=s.bind(null,e,t,a)}else{r=g.bind(null,e,t)}const i=await r();return _(i)}function d(e){return e.filter(function(e){return!(e.unsupported||e.hideFromReveal)})}function p(e){return{selected:false,label:e.label||e.name,parentPropertyName:e.parentPropertyName?e.parentPropertyName:"",duplicateName:e.duplicateName?e.duplicateName:false,tooltip:e.tooltip||e.label,originalLabel:"",type:"delegate",entityType:e.entityType,name:e.name,bindingPath:e.bindingPath}}function m(e){const t=e.element;const n=e.action;return{selected:false,label:t.__label||a.getLabelForElement(t,n.getLabel),tooltip:t.__tooltip||a.getLabelForElement(t,n.getLabel)||t.__bindingPath,parentPropertyName:t.__parentPropertyName?t.__parentPropertyName:"",duplicateName:t.__duplicateName?t.__duplicateName:false,originalLabel:t.__renamedLabel&&t.__label!==t.__originalLabel?t.__originalLabel:"",bindingPath:t.__bindingPath,type:"invisible",elementId:t.getId(),sourceAggregation:e.sourceAggregation}}function b(e,t,n,r){if(t&&t!==e){const i=u(e,n,r);return a.findAllSiblingsInContainer(e,t).filter(function(e){return i===u(e,n,r)})}return[e]}function _(e){e.forEach(function(e,t,n){if(e.duplicateName!==true){for(let a=t+1;a<n.length-1;a++){if(e.label===n[a].label){e.duplicateName=true;n[a].duplicateName=true}}}});return e}function P(e,t){return t.some(function(t){return t.label===e.__label})}function y(e){return Array.isArray(e)&&e.length>0}function h(e,t){return t.sort(function(e,t){return!!t.hideFromReveal-!!e.hideFromReveal}).filter(function(t){return e.some(function(e){return e===t.bindingPath||e.startsWith(`${t.bindingPath}/`)})}).pop()}function N(t){return e(t)?t.parts[0].path:!!t.getPath&&t.getPath()}function I(e,t,n,a){const r=e.getModel(n);const o=b(e,t.relevantContainer,a,n);let l=[];o.forEach(function(e){l=l.concat(i.getBindings({element:e,model:r,parent:e.getParent()}).map(N))});return l}function L(e,t){const n={element:e.relevantContainer,aggregationName:t,payload:e.delegateInfo.payload||{}};return e.delegateInfo.delegate.getRepresentedProperties(n)}async function A(e,t,n,a){const r=await L(t,a);if(r===undefined){return I(e,t,n,a)}let i=[];r.forEach(function(e){i=i.concat(e.bindingPaths)});return i}function v(e,n,a,r){const i=!!t.get("delegateInfo.delegate.getRepresentedProperties",n);if(i){return A(e,n,a,r)}return I(e,n,a,r)}function E(e,t){e.__originalLabel=t.label;e.__tooltip=t.tooltip;e.__bindingPath=t.name;if(e.__label!==e.__originalLabel){e.__renamedLabel=true}if(t.parentPropertyName){e.__parentPropertyName=t.parentPropertyName}}function R(e,n){const a=!!t.get("delegateInfo.delegate.getRepresentedProperties",e);if(a){return L(e,n)}}function B(e,t){let n;t.some(function(t){if(t.id===e.getId()){n=t;return true}});return n.bindingPaths||[]}function F(e,t,n,a){if(!y(n)){return true}const r=h(n,t);if(r){if(r.hideFromReveal){return false}if(a){E(e,r)}return true}return!a}function C(e,t,n,a,r,o){const l=a.addViaDelegate;const c=w(l);const s=e.getModel(c);let g=true;let f=[];const d=n.element;const p=n.action.depthOfRelevantBindings;if(r){f=B(d,r)}else if(u(e,t,c)===u(d,t,c)){f=i.collectBindingPaths(d,s,null,p).bindingPaths}else if(l&&i.getBindings({element:d,model:s}).length>0){g=false}if(g){d.__duplicateName=P(d,o);g=F(d,o,f,!!l)}return g}function w(e){return t.get("delegateInfo.payload.modelName",e)}const D={async enhanceInvisibleElements(e,t){const n=t.reveal;const r=t.addViaDelegate;const i=e.getMetadata().getAggregation();const o=i?i.name:t.aggregation;const[l,u]=await Promise.all([f(e,o,t),R(r,o)]);const c=[];const s=n.elements||[];s.forEach(function(n){const r=n.element;const i=n.action;r.__label=a.getLabelForElement(r,i.getLabel);const s=C(e,o,n,t,u,l);if(s){c.push({element:r,action:i,sourceAggregation:n.sourceAggregation})}});return c.map(m)},async getUnrepresentedDelegateProperties(e,t){const n=w(t);const a=e.getMetadata().getAggregation();const r=a?a.name:t.action.aggregation;const[i,o]=await Promise.all([s(e,r,t),v(e,t,n,r)]);const l=t.action.filter?t.action.filter:function(){return true};let u=d(i);u=u.filter(function(e){let n=false;if(o){n=o.some(function(t){return t===e.bindingPath})}return!n&&l(t.relevantContainer,e)});u=_(u);return u.map(p)}};return D});
//# sourceMappingURL=AdditionalElementsAnalyzer.js.map