/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/i18n/Localization","./DocuInfo","sap/base/Log"],function(e,t,o,a){"use strict";var n=t.getLanguageTag().language;const i=["sap.ui.documentation.sdk.view.NotFound","sap.ui.documentation.sdk.view.SampleNotFound"];var s=function(e,t,o,a){o=o||window.location.href;a=a||document.referrer;const i=new URL(o),s=t.getRouteTopLevelTitle(e);this.url=o;this.name=i.pathname+i.hash;this.section=s||"/";this.title=undefined;this.language=n;this.country="glo";this.referrer=document.referrer};s.prototype.toObject=function(){var e={};for(var t in this){if(this.hasOwnProperty(t)&&this[t]!==undefined){e[t]=this[t]}}return e};const r={DOCUMENTATION_TOPIC:"topicId",API_REFERENCE:"apiSpecialRoute",GLOBAL_SEARCH:"search"};const u={code:"Source code for sample",sample:"Sample",experimental:"Experimental APIs",deprecated:"Deprecated APIs",since:"Index By Version",news:"News",releaseNotes:"Change Log",ReleaseNotesLegacyRoute:"Change Log"};var h=e.extend("sap.ui.documentation.sdk.controller.util.UsageTracker",{constructor:function(e){this._oComponent=e;this._oRouter=e.getRouter();this._oConfig=e.getConfig();this._oLastRouteParameters=null;this._isStarted=false},start:function(e){if(this._isStarted){return}this._initRemoteServiceConnector();this._attachListenersForUserNavigations();t.attachChange(this._onLanguageChange);this._logPrecedingRouteVisits(e);this._isStarted=true},stop:function(){if(!this._isStarted){return}this._detachListenersForUserNavigations();t.detachChange(this._onLanguageChange);this._isStarted=false},_initRemoteServiceConnector:function(){window.adobeDataLayer=window.adobeDataLayer||[];this._logSessionStarted()},_logPrecedingRouteVisits:function(e){if(e){e.forEach(function(e){switch(e.eventId){case"routeMatched":{this._logRouteMatched(e);break}case"bypassed":{this._logRouteNotFound(e);break}case"_navToWithoutHash":{this._logNavToWithoutHash(e);break}}},this)}},_onRouteMatched:function(e){this._logRouteMatched(e.getParameters())},_logRouteMatched:function(e){if(this._areEqualRoutes(e,this._oLastRouteParameters)){return}if(this._isLegacyRoute(e)){return}this._oLastRouteParameters=e;this._getPageInfoFromRoute(e,function(e){this._logPageVisit(e);this._publishLoggedInfo(true)}.bind(this))},_onRouteNotFound:function(e){this._logRouteNotFound(e.getParameters())},_logRouteNotFound:function(e){this._logPageNotFound(e.hash);this._publishLoggedInfo(true)},_onNavToWithoutHash:function(e){this._logNavToWithoutHash(e.getParameters())},_logNavToWithoutHash:function(e){var t=e.viewName;if(i.includes(t)){this._logPageDataNotFound();this._publishLoggedInfo(true)}},_areEqualRoutes:function(e,t){return e?.name===t?.name&&JSON.stringify(e?.arguments)===JSON.stringify(t?.arguments)},_isLegacyRoute:function(e){return e.name.toLowerCase().includes("legacy")},_getPageInfoFromRoute:function(e,t){var o=e.config,a=new s(o,this._oRouter);this._getPageTitleFromRoute(e,function(e){a.title=e;t(a)})},_getPageTitleFromRoute:function(e,t){var a=e.name,n=e.arguments,i;if(a===r.DOCUMENTATION_TOPIC){var s=n.id;o.getDocumentTitle(s,this._oConfig).then(t).catch(t)}else if(a===r.API_REFERENCE){i=this._oRouter._decodeSpecialRouteArguments(n).id;t(i)}else if(a===r.GLOBAL_SEARCH){i=this._composeSearchPageTitleFromRoute(e);t(i)}else{i=this._composeDefaultPageTitleFromRoute(e);t(i)}},_composeSearchPageTitleFromRoute:function(e){var t='Global Search Resuls for "'+this._getAllStringValues(e.arguments)+'"',o=e.arguments["?options"]?.category,a={apiref:"API Reference",entity:"Samples",topics:"Documentation",external:"External Resources"}[o];return a?t+" in "+a:t},_composeDefaultPageTitleFromRoute:function(e){var t=[],o=this._getRouteTitle(e),a=this._getAllStringValues(e.arguments).join(" ");if(o){t.push(o)}if(a){t.push(a)}return t.join(" ")||e.name},_getRouteTitle:function(e){return u[e.name]||this._oRouter.getRouteTopLevelTitle(e.config)},_getAllStringValues:function(e){return Object.values(e).filter(function(e){return typeof e==="string"})},_logSessionStarted:function(){window.adobeDataLayer.push({event:"globalDL",site:{name:"sapui5"},user:{loginStatus:"no"}})},_logPageVisit:function(e){window.adobeDataLayer.push({event:"pageView",page:e.toObject()})},_logPageNotFound:function(e){window.adobeDataLayer.push({event:"errorPage",page:{name:"notFound",section:"errorPage"},error:{type:404,pageUrl:window.location.href,pageName:e,description:"page not found"}})},_logPageDataNotFound:function(){var e;if(this._oLastRouteParameters){var t=this._oRouter.getRouteConfig(this._oLastRouteParameters.name);e=new s(t,this._oRouter)}else{var o=new URL(window.location.href);e={url:window.location.href,name:o.pathname+o.hash,section:"/"}}window.adobeDataLayer.push({event:"errorPage",page:{name:"notFound",section:"errorPage"},error:{type:404,pageUrl:e.url,pageName:e.name,pageSection:e.section,description:"page data not found"}});this._oLastRouteParameters=null},_publishLoggedInfo:function(e){window.adobeDataLayer.push({event:e?"stBeaconReady":"stlBeaconReady"})},_onLanguageChange:function(e){n=t.getLanguageTag().language},_attachListenersForUserNavigations:function(){this._oRouter.attachRouteMatched(this._onRouteMatched,this);this._oRouter.attachBypassed(this._onRouteNotFound,this);this._oRouter.attachEvent("_navToWithoutHash",this._onNavToWithoutHash,this)},_detachListenersForUserNavigations(){this._oRouter.detachRouteMatched(this._onRouteMatched,this);this._oRouter.detachBypassed(this._onRouteNotFound,this);this._oRouter.detachEvent("_navToWithoutHash",this._onNavToWithoutHash)},exit:function(){this.stop();this._oRouter=null}});return h});
//# sourceMappingURL=UsageTracker.js.map