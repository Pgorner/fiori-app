/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["sap/base/Log","sap/m/MessageBox","sap/ui/core/library","sap/ui/core/message/MessageType","../i18n","./errors","../sinaNexTS/core/errors"],function(r,e,t,o,s,n,a){"use strict";function i(r){return r&&r.__esModule&&typeof r.default!=="undefined"?r.default:r}const c=t["TextDirection"];const l=i(s);const h=n["ESHUIError"];const d=a["DataSourceAttributeMetadataNotFoundError"];const E=a["ServerError"];const u=a["ServerErrorCode"];const f=a["SinaError"];class g{label;searchModel;static instance;externalOnErrorHandler;_oLogger=(()=>r.getLogger("sap.esh.search.ui.error.ErrorHandler"))();static getInstance(r){if(!g.instance){g.instance=new g(r)}return g.instance}constructor(r){this.label=r?.label;this.searchModel=r?.model;this.externalOnErrorHandler=r?.onErrorHandler}onError(r,e){if(typeof this.externalOnErrorHandler==="function"){try{this.externalOnErrorHandler(r,e)}catch(r){this.handleError(r,e)}}else{this.handleError(r,e)}}onErrorDeferred(r,e){this.onError(r,e);return Promise.resolve(true)}handleError(r,e){this.logError(r);this.showError(r,e)}setSearchModel(r){this.searchModel=r}setExternalOnErrorHandler(r){this.externalOnErrorHandler=r}getErrorTextGeneric(r){let e=r.name;e+=" "+r;if(typeof r.stack!=="undefined"){e="\n"+r.stack}if(r.previous instanceof Error){e+=`\n--\x3e Previous error was: ${this.getErrorText(r.previous)}`}return e}getErrorTextEsh(r){let e=r.name;if(r instanceof E){e+=" code:"+r.code}e+=" "+r.message;if(r?.details){e+="\n"+r.details}if(r?.solution){e+="\n"+r.solution}if(typeof r.stack!=="undefined"){e+="\n"+r.stack}if(r.previous instanceof Error){e+=`\n--\x3e Previous error was: ${this.getErrorText(r.previous)}`}return e}getErrorText(r){if(r instanceof f||r instanceof h){return this.getErrorTextEsh(r)}else{return this.getErrorTextGeneric(r)}}logError(r){let e=this.label?this.label+": ":"";e+=this.getErrorText(r)+"\n";if(this.searchModel&&this.searchModel.sinaNext){e+=this.searchModel.sinaNext.getDebugInfo()+"\n"}this._oLogger.error(e,"ErrorHandler")}convertErrorToMessage(r,e){if(r instanceof h||r instanceof f){return this.convertErrorToMessageEsh(r,e)}else{return this.convertErrorToMessageGeneric(r)}}convertErrorToMessageGeneric(r){let e,t;switch(r.name){case"TypeError":e=l.getText("error.TypeError.message");t=l.getText("error.TypeError.solution");break;case"URIError":e=l.getText("searchError");t=l.getText("error.URIError.solution");break;default:e=""+r;t=""}return{title:e,description:t,type:o.Error}}convertErrorToMessageEsh(r,e){if(r instanceof E&&r.code===u.E300||r instanceof d){this.showReloadPopup();return null}let t=o.Error;if(e?.showMinorErrorsAsWarnings){switch(r.name){case"ServerError":switch(r.code){case u.E100:t=o.Warning;break;case u.E400:t=o.Warning;break}}}const s=r.message||l.getText("searchError");const n=[];if(r.details){n.push(r.details)}if(r.solution){n.push(r.solution)}let a="";if(r.name==="ServerError"){a=" "+r.code}n.push("("+r.name+a+")");return{title:s,description:n.join("\n"),type:t}}showReloadPopup(){e.confirm(l.getText("searchModelChanged"),{onClose:r=>{if(r==="OK"){if(this.searchModel){this.searchModel.resetDataSource(false);this.searchModel.resetAllFilterConditions(false);const r=this.searchModel.createSearchNavigationTargetCurrentState();window.location.href=r.targetUrl}window.location.reload()}}})}showMessageBox(r){const t=r.title+"\n"+r.description;const s={onClose:null,styleClass:"",initialFocus:null,textDirection:c.Inherit};switch(r.type){case o.Information:e.information(t,s);break;case o.Warning:e.warning(t,s);break;case o.Error:e.error(t,s);break;default:e.error(t,s);break}}showError(r,e){const t=this.convertErrorToMessage(r,e);if(!t){return}if(this.searchModel){this.searchModel.pushUIMessage(t)}else{this.showMessageBox(t)}}}return g})})();
//# sourceMappingURL=ErrorHandler.js.map