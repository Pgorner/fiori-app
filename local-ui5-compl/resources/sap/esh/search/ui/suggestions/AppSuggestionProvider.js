/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../i18n","sap/esh/search/ui/SearchHelper","./SuggestionType"],function(e,t,s){"use strict";function i(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const o=i(e);const n=s["Type"];const r=s["SuggestionType"];class a{model;suggestApplications;suggestionHandler;constructor(e){this.model=e.model;this.suggestionHandler=e.suggestionHandler;this.suggestApplications=t.refuseOutdatedRequests(this.suggestApplicationsNotDecorated)}abortSuggestions(){this.suggestApplications.abort()}combineSuggestionsWithIdenticalTitle(e){let t;const s={};for(let i=0;i<e.length;i++){t=e[i];const r=s[t.title+t.subtitle];if(r){if(!r.combinedSuggestionExists){const e={title:"combinedAppSuggestion"+i,subtitle:t.subtitle,sortIndex:r.sortIndex,url:this.model.createSearchNavigationTarget({top:this.model.appTopDefault,filter:this.model.sinaNext.createFilter({dataSource:this.model.appDataSource,searchTerm:t.title}),encodeFilter:false}).targetUrl,label:o.getText("suggestion_in_apps",t.label),icon:"sap-icon://search",keywords:"",uiSuggestionType:n.App};const a=o.getText("suggestion_in_apps",[""]);e.label=e.label.replace(a,"<i>"+a+"</i>");s[e.title+e.subtitle]=e;r.combinedSuggestionExists=true}}else{t.sortIndex=i;s[t.title+t.subtitle]=t}}e=[];for(const i in s){if(Object.prototype.hasOwnProperty.call(s,i)){t=s[i];if(!t.combinedSuggestionExists){e.push(t)}}}e.sort(function(e,t){return e.sortIndex-t.sortIndex});return e}addAsterisk4ShowAllApps(e){const t=e.match(/\S+/g);if(t.length>0){let s;const i=[];for(let e=0;e<t.length;e++){s=t[e];if(s&&s.lastIndexOf("*")!==s.length-1){i.push(s+"*")}else{i.push(s)}}e=i.join(" ")}return e}createShowMoreSuggestion(e){let t=o.getText("showAllNApps",[e]);t=t.replace(/"/g,"");const s=t;const i="<i>"+t+"</i>";return{title:t,tooltip:s,label:i,dataSource:this.model.appDataSource,labelRaw:this.model.getProperty("/uiFilter/searchTerm"),uiSuggestionType:n.SearchTermData,searchTerm:this.model.getProperty("/uiFilter/searchTerm")||""}}async getSuggestions(e){const t=this.model.getDataSource();const s=this.model.userCategoryManager;const i=s?.isFavActive()&&s?.getCategory("MyFavorites")?.includeApps;if(t!==this.model.allDataSource&&t!==this.model.appDataSource&&!(t===this.model.favDataSource&&i)){return[]}if(e.searchTerm.length<1){return[]}const o=this.model.getProperty("/uiFilter/searchTerm");const a=await this.suggestApplications(o);let l=a.getElements();l=this.combineSuggestionsWithIdenticalTitle(l);let u=[];for(const e of l){const t={...e,uiSuggestionType:n.App,dataSource:this.model.appDataSource,position:r.properties.App.position,key:r.App+e.url+e.icon};u.push(t)}const c=this.suggestionHandler.getSuggestionLimit(n.App);u=u.slice(0,c);if(a.totalResults>c&&t===this.model.appDataSource){u.push(this.createShowMoreSuggestion(a.totalResults))}return u}suggestApplicationsNotDecorated(e){return window.sap.ushell.Container.getServiceAsync("Search").then(function(t){return t.queryApplications({searchTerm:e,suggestion:true})})}}return a})})();
//# sourceMappingURL=AppSuggestionProvider.js.map