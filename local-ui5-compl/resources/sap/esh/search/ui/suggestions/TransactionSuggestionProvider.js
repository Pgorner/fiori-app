/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../sinaNexTS/sina/DataSourceType","./SuggestionType","./SinaObjectSuggestionFormatter","../flp/BackendSystem","../flp/FrontendSystem","sap/ui/Device"],function(t,e,s,i,o,n){"use strict";function a(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const r=t["DataSourceType"];const u=a(e);const g=e["Type"];const c=a(s);const l=a(i);const h=a(o);class S{model;suggestionHandler;suggestionLimit;sinaNext;suggestionQuery;transactionsDS;suggestionStartingCharacters;suggestionFormatter=(()=>new c)();transactionSuggestions=[];constructor(t){this.model=t.model;this.suggestionHandler=t.suggestionHandler;this.suggestionLimit=n.system.phone?5:7;this.sinaNext=this.model.sinaNext;this.suggestionQuery=this.sinaNext.createSuggestionQuery();this.transactionsDS=this.sinaNext.createDataSource({id:"CD$ALL~ESH_TRANSACTION~",label:"Transactions",type:r.BusinessObject});this.suggestionStartingCharacters=this.model.config.suggestionStartingCharacters}abortSuggestions(){this.suggestionQuery.abort()}getUrl(t){let e="#Shell-startGUI?sap-ui2-tcode="+t;const s=l.getSystem(this.model);if(s&&!s.equals(h.getSystem())){e=`#Shell-startGUI?sap-system=sid(${s.id})&sap-ui2-tcode=${t}`}return e}async getSuggestions(t){if(!this.model.config.searchBusinessObjects){return Promise.resolve([])}const e=this.model.getDataSource();const s=this.model.userCategoryManager;const i=s?.isFavActive()&&s?.getCategory("MyFavorites")?.includeApps;if(e!==this.model.allDataSource&&e!==this.model.appDataSource&&!(e===this.model.favDataSource&&i)){return Promise.resolve([])}t=t.clone();let o=t.searchTerm;if(o.toLowerCase().indexOf("/n")===0||o.toLowerCase().indexOf("/o")===0){o=o.slice(2);t.searchTerm=o}this.transactionSuggestions=[];if(o.length<this.suggestionStartingCharacters){return Promise.resolve([])}this.prepareSuggestionQuery(t);const n=await this.suggestionQuery.getResultSetAsync();const a=n.items;for(const e of a){const s={uiSuggestionType:g.Transaction,dataSource:this.transactionsDS,position:u.properties.Transaction.position,key:e.object.attributesMap.TCODE.value,searchTerm:t.searchTerm,url:this.getUrl(e.object.attributesMap.TCODE.value),icon:"sap-icon://generate-shortcut",label:e.object.attributesMap.TCDTEXT.valueHighlighted,type:e.type,calculationMode:e.calculationMode,object:e.object,sina:e.sina};const i=await window.sap.ushell.Container.getServiceAsync("CrossApplicationNavigation");const o=await i.isNavigationSupported([{target:{shellHash:s.url}}]);if(o[0].supported){this.suggestionFormatter.format(this,s)}}const r=this.suggestionHandler.getSuggestionLimit(g.Transaction);this.transactionSuggestions=this.transactionSuggestions.slice(0,r);return this.transactionSuggestions}addSuggestion(t){this.transactionSuggestions.push(t)}prepareSuggestionQuery(t){this.suggestionQuery.resetResultSet();this.suggestionQuery.setFilter(t);this.suggestionQuery.setDataSource(this.transactionsDS);this.suggestionQuery.setTypes([this.sinaNext.SuggestionType.Object]);this.suggestionQuery.setCalculationModes([this.sinaNext.SuggestionCalculationMode.Data]);this.suggestionQuery.setTop(10)}}return S})})();
//# sourceMappingURL=TransactionSuggestionProvider.js.map