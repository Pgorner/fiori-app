/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){
/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./pivotTableParser","./typeConverter","../../sina/ComparisonOperator","../../sina/SearchQuery","../../sina/LogicalOperator","../../core/errors"],function(e,t,a,r,s,i){"use strict";const u=a["ComparisonOperator"];const o=r["SearchQuery"];const l=s["LogicalOperator"];const n=i["FacetsParseError"];class c{provider;sina;constructor(e){this.provider=e;this.sina=e.sina}parse(e,t){const a=[];if(!t.ResultsetFacets||!t.ResultsetFacets.Elements){return[]}for(let r=0;r<t.ResultsetFacets.Elements.length;r++){const s=t.ResultsetFacets.Elements[r];const i=s.Metadata.Cube.ObjectName;if(i==="$$DataSources$$"){a.push(this.parseDataSourceFacet(e,s))}else{if(e.filter.dataSource.type===e.sina.DataSourceType.Category){continue}a.push(this.parseChartFacet(e,s))}}return Promise.all(a)}parseDataSourceFacet(t,a){let r=t;if(t instanceof o){r=this.sina.createDataSourceQuery({dataSource:t.filter.dataSource,filter:t.filter.clone(),nlq:t.nlq})}const s=e.parse(a.ResultSet);const i=[];for(let e=0;e<s.cells.length;e++){const t=s.cells[e];let a=this.sina.getDataSource(t.$$DataSource$$[0].Value);if(!a){a=this.sina._createDataSource({type:this.sina.DataSourceType.Category,id:t.$$DataSource$$[0].Value,label:t.$$DataSource$$[0].ValueFormatted})}i.push(this.sina._createDataSourceResultSetItem({dataSource:a,dimensionValueFormatted:t.$$DataSource$$[0].ValueFormatted,measureValue:t.Value,measureValueFormatted:t.ValueFormatted}))}const u=this.sina._createDataSourceResultSet({title:t.filter.dataSource.label,items:i,query:r});if(t instanceof o){return r._setResultSet(u)}return u}createAttributeFilterCondition(e,a,r){switch(r.$$AttributeValue$$.length){case 2:return this.sina.createSimpleCondition({attribute:e,value:t.ina2Sina(a.type,r.$$AttributeValue$$[0].Value),attributeLabel:a.label,valueLabel:r.$$AttributeValue$$[0].ValueFormatted});case 3:{const s=this.sina.createComplexCondition({attributeLabel:a.label,valueLabel:r.$$AttributeValue$$[0].ValueFormatted,operator:l.And});const i=[];if(r.$$AttributeValue$$[1].Value){i.push(this.sina.createSimpleCondition({attribute:e,operator:u.Ge,value:t.ina2Sina(a.type,r.$$AttributeValue$$[1].Value)}))}if(r.$$AttributeValue$$[2].Value){i.push(this.sina.createSimpleCondition({attribute:e,operator:u.Le,value:t.ina2Sina(a.type,r.$$AttributeValue$$[2].Value)}))}s.conditions=i;return s}default:throw new n}}parseChartFacet(t,a){const r=this.sina.getDataSource(a.Metadata.Cube.DataSource.ObjectName);const s=a.Metadata.Cube.ObjectName;const i=r.getAttributeMetadata(s);let u=t;if(t instanceof o){const e=t.filter.clone();e.setDataSource(r);e.setRootCondition(t.filter.rootCondition.clone());u=this.sina.createChartQuery({filter:e,dimension:a.Metadata.Cube.ObjectName,nlq:t.nlq})}const l=e.parse(a.ResultSet);const n=[];for(let e=0;e<l.cells.length;e++){const t=l.cells[e];n.push(this.sina._createChartResultSetItem({filterCondition:this.createAttributeFilterCondition(s,i,t),dimensionValueFormatted:t.$$AttributeValue$$[0].ValueFormatted||t.$$AttributeValue$$[0].Value,measureValue:t.Value,measureValueFormatted:t.ValueFormatted}))}const c=this.sina._createChartResultSet({title:i.label,items:n,query:u});if(t instanceof o){return u._setResultSet(c)}return c}}var $={__esModule:true};$.FacetParser=c;return $})})();
//# sourceMappingURL=FacetParser.js.map