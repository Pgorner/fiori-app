/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){
/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["../core/core","../core/errors","../core/util","./AttributeType","./AttributeFormatType","./AttributeGroupTextArrangement","./DataSourceType","./MatchingStrategy","./LogicalOperator","./ComparisonOperator","./FacetType","./SuggestionCalculationMode","./SuggestionType","./SortOrder","./ConditionType","../providers/tools/cds/CDSAnnotationsParser","../providers/tools/sors/NavigationTargetGenerator","./SearchResultSet","./SearchResultSetItem","./SearchResultSetItemAttribute","./ObjectSuggestion","./SearchQuery","./ChartQuery","./SuggestionQuery","./DataSourceQuery","./Filter","./ComplexCondition","./SimpleCondition","./AttributeMetadata","./AttributeGroupMetadata","./AttributeGroupMembership","./SearchResultSetItemAttributeGroup","./SearchResultSetItemAttributeGroupMembership","./SearchTermSuggestion","./SearchTermAndDataSourceSuggestion","./DataSourceSuggestion","./SuggestionResultSet","./ChartResultSet","./DataSourceResultSet","./ChartResultSetItem","./DataSourceResultSetItem","./Capabilities","./Configuration","./NavigationTarget","./DataSource","./UserCategoryDataSource","../providers/tools/ItemPostParser","../providers/tools/fiori/SuvNavTargetResolver","../providers/tools/fiori/FioriIntentsResolver","./formatters/ResultValueFormatter","./formatters/NavtargetsInResultSetFormatter","./formatters/HierarchyResultSetFormatter","./FilteredDataSource","../providers/inav2/Provider","../providers/abap_odata/Provider","./HierarchyQuery","./HierarchyNode","./HierarchyResultSet","../providers/inav2/typeConverter","./HierarchyNodePath","./HierarchyDisplayType","./formatters/SuggestionResultValueFormatter","./SearchTermAISuggestion"],function(t,e,r,a,i,s,o,c,n,u,h,S,l,y,g,m,p,d,b,F,f,C,R,v,D,A,T,O,_,j,I,N,w,M,H,P,G,Q,L,E,x,J,B,V,U,k,$,z,q,K,W,X,Y,Z,tt,et,rt,at,it,st,ot,ct,nt){"use strict";const ut=a["AttributeType"];const ht=i["AttributeFormatType"];const St=s["AttributeGroupTextArrangement"];const lt=o["DataSourceSubType"];const yt=o["DataSourceType"];const gt=c["MatchingStrategy"];const mt=n["LogicalOperator"];const pt=u["ComparisonOperator"];const dt=h["FacetType"];const bt=S["SuggestionCalculationMode"];const Ft=l["SuggestionType"];const ft=y["SortOrder"];const Ct=g["ConditionType"];const Rt=m["CDSAnnotationsParser"];const vt=p["NavigationTargetGenerator"];const Dt=d["SearchResultSet"];const At=b["SearchResultSetItem"];const Tt=F["SearchResultSetItemAttribute"];const Ot=f["ObjectSuggestion"];const _t=C["SearchQuery"];const jt=R["ChartQuery"];const It=v["SuggestionQuery"];const Nt=D["DataSourceQuery"];const wt=A["Filter"];const Mt=T["ComplexCondition"];const Ht=O["SimpleCondition"];const Pt=_["AttributeMetadata"];const Gt=j["AttributeGroupMetadata"];const Qt=I["AttributeGroupMembership"];const Lt=N["SearchResultSetItemAttributeGroup"];const Et=w["SearchResultSetItemAttributeGroupMembership"];const xt=M["SearchTermSuggestion"];const Jt=H["SearchTermAndDataSourceSuggestion"];const Bt=P["DataSourceSuggestion"];const Vt=G["SuggestionResultSet"];const Ut=Q["ChartResultSet"];const kt=L["DataSourceResultSet"];const $t=E["ChartResultSetItem"];const zt=x["DataSourceResultSetItem"];const qt=J["Capabilities"];const Kt=B["Configuration"];const Wt=V["NavigationTarget"];const Xt=U["DataSource"];const Yt=k["UserCategoryDataSource"];const Zt=$["ItemPostParser"];const te=z["SuvNavTargetResolver"];const ee=q["FioriIntentsResolver"];const re=K["ResultValueFormatter"];const ae=W["NavtargetsInResultSetFormatter"];const ie=X["HierarchyResultSetFormatter"];const se=Y["FilteredDataSource"];const oe=Z["Provider"];const ce=tt["Provider"];const ne=et["HierarchyQuery"];const ue=rt["HierarchyNode"];const he=at["HierarchyResultSet"];const Se=st["HierarchyNodePath"];const le=ot["HierarchyDisplayType"];const ye=ct["SuggestionResultValueFormatter"];const ge=e["ESHNoBusinessObjectDatasourceError"];const me=nt["SearchTermAISuggestion"];class pe{errorList=[];inav2TypeConverter;provider;createSearchNavigationTarget;createSearchQuery;createChartQuery;createHierarchyQuery;createSuggestionQuery;createDataSourceQuery;createFilter;createComplexCondition;createSimpleCondition;createHierarchyNode;createHierarchyNodePath;_createAttributeMetadata;_createAttributeGroupMetadata;_createAttributeGroupMembership;_createSearchResultSetItemAttribute;_createSearchResultSetItemAttributeGroup;_createSearchResultSetItemAttributeGroupMembership;_createSearchResultSetItem;_createSearchResultSet;_createSearchTermSuggestion;_createSearchTermAISuggestion;_createSearchTermAndDataSourceSuggestion;_createDataSourceSuggestion;_createObjectSuggestion;_createSuggestionResultSet;_createChartResultSet;_createHierarchyResultSet;_createChartResultSetItem;_createDataSourceResultSetItem;_createCapabilities;_createConfiguration;_createNavigationTarget;createNavigationTarget;_createSorsNavigationTargetGenerator;_createFioriIntentsResolver;_createCDSAnnotationsParser;_createItemPostParser;_createSuvNavTargetResolver;searchResultSetFormatters;suggestionResultSetFormatters;chartResultSetFormatters;metadataFormatters;dataSources;dataSourceMap;allDataSource;DataSourceType;HierarchyDisplayType;DataSourceSubType;isDummyProvider;configurationPromise;capabilities;core;errors;util;SortOrder;ComparisonOperator;LogicalOperator;AttributeGroupTextArrangement;AttributeType;AttributeFormatType;FacetType;SuggestionType;ConditionType;SuggestionCalculationMode;MatchingStrategy;configuration;constructor(a){this.core=t;this.errors=e;this.util=r;this.inav2TypeConverter=it;this.provider=a;this.createSearchQuery=this.createSinaObjectFactory(_t);this.createChartQuery=this.createSinaObjectFactory(jt);this.createHierarchyQuery=this.createSinaObjectFactory(ne);this.createSuggestionQuery=this.createSinaObjectFactory(It);this.createDataSourceQuery=this.createSinaObjectFactory(Nt);this.createFilter=this.createSinaObjectFactory(wt);this.createComplexCondition=this.createSinaObjectFactory(Mt);this.createSimpleCondition=this.createSinaObjectFactory(Ht);this.createHierarchyNode=this.createSinaObjectFactory(ue);this.createHierarchyNodePath=this.createSinaObjectFactory(Se);this._createAttributeMetadata=this.createSinaObjectFactory(Pt);this._createAttributeGroupMetadata=this.createSinaObjectFactory(Gt);this._createAttributeGroupMembership=this.createSinaObjectFactory(Qt);this._createSearchResultSetItemAttribute=this.createSinaObjectFactory(Tt);this._createSearchResultSetItemAttributeGroup=this.createSinaObjectFactory(Lt);this._createSearchResultSetItemAttributeGroupMembership=this.createSinaObjectFactory(Et);this._createSearchResultSetItem=this.createSinaObjectFactory(At);this._createSearchResultSet=this.createSinaObjectFactory(Dt);this._createSearchTermSuggestion=this.createSinaObjectFactory(xt);this._createSearchTermAISuggestion=this.createSinaObjectFactory(me);this._createSearchTermAndDataSourceSuggestion=this.createSinaObjectFactory(Jt);this._createDataSourceSuggestion=this.createSinaObjectFactory(Bt);this._createObjectSuggestion=this.createSinaObjectFactory(Ot);this._createSuggestionResultSet=this.createSinaObjectFactory(Vt);this._createChartResultSet=this.createSinaObjectFactory(Ut);this._createHierarchyResultSet=this.createSinaObjectFactory(he);this._createChartResultSetItem=this.createSinaObjectFactory($t);this._createDataSourceResultSetItem=this.createSinaObjectFactory(zt);this._createCapabilities=this.createSinaObjectFactory(qt);this._createConfiguration=this.createSinaObjectFactory(Kt);this._createNavigationTarget=this.createSinaObjectFactory(Wt);this.createNavigationTarget=this.createSinaObjectFactory(Wt);this._createSorsNavigationTargetGenerator=this.createSinaObjectFactory(vt);this._createFioriIntentsResolver=this.createSinaObjectFactory(ee);this._createCDSAnnotationsParser=this.createSinaObjectFactory(Rt);this._createItemPostParser=this.createSinaObjectFactory(Zt);this._createSuvNavTargetResolver=this.createSinaObjectFactory(te);this.searchResultSetFormatters=[];this.suggestionResultSetFormatters=[];this.chartResultSetFormatters=[];this.metadataFormatters=[];this.dataSources=[];this.dataSourceMap={};this.allDataSource=this.createDataSource({id:"All",label:"All",type:yt.Category});this.DataSourceType=yt;this.DataSourceSubType=lt;this.HierarchyDisplayType=le;this.AttributeGroupTextArrangement=St;this.AttributeType=ut;this.AttributeFormatType=ht;this.FacetType=dt;this.SuggestionType=Ft;this.ConditionType=Ct;this.SuggestionCalculationMode=bt;this.SortOrder=ft;this.MatchingStrategy=gt;this.ComparisonOperator=pt;this.LogicalOperator=mt}hasErrors(){return this.errorList.length>0}getErrors(){return this.errorList}addError(t){this.errorList.push(t)}addErrors(t){this.errorList.push(...t)}initInternalSearchResultSetFormatters(t){this.searchResultSetFormatters.push(new ae);this.searchResultSetFormatters.push(new re({ui5NumberFormat:t.NumberFormat,ui5DateFormat:t.DateFormat}));this.searchResultSetFormatters.push(new ie)}initInternalSuggestionResultValueFormatter(t){this.suggestionResultSetFormatters.push(new ye({ui5NumberFormat:t.NumberFormat,ui5DateFormat:t.DateFormat}))}async initAsync(t){this.configuration=t;this.isDummyProvider=t.provider.indexOf("dummy")>-1;this.provider.label=t.label;this.initInternalSearchResultSetFormatters(t);this.initInternalSuggestionResultValueFormatter(t);try{await this.initCustomFormattersAsync(t)}catch(t){throw new e.SinaConfigurationError("_evaluateConfigurationAsync",t)}t.sina=this;let r=await this.provider.initAsync(t);r=r||{capabilities:null};this.capabilities=r.capabilities||this._createCapabilities({sina:this});try{await this._formatMetadataAsync()}catch(t){throw new e.SinaConfigurationError("metadataformatter(s)->formatAsync",t)}if(t.initAsync){try{await t.initAsync(this)}catch(t){throw new e.SinaConfigurationError("configuration->initAsync",t)}}if(this.getBusinessObjectDataSources().length===0&&!this.isDummyProvider){throw new ge}}_formatMetadataAsync(){return t.executeSequentialAsync(this.metadataFormatters,function(t){return t.formatAsync({dataSources:this.dataSources})}.bind(this))}async initCustomFormattersAsync(t){const e=[];if(t.searchResultSetFormatters){for(let r=0;r<t.searchResultSetFormatters.length;++r){const a=t.searchResultSetFormatters[r];this.searchResultSetFormatters.push(a);if(a.initAsync){e.push(a.initAsync())}}}if(t.suggestionResultSetFormatters){for(let r=0;r<t.suggestionResultSetFormatters.length;++r){const a=t.suggestionResultSetFormatters[r];this.suggestionResultSetFormatters.push(a);if(a.initAsync){e.push(a.initAsync())}}}if(t.chartResultSetFormatters){for(let r=0;r<t.chartResultSetFormatters.length;++r){const a=t.chartResultSetFormatters[r];this.chartResultSetFormatters.push(a);if(a.initAsync){e.push(a.initAsync())}}}if(t.metadataFormatters){for(let r=0;r<t.metadataFormatters.length;++r){const a=t.metadataFormatters[r];this.metadataFormatters.push(a);if(a.initAsync){e.push(a.initAsync())}}}return Promise.all(e)}async loadMetadata(t){if(this.provider instanceof oe){if(this.provider.loadMetadata){return this.provider.loadMetadata(t)}}return Promise.resolve()}createDataSourceMap(t){const e={};for(let r=0;r<t.length;++r){const a=t[r];e[a.id]=a}return e}createSinaObjectFactory(t){return function(e){e=e??{sina:this};e.sina=this;try{return new t(e)}finally{delete e.sina}}}_createDataSourceResultSet(t){const e=this.removeHierarchyDataSources(t.items,t=>t.dataSource);t.items=e;const r=new kt(t);r.sina=this;return r}isNeededCache={};removeHierarchyDataSources(t,e){const r=t=>{const e=this.isNeededCache[t.id];if(typeof e!=="undefined"){return e}for(const e of this.dataSources){for(const r of e.attributesMetadata){if(r.hierarchyName===t.hierarchyName&&r.hierarchyDisplayType===le.HierarchyResultView){this.isNeededCache[t.id]=true;return true}}}this.isNeededCache[t.id]=false;return false};for(let a=0;a<t.length;a++){const i=t[a];const s=e(i);if(!s.isHierarchyDataSource){continue}if(!r(s)){t.splice(a,1);a--}}return t}createDataSource(t){t.sina=this;let r;switch(t.type){case yt.BusinessObject:switch(t.subType){case lt.Filtered:r=new se(t);break;default:r=new Xt(t)}break;case yt.UserCategory:r=new Yt(t);break;default:r=new Xt(t)}if(this.dataSourceMap[r.id]){throw new e.CanNotCreateAlreadyExistingDataSourceError(r.id)}this._addDataSource(r);return r}_createDataSource(t){return this.createDataSource(t)}_addDataSource(t){if(t.type===yt.BusinessObject&&t.subType===lt.Filtered){let e=-1;for(let t=this.dataSources.length-1;t>=1;--t){const r=this.dataSources[t];if(r.type===yt.BusinessObject&&r.subType===lt.Filtered){e=t;break}}if(e>=0){this.dataSources.splice(e+1,0,t)}else{this.dataSources.push(t)}}else{this.dataSources.push(t)}this.dataSourceMap[t.id]=t}getAllDataSource(){return this.allDataSource}getBusinessObjectDataSources(){const t=[];for(let e=0;e<this.dataSources.length;++e){const r=this.dataSources[e];if(!r.hidden&&r.type===yt.BusinessObject&&r.subType!==lt.Filtered){t.push(r)}}return this.removeHierarchyDataSources(t,t=>t)}getDataSource(t){return this.dataSourceMap[t]}async getConfigurationAsync(t={}){if(this.provider instanceof oe||this.provider instanceof ce){if(this.configurationPromise&&!t.forceReload){return this.configurationPromise}this.configurationPromise=this.provider.getConfigurationAsync();return this.configurationPromise}return Promise.resolve(this._createConfiguration({personalizedSearch:false,isPersonalizedSearchEditable:false}))}logUserEvent(t){this.provider.logUserEvent(t)}getDebugInfo(){return this.provider.getDebugInfo()}parseDataSourceFromJson(t){let r=this.getDataSource(t.id);if(r){return r}if(t.type!==yt.Category){throw new e.DataSourceInURLDoesNotExistError(t.id)}r=this._createDataSource(t);return r}parseSimpleConditionFromJson(e){let a;if(t.isObject(e.value)){a=r.dateFromJson(e.value)}else{a=e.value}let i;if(e.userDefined){i=true}else{i=false}let s;if(e.dynamic){s=true}else{s=false}return this.createSimpleCondition({operator:e.operator,attribute:e.attribute,value:a,attributeLabel:e.attributeLabel,valueLabel:e.valueLabel,userDefined:i,isDynamicValue:s})}parseComplexConditionFromJson(t){const e=[];for(let r=0;r<t.conditions.length;++r){const a=t.conditions[r];e.push(this.parseConditionFromJson(a))}let r;if(t.userDefined){r=true}else{r=false}return this.createComplexCondition({operator:t.operator,conditions:e,attributeLabel:t.attributeLabel,valueLabel:t.valueLabel,userDefined:r})}parseConditionFromJson(t){switch(t.type){case Ct.Simple:return this.parseSimpleConditionFromJson(t);case Ct.Complex:return this.parseComplexConditionFromJson(t);default:throw new e.UnknownConditionTypeError(t.type)}}parseFilterFromJson(t){const r=this.parseConditionFromJson(t.rootCondition);if(r instanceof Mt){return this.createFilter({searchTerm:t?.searchTerm,rootCondition:r,dataSource:this.parseDataSourceFromJson(t.dataSource)})}else{throw new e.OnlyComplexConditionAllowedError}}parseNavigationTargetFromJson(t){return this.createNavigationTarget(t)}createStaticHierarchySearchNavigationTarget(t,e,r,a,i){if(!i){i=r.hierarchyAttribute;if(!i){const t=r.getHierarchyDataSource();if(t&&t.hierarchyAttribute){i=t.hierarchyAttribute}else{return null}}}const s=new wt({dataSource:r,searchTerm:"",sina:this});if(t!=="$$ROOT$$"){const r=new Ht({attribute:i,operator:pt.DescendantOf,value:t,valueLabel:e});s.autoInsertCondition(r)}return this.createSearchNavigationTarget(s,a||"Children Folders")}getHierarchyDataSource(t){const e=this.dataSources;for(let r=0;r<e.length;++r){const a=e[r];if(a.type!==this.DataSourceType.BusinessObject){continue}if(!a.isHierarchyDataSource){continue}if(t===a.hierarchyName){return a}}}}var de={__esModule:true};de.Sina=pe;return de})})();
//# sourceMappingURL=Sina.js.map