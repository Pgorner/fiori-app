/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){
/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./SinaObject","./SimpleCondition","./ComplexCondition","./LogicalOperator","../core/errors","./HierarchyDisplayType","./DataSourceType","./i18n"],function(t,i,o,e,r,n,s,a){"use strict";const c=t["SinaObject"];const h=i["SimpleCondition"];const d=o["ComplexCondition"];const u=e["LogicalOperator"];const l=r["CanOnlyAutoInsertComplexConditionError"];const f=r["InternalSinaError"];const C=n["HierarchyDisplayType"];const S=s["DataSourceSubType"];const y=a["getText"];class p extends c{dataSource;searchTerm="";rootCondition;constructor(t){super(t);this.dataSource=t.dataSource??this.sina.getAllDataSource();this.searchTerm=t.searchTerm??this.searchTerm;this.rootCondition=t.rootCondition??new d({sina:this.sina})}setSearchTerm(t){this.searchTerm=t}setRootCondition(t){this.rootCondition=t}clone(){return new p({sina:this.sina,dataSource:this.dataSource,searchTerm:this.searchTerm,rootCondition:this.rootCondition.clone()})}equals(t){return t instanceof p&&this.dataSource===t.dataSource&&this.searchTerm===t.searchTerm&&this.rootCondition.equals(t.rootCondition)}_getAttribute(t){if(t instanceof h){return t.attribute}for(let i=0;i<t.conditions.length;++i){const o=this._getAttribute(t.conditions[i]);if(o){return o}}}setDataSource(t){if(this.dataSource===t){return}this.dataSource=t;this.resetConditions()}resetConditions(){this.rootCondition.resetConditions()}autoInsertCondition(t){if(!(this.rootCondition instanceof d)){throw new l}const i=this._getAttribute(t);let o,e;for(let t=0;t<this.rootCondition.conditions.length;++t){e=this.rootCondition.conditions[t];const r=this._getAttribute(e);if(r===i){o=e;break}}if(!o){o=this.sina.createComplexCondition({operator:u.Or});this.rootCondition.addCondition(o)}for(let i=0;i<o.conditions.length;++i){e=o.conditions[i];if(e.equals(t)){return}}o.addCondition(t)}autoRemoveCondition(t){const i=function(t,o){for(let e=0;e<t.conditions.length;++e){const r=t.conditions[e];if(r.equals(o)){t.removeConditionAt(e);e--;continue}if(r instanceof d){i(r,o);if(r.conditions.length===0){t.removeConditionAt(e);e--;continue}}}};i(this.rootCondition,t)}isFolderMode(){if(!this.sina.configuration?.folderMode){return false}const t=this.dataSource.attributesMetadata.filter(t=>t.isHierarchy&&t.hierarchyDisplayType===C.StaticHierarchyFacet);const i=t.length>0;const o=this.dataSource.isHierarchyDataSource&&this.dataSource.hierarchyDisplayType===C.HierarchyResultView;if(!i&&!o){return false}if(this.dataSource.subType===S.Filtered){return false}const e=this.getFolderAttribute();const r=this.rootCondition.getAttributes();const n=r.filter(t=>t===e);const s=r.filter(t=>t!=e);if(!this.sina.configuration.folderModeForInitialSearch){if(n.length===0){return false}}if((this.searchTerm.length===0||this.searchTerm.trim()==="*")&&s.length===0){return true}else{return false}}getFolderAttribute(){if(this.dataSource.isHierarchyDataSource&&this.dataSource.hierarchyDisplayType===C.HierarchyResultView){return this.dataSource.hierarchyAttribute}const t=this.dataSource.attributesMetadata.filter(t=>t.isHierarchy&&t.hierarchyDisplayType===C.StaticHierarchyFacet);if(t.length===0){throw new f({message:y("error.sina.hierarchyAttributesMissing")})}return t[0].id}toJson(){return{dataSource:this.dataSource.toJson(),searchTerm:this.searchTerm,rootCondition:this.rootCondition.toJson()}}}var g={__esModule:true};g.Filter=p;return g})})();
//# sourceMappingURL=Filter.js.map