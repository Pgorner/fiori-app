/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["sap/m/ToggleButton","sap/ui/core/IconPool","../i18n","sap/ui/Device","sap/m/OverflowToolbarLayoutData","sap/m/library","sap/m/OverflowToolbar","sap/m/OverflowToolbarButton","../controls/SearchSpreadsheet","../eventlogging/UserEvents","sap/m/ToolbarSpacer","sap/m/ToolbarSeparator","../error/errors","sap/m/Button","sap/m/ActionSheet","sap/m/IconTabBar","sap/m/IconTabFilter","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/ui/model/BindingMode","sap/m/ViewSettingsDialog","sap/ui/core/Element"],function(t,e,o,s,r,a,i,n,l,c,p,u,h,d,m,g,b,C,S,y,f,T){"use strict";function w(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const B=w(o);const I=a["ButtonType"];const D=a["OverflowToolbarPriority"];const x=a["PlacementType"];const R=a["URLHelper"];const E=w(l);const V=c["UserEventType"];const v=w(h);class O{compositeControl;constructor(t){this.compositeControl=t}assembleFilterButton(){const o=this.compositeControl.getModelInternal();const a=new t(this.compositeControl.getId()+"-searchBarFilterButton",{icon:e.getIconURI("filter"),tooltip:{parts:[{path:"/facetVisibility"}],formatter:t=>t?B.getText("hideFacetBtn_tooltip"):B.getText("showFacetBtn_tooltip")},pressed:{path:"/facetVisibility"},press:t=>{const e=this.compositeControl.getModelInternal();this.compositeControl.searchContainer.setProperty("animateFacetTransition",true);e.setFacetVisibility(t.getParameter("pressed"));this.compositeControl.searchContainer.setProperty("animateFacetTransition",false);setTimeout(()=>this.compositeControl.adjustSearchbarCustomGenericButtonWidth(),100)},visible:{parts:[{path:"/businessObjSearchEnabled"},{path:"/count"}],formatter:(t,e)=>{if(e===0){return false}return!s.system.phone&&!o.config.optimizeForValueHelp&&t}}});a.addStyleClass("searchBarFilterButton");a.setLayoutData(new r({priority:D.NeverOverflow}));return a}assembleGenericButtonsToolbar(){const t=this.compositeControl.getModelInternal();const e=this.assembleExportButton();e.setLayoutData(new r({priority:D.High}));this.assembleResultViewSwitch();const o=new n((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"tableSortButton",{icon:"sap-icon://sort",text:"{i18n>sortTable}",tooltip:"{i18n>sortTable}",type:I.Transparent,visible:{parts:[{path:"/count"},{path:"/sortableAttributes"}],formatter:(t,e)=>{const o=this.compositeControl.getModelInternal();if(o&&o.isHomogenousResult()&&t>0&&e.length>0){return true}else{return false}}},press:()=>{this.compositeControl.openSortDialog()}});o.addStyleClass("sapUshellSearchTableSortButton");o.setLayoutData(new r({priority:D.High}));this.compositeControl.sortDialog=this.assembleSearchResultSortDialog();const s=new n((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"tablePersonalizeButton",{icon:"sap-icon://action-settings",text:"{i18n>personalizeTable}",tooltip:"{i18n>personalizeTable}",type:I.Transparent,enabled:{parts:[{path:"/resultViewType"}],formatter:t=>t==="searchResultTable"},visible:{parts:[{path:"/count"},{path:"/tableColumns"}],formatter:(t,e)=>{const o=this.compositeControl.getModelInternal();if(o&&o.isHomogenousResult()&&t>0&&e.length>0){return true}else{return false}}},press:()=>{this.compositeControl.searchResultTable?.tablePersonalizer?.openDialog();const t=this.compositeControl.getModelInternal();const e={type:V.TABLE_CONFIG_OPEN};t.eventLogger.logEvent(e)}});s.addStyleClass("sapUshellSearchTablePersonalizeButton");s.setLayoutData(new r({priority:D.High}));let a=[];a.push(e);a.push(o);a.push(s);const l=t?.config?.isUshell;if(l){const t=this.assembleShareButton();t.setLayoutData(new r({priority:D.High}));a.push(t)}a.push(this.compositeControl.resultViewSwitch);let c=false;try{let e=[new p];const o=t?.config?.getCustomToolbar();if(o?.length>0){c=true;o.push(new u("",{visible:{parts:[{path:"/resultViewSwitchVisibility"},{path:"/count"}],formatter:(t,e)=>t&&e!==0}}))}e=e.concat(o);a=e.concat(a)}catch(e){const o=new v.ConfigurationExitError("getCustomToolbar",t.config.applicationComponent,e);this.compositeControl.errorHandler.onError(o)}const h=new i(this.compositeControl.getId()+"-searchBar--genericButtonsToolbar",{content:a});h.addStyleClass("sapElisaSearchGenericButtonsToolbar");return{toolbar:h,hasCustomButtons:c}}assembleSearchResultSortDialog(){const t=this.compositeControl.getId()+"-sortDialog";const e=T.getElementById(t);if(e){e.destroy()}const o=new f(t,{sortDescending:{parts:[{path:"/orderBy"}],formatter:t=>Object.keys(t).length===0||t.sortOrder==="DESC"},confirm:t=>{const e=t.getParameter("sortItem");const s=t.getParameter("sortDescending");const r=this.compositeControl.getModelInternal();const a=e.getBindingContext().getObject().attributeId;if(typeof e==="undefined"||a==="DEFAULT_SORT_ATTRIBUTE"){o.setSortDescending(true);r.resetOrderBy(true)}else{r.setOrderBy({orderBy:a,sortOrder:s===true?"DESC":"ASC"},true)}},cancel:()=>{},resetFilters:()=>{setTimeout(()=>{o.setSortDescending(true);o.setSelectedSortItem("searchSortAttributeKeyDefault")},500)}});o.addStyleClass("sapUshellSearchResultSortDialog");o.addStyleClass("sapElisaSearchResultSortDialog");this.compositeControl.addDependent(o);return o}assembleExportButton(){return new n((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"ushell-search-result-dataExportButton",{icon:"sap-icon://download",text:"{i18n>exportData}",tooltip:"{i18n>exportData}",type:I.Transparent,visible:{parts:[{path:"/count"},{path:"/tableColumns"}],formatter:(t,e)=>{const o=this.compositeControl.getModelInternal();if(o&&o.isHomogenousResult()&&t>0&&e.length>0){return true}else{return false}}},press:()=>{if(this.compositeControl.searchSpreadsheet===undefined){this.compositeControl.searchSpreadsheet=new E("ushell-search-spreadsheet")}const t=this.compositeControl.getModelInternal();this.compositeControl.searchSpreadsheet.onExport(t)}}).addStyleClass("sapUshellSearchTableDataExportButton")}assembleShareButton(){const t=new m((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"shareActionSheet",{placement:x.Bottom,buttons:[]});t.addStyleClass("sapUshellSearchResultShareActionSheet");this.compositeControl.addDependent(t);const o=this.compositeControl.getModelInternal();sap.ui.require(["sap/ushell/ui/footerbar/AddBookmarkButton"],s=>{const r=new s((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"bookmarkButton",{width:"auto",beforePressHandler:()=>{const t={url:document.URL,title:o.getDocumentTitle(),icon:e.getIconURI("search")};r.setAppData(t)}});t.addButton(r);const a=new d((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"emailButton",{icon:"sap-icon://email",text:B.getText("eMailFld"),width:"auto",press:()=>{R.triggerEmail(null,o.getDocumentTitle(),document.URL)}});t.addButton(a)});const s=new n((this.compositeControl.getId()?this.compositeControl.getId()+"-":"")+"shareButton",{icon:"sap-icon://action",text:B.getText("shareBtn"),tooltip:B.getText("shareBtn"),type:I.Transparent,press:()=>{t.openBy(s)}});return s}assembleDataSourceTabBar(){const t=new g(`${this.compositeControl.getId()}-dataSourceTabBar`,{expandable:false,stretchContentHeight:false,visible:{parts:[{path:"/facetVisibility"},{path:"/count"},{path:"/businessObjSearchEnabled"}],formatter:(t,e,o)=>{const s=this.compositeControl.getModelInternal();if(s.config.exclusiveDataSource){return false}return!t&&e>0&&o}},selectedKey:{path:"/tabStrips/selected/id",mode:y.OneWay},select:t=>{const e=this.compositeControl.getModelInternal();if(e.config.searchScopeWithoutAll){return}if(e.getDataSource()!==t.getParameter("item").getBindingContext().getObject()){e.setDataSource(t.getParameter("item").getBindingContext().getObject())}}});t.data("sap-ui-fastnavgroup","false",true);t.addStyleClass("searchDataSourceTabStripBar");t.addStyleClass("sapUiSmallMarginBegin");t.setAriaTexts({headerLabel:B.getText("dataSources"),headerDescription:B.getText("dataSources")});t.bindAggregation("items",{path:"/tabStrips/strips",template:new b("",{key:"{id}",text:"{labelPlural}"})});return t}assembleResultViewSwitch(){if(this.compositeControl.resultViewSwitch!==undefined){return}this.compositeControl.resultViewSwitch=new C(this.compositeControl.getId()+"-ResultViewType",{selectedKey:"{/resultViewType}",visible:{parts:[{path:"/resultViewSwitchVisibility"},{path:"/count"}],formatter:(t,e)=>t&&e!==0},selectionChange:t=>{const e=t.getParameter("item").getKey();this.compositeControl.setResultViewType(e);this.compositeControl.assignDragDropConfig();const o=this.compositeControl.getModelInternal();const s={type:V.RESULT_VIEW_SWITCH,resultViewType:e};o.eventLogger.logEvent(s)}});this.compositeControl.resultViewSwitch.bindAggregation("items",{path:"/resultViewTypes",factory:(t,e)=>{const o=new S("",{visible:true});switch(e.getObject()){case"searchResultList":o.setIcon("sap-icon://list");o.setTooltip(B.getText("displayList"));o.setKey("searchResultList");break;case"searchResultTable":o.setIcon("sap-icon://table-view");o.setTooltip(B.getText("displayTable"));o.setKey("searchResultTable");break;case"searchResultGrid":o.setIcon("sap-icon://grid");o.setTooltip(B.getText("displayGrid"));o.setKey("searchResultGrid");break;default:o.setVisible(false)}return o}});this.compositeControl.resultViewSwitch.addStyleClass("sapUshellSearchResultViewSwitch");this.compositeControl.resultViewSwitch.setLayoutData(new r({priority:D.High}))}}return O})})();
//# sourceMappingURL=ToolbarAssembler.js.map