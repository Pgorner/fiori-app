/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../controls/resultview/SearchResultTable","sap/ui/core/InvisibleText","../controls/resultview/SearchResultList","../i18n","sap/m/library","../controls/resultview/SearchResultGrid","sap/f/GridContainerSettings","../error/errors","sap/ui/layout/VerticalLayout","sap/f/GridContainer","../eventlogging/UserEvents","sap/f/GridContainerItemLayoutData","sap/m/Text","sap/m/Button","sap/m/FlexBox","sap/m/CustomListItem","../controls/SearchTileHighlighter","../controls/resultview/CustomSearchResultListItem","../controls/resultview/SearchResultListItem","sap/m/GenericTile","sap/m/TileContent","sap/ui/core/Element"],function(t,e,s,o,n,r,i,a,l,c,p,h,u,m,d,g,C,f,y,I,S,R){"use strict";function b(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const w=b(t);const L=b(s);const T=b(o);const v=n["ButtonType"];const A=n["FlexJustifyContent"];const M=n["ListMode"];const E=n["ListType"];const U=b(r);const D=b(a);const x=p["UserEventType"];const G=C["Highlighter"];const O=b(f);const B=b(y);class H{compositeControl;constructor(t){this.compositeControl=t}assembleCenterArea(t){this.compositeControl.searchResultList=this.assembleSearchResultList(t);this.compositeControl.searchResultTable=new w(`${t}-ushell-search-result-table`,{});this.compositeControl.searchResultTable.assembleTable(this.compositeControl.getModelInternal());const e=this;this.compositeControl.searchResultTable.addEventDelegate({onAfterRendering:()=>{const t=$(this.compositeControl.getDomRef());t.find("table tbody tr").each(function(){const t=$(this);const s=R.getElementById(t.attr("id"));if(s){const t=s.getAriaLabelledBy();if($.inArray(e.compositeControl.countBreadcrumbsHiddenElement.getId(),t)===-1){s.addAriaLabelledBy(e.compositeControl.countBreadcrumbsHiddenElement)}}return false})}});this.compositeControl.searchResultGrid=this.assembleSearchResultGrid(t);this.compositeControl.appSearchResult=this.assembleAppSearch(t);this.compositeControl.showMoreFooter=this.assembleShowMoreFooter();const s=[this.compositeControl.searchResultList,this.compositeControl.searchResultTable,this.compositeControl.searchResultGrid,this.compositeControl.appSearchResult,this.compositeControl.showMoreFooter,this.compositeControl.countBreadcrumbsHiddenElement];return s}assembleCountBreadcrumbsHiddenElement(){const t=new e("",{text:{parts:[{path:"/count"}],formatter:t=>{if(typeof t!=="number"){return""}return T.getText("results_count_for_screenreaders",[t.toString()])}}});return t}assembleSearchResultList(t){const e=new L(t+"-ushell-search-result-list",{mode:M.None,width:"auto",showNoData:false,visible:{parts:[{path:"/resultViewType"},{path:"/count"}],formatter:(t,e)=>t==="searchResultList"&&e!==0}});e.bindItems({path:"/results",factory:(t,e)=>this.assembleListItem(t,e)});return e}assembleSearchResultGrid(t){const e=this.compositeControl.getModelInternal();let s;if(typeof e.config.customGridView==="function"){try{s=e.config.customGridView()}catch(t){const s=new D.ConfigurationExitError("customGridView",e.config.applicationComponent,t);throw s}}else{const e=new i("",{rowSize:"11rem",columnSize:"11rem",gap:"0.5rem"});s=new U(t+"-ushell-search-result-grid",{layout:e,snapToRow:true})}s.bUseExtendedChangeDetection=false;s.bindProperty("visible",{parts:["/resultViewType","/count"],formatter:(t,e)=>t==="searchResultGrid"&&e!==0});s.addStyleClass("sapUshellSearchGrid");return s}assembleAppSearch(t){const e=new i("",{rowSize:"5.5rem",columnSize:"5.5rem",gap:"0.25rem"});const s=new c(t+"-ushell-search-result-app",{layout:e,snapToRow:true,visible:{parts:[{path:"/count"}],formatter:t=>{const e=this.compositeControl.getModelInternal();return(e.isAppCategory()||e.isUserCategoryAppSearchOnlyWithoutBOs())&&t!==0}},items:{path:"/appResults",factory:(t,e)=>{const s=this.compositeControl.getModelInternal();if(s.isAppCategory()||s.isUserCategoryAppSearchOnlyWithoutBOs()){const t=e.getObject();const o=t.visualization;const n=s.uShellVisualizationInstantiationService;const r=n.instantiateVisualization(o);r.attachPress(()=>{s.eventLogger.logEvent({type:x.TILE_NAVIGATE,tileTitle:o.title,targetUrl:o.targetURL})});r.addEventDelegate({onAfterRendering:this.highlightTile});r.setActive(false,true);r.setLayoutData(new h(r.getLayout()));return r}return new u("",{text:""})}}});s.addStyleClass("sapUshellSearchGridContainer");const o=new m({text:"{i18n>showMore}",type:v.Transparent,visible:{parts:[{path:"/appCount"},{path:"/appResults"}],formatter:(t,e)=>{const s=this.compositeControl.getModelInternal();return(s.isAppCategory()||s.isUserCategoryAppSearchOnlyWithoutBOs())&&e.length<t}},press:()=>{const t=this.compositeControl.getModelInternal();const e=t.getTop()+t.pageSize;t.setProperty("/focusIndex",t.getTop());t.setTop(e);t.eventLogger.logEvent({type:x.SHOW_MORE})}});o.addStyleClass("sapUshellResultListMoreFooter");const n=new l("",{width:"100%",visible:{parts:[{path:"/count"}],formatter:t=>{const e=this.compositeControl.getModelInternal();return(e.isAppCategory()||e.isUserCategoryAppSearchOnlyWithoutBOs())&&t!==0}},content:[s,o]});n.addStyleClass("sapUshellResultApps");return n}highlightTile(t){const e=t["srcControl"]?.getAggregation("content");if(e){let s=e.findAggregatedObjects(true,t=>t.isA("sap.m.GenericTile")||t.isA("sap.f.Card"));if(s.length===0&&e.getComponentInstance){s=e.getComponentInstance().findAggregatedObjects(true,t=>t.isA("sap.m.GenericTile")||t.isA("sap.f.Card"))}if(s.length>0){const e=s[0];const o=new G;o.setHighlightTerms(t["srcControl"]?.getModel().getProperty("/uiFilter/searchTerm"));o.highlight(e)}}}assembleShowMoreFooter(){const t=new m(this.compositeControl.getId()+"-resultview-moreFooter-button",{text:"{i18n>showMore}",type:v.Transparent,press:()=>{const t=this.compositeControl.getModelInternal();t.setProperty("/focusIndex",t.getTop());const e=t.getTop()+t.pageSize;t.setTop(e);t.eventLogger.logEvent({type:x.SHOW_MORE})}});t.addStyleClass("sapUshellResultListMoreFooter");const e=new d(this.compositeControl.getId()+"-resultview-moreFooter",{visible:{parts:[{path:"/boCount"},{path:"/boResults"}],formatter:(t,e)=>e.length<t},justifyContent:A.Center});e.addStyleClass("sapUshellResultListMoreFooterContainer");e.addItem(t);return e}assembleListItem(t,e){const s=e.getObject();if(s.type==="footer"){return new g(`${t}-footerItem`)}else if(s.type==="appcontainer"){this.compositeControl.appResultListItem=this.assembleAppContainerResultListItem(t);return this.compositeControl.appResultListItem}return this.assembleResultListItem(t,s)}assembleResultListItem(t,e){const s=this.compositeControl.getModelInternal();const o=s.config.getDataSourceConfig(e.dataSource);const n={dataSource:e.dataSource,title:"{title}",isTitleHighlighted:{path:"isTitleHighlighted"},titleDescription:"{titleDescription}",isTitleDescriptionHighlighted:{path:"isTitleDescriptionHighlighted"},titleNavigation:{path:"titleNavigation"},type:"{dataSourceName}",imageUrl:"{imageUrl}",imageFormat:"{imageFormat}",imageNavigation:{path:"imageNavigation"},geoJson:"{geoJson}",attributes:{path:"itemattributes"},navigationObjects:{path:"navigationObjects"},selected:{path:"selected"},selectionEnabled:{path:"selectionEnabled"},customItemStyleClass:{path:"customItemStyleClass"},expanded:{path:"expanded"},positionInList:{path:"positionInList"},resultSetId:{path:"resultSetId"},layoutCache:{path:"layoutCache"},titleIconUrl:{path:"titleIconUrl"},titleInfoIconUrl:{path:"titleInfoIconUrl"}};let r;if(o.searchResultListItemControl){r=new o.searchResultListItemControl(n)}else if(o.searchResultListItemContentControl){n["content"]=new o.searchResultListItemContentControl;r=new O(`${t}--customItemContent`,n)}else{r=new B(`${t}--itemContent`,n)}if(r.setCountBreadcrumbsHiddenElement){r.setCountBreadcrumbsHiddenElement(this.compositeControl.countBreadcrumbsHiddenElement)}const i=new g(`${t}--customListItem`,{content:r,type:E.Inactive});i.addStyleClass("sapUshellSearchResultListItem");if(r.setParentListItem){r.setParentListItem(i)}return i}assembleAppContainerResultListItem(t){const e=new i("",{rowSize:"5.5rem",columnSize:"5.5rem",gap:"0.25rem"});const s=`${t}-appItemContainer`;const o=new c(s,{layout:e,snapToRow:true,items:{path:"/appResults",factory:(t,e)=>{const s=this.compositeControl.getModelInternal();if(!s.isAppCategory()){const t=e.getObject();const o=t.visualization;const n=s.uShellVisualizationInstantiationService;const r=n.instantiateVisualization(o);r.attachPress(()=>{const t=this.compositeControl.getModelInternal();t.eventLogger.logEvent({type:x.TILE_NAVIGATE,tileTitle:o.title,targetUrl:o.targetURL})});r.addEventDelegate({onAfterRendering:this.highlightTile});r.setActive(false,true);r.setLayoutData(new h(r.getLayout()));return r}return new u(t,{text:""})}}});o.addStyleClass("sapUshellSearchGridContainer");o.addEventDelegate({onAfterRendering:()=>{const t=this.compositeControl.getModelInternal();if(o.getDomRef().clientWidth===0){return}let e=o.getDomRef().clientWidth-176;if(e<184){e=184}const n=Math.floor(e/184);const r=o.getItems();const i=t.getProperty("/appCount");const a=t.getProperty("/boCount");const l=r[r.length-1];if(l.hasStyleClass("sapUshellSearchResultListItemAppsShowMore")){return}if(r.length>n+1){let s=0,o=0;for(;o<r.length;o++){s=s+r[o].getDomRef().clientWidth+4;if(s>e){break}}const n=t.getProperty("/appResults");t.setProperty("/appResults",n.slice(0,o))}else{if(i>n&&!l.hasStyleClass("sapUshellSearchResultListItemAppsShowMore")){const e=`${s}--showMore`;const n=new I(e,{tileContent:new S(`${e}--content`,{content:new u(`${e}--content--text`,{text:T.getText("showMoreApps")})}),press:()=>{const t=this.compositeControl.getModelInternal();t.setDataSource(t.appDataSource)}});n.addStyleClass("sapUshellSearchResultListItemAppsShowMore");o.addItem(n);t.setProperty("/resultViewType","appSearchResult");t.setProperty("/resultViewType","searchResultList");t.setProperty("/boCount",0);t.setProperty("/boCount",a)}}}},o);const n=new g(`${this.compositeControl.getId()}-appItem`,{content:o});n.addStyleClass("sapUshellSearchResultListItem");n.addStyleClass("sapUshellSearchResultListItemApps");n.addEventDelegate({onAfterRendering:function(){const t=$(n.getDomRef());t.removeAttr("role");t.attr("aria-hidden","true")}},n);return n}}return H})})();
//# sourceMappingURL=ResultViewsAssembler.js.map