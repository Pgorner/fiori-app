/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../i18n","sap/m/Text","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/library","sap/ui/core/Icon","../eventlogging/UserEvents","../sinaNexTS/sina/HierarchyDisplayType","../error/errors","./facets/FacetTypeUI"],function(t,e,r,i,o,n,s,a,l,c){"use strict";function u(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const h=u(t);const f=o["ToolbarDesign"];const d=s["UserEventType"];const p=a["HierarchyDisplayType"];const b=u(l);const F=c["FacetTypeUI"];const m=r.extend("sap.esh.search.ui.controls.SearchFilterBar",{renderer:{apiVersion:2},constructor:function t(o,s){r.prototype.constructor.call(this,o,s);this.setProperty("design",f.Info);this.addStyleClass("sapUshellSearchFilterContextualBar");this.filterFormatter=this.filterFormatter.bind(this);this.filterText=new e(this.getId()+"-resetFilterText",{text:{parts:[{path:"/uiFilter/rootCondition"},{path:"/facets"}],formatter:this.filterFormatter},tooltip:{parts:[{path:"/uiFilter/rootCondition"},{path:"/facets"}],formatter:this.filterFormatter}}).addStyleClass("sapUshellSearchFilterText");this.filterText.setMaxLines(1);this.filterText.clampText();this.addContent(this.filterText);this.addContent(new i);this.resetButton=new n(this.getId()+"-resetFilterButton",{src:"sap-icon://clear-filter",tooltip:h.getText("resetFilterButton_tooltip")}).addStyleClass("sapUshellSearchFilterResetButton");this.addContent(this.resetButton)},filterFormatter:function t(e,r){if(!e||!e.hasFilters()){return""}const i=this.getModel();if(i.config.formatFilterBarText){try{return i.config.formatFilterBarText(this._assembleFilterLabels(e,r))}catch(t){const o=new b.ConfigurationExitError("formatFilterBarText",i.config.applicationComponent,t);const n=i.getSearchCompositeControlInstanceByChildControl(this);n?.errorHandler.onError(o);return this._formatFilterText(e,r)}}else{return this._formatFilterText(e,r)}},_assembleFilterLabels:function t(e,r){const i=[];e=this.sortConditions(e,r);for(let t=0;t<e.conditions.length;++t){const r=e.conditions[t];const o=this.getModel();const n=r.getFirstAttribute();const s=o.getProperty("/uiFilter")?.dataSource.attributeMetadataMap[n];if(s&&s.isHierarchy===true&&s.hierarchyDisplayType===p.StaticHierarchyFacet){continue}const a={attributeName:s?.id||n,attributeLabel:"",attributeFilterValueLabels:[]};i.push(a);for(let t=0;t<r.conditions.length;++t){const e=r.conditions[t];if(t===0){a.attributeLabel=e.attributeLabel}a.attributeFilterValueLabels.push(this._formatLabel(e.valueLabel||e.value,e.operator))}}return i},_formatFilterText:function t(e,r){const i=this._assembleFilterLabels(e,r);const o=i.map(t=>t.attributeLabel+" ("+t.attributeFilterValueLabels.join(", ")+")");return h.getText("filtered_by",[o.join(", ")])},_formatLabel:function t(e,r){let i;switch(r){case this.getModel().sinaNext.ComparisonOperator.Bw:i=e+"*";break;case this.getModel().sinaNext.ComparisonOperator.Ew:i="*"+e;break;case this.getModel().sinaNext.ComparisonOperator.Co:i="*"+e+"*";break;default:i=e;break}return i},sortConditions:function t(e,r){if(r.length===0){return e}const i=function(t){const e=t.conditions[0];if(e.attribute){return e.attribute}return e.conditions[0].attribute};const o=function(t,e,r){for(let i=0;i<t.length;++i){const o=t[i];if(o[e]===r){return i}}};e=e.clone();e.conditions.sort(function(t,e){const n=i(t);const s=o(r,"dimension",n);const a=i(e);const l=o(r,"dimension",a);return s-l});const n=function(t){const e=i(t);const n=o(r,"dimension",e);if(!n){return}const s=r[n];if(s.facetType===F.Hierarchy){return}const a=function(t,e){return o(s.items,"label",t.valueLabel)-o(s.items,"label",e.valueLabel)};t.conditions.sort(a)};for(let t=0;t<e.conditions.length;++t){const r=e.conditions[t];n(r)}return e},onAfterRendering:function t(e){r.prototype.onAfterRendering.call(this,e);this.resetButton.attachPress(()=>{const t=this.getModel();t.eventLogger.logEvent({type:d.CLEAR_ALL_FILTERS});t.resetFilterByFilterConditions(true)});const i=jQuery(".sapUshellSearchFilterText");i.attr("aria-label",h.getText("filtered_by_aria_label"))}});return m})})();
//# sourceMappingURL=SearchFilterBar.js.map