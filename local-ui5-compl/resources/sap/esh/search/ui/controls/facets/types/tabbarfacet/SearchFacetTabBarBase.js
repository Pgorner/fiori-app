/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../../../i18n","sap/m/Button","sap/m/ActionSheet","sap/m/Link","sap/m/Label","sap/m/VBox","sap/m/library","sap/ui/core/Control","./SearchFacetPieChart","./SearchFacetBarChart","./SearchFacetSimpleList","sap/ui/core/Element","sap/m/FlexBox","../../../OpenShowMoreDialog","../../../../personalization/PersonalizationKeys"],function(e,t,n,a,o,s,c,i,r,l,d,g,h,f,p){"use strict";function u(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const m=u(e);const S=c["ButtonType"];const b=c["FlexAlignItems"];const B=c["FlexJustifyContent"];const C=c["PlacementType"];const x=u(r);const y=u(l);const w=u(d);const I=f["openShowMoreDialog"];const F=p["PersonalizationKeys"];const T=i.extend("sap.esh.search.ui.controls.SearchFacetTabBarBase",{renderer:{apiVersion:2,render(e,t){const n=t.getAggregation("items");if(n.length===0){return}const c=t.getContentFacets(n);e.openStart("div",t);e.attr("aria-label",m.getText("filterBy"));e.class("sapUshellSearchFacetTabBar");e.openEnd();const i=t.getBindingContext().getObject()["dimension"];const r=t.getBindingContext().getObject()["dataType"];const l=t.getBindingContext().getObject()["title"];let d;const g=t.getModel();const f=g.getPersonalizationStorageInstance().getItem(F.searchFacetPanelChartState);if(f&&Object.prototype.toString.call(f)==="[object Array]"){for(const e of f){if(e.dimension===i){d=e;break}}}let p=0;if(d&&d.buttonIndex){const e=d.buttonIndex;p=parseInt(e,10)}if(r!=g.sinaNext.AttributeType.String){p=0}t.getBindingContext().getObject()["chartIndex"]=p;const u=t.assembleChartSwitchButton(n,p,i);let S;if(r===g.sinaNext.AttributeType.String){S=new h({justifyContent:B.SpaceBetween,alignItems:b.Center,items:[new o({text:l}),u]})}else{S=new h({justifyContent:B.SpaceBetween,alignItems:b.Center,items:[new o({text:l})]})}S.addStyleClass("sapUshellSearchFacetHeader");S.data("facet-dimension",i,true);if(g.config?.searchInAttibuteFacetPostion[i]){if(i===g.config?.dimensionNameSpace_Description){}else{S.addStyleClass("sapUshellSearchFacetTabBarHeader");S.addStyleClass("sapUshellSearchFacetTabBarHeaderHidden")}}else{S.addStyleClass("sapUshellSearchFacetTabBarHeader")}let C=m.getText("showMore");if(i===g.config?.dimensionNameSpace_Description){C=m.getText("showMoreDwcSpace")}const x=new a("",{text:C,press:t.createOpenFacetDialogFn(p,n).bind(t)});x.setModel(t.getModel("i18n"));x.addStyleClass("sapUshellSearchFacetShowMoreLink");const y=new o("",{text:""});y.addStyleClass("sapUshellSearchFacetInfoZeile");const w=new s("",{items:[y,x]});w.addStyleClass("sapUshellSearchFacetShowMore");const I=new s("",{items:[S,c[p],w]});I.addStyleClass("sapUshellSearchFacetContainer");I.data("sap-ui-fastnavgroup","false",true);I.setModel(t.getModel());e.renderControl(I);n[p].addContent(c[p]);e.close("div")}},metadata:{properties:{facetType:"string",headerText:"string",selectedButtonParameters:{type:"object",defaultValue:null}},aggregations:{items:{type:"sap.m.IconTabFilter",multiple:true}}},constructor:function e(t,n){i.prototype.constructor.call(this,t,n)},getSearchFacetTabBarAndDimensionById:function e(t){const n={};n.index=0;const a=document.getElementById(t);const o=a.dataset.facetView;const s=a.dataset.facetViewIndex;const c=$("#"+t).parent()[0];const i=c.dataset.facetDimension;const r=$(".sapUshellSearchFacetTabBar");for(let e=0;e<r.length;e++){const t=$(".sapUshellSearchFacetTabBar .sapUshellSearchFacetTabBarHeader")[e];const a=t.dataset.facetDimension;if(a===i){n.index=e;n.control=g.getElementById(r[e].id);n.view=o;n.buttonIndex=s;n.dimension=i;break}}return n},storeClickedTabInformation:function e(t){const n=t.getSource()["sId"];const a=this.getSearchFacetTabBarAndDimensionById(n);const o=a.control.getModel();const s=o.getPersonalizationStorageInstance().getItem(F.searchFacetPanelChartState);const c=a.dimension;const i=a.control;const r=a.view;const l=a.buttonIndex;const d=i.getBindingContext().getObject()["dimension"];const g=t.getSource().getId();const h=[];const f={};f.tabId=n;f.buttonId=g;f.buttonIndex=l;f.dimension=d;f.view=r;h.push(f);if(s&&Object.prototype.toString.call(s)==="[object Array]"){for(const e of s){if(e.dimension!==c){h.push(e)}}}o.getPersonalizationStorageInstance().setItem(F.searchFacetPanelChartState,h);i.getBindingContext().getObject()["chartIndex"]=l},createOpenFacetDialogFn:function e(t,n){return async function(){let e;const a=this.getModel();const o=$(this.getDomRef()).closest(".sapUshellSearchFacetTabBar")[0];const s=g.getElementById($(o).attr("id"));if(s?.getBindingContext()?.getObject()["dimension"]){e=s.getBindingContext().getObject()["dimension"]}if(e===a.config?.dimensionNameSpace_Description&&a.config?.openSpaceShowMoreDialog){return a.config?.openSpaceShowMoreDialog(e,a)}await I({searchModel:a,dimension:e,selectedTabBarIndex:t,tabBarItems:n,sourceControl:this})}},assembleChartSwitchButtons:function e(n,a){const o=[];let s=null;let c=0;for(const e of n){const n=e.getContent()[0];if(n instanceof w||n instanceof x||n instanceof y){s=new t("",{text:e.getText(),icon:e.getIcon(),press:e=>{this.storeClickedTabInformation(e);this.setProperty("selectedButtonParameters",e.getParameters())}});s.data("facet-view",e.getText(),true);s.data("facet-view-index",""+c,true);s.data("dimension",a,true);o.push(s)}c++}return o},assembleChartSwitchActionSheet:function e(t,a){const o=this.assembleChartSwitchButtons(t,a);const s=new n("",{showCancelButton:false,buttons:o,placement:C.Bottom,afterClose:()=>{window.setTimeout(()=>{const e=Array.from(document.querySelectorAll(".sapUshellSearchFacetTabBarButton"));for(const t of e){const e=t.getAttribute("data-facet-dimension");if(a===e){t.focus()}}},100)}});s.data("facet-dimension",a,true);return s},assembleChartSwitchButton:function e(n,a,o){const s=n[a];const c=this.assembleChartSwitchActionSheet(n,o);const i=new t("",{icon:s.getIcon(),type:S.Transparent});i.data("facet-dimension",o,true);i.addStyleClass("sapUshellSearchFacetTabBarButton");const r=s.getText();const l=m.getText("displayAs",[r]);i.setTooltip(l);i.attachPress(()=>{c.openBy(i)});i.onAfterRendering=()=>{$(i.getDomRef()).attr("aria-label",m.getText("dropDown"))};return i},getContentFacets:function e(t){const n=[];for(const e of t){const t=e.getContent()[0];if(t instanceof w||t instanceof x||t instanceof y){n.push(t)}}return n}});return T})})();
//# sourceMappingURL=SearchFacetTabBarBase.js.map