/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../i18n","sap/m/Input","sap/m/Label","sap/m/Text","sap/m/library","sap/m/Column","sap/m/ColumnListItem","sap/m/CustomListItem","sap/m/FlexItemData","sap/m/BusyIndicator","sap/m/FlexBox","sap/ui/core/Icon","sap/ui/layout/HorizontalLayout","sap/ui/layout/VerticalLayout","sap/ui/model/BindingMode","../../SearchHelper","../../suggestions/SuggestionType","../../SearchShellHelperHorizonTheme","../../eventlogging/UserEvents","../../UIEvents","sap/ui/Device","./SearchObjectSuggestionImage","sap/ui/core/Element","sap/ui/core/EventBus","../../error/errors","sap/base/Log","sap/m/Link"],function(e,t,s,i,a,n,o,r,c,l,g,h,u,d,p,S,f,m,y,b,T,I,v,C,w,L,x){"use strict";function R(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const A=R(e);const D=a["FlexAlignItems"];const U=a["FlexDirection"];const O=a["FlexJustifyContent"];const F=a["ListType"];const M=R(f);const B=f["Type"];const H=f["isSearchSuggestion"];const E=R(m);const V=y["UserEventType"];const j=R(b);const N=R(I);const k=w["SearchTermExceedsLimitsError"];const P=t.extend("sap.esh.search.ui.controls.SearchInput",{renderer:{apiVersion:2},constructor:function e(s,i){this.logger=L.getLogger("sap.esh.search.ui.SearchInput");const a=T.system.phone;try{T.system.phone=false;t.prototype.constructor.call(this,s,i)}finally{T.system.phone=a}this.decorateHandleListNavigation();this.setStartSuggestion(0);this.setWidth("100%");this.setShowValueStateMessage(false);this.setShowTableSuggestionValueHelp(false);this.setEnableSuggestionsHighlighting(false);this.setShowSuggestion(true);this.setFilterSuggests(false);this.addSuggestionColumn(new n(""));this.attachSuggestionItemSelected(this.handleSuggestionItemSelected.bind(this));this.setAutocomplete(false);this.setTooltip(A.getText("search"));this.bindProperty("placeholder",{path:"/searchTermPlaceholder",mode:p.OneWay});this.attachLiveChange(this.handleLiveChange.bind(this));this.bindProperty("enabled",{parts:[{path:"/initializingObjSearch"}],formatter:e=>!e});this.bindAggregation("suggestionRows",{path:"/suggestions",factory:(e,t)=>this.suggestionItemFactory(e,t)});this.addStyleClass("searchInput");this._bUseDialog=false;this._bFullScreen=false;this.listNavigationMode=false},isMobileDevice:function e(){return false},onfocusin:function e(s){t.prototype.onfocusin.call(this,s);const i=this.getModel();if(i.getSearchBoxTerm().length===0&&(i.config.bRecentSearches||i.config.aiSuggestions)){i.doSuggestion()}},onsapenter:function e(...s){if(!(this["_oSuggestionPopup"]?.isOpen()&&this["_oSuggPopover"].getFocusedListItem())){this.getModel().invalidateQuery();this.triggerSearch()}t.prototype.onsapenter.apply(this,s)},triggerSearch:function e(){const t=this.getModel().getProperty("/messagePopoverControlId");const s=v.getElementById(t);if(this.getModel().getProperty("/errors").length>0&&s?.isOpen()){s.close();s.setVisible(false)}S.subscribeOnlyOnce("triggerSearch",j.ESHSearchFinished,function(){this.getModel().autoStartApp()},this);const i=this.getModel();let a=this.getValue();if(a.trim()===""&&i.config.isUshell){a="*"}a=this.shortenSearchTermByConfigLimit(a);i.setSearchBoxTerm(a,false);let n=true;for(const e of i.searchTermHandlers){const t=e.handleSearchTerm(a,this);if(t.navigateToSearchApp===false){n=false}}if(n){this.navigateToSearchApp()}this.destroySuggestionRows();i.abortSuggestions()},decorateHandleListNavigation:function e(){const t=this["_oSuggPopover"];if(t&&t.handleListNavigation&&!t.handleListNavigation.decorated){const e=t.handleListNavigation;t.handleListNavigation=(...s)=>{this.listNavigationMode=true;e.apply(t,s);this.listNavigationMode=false};t.handleListNavigation.decorated=true}},handleLiveChange:function e(){let t=this.getValue();t=this.shortenSearchTermByConfigLimit(t);const s=this.getModel();s.setSearchBoxTerm(t,false);if(s.getSearchBoxTerm().length>0||s.config.bRecentSearches){s.doSuggestion()}else{this.destroySuggestionRows();s.abortSuggestions();$(this.getDomRef()).find("input").attr("aria-expanded","false")}},shortenSearchTermByConfigLimit:function e(t){const s=this.getModel();const i=s.config.searchTermLengthLimit;if(i<0){return t}if(t.length>i){s.errorHandler.onError(new k(i));t=t.slice(0,i);this.setValue(t)}return t},handleSuggestionItemSelected:function e(t){const s=this.getModel();const i=s.getSearchBoxTerm();const a=t.getParameter("selectedRow").getBindingContext().getObject();const n=a.searchTerm||"";const o=a.dataSource||s.getDataSource();let r=a.url;const c=a.uiSuggestionType;if(c===M.Header||c===M.BusyIndicator){this.destroySuggestionRows();this.setValue("");return}s.eventLogger.logEvent({type:V.SUGGESTION_SELECT,suggestionType:c,suggestionTerm:n,searchTerm:i,targetUrl:r,dataSourceKey:o?o.id:""});if(s.config.bRecentSearches&&s.recentlyUsedStorage&&c===M.Object){s.recentlyUsedStorage.addItem(a)}this.selectText(0,0);switch(c){case M.Search:{if(H(a)){a.titleNavigation.performNavigation()}break}case M.Transaction:case M.App:this.destroySuggestionRows();s.abortSuggestions();if(r[0]==="#"){if(r.indexOf("#Action-search")===0&&(r===S.getHashFromUrl()||r===decodeURIComponent(S.getHashFromUrl()))){s.setSearchBoxTerm(s.getLastSearchTerm(),false);s.notifySubscribers(j.ESHSearchFinished);C.getInstance().publish(j.ESHSearchFinished);return}if(window["hasher"]){if(r[1]===window.hasher.prependHash){r=r.slice(0,1)+r.slice(2)}window["hasher"].setHash(r)}else{window.location.href=r}}else{this.logRecentActivity(a);window.open(r,"_blank","noopener,noreferrer");s.setSearchBoxTerm("",false);this.setValue("")}if(s.config.isUshell&&r.indexOf("#Action-search")!==0){if(!E.isSearchFieldExpandedByDefault()){sap.ui.require("sap/esh/search/ui/SearchShellHelper").collapseSearch()}}else{this.focus()}break;case M.DataSource:s.setDataSource(o,false);s.setSearchBoxTerm("",false);this.setValue("");this.focus();break;case M.SearchTermData:case M.SearchTermAI:s.setDataSource(o,false);s.setSearchBoxTerm(n,false);s.invalidateQuery();this.navigateToSearchApp();this.setValue(n);break;case M.SearchTermHistory:s.setDataSource(o,false);s.setSearchBoxTerm(n,false);s.invalidateQuery();this.navigateToSearchApp();this.setValue(n);break;case M.Object:{const e=a;if(e.titleNavigation){e.titleNavigation.performNavigation()}break}default:break}},logRecentActivity:function e(t){sap.ui.require(["sap/ushell/Config","sap/ushell/services/AppType"],function(e,s){const i=e.last("/core/shell/enableRecentActivity")&&e.last("/core/shell/enableRecentActivityLogging");if(i){const e={title:t.title,appType:s.URL,url:t.url,appId:t.url};window.sap.ushell.Container.getRenderer("fiori2").logRecentActivity(e)}})},suggestionItemFactory:function e(t,s){$(this.getDomRef()).find("input").attr("aria-expanded","true");const i=s.getObject();switch(i.uiSuggestionType){case M.Object:return this.objectSuggestionItemFactory(t,s);case M.Header:return this.headerSuggestionItemFactory(t,s);case M.BusyIndicator:return this.busyIndicatorSuggestionItemFactory();default:return this.regularSuggestionItemFactory(t,s)}},busyIndicatorSuggestionItemFactory:function e(){const t=new d("",{content:[new l("",{size:"0.6rem"})]});t["getText"]=()=>this.getValue();const s=new o("",{cells:[t],type:F.Inactive});s.addStyleClass("searchSuggestion");s.addStyleClass("searchBusyIndicatorSuggestion");s.getVisible=this.assembleListNavigationModeGetVisibleFunction();return s},headerSuggestionItemFactory:function e(t,i){const a=i.getObject();const n=[];const r=[];if(a.uiSuggestionTypeOfSuggestionsInSection===B.SearchTermAI){const e=new h({src:"sap-icon://ai"});e.addStyleClass("sapUiTinyMarginEnd");r.push(e)}const c=new s("",{text:{path:"label"}});r.push(c);const l=new g("",{direction:U.Row,justifyContent:O.Start,items:r});n.push(l);if(a.helpLink){const e=new x({text:A.getText("searchTermAILernMoreLink"),target:"_blank",href:a.helpLink});n.push(e)}const u=new g("",{direction:U.Row,justifyContent:O.SpaceBetween,items:n});u["getText"]=()=>a.label;const d=new o("",{cells:[u],type:F.Inactive});d.addStyleClass("searchSuggestion");d.addStyleClass("searchHeaderSuggestion");d.getVisible=this.assembleListNavigationModeGetVisibleFunction();return d},assembleListNavigationModeGetVisibleFunction:function e(){return()=>{if(!this.listNavigationMode){return true}return false}},assembleObjectSuggestionLabels:function e(t){const i=[];const a=new s("",{text:{path:"label1"}});a.addEventDelegate({onAfterRendering:()=>{S.boldTagUnescaper(a.getDomRef())}},a);a.addStyleClass("sapUshellSearchObjectSuggestion-Label1");i.push(a);if(t.label2){const e=new s("",{text:{path:"label2"}});e.addEventDelegate({onAfterRendering:()=>{S.boldTagUnescaper(e.getDomRef())}},e);e.addStyleClass("sapUshellSearchObjectSuggestion-Label2");i.push(e)}const n=new d("",{content:i});n.addStyleClass("sapUshellSearchObjectSuggestion-Labels");return n},objectSuggestionItemFactory:function e(t,s){const i=s.getObject();const a=[];if(i.imageExists&&i.imageUrl){if(i.imageUrl.startsWith("sap-icon://")){a.push(new h("",{src:i.imageUrl}).addStyleClass("sapUshellSearchObjectSuggestIcon"))}else{a.push(new N("",{src:{path:"imageUrl"},isCircular:{path:"imageIsCircular"}}))}}const n=this.assembleObjectSuggestionLabels(i);a.push(n);const r=new u("",{content:a});r.addStyleClass("sapUshellSearchObjectSuggestion-Container");r["getText"]=()=>this.getValue();const c=new o("",{cells:[r],type:F.Active});c.addStyleClass("searchSuggestion");c.addStyleClass("searchObjectSuggestion");return c},regularSuggestionItemFactory:function e(t,s){const a=new h("",{src:{path:"icon"}}).addStyleClass("suggestIcon").addStyleClass("sapUshellSearchSuggestAppIcon").addStyleClass("suggestListItemCell");const n=new h("",{src:{path:"filterIcon"}}).addStyleClass("suggestIcon").addStyleClass("sapUshellSearchSuggestFilterIcon").addStyleClass("suggestListItemCell");const l=new c("",{shrinkFactor:1,minWidth:"4rem"});const u=new i("",{text:{path:"label"},layoutData:l,wrapping:false}).addStyleClass("suggestText").addStyleClass("suggestNavItem").addStyleClass("suggestListItemCell");const d=s.getModel().getProperty(s.getPath());u.addEventDelegate({onAfterRendering:()=>{const e=u.getDomRef();const t=e.innerHTML;const s=t.lastIndexOf("&lt;/span&gt;")>0;if(d.uiSuggestionType===M.Search&&s){const s=t.slice(t.indexOf("&lt;span&gt;")+12,t.lastIndexOf("&lt;/span&gt;"));const i=t.slice(t.lastIndexOf("&lt;/span&gt;")+13);const a=S.boldTagUnescaperForStrings(i);e.innerHTML="<span>"+s+"</span>"+a}else{S.boldTagUnescaper(u.getDomRef())}}},u);const p=[a,u];if(d.filterIcon){p.push(n)}const f=new r("",{type:F.Active,content:new g("",{items:p,alignItems:D.Center})});f.addStyleClass("searchSuggestionCustomListItem");f["getText"]=()=>typeof d.searchTerm==="string"?d.searchTerm:this.getValue();const m=new o("",{cells:[f],type:F.Active});f.addStyleClass("searchSuggestionColumnListItem");if(d.uiSuggestionType===M.App){if(d.title&&d.title.indexOf("combinedAppSuggestion")>=0){m.addStyleClass("searchCombinedAppSuggestion")}else{m.addStyleClass("searchAppSuggestion")}}if(d.uiSuggestionType===M.DataSource){m.addStyleClass("searchDataSourceSuggestion")}if(d.uiSuggestionType===M.SearchTermData){m.addStyleClass("searchBOSuggestion")}if(d.uiSuggestionType===M.SearchTermHistory){m.addStyleClass("searchHistorySuggestion")}if(d.uiSuggestionType===M.Search){m.addStyleClass("searchRecentSuggestion")}m.addStyleClass("searchSuggestion");return m},navigateToSearchApp:function e(){const t=this.getModel();if(S.isSearchAppActive()||!t.config.isUshell){t.fireSearchQuery()}else{t.resetSearchResultItemMemory();const e=t.createSearchNavigationTargetCurrentState({updateUrl:true}).targetUrl;window.location.hash=e}},onAfterRendering:function e(s){t.prototype.onAfterRendering.call(this,s);$(this.getDomRef()).find("input").attr("autocomplete","off");$(this.getDomRef()).find("input").attr("autocorrect","off");$(this.getDomRef()).find("input").attr("type","search");$(this.getDomRef()).find("input").attr("name","search");const i=jQuery('<form action=""></form>').on("submit",function(){return false});$(this.getDomRef()).children("input").parent().append(i);$(this.getDomRef()).children("input").detach().appendTo(i);$(this.getDomRef()).find("input").attr("aria-role","combobox");$(this.getDomRef()).find("input").attr("aria-autocomplete","list");$(this.getDomRef()).find("input").attr("aria-expanded","false");$(this.getDomRef()).find("input").attr("aria-controls",this.getId()+"-popup")},onValueRevertedByEscape:function e(){if(S.isSearchAppActive()){return}this.setValue(" ")},onsapescape:function e(s){$(this.getDomRef()).find("input").attr("aria-expanded","false");t.prototype.onsapescape.call(this,s)}});return P})})();
//# sourceMappingURL=SearchInput.js.map