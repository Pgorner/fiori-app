/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../../i18n","../../SearchResultTableFormatter","../../SearchResultTableP13NPersonalizer","sap/m/Table","sap/m/plugins/ColumnResizer","sap/m/Column","sap/m/ColumnListItem","sap/m/CustomListItem","../../SearchResultTableColumnType","./SearchText","../SearchLink","sap/ui/core/Element","sap/m/library","sap/m/HBox","sap/m/Label","sap/m/Button","sap/ui/core/Icon","../../sinaNexTS/sina/NavigationTarget","sap/m/ActionSheet","sap/ui/base/ManagedObject","sap/base/util/merge","../../SearchUtil","sap/esh/search/ui/SearchHelper","sap/base/Log","../../error/ErrorHandler"],function(t,e,s,l,i,n,a,o,r,c,h,u,d,p,g,f,b,m,S,I,C,y,T,w,R){"use strict";function M(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const v=M(t);const A=M(e);const E=M(s);const P=r["TableColumnType"];const L=M(c);const x=M(h);const B=d["ListMode"];const N=d["PlacementType"];const U=d["PopinDisplay"];const V=d["PopinLayout"];const D=m["NavigationTarget"];const H=M(R);const z=l.extend("sap.esh.search.ui.controls.SearchResultTable",{renderer:{apiVersion:2},constructor:function t(e,s){l.prototype.constructor.call(this,e,s);this.useStableIds=true;this.log=w.getLogger("sap.esh.search.ui.controls.resultview.SearchResultTable");this.errorHandler=H.getInstance()},assembleTable:function t(e){this.bindProperty("mode",{parts:[{path:"/multiSelectionEnabled"}],formatter:t=>t===true?B.MultiSelect:B.None});this.setProperty("rememberSelections",false);this.attachSelectionChange(()=>{e.updateMultiSelectionSelected()});this.bindProperty("visible",{parts:[{path:"/resultViewType"},{path:"/count"}],formatter:this.formatVisible.bind(this)});this.setProperty("sticky",["ColumnHeaders"]);this.setNoDataText(v.getText("noCloumnsSelected"));this.update();if(e.config?.FF_resizeResultTableColumns===true){this.setupColumnResizable();this.addStyleClass("sapElisa-search-result-table-resizable")}else{this.addStyleClass("sapElisa-search-result-table-might-popin")}this.addStyleClass("sapElisa-search-result-table")},formatVisible:function t(e,s){const l=e==="searchResultTable"&&s!==0;if(l){if(!this.tablePersonalizer){this.tablePersonalizer=new E(this.getModel())}this.tablePersonalizer.initialize(this)}return l},update:function t(){if(!this.getBinding("columns")){this.bindTableColumns()}if(!this.getBinding("items")){this.bindTableItems()}if(this.getModel()){this.getModel().updateBindings(true)}},bindTableColumns:function t(){this.bindAggregation("columns",{path:"/tableColumns",factory:t=>{const e=new n(this.getStableId(t,"column"),{header:new g(this.getStableId(t,"headerLabel"),{text:"{name}"}),visible:"{visible}",width:"{width}"});return e}})},bindTableItems:function t(){this.bindAggregation("items",{path:"/tableRows",factory:(t,e)=>this.assembleTableItems(t,e)})},handleForwardEllipsis:function t(e){const s=e["srcControl"]?.getDomRef()?.querySelectorAll(".sapUshellSearchResultItem-AttributeValueHighlighted");if(s&&s.length>0){s.forEach(function(t){y.forwardEllipsis4Whyfound(t)})}},assembleTableItems:function t(e,s){if(s.getObject().type==="footer"){return new o(this.getStableId(e,"item-footer"),{visible:false})}this.sortCellsInRows(s.getPath());return this.assembleTableMainItem(e,s)},assembleTableMainItem:function t(e,s){const l=this.getModel();const i=new a(this.getStableId(e,"item"),{selected:{path:"selected"}}).addStyleClass("sapUshellSearchTable");i.addEventDelegate({onAfterRendering:this.handleForwardEllipsis});if(s.getObject().customItemStyleClass){i.addStyleClass(s.getObject().customItemStyleClass)}i.bindAggregation("cells",{path:"cells",factory:(t,e)=>{const s=e.getObject();if(s.type===P.TITLE){let e="";let l=false;let i=true;const n=s.titleNavigation;if(n instanceof D){l=typeof n.targetFunction==="function";e=n.targetUrl}if((typeof e!=="string"||e.length===0)&&l===false){i=false}let a;if(n){a=new x(this.getStableId(t,"link"),{navigationTarget:n,text:{path:"value"},wrapping:false})}else{a=new L(this.getStableId(t,"link"),{text:{path:"value"},wrapping:false})}const o=s.titleIconUrl;if(o&&!(a.getAggregation("icon")instanceof b)){const e=new b(this.getStableId(t,"icon"),{src:I.escapeSettingsValue(o)});a.setIcon(e)}a.addStyleClass("sapUshellSearchResultListItem-MightOverflow");a.addStyleClass("sapUshellSearchTableTitleLink");if(s.isHighlighted){a.addStyleClass("sapUshellSearchResultItem-AttributeValueHighlighted")}let r=a;const c=s.titleInfoIconUrl;if(c){const e=new b(this.getStableId(t,"infoIcon"),{src:I.escapeSettingsValue(c),tooltip:v.getText("collectionShared")}).addStyleClass("sapUshellSearchTableTitleInfoIcon");if(!i){e.addStyleClass("sapUshellSearchTableTitleInfoIconDisabled")}r=new p(this.getStableId(t,"titleContainer"),{items:[a,e]})}return r}if(s.type===P.RELATED_APPS){const e=new f(this.getStableId(t,"relAppsButton"),{icon:"sap-icon://action",tooltip:v.getText("intents"),press:()=>{const l=u.getElementById(this.getStableId(e.getId(),"relAppsActionSheet"));if(l){l.destroy();return}const i=s.navigationObjects;const n=[];let a;const o=(t,e)=>{if(e instanceof D){e.performNavigation({event:t})}};for(let e=0;e<i.length;e++){const s=i[e];this.destroyControl(this.getStableId(t,`navButton${e}`));a=new f(this.getStableId(t,`navButton${e}`),{text:I.escapeSettingsValue(s?.text),tooltip:I.escapeSettingsValue(s?.text)});a.attachPress(s,o);n.push(a)}const r=new S(this.getStableId(e.getId(),"relAppsActionSheet"),{buttons:n,placement:N.Auto});r.attachAfterClose(()=>{r.destroy()});r.openBy(e)}});e.addStyleClass("sapElisaSearchTableRelatedAppsButton");return e}const i=s.defaultNavigationTarget;if(i instanceof D){const e=new x(this.getStableId(t,"attrLink"),{navigationTarget:null,wrapping:false,tooltip:I.escapeSettingsValue(s.tooltip||"")});e.setNavigationTarget(i);e.setText(s.value);e.addStyleClass("sapUshellSearchResultListItem-MightOverflow");let l=null;const n=s.icon;const a=e.getAggregation("icon");if(a instanceof b){a.addStyleClass("sapUshellSearchResultListItem-AttributeIcon")}else if(typeof n==="string"&&n.startsWith("sap-icon://")){l=new b(this.getStableId(t,"attrIcon"),{src:I.escapeSettingsValue(n)});l.addStyleClass("sapUshellSearchResultListItem-AttributeIcon");e.setIcon(l)}return e}if(s.type===P.EXTEND){try{return l.config.extendTableColumn.bindingFunction(s)}catch(t){this.errorHandler.onError(t)}}const n=new L(this.getStableId(t,"searchText"),{text:{path:"value"},wrapping:false}).addStyleClass("sapUshellSearchResultListItem-MightOverflow");if(s.icon){const e=new b(this.getStableId(t,"cellIcon"),{src:I.escapeSettingsValue(s.icon)});n.setIcon(e)}if(s.isHighlighted){n.addStyleClass("sapUshellSearchResultItem-AttributeValueHighlighted")}return n}});return i},sortCellsInRows:function t(e){const s=this.getModel();let l;if(e){const t=[s.getProperty(e)][0];t.cells=this.getSortedCells(t.cells);s.setProperty(e,t)}else{l=s.getProperty("/tableRows");for(const t of l){t.cells=this.getSortedCells(t.cells)}s.setProperty("/tableRows",l)}},getSortedCells:function t(e){const s=[];const l=this.getModel().getTableColumns(false);for(const t of l){for(const l of e){if(t.p13NColumnName===l.p13NColumnName){s.push(l);break}}}return s},setupColumnResizable:function t(){const e=this;const s=new i;s.attachColumnResize(()=>{setTimeout(function(){e.getModel().saveTableColumns(e.getModel().getTableColumns(false))},500)});e.addDependent(s)},setupPopin:function t(){const e=this.getModel();if(!e){return}this.setPopinLayout(V.Block);let s=0;this.getColumns().forEach(function(t){t.setDemandPopin(true);t.setPopinDisplay(U.Inline);if(t.getVisible()){s++;t.setMinScreenWidth(12*s+"rem")}})},setupColumnsAbsoluteWidth:function t(){const e=this.getModel();if(!e){return}const s=this?.$()?.width();if(typeof s!=="number"){return}const l=typeof this?.$()?.find("table th.sapMListTblSelCol").width()!=="number"?0:this?.$()?.find("table.sapMListModeMultiSelect th.sapMListTblSelCol").width();const i=C([],e.getTableColumns(false));const n=new A(e);let a=0;let o=0;i.forEach(t=>{const e=n.getColumnWidthInPixel(t.width);if(e){a+=e}else{t.width=n.defaultColumnWidth;if(t.visible){o++}}});if(o===0){return}const r=2;const c=Math.trunc((s-l-a)/o-r)+"px";i.forEach(t=>{const e=n.getColumnWidthInPixel(t.width);if(!e){t.width=c}});e.setTableColumns(i,true)},setupEllipsisAndTooltip:function t(){let e;e=$(this.getDomRef()).find("tbody > tr > td");e.each((t,e)=>{T.attachEventHandlersForTooltip(e)});e=$(this.getDomRef()).find("tbody .sapMListTblSubCntValInline");e.each((t,e)=>{T.attachEventHandlersForTooltip(e)})},getStableId:function t(e,s,l="-"){if(this.useStableIds){return`${e}${l}${s}`}else{return""}},destroyControl:function t(e){const s=u.getElementById(e);if(s){s.destroy()}},onBeforeRendering:function t(){},onAfterRendering:function t(){const e=this.getModel();$(this.getDomRef())?.find("table > tbody > tr > td.sapMListTblCellNoData:first")?.attr("colspan",3);const s=$(this.getDomRef())?.find("table > thead > tr:first");if(s){s?.attr("aria-labelledby",e?.getSearchCompositeControlInstanceByChildControl(this)?.countBreadcrumbsHiddenElement.getId())}this.setupEllipsisAndTooltip();if(e.config?.FF_resizeResultTableColumns===true){this.setupColumnsAbsoluteWidth()}if(e.config?.FF_resizeResultTableColumns!==true){this.setupPopin()}}});return z})})();
//# sourceMappingURL=SearchResultTable.js.map