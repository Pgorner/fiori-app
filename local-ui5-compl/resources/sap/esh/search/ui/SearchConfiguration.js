/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./controls/resultview/SearchResultListSelectionHandler","./controls/resultview/SearchResultListItemNote","./SearchConfigurationSettings","sap/base/Log","sap/base/assert"],function(e,t,o,s,r){"use strict";function a(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const i=a(e);const n=a(t);const u=a(o);const c=o["defaultSearchConfigurationSettings"];const l=o["deprecatedParameters"];class d extends u{log=(()=>s.getLogger("sap.esh.search.ui.SearchConfiguration"))();dataSourceConfigurations;dataSourceConfigurations_Regexes=[];defaultDataSourceConfig=(()=>({searchResultListItem:undefined,searchResultListItemControl:undefined,searchResultListItemContent:undefined,searchResultListItemContentControl:undefined,searchResultListSelectionHandler:i["getMetadata"]().getName(),searchResultListSelectionHandlerControl:i}))();documentDataSourceConfiguration;_dataSourceLoadingProms;_loadCustomModulesProm;constructor(e){super();jQuery.extend(this,e);if(this.isUshell){this.aiNlq=true;this.readUshellConfiguration();this.readOutdatedUshellConfiguration()}this.updateConfigFromUrlParameters();this.initDataSourceConfig();this.setModulePaths();this.checkForDeprecatedParameters()}checkForDeprecatedParameters(){for(const e in l){if(e in this){if(typeof this[e]==="function"&&this[e].length===0){continue}let t=`You are using a deprecated configuration property for SearchCompositeControl which will be removed in a future release: '${e}'.`;if(l[e].replacedBy in this){this[l[e].replacedBy]=this[e];t+=`\nPlease use '${l[e].replacedBy}' instead.`}if(l[e].replacementInfo){t+=`\n${l[e].replacementInfo}`}r(false,t)}}}setModulePaths(){if(!this.modulePaths){return}for(let e=0;e<this.modulePaths.length;++e){const t=this.modulePaths[e];const o=t.urlPrefix.replace("${host}",window.location.protocol+"//"+window.location.host);jQuery.sap.registerModulePath(t.moduleName,o)}}readUshellConfiguration(){try{const e=window["sap-ushell-config"].renderers.fiori2.componentData.config.esearch;jQuery.extend(true,this,e)}catch(e){this.log.debug("Could not read ushell configuration",e)}}readOutdatedUshellConfiguration(){try{const e=window["sap-ushell-config"].renderers.fiori2.componentData.config;if(typeof e.searchBusinessObjects!=="undefined"){if(e.searchBusinessObjects==="hidden"||e.searchBusinessObjects===false){this.searchBusinessObjects=false}else{this.searchBusinessObjects=true}}}catch(e){this.log.debug("Could not read ushell configuration",e)}}initDataSourceConfig(){this.dataSourceConfigurations={};this.dataSourceConfigurations_Regexes=[];if(this.dataSources){for(let e=0;e<this.dataSources.length;e++){const t=this.dataSources[e];if(t.id){this.dataSourceConfigurations[t.id]=t}else if(t.regex){const e=t.regexFlags||undefined;const o=new RegExp(t.regex,e);if(o){t.regexObject=o;this.dataSourceConfigurations_Regexes.push(t)}}else{const e="Following datasource configuration does neither include a valid id nor a regular expression, therefore it is ignored:\n"+JSON.stringify(t);this.log.warning(e)}}}this.dataSources=undefined;this.documentDataSourceConfiguration={searchResultListItem:"sap.esh.search.ui.controls.SearchResultListItemDocument"};const e=this.dataSourceConfigurations.noteprocessorurl||{};this.dataSourceConfigurations.noteprocessorurl=e;this.dataSourceConfigurations.noteprocessorurl.searchResultListItemControl=this.dataSourceConfigurations.noteprocessorurl.searchResultListItemControl||new n;this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler=this.dataSourceConfigurations.noteprocessorurl.searchResultListSelectionHandler||"sap.esh.search.ui.controls.resultview.SearchResultListSelectionHandlerNote"}getParameterType(e){if(e in l){if(l[e]){e=l[e].replacedBy}else{return"string"}}if(!c.hasOwnProperty(e)){return""}return typeof c[e]}parseBoolean(e){if(e.toLowerCase()==="true"){return true}return false}parseEsDevConfig(e){const t=JSON.parse(e);jQuery.extend(this,t)}updateConfigFromUrlParameters(){const e=this.parseUrlParameters();for(const t in e){const o=e[t];const s=this.getParameterType(t);if(t.startsWith("sina")){continue}if(t==="demoMode"){this.searchBusinessObjects=true;continue}if(t==="resultViewTypes"){let e=o.split(",");e=e.filter(e=>e.length>0);this.resultViewTypes=e;continue}if(t==="esDevConfig"){this.parseEsDevConfig(o);continue}switch(s){case"string":this[t]=o;break;case"number":this[t]=parseInt(o);break;case"boolean":this[t]=this.parseBoolean(o);break;default:}}}parseUrlParameters(){if(!URLSearchParams){return{}}const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries())}loadCustomModulesAsync(){if(this._loadCustomModulesProm){return this._loadCustomModulesProm}let e;const t=[];for(const o in this.dataSourceConfigurations){e=this.loadCustomModulesForDataSourceIdAsync(o);t.push(e)}this._loadCustomModulesProm=Promise.all(t);return this._loadCustomModulesProm}async loadCustomModulesForDataSourcesAsync(e,t){const o=[];for(let s=0;s<e.length;s++){const r=Array.isArray(t)&&t.length>s&&t[s]||{};const a=this.loadCustomModulesForDataSourceAsync(e[s],r);o.push(a)}return Promise.all(o)}loadCustomModulesForDataSourceAsync(e,t={}){t=t||{};return this.loadCustomModulesForDataSourceIdAsync(e.id,t)}loadCustomModulesForDataSourceIdAsync(e,t){if(!e){return Promise.resolve()}this._dataSourceLoadingProms=this._dataSourceLoadingProms||{};let o=this._dataSourceLoadingProms[e];if(!o){const s=[{moduleAttrName:"searchResultListItem",controlAttrName:"searchResultListItemControl"},{moduleAttrName:"searchResultListItemContent",controlAttrName:"searchResultListItemContentControl"},{moduleAttrName:"searchResultListSelectionHandler",controlAttrName:"searchResultListSelectionHandlerControl"}];const r=this._prepareDataSourceConfigurationForDataSource(e,t);let a;const i=[];for(let t=0;t<s.length;t++){a=this._doLoadCustomModulesAsync(e,r,s[t].moduleAttrName,s[t].controlAttrName);i.push(a)}o=Promise.all(i);o._resolvedOrFailed=false;o.then(function(){o._resolvedOrFailed=true});this._dataSourceLoadingProms[e]=o}return o}_doLoadCustomModulesAsync(e,t,o,s,r,a){const i=this;return new Promise(function(n){if(t[o]&&(!t[s]||t[s]==i.defaultDataSourceConfig[s])){try{sap.ui.require([t[o].replace(/[.]/g,"/")],function(e){t[s]=e;n()})}catch(u){let c="Could not load custom module '"+t[o]+"' for data source with id '"+e+"'. ";c+="Falling back to default data source configuration.";i.log.warning(c,u);t[o]=r||i.defaultDataSourceConfig[o];t[s]=a||i.defaultDataSourceConfig[s];n()}}else{if(!t[s]){t[o]=r||i.defaultDataSourceConfig[o];t[s]=a||i.defaultDataSourceConfig[s]}n()}})}getDataSourceConfig(e){if(this._dataSourceLoadingProms&&this._dataSourceLoadingProms[e.id]&&!this._dataSourceLoadingProms[e.id]._resolvedOrFailed){return this.defaultDataSourceConfig}let t=this.dataSourceConfigurations[e.id];if(!t){t=this.defaultDataSourceConfig;this.dataSourceConfigurations[e.id]=t}return t}_prepareDataSourceConfigurationForDataSource(e,t){let o={};if(this.dataSourceConfigurations[e]){o=this.dataSourceConfigurations[e]}else{for(let t=0;t<this.dataSourceConfigurations_Regexes.length;t++){if(this.dataSourceConfigurations_Regexes[t].regexObject.test(e)){o=this.dataSourceConfigurations_Regexes[t];break}}}if(t&&t.isDocumentConnector){if(!o.searchResultListItem){o.searchResultListItem=this.documentDataSourceConfiguration.searchResultListItem}else{const t="Will attempt to load '"+o.searchResultListItem+"' instead of '"+this.documentDataSourceConfiguration.searchResultListItem+"' for data source '"+e+"'";this.log.warning(t)}}this.dataSourceConfigurations[e]=o;return o}}return d})})();
//# sourceMappingURL=SearchConfiguration.js.map