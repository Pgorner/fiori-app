/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./i18n","sap/m/MessageBox","./SearchModel","sap/ui/core/library","./hierarchydynamic/SearchHierarchyDynamicFacet","./SearchFacetDialogHelperDynamicHierarchy"],function(t,e,i,r,s,a){"use strict";function n(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const o=n(t);const l=n(i);const c=r["TextDirection"];const h=n(s);const u=a["createFilterFacetItemForDynamicHierarchy"];class d extends l{aFilters;chartQuery;searchModel;constructor(t){super({searchModel:t.searchModel,configuration:t.searchModel.config});this.searchModel=t.searchModel;this.aFilters=[]}prepareFacetList(){const t=this.getDataSource();this.setProperty("/facetDialog",this.oFacetFormatter.getDialogFacetsFromMetaData(t,this));this.initialFillFiltersForDynamicHierarchyFacets()}initialFillFiltersForDynamicHierarchyFacets(){const t=this.getProperty("/uiFilter");const e=this.getProperty("/facetDialog");for(const i of e){if(!(i instanceof h)){continue}const e=t.rootCondition.getAttributeConditions(i.attributeId);for(const t of e){const e=t;const r=u(i,e);this.aFilters.push(r)}}}facetDialogSingleCall(t){this.chartQuery.dimension=t.sAttribute;this.chartQuery.top=t.sAttributeLimit;this.chartQuery.setNlq(this.searchModel.isNlqActive());return this.chartQuery.getResultSetAsync().then(e=>{let i;if(t.bInitialFilters){i=this.oFacetFormatter.getDialogFacetsFromChartQuery(e,this,this.chartQuery.dimension)}else{i=this.oFacetFormatter.getDialogFacetsFromChartQuery(e,this,this.chartQuery.dimension,this.aFilters)}const r=jQuery.extend(true,{},i);i.items4pie=r.items;let s=0,a=0,n=0,l=0;for(let t=0;t<i.items4pie.length;t++){if(t<9){i.items4pie[t]["pieReady"]=true;if(parseInt(i.items4pie[t].value)>0){s+=parseInt(i.items4pie[t].value)}}else{i.items4pie[t]["pieReady"]=false;if(parseInt(i.items4pie[t].value)>0){a+=parseInt(i.items4pie[t].value)}}}n=a*100/(s+a);n=Math.ceil(n);l=s/9;l=Math.floor(l);if(n>0){const t=i.items4pie[0].clone();t.value=l.toString();t.label=o.getText("facetPieChartOverflowText2",[n.toString(),"9"]);t["pieReady"]=true;t.valueLabel=""+l;t["isPieChartDummy"]=true;i.items4pie.push(t)}for(let t=0;t<i.items4pie.length;t++){i.items4pie[t]["percentageMissingInBigPie"]=n}this.setProperty(t.sBindingPath+"/items4pie",i.items4pie);this.setProperty(t.sBindingPath+"/items",i.items)},t=>{const i=o.getText("searchError");const r=t.message;e.error(r,{title:i,actions:e.Action.OK,onClose:null,styleClass:"",initialFocus:null,textDirection:c.Inherit})})}resetChartQueryFilterConditions(){if(this.chartQuery){this.chartQuery.resetConditions()}const t=this.getNonFilterByFilterConditions();if(t.length>0){for(const e of t){this.chartQuery.autoInsertCondition(e)}}}hasFilterCondition(t){for(let e=0;e<this.aFilters.length;e++){if(this.aFilters[e].filterCondition.equals&&this.aFilters[e].filterCondition.equals(t)){return true}}return false}hasFilter(t){const e=t.filterCondition;return this.hasFilterCondition(e)}addFilter(t){if(!this.hasFilter(t)){this.aFilters.push(t)}}removeFilter(t){const e=t.filterCondition;for(let t=0;t<this.aFilters.length;t++){if(this.aFilters[t].filterCondition.equals&&this.aFilters[t].filterCondition.equals(e)){this.aFilters.splice(t,1);return}}}changeFilterAdvaced(t,e){const i=t.filterCondition;for(let t=0;t<this.aFilters.length;t++){if(this.aFilters[t].filterCondition.equals&&this.aFilters[t].filterCondition.equals(i)){this.aFilters[t].advanced=e;return}}}addFilterCondition(t){this.chartQuery.filter.autoInsertCondition(t)}getAttributeDataType(t){switch(t.dataType){case"Integer":return"integer";case"Double":return"number";case"Timestamp":return"timestamp";case"Date":return"date";case"String":if(t.matchingStrategy===this.sinaNext.MatchingStrategy.Text){return"text"}return"string";default:return"string"}}destroy(){super.destroy();this.oFacetFormatter.destroy()}}return d})})();
//# sourceMappingURL=SearchFacetDialogModel.js.map