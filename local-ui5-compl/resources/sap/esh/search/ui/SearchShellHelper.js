/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./i18n","./controls/searchfieldgroup/SearchFieldGroup","sap/esh/search/ui/SearchHelper","sap/esh/search/ui/SearchModel","./SearchFieldStateManager","./SearchShellHelperHorizonTheme","./UIEvents","sap/ui/core/Element","sap/ui/core/EventBus","sap/ui/model/resource/ResourceModel"],function(e,t,a,s,i,c,r,h,o,l){"use strict";function n(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const u=n(e);const S=n(t);const d=n(i);const p=n(c);const f=n(r);class g{static isInitialized;static SearchModel;static sSearchOverlayCSS;static oModel;static oShellHeader;static oSearchFieldGroup;static oSearchSelect;static oSearchInput;static oSearchButton;static oSearchCancelButton;static focusInputFieldTimeout;static isFocusHandlerActive;static searchFieldStateManager;constructor(){throw new Error("Cannot instantiate static class 'SearchShellHelper'")}static init(){if(this.isInitialized){return}this.isInitialized=true;window.sap.ushell.Container.getServiceAsync("Search").then(e=>{e.prefetch()});this.oModel=s.getModelSingleton({},"flp");this.oSearchFieldGroup=new S("searchFieldInShell");this.oSearchFieldGroup.setModel(this.oModel);this.oSearchFieldGroup.setModel(new l({bundle:u}),"i18n");this.oSearchInput=this.oSearchFieldGroup.input;this.oSearchInput.setMaxSuggestionWidth("30rem");this.oSearchInput.setValue(this.oModel.getSearchBoxTerm());this.oSearchSelect=this.oSearchFieldGroup.select;this.oSearchSelect.setTooltip(u.getText("searchInTooltip"));this.oSearchSelect.addEventDelegate({onAfterRendering:()=>{jQuery('[id$="searchFieldInShell-select-icon"]').attr("title",u.getText("searchIn"))}},this.oSearchSelect);this.oSearchSelect.setTooltip(u.getText("searchIn"));this.oSearchSelect.attachChange(()=>{this.searchFieldStateManager.focusInputField({selectContent:true})});this.oSearchButton=this.oSearchFieldGroup.button;this.oSearchButton.attachPress(()=>{this.handleClickSearchButton()});this.oSearchCancelButton=this.oSearchFieldGroup.cancelButton;this.oSearchCancelButton.attachPress(()=>{this.collapseSearch(true)});this.oSearchFieldGroup.setCancelButtonActive(false);this.oShellHeader=h.getElementById("shell-header");this.oShellHeader.setSearch(this.oSearchFieldGroup);this.searchFieldStateManager=new d({shellHeader:this.oShellHeader,searchInput:this.oSearchInput,model:this.oModel,cancelButton:this.oSearchCancelButton,isNoResultsScreen:this.isNoSearchResultsScreen.bind(this)});jQuery(document).on("keydown",this.fnEscCallBack.bind(this));o.getInstance().subscribe("shell","searchCompLoaded",this.onSearchComponentLoaded.bind(this),{});this.oModel.subscribe(f.ESHSearchFinished,this.onAllSearchFinished.bind(this),{});h.getElementById("viewPortContainer").attachAfterNavigate(this.onAfterNavigate.bind(this),{});o.getInstance().subscribe("sap.ushell","appComponentLoaded",()=>{if(this?.oModel?.focusHandler&&a.isSearchAppActive()){this.oModel.focusHandler.setFocus()}});this.oShellHeader.attachSearchSizeChanged(this.sizeSearchFieldChanged.bind(this))}static fnEscCallBack(e){if(e.keyCode!==27){return}if(!this.oSearchInput.getDomRef().contains(document.activeElement)){return}if(a.isSearchAppActive()){return}e.preventDefault();if(this.oSearchInput.getValue()===""){this.collapseSearch(true)}else if(this.oSearchInput.getValue()===" "){this.oSearchInput.setValue("")}}static sizeSearchFieldChanged(e){const t=e.getParameters()["remSize"];let a=24;if(t<=a){this.oSearchSelect.setDisplayMode("icon")}else{this.oSearchSelect.setDisplayMode("default")}a=9;if(t<a){this.oSearchButton.setVisible(false)}else{this.oSearchButton.setVisible(true)}if(e.getParameter("isFullWidth")){this.oSearchFieldGroup.setCancelButtonActive(true);this.oSearchFieldGroup.addStyleClass("sapUshellSearchInputFullWidth")}else{this.oSearchFieldGroup.setCancelButtonActive(false);this.oSearchFieldGroup.removeStyleClass("sapUshellSearchInputFullWidth")}}static sizeChanged(e){switch(e.name){case"Phone":this.oSearchFieldGroup.setCancelButtonActive(true);break;case"Tablet":this.oSearchFieldGroup.setCancelButtonActive(false);break;case"Desktop":this.oSearchFieldGroup.setCancelButtonActive(false);break;default:break}}static expandSearch(e){this.searchFieldStateManager.expandSearch(e)}static collapseSearch(e){this.searchFieldStateManager.collapseSearch(e)}static isNoSearchResultsScreen(){return a.isSearchAppActive()&&this.oModel.getProperty("/boCount")===0&&this.oModel.getProperty("/appCount")===0}static onShellSearchButtonPressed(){g.init();if(!a.isSearchAppActive()&&this.oShellHeader.getSearchState()==="COL"){this.resetModel()}this.expandSearch(true)}static handleClickSearchButton(){if(this.oSearchInput.getValue()===""&&this.oModel.getDataSource()===this.oModel.getDefaultDataSource()){if(p.isSearchFieldExpandedByDefault()){this.searchFieldStateManager.focusInputField()}else{this.collapseSearch(true);window.setTimeout(()=>{h.getElementById("sf").focus()},1e3)}}}static getSearchInput(){return this.oSearchFieldGroup?this.oSearchFieldGroup.input:null}static onAfterNavigate(e){if(e.getParameter("toId")!=="shellPage-Action-search"&&e.getParameter("toId")!=="applicationShellPage-Action-search"&&e.getParameter("toId")!=="application-Action-search"){return}this.oModel.focusHandler.setFocus();this.oModel.notifySubscribers(f.ESHSearchLayoutChanged)}static onAllSearchFinished(){this.oSearchInput.setValue(this.oModel.getSearchBoxTerm())}static onSearchComponentLoaded(){if(!a.isSearchAppActive()){return}this.expandSearch()}static resetModel(){this.oSearchInput.setValue("");this.oModel.resetQuery()}static setSearchState(e){switch(e){case"EXP":case"EXP_S":this.searchFieldStateManager.expandSearch();break;case"COL":this.searchFieldStateManager.collapseSearch();break}}static setSearchStateSync(e){this.setSearchState(e)}static isDefaultOpen;static getDefaultOpen(){return this.isDefaultOpen}static setDefaultOpen(e){this.isDefaultOpen=e}}return g})})();
//# sourceMappingURL=SearchShellHelper.js.map