/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["sap/m/MessageBox","./error/errors","./i18n"],function(e,t,a){"use strict";function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const o=r(t);const i=r(a);function s(e){if(e&&e.conditions){return true}return false}class n{model;constructor(e){this.model=e.model}async parseUrlParameters(t){if(t.top){const e=parseInt(t.top,10);this.model.setTop(e,false)}let a=this.model.sinaNext.allDataSource;if(t.datasource){const r=JSON.parse(t.datasource);const s=r.ObjectName.value;switch(r.Type){case"Category":if(s==="$$ALL$$"){a=this.model.sinaNext.allDataSource}else{a=this.model.sinaNext.getDataSource(s);if(!a){a=this.model.sinaNext.createDataSource({type:this.model.sinaNext.DataSourceType.Category,id:s,label:r.label,labelPlural:r.labelPlural})}}break;case"BusinessObject":a=this.model.sinaNext.getDataSource(s);if(!a){a=this.model.sinaNext.allDataSource;delete t.filter;e.show(i.getText("searchUrlParsingErrorLong")+"\n(Unknow datasource "+s+")",{icon:e.Icon.ERROR,title:i.getText("searchUrlParsingError"),actions:[e.Action.OK]})}break;default:{const e=new Error("Unknown datasource type "+r.Type);throw new o.UnknownDataSourceType(e)}}}await this.model.sinaNext.loadMetadata(a);const r={dataSource:a};let s;if(t.filter){try{const e=JSON.parse(t.filter);s=this.parseCondition(r,e)}catch(t){s=this.model.sinaNext.createComplexCondition();e.show(i.getText("searchUrlParsingErrorLong")+"\n("+t.toString()+")",{icon:e.Icon.ERROR,title:i.getText("searchUrlParsingError"),actions:[e.Action.OK]})}}else{s=this.model.sinaNext.createComplexCondition()}const n=this.model.sinaNext.createFilter({dataSource:a,searchTerm:t.searchterm,rootCondition:s});this.model.setProperty("/uiFilter",n);this.model.setDataSource(n.dataSource,false)}parseCondition(e,t){if(s(t)){return this.parseComplexCondition(e,t)}return this.parseSimpleCondition(e,t)}parseComplexCondition(e,t){const a=[];for(let r=0;r<t.conditions.length;++r){const o=t.conditions[r];a.push(this.parseCondition(e,o))}return this.model.sinaNext.createComplexCondition({operator:t.operator,conditions:a,valueLabel:t.label})}parseSimpleCondition(e,t){e.attribute=t.attribute;return this.model.sinaNext.createSimpleCondition({attribute:t.attribute,attributeLabel:t.attributeLabel,value:this.parseValue(e,t.value),valueLabel:t.valueLabel||t.label,operator:this.parseOperator(e,t.operator)})}parseValue(e,t){const a=e.dataSource.getAttributeMetadata(e.attribute);return this.model.sinaNext.inav2TypeConverter.ina2Sina(a.type,t)}parseOperator(e,t){switch(t){case"=":return this.model.sinaNext.ComparisonOperator.Eq;case">":return this.model.sinaNext.ComparisonOperator.Gt;case">=":return this.model.sinaNext.ComparisonOperator.Ge;case"<":return this.model.sinaNext.ComparisonOperator.Lt;case"<=":return this.model.sinaNext.ComparisonOperator.Le;default:throw"Unknown operator "+t}}}return n})})();
//# sourceMappingURL=SearchUrlParserInav2.js.map