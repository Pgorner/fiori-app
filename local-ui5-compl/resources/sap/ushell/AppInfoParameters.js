// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/services/AppConfiguration","sap/base/util/deepClone","sap/base/util/isPlainObject","sap/base/util/restricted/_curry","sap/base/util/restricted/_zipObject","sap/ui/VersionInfo","sap/ushell/Container"],(e,t,r,n,a,i,s,o)=>{"use strict";const p="LAUNCHPAD";const u=["productName","theme","appIntent"];const c=["productName","theme","languageTag","appIntent","technicalAppComponentId","appId","appVersion","appSupportInfo","appFrameworkVersion","appFrameworkId","title","applicationParams","shellFrameworkVersion"];class l{#e={theme:this.#t.bind(this,"User.env.sap-theme-NWBC"),languageTag:this.#t.bind(this,"User.env.sap-languagebcp47"),appIntent:this.#r.bind(this),appFrameworkId:this.#n.bind(this),appFrameworkVersion:this.#a.bind(this),appSupportInfo:this.#i.bind(this),technicalAppComponentId:this.#s.bind(this),appId:this.#o.bind(this),appVersion:this.#p.bind(this),productName:a(this.#u.bind(this))("productName"),applicationParams:this.#c.bind(this)};#l={};#m={};#h(e){let t=e.applicationType;if(t==="TR"){t="GUI"}return t}#f(){return t.getCurrentApplication()?.appCapabilities||{}}async#a(t){const r=this.#h(t);if(r==="UI5"){try{const e=await s.load();return`${e.version||""} (${e.buildTimestamp||""})`||""}catch(t){e.error("VersionInfo could not be loaded",t)}}}async#p(e){const t=e.componentInstance;if(t){const e=t.getManifestEntry("/sap.app/applicationVersion/version");return e}}async#i(e){const[t]=await e.getTechnicalParameter("sap-ach")||[];if(t){return t}return this.#f().appSupportInfo}async#s(e){const r=this.#h(e);const n=t.getMetadata();if(r==="UI5"){const t=e.componentInstance;if(t){let e=t.getManifestEntry("/sap.ui5/componentName");if(!e){e=t.getMetadata().getComponentName()}return e}return n.technicalName}if(r==="URL"){const e=t.getCurrentApplication();if(e.appCapabilities.technicalAppComponentId){return e.appCapabilities.technicalAppComponentId}}if(r==="GUI"){return(n.technicalName||"").replace(/ .*/,"").replace(/^\*/,"")}if(r==="WDA"||r==="NWBC"){return n.technicalName}}async#o(e){const[t]=await e.getTechnicalParameter("sap-fiori-id")||[];if(e.homePage){if(t){if(t!==""){return`${p} (${t})`}return p}return p}else if(t){return t}return this.#f().appId||e.inboundPermanentKey}async#t(e){const t=await o.getServiceAsync("ReferenceResolver");const r=await t.resolveReferences([e]);return r[e]}async#n(e){const r=t.getCurrentApplication();let n=this.#h(e);if(n==="URL"){n=r.appCapabilities&&r.appCapabilities.appFrameworkId}const a={NWBC:"WDA",TR:"GUI"};return a[n]||n}async#u(e,t){const r=await t.getSystemContext();return r.getProperty(e)}async#r(){const e=window.hasher&&window.hasher.getHash();if(!e){throw new Error("Could not identify current application hash")}return e}async#c(e,t){let r={};if(t?.getCurrentAppTargetResolution?.().extendedInfo){r=t.getCurrentAppTargetResolution().extendedInfo.appParams}return r}async getAllAppInfo(e,t,r,n){const a={};const i=Object.keys(this.#e);const s=Object.keys(this.#l);const o=Array.from(new Set([...i,...s]));try{const r=await this.#d(o,t,n);for(const t in r){if(e){a[t]=r[t]}else{a[t]={value:r[t]}}}}catch{}const p=Object.keys(this.#m);try{const r=await this.#d(p,t,n);for(const t in r){if(e){a[t]=r[t].value}else{a[t]=r[t]}}}catch{}return a}async getInfo(e,t,r){if(!t){throw new Error("Parameter application missing")}return this.#d(["appFrameworkId"],t,r).then(()=>this.#d(e,t,r))}async#d(t,r,n){const a=t.map(async t=>{if(c.includes(t)){if(Object.hasOwn(this.#l,t)){return this.#l[t]}if(Object.hasOwn(this.#e,t)){return this.#e[t](r,n)}e.error(`value for parameter '${t}' is not set.`);return}if(Object.hasOwn(this.#m,t)){if(true){const e=this.#m[t];if(e.migrated){return e.value}}return this.#m[t]}if(t.includes(".")){return this.#u(t,r,n)}e.error(`'${t}' is not a valid app info parameter`)});return Promise.allSettled(a).then(e=>{for(let t=0;t<e.length;t++){if(e[t].status==="fulfilled"){e[t]=e[t].value}else{e[t]=undefined}}return i(t,e)})}setCustomAttributes(t){if(t===undefined||Object.keys(t).length===0){this.flush();return}let a=r(t);if(a.info&&Object.keys(a).length===1){e.error("The old interface for setting custom attributes is deprecated and will be removed in future.");a=a.info}const i={};for(const t in a){if(t==="customProperties"){continue}if(u.includes(t)){e.error(`Attribute '${t}' is restricted and will be ignored.`);continue}if(!c.includes(t)){if(true){e.error(`Attribute '${t}' is not supported and will be moved to customProperties instead. This migration will be removed in future.`);i[t]={value:a[t],showInAbout:false,migrated:true};continue}e.error(`Attribute '${t}' is not supported and will be ignored. It should be moved to the customProperties instead.`);continue}const r=a[t];if(typeof r!=="string"){e.error(`Attribute value for '${t}' is not a string and will be ignored.`);continue}this.#l[t]=r}const s={...i,...a.customProperties};for(const t in s){let r=s[t];if(!n(r)){e.error(`Custom attribute '${t}' does not have the correct format. This property will be ignored in future.`);r={value:r,showInAbout:false,migrated:true}}if(!this.#g(t,r)){continue}this.#m[t]=r}}#g(t,r){if(!n(r)){e.error(`Custom attribute '${t}' does not have the correct format and will be ignored.`);return false}if(r.showInAbout===false){return true}r.showInAbout=true;if(!r.label){e.error(`Custom attribute '${t}' has no label and will be ignored.`);return false}return true}store(e={}){e.appInfoParameters={appParameters:r(this.#l),customAppParameters:r(this.#m)}}restore(e={}){const{appParameters:t,customAppParameters:n}=e.appInfoParameters||{};this.#l=t?r(t):{};this.#m=n?r(n):{}}flush(){this.#l={};this.#m={}}}return new l},false);
//# sourceMappingURL=AppInfoParameters.js.map