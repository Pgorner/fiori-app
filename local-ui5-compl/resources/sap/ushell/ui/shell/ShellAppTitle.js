// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Bar","sap/m/Button","sap/m/Label","sap/m/HBox","sap/m/VBox","sap/m/library","sap/m/Popover","sap/m/ResponsivePopover","sap/m/Title","sap/m/ToggleButton","sap/ui/core/Element","sap/ui/core/Icon","sap/ui/core/IconPool","sap/ui/Device","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/state/StateManager","sap/ushell/state/ShellModel"],function(e,t,o,l,s,n,i,p,a,r,u,h,c,d,v,y,A,g,f,M,P){"use strict";const S=A.AppTitleState;const C=A.AllMyAppsState;const T=n.PlacementType;const m=M.ShellMode;var _=t.extend("sap.ushell.ui.shell.ShellAppTitle",{metadata:{library:"sap.ushell",properties:{title:{type:"string",group:"Data",defaultValue:null},subTitle:{type:"string",group:"Data",defaultValue:null},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:"sap-icon://folder"}},associations:{navigationMenu:{type:"sap.ushell.ui.shell.ShellNavigationMenu"},allMyApps:{type:"sap.ui.core.mvc.View"}},events:{textChanged:{deprecated:true}}},renderer:{apiVersion:2,render:function(e,t){var o=t._getControlVisibilityAndState();var l=t.getText();e.openStart("div",t);e.class("sapUshellHeadTitle");if(o||d.system.phone){e.class("sapUshellAppTitleClickable")}e.openEnd();e.openStart("h1");e.class("sapUiPseudoInvisibleText");e.attr("aria-level","1");e.openEnd();e.text(l||"");e.close("h1");e.openStart("div",t.getId()+"-button");e.class("sapUshellAppTitle");if(o||d.system.phone){e.attr("tabindex","0")}if(t.getTooltip_AsString()){e.attr("title",t.getTooltip_AsString())}if(o){e.attr("role","button");e.attr("aria-haspopup","dialog");e.attr("aria-label",l)}e.openEnd();if(d.media.getCurrentRange(d.media.RANGESETS.SAP_STANDARD).name!=="Phone"){e.openStart("span");e.class("sapUshellAppTitleText");e.openEnd();e.text(l||"");e.close("span")}if(o&&l){e.openStart("span");e.class("sapUshellShellHeadAction");e.openEnd();e.renderControl(t.oIcon);e.close("span")}e.close("div");e.close("div")}}});_.prototype.init=function(){t.prototype.init.apply(this,arguments);this.oIcon=c.createControlByURI(c.getIconURI("slim-arrow-down"));this.oIcon.addStyleClass("sapUshellAppTitleMenuIcon");if(d.system.desktop){this.addEventDelegate({onkeydown:function(e){if(e.altKey&&e.keyCode===40){this.onclick(e)}}.bind(this)})}};_.prototype.getFocusDomRef=function(){return this.getDomRef("button")};_._getCurrentState=function(){return P.getConfigModel().getProperty("/shellAppTitleState")};_._setCurrentState=function(e){P.getConfigModel().setProperty("/shellAppTitleState",e)};_.prototype.onclick=function(e){e.preventDefault();this.firePress();if(!this._getControlVisibilityAndState()){if(d.system.phone){window.hasher.setHash(y.last("/core/shellHeader/rootIntent"))}return}if(_._getCurrentState()===S.AllMyAppsOnly){v.start("FLP:ShellAppTitle.onClick","Click ShellAppTitle in HOME state, Launching AllMyApps","FLP");this._openCloseAllMyAppsPopover();return}this._openCloseNavMenuPopover()};_.prototype._openCloseAllMyAppsPopover=function(){if(!this.oAllMyAppsPopover){this.oAllMyAppsPopover=this._createAllMyAppsPopover()}if(this.oAllMyAppsPopover){if(this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}else{this.oAllMyAppsPopover.openBy(this)}}};_.prototype._openCloseNavMenuPopover=function(){if(!this.oNavMenuPopover){this.oNavMenuPopover=this._createNavMenuPopover()}_._setCurrentState(S.ShellNavMenu);if(this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}else{this.oNavMenuPopover.openBy(this)}if(this.oNavMenuPopover.getFooter()){const e=M.getShellMode()===m.Default;const t=M.isLegacyHome();this.oNavMenuPopover.getFooter().setVisible(e||t)}};_.prototype._getControlVisibilityAndState=function(){v.start("FLP:ShellAppTitle.getControlVisibilityAndState","Check AllMyApps and NavShellMenu visibility","FLP");const e=M.getShellMode()===m.Default;const t=M.isLegacyHome();var o=this._isNavMenuEnabled();var l=o;if(e||t){var s=y.last("/core/services/allMyApps/enabled");l=s||o;if(s&&o){_._setCurrentState(S.ShellNavMenu)}else if(!s&&o){_._setCurrentState(S.ShellNavMenuOnly)}else if(s&&!o){_._setCurrentState(S.AllMyAppsOnly)}}else{_._setCurrentState(S.ShellNavMenuOnly)}v.end("FLP:ShellAppTitle.getControlVisibilityAndState");return l};_.prototype._createAllMyAppsPopover=function(){var e=u.getElementById(this.getAllMyApps());if(!e){return null}var t=new p("sapUshellAllMyAppsPopover",{placement:T.Bottom,title:"",showArrow:true,customHeader:this._getPopoverHeader(),verticalScrolling:false,showHeader:{path:"configModel>/shellAppTitleState",formatter:function(e){return e!==S.ShellNavMenu}},content:[e],contentHeight:"28rem",contentWidth:"56rem"}).addStyleClass("sapContrastPlus");t.setModel(P.getConfigModel(),"configModel");t.attachAfterOpen(function(){var e=t.getCustomHeader();var o=e.getContentLeft()[0];var l=e.getContentLeft()[1];if(l.getVisible()){l.firePress();l.setPressed(true)}o.focus()});t.attachAfterClose(this._afterCloseAllMyAppsPopover.bind(this));return t};_.prototype._afterCloseAllMyAppsPopover=function(){this._bPressedSpace=false;if(this._bOpenNavigationMenu===true){this._bOpenNavigationMenu=false;this.oNavMenuPopover.openBy(this)}else if(!d.system.phone){this.focus()}};_.prototype._createNavMenuPopover=function(){var e=u.getElementById(this.getNavigationMenu());this.oTitle=new a("navMenuInnerTitle",{wrapping:true,text:"{shellModel>/application/title}"});this.oSecondTitle=new o("navMenuInnerSecondTitle",{text:"{shellModel>/header/secondTitle}",visible:"{= !!${shellModel>/header/secondTitle}}",wrapping:true});this.oIconControl=new h({src:"{shellModel>/application/icon}"});const t=new s({items:[this.oTitle,this.oSecondTitle]}).addStyleClass("sapUshellNavTitleBox");const n=new s({items:[this.oIconControl]}).addStyleClass("sapUiContentPadding");const p=new l("navMenuTitleBar",{width:"100%",items:[n,t]});var r=new i("sapUshellAppTitlePopover",{placement:T.Bottom,showArrow:true,showHeader:false,contentWidth:"20rem",horizontalScrolling:false,content:[p,e]}).addStyleClass("sapContrastPlus");if(y.last("/core/services/allMyApps/enabled")){r.setFooter(this._getPopoverFooterContent())}r.addStyleClass("sapUshellAppTitleNavigationMenuPopover");r.setModel(P.getModel(),"shellModel");P.getConfigModel().setProperty("/allMyAppsMasterLevel",C.FirstLevel);r.attachBeforeOpen(function(){e._beforeOpen()});r.attachAfterOpen(function(){e.$().on("touchmove.scrollFix",function(e){e.stopPropagation()});e._afterOpen()});r.attachAfterClose(this._afterCloseNavigationMenuPopover.bind(this));return r};_.prototype._afterCloseNavigationMenuPopover=function(){this._bPressedSpace=false;if(this._bOpenAllMyApps){this._bOpenAllMyApps=false;this._openCloseAllMyAppsPopover()}else if(!d.system.phone){this.focus()}};_.prototype._setAllMyAppsTitle=function(e){const t=_._getCurrentState();const o=P.getModel().getProperty("/header/secondTitle");if(o&&(t==="AllMyAppsOnly"||t==="AllMyApps")){e=`${e} - ${o}`}a.prototype.setText.apply(this,[e])};_.prototype._getPopoverHeader=function(){var t=new a({text:g.i18n.getText("allMyApps_headerTitle"),level:"H1"});t.setText=this._setAllMyAppsTitle.bind(t);var o=new e("sapUshellShellAppPopoverHeader",{contentLeft:[this._createPopoverBackButton(),this._createPopoverToggleButton()],contentMiddle:[t]});return o};_.prototype.onAfterRendering=function(){var e=u.getElementById("shell-header");if(e){e.refreshLayout()}};_.prototype._createPopoverBackButton=function(){var e=new t("sapUshellAppTitleBackButton",{icon:c.getIconURI("nav-back"),press:[this._popoverBackButtonPressHandler,this],tooltip:g.i18n.getText("backBtn_tooltip"),visible:this.getAllMyAppsController().getBackButtonVisible()});e.addStyleClass("sapUshellCatalogNewGroupBackButton");return e};_.prototype._popoverBackButtonPressHandler=function(){var e=this.getAllMyAppsController();var t=e.getCurrentState();if(t===C.FirstLevel||t===C.FirstLevelSpread){if(_._getCurrentState()!==S.AllMyAppsOnly){_._setCurrentState(S.ShellNavMenu);this.oAllMyAppsPopover.close();this._bOpenNavigationMenu=true}}else if(t===C.SecondLevel){e.switchToInitialState()}else{e.handleSwitchToMasterAreaOnPhone()}e.updateHeaderButtonsState()};_.prototype._createPopoverToggleButton=function(){var e=this.getAllMyAppsController();var t=new r("sapUshellAllMyAppsToggleListButton",{icon:c.getIconURI("sap-icon://menu2"),press:function(t){e.switchToInitialState();this.setTooltip(t.getParameter("pressed")?g.i18n.getText("ToggleButtonHide"):g.i18n.getText("ToggleButtonShow"))},tooltip:g.i18n.getText("ToggleButtonShow"),visible:e.getToggleListButtonVisible()});d.media.attachHandler(function(){t.setVisible(e.getToggleListButtonVisible())},this,d.media.RANGESETS.SAP_STANDARD);t.addStyleClass("sapUshellAllMyAppsToggleListButton");return t};_.prototype._getPopoverFooterContent=function(){var o=new t("allMyAppsButton",{text:g.i18n.getText("allMyApps_launchingButtonTitle"),press:this._allMyAppsButtonPressHandler.bind(this),visible:{path:"shellConfig>/shellAppTitleState",formatter:function(e){return e===S.ShellNavMenu}}});var l=new e("shellpopoverFooter",{contentMiddle:[o]});this.addCustomData(o,"role","button");this.addCustomData(o,"aria-label",g.i18n.getText("allMyApps_launchingButtonTitle"));return l};_.prototype._allMyAppsButtonPressHandler=function(){if(u.getElementById(this.getAllMyApps())){v.start("FLP:ShellNavMenu.footerClick","Click the footer of ShellNavMenu, Launching AllMyApps","FLP");_._setCurrentState(S.AllMyApps);this.oNavMenuPopover.close();this._bOpenAllMyApps=true}};_.prototype._isNavMenuEnabled=function(){var e=u.getElementById(this.getNavigationMenu());return e?e.getItems()&&e.getItems().length>0:false};_.prototype.addCustomData=function(e,t,o){e.addCustomData(new f({key:t,value:o,writeToDom:true}))};_.prototype.close=function(){if(this.oNavMenuPopover&&this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}if(this.oAllMyAppsPopover&&this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}};_.prototype.setTooltip=function(e){this.setAggregation("tooltip",e);this.oIcon.setTooltip(e)};_.prototype.getAllMyAppsController=function(){var e=u.getElementById(this.getAllMyApps());return e.getController()};_.prototype.onkeyup=function(e){if(e.keyCode===32){this.onclick(e)}};_.prototype.onsapenter=_.prototype.onclick;_.prototype.exit=function(){var e=u.getElementById(this.getNavigationMenu());var t=u.getElementById(this.getAllMyApps());if(e){e.destroy()}if(t){t.destroy()}if(this.oAllMyAppsPopover){this.oAllMyAppsPopover.destroy()}if(this.oNavMenuPopover){this.oNavMenuPopover.destroy()}if(this.oIcon){this.oIcon.destroy()}};return _});
//# sourceMappingURL=ShellAppTitle.js.map