// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Label","sap/m/Text","sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/core/Title","sap/ui/model/json/JSONModel","sap/ushell/services/AppConfiguration","sap/ushell/Config","sap/ushell/resources","sap/base/Log","sap/base/util/isEmptyObject","sap/ui/Device","sap/ushell/Container"],function(e,t,o,a,i,n,r,s,p,u,l,c,m){"use strict";return o.extend("sap.ushell.ui.footerbar.AboutDialog.controller",{onBeforeOpen:function(){this._setupAboutDialogModel();this._updateHeaderButtonVisibility();var e=a.byId("aboutDialogFragment","aboutDialogEntryList");e.setSelectedItem(e.getItems()[0])},onClose:function(){this._getDialog().close()},onAfterClose:function(){this._getDialog().destroy()},_getDialog:function(){if(!this.oAboutDialog){this.oAboutDialog=a.byId("aboutDialogFragment","aboutDialog")}return this.oAboutDialog},_setupAboutDialogModel:function(){var e=this._getDialog();this._setupAppInfoModel().catch(function(e){u.error("Failed to setup application info model.",e)});var t=this._getSystemInformation();var o=new n(t);var a=this._getUserEnvironmentInformation();var i=new n(a);e.setModel(o,"SysInfo");e.setModel(i,"UserEnvInfo")},_getSplitAppObj:function(){var e=a.byId("aboutDialogFragment","aboutDialogContainer");if(!e){u.info("SplitContainer object can't be found")}return e},onAfterMasterClose:function(){this._getSplitAppObj().setMode("ShowHideMode");this._updateHeaderButtonVisibility()},onItemPress:function(e){var t=e.getParameter("listItem").getCustomData()[0].getValue();var o=a.createId("aboutDialogFragment",t);this._getSplitAppObj().toDetail(o);if(c.system.desktop){this._getSplitAppObj().hideMaster()}if(c.system.phone){this._getSplitAppObj().setMode("HideMode");this.onAfterMasterClose();this._updateHeaderButtonVisibility()}},navigateBackToMaster:function(){this._getSplitAppObj().backToTopMaster();this._updateHeaderButtonVisibility()},onBeforeMasterOpen:function(){this._updateHeaderButtonVisibility()},navToggleButtonPressHandler:function(){if(this._getSplitAppObj().isMasterShown()){this._getSplitAppObj().hideMaster()}else{this._getSplitAppObj().showMaster()}this._updateHeaderButtonVisibility()},_updateHeaderButtonVisibility:function(){var e=this._getSplitAppObj().isMasterShown();var t=a.byId("aboutDialogFragment","aboutDialogNavBackButton");var o=a.byId("aboutDialogFragment","aboutDialogMenuButton");if(c.system.phone){t.setVisible(!e);if(!t){u.info("oBackButton object can't be found")}}else{if(c.orientation.portrait){o.setVisible(true);o.setPressed(e);o.setTooltip(p.i18n.getText(e?"ToggleButtonHide":"ToggleButtonShow"))}else{o.setVisible(false)}if(!o){u.info("oMenuButton object can't be found")}}},_setupAppInfoModel:function(){var e=this._getDialog();return new Promise(function(t,o){m.getServiceAsync("AppLifeCycle").then(function(e){var t=e.getCurrentApplication();return Promise.all([t.getAllAppInfo(true),t.getAllAppInfo(false),this._getContentProviderLabel(t)])}.bind(this)).then(function(o){const a=r.getMetadata();const i=o[0]||{};const s=o[1]||{};const p=o[2];i.appTitle=i.title||i.appTitle||a.title||"";i.contentProviderLabel=p;const u=this._buildApplicationInformationObject(i,s);e.setModel(new n(u),"AppInfo");t()}.bind(this)).catch(function(e){o(e)})}.bind(this))},_buildApplicationInformationObject:function(e,t){const o=["appTitle","appId","appVersion","appSupportInfo","technicalAppComponentId","appFrameworkId","appFrameworkVersion","contentProviderLabel"];var a={entries:[],customEntries:[]};o.forEach(t=>{if(e[t]){a.entries.push({parameterName:t,value:`{i18n>${t}}`,type:"label"});a.entries.push({parameterName:t,value:e[t],type:"text"})}});const i=Object.keys(t).filter(e=>{const o=t[e];return o.showInAbout}).sort((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:1).map(e=>{const o=t[e];return{parameterName:e,...o}});i.forEach(e=>{a.customEntries.push({parameterName:e.parameterName,value:e.label,type:"label"});a.customEntries.push({parameterName:e.parameterName,value:e.value,type:"text"})});return a},_getSystemInformation:function(){const e=m.getLogonSystem();const t={entries:[]};const o=e.getProductName();if(o){t.entries.push({parameterName:"productName",value:"{i18n>productName}",type:"label"});t.entries.push({parameterName:"productName",value:o,type:"text"})}const a=e.getProductVersion();if(a){t.entries.push({parameterName:"productVersion",value:"{i18n>productVersionFld}",type:"label"});t.entries.push({parameterName:"productVersion",value:a,type:"text"})}const i=e.getSystemName();if(i){t.entries.push({parameterName:"systemName",value:"{i18n>systemName}",type:"label"});t.entries.push({parameterName:"systemName",value:i,type:"text"})}const n=e.getSystemRole();if(n){t.entries.push({parameterName:"systemRole",value:"{i18n>systemRole}",type:"label"});t.entries.push({parameterName:"systemRole",value:n,type:"text"})}const r=e.getTenantRole();if(r){t.entries.push({parameterName:"tenantRole",value:"{i18n>tenantRole}",type:"label"});t.entries.push({parameterName:"tenantRole",value:r,type:"text"})}return t},_getUserEnvironmentInformation:function(){const e=m.getUser();const t={entries:[]};const o=this._getDeviceType();if(o){t.entries.push({parameterName:"deviceType",value:"{i18n>deviceType}",type:"label"});t.entries.push({parameterName:"deviceType",value:o,type:"text"})}const a=e.getTheme();t.entries.push({parameterName:"activeTheme",value:"{i18n>activeTheme}",type:"label"});t.entries.push({parameterName:"activeTheme",value:a,type:"text"});const i=e.getContentDensity()==="cozy";t.entries.push({parameterName:"optimizedForTouch",value:"{i18n>AppearanceContentDensityLabel}",type:"label"});t.entries.push({parameterName:"optimizedForTouch",value:i?"{i18n>yes}":"{i18n>no}",type:"text"});const n=this._isTouchSupported();t.entries.push({parameterName:"touchSupported",value:"{i18n>touchSupported}",type:"label"});t.entries.push({parameterName:"touchSupported",value:n?"{i18n>yes}":"{i18n>no}",type:"text"});t.entries.push({parameterName:"userAgentFld",value:"{i18n>userAgentFld}",type:"label"});t.entries.push({parameterName:"userAgentFld",value:navigator.userAgent,type:"text"});return t},_getContentProviderLabel:function(e){if(s.last("/core/contentProviders/providerInfo/enabled")){return e.getSystemContext().then(function(e){return e.label})}return Promise.resolve(undefined)},_getDeviceType:function(){var e;if(c.system.combi){e="{i18n>configuration.form_factor_combi}"}else if(c.system.desktop){e="{i18n>configuration.form_factor_desktop}"}else if(c.system.tablet){e="{i18n>configuration.form_factor_tablet}"}else if(c.system.phone){e="{i18n>configuration.form_factor_phone}"}return e},_isTouchSupported:function(){return c.support.touch&&(c.system.tablet||c.system.phone||c.system.combi)},itemFactory:function(o,a){const n=a.getProperty("type");switch(n){case"label":return new e({text:a.getProperty("value")});case"title":return new i({text:a.getProperty("value")});default:return new t({text:a.getProperty("value")})}},calculateNumberOfColumns:function(e){if(!this.isFormVisible(e)){return 1}return Object.keys(e).length>1?2:1},isFormVisible:function(e){return!!e&&!l(e)}})});
//# sourceMappingURL=AboutDialog.controller.js.map