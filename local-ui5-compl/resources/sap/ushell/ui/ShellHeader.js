// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/i18n/Localization","sap/ui/core/Control","sap/ui/core/Element","sap/ui/core/theming/Parameters","sap/ui/Device","sap/ui/dom/units/Rem","sap/base/Log","sap/ushell/api/NewExperience","sap/ushell/EventHub","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/ShellHeaderRenderer","sap/ushell/utils","sap/ushell/utils/WindowUtils","sap/ushell/state/StateManager","sap/ushell/Container"],function(e,t,i,o,a,r,n,s,l,h,u,g,p,d,f,c,m){"use strict";const y=c.ShellMode;var v="sapUshellShellShowSearchOverlay";var S=0;var L;var C;var T=sap.ui.require.toUrl("sap/ushell/themes/base/img/SAPLogo.svg");var R=t.extend("sap.ushell.ui.ShellHeader",{metadata:{library:"sap.ushell",properties:{logo:{type:"sap.ui.core.URI",defaultValue:""},showLogo:{type:"boolean",defaultValue:true},homeUri:{type:"sap.ui.core.URI",defaultValue:"#"},searchState:{type:"string",defaultValue:"COL"},ariaLabel:{type:"string"},centralAreaElement:{type:"string",defaultValue:null},showNewExperienceSwitch:{type:"boolean",defaultValue:false},title:{type:"string",defaultValue:""}},aggregations:{headItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},headEndItems:{type:"sap.ui.core.Control",multiple:true},search:{type:"sap.ui.core.Control",multiple:false},appTitle:{type:"sap.ushell.ui.shell.ShellAppTitle",multiple:false}},associations:{},events:{searchSizeChanged:{}}},renderer:p});R.prototype.setHomeUri=function(e){if(f.hasInvalidProtocol(e)){n.fatal("Tried to set a URL with an invalid protocol as the home uri. Setting to an empty string instead.",null,"sap/ushell/ui/ShellHeader");e=""}this._bHomeIsRoot=d.isRootIntent(e);return this.setProperty("homeUri",e)};R.prototype.SearchState={COL:"COL",EXP:"EXP",EXP_S:"EXP_S"};R.prototype.FLPRangeSet={name:"Ushell",rangeBorders:[600,1024,1440,1920],rangeNames:["Phone","Tablet","Desktop","LargeDesktop","ExtraLargeDesktop"]};R.prototype.init=function(){a.media.initRangeSet(this.FLPRangeSet.name,this.FLPRangeSet.rangeBorders,"px",this.FLPRangeSet.rangeNames);a.media.attachHandler(this.invalidate,this,this.FLPRangeSet.name);a.resize.attachHandler(this.refreshLayout,this);this.getCustomLogoAltText();l.once("ShellNavigationInitialized").do(function(){m.getServiceAsync("ShellNavigationInternal").then(function(e){this._rerenderLogoNavigationFilterBound=this._rerenderLogoNavigationFilter.bind(this,e);e.registerNavigationFilter(this._rerenderLogoNavigationFilterBound);this._rerenderLogoNavigationFilterBound.detach=function(){e.unregisterNavigationFilter(this._rerenderLogoNavigationFilterBound)}}.bind(this))}.bind(this))};R.prototype.exit=function(){a.media.detachHandler(this.invalidate,this,this.FLPRangeSet.name);a.resize.detachHandler(this.refreshLayout,this);if(this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter){this._rerenderLogoNavigationFilterfnRerenderLogoNavigationFilter.detach()}};R.prototype.setFocusOnShellHeader=function(e){if(e){var t=this.getHeadEndItems();if(t.length>0){t[t.length-1].focus()}else{this.getAppTitle().focus()}}else{var i=this.getHeadItems();if(i.length>0){i[0].focus()}else{this.getAppTitle().focus()}}};R.prototype.onsapspace=function(e){if(e.target===this.getDomRef("logo")){this._setLocationHref(e.target.href)}};R.prototype._setLocationHref=function(e){if(f.hasInvalidProtocol(e)){n.fatal("Tried to navigate to URL with an invalid protocol. Preventing navigation.",null,"sap/ushell/ui/ShellHeader");return}window.location.href=e};R.prototype.onAfterRendering=function(){var e=this.getDomRef();if(!L&&document.body.getBoundingClientRect().height===0){e.style.visibility="hidden";e.style.height="2.75rem";return}this.refreshLayout()};R.prototype.onThemeChanged=function(e){var t=false;if(L!==e.theme){L=e.theme;t=true}if(C!==this.getLogo()){C=this.getLogo();t=true}if(t){this.invalidate()}};R.prototype.getLogo=function(){var e=this.getCustomCompanyLogoUrl();if(e!==""){return e}if(this.getProperty("logo")!==""){return this.getProperty("logo")}var t=o.get({name:"sapUiGlobalLogo",callback:()=>{this.invalidate()}});if(t==="none"){return T}if(t){var i=/url[\s]*\('?"?([^'")]*)'?"?\)/.exec(t);if(i){return i[1]}}return undefined};R.prototype.getCustomCompanyLogoUrl=function(){return h.last("/core/companyLogo/url")};R.prototype.getCustomLogoAltText=function(){var t=h.last("/core/companyLogo/accessibleText");var i;delete this._sCustomAltText;if(t){try{var o=JSON.parse(t);if(o){i=e.getLanguage();this._sCustomAltText=o[i];if(!this._sCustomAltText){Object.keys(o).forEach(function(e){if(e.indexOf(i)===0){this._sCustomAltText=o[e]}}.bind(this))}if(!this._sCustomAltText){Object.keys(o).forEach(function(e){if(i.indexOf(e)===0){this._sCustomAltText=o[e]}}.bind(this))}if(!this._sCustomAltText){this._sCustomAltText=o.default}}}catch(e){n.warning("Custom logo image ALT text is not a JSON string.",t);this._sCustomAltText=t}}};R.prototype.getLogoAltText=function(e){if(!e){return""}if(e===T){return g.i18n.getText("sapLogoText")}return this._sCustomAltText||g.i18n.getText("SHELL_LOGO_TOOLTIP")};R.prototype.refreshLayout=function(){if(!this.getDomRef()){return}this._adjustAppTitleTooltip();if(this.getSearchVisible()){var e=this.getDomRef("hdr-search");e.style.display="none";this._hideElementsForSearch();e.style.display="";e.style["max-width"]=S+"rem";this.fireSearchSizeChanged({remSize:r.fromPx(e.getBoundingClientRect().width),isFullWidth:this.isPhoneState()||this.getDomRef("hdr-end").style.display==="none"})}};R.prototype._adjustAppTitleTooltip=function(){var e=i.getElementById("shellAppTitle");if(e){var t=e.getDomRef("button");var o=t&&t.firstChild;if(o){var a;var r=h.last("/core/services/allMyApps/enabled");const t=c.getShellMode()===y.Default;const p=c.isLegacyHome();var n=(t||p)&&r;var s=i.getElementById(e.getNavigationMenu());var l=s&&s.getItems()&&s.getItems().length>0;if(l){a=g.i18n.getText("shellNavMenu_openMenuTooltip_navigationMenu")}else if(n){a=g.i18n.getText("shellNavMenu_openMenuTooltip_allMyApps")}else{var u=o.offsetWidth<o.scrollWidth;a=u?e.getText():null}if(e.getTooltip()!==a){e.setTooltip(a)}}}};R.prototype.removeHeadItem=function(e){if(typeof e==="number"){e=this.getHeadItems()[e]}this.removeAggregation("headItems",e)};R.prototype.isExtraLargeState=function(){return a.media.getCurrentRange(this.FLPRangeSet.name).from===this.FLPRangeSet.rangeBorders[3]};R.prototype.isMediumOrBiggerState=function(){return a.media.getCurrentRange(this.FLPRangeSet.name).from>=this.FLPRangeSet.rangeBorders[0]};R.prototype.isPhoneState=function(){var e=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;var t=this.getDomRef().getBoundingClientRect().width>S;return a.system.phone||e==="Phone"||!t};R.prototype.setSearchState=function(e,t,i){if(this.SearchState[e]&&this.getSearchState()!==e){if(typeof t==="boolean"){i=t;t=undefined}this.setProperty("searchState",e,false);var o=e!=="COL";document.body.classList.toggle(v,o&&i);S=o?t||35:0}};R.prototype._hideElementsForSearch=function(){if(this.isExtraLargeState()){return}var e,t=this.getDomRef("hdr-search-container"),i=this.getDomRef("hdr-begin"),o=this.getDomRef("hdr-center"),a=this.getDomRef("hdr-end");if(this.getSearchState()==="EXP"||this.isPhoneState()){e=r.toPx(S+3)}else{e=r.toPx(9+.5)}var n=[i];Array.prototype.forEach.call(i.childNodes,function(e){n.unshift(e)});if(o){n.unshift(o)}i.style.flexBasis="";a.style.display="";n.forEach(function(e){if(e.getAttribute("id")==="shellAppTitle"){e.classList.remove("sapUiPseudoInvisibleText")}else{e.style.display=""}});var s;for(var l=0;l<n.length;l++){s=n[l];if(e>t.getBoundingClientRect().width){if(s.getAttribute("id")==="shellAppTitle"){s.classList.add("sapUiPseudoInvisibleText")}else{s.style.display="none";if(o&&l===0){i.style.flexBasis="auto"}}}else{return}}if(r.toPx(S)>t.getBoundingClientRect().width){a.style.display="none"}};R.prototype.getSearchWidth=function(){return S};R.prototype.isHomepage=function(){var e=window.hasher&&"#"+window.hasher.getHash()||"";var t=new RegExp("[?]"+"(?:"+"(?!&[/])."+")*");var i=e.replace(t,"");return d.isRootIntent(i)||i==="#Launchpad-openFLPPage"};R.prototype._rerenderLogoNavigationFilter=function(e,t,i){var o=e.hashChanger.isInnerAppNavigation(t,i);if(o){this.invalidate()}return e.NavigationFilterStatus.Continue};R.prototype.getSearchVisible=function(){return this.getSearchState()!==this.SearchState.COL};R.prototype.getCentralControl=function(){return i.getElementById(this.getCentralAreaElement())};R.prototype.setNoLogo=function(){this.setLogo(undefined)};R.prototype._getLeanMode=function(){return c.getShellMode()===y.Lean};R.prototype.getNewExperienceSwitchControl=function(){if(!s.isActive()){return}if(this.getShowNewExperienceSwitch()){return s.getShellHeaderControl()}};return R});
//# sourceMappingURL=ShellHeader.js.map