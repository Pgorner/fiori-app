// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Lib","sap/ushell/Config","sap/ushell/utils","sap/ushell/services/Ui5ComponentHandle","sap/ushell/services/Ui5ComponentLoader/utils","sap/ushell/EventHub","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI"],function(e,o,t,n,r,s,a,jQuery,i){"use strict";function p(p,l,c,u){this._oServiceConfig=u&&u.config||{};this._oAdapter=p;this._logStackTrace=function(e,o){var t=JSON.stringify(e,null,4);s.logInstantiateComponentError(e.name,o+"",o.status,o.stack,t);return Promise.reject(o)};this.modifyComponentProperties=function(e,o){if(!this._oAdapter.modifyComponentProperties){return Promise.resolve(e)}return this._oAdapter.modifyComponentProperties(e.componentProperties,o).then(function(o){e.componentProperties=o;return e})};this.createComponent=function(e,o,t,n){var r=new jQuery.Deferred;var s=this;this.createComponentData(e,o,t).then(function(e){return s.modifyComponentProperties(e,n)}).then(function(e){s.instantiateComponent(e).then(r.resolve,r.reject)},function(){r.resolve(e)});return r.promise()};this.createComponentData=function(r,a,p){var l=this;return new Promise(function(c,u){var m={};var d=r||{};var f=s.shouldLoadCoreExt(d);var C=t.last("/core/customPreload/enabled");var h=f&&C;var v=s.shouldLoadDefaultDependencies(d,l._oServiceConfig);var P=n.getParameterValueBoolean("sap-ushell-nocb");var g=d.applicationDependencies||{};var y=s.constructAppComponentId(a||{});var R=t.last("/core/customPreload/coreResourcesComplement");var D;var I;s.logAnyApplicationDependenciesMessages(g.name,g.messages);if(!d.ui5ComponentName){u();return}delete d.loadCoreExt;delete d.loadDefaultDependencies;D=s.createComponentData(d.componentData||{},d.url,d.applicationConfiguration,d.reservedParameters);if(d.getExtensions){D.getExtensions=d.getExtensions;delete d.getExtensions}if(d.oPostMessageInterface){D.oPostMessageInterface=d.oPostMessageInterface;delete d.oPostMessageInterface}I=s.createComponentProperties(h,v,P,p,d.applicationDependencies||{},d.ui5ComponentName,d.url,y,R);m.componentData=D;m.componentProperties=I;m.appPropertiesSafe=d;m.loadCoreExt=f;if(typeof I.manifest==="string"&&I.manifest.length>0&&"sap.ui.fl"in o.all()){sap.ui.require(["sap/ui/fl/apply/api/FlexRuntimeInfoAPI"],o=>{try{const e=o.getFlexVersion({reference:m.appPropertiesSafe.ui5ComponentName});if(typeof e==="string"&&e.length>0){const o=new i(I.manifest);o.addQuery("version",e);I.manifest=o.toString()}c(m)}catch(o){e.error("Error when trying to get manifest version from 'sap.ui.fl.apply.api.FlexRuntimeInfoAPI'",o,"sap.ushell.services.Ui5ComponentLoader");c(m)}},o=>{e.error("Error when trying to load 'sap/ui/fl/apply/api/FlexRuntimeInfoAPI'",o,"sap.ushell.services.Ui5ComponentLoader");c(m)});return}c(m)})};this.instantiateComponent=function(e){var o=e.componentProperties;var t=e.componentData;var n=e.appPropertiesSafe;var i=e.loadCoreExt;r.onBeforeApplicationInstanceCreated.call(null,o);var p=new jQuery.Deferred;s.createUi5Component(o,t).then(function(e){var o=new r(e);n.componentHandle=o;var t=i;if(t){n.coreResourcesFullyLoaded=t;a.emit("CoreResourcesComplementLoaded",{status:"success"})}p.resolve(n)}).fail(this._logStackTrace.bind(this,o)).catch(p.reject);return p.promise()};this.getCoreResourcesComplementBundle=function(){return t.last("/core/customPreload/enabled")?t.last("/core/customPreload/coreResourcesComplement"):[]};this.loadCoreResourcesComplement=function(){if(!this.loadCoreResourcesComplementPromise){this.loadCoreResourcesComplementPromise=new Promise(function(e,o){s.loadBundle(this.getCoreResourcesComplementBundle()).then(function(){a.emit("CoreResourcesComplementLoaded",{status:"success"});e()}).catch(function(){a.emit("CoreResourcesComplementLoaded",{status:"failed"});o()})}.bind(this));this.loadCoreResourcesComplementPromise.finally(function(){this.loadCoreResourcesComplementPromise=undefined}.bind(this))}return this.loadCoreResourcesComplementPromise};a.once("loadCoreResourcesComplement").do(function(){this.loadCoreResourcesComplement()}.bind(this))}p.hasNoAdapter=false;return p});
//# sourceMappingURL=Ui5ComponentLoader.js.map