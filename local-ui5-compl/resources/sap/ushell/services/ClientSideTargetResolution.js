// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/extend","sap/ushell/ApplicationType","sap/ushell/navigationMode","sap/ushell/services/ClientSideTargetResolution/Formatter","sap/ushell/services/ClientSideTargetResolution/InboundIndex","sap/ushell/services/ClientSideTargetResolution/InboundProvider","sap/ushell/services/ClientSideTargetResolution/ParameterMapping","sap/ushell/services/ClientSideTargetResolution/PrelaunchOperations","sap/ushell/services/ClientSideTargetResolution/Search","sap/ushell/services/ClientSideTargetResolution/StagedLogger","sap/ushell/services/ClientSideTargetResolution/SystemContext","sap/ushell/services/ClientSideTargetResolution/Utils","sap/ushell/services/ClientSideTargetResolution/VirtualInbounds","sap/ushell/services/ClientSideTargetResolution/XAppStateProcessing","sap/ushell/TechnicalParameters","sap/ushell/utils","sap/ushell/utils/UrlParsing","sap/ushell/Container"],function(e,t,n,a,r,s,i,o,l,u,c,d,f,p,g,h,m,v,b,y,S){"use strict";function w(e,t,n,a){this._init.apply(this,arguments)}w.prototype._init=function(t,n,a,r){this._iLogId=0;if(!this._implementsServiceInterface(t)){e.error("Cannot get Inbounds","ClientSideTargetResolutionAdapter should implement getInbounds method","sap.ushell.services.ClientSideTargetResolution");return}this._oInboundProvider=new l(t.getInbounds.bind(t));this._oHaveEasyAccessSystemsDeferreds={userMenu:null,sapMenu:null};this._oServiceConfiguration=r;this._oAdapter=t};w.prototype._implementsServiceInterface=function(e){if(typeof e.getInbounds==="function"){return true}return false};w.prototype._extractInboundFilter=function(e){if(!this._oAdapter.hasSegmentedAccess){return undefined}if(typeof e!=="string"){return undefined}var t=e.indexOf("#")===0?e:"#"+e;var n=y.parseShellHash(t);if(!n||!n.semanticObject||!n.action){return undefined}return[{semanticObject:n.semanticObject,action:n.action}]};w.prototype.resolveHashFragment=async function(e){var t=this._extractInboundFilter(e);const n=await this._oInboundProvider.getInbounds(t);const a=await this._resolveHashFragment(e,n);return a};w.prototype._resolveHashFragmentWithFallback=async function(t,n,a){if(typeof this._oAdapter.resolveHashFragmentFallback!=="function"){e.error("Cannot resolve hash fragment",t+" has matched an inbound that cannot be resolved client side and no resolveHashFragmentFallback method was implemented in ClientSideTargetResolutionAdapter","sap.ushell.services.ClientSideTargetResolution");throw new Error("No fallback provided")}const r=await b.promisify(this._oAdapter.resolveHashFragmentFallback(t,n,a));return r};w.prototype.resolveTileIntent=async function(e){var t=this._extractInboundFilter(e);const n=await this._oInboundProvider.getInbounds(t);const a=await this._resolveTileIntent(e,n);return a};w.prototype.resolveTileIntentInContext=async function(e,t){var n=o.createIndex(e.concat(h.getInbounds()));const a=await this._resolveTileIntent(t,n);return a};w.prototype._resolveHashFragment=async function(t,n){var a=t.indexOf("#")===0?t:"#"+t;var r=y.parseShellHash(a);if(r===undefined){e.error("Could not parse shell hash '"+t+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");throw new Error(`Could not parse shell hash '${t}'please specify a valid shell hash`)}r.formFactor=b.getFormFactor();let s=await this._getMatchingInbounds(r,n,{bExcludeTileInbounds:true});if(s.length===0){e.warning("Could not resolve "+t,"rejecting promise","sap.ushell.services.ClientSideTargetResolution");throw new Error(`Could not resolve ${t}`)}s=this._applySapNavigationScopeFilter(s,r);const i=s[0];if(e.getLevel()>=e.Level.DEBUG){var o=function(e,t){return this[e]===undefined?"<undefined>":t};var l=function(e,t){return e==="_original"?undefined:o.call(this,e,t)};var u=JSON.stringify(i,l,"   ");e.debug("The following target will now be resolved",u,"sap.ushell.services.ClientSideTargetResolution")}return this._resolveSingleMatchingTarget(i,a)};w.prototype._applySapNavigationScopeFilter=function(e,t){var a=t&&t.params&&t.params["sap-navigation-scope-filter"];if(!a){return e}var r=e.filter(function(e){var t=n.get("inbound.signature.parameters",e);var r=t&&t["sap-navigation-scope"];if(r){return a[0]===r.defaultValue.value}return undefined});return r.length>0?r:e};w.prototype._resolveSingleMatchingTarget=async function(t,a){var i=y.parseShellHash(a);var o=[i.semanticObject,i.action].join("-");var l=(t.inbound.resolutionResult||{}).applicationType;var d;if(this._oAdapter.resolveSystemAlias){d=this._oAdapter.resolveSystemAlias.bind(this._oAdapter)}var f=!!t.inbound.templateContext;var p=r.getEasyAccessMenuResolver(o,l);if(p&&!f){const e=await p(i,t,d,r.WDA.enableWdaCompatibilityMode);const n=s.getNavigationMode(e,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);b.shallowMergeObject(e,n);e.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;return e}var g=this._getReservedParameters(t);u.mapParameterNamesAndRemoveObjects(t);const h=await S.getServiceAsync("AppState");t=await m.mixAppStateIntoResolutionResultAndRename(t,h);delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(function(e){return e!=="sap-tag"});var v=n.get("inbound.resolutionResult.url",t);await c.executePrelaunchOperations(t,g["sap-prelaunch-operations"]);try{let n;if(r[l]){n=r[l].generateResolutionResult}else{n=()=>this._constructFallbackResolutionResult(t,a)}const i=await n(t,v,d);const o=s.getNavigationMode(i,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);b.shallowMergeObject(i,o);i.reservedParameters=g;i.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;e.debug("Intent was resolved to the following target",JSON.stringify(i,null,3),"sap.ushell.services.ClientSideTargetResolution");b.shallowMergeObject(t.resolutionResult,i);return t.resolutionResult}catch(e){if(typeof e==="string"&&e.indexOf("fallback:")>=0){const e=await this._constructFallbackResolutionResult(t,a);b.shallowMergeObject(t.resolutionResult,e);return t.resolutionResult}throw e}};w.prototype._getReservedParameters=function(e){var t=v.getParameters({injectFrom:"startupParameter"}).map(function(e){return e.name});var n=g.extractParameters(t,e.intentParamsPlusAllDefaults);v.getParameters({injectFrom:"inboundParameter"}).forEach(function(t){var a=t.name;var r=e.inbound&&e.inbound.signature&&e.inbound.signature.parameters;if(r&&Object.keys(r).length>0){var s=r[a];var i=s&&s.defaultValue&&s.defaultValue.hasOwnProperty("value");var o=s&&s.filter&&s.filter.hasOwnProperty("value");if(s&&(o||i)){if(i){n[a]=s.defaultValue.value}else{n[a]=s.filter.value}}else{delete n[a]}delete e.intentParamsPlusAllDefaults[a];var l=e.defaultedParamNames.indexOf(a);if(l>=0){e.defaultedParamNames.splice(l,1)}}});return n};w.prototype._resolveTileIntent=async function(t,n){var a=t.indexOf("#")===0?t:"#"+t;var r=y.parseShellHash(a);if(r===undefined){e.error("Could not parse shell hash '"+t+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");throw new Error("Cannot parse shell hash")}r.formFactor=b.getFormFactor();const s=await this._getMatchingInbounds(r,n,{bExcludeTileInbounds:false});if(s.length===0){e.warning("Could not resolve "+t,"no matching targets were found","sap.ushell.services.ClientSideTargetResolution");throw new Error("No matching targets found")}const i=s[0];return this._resolveSingleMatchingTileIntent(i,a)};w.prototype._resolveSingleMatchingTileIntent=async function(t,i){var o=(t.inbound.resolutionResult||{}).applicationType;var l;if(this._oAdapter.resolveSystemAlias){l=this._oAdapter.resolveSystemAlias.bind(this._oAdapter)}u.mapParameterNamesAndRemoveObjects(t);const c=await S.getServiceAsync("AppState");t=await m.mixAppStateIntoResolutionResultAndRename(t,c);delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(function(e){return e!=="sap-tag"});var d=n.get("inbound.resolutionResult.url",t);let f;if(r[o]){f=r[o].generateResolutionResult}else{f=()=>this._constructFallbackResolutionResult(t,i)}const p=await f(t,d,l);b.shallowMergeObject(t.resolutionResult,p);var g=a({},t.inbound.tileResolutionResult);g.startupParameters=t.effectiveParameters;var h=s.getNavigationMode(p,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);b.shallowMergeObject(g,h);e.debug("Tile Intent was resolved to the following target",JSON.stringify(g,null,3),"sap.ushell.services.ClientSideTargetResolution");return g};w.prototype._constructFallbackResolutionResult=async function(t,n){var r={};Object.keys(t.intentParamsPlusAllDefaults).forEach(function(e){if(Array.isArray(t.intentParamsPlusAllDefaults[e])){r[e]=t.intentParamsPlusAllDefaults[e]}});var s=t.mappedDefaultedParamNames||t.defaultedParamNames;if(s.length>0){r["sap-ushell-defaultedParameterNames"]=[JSON.stringify(s)]}e.warning("Cannot resolve hash fragment client side",n+" has matched an inbound that cannot be resolved client side. Using fallback logic","sap.ushell.services.ClientSideTargetResolution");const i=await this._resolveHashFragmentWithFallback(n,a({},t.inbound),r);var o={};["applicationType","additionalInformation","url","applicationDependencies","text"].forEach(function(e){if(i.hasOwnProperty(e)){o[e]=i[e]}});return o};w.prototype.getDistinctSemanticObjects=async function(){var e={};const t=await this._oInboundProvider.getInbounds();t.getAllInbounds().forEach(function(t){if(typeof t.semanticObject==="string"&&t.semanticObject!=="*"&&!t.hideIntentLink&&t.semanticObject.length>0){e[t.semanticObject]=true}});return Object.keys(e).sort()};w.prototype.getLinks=async function(n){var r;if(arguments.length===1&&t(arguments[0])){var s=arguments[0];r=a({},s);["action","semanticObject"].forEach(function(e){if(s.hasOwnProperty(e)){r[e]=s[e]}});if(r.appStateKey){r.params=r.params||{};r.params["sap-xapp-state"]=[r.appStateKey];delete r.appStateKey}}else if(arguments.length<=3){e.warning("Passing positional arguments to getLinks is deprecated","Please use nominal arguments instead","sap.ushell.services.ClientSideTargetResolution");var i=arguments[0];var o=arguments[1];var l=arguments[2];r={semanticObject:i,params:o,ignoreFormFactor:l}}else{throw new Error("Invalid arguments for getLinks")}const u=await this._oInboundProvider.getInbounds();const c=await this._getLinks(r,u);return c};w.prototype._validateGetSemanticObjectLinksArgs=function(t){var n=t.semanticObject;var a=t.action;var r=!t.hasOwnProperty("action");if(typeof n!=="undefined"||r){if(typeof n!=="string"){e.error("invalid input for _getLinks","the semantic object must be a string, got "+Object.prototype.toString.call(n)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(r&&n.match(/^\s+$/)){e.error("invalid input for _getLinks","the semantic object must be a non-empty string, got '"+n+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(!r&&n.length===0){e.error("invalid input for _getLinks","the semantic object must not be an empty string, got '"+n+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}}if(typeof a!=="undefined"){if(typeof a!=="string"){e.error("invalid input for _getLinks","the action must be a string, got "+Object.prototype.toString.call(a)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action"}if(a.length===0){e.error("invalid input for _getLinks","the action must not be an empty string, got '"+a+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action"}}return undefined};w.prototype._getLinks=async function(t,a){var r=t.semanticObject;var s=t.action;var i=t.params;var o=!!t.withAtLeastOneUsedParam;var l=!!t.treatTechHintAsFilter;var u=t.ignoreFormFactor;var c=t.hasOwnProperty("sortResultsBy")?t.sortResultsBy:"intent";if(t.hasOwnProperty("sortResultOnTexts")){e.warning("the parameter 'sortResultOnTexts' was experimental and is no longer supported","getLinks results will be sorted by '"+c+"'","sap.ushell.services.ClientSideTargetResolution")}var d={bExcludeTileInbounds:true};var f=this._validateGetSemanticObjectLinksArgs(t);if(t.tags){d.tags=t.tags}if(f){throw new Error(f)}if(r==="*"){return[]}function p(e){var t=y.paramsToString(e);return t?"?"+t:""}var h=b.getFormFactor();var m=y.parseParameters(p(i));var v={semanticObject:r===""?undefined:r,action:s,formFactor:u?undefined:h,params:m};if(l){v.treatTechHintAsFilter=true}const S=await this._getMatchingInbounds(v,a,d);var w={};var R=S.map(function(e){var a=r||e.inbound.semanticObject;var s="#"+a+"-"+e.inbound.action;var i;if(a==="*"){return undefined}if(e.inbound.action==="*"){return undefined}if(e.inbound&&e.inbound.hasOwnProperty("hideIntentLink")&&e.inbound.hideIntentLink===true){return undefined}if(!w.hasOwnProperty(s)){w[s]={matchingInbound:e.inbound,count:1};if(e.inbound.signature.additionalParameters==="ignored"){i=g.filterObjectKeys(m,function(t){return t.indexOf("sap-")===0||e.inbound.signature.parameters.hasOwnProperty(t)},false)}else{i=m}if(o){var l=Object.keys(i).some(function(e){return e.indexOf("sap-")!==0});if(!l){w[s].hideReason="getLinks called with 'withAtLeastOneUsedParam = true', but the inbound had no business parameters defined.";return undefined}}var u=g.inboundSignatureMeetsParameterOptions(e.inbound.signature.parameters,t.paramsOptions||[]);if(!u){w[s].hideReason="inbound signature does not meet the requested parameter filter options";return undefined}var c={intent:s+p(i),text:e.inbound.title};if(e.inbound.icon){c.icon=e.inbound.icon}if(e.inbound.subTitle){c.subTitle=e.inbound.subTitle}if(e.inbound.shortTitle){c.shortTitle=e.inbound.shortTitle}var d=n.get("inbound.signature.parameters.sap-tag.defaultValue.value",e);if(d){c.tags=[d]}return c}w[s].count++;return undefined}).filter(function(e){return typeof e==="object"});if(c!=="priority"){R.sort(function(e,t){return e[c]<t[c]?-1:1})}if(R.length===0){e.debug("_getLinks returned no results")}else if(e.getLevel()>=e.Level.DEBUG){if(e.getLevel()>=e.Level.TRACE){var I=[];var P=[];R.forEach(function(e){var t=e.intent.split("?")[0];if(w[t].hideReason){P.push(["-",t+"("+w[t].hideReason+")\n"," text:",e.text+"\n"," full intent:",e.intent].join(" "))}else{I.push(["-",t,w[t].count>1?"("+(w[t].count-1)+" others matched)\n":"\n","text:",e.text+"\n","full intent:",e.intent].join(" "))}});e.debug("_getLinks filtered to the following unique intents:","\n"+I.join("\n"),"sap.ushell.services.ClientSideTargetResolution");e.debug("_getLinks would have also returned the following unique intents, but something prevented this:",P.join("\n"),"sap.ushell.services.ClientSideTargetResolution")}else{e.debug("_getLinks filtered to unique intents.","Reporting histogram: \n - "+Object.keys(w).join("\n - "),"sap.ushell.services.ClientSideTargetResolution")}}return R};w.prototype._getMatchingInbounds=async function(t,n,a){var r=this;var s;var o;var l;var u;if(a){s=a.tags;l=a.bExcludeTileInbounds}if(e.getLevel()>=e.Level.DEBUG){o=++r._iLogId}f.begin(function(){function e(e){var t=e.action||(typeof e.action==="undefined"?"<any>":"<invalid-value>");var n=e.semanticObject||(typeof e.semanticObject==="undefined"?"<any>":"<invalid-value>");return y.constructShellHash({semanticObject:n,action:t,params:e.params})}var n=e(t);return{logId:o,title:"Matching Intent '"+n+"' to inbounds (form factor: "+(t.formFactor||"<any>")+")",moduleName:"sap.ushell.services.ClientSideTargetResolution",stages:["STAGE1: Find matching inbounds","STAGE2: Resolve references","STAGE3: Rematch with references","STAGE4: Sort matched targets"]}});function c(){f.end(()=>({logId:o}))}var p=t.semanticObject;var g=t.action;this._oShellHash=t;var h=s?n.getSegmentByTags(s):n.getSegment(p,g);if(l){u=h.filter(function(e){return!e.tileResolutionResult||!e.tileResolutionResult.isCustomTile})}else{u=h}var m=null;if(this._oAdapter.getContentProviderDataOriginsLookup){m=this._oAdapter.getContentProviderDataOriginsLookup.bind(this._oAdapter)}const v=await d.match(t,u,{},m,e.getLevel()>=e.Level.DEBUG);f.log(function(){return{logId:o,stage:1,prefix:"✘",lines:Object.keys(v.noMatchReasons||{}).map(function(e){return e+" "+v.noMatchReasons[e]})}});f.log(function(){var e=v.matchResults.map(function(e){return i.formatInbound(e.inbound)});return{logId:o,stage:1,prefix:e.length>0?"✅":"✘",lines:e.length>0?e:["No inbound was matched"]}});var b={};var w=false;var R=Object.keys(v.missingReferences);R.forEach(function(e){var t=Object.keys(v.missingReferences[e]);w=w||t.length>0;b[e]=t});R=R.filter(function(e){if(b[e].length>0){return true}delete b[e];return false});let I;if(w){try{R.forEach(function(e){f.log(function(){return{logId:o,stage:2,line:'@ Must resolve the following references with contentProviderId = "'+e+'":',prefix:"•",lines:b[e]}})});const e=await S.getServiceAsync("ReferenceResolver");const t=await Promise.all(R.map(e=>this.getSystemContext(e)));const n=await Promise.all(R.map(function(n,a){return e.resolveReferences(b[n],t[a])}));var P={matchResults:v.matchResults,referencesToInclude:{}};R.forEach(function(e,t){var a=n[t];P.referencesToInclude[e]=a;if(Object.keys(a).length>0){f.log(function(){return{logId:o,stage:2,line:'✅ resolved references with contentProviderId = "'+e+'" to the following values:',prefix:"•",lines:Object.keys(a).map(function(e){return e+": '"+a[e]+"'"})}})}});I=P}catch(e){f.log(function(){return{logId:o,stage:2,prefix:"❌",line:"Failed to resolve references: "+e}});c();return[]}}else{f.log(function(){return{logId:o,stage:2,prefix:"✅",line:"No need to resolve references"}});I={matchResults:v.matchResults,referencesToInclude:null}}let T;if(I.referencesToInclude){var A=I.matchResults;var _=A.map(function(e){return e.inbound});T=await d.match(t,_,I.referencesToInclude,m,0);f.log(function(){var e=T.matchResults||[];if(e.length>=1){return{logId:o,stage:3,line:"The following inbounds re-matched:",lines:e.map(function(e){return i.formatInbound(e.inbound)}),prefix:"✅"}}return{logId:o,stage:3,line:"No inbounds re-matched",prefix:"-"}})}else{f.log(function(){return{logId:o,stage:3,line:"rematch was skipped (no references to resolve)",prefix:"✅"}});T=I}var O=T.matchResults||[];if(O.length<=1){f.log(function(){return{logId:o,stage:4,line:"Nothing to sort"}});c();return O}var j=d.sortMatchingResultsDeterministic(T.matchResults||[]);f.log(function(){var e=j.map(function(e){return i.formatInbound(e.inbound||{})+(e.matchesVirtualInbound?" (virtual)":"")+"\n[ Sort Criteria ] "+"\n * 1 * sap-priority: '"+e["sap-priority"]+"'"+"\n * 2 * Sort string: '"+e.priorityString+"\n * 3 * Deterministic blob: '"+d.serializeMatchingResult(e)+"'"});return{logId:o,stage:4,line:"Sorted inbounds as follows:",lines:e,prefix:".",number:true}});c();return j};w.prototype._isIntentSupportedOne=async function(e,t){var n=y.parseShellHash(e);if(e==="#"){return true}if(n===undefined){throw new Error(`Could not parse shell hash '${e}'`)}n.formFactor=b.getFormFactor();const a=await this._getMatchingInbounds(n,t,{bExcludeTileInbounds:true});return a.length>0};w.prototype.isIntentSupported=async function(e){const t=await this._oInboundProvider.getInbounds();const n=await this._isIntentSupported(e,t);return n};w.prototype._isIntentSupported=async function(e,t){var n={};await Promise.all(e.map(async e=>{try{const a=await this._isIntentSupportedOne(e,t);n[e]={supported:a}}catch(e){throw new Error(`One or more input intents contain errors: ${e}`)}}));return n};w.prototype.getUserDefaultParameterNames=async function(e){const t=await this._oInboundProvider.getInbounds();const n=await this._getUserDefaultParameterNames(t.getAllInbounds(),e);return n};w.prototype._getUserDefaultParameterNames=function(e,t){var n={simple:{},extended:{}};e=e.filter(function(e){if(e.contentProviderId===undefined&&t.id===""){return true}return e.contentProviderId===t.id});return S.getServiceAsync("ReferenceResolver").then(function(t){e.forEach(function(e){var a=e.signature&&e.signature.parameters||[];Object.keys(a).forEach(function(e){var r=a[e];var s;if(r){if(r.filter&&r.filter.format==="reference"){s=r.filter.value}else if(r.defaultValue&&r.defaultValue.format==="reference"){s=r.defaultValue.value}if(typeof s==="string"){var i=t.extractUserDefaultReferenceName(s);if(typeof i==="string"){n.simple[i]={}}var o=t.extractExtendedUserDefaultReferenceName(s);if(typeof o==="string"){n.extended[o]={}}}}})});return n})};w.prototype.getEasyAccessSystems=function(e){e=e||"sapMenu";if(!this._oHaveEasyAccessSystemsDeferreds[e]){this._oHaveEasyAccessSystemsDeferreds[e]=this._getEasyAccessSystems(e)}return this._oHaveEasyAccessSystemsDeferreds[e]};w.prototype._getEasyAccessSystems=async function(a){var s={};var o=r.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent.split("-")[1];e[n]={appType:t.type,priority:t.easyAccessMenu.systemSelectionPriority};return e},{});let l;switch(a){case"userMenu":l=r.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInUserMenu;return e},{});break;case"sapMenu":l=r.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInSapMenu;return e},{});break;default:throw new Error(`Invalid menu type: '${a}'`)}const u=await this._oInboundProvider.getInbounds();var c={};const d=b.getFormFactor();u.getAllInbounds().filter(function e(t){if(!t){return false}var n=[t.semanticObject,t.action].join("-");return l[n]&&t.deviceTypes&&d!==undefined&&t.deviceTypes[d]}).forEach(function(a){var r;if(t(a.signature.parameters["sap-system"])&&a.signature.parameters["sap-system"].hasOwnProperty("filter")){r=n.get("signature.parameters.sap-system.filter.value",a)}if(typeof r==="string"){var l=o[a.action].priority;var u=o[a.action].appType;if(!s[r]){c[r]=-1;s[r]={appType:{}}}if(c[r]<l){s[r].text=a.title;c[r]=l}s[r].appType[u]=true}else{e.warning("Cannot extract sap-system from easy access menu inbound: "+i.formatInbound(a),"This parameter is supposed to be a string. Got '"+r+"' instead.","sap.ushell.services.ClientSideTargetResolution")}});return s};w.prototype.getSystemContext=async function(e){var t=e===undefined?"":e;const n=await b.promisify(this._oAdapter.resolveSystemAlias(t));const a=p.createSystemContextFromSystemAlias(n);return a};w.hasNoAdapter=false;return w},true);
//# sourceMappingURL=ClientSideTargetResolution.js.map