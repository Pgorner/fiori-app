// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/base/EventProvider","sap/ui/core/Element","sap/ui/thirdparty/hasher","sap/ushell/AppInfoParameters","sap/ushell/EventHub","sap/ushell/TechnicalParameters","sap/ui/core/Component","sap/ushell/services/AppConfiguration","sap/ui/thirdparty/URI","sap/ushell/Config","sap/ushell/Container"],function(e,t,n,a,o,i,p,r,s,c,l,f){"use strict";const u="appLoaded";function g(g,d,h,m){var A;var v;var I;this.getCurrentApplication=function(){return A};this.attachAppLoaded=function(e,t,n){I.attachEvent(u,e,t,n)};this.detachAppLoaded=function(e,t){I.detachEvent(u,e,t)};this.prepareCurrentAppObject=function(e,t,n,a,o){w(e,t,n,a,o)};this.reloadCurrentApp=function(){i.emit("reloadCurrentApp",{sAppContainerId:v.getId(),sCurrentHash:a.getHash(),date:Date.now()})};this.setAppInfo=function(e,t){o.setCustomAttributes(e?.info);if(l.last("/core/shell/enableMessageBroker")){f.getServiceAsync("MessageBroker").then(function(e){A.getAllAppInfo(true).then(function(n){e.publish("flp-app-info","FLP",Date.now().toString(),t===true?"new-app-info":"app-info-update","*",n)})})}};function C(e,t,n,a,o){if(n==="flp-app-info"&&a==="get-current-app-info"&&A){A.getAllAppInfo(true).then(function(n){e.publish("flp-app-info","FLP",Date.now().toString(),a,[t],n)})}}if(window.QUnit===undefined&&f.inAppRuntime()===false){if(l.last("/core/shell/enableMessageBroker")){f.getServiceAsync("MessageBroker").then(function(e){e.subscribe("FLP",[{channelId:"flp-app-info",version:"1.0"}],C.bind(undefined,e),function(){})})}}I=new t;if(f.inAppRuntime()===false){if(f.getRendererInternal()){y()}else{i.once("RendererLoaded").do(function(){y()})}}function y(){var t=n.getElementById("viewPortContainer");if(!t||typeof t.attachAfterNavigate!=="function"){e.error("Error during instantiation of AppLifeCycle service","Could not attach to afterNavigate event","sap.ushell.services.AppLifeCycle");return}t.attachAfterNavigate(function(e){var t;var n;var a;var o;var i;var p=false;if(e.mParameters.toId.indexOf("applicationShellPage")===0){n=e.mParameters.to.getApp()}else if(e.mParameters.toId.indexOf("application")===0){n=e.mParameters.to}if(n&&typeof n.getComponentHandle==="function"&&n.getComponentHandle()){o=n.getComponentHandle().getInstance()}else if(n){t=n.getAggregation("child");if(t){o=t.getComponentInstance()}}else{o=r.getComponentById(e.mParameters.to.getComponent())}if(o){i=o.getId();p=i.indexOf("Shell-home-component")!==-1||i.indexOf("pages-component")!==-1||i.indexOf("workPageRuntime-component")!==-1||i.indexOf("Shell-appfinder-component")!==-1||i.indexOf("homeApp-component")!==-1||i.indexOf("runtimeSwitcher-component")!==-1}a=n&&typeof n.getApplicationType==="function"&&n.getApplicationType();if((!a||a==="URL")&&o){a="UI5"}w(a,o,p,n)})}function P(e){var t=a.getHash();var n;if(!t){return Promise.reject("Could not identify current application hash")}var o=f.getServiceAsync("URLParsing");return o.then(function(a){n=a.parseShellHash(t);if(e===true&&v&&typeof v.getCurrentAppUrl==="function"){var o=v.getCurrentAppUrl();if(o){var i=new c(o).search(true);if(i.hasOwnProperty("sap-remote-intent")){n.semanticObject=i["sap-remote-intent"].split("-")[0];n.action=i["sap-remote-intent"].split("-")[1];delete n.params["sap-shell-so"];delete n.params["sap-shell-action"]}}}return n})}function w(e,t,n,a,r){v=a;A={applicationType:e,componentInstance:t,homePage:n,getTechnicalParameter:function(n){return p.getParameterValue(n,t,a,e)},getIntent:P,getInfo:function(e){return o.getInfo(e,A,a)},getAllAppInfo:function(e){return o.getAllAppInfo(e,A,t,a).then(function(t){if(e===true){t.applicationType=A.applicationType;t.homePage=A.homePage}else{t.applicationType={value:A.applicationType};t.homePage={value:A.homePage}}return t})},getSystemContext:function(){var e=s.getCurrentApplication()||{};var t=e.contentProviderId||"";return f.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext(t)})},disableKeepAliveAppRouterRetrigger:function(e){P().then(function(t){i.emit("disableKeepAliveRestoreRouterRetrigger",{disable:e,intent:t,componentId:A.componentInstance.oContainer.sId,date:Date.now()})})}};setTimeout(function(){I.fireEvent(u,A);i.emit("FESRAppLoaded",{technicalName:A?.technicalName});if(window.QUnit===undefined&&f.inAppRuntime()===false){if(l.last("/core/shell/enableMessageBroker")){f.getServiceAsync("MessageBroker").then(function(e){A.getAllAppInfo(true).then(function(t){e.publish("flp-app-info","FLP",Date.now().toString(),"new-app-info","*",t)})})}}},0)}}g.prototype.ApplicationType={UI5:"UI5",WDA:"WDA",NWBC:"NWBC",URL:"URL",TR:"TR"};g.prototype.AppInfoParameterName={productName:"productName",theme:"theme",languageTag:"languageTag",appIntent:"appIntent",appFrameworkId:"appFrameworkId",technicalAppComponentId:"technicalAppComponentId",appId:"appId",appVersion:"appVersion",appSupportInfo:"appSupportInfo",appFrameworkVersion:"appFrameworkVersion"};g.hasNoAdapter=true;return g},true);
//# sourceMappingURL=AppLifeCycle.js.map