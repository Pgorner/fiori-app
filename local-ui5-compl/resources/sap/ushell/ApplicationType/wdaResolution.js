// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/thirdparty/URI","sap/ushell/ApplicationType/systemAlias","sap/ushell/ApplicationType/utils","sap/ushell/Container"],function(e,s,a,t,n,r){"use strict";async function i(s,a){return new Promise(async(t,i)=>{var p=e({},s);if(a.length>0){p["sap-ushell-defaultedParameterNames"]=[JSON.stringify(a)]}delete p["sap-system"];if(p["sap-xapp-state-data"]){const e=await r.getServiceAsync("AppState");const s=e.createEmptyAppState(undefined,true);s.setData(JSON.parse(p["sap-xapp-state-data"][0]));await s.save();p["sap-xapp-state"]=[s.getKey()];delete p["sap-xapp-state-data"]}const u=await r.getServiceAsync("ShellNavigationInternal");u.compactParams(p,["sap-xapp-state","sap-ushell-defaultedParameterNames","sap-intent-params","sap-iframe-hint","sap-keep-alive","sap-wd-configId"],undefined,true).fail(function(e){i(e)}).then(function(e){var s=n.getURLParsing().paramsToString(e);t(s)})})}function p(e,s){var a=e.search();if(s){a=a+(a.indexOf("?")<0?"?":"&")+s}return e.search(a).toString()}function u(s,r,i,p,u){var m,c,d,f,y,v=e({},p);if(r){v["sap-wd-configId"]=r}if(v["sap-system"]){m=v["sap-system"][0];delete v["sap-system"]}if(v.hasOwnProperty("sap-system-src")){c=v["sap-system-src"][0];delete v["sap-system-src"]}y=n.getURLParsing().paramsToString(v);if(i){d=o(s,y)}else{d=l(s,y)}f=new a(d);return t.spliceSapSystemIntoURI(f,t.LOCAL_SYSTEM_ALIAS,m,c,"WDA",t.SYSTEM_ALIAS_SEMANTICS.apply,u)}function o(e,s){return"/ui2/nwbc/~canvas;window=app/wda/"+e+"/"+"?"+s}function l(e,s){var a=e.indexOf("/")!==0;if(a){e="sap/"+e}return"/webdynpro/"+e+"?"+s}function m(e,s,a,t){var r={"sap-system":a,url:s,text:e.title,applicationType:"WDA"};if(typeof t==="string"){r["sap-system-src"]=t}n.setSystemAlias(r,e.resolutionResult);["additionalInformation","applicationDependencies"].forEach(function(s){if(e.resolutionResult.hasOwnProperty(s)){r[s]=e.resolutionResult[s]}});r.url=n.appendParametersToUrl("sap-iframe-hint="+(r.url.indexOf("/ui2/nwbc/")>=0?"NWBC":"WDA"),r.url);return r}function c(e,a,t){var n=s.get("inbound.resolutionResult",e);var r=e.mappedIntentParamsPlusSimpleDefaults||{};var o=n.systemAlias;if(r["sap-system"]){o=r["sap-system"][0]}var l;if(r["sap-system-src"]){l=r["sap-system-src"][0]}var c={"sap-system":[o]};if(typeof l==="string"){c["sap-system-src"]=[l]}var d=n["sap.wda"].compatibilityMode;if(d===undefined){d=true}return Promise.all([u(n["sap.wda"].applicationId,n["sap.wda"].configId,d,c,t),i(r,e.mappedDefaultedParamNames)]).then(function(s){var a=s[0];var t=s[1];var n=p(a,t);var i=r["sap-system"]&&r["sap-system"][0];var u=r["sap-system-src"]&&r["sap-system-src"][0];var o=m(e.inbound,n,i,u);return o})}function d(e,s,n){var r=e.inbound,u=r&&r.resolutionResult,o=e.mappedIntentParamsPlusSimpleDefaults;var l=new a(s);var c=o["sap-system"]&&o["sap-system"][0];var d=o["sap-system-src"]&&o["sap-system-src"][0];return Promise.all([t.spliceSapSystemIntoURI(l,u.systemAlias,c,d,"WDA",u.systemAliasSemantics||t.SYSTEM_ALIAS_SEMANTICS.applied,n),i(o,e.mappedDefaultedParamNames)]).then(function(e){var s=e[0];var a=e[1];var t=p(s,a);var n=m(r,t,c,d);return n},function(e){return Promise.reject(e)})}function f(e,a,t,r){var i=e.params["sap-ui2-wd-app-id"][0];var p=(s.get("params.sap-ui2-wd-conf-id",e)||[])[0];var o=Object.keys(e.params).reduce(function(s,a){if(a!=="sap-ui2-wd-app-id"&&a!=="sap-ui2-wd-conf-id"){s[a]=e.params[a]}return s},{});return u(i,p,r,o,t).then(function(s){var t=e.params.hasOwnProperty("sap-system-src")&&e.params["sap-system-src"][0];var r=e.params.hasOwnProperty("sap-system")&&e.params["sap-system"][0]||"";var p={url:s.toString(),applicationType:"WDA",text:i,additionalInformation:"","sap-system":r,systemAlias:r};if(typeof t==="string"){p["sap-system-src"]=t}if(a&&a.inbound&&a.inbound.resolutionResult&&a.inbound.resolutionResult["sap.platform.runtime"]){p["sap.platform.runtime"]=a.inbound.resolutionResult["sap.platform.runtime"]}p.url=n.appendParametersToUrl("sap-iframe-hint="+(p.url.indexOf("/ui2/nwbc/")>=0?"NWBC":"WDA"),p.url);return p})}function y(e,s,a){return new Promise(function(t,r){var i=e.inbound;var p=i&&i.resolutionResult;var u;if(i&&p){if(p["sap.wda"]){u=c(e,s,a)}else{u=d(e,s,a)}}if(u){u.then(function(s){s.extendedInfo=n.getExtendedInfo(e);n.checkOpenWithPost(e,s);n.addKeepAliveToURLTemplateResult(s);return s}).then(t,r)}else{t()}})}return{generateWDAResolutionResult:y,resolveEasyAccessMenuIntentWDA:f,constructFullWDAResolutionResult:c,constructWDAResolutionResult:d,constructWDAURLParameters:i}});
//# sourceMappingURL=wdaResolution.js.map