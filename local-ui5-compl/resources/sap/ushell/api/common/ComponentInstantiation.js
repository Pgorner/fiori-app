// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ushell/Container","sap/ushell/UI5ComponentType","sap/ushell/utils/UrlParsing","sap/base/util/deepExtend","sap/ushell/ApplicationType","sap/ushell/utils"],function(e,t,n,a,o,i,s){"use strict";class p{async createComponentInstance(e,a,o){const i=await t.getServiceAsync("Ui5ComponentLoader");let s=await this.createComponentInstantiationData(e,a);s=await i.modifyComponentProperties(s,n.Application);s.loadDefaultDependencies=false;if(o){return new Promise((e,t)=>{o.runAsOwner(()=>{this.#e(s,i).then(e).catch(t)})})}return this.#e(s,i)}async#e(t,n){try{const e=await n.instantiateComponent(t);return e.componentHandle.getInstance()}catch(t){e.error(`Cannot create UI5 component: ${t.toString()}`,t.stack,"sap.ushell.api.common.ComponentInstantiation");return Promise.reject(t)}}async createComponentInstantiationData(e,n){const o={componentData:n};if(o.componentData){delete o.componentData.startupParameters;delete o.componentData.config;delete o.componentData["sap-xapp-state"]}const p=a.constructShellHash(a.parseShellHash(e));if(!p){return Promise.reject("Navigation intent invalid!")}const r=await t.getServiceAsync("NavTargetResolutionInternal");const c=await r.resolveHashFragment("#"+p);if(c.applicationType===i.URL.type&&c.appCapabilities&&c.appCapabilities.appFrameworkId==="UI5"&&t.inAppRuntime()){const[t]=await s.requireAsync(["sap/ushell/appRuntime/ui5/services/AppLifeCycleAgent"]);let n;try{const e=new URL(c.url);const t=new URLSearchParams(e.search);n=t.get("sap-ui-app-id")}catch(e){n=c.url.match(/[?&]sap-ui-app-id=([^&]+)/)[1]}let a=await t.getAppInfo(n);if(a.hasOwnProperty("oResolvedHashFragment")){a=a.oResolvedHashFragment}a=this.#t(a,o);if(a.url&&e.indexOf("?")>0){a.url+="?"+e.split("?")[1]}return this.#n({ui5ComponentName:n,applicationDependencies:a,url:a.url},o)}else if(c.applicationType!==i.URL.type&&!/^SAPUI5\.Component=/.test(c.additionalInformation)){return Promise.reject("The resolved target mapping is not of type UI5 component.")}return this.#n(c,o)}async#n(n,a){try{n=this.#t(n,a);n.loadDefaultDependencies=false;const e=await t.getServiceAsync("Ui5ComponentLoader");return e.createComponentData(n)}catch(t){e.error("Cannot get UI5 component data: "+t,t.stack,"sap.ushell.api.common.ComponentInstantiation");return Promise.reject(t)}}#t(e,t){e=o({},e,t);if(!e.ui5ComponentName){if(e.additionalInformation){e.ui5ComponentName=e.additionalInformation.replace(/^SAPUI5\.Component=/,"")}else if(e.name){e.ui5ComponentName=e.name}}return e}}return new p});
//# sourceMappingURL=ComponentInstantiation.js.map