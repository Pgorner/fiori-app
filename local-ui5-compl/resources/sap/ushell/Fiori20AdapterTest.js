// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isEmptyObject","sap/base/util/Version","sap/ui/core/Configuration","sap/ui/core/library","sap/ui/core/service/ServiceFactoryRegistry","sap/ui/core/UIComponent","sap/ushell/Fiori20Adapter"],function(e,i,t,a,n,s,r,o){"use strict";var u={I_DEFAULT_SEARCH_DEPTH:5,B_DEFAULT_LATE_ADAPTATION:false,S_FIORI20ADAPTER_URL_PARAM_NAME:"sap-ui-xx-fiori2Adaptation",S_FIORI20ADAPTER_METADATA_PARAM_NAME:"sapFiori2Adaptation",A_ALLOWLIST:["fin.*","ssuite.fin.*","fscm.*","sap.fin.*","cus.sd.*","cus.o2c.*","sap.apf.*","tl.ibp.*","ux.fnd.apf.o2c.*","fnd.apf.*","fnd.pob.o2c.*","fcg.sll.*","ux.fnd.generic-apf-application.*","hpa.cei.*","query.viewbrowser.s1.*","ssuite.vdm.viewbrowser.s1.*","ssuite.smartbusiness.kpi.s1.*","ssuite.smartbusiness.evaluation.s1.*","ssuite.smartbusiness.association.s1.*","ssuite.smartbusiness.drilldown.s1.*","ssuite.smartbusiness.tile.s1.*","ssuite.smartbusiness.tile.ce.s1.*","ssuite.smartbusiness.workspace.s1.*","ssuite.smartbusiness.runtime.s1.*","gs.fin.customersummarycn.display.*","gs.fin.financialstatement.structure.manage.*","gs.fin.financialstatement.display.*","uipsm.*","publicservices.her.*"],getConfiguration:function(e){var i;i=this._getURLParamConfiguration();if(!i){i=this._getMetadataConfiguration(e)}if(!i){i=this._getDefaultConfiguration(e)}i.iSearchDepth=i.iSearchDepth||u.I_DEFAULT_SEARCH_DEPTH;if(typeof i.iSearchDepth==="string"&&!isNaN(i.iSearchDepth)){i.iSearchDepth=parseInt(i.iSearchDepth,10)}return i},_getURLParamConfiguration:function(){if(!a||typeof a.getFiori2Adaptation!=="function"){return}var e=new URLSearchParams(window.location.search);if(!e.get(u.S_FIORI20ADAPTER_URL_PARAM_NAME)){return}var i=a.getFiori2Adaptation();var t;var n;if(typeof i==="boolean"){t=i}else if(i&&i.length>=1){n=i}if(!n&&t===undefined){return}return{bStylePage:n?n.indexOf("style")>-1:t,bMoveTitle:n?n.indexOf("title")>-1:t,bHideBackButton:n?n.indexOf("back")>-1:t,bCollapseHeader:n?n.indexOf("collapse")>-1:t,bHierarchy:n?n.indexOf("hierarchy")>-1:t}},_getMetadataConfiguration:function(e){var t=e.getManifestEntry("/sap.ui5/config")||{};var a=t[u.S_FIORI20ADAPTER_METADATA_PARAM_NAME];var n;var s;if(typeof a==="boolean"){n=a}else if(typeof a==="object"&&!i(a)){s=a}if(!s&&n===undefined){return}return{bStylePage:s?this._isSgnTrue(s.style):n,bMoveTitle:s?this._isSgnTrue(s.title):n,bHideBackButton:s?this._isSgnTrue(s.back):n,bCollapseHeader:s?this._isSgnTrue(s.collapse):n,bHierarchy:s?this._isSgnTrue(s.hierarchy):n,bLateAdaptation:s?this._isSgnTrue(s.lateAdaptation):u.B_DEFAULT_LATE_ADAPTATION}},_getDefaultConfiguration:function(e){var i=this._hasMinVersionSmallerThan(e,"1.42")&&this._isAllowed(e);return{bStylePage:i,bMoveTitle:i,bHideBackButton:i,bCollapseHeader:i,bHierarchy:i}},_isAllowed:function(e){var i=e.getMetadata().getName();for(var t=0;t<u.A_ALLOWLIST.length;t++){var a=u.A_ALLOWLIST[t].substring(0,u.A_ALLOWLIST[t].length-2);if(this._isPrefixedString(i,a)){return true}}return false},_isAdaptationRequired:function(e){for(var i in e){if(e[i]===true){return true}}return false},_isPrefixedString:function(e,i){return e&&i&&e.substring(0,i.length)===i},_hasMinVersionSmallerThan:function(e,i){var a=e.getManifestEntry("sap.ui5");var n=true;if(a&&a.dependencies&&a.dependencies.minUI5Version){var s=new t(a.dependencies.minUI5Version);n=s.compareTo(new t(i))<0}return n},_isSgnTrue:function(e){return e===true||e==="true"}};r._fnOnInstanceInitialized=function(i){const t=i.getAggregation("rootControl");if(!t||t.getId()==="navContainerFlp"||i.getId().indexOf("application-")!==0){return}const a=u.getConfiguration(i);if(!u._isAdaptationRequired(a)){return}if(!n.service||!s||typeof s.get!=="function"){e.warning("Fiori20Adapter not loaded because static FactoryRegistry is not available","sap.ui.core.service.ServiceFactoryRegistry should be a function","sap.ushell.Fiori20AdapterTest");return}const r={onBeforeRendering:function(){t.removeEventDelegate(r);const n=s.get("sap.ushell.ui5service.ShellUIService");const u=n&&n.createInstance({scopeObject:i,scopeType:"component"});if(!n||!u){e.warning("Fiori20Adapter not loaded because ShellUIService is not available","sap.ushell.ui5service.ShellUIService should be declared by configuration","sap.ushell.Fiori20AdapterTest");return}u.then(e=>o.applyTo(t,i,a,e)).catch(i=>{e.warning("Fiori20Adapter not loaded as ShellUIService is not available",i,"sap.ushell.Fiori20AdapterTest")})}};t.addEventDelegate(r)}});
//# sourceMappingURL=Fiori20AdapterTest.js.map