// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/thirdparty/URI"],function(e,t){"use strict";var s,r;var a={};a.init=function(e,t){s=e;r=t};a.createPostMessageRequest=function(e,t){var s=Date.now().toString();return{type:"request",request_id:s,service:e,body:t||{}}};a.createPostMessageResponse=function(e,t,s,r){return{type:"response",request_id:t,service:e,status:r?"success":"error",body:s||{}}};a.postMessageToIframeApp=function(e,t,s,r,a){var i=t+"."+s,n=this.createPostMessageRequest(i,r);return this.postMessageToIframe(n,e,a)};a.postMessageToIframe=function(e,s,r){var a=s._getIFrame&&s._getIFrame(),i,n;if(!a||!s._getIFrameUrl){return Promise.resolve()}i=new t(s._getIFrameUrl(a));n=i.protocol()+"://"+i.host();return this.postMessageToIframeObject(e,a,n,r,true)};a.postMessageToIframeObject=function(t,s,r,a,i){var n=t.request_id;return new Promise(function(o,u){function p(r){var a;try{if((i===true?s.contentWindow:s)!==r.source){return}if(typeof r.data==="string"&&r.data.indexOf("{")===0){try{a=JSON.parse(r.data)}catch(e){a={}}}else{return}if(!a.request_id||n!==a.request_id){return}window.removeEventListener("message",p);if(a.status==="success"){o(a)}else{u(a)}}catch(s){o();e.warning("Obtained bad response from framework in response to message "+t.request_id);e.debug("Underlying framework returned invalid response data: '"+r.data+"'")}}if(!s){o()}else{var f=JSON.stringify(t);e.debug("Sending postMessage "+f+" to iframe with domain '"+r+"'");if(a===true){window.addEventListener("message",p,false);if(i===true){s.contentWindow.postMessage(f,r)}else{s.postMessage(f,r)}}else{if(i===true){s.contentWindow.postMessage(f,r)}else{s.postMessage(f,r)}o()}}})};a.postMessageToMultipleIframes=function(e,t,i,n){function o(s){if(e==="sap.ushell.sessionHandler"&&t==="logout"){if(s&&s.getApplicationType&&",WCF,GUI,TR,WDA,".indexOf(s.getApplicationType())>0){return false}}return true}if(!s||!r){return Promise.all([])}var u=s.getActiveAppContainer(),p=false,f=[];if(u&&u._getIFrame&&u._getIFrame()&&(r.isCapabilitySupported(u,e,t)||s.isAppTypeSupported(u,e,t))&&o(u)===true){f.push(a.postMessageToIframeApp(u,e,t,i,n));p=true}if(r.getBlueBoxesCount()>0&&!s.isActiveOnly(e,t)){r.forEach(function(g){if(p===true&&g===u){return}if(g._getIFrame&&g._getIFrame()){if((r.isCapabilitySupported(g,e,t)||s.isAppTypeSupported(g,e,t))&&o(g)===true){f.push(a.postMessageToIframeApp(g,e,t,i,n))}}})}return Promise.all(f)};return a},false);
//# sourceMappingURL=PostMessageUtils.js.map