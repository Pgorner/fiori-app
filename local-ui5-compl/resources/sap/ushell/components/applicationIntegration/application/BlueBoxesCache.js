// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log"],function(t){"use strict";class e{#t={};#e={};constructor(){this.init()}init(){this.#t={};this.#e={}}getLength(){return Object.keys(this.#t).length}getPoolLength(){return Object.values(this.#e).reduce((t,e)=>t+e.length,0)}add(t,e){var i=this.getKeyFromUrl(t);this.#t[i]={container:e,key:i}}moveKeepAliveToPool(t){if(!t){return false}this.removeByContainer(t);const e=t.getCurrentAppUrl().replaceAll("sap-keep-alive","sap-temp");const i=this.getKeyFromUrl(e);if(!this.#t[i]){this.add(e,t);return false}if(!this.#e[i]){this.#e[i]=[]}this.#e[i].push(t);return true}remove(t){if(!t){return}var e=this.getKeyFromUrl(t);if(this.#t[e]){delete this.#t[e]}}removeByContainer(t){if(!t){return}const e=this.#i(t);if(e){delete this.#t[e.key]}}get(t,e){if(t===undefined||this.getLength()===0){return}if(e){t=t.replaceAll("sap-keep-alive","sap-temp")}var i=this.getKeyFromUrl(t);const o=this.#t[i];if(o){return o.container}}#i(t){if(!t){return}let e;Object.values(this.#t).forEach(i=>{if(i.container===t){e=i}});return e}isApplicationContainerActive(t){return!!this.#i(t)}getFromPool(t){const e=t.replaceAll("sap-keep-alive","sap-temp");const i=this.getKeyFromUrl(e);if(this.#e[i]?.length){const t=this.#e[i].shift();if(this.#e[i].length===0){delete this.#e[i]}return t}}getByApplicationContainerId(t){for(const e in this.#t){const i=this.#t[e];if(i){if(i.container.sId===t){return i.container}}}}forEach(t){Object.values(this.#t).forEach(e=>{t(e.container)});Object.values(this.#e).forEach(e=>{e.forEach(e=>{t(e)})})}getKeyFromUrl(e){let i,o="",n="",a="",r="",s="",p="";try{const t=new URL(e,this._getWindowLocationHref());i=t.origin;if(t.port===""){if(t.protocol==="https:"){i=i+":443"}else if(t.protocol==="http:"){i=i+":80"}}const l=t.searchParams;if(l.has("sap-iframe-hint")){o="@hint:"+l.get("sap-iframe-hint")}if(l.has("sap-ui-version")){n="@uiver:"+l.get("sap-ui-version")}if((o==="@hint:GUI"||o==="@hint:WDA"||o==="@hint:WCF")&&l.has("sap-keep-alive")){a="@ka:"+l.get("sap-keep-alive")+"-"+e}if(l.has("sap-async-loading")&&l.get("sap-async-loading")!=="true"){r="@async:"+l.get("sap-async-loading")}if(l.has("sap-enable-fesr")&&l.get("sap-enable-fesr")!=="false"){s="@fesr:"+l.get("sap-enable-fesr")}if(l.has("sap-testcflp-iframeid")){p="@testid:"+l.get("sap-testcflp-iframeid")}}catch(o){t.error("URL '"+e+"' can not be parsed: "+o,"sap.ushell.components.applicationIntegration.application.BlueBoxHandler");i=e}const l=i.toLowerCase()+o+n+a+r+s+p;return l}_getWindowLocationHref(){return window.location.href}_getStorageForDebug(){return{oCacheStorage:this.#t,oKeepAliveIframePool:this.#e}}}return new e});
//# sourceMappingURL=BlueBoxesCache.js.map