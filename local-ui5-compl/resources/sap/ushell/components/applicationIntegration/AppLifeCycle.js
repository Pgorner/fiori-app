// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","sap/ui/core/Element","sap/ui/core/EventBus","sap/ushell/components/applicationIntegration/Storage","sap/ushell/components/applicationIntegration/application/BlueBoxHandler","sap/ushell/components/applicationIntegration/application/Application","sap/ushell/components/applicationIntegration/application/PostMessageUtils","sap/ushell/components/applicationIntegration/application/WebGUIStatefulHandler","sap/ushell/components/applicationIntegration/relatedServices/RelatedServices","sap/ushell/components/applicationIntegration/configuration/AppMeta","sap/ushell/services/AppConfiguration","sap/ushell/utils","sap/ushell/Config","sap/ushell/ApplicationType","sap/base/util/deepExtend","sap/ushell/utils/UriParameters","sap/base/Log","sap/ushell/EventHub","sap/ushell/utils/UrlParsing","sap/ui/thirdparty/hasher","sap/ushell/services/MessageBroker/MessageBrokerEngine","sap/ushell/renderer/utils","sap/m/library","sap/ushell/AppInfoParameters","sap/ushell/Container","sap/ushell/resources","sap/ushell/state/ShellModel","sap/ushell/state/StateManager","sap/ushell/state/KeepAlive","sap/ushell/ui5service/ShellUIServiceFactory","sap/ui/core/service/ServiceFactoryRegistry","sap/base/util/ObjectPath"],(e,t,i,n,a,s,o,r,l,p,c,u,f,d,h,g,A,m,C,y,I,S,v,_,T,w,P,E,U,B,b,F)=>{"use strict";const L=E.ShellMode;const R=E.LaunchpadState;const M=E.Operation;const x=v.URLHelper;const V={FULL:"true",RESTRICTED:"restricted",FALSE:"false"};function H(){let v=false;let H=true;let D={};const k={};let K,W,N;if(window.QUnit===undefined){I.connect("FLP")}this.service=function(){return l};this._setComponentCreatedPromise=function(e){if(!k[e]){k[e]={};k[e].promise=new Promise((t,i)=>{k[e].resolve=t;k[e].reject=i})}return k[e]};this._resolveComponentCreatedPromise=function(e){if(!e){return}this._setComponentCreatedPromise(e).resolve()};this._getComponentCreatedPromise=function(e){if(!e){return}return this._setComponentCreatedPromise(e).promise};this._normalizeAppId=function(e){const t="-component";const i=e.endsWith(t);if(i){return e.substring(0,e.length-t.length)}return e};this._onComponentCreated=function(e,t,i){const a=i.component;const o=this._normalizeAppId(a.getId());const r=n.get(o);if(r){r.app=a;s.active(r.app)}else{D.app=a;if(a.active){a.active()}}this._resolveComponentCreatedPromise(o)};this._onGetMe=function(e,t,i){i.AppLifeCycle=this};this._store=function(e){const t=n.get(e);if(t){s.store(t);t.stateStored=true}};this._destroyApplication=async function(e,t,i){const o=n.get(e);if(!e||!t){return}if(o&&!i){n.removeById(e);if(a.isStatefulContainer(o.container)){await a.statefulDestroyApp(o.container,e)}else if(o.container.getIsKeepAlive()&&a.isReusableContainer(o.container)){a.returnUnusedKeepAliveContainer(o.container);await this._handleExitStateful(o.container,false)}else{this._removeApplicationContainerFromViewPort(e);a.deleteBlueBoxByContainer(o.container);o.container.destroy()}return}if(i){n.removeByContainer(t)}this._removeApplicationContainerFromViewPort(e);try{const e=t.sendBeforeAppCloseEvent();await u.promisify(e)}catch(e){A.error("FLP got a failed response from the iframe for the 'sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent' message sent",e,"sap.ushell.components.applicationIntegration.AppLifeCycle.js")}if(o){U.destroy(o)}a.deleteBlueBoxByContainer(t);s.destroy(t)};this._restore=function(e){const t=n.get(e);if(t?.stateStored){l.restore(t.service);p.restore(t.meta);B.restore(t);s.restore(t)}};this._handleExitStateful=function(e,t,s){const o=e.getCurrentAppId();if(n.get(o)){const r=s||l.isBackNavigation()&&!t;if(r){i.getInstance().publish("sap.ushell","appClosed",e);n.removeById(o);return a.statefulDestroyApp(e)}i.getInstance().publish("sap.ushell","appClosed",e);return a.statefulStoreKeepAliveApp(e,o)}return a.statefulDestroyApp(e)};this._handleExitApplication=async function(e,t,s){if(!e){return}const r=e.getCurrentAppId();if(!r){return}if(!t&&s&&(a.isStatefulContainer(e)||a.isStatefulContainerInKeepAlivePool(e))){return}const p=n.get(r);if(a.isStatefulContainer(e)){await this._handleExitStateful(e,t)}else if(p){if(l.isBackNavigation()&&!t){if(e.getIsKeepAlive()&&a.isReusableContainer(e)){a.returnUnusedKeepAliveContainer(e);await this._handleExitStateful(e,t)}else{await this._destroyApplication(r,e)}}else if(e.getApplicationType()==="UI5"){await this._getComponentCreatedPromise(r);this._store(r)}else{this._store(r)}i.getInstance().publish("sap.ushell","appClosed",e)}else if(e.getStatefulType()===a.STATEFUL_TYPES.GUI_V1){if(t){await o.postMessageToIframeApp(e,"sap.gui","triggerCloseSessionImmediately")}}else{await this._destroyApplication(r,e)}};this._closeKeepAliveApps=function(e){try{const t=[];n.forEach(i=>{if(e(i)){t.push(i)}});const i=t.map(e=>{const t=a.isStatefulContainerSupportingKeepAlive(e.container);const i=e.container.getIsKeepAlive();const n=a.isReusableContainer(e.container);if(!t&&i&&n){a.returnUnusedKeepAliveContainer(e.container);return this._handleExitStateful(e.container,true,true)}return this._destroyApplication(e.appId,e.container)});return Promise.all(i)}catch(e){A.error("closeKeepAliveApps call failed",e)}};this.onBeforeNavigate=function(e,t){if(e&&t&&t.isA("sap.ushell.components.container.ApplicationContainer")){const i=e;const s=t;const r=!!s._getIFrame();const l=s.getStatefulType()>a.STATEFUL_TYPES.NOT_SUPPORTED;const p=!!n.get(i);const c=r&&l;if(p||c){o.postMessageToIframeApp(s,"sap.ushell.sessionHandler","beforeApplicationHide",{},false)}}};this.onAfterNavigate=async function(e,t,a,r){if(!a){a=""}if(!e){e=""}const l=["Shell-appfinder-component","Shell-home-component","pages-component-container","homeApp-component-container","workPageRuntime-component-container","runtimeSwitcher-component-container"];const p=l.some(e=>a.includes(e));const c=l.some(t=>e.includes(t));if(p){await this._closeKeepAliveApps(e=>e.keepAliveMode===V.RESTRICTED);s.setActiveAppContainer(undefined);_.flush()}else if(a&&r){const e=a;const t=r;if(t.getIframeReusedForApp()){t.setProperty("iframeReusedForApp",false,true);o.postMessageToIframeApp(t,"sap.ushell.sessionHandler","afterApplicationShow",{},false)}if(n.get(e)){this._restore(e)}}if(c){if(a.indexOf("Shell-appfinder-component")>0){i.getInstance().publish("sap.ushell","appFinderAfterNavigate")}if(v){try{this._removeApplicationContainerFromViewPort(e);t.destroy()}catch(e){A.error(`Error when trying to destroy the home component: '${a}'`,e)}}}else if(e&&t){const e=t;await this._handleExitApplication(e,p,true)}};this.handleAfterNavigate=async function(e,t){if(!t){return}const i=F.get("appCapabilities.appFrameworkId",t);const n=u.isTRApplicationType(t.applicationType,i);const s=u.isTRApplicationType(e.applicationType);if(n&&!s){const e=a.getBlueBoxByUrl(t.url);if(e&&e.getStatefulType()===a.STATEFUL_TYPES.GUI_V1){return r.guiStatefulCloseCurrentApp(e)}}};this._storeApp=function(e,t,i,a,s){if(n.get(e)){return false}t.setProperty("isKeepAlive",true,true);n.set(e,{service:{},shellHash:`#${C.constructShellHash(a)}`,appId:e,stt:"loading",currentState:null,controlManager:null,container:t,meta:c.getMetadata(i),app:undefined,keepAliveMode:s,appTarget:i,ui5ComponentName:i.ui5ComponentName,enableRouterRetrigger:H,stateStored:false});return true};this.storeAppExtensions=async function(){const e=this.getCurrentApplication();if(!e){return}const t=e.appId;const i=n.get(t);if(!i){return}if(i.container.getApplicationType()==="UI5"){await this._getComponentCreatedPromise(t)}l.store(i.service);U.store(i);_.store(i)};this._calculateKeepAliveMode=function(e,t,i){if(e==="application-Shell-startIntent"){return}let n=new URLSearchParams(window.location.search).get("sap-keep-alive");if(n===V.FULL||n===V.RESTRICTED){return n}else if(n===V.FALSE){return}n=i.params?.["sap-keep-alive"];if(n===V.FULL||n===V.RESTRICTED){return n}else if(n===V.FALSE){return}if(t.url){n=g.fromURL(t.url).get("sap-keep-alive");if(n===V.FULL||n===V.RESTRICTED){return n}else if(n===V.FALSE){return}}const a=C.constructShellHash(i);if(a&&u.isRootIntent(a)){return V.FULL}};this._calculateAppType=function(e){if(e.applicationType==="URL"&&e.additionalInformation?.startsWith?.("SAPUI5.Component=")){return"SAPUI5"}return e.applicationType};this._reloadCurrentApp=async function(e){const t=a.getBlueBoxById(e.sAppContainerId);if(t){const i=t.getUrl();a.removeCapabilities(t);n.removeByContainer(t);await this._destroyApplication(e.sAppContainerId,t);a.deleteBlueBoxByUrl(i)}const i=await T.getServiceAsync("ShellNavigationInternal");try{i.hashChanger.treatHashChanged(e.sCurrentHash)}catch(e){A.error("Error when trying to re-load the current displayed application",e,"sap.ushell.services.AppLifeCycle")}};this._openApp=async function(e,t,i){let o,r,l;const p=`application-${e}`;let u=a.getBlueBoxByUrl(t.url);const f=this._calculateKeepAliveMode(p,t,i);const d=!!f;if(a.isStatefulContainer(u)){if(d){let e=n.get(p);if(!e){this._storeApp(p,u,t,i,f);e=n.get(p)}D=e}else{D={appId:p,stt:"loading",container:u,meta:c.getMetadata(t),app:undefined}}}else if(d){let c=n.get(p);if(!c){r=a.findFreeContainerForNewKeepAliveApp(t);if(!r){o=a.getBlueBoxById(p)||this._getApplicationContainerFromViewPort(e);if(o){l=o.getUrl();a.removeCapabilities(o);await this._destroyApplication(p,o);a.deleteBlueBoxByUrl(l)}u=s.createApplicationContainer(p,t)}else{u=r}this._storeApp(p,u,t,i,f);c=n.get(p)}D=c}else if(t.applicationType==="TR"||t.appCapabilities?.appFrameworkId==="GUI"){u=a.getBlueBoxByUrl(t.url);if(u&&u.getStatefulType()!==a.STATEFUL_TYPES.GUI_V1){u=undefined}o=a.getBlueBoxById(p)||this._getApplicationContainerFromViewPort(e);if(o&&(!u||o!==u)){l=o.getUrl();a.removeCapabilities(o);await this._destroyApplication(p,o);a.deleteBlueBoxByUrl(l)}if(!u){u=s.createApplicationContainer(p,t)}D={appId:p,stt:"loading",container:u,meta:c.getMetadata(t),app:undefined}}else{if(u){const t=this._getApplicationContainerFromViewPort(e);if(t){this._removeApplicationContainerFromViewPort(t.getId());t.destroy()}}if(t.applicationType==="URL"||t.applicationType==="TR"||t.applicationType==="NWBC"||t.applicationType==="WDA"){o=a.getBlueBoxById(p)||this._getApplicationContainerFromViewPort(e);if(o){l=o.getUrl();a.removeCapabilities(o);await this._destroyApplication(p,o,true);a.deleteBlueBoxByUrl(l)}}u=s.createApplicationContainer(p,t);D={appId:p,stt:"loading",container:u,meta:c.getMetadata(t),app:undefined}}};this._addEvents=function(){let e=false;return function(){if(!e){e=true;m.on("disableKeepAliveRestoreRouterRetrigger").do(e=>{const t=`${e.intent.semanticObject}-${e.intent.action}`;const i=`application-${t}`;H=e.disable;if(n.get(i)){n.get(i).enableRouterRetrigger=e.disable}});m.on("setApplicationFullWidth").do(e=>{this._setApplicationFullWidth(e.bValue)});m.on("reloadCurrentApp").do(e=>{this._reloadCurrentApp(e)})}}}();this.init=function(e,t){if(T&&f.last("/core/shell/enablePersistantAppstateWhenSharing")){T.getServiceAsync("AppState").then(e=>{W=x.triggerEmail.bind(x);x.triggerEmail=function(t,i,n,a,s){const o=document.URL;e.setAppStateToPublic(o).done((e,o,r,l,p)=>{i=i&&o&&l&&i.includes(o)?i.replace(o,l):i;i=i&&r&&p&&i.includes(r)?i.replace(r,p):i;n=n&&o&&l&&n.includes(o)?n.replace(o,l):n;n=n&&r&&p&&n.includes(r)?n.replace(r,p):n;W(t,i,n,a,s)}).fail((e,t,i,n,a)=>{W(e,t,i,n,a)})}})}B.init().then(()=>{b.register("sap.ushell.ui5service.ShellUIService",B)});this._createGlobalShellUIService();N=e;v=t;a.init();s.init(a,o);o.init(s,a);this.registerShellCommunicationHandler({"sap.ushell.services.AppLifeCycle":{oRequestCalls:{create:{isActiveOnly:true,distributionType:["URL"]},destroy:{isActiveOnly:true,distributionType:["URL"]},store:{isActiveOnly:true,distributionType:["URL"]},restore:{isActiveOnly:true,distributionType:["URL"]}},oServiceCalls:{subscribe:{executeServiceCallFn:async function(e){const{oContainer:t}=e;const i=e.oMessageData.body;if(!Array.isArray(i)){A.error("subscribe service call failed: capabilities must be an array");return{}}t.addBlueBoxCapabilities(i);return{}}},setup:{executeServiceCallFn:async function(e){const t=e?.oMessageData?.body;const{oContainer:i}=e;const n=[];if(t){const e=u.isSAPLegacyApplicationType(i.getApplicationType(),i.getFrameworkId());const s=i.getIsKeepAlive()&&e;if(t.isStateful){if(s){i.setProperty("statefulType",a.STATEFUL_TYPES.FLP_V2_KEEP_ALIVE,true)}else{n.push({service:"sap.ushell.services.AppLifeCycle",action:"create"});n.push({service:"sap.ushell.services.AppLifeCycle",action:"destroy"});i.setProperty("statefulType",a.STATEFUL_TYPES.FLP_V2,true)}}if(t.isIframeValid){n.push({action:"iframeIsValid",service:"sap.ushell.appRuntime"})}if(t.session?.bLogoutSupport){n.push({action:"logout",service:"sap.ushell.sessionHandler"})}const o=u.isSAPLegacyApplicationType(i.getApplicationType(),i.getFrameworkId());if(o){n.push({service:"sap.ushell.services.AppLifeCycle",action:"store"});n.push({service:"sap.ushell.services.AppLifeCycle",action:"restore"})}i.addBlueBoxCapabilities(n)}}}}},"sap.gui":{oServiceCalls:{loadFinished:{executeServiceCallFn:async function(e){const{oContainer:t}=e;if(!t.getIsKeepAlive()){t.setProperty("statefulType",a.STATEFUL_TYPES.GUI_V1,true);D={appId:t.getId(),stt:"loading",container:t,meta:undefined,app:undefined}}else{t.setProperty("statefulType",a.STATEFUL_TYPES.GUI_V1_KEEP_ALIVE,true)}return{}}}}}});i.getInstance().subscribe("sap.ushell","appComponentLoaded",this._onComponentCreated,this);i.getInstance().subscribe("sap.ushell","getAppLifeCycle",this._onGetMe,this);this._addEvents()};this.registerHandleHashChange=function(e){e.hashChanger.attachEvent("hashChanged",t=>{if(y.disableBlueBoxHashChangeTrigger){return}if(t.mParameters&&e.hashChanger.isInnerAppNavigation(t.mParameters.newHash,t.mParameters.oldHash)){o.postMessageToMultipleIframes("sap.ushell.appRuntime","innerAppRouteChange",{oHash:t.mParameters})}o.postMessageToMultipleIframes("sap.ushell.appRuntime","hashChange",{sHash:t.mParameters.fullHash})})};this._addApplicationContainerToViewPort=function(e){N.addCenterViewPort(e)};this._removeApplicationContainerFromViewPort=function(e){const t=a.getBlueBoxById(e);const i=a.isStatefulContainer(t);if(!i){N.removeCenterViewPort(e,true)}};this._getApplicationContainerFromViewPort=function(e){if(!N){return}return N.getViewPortControl("centerViewPort",`application-${e}`)||N.getViewPortControl("centerViewPort",`applicationShellPage-${e}`)};this._getViewPortContainer=function(){return N};this._navTo=function(e){N.navTo("centerViewPort",e,"show")};this.getCurrentApplication=function(){return D};this.unsetCurrentApplication=function(){D={}};this._setApplicationFullWidth=function(e){const t=this.getCurrentApplication();if(t.container){t.container.toggleStyleClass("sapUShellApplicationContainerLimitedWidth",!e)}};this.getShellUIService=function(){return K};this.resetGlobalShellUIService=function(){if(K){K.resetService()}};this._createGlobalShellUIService=async function(){K=await B.createInstanceInternal()};this._activeContainer=function(e){a.forEach(t=>{if(t&&t!==e){try{A.info(`Deactivating container ${t.getId()}`);t.setActive(false)}catch(e){}}});if(e){A.info(`Activating container "${e.getId()}"`);e.setActive(true)}};this._publishNavigationStateEvents=function(e,t,n){const a=e.getId?e.getId():"";const s=c.getMetadata();const o=s.icon;const r=s.title;e.addEventDelegate({onAfterRendering:n});const l=this;const u=e.exit;e.exit=function(){if(u){u.apply(this,arguments)}p._applyContentDensityByPriority();setTimeout(()=>{const e=h({},t);delete e.componentHandle;e.appId=a;e.usageIcon=o;e.usageTitle=r;i.getInstance().publish("sap.ushell","appClosed",e);A.info("app was closed")},0);const e=l._publicEventDataFromResolutionResult(t);S.publishExternalEvent("appClosed",e)}};this._publicEventDataFromResolutionResult=function(e){const t={};if(!e){return e}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(i=>{t[i]=e[i]});Object.freeze(t);return t};this._getInMemoryInstance=function(e,t,i,a){const s=`application-${e}`;const o=n.get(s);if(o){const e=i&&a;const n=o.shellHash===t;if(n&&!e){return{destroyApplication:false,appId:o.appId,container:o.container}}return{destroyApplication:true,appId:o.appId,container:o.container}}return{destroyApplication:true,appId:undefined,container:undefined}};this._handleOpenStateful=async function(e,t,i,o,r,l,p,c,u){o.setProperty("iframeReusedForApp",true,true);try{if(n.get(i)&&!e&&!u){await a.statefulRestoreKeepAliveApp(o,r.url,i,r,c)}else{const e=await a.statefulCreateApp(o,r.url,i,r,c);if(e?.deletedKeepAliveId){n.removeById(e.deletedKeepAliveId)}if(t&&!n.get(i)){this._storeApp(i,o,r,l,p)}}s.setActiveAppContainer(o);A.info("New application context opened successfully in an existing transaction UI session.")}catch(e){A.error(e?.message||e)}};this._isFullWidth=function(e){let t;const i=this._calculateAppType(e);const n=d.getDefaultFullWidthSetting(i);const a=e.appCapabilities?.fullWidth;const s=c.getMetadata(e);if(n){if(e.fullWidth===false||e.fullWidth==="false"||s.fullWidth===false||s.fullWidth==="false"||a===false){t=false}}else if(e.fullWidth||e.fullWidth==="true"||s.fullWidth||s.fullWidth==="true"){t=true}if(t===undefined){t=n}return t};this.handleCreateApplicationContainer=async function(e,t,s,o,l){let p=false;let f=false;const h=`application-${e}`;let g=false;let m=false;let C,y,I,S,v,T;I=a.getBlueBoxByUrl(s.url);if(a.isStatefulContainer(I)){S=(new Date).getTime()-I.getIsIframeValidTime().time;if(a.isIframeIsValidSupported(I)&&S>=3500||I.getIsInvalidIframe()){const e=I.getIsInvalidIframe()?`iframe did not ping in the last '${S}' ms`:"iframe is in invalid state";A.warning(`Destroying stateful container iframe due to unresponsiveness (${I.getId()})`,`reason: ${e}`,"sap.ushell.components.applicationIntegration.AppLifeCycle");a.removeCapabilities(I);await this._destroyApplication(h,I);a.deleteBlueBoxByUrl(s.url);I=undefined;o=undefined}}if(!l){const e=this.getCurrentApplication()?.container;y=a.isStatefulContainer(e);const t=e&&!!e.getCurrentAppId()&&a.isStatefulContainerInKeepAlivePool(e);if(y||t){await this._handleExitApplication(e,false,false);if(e===I){m=true}}}const w=this._calculateKeepAliveMode(h,s,t);const P=!!w;C=a.getBlueBoxByUrl(s.url);y=a.isStatefulContainer(C);if(!y){if(D&&h!==D.appId){C=undefined}T=n.get(h);C=T?.container;if(C&&P){v=true}}if(y){if(!C){C=await this._createApplicationContainer(e,t,s);const i=n.get(C.getId());if(i){D=i}g=true}}else if(C&&!P&&a.getStatefulContainerType(s.url,true)!==a.STATEFUL_TYPES.GUI_V1){await this._destroyApplication(C.getId(),C);C=await this._createApplicationContainer(e,t,s)}else if(!C){C=await this._createApplicationContainer(e,t,s);if(C.getIsFetchedFromCache()){if(C.getStatefulType()===a.STATEFUL_TYPES.GUI_V1_KEEP_ALIVE){f=true}else{y=true;p=true}}}await u.promisify(C.getDeffedControlCreation());if(C.getStatefulType()!==a.STATEFUL_TYPES.GUI_V1&&!y){if(v){i.getInstance().publish("launchpad","appOpening",s)}const e=n.get(C.getId());if(e){D=e}if(v){i.getInstance().publish("sap.ushell","appOpened",s)}}if(C.getApplicationType()===d.TR.type){this._activeContainer(C)}const E=n.get(h);if(E){_.restore(E)}else{_.flush()}if(y){if(s.appCapabilities?.appFrameworkId==="UI5"){C.setProperty("active",true,true)}await this._handleOpenStateful(g,P,h,C,s,t,w,m,p)}else if(C.getStatefulType()===a.STATEFUL_TYPES.GUI_V1||f){await r.guiStatefulCreateApp(this,C,s)}u.setPerformanceMark("FLP -- centerViewPort");if(C.getApplicationType()!==d.TR.type){this._activeContainer(C)}if(D.appId!==h){D={appId:h,stt:"loading",container:C,meta:c.getMetadata(s),app:undefined}}};this.navToCurrentApp=function(){const e=this.getCurrentApplication().container;this._navTo(e.getId());if(e.hasStyleClass("sapUShellApplicationContainerShiftedIframe")){e.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false)}else{e.toggleStyleClass("hidden",false)}};this.switchViewState=function(e,t,i,a){const s=n.get(D.appId);if(!s){E.destroyManagedControls()}const o=E.getShellMode();const r={TR:{headerless:L.Minimal}};let l;if(!a){l=r[i]?.[o]}E.switchState(e,l);const p=`application-${t}`;const c=n.get(p);if(c){U.restore(c)}else{U.flush()}E.applyStalledChanges()};this.registerShellCommunicationHandler=function(e){s.registerShellCommunicationHandler(e)};this._isFloatingContainerDocked=function(){const e=P.getModel().getProperty("/floatingContainer/state").includes("docked");const t=P.getModel().getProperty("/floatingContainer/visible");return e&&t};this._sendFocusBackToShell=function(){if(!e.system.desktop){return}sap.ui.require(["sap/ushell/renderer/AccessKeysHandler"],e=>{const i=E.getLaunchpadState();const n=E.getShellMode()===L.Default;const a=t.getElementById("shellAppTitle");if(a&&i===R.App&&n){const t=a.getFocusDomRef();if(t){e.sendFocusBackToShell(t.getAttribute("id"))}}})};this._announceAppOpening=function(e){window.setTimeout(()=>{window.setTimeout(()=>{const e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=w.i18n.getText("loadingComplete");window.setTimeout(()=>{e.setAttribute("aria-live","off");e.innerHTML=""},0)}},600);i.getInstance().publish("launchpad","appOpening",e);A.info("app is being opened")},0)};this._createApplicationContainer=async function(e,t,i){const n=c.getMetadata(i,i?.sFixedShellHash);const a=this._isFullWidth(i);i.targetNavigationMode=u.isColdStart()?"explace":"inplace";i.shellUIService=K.getInterface();this._sendFocusBackToShell();this._announceAppOpening(i);await this._openApp(e,i,t);const s=D.container;const o=s.getIsFetchedFromCache();if(!o){this._publishNavigationStateEvents(s,i,this.onAppAfterRendering.bind(this,i));if(u.isSAPLegacyApplicationType(s.getApplicationType(),s.getFrameworkId())){s.addStyleClass("sapUShellApplicationContainerShiftedIframe")}if(!a){s.addStyleClass("sapUShellApplicationContainerLimitedWidth")}if(this._isFloatingContainerDocked()&&window.matchMedia("(min-width: 106.4rem)").matches){s.addStyleClass("sapUShellDockingContainer");s.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}else if(this._isFloatingContainerDocked()){s.removeStyleClass("sapUShellApplicationContainerLimitedWidth")}s.toggleStyleClass("sapUshellDefaultBackground",!n.hideLightBackground);p._applyContentDensityByPriority();this._addApplicationContainerToViewPort(s)}u.setPerformanceMark("FLP - addAppContainer");return s};this.handleBeforeCreateApp=async function(e,t,i,n){const a=C.getBasicHash(e);const s=!!t?.componentHandle;const o=t?.ui5ComponentName;const r=this._getInMemoryInstance(a,e,i,n);if(!r.destroyApplication){}else if(s||!o){if((t.applicationType==="URL"||u.isSAPLegacyApplicationType(t.applicationType))&&r.destroyApplication&&r.appId){await this._destroyApplication(r.appId,r.container)}}else{await this._destroyApplication(r.appId,r.container);const e=this._getApplicationContainerFromViewPort(a);if(e){this._removeApplicationContainerFromViewPort(e.getId());e.destroy()}await this._closeKeepAliveApps(e=>e.ui5ComponentName===t.ui5ComponentName)}};this.handleCreateApp=async function(e,t,n,a,o){const r=C.getBasicHash(e);const l=!!n?.componentHandle;const p=n?.ui5ComponentName;const u=!!p;const f=this._getInMemoryInstance(r,e,a,o);if(u&&!l&&f.destroyApplication){c.setApplicationInInitMode();i.getInstance().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:p});await T.getServiceAsync("Ui5ComponentLoader");await s.createComponent(n,t)}};this.onAppAfterRendering=function(e){window.setTimeout(()=>{i.getInstance().publish("sap.ushell","appOpened",e);A.info("app was opened")},0);const t=this._publicEventDataFromResolutionResult(e);m.emit("AppRendered",t,true);S.publishExternalEvent("appOpened",t);u.setPerformanceMark("FLP.appOpened");const n=p.getAppIcon();E.updateCurrentState("application.icon",M.Set,n)};this.setViewPortContainer=function(e){N=e}}return new H},true);
//# sourceMappingURL=AppLifeCycle.js.map