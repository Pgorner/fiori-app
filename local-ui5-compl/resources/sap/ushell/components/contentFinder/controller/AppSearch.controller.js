// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["./ContentFinderDialog.controller","../model/formatter","sap/ushell/Config","sap/base/Log","sap/m/library","sap/ushell/utils/WindowUtils","sap/ui/thirdparty/hasher","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/f/library"],function(e,t,i,o,s,n,l,a,r,d){"use strict";const u=d.LayoutType;const c=s.ListType;return e.extend("sap.ushell.components.contentFinder.controller.AppSearch",{formatter:t,onInit:function(){this.oComponent=this.getOwnerComponent();this.oResourceBundle=this.oComponent.getModel("i18n").getResourceBundle();this.oUiModel=this.oComponent.getUiModel();this.oDataModel=this.oComponent.getDataModel();this.oSelectionModel=this.oComponent.getSelectionModel();this.byId("contentFinderAppSearchFlexibleColumnLayout").attachStateChange(this.onFlexibleColumnLayoutStateChange.bind(this));this.getView().setModel(this.oUiModel,"ui");this._initializeVisualizationsFilter()},onFlexibleColumnLayoutStateChange:function(e){this.oUiModel.setProperty("/maxColumnsCount",e.getParameter("maxColumnsCount"))},onSelectVisualizationsFilter:function(){this.oComponent.resetVisualizations();this.oComponent.queryVisualizations(0,this.oUiModel.getProperty("/visualizations/searchTerm"),this.oUiModel.getProperty("/categoryTree/selectedId"))},onSearch:function(e){const t=e.getParameter("query")||"";this.sCurrentSearchTerm=t;this.oComponent.resetVisualizations();this.toggleSelectionView(false);const i=this.oUiModel.getProperty("/categoryTree/selectedId");this.oComponent.queryVisualizations(0,t,i);this.oUiModel.setProperty("/visualizations/searchTerm",t)},onCatalogSearch:async function(e){const t=e.getParameter("newValue")||"";const i=new a("title",r.Contains,t);const o=new a("contentProviderId",r.Contains,t);const s=new a("contentProviderLabel",r.Contains,t);const n=new a({filters:[i,o,s],and:false});this.byId("CategoryTreeFragment--CategoryTree").getBinding().filter(n)},onAppBoxSelected:function(e){if(e.getSource().getMode()===s.ListMode.SingleSelectMaster){const t=e.getParameter("listItem").getBindingContext("data").getObject();this.oComponent.addVisualizations([t])}else{const t=e.getParameter("selected");const i=e.getParameter("listItems").map(e=>{const t=e.getBindingContext("data");const i=t.getPath().split("/");const o=parseInt(i[i.length-1],10);return{...t.getObject(),index:o}});const o=this.oSelectionModel.getProperty("/visualizations/items");let s;if(t){s=[...o,...i]}else{s=o.filter(e=>!i.some(t=>t.id===e.id))}s.sort((e,t)=>e.index<t.index?-1:1);this.oSelectionModel.setProperty("/visualizations/items",s);if(!this.oSelectionModel.getProperty("/visualizations/items/length")){this.toggleSelectionView(false)}}},onUpdateStarted:function(e){if(e.getParameter("reason")==="Growing"){const t=this.oUiModel.getProperty("/visualizations/searchTerm");const i=e.getParameter("actual");const o=this.oUiModel.getProperty("/categoryTree/selectedId");this.oComponent.queryVisualizations(i,t,o)}},onShowSelectedPressed:function(e){const t=e.getParameter("pressed");this.toggleSelectionView(t)},onViewSelectionChange:function(e){const t=e.getSource().getSelectedKey();const i=t==="list";this.oUiModel.setProperty("/visualizations/listView",i);this.toggleSelectionView(this.oUiModel.getProperty("/visualizations/showSelectedPressed"))},toggleSelectionView:function(e){const t=e?"":this.sCurrentSearchTerm;this.oUiModel.setProperty("/visualizations/searchFieldValue",t);this.oUiModel.setProperty("/visualizations/showSelectedPressed",e);this.oComponent.useSelectionModel(e)},resetVisualizationsSearchField:function(){this.oUiModel.setProperty("/visualizations/searchTerm","");this.oUiModel.setProperty("/visualizations/searchFieldValue","");this.sCurrentSearchTerm=""},onCategoryTreeItemPressed:function(e){const t=e.getParameter("listItem");if(t.getType()===c.Inactive){return}this.oComponent.updateSidebarStatus(u.TwoColumnsMidExpanded);this.getOwnerComponent().resetVisualizations();this.resetVisualizationsSearchField();this.toggleSelectionView(false);const i=t.getBindingContext().getProperty("id");const o=t.getBindingContext().getProperty("title");this.oUiModel.setProperty("/categoryTree/selectedId",i);this.oUiModel.setProperty("/categoryTree/selectedTitle",o);this.getOwnerComponent().queryVisualizations(0,"",i);if(t.getBindingContext().sPath.includes("nodes")){this.oUiModel.setProperty("/categoryTree/itemPressed",true)}else{this.oUiModel.setProperty("/categoryTree/itemPressed",false)}let s=t.getBindingContext().getProperty("allowedFilters");let n=t.getBindingContext().getProperty("filterIsTitle");if(!s){s=t.getParentNode()?.getBindingContext().getProperty("allowedFilters");n=t.getParentNode()?.getBindingContext().getProperty("filterIsTitle")}this.oUiModel.setProperty("/visualizations/filters/displayed",s);this.oUiModel.setProperty("/visualizations/filters/filterIsTitle",!!n)},onCategoryTreeUpdateFinished:function(e){const t=e.getSource();if(!t.getSelectedItem()){const e=t.getItems();const i=e[0];if(i){t.setSelectedItem(i);const e=i.getBindingContext().getObject()||{};this.oUiModel.setProperty("/categoryTree/selectedId",e.id);this.oUiModel.setProperty("/categoryTree/selectedTitle",e.title)}}},onCategoryTreeTogglePressed:function(){const e=this.oUiModel.getProperty("/layoutType");const t=this.oUiModel.getProperty("/maxColumnsCount");let i;if(e===u.MidColumnFullScreen){if(t>1){i=u.TwoColumnsMidExpanded}else{i=u.OneColumn}}else if(e===u.TwoColumnsMidExpanded&&t===1){i=u.OneColumn}else if(e===u.TwoColumnsMidExpanded){i=u.MidColumnFullScreen}else{i=u.TwoColumnsMidExpanded}this.oComponent.updateSidebarStatus(i)},onLaunchApplicationPressed:function(e){const t=e.getSource().getBindingContext("data").getObject().launchUrl;if(!t){o.info("AppBox url property is not set.",null,"sap.ushell.components.Catalog.controller");return}if(t.indexOf("#")===0){l.setHash(t)}else{n.openURL(t,"_blank")}},onUpdateVisualizationsFilterData:function(){this.iVisualizationsFilterDataTimeout=this.iVisualizationsFilterDataTimeout||setTimeout(()=>{this._updateVisualizationsFilter();this.iVisualizationsFilterDataTimeout=null},0)},_initializeVisualizationsFilter:function(){this.oVisualizationsFilterInitialBinding=this.oUiModel.bindProperty("/visualizations/filters/displayed");this.oVisualizationsFilterAvailableBinding=this.oUiModel.bindProperty("/visualizations/filters/available");this.oVisualizationsFilterInitialBinding.attachChange(this.onUpdateVisualizationsFilterData,this);this.oVisualizationsFilterAvailableBinding.attachChange(this.onUpdateVisualizationsFilterData,this);this._updateVisualizationsFilter()},_updateVisualizationsFilter:function(){this.byId("selectVisualizationsFilter")?.getBinding("items")?.filter(new a((this.oUiModel.getProperty("/visualizations/filters/displayed")||[]).map(e=>new a("key",r.EQ,e))))}})});
//# sourceMappingURL=AppSearch.controller.js.map