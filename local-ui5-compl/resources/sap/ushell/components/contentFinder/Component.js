//Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/core/UIComponent","sap/ushell/components/contentFinder/model/GraphQLModel","sap/ui/model/json/JSONModel","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/Config","sap/f/library"],function(e,t,i,o,s,a,n,l,r){"use strict";const d=r.LayoutType;return o.extend("sap.ushell.components.contentFinder.Component",{metadata:{manifest:"json",library:"sap.ushell",interfaces:["sap.ui.core.IAsyncContentCreation"],properties:{enablePersonalization:{type:"boolean",defaultValue:true,group:"Behavior"},noItemsInCatalogDescription:{type:"string",defaultValue:"",group:"Appearance"},showAppBoxFieldsPlaceholder:{type:"boolean",defaultValue:true,group:"Appearance"},showCategoryTreeWhenEmpty:{type:"boolean",defaultValue:true,group:"Appearance"},showApplicationLaunchButton:{type:"boolean",defaultValue:false,group:"Appearance"}},events:{visualizationFilterApplied:{allowPreventDefault:true,parameters:{types:{type:"string[]"},searchTerm:{type:"string"},pagination:{type:{skip:"integer",top:"integer"}},filter:{type:"any"},categoryId:{type:"string"}}},contentFinderClosed:{parameters:{}},widgetSelected:{parameters:{widgetId:{type:"string"}}},visualizationsAdded:{parameters:{visualizations:{type:"object[]"}}}}},logComponent:"sap.ushell.components.ContentFinder.Component",init:function(){o.prototype.init.apply(this,arguments);this.oResourceBundle=this.getModel("i18n").getResourceBundle();this.setModel(this.getUiModel(),"ui");this.setModel(this.getDataModel());this.setModel(this.getDataModel(),"data");this.setModel(this.getSelectionModel(),"selection");this.initializeUiModel(false);this.initializeDataModel();this.initializeSelectionModel();this._initializeSidebarStatus();const e=this.getComponentData();if(e?.visualizationFilters){this.setVisualizationsFilters(e.visualizationFilters)}this.oRestrictedVisualizationsMap=new Map;this._bLoading=false},setVisualizationsFilters:function(e){const t=this.getUiModel();if(e?.available){t.setProperty("/visualizations/filters/available",e.available)}if(e?.displayed){t.setProperty("/visualizations/filters/displayed",e.displayed)}if(e?.selected){t.setProperty("/visualizations/filters/selected",e.selected)}},getUiModel:function(){if(!this.oUiModel){this.oUiModel=new a}return this.oUiModel},getDataModel:function(){if(!this.oDataModel){this.oDataModel=new s;this.oDataModel.setSizeLimit(Infinity)}return this.oDataModel},getSelectionModel:function(){if(!this.oSelectionModel){this.oSelectionModel=new a;this.oSelectionModel.setSizeLimit(Infinity)}return this.oSelectionModel},_setComponentSettingsProperty:function(e,t){this.setProperty(e,t);this.getModel("ui").setProperty("/componentSettings/"+e,t);return this},setEnablePersonalization:function(e){return this._setComponentSettingsProperty("enablePersonalization",!!e)},setNoItemsInCatalogDescription:function(e){return this._setComponentSettingsProperty("noItemsInCatalogDescription",e)},setShowAppBoxFieldsPlaceholder:function(e){return this._setComponentSettingsProperty("showAppBoxFieldsPlaceholder",!!e)},setShowCategoryTreeWhenEmpty:function(e){return this._setComponentSettingsProperty("showCategoryTreeWhenEmpty",!!e)},setShowApplicationLaunchButton:function(e){return this._setComponentSettingsProperty("showApplicationLaunchButton",!!e)},setCategoryTree:function(t){const i=this.getDataModel();if(!Array.isArray(t)){e.error("Category tree data must be an array.");t=[]}i.setProperty("/categoryTree",t)},queryVisualizations:function(e,t,i){const o=this.getUiModel();const s=o.getProperty("/visualizations/filters/selected");const a=o.getProperty("/visualizations/filters/available");const n=a.find(e=>e.key===s);if(!this._bLoading){this._bLoading=true;o.setProperty("/visualizations/loaded",false);this.fireEvent("visualizationFilterApplied",{pagination:{skip:e||0,top:o.getProperty("/visualizations/growingThreshold")},types:n?.types||[],search:t||null,categoryId:i||null})}},setVisualizationData:function(e,o=false){const s=i.get("visualizations.nodes",e)||[];const a=i.get("visualizations.totalCount",e)||0;const n=this.getDataModel();const l=this.getUiModel();const r=this._prepareVisualizations(s);let d;if(o){d=[]}else{d=n.getProperty("/visualizations/items")}n.setProperty("/visualizations/items",d.concat(t([],r)));n.setProperty("/visualizations/totalCount",a);l.setProperty("/visualizations/loaded",true);this._bLoading=false},setContextData:function(e){const o=i.get("restrictedVisualizations",e)||[];const s=this.getDataModel();this.oRestrictedVisualizationsMap.clear();o.forEach(e=>{this.oRestrictedVisualizationsMap.set(e,true)});s.setProperty("/visualizations/restrictedItems",t([],o))},addVisualizations:function(e){if(e.length>0){this.fireEvent("visualizationsAdded",{visualizations:e})}},triggerContentFinderClosed:function(){this.fireEvent("contentFinderClosed")},triggerWidgetSelected:function(e){if(e){this.fireEvent("widgetSelected",{widgetId:e})}},resetAppSearch:function(){this.initializeUiModel(true);this.initializeSelectionModel();this.useSelectionModel(false);this.updateSidebarStatus()},useSelectionModel:function(e){let t;if(e){t=this.getSelectionModel()}else{t=this.getDataModel()}this.setModel(t,"data")},initializeUiModel:function(e=false){const t=this.getUiModel();let i;if(e){i={preservedLayoutType:t.getProperty("/preservedLayoutType"),categoryTree:t.getProperty("/categoryTree"),visualizations:{filters:t.getProperty("/visualizations/filters"),listView:t.getProperty("/visualizations/listView")}}}t.setData({layoutType:d.TwoColumnsMidExpanded,preservedLayoutType:d.TwoColumnsMidExpanded,maxColumnsCount:2,componentSettings:{enablePersonalization:this.getEnablePersonalization(),noItemsInCatalogDescription:this.getNoItemsInCatalogDescription(),showAppBoxFieldsPlaceholder:this.getShowAppBoxFieldsPlaceholder(),showCategoryTreeWhenEmpty:this.getShowCategoryTreeWhenEmpty(),showApplicationLaunchButton:this.getShowApplicationLaunchButton()},categoryTree:{hasData:false,itemPressed:false,selectedId:undefined,selectedTitle:undefined,visible:true},visualizations:{appliedSearchTerm:"",filters:{displayed:[],filterIsTitle:true,selected:"tiles",available:[]},growingThreshold:100,listView:false,loaded:false,searchFieldValue:"",searchTerm:"",showSelectedPressed:false}});if(e){t.setData(i,true)}},initializeDataModel:function(){this.getDataModel().setData({categoryTree:[],visualizations:{items:[],totalCount:0,restrictedItems:[]}})},initializeSelectionModel:function(){this.getSelectionModel().setData({visualizations:{items:[],totalCount:0,restrictedItems:[]}})},resetVisualizations:function(){const e=this.getDataModel();e.setProperty("/visualizations/items",[]);e.setProperty("/visualizations/totalCount",0)},_initializeSidebarStatus:function(){const e=this.getDataModel();const t=this.getUiModel();this.oCategoryTreeLengthBinding=e.bindProperty("/categoryTree/length");this.oShowCategoryTreeWhenEmptyBinding=t.bindProperty("/componentSettings/showCategoryTreeWhenEmpty");this.oMaxColumnsCountBinding=t.bindProperty("/maxColumnsCount");this.oVisualizationsFilterSelectedBinding=t.bindProperty("/visualizations/filters/selected");[this.oCategoryTreeLengthBinding,this.oShowCategoryTreeWhenEmptyBinding,this.oMaxColumnsCountBinding,this.oVisualizationsFilterSelectedBinding].forEach(e=>e.attachChange(this.onUpdateSidebarStatus,this));this.updateSidebarStatus()},onUpdateSidebarStatus:function(){this.iUpdateSidebarStatusTimeout=this.iUpdateSidebarStatusTimeout||setTimeout(()=>{this.updateSidebarStatus();this.iUpdateSidebarStatusTimeout=null},0)},updateSidebarStatus:function(e){const t=this.getDataModel();const i=this.getUiModel();const o=i.getProperty("/maxColumnsCount");const s=t.getProperty("/categoryTree")?.length>0;const a=i.getProperty("/componentSettings/showCategoryTreeWhenEmpty");const n=i.getProperty("/visualizations/filters/selected");let l;if(n==="cards"){l=d.MidColumnFullScreen}else if(e){l=e}else if(a||s){l=i.getProperty("/preservedLayoutType");if(l===d.OneColumn&&o>1){l=d.TwoColumnsMidExpanded}}else{l=d.MidColumnFullScreen}let r=true;if(l===d.TwoColumnsMidExpanded&&o===1||l===d.MidColumnFullScreen){r=false}if(e&&e!==d.OneColumn){i.setProperty("/preservedLayoutType",e)}i.setProperty("/layoutType",l);i.setProperty("/categoryTree/hasData",s);i.setProperty("/categoryTree/visible",r)},_prepareVisualizations:function(t){return t.reduce((t,o)=>{if(!o?.descriptor||!o?.descriptor?.value){e.error("No descriptor available. Cannot load this visualization.",null,this.logComponent);return t}const s=o.descriptor.value["sap.app"];const a=o.descriptor.value["sap.fiori"];let l="";if(a?.registrationIds[0]){l=a.registrationIds[0]}else if(s?.id){l=s.id}let r;if(o.targetAppIntent){r=n.toHashFromTargetIntent(o.targetAppIntent,o.descriptor.value["sap.flp"]?.target)}t.push({id:o.id,appId:l,icon:i.get("icons.icon",o.descriptor.value["sap.ui"])||"",info:s&&s.info||"",launchUrl:r||"",subtitle:s&&s.subTitle||"",title:s&&s.title||"",type:o.type,dataHelpId:o.id,vizData:o,added:false,systemLabel:o.systemLabel||""});return t},[])}})});
//# sourceMappingURL=Component.js.map