// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils/UriParameters","sap/ui/core/RenderManager","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/utils","sap/ushell/resources","sap/ushell/Config","sap/ushell/Container","sap/ushell/ApplicationType/systemAlias"],function(e,t,jQuery,a,r,i,s,n,l){"use strict";var o={};var p=o;o.renderIframeWithPOST=function(e,a,i,s){a.setProperty("iframeWithPost",true,true);a.oDeferredRenderer=new jQuery.Deferred;i=r.filterOutParamsFromLegacyAppURL(i);var l=r.getParamKeys(i);this.generateRootElementForIFrame(e,a,true);if(l.aAppStateNamesArray.length>0){n.getServiceAsync("Navigation").then(function(r){r.getAppStateData(l.aAppStateKeysArray).then(function(r){var n;var o=jQuery("#"+a.getId());if(o.length>0){n=(new t).getInterface();p.buildHTMLElements(n,a,r,l.aAppStateNamesArray,i,s);n.flush(o[0]);n.destroy()}else{p.buildHTMLElements(e,a,r,l.aAppStateNamesArray,i,s)}setTimeout(a.oDeferredRenderer.resolve,0)},function(t){p.buildHTMLElements(e,a,undefined,l.aAppStateNamesArray,i,s);setTimeout(a.oDeferredRenderer.resolve,0)})})}else{p.buildHTMLElements(e,a,undefined,l.aAppStateNamesArray,i,s);setTimeout(a.oDeferredRenderer.resolve,0)}this.generateRootElementForIFrame(e,a,false)};o.generateRootElementForIFrame=function(e,t,a){if(a){e.openStart("div",t).attr("sap-iframe-app","true").class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth()).openEnd()}else{e.close("div")}};o.buildHTMLElements=function(t,o,p,d,m,h){var g=o.getId()+"-form",c="",y=false;if(p===undefined){p=[]}p.push(n.getFLPUrl(true));d.push("sap-flp-url");p.push(o.getSystemAlias());d.push("system-alias");var v="";var A={};d.forEach(function(e,t){if(p[t]||e==="system-alias"){A[e]=p[t]}});var S=l.addSystemAlias(m,o);v=JSON.stringify(A);var I={};if(o.getIframePostAllParams()===true){I=e.fromURL(m);c=f(o,I,false);if(c!==""){m=u(m,I)}}o.fireEvent("applicationConfiguration");t.openStart("form").attr("id",g).attr("method","post").attr("name",g).attr("target",o.getId()+"-iframe").attr("action",m).style("display","none").openEnd();t.voidStart("input").attr("name","sap-flp-params").attr("value",v).voidEnd();if(o.getIframePostAllParams()===true){f(o,I,true,t)}t.close("form");var E=o.sId;if(o.hasStyleClass("sapUShellApplicationContainerIframeHidden")){y=true;o.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false)}o.sId+="-iframe";t.openStart("iframe",o).attr("name",o.getId()).accessibilityState(o).attr("sap-orig-src",S).attr("title",i.i18n.getText("AppilcationContainer.IframeTitle")).attr("sap-iframe-idx",h).class("sapUShellApplicationContainer").style("height",o.getHeight()).style("width",o.getWidth());if(s.last("/core/shell/enableFeaturePolicyInIframes")===true){t.attr("allow",r.getIframeFeaturePolicies().replaceAll(";"," "+new a(m).origin()+";"))}t.openEnd().close("iframe");o.sId=E;if(y){o.toggleStyleClass("sapUShellApplicationContainerIframeHidden",true)}};function f(e,t,a,r){var i="";var s="";if(t.has("sap-iframe-hint")){i=t.get("sap-iframe-hint")}var n=t.mParams;if(e.getApplicationType()==="TR"||i==="GUI"){var l,o;for(l in n){if(l==="sap-iframe-hint"||l==="sap-keep-alive"){continue}o=n[l][0];if(a===true){r.voidStart("input").attr("name",l).attr("value",o).voidEnd()}else{s+="*"}}}return s}function u(e,t){var r=t.get("sap-iframe-hint"),i=t.get("sap-keep-alive"),s=new a(e).query("");if(typeof r==="string"){s.addSearch("sap-iframe-hint",r)}if(typeof i==="string"){s.addSearch("sap-keep-alive",i)}return s.toString()}return o},false);
//# sourceMappingURL=IframePOSTUtils.js.map