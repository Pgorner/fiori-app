// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/tnt/NavigationListItem","sap/ui/core/CustomData","sap/ui/core/EventBus","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ushell/Container","sap/ushell/EventHub","sap/ushell/utils/UrlParsing","sap/ushell/utils/WindowUtils"],function(e,t,i,n,a,o,s,r,d,u,c){"use strict";return a.extend("sap.ushell.components.shell.SideNavigation.controller.SideNavigation",{onInit:function(){const e=this.byId("sideNavigation");if(o.support.touch){e.addStyleClass("sapUiSizeCozy")}else{e.addStyleClass("sapUiSizeCompact")}this.oContainerRouter=r.getRendererInternal().getRouter();this.oContainerRouter.getRoute("home").attachMatched(this._selectIndexAfterRouteChange,this);this.oContainerRouter.getRoute("openFLPPage").attachMatched(this._selectIndexAfterRouteChange,this);this.oContainerRouter.getRoute("openWorkPage").attachMatched(this._selectIndexAfterRouteChange,this);this._addHamburgerButton();this.oEnableMenuBarNavigationListener=d.on("enableMenuBarNavigation").do(e=>this.onEnableSideNavigation(e));n.getInstance().subscribe("sap.ushell","appOpened",this.deselectSideNavigationEntryOnAppOpened,this);this.sNoneSelectedKey="NONE";const t=new s({selectedKey:this.sNoneSelectedKey,enableSideNavigation:true});this.getView().setModel(t,"viewConfiguration");this.oGetDefaultSpacePromise=r.getServiceAsync("Menu").then(function(e){return e.getDefaultSpace()});this._selectIndexAfterRouteChange()},deselectSideNavigationEntryOnAppOpened:function(){this.getView().getModel("viewConfiguration").setProperty("/selectedKey",this.sNoneSelectedKey)},onEnableSideNavigation:function(e){this.getView().getModel("viewConfiguration").setProperty("/enableSideNavigation",e)},onSideNavigationItemSelection:function(e){const t=e.getParameter("item").getProperty("key");const i=this.getView().getModel("sideNavigation");let n=i.getProperty("/");const a=this._getNestedSideNavigationEntryByUid(n,t);if(a.type==="IBN"){this._performNavigation(a.target)}else if(a.type==="URL"){this._openURL(a.target)}},_getNestedSideNavigationEntry:function(e,t){return e.reduce((e,i)=>{if(e){return e}if(t(i)){return i}if(i.menuEntries){return this._getNestedSideNavigationEntry(i.menuEntries,t)}},undefined)},_getNestedSideNavigationEntryByUid:function(e,t){function i(e){return e.uid===t}return this._getNestedSideNavigationEntry(e,i)},_sideNavigationFactory:function(e,n){let a=n.getProperty("icon");if(!a&&this._isTopLevelEntry(n)){a="sap-icon://document-text"}const o=new t(e,{key:"{sideNavigation>uid}",icon:a,text:"{sideNavigation>title}",enabled:"{viewConfiguration>/enableSideNavigation}",items:{path:"sideNavigation>menuEntries",factory:this._sideNavigationFactory.bind(this)},customData:[new i({key:"help-id",value:"{= 'MenuEntry-' + ${sideNavigation>help-id}}",writeToDom:"{= !!${sideNavigation>help-id}}"})]});return o},_isTopLevelEntry:function(e){return e.getPath().split("/").length===2},_performNavigation:function(e){return r.getServiceAsync("Navigation").then(function(t){const i={};e.parameters.forEach(function(e){if(e.name&&e.value){i[e.name]=[e.value]}});t.navigate({target:{semanticObject:e.semanticObject,action:e.action},params:i})})},_openURL:function(e){c.openURL(e.url,"_blank")},_selectIndexAfterRouteChange:function(){const t=this.getView().getModel("viewConfiguration");return Promise.all([this.oGetDefaultSpacePromise,this.getOwnerComponent().oMenuModelPromise]).then(i=>{const n=i[0];let a;const o=window.hasher.getHash();const s=u.parseShellHash(o);const r=this.getView().getModel("sideNavigation").getProperty("/");if(s.semanticObject==="Shell"&&s.action==="home"){const e=n&&n.children&&n.children[0];a=e?this._getMenuUID(r,n.id,e.id)||"":"";t.setProperty("/selectedKey",a)}else{const i=e.get("params.spaceId.0",s);const n=e.get("params.pageId.0",s);const o=t.getProperty("/selectedKey");const d=this._getNestedSideNavigationEntryByUid(r,o);if(this._hasSpaceIdAndPageId(d,i,n)){a=d.uid}else{a=this._getMenuUID(r,i,n)}if(a){t.setProperty("/selectedKey",a)}else{t.setProperty("/selectedKey",this.sNoneSelectedKey)}}})},_getMenuUID:function(e,t,i){function n(e){return this._hasSpaceIdAndPageId(e,t,i)}const a=this._getNestedSideNavigationEntry(e,n.bind(this));return a&&a.uid},_hasSpaceIdAndPageId:function(t,i,n){const a=e.get("target.parameters",t)||[];const o=a.some(function(e){return e.name==="spaceId"&&e.value===i});const s=a.some(function(e){return e.name==="pageId"&&e.value===n});return o!==false&&s!==false},onCollapseSideNavigationPress:function(){const e=this.getView().byId("sideNavigation");e.setExpanded(!e.getExpanded())},_hamburgerButtonFatory:async function(){const e=this.getOwnerComponent().getModel("i18n").getResourceBundle();const t=e.getText("ShellBar.SideNavigation.Button.Tooltip");const i=e.getText("ShellBar.SideNavigation.Button.Text");const n=await r.getServiceAsync("Extension");return await n.createHeaderItem({id:"sideMenuExpandCollapseBtn",ariaLabel:t,ariaHaspopup:"dialog",icon:"sap-icon://menu2",tooltip:t,text:i,press:this.onCollapseSideNavigationPress.bind(this)},{position:"begin"})},_addHamburgerButton:async function(){this.headerHamburgerButtonItemStart=await this._hamburgerButtonFatory();this.headerHamburgerButtonItemStart.showOnHome();this.headerHamburgerButtonItemStart.showForAllApps()},onExit:function(){this.oEnableMenuBarNavigationListener.off();n.getInstance().unsubscribe("sap.ushell","appOpened",this.deselectSideNavigationEntryOnAppOpened,this)}})});
//# sourceMappingURL=SideNavigation.controller.js.map