// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ushell/utils/workpage/WorkPageService","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/components/contentFinder/CatalogService","sap/ushell/Container","sap/ushell/EventHub","sap/ushell/resources","sap/base/Log"],function(e,t,n,i,o,a,s,r){"use strict";return e.extend("sap.ushell.components.contentFinderStandalone.controller.ContentFinderStandalone",{onInit:function(){this.oWorkPageService=new t;this.oCatalogService=new i;this.oResourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.oShellUIService=n.getShellUIService();this.oRouter=o.getRendererInternal().getRouter();this.oRouter.getRoute("appfinder").attachMatched(this._handleContentFinderNavigation.bind(this))},_handleContentFinderNavigation:function(){this.oShellUIService.setTitle(s.i18n.getText("appFinderTitle"))},appSearchComponentCreated:async function(e){this.oComponent=e.getParameter("component");a.emit("CenterViewPointContentRendered");this.oComponent.attachVisualizationFilterApplied(null,this._onVisualizationFilterApplied,this);this.oWorkPageService.loadVisualizations({}).then(e=>{this.oComponent.setVisualizationData(e)});this.setCategoryTree();const t=new URL(location.href);t.searchParams.append("sap-ushell-xx-overwrite-config","/core/workPages/contentFinderStandalone:false");this.oComponent.getUiModel().setProperty("/linkToAppFinder",t.toString())},setCategoryTree:async function(){let e;try{e=await this.oCatalogService.getCatalogs()}catch(e){r.error("Catalog fetching failed with:"+JSON.stringify(e));return}let t=[];if(e?.catalogs?.length>0){t=[{id:undefined,title:this.oResourceBundle.getText("ContentFinderStandalone.CategoryTree.Category.AllTiles"),filterIsTitle:true,inactive:false,allowedFilters:["tiles"]},{id:"$$catalogs",title:this.oResourceBundle.getText("ContentFinderStandalone.CategoryTree.Category.Catalogs"),inactive:true,filterIsTitle:false,nodes:e?.catalogs,$count:e?.totalCount,allowedFilters:["tiles"]}]}this.oComponent.setCategoryTree(t)},_onVisualizationFilterApplied:async function(e){const t=this._transformFilterParams(e.getParameters());let n;const i=e.getParameter("categoryId");if(i){n=await this.oCatalogService.loadVisualizations(i,t)}else{n=await this.oWorkPageService.loadVisualizations(t)}this.oComponent.setVisualizationData(n)},_transformFilterParams:function(e){const t=e?.pagination?.top;const n=e?.pagination?.skip;const i=e?.search;const o=e?.types||[];const a=o.length>0?[{in:o}]:[];const s=i?{type:a,descriptor:[{conditions:[{propertyPath:"/sap.app/title",stringFilter:[{containsIgnoreCase:i}]}]},{conditions:[{propertyPath:"/sap.app/subTitle",stringFilter:[{containsIgnoreCase:i}]}]},{conditions:[{propertyPath:"/sap.app/info",stringFilter:[{containsIgnoreCase:i}]}]},{conditions:[{propertyPath:"/sap.fiori/registrationIds",anyFilter:[{conditions:[{stringFilter:[{containsIgnoreCase:i}]}]}]}]}]}:{type:a};return{top:t,skip:n,filter:[s]}}})});
//# sourceMappingURL=ContentFinderStandalone.controller.js.map