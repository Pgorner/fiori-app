// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/base/Log","sap/base/util/deepEqual","sap/base/util/merge","sap/ushell/TechnicalParameters"],function(e,t,r,n,a){"use strict";const i={};var s=/^(([A-Za-z0-9_/]+)-([A-Za-z0-9_/-]+)(~([A-Z0-9a-z=+/]+))?)?([?]([^&]|(&[^/]))*&?)?$/;i.getShellHash=function(e){var t=/[^#]*#(([^&]|&[^/])*)(&\/.*)?/,r=t.exec(e);if(r){return r[1]}return undefined};i.getHash=function(e){var t=/#(.*)/,r=t.exec(e);if(r){return r[1]}return undefined};i.isIntentUrl=function(e){return this._isIntentUrl(e,window.location.href)};i.isIntentUrlAsync=function(e){return new Promise(function(e,t){sap.ui.require("sap/ushell/Container").getFLPUrlAsync(true).done(e).fail(t)}).then(function(t){return this._isIntentUrl(e,t)}.bind(this))};i._isIntentUrl=function(t,r){var n=/^#/,a,s,o,c,u,p;if(typeof t!=="string"){return false}if(!n.test(t)){a=new e(t).normalize();o=a.protocol()+"://"+a.host()+a.pathname();s=new e(r).normalize();c=s.protocol()+"://"+s.host()+s.pathname();if(o!==c){return false}}u=i.getHash(t);if(!u){return false}p=i.parseShellHash(u);if(p&&p.semanticObject&&p.action){return true}return false};i.parseParameters=function(e){try{var r=new URLSearchParams(e);var n=r.keys();var a=n.next();var i={};while(a.done===false){i[decodeURIComponent(a.value)]=r.getAll(a.value);a=n.next()}return i}catch(r){t.error("URL parsing - malformed URL parameters string:",e);return{}}};function o(e,t,r){var n,a,i,s,o,c="";t=t||"&";r=r||"=";n="";a=null;o=[];for(a in e){if(e.hasOwnProperty(a)){o.push(a)}}o.sort();for(i=0;i<o.length;i=i+1){a=o[i];if(Array.isArray(e[a])){for(s=0;s<e[a].length;s=s+1){c+=n+encodeURIComponent(a)+r+encodeURIComponent(e[a][s]);n=t}}else{c+=n+encodeURIComponent(a)+r+encodeURIComponent(e[a]);n=t}}return c}i.paramsToString=function(e){return o(e)};i.removeParametersWithEmptyValue=function(e,t){if(!e){return}Object.keys(e).forEach(r=>{if(t.includes(r)&&e[r].length===1&&e[r][0]===""){delete e[r]}})};i.privparamsToString=function(e,t,r){return o(e,t,r)};i.addParamsToUrl=function(t,r){var n=new e(t);Object.keys(r).forEach(e=>{n.addSearch(e,r[e])});return n.toString()};i.addShellParamsToURL=function(t,r){var n=new e(t);var a=n.hash();var s=n.toString().replace(a,"");const o=i.parseShellHash(a)||{};Object.assign(o.params,r.params);var c="#"+i.constructShellHash(o);return s+c};i.parseShellHash=function(e){var t=s,r,n,a,o,c,u,p;if(!e){return undefined}r=i.splitHash(e);u=t.exec(r.shellPart);if(u){n=u[2];a=u[3];o=u[5];c=u[6];p=i.parseParameters(c);return{semanticObject:n,action:a,contextRaw:o,params:p,appSpecificRoute:r.appSpecificRoute}}if(r.appSpecificRoute){return{semanticObject:undefined,action:undefined,contextRaw:undefined,params:{},appSpecificRoute:r.appSpecificRoute}}return undefined};i.privstripLeadingHash=function(e){if(e[0]==="#"){return e.substring(1)}return e};i.ensureLeadingHash=function(e){if(!e){e="#"}else if(e.charAt(0)!=="#"){e=`#${e}`}return e};i.getBasicHash=function(e){var t=this.parseShellHash(e);if(!t){return""}return`${t.semanticObject}-${t.action}`};i.splitHash=function(e){var t=/^(?:#|)([\S\s]*?)(&\/[\S\s]*)?$/,r,n,a;if(e===undefined||e===null||e===""){return{}}r=t.exec(e);n=r[1];if(n!==""&&!s.test(n)){return{}}a=r[2];if(n||a){return{shellPart:n,appSpecificRoute:a}}return{}};function c(e,t){if(t){return e+t}return e}i.constructShellHash=function(e){var r,n,a,s=null,o,u=[],p="?",f=null;if(!e){return""}if(!e.target){e.target={};e.target.semanticObject=e.semanticObject;e.target.action=e.action;e.target.contextRaw=e.contextRaw}if(e.target.shellHash||e.target.shellHash===""){a=i.privstripLeadingHash(e.target.shellHash);return c(a,e.appSpecificRoute)}if(e.target.semanticObject&&e.target.action){r=e.target.semanticObject+"-"+e.target.action.replace(/[?].*/,"")}else{return c("",e.appSpecificRoute)}if(e.target.contextRaw){r+="~"+e.target.contextRaw}p="?";f=null;u=[];for(f in e.params){if(e.params.hasOwnProperty(f)){u.push(f)}}n=e.params&&JSON.parse(JSON.stringify(e.params))||{};if(e.appStateKey){u.push("sap-xapp-state");n["sap-xapp-state"]=e.appStateKey}u.sort();for(o=0;o<u.length;o=o+1){f=u[o];if(Array.isArray(n[f])){if(n[f].length>1){t.error("Array startup parameters violate the designed intent of the Unified Shell Intent, use only single-valued parameters!")}for(s=0;s<n[f].length;s=s+1){r+=p+encodeURIComponent(f)+"="+encodeURIComponent(n[f][s]);p="&"}}else{r+=p+encodeURIComponent(f)+"="+encodeURIComponent(n[f]);p="&"}}return c(r,e.appSpecificRoute)};i.compareHashes=function(e,t){var r=this.parseShellHash(e)||{};var n=this.parseShellHash(t)||{};return{sameIntent:this.haveSameIntent(r,n),sameParameters:this.haveSameIntentParameters(r,n),sameAppSpecificRoute:r.appSpecificRoute===n.appSpecificRoute}};i.haveSameIntent=function(e,t){e=e||{};t=t||{};return e.semanticObject===t.semanticObject&&e.action===t.action&&e.contextRaw===t.contextRaw};i.haveSameIntentParameters=function(e,t){e=e||{};t=t||{};var r=n({},e.params);var a=n({},t.params);return!this._parametersChanged(this._removeNonIntentParameters(r),this._removeNonIntentParameters(a))};i._removeNonIntentParameters=function(e){var t=a.getParameters({isIntentParameter:false});var r;if(e){for(var n=0;n<t.length;n++){r=t[n];if(e[r.name]){delete e[r.name]}}}return e||{}};i._parametersChanged=function(e,t){return!r(e,t)};return i});
//# sourceMappingURL=UrlParsing.js.map