/*
 * SAP XHR Library v3.1.0
 * (c) Copyright 2013-2023 SAP SE or an SAP affiliate company.
*/
const global=self;let mod={},src={};function r(e){let t,n;if(!e.endsWith(".js")){e+=".js"}t=mod[e];if(!t){if(!src[e]){n=new Error("Cannot find module '"+e+"'");n.code="MODULE_NOT_FOUND";throw n}t={exports:{}};mod[e]=t;src[e](t.exports,r,t)}return t.exports}src={"./Channel.js":function(e,t,n){"use strict";class s{constructor(e,t,n,s,o,r){this.filters=[];this.xhr=e;this.method=t;this.url=new URL(n,global.location.href);this.url=this.url.href;this.async=!!s;if(o!==undefined){this.username=o}if(r!==undefined){this.password=r}}_process(e){for(const t of this.filters){if(typeof t[e]==="function"){t[e](this)}}}aborting(){this._process("aborting")}aborted(){this._process("aborted")}opening(){this._process("opening")}opened(){this._process("opened")}sending(){this._process("sending")}sent(){this._process("sent")}reopening(){this._process("reopening")}catch(e){for(const t of this.filters){if(typeof t.catch==="function"){try{t.catch(e,this);e=null;break}catch(t){e=t}}}if(e){throw e}}repeat(){this.xhr.repeat()}resume(){this.xhr.resumeEvents(true)}}n.exports=s},"./ChannelFactory.js":function(e,t,n){"use strict";const s=t("./Channel.js");const o=t("./IgnoreList.js");function r(e){const t=typeof e;return t==="function"||t==="object"&&e!==null&&typeof e.addFilter==="function"}function i(e,t){if(typeof e==="function"){e(t)}else{e.addFilter(t)}}class a{constructor(){this.reset()}reset(){this._filterFactories=[];this.ignore=new o}addFilterFactory(e){if(!r(e)){throw new TypeError("addFilterFactory expects a FilterFactory or a function parameter")}const t=this._filterFactories;if(t.indexOf(e)===-1){t.push(e)}}removeFilterFactory(e){const t=this._filterFactories;const n=t.indexOf(e);if(n!==-1){t.splice(n,1)}}getFilterFactories(){return this._filterFactories.slice()}create(e,t,n,o,r,a){const c=new s(e,t,n,o,r,a);if(!this.ignore.ignored(n)){const e=this._filterFactories;for(const t of e){i(t,c)}}return c}}n.exports=a},"./ConsoleLogger.js":function(e,t,n){"use strict";const s=t("./util.js");const o={none:0,error:10,warn:20,info:30,debug:40};class r{constructor(e){if(e&&typeof e.log==="function"){this.error=typeof e.error==="function"?e.error:e.log;this.warn=typeof e.warn==="function"?e.warn:e.log;this.info=e.log;this.debug=e.log}else{this.error=s.nop;this.warn=s.nop;this.info=s.nop;this.debug=s.nop}}}class i{constructor(e,t,n){this.output=new r(e);this.name=t||"xhrlib";this.setLevel(n)}format(e,t){return s.time()+" "+this.name+" ["+t.toUpperCase()+"] "+e}setLevel(e){e=typeof e==="number"?e:o[e];this.level=e===undefined?o.warn:e}log(e,t){if(this.level>=o[e]){this.output[e](this.format(t,e))}}error(e){this.log("error",e)}warn(e){this.log("warn",e)}info(e){this.log("info",e)}debug(e){this.log("debug",e)}}i.Level=o;i.prototype.warning=i.prototype.warn;n.exports=i},"./constants.js":function(e,t,n){"use strict";n.exports={X_REQUESTED_WITH:"x-requested-with",X_XHR_LOGON:"x-xhr-logon"}},"./DefaultLogonFrameProvider.js":function(e,t,n){"use strict";class s{constructor(){this.prefix="xhrlibFrame"+Date.now().toString(36);this.frame=null}create(){this.destroy();s.frameCounter+=1;const e=this.prefix+s.frameCounter;this.frame=document.createElement("iframe");this.frame.id=e;this.setDisplayNone(this.frame);document.body.appendChild(this.frame);return this.frame}destroy(){if(this.frame){document.body.removeChild(this.frame);this.frame=null}}show(){if(this.frame){this.setDisplayVisible(this.frame)}}setDisplayNone(e){e.style.display="none"}setDisplayVisible(e){e.style.display="block";e.style.position="absolute";e.style.top="0";e.style.left="0";e.style.width="100%";e.style.height="100%";e.style.zIndex="99999";e.style.border="0";e.style.background="white";setTimeout(function(){try{e.contentWindow.focus()}catch(e){void e}},100)}}n.exports=s;s.frameCounter=0},"./EventEmitter.js":function(e,t,n){"use strict";function s(e){return e&&(typeof e==="function"||typeof e.handleEvent==="function")}function o(e,t){if(typeof e==="function"){return e.call(t.currentTarget,t)}else{return e.handleEvent(t)}}class r{constructor(e){const t=e.length;for(let n=0;n<t;++n){this["_"+e[n]]=[]}this.subscriptions={};this.bufferedEvents=[];this.suspended=false}add(e,t){if(!s(t)){throw new TypeError("Invalid event handler")}const n=this["_"+e];if(!n){throw new Error(`Unknown event '${e}'`)}if(n.indexOf(t)===-1){n.push(t)}}remove(e,t){const n=this["_"+e];if(n){const e=n.indexOf(t);if(e!==-1){n.splice(e,1)}}}removeAll(e){const t="_"+e;if(this[t]){this[t]=[]}}dispatch(e){const t=e.type;let n=this["_"+t];if(!n||!n.length){return}if(this.suspended){this.bufferedEvents.push(e)}else{n=n.slice();for(const t of n){o(t,e)}}}clearEvents(){this.bufferedEvents=[]}releaseEvents(){const e=this.bufferedEvents;this.clearEvents();for(const t of e){this.dispatch(t)}}hasSubscribers(e){const t=this["_"+e];return t&&t.length>0}subscribed(e){return Boolean(this.subscriptions["_"+e])}subscribe(e){this.subscriptions["_"+e]=true}unsubscribe(e){delete this.subscriptions["_"+e]}}n.exports=r;r.isHandler=s;r.fireEvent=o},"./FetchContext.js":function(e,t,n){"use strict";const s="sap.xhrlib.FetchContext";class o{static get(e){return e[s]||o.set(e,{})}static set(e,t){e[s]=t;return t}static get key(){return"sap.xhrlib.FetchContext"}}n.exports=o},"./FetchRequest.js":function(e,t,n){"use strict";const s=global.fetch;const o=t("./FetchContext.js");const r=t("./FetchTransformManager.js");const{toBlob:i}=t("./util.js");const a=["method","mode","credentials","cache","redirect","referrer","integrity","priority"];const c=["referrerPolicy","keepalive","signal"];class h{constructor(e,t){this.id=++h.lastRequestId;this.executions=0;this.context={fetchRequest:this};this.fetchOptions=h.getFetchOptions(t);this.requestOptions=h.getRequestOptions(t);if(e instanceof Request){this.requestOptions=Object.assign(h.getRequestOptions(e),this.requestOptions);this.headers=new Headers(e.headers);if(t&&t.headers){const e=new Headers(t.headers);for(const[t,n]of e){this.headers.set(t,n)}}if(t&&t.body!==undefined&&t.body!==null){this.body=t.body}else{this.sourceRequest=e}this.url=new URL(e.url)}else{this.url=new URL(e,global.location.href);if(t){this.headers=new Headers(t.headers);this.body=t.body}}this.url=this.url.href;this.requestOptions.headers=this.headers}static getOptions(e,t){const n={};if(e){for(const s of t){if(e[s]){n[s]=e[s]}}}return n}static get nativeFetch(){return s}static async fetch(e,t){const n=new h(e,t);return n.execute()}static hookFetch(){global.fetch=h.fetch}static unhookFetch(){global.fetch=h.nativeFetch}static getRequestOptions(e){return h.getOptions(e,a)}static getFetchOptions(e){return h.getOptions(e,c)}async _createRequest(){const e=this.requestOptions.method;if(e!=="GET"&&e!=="HEAD"){if(this.sourceRequest){this.body=await this.sourceRequest.blob();delete this.sourceRequest}if(this.body instanceof ReadableStream){this.body=await i(this.body)}this.requestOptions.body=this.body}return new Request(this.url,this.requestOptions)}async execute(){++this.executions;const e=this.context,t=this.fetchOptions.signal;const n=r.getInstance();let i=await this._createRequest();o.set(i,e);i=await n.transform("request",i,t);e.request=i;let a=await s(i,this.fetchOptions);o.set(a,e);a=await n.transform("response",a,t);return a}}n.exports=h;h.lastRequestId=0;h.hookFetch()},"./FetchTransformManager.js":function(e,t,n){"use strict";const s=t("./FetchContext.js");const{abortError:o}=t("./httpUtil.js");let r=null;class i{constructor(){this._requestTransforms=[];this._responseTransforms=[]}static getInstance(){if(!r){r=new i}return r}_getPipeline(e){let t;switch(e){case"request":t=this._requestTransforms;break;case"response":t=this._responseTransforms;break;default:throw new Error(`Invalid pipeline '${e}'`)}return t}addTransform(e,t){if(typeof t!=="function"){throw new TypeError("Invalid transform")}const n=this._getPipeline(e);if(n.indexOf(t)===-1){n.push(t)}}prependTransform(e,t){if(typeof t!=="function"){throw new TypeError("Invalid transform")}const n=this._getPipeline(e);if(n.indexOf(t)===-1){n.unshift(t)}}removeTransform(e,t){if(typeof t!=="function"){throw new TypeError("Invalid transform")}const n=this._getPipeline(e);const s=n.indexOf(t);if(s!==-1){n.splice(s,1)}}clearTransforms(e){const t=this._getPipeline(e);t.splice(0)}getTransforms(e){const t=this._getPipeline(e);return t.slice()}async transform(e,t,n){const r=this._getPipeline(e);const i=s.get(t);return new Promise(async function(e,a){try{let c=false,h=false;if(n){n.addEventListener("abort",function(){if(!c){h=true;a(o())}})}for(const e of r){const o=await e(t,n);t=o||t;s.set(t,i);if(h){break}}c=true;if(!h){e(t)}}catch(e){a(e)}})}}n.exports=i},"./FrameLogonManager.js":function(e,t,n){"use strict";const s=t("./EventEmitter.js");const o=t("./DefaultLogonFrameProvider.js");const r=t("./LogonManager.js");const i=t("./XHRLogonManager.js");const a=t("./UrlTimeout.js");const c=t("./Log.js").logger;const h="authenticationrequired";let u=null;class l{constructor(){c.debug("Creating FrameLogonManager");this.handlers=new s([h]);this._lfp=new o;this._timeout=new a(l.defaultTimeout)}static getInstance(e){if(!u&&!e){u=new l}return u}static start(){l.getInstance().start()}static shutdown(){if(u){u.shutdown();u=null}}get logonFrameProvider(){return this._lfp}set logonFrameProvider(e){if(e){this._lfp=e}else{this._lfp=new o}}addEventListener(e,t){this.handlers.add(e,t)}removeEventListener(e,t){this.handlers.remove(e,t)}dispatchAuthenticationRequired(e){const t=this,n=new Event(h);n.request=e;setTimeout(function(){t.handlers.dispatch(n)},0)}start(){const e=r.getInstance();e.addEventListener(r.LogonEvent.LOGON_COMPLETE,this);e.addEventListener(r.LogonEvent.LOGON_FAILED,this);e.addEventListener(r.LogonEvent.LOGON_ABORTED,this);e.registerAuthHandler(i.logonScheme(i.Scheme.IFRAME),this)}shutdown(){const e=r.getInstance();this.abortLogon();e.removeEventListener(r.LogonEvent.LOGON_COMPLETE,this);e.removeEventListener(r.LogonEvent.LOGON_FAILED,this);e.unregisterAuthHandler(i.logonScheme(i.Scheme.IFRAME),this)}getTimeout(e){return this._timeout.getTimeout(e)}setTimeout(e,t){this._timeout.setTimeout(e,t)}resetTimeout(e){this._timeout.resetTimeout(e)}static getFrameLoadHandler(e,t){let n;const s=function(){if(n){clearTimeout(n)}n=setTimeout(function(){e.show()},t)};return s}onLogon(e){if(this.pending){this.onLogonEnd(this.pending.realm)}c.debug("Processing iframe logon for realm "+e.realm);if(this.handlers.hasSubscribers(h)){this.dispatchAuthenticationRequired(e);return true}const t=this.getTimeout(e.httpRequest.url);const n=new URL(e.httpRequest.url,window.location);n.searchParams.set("xhr-logon","iframe");const s=this.logonFrameProvider;const o=s.create();if(!o){return false}if(!o.onload){o.onload=l.getFrameLoadHandler(s,t)}o.xhrTimeout=t;o.src=n.href;this.pending={provider:s,realm:e.realm,request:e};return true}onLogonEnd(e){if(this.pending&&e===this.pending.realm){this.pending.provider.destroy();this.pending=undefined}}abortLogon(){if(this.pending){c.debug("Cancelling pending logon for realm "+this.pending.request);r.getInstance().abortLogon(this.pending.realm)}}handleEvent(e){let t=false;switch(e.type){case r.LogonEvent.LOGON:t=this.onLogon(e.request);break;case r.LogonEvent.LOGON_COMPLETE:case r.LogonEvent.LOGON_FAILED:this.onLogonEnd(e.response.realm);break;case r.LogonEvent.LOGON_ABORTED:if(this.pending&&this.pending.request===e.request){this.onLogonEnd(e.request.realm)}break}return t}}n.exports=l;l.Event={AUTH_REQUIRED:h};l.defaultTimeout=600},"./httpUtil.js":function(e,t,n){"use strict";const s=/(?:,|^)\s*(?:,\s*)*(\w+)\s*=\s*(?:"((?:[^"\\]|\\.)*)"|(\w*))/g;function o(e){const t={};if(e===undefined){return t}if(typeof e!=="string"){throw new TypeError("Invalid header value")}let n=s.exec(e);while(n!==null){const o=n[1];const r=n[2]===undefined?n[3]:n[2];t[o]=r?r.replace(/\\(.)/g,"$1"):"";n=s.exec(e)}return t}function r(e){const t=o(e);if(t.accept){t.accept=t.accept.split(",").map(e=>e.trim())}else{t.accept=[]}return t}function i(){return new DOMException("The operation was aborted.","AbortError")}n.exports={abortError:i,parseHeader:o,parseXHRLogonHeader:r}},"./IgnoreList.js":function(e,t,n){"use strict";class s{constructor(){this.clear()}add(e){switch(typeof e){case"string":this.p.push(e);break;case"object":if(e instanceof RegExp){this.r.push(e)}else{throw new TypeError("Unsupported ignore rule type")}break;case"function":this.f.push(e);break;default:throw new TypeError("Unsupported ignore rule type")}this.empty=false}ignored(e){let t=false;if(!this.empty){e=e||"";t=this._prefix(e)||this._regexp(e)||this._function(e)}return t}clear(){this.empty=true;this.p=[];this.r=[];this.f=[]}_prefix(e){for(const t of this.p){if(e.startsWith(t)){return true}}return false}_regexp(e){for(const t of this.r){if(t.test(e)){return true}}return false}_function(e){for(const t of this.f){if(t(e)){return true}}return false}}n.exports=s},"./index.js":function(e,t,n){"use strict";t("./xhr.js");const s=t("./FetchRequest.js");const o=t("./FetchTransformManager.js");const r=t("./LogonManager.js");const i=t("./FrameLogonManager.js");const a=t("./WindowLogonManager.js");const c=t("./XHRLogonManager.js");function h(e){e=e||{};r.getInstance();c.start();i.start();a.start();if(e.iframeAsWindow){a.getInstance().handleLegacyIFrame()}}function u(){c.shutdown();i.shutdown();a.shutdown();r.shutdown()}let l={start:h,shutdown:u,FetchContext:t("./FetchContext.js"),FetchRequest:s,FetchTransformManager:o,FrameLogonManager:i,Log:t("./Log.js"),LogonManager:r,WindowLogonManager:a,XHRLogonManager:c,_getInternalModule:e=>t(e)};Object.defineProperties(l,{fetchTransformManager:{get:()=>o.getInstance()},frameLogonManager:{get:()=>i.getInstance()},logonManager:{get:()=>r.getInstance()},windowLogonManager:{get:()=>a.getInstance()},xhrLogonManager:{get:()=>c.getInstance()}});n.exports=l},"./Log.js":function(e,t,n){"use strict";const s=t("./ConsoleLogger.js");const o=["error","warning","info","debug"];let r,i=new s(global.console,"sap.xhrlib");function a(e,t){for(const n of t){if(typeof e[n]!=="function"){return false}}return true}class c{constructor(e){this._logger=e}static get logger(){return r}static isLogger(e){return Boolean(e&&typeof e==="object"&&a(e,o))}static set(e){if(e){if(c.isLogger(e)){r._logger=e}else{throw new TypeError("Invalid logger.")}}else{r._logger=i}}static setLevel(e){if(typeof r._logger.setLevel==="function"){r._logger.setLevel(e)}}}n.exports=c;r=new c(i);o.forEach(function(e){c.prototype[e]=function(t){return this._logger[e](t)}})},"./LogonManager.js":function(e,t,n){"use strict";t("./xhr.js");const s=t("./EventEmitter.js");const o=t("./LogonRequest.js");const r=t("./Log.js").logger;const i={LOGON:"logon",LOGON_COMPLETE:"logoncomplete",LOGON_FAILED:"logonfailed",LOGON_ABORTED:"logonaborted"};let a;class c{constructor(){r.info("Creating Logon Manager");this.pending=null;this.queue=[];this.realms={};this.authHandlers={};this._schemes=[];this.handlers=new s(Object.values(i))}static getInstance(e){if(!a&&!e){a=new c}return a}static shutdown(){if(a){a.shutdown();a=undefined}}get schemes(){return this._schemes.slice()}_collectSchemes(){this._schemes=Object.keys(this.authHandlers).sort()}addEventListener(e,t){this.handlers.add(e,t)}removeEventListener(e,t){this.handlers.remove(e,t)}registerAuthHandler(e,t){if(!s.isHandler(t)){throw new TypeError("Invalid authentication handler")}let n=this.authHandlers[e];if(n){if(n.indexOf(t)===-1){n.push(t)}}else{n=[t];this.authHandlers[e]=n;this._collectSchemes()}}unregisterAuthHandler(e,t){const n=this.authHandlers[e];if(n){const s=n.indexOf(t);if(s>=0){if(n.length===1){delete this.authHandlers[e];this._collectSchemes()}else{n.splice(s,1)}}}}unregisterAllHandlers(e){if(e){delete this.authHandlers[e]}else{this.authHandlers={}}this._collectSchemes()}getAuthHandlers(e){const t=this.authHandlers[e];const n=this.authHandlers["*"];if(t){return n?t.concat(n):t.slice()}return n||[]}isSchemeHandled(e){return this.getAuthHandlers(e).length>0}dispatchEvent(e){this.handlers.dispatch(e)}dispatchLogonEvent(e){const t=new Event(i.LOGON);t.request=e;this.dispatchEvent(t)}dispatchLogonCompletedEvent(e){const t=new Event(i.LOGON_COMPLETE);t.response=e;this.dispatchEvent(t)}dispatchLogonFailedEvent(e){const t=new Event(i.LOGON_FAILED);t.response=e;this.dispatchEvent(t)}dispatchLogonAbortedEvent(e){const t=new Event(i.LOGON_ABORTED);t.request=e;this.dispatchEvent(t)}dispatchLogonRequest(e){const t=new Event(i.LOGON);t.request=e;const n=this.getAuthHandlers(e.scheme);let o=false;for(const e of n){o=s.fireEvent(e,t);if(o){break}}return o}getLogonRequest(e){if(this.pending&&this.pending.httpRequest===e){return this.pending}return this.queue.find(t=>t.httpRequest===e)}requestLogon(e){const t=o.cast(e);const{httpRequest:n,scheme:s}=t;const i=this.getLogonRequest(n);if(i){r.debug("Ignoring authentication request for already queued request "+n.url);return i}r.info("Authentication requested for "+n.url+" with scheme "+s);this.dispatchLogonEvent(t);let a=false;if(this.isSchemeHandled(s)){if(this.pending){r.debug("Pending authentication process, queueing request");this.queue.push(t);a=true}else{r.debug("Dispatching authentication request");this.pending=t;a=this.dispatchLogonRequest(t)}}else{r.info("No authentication handler registered for scheme "+s)}if(!a){r.warning("Unsupported authentication request for scheme "+s);if(this.pending===t){this.pending=null}this._abort([t]);this._processNext();return null}return t}_processQueue(e){const t=[],n=[];if(this.pending&&e===this.pending.realm){t.push(this.pending);this.pending=null}for(const s of this.queue){if(s.realm===e){t.push(s)}else{n.push(s)}}this.queue=n;return t}_processNext(){if(!this.pending&&this.queue.length>0){this.requestLogon(this.queue.shift())}}logonCompleted(e){const{realm:t,success:n}=e;const s=this._processQueue(t);if(s.length>0){if(n){r.info("Authentication succeeded for realm "+t+", repeating requests.");this._retry(s)}else{r.warning("Authentication failed for realm "+t);this._abort(s)}}if(n){this.dispatchLogonCompletedEvent(e)}else{this.dispatchLogonFailedEvent(e)}this._processNext()}abortLogon(e){if(!e&&this.pending){e=this.pending.realm}if(e){const t=this._processQueue(e);if(t.length>0){r.warning("Authentication aborted for realm "+e);this._abort(t);this._processNext()}}else{r.info("No pending authentication, ignoring abort")}}_retry(e){for(const t of e){t.httpRequest.repeat()}}_abort(e){for(const t of e){this.dispatchLogonAbortedEvent(t);t.httpRequest.resume()}}abortRequest(e){if(!(e instanceof o)){throw new TypeError("Invalid logon request")}let t=false;if(this.pending===e){t=true;this.pending=null}else{const n=this.queue.indexOf(e);if(n!==-1){t=true;this.queue.splice(n,1)}}if(t){this._abort([e]);this._processNext()}}abortAll(){const e=this.queue;this.queue=[];if(this.pending){e.push(this.pending);this.pending=null}this._abort(e)}shutdown(){r.info("Logon Manager shutdown");this.abortAll()}}n.exports=c;c.LogonEvent=i},"./LogonRequest.js":function(e,t,n){"use strict";class s{constructor(e){if(!s.isValid(e)){throw new TypeError("Invalid Logon request")}this.httpRequest=e.httpRequest;this.scheme=e.scheme;this.realm=e.realm||e.httpRequest.url}static isValid(e){if(!e){return false}const{httpRequest:t,scheme:n}=e;return t&&t.url&&n&&typeof t.repeat==="function"&&typeof t.resume==="function"}static cast(e){return e instanceof s?e:new s(e)}}n.exports=s},"./OpenWindowAlert.js":function(e,t,n){"use strict";class s{constructor(){this.dialogId="sap-xhrlib-alert-"+Date.now().toString(36)}get openButtonId(){return this.dialogId+"-open"}get cancelButtonId(){return this.dialogId+"-cancel"}createHeader(){const e=document.createElement("div");e.style.fontSize="1.25rem";e.style.textAlign="center";e.style.marginBottom="16px";e.style.color="#003283";const t=document.createTextNode("Authentication required");e.appendChild(t);return e}createButtons(e,t){const n=document.createElement("div");n.style.width="256px";n.style.margin="0 auto";const s=document.createElement("button");s.id=this.openButtonId;setTimeout(function(){s.focus()},300);s.onclick=function(){e()};s.style.width="120px";s.style.height="32px";s.style.color="#ffffff";s.style.backgroundColor="#5496cd";s.style.border="1px solid #367db8";s.style.borderRadius="4px";s.style.testShadow="0 1px #000000";s.style.outline="none";s.onblur=function(){s._focus=false;s.style.testShadow="0 1px #000000";s.style.backgroundColor="#5496cd";s.style.borderColor="#367db8"};s.onfocus=function(){s._focus=true;s.style.testShadow="none";s.style.backgroundColor="#427cac";s.style.borderColor="#427cac"};s.onmouseover=function(){if(!s._focus){s.style.backgroundColor="#367db8";s.style.borderColor="#367db8"}};s.onmouseout=function(){if(!s._focus){s.style.backgroundColor="#5496cd";s.style.borderColor="#367db8"}};const o=document.createTextNode("To sign in");s.appendChild(o);const r=document.createElement("button");r.id=this.cancelButtonId;r.type="button";r.onclick=function(){t()};r.style.marginLeft="16px";r.style.width="120px";r.style.height="32px";r.style.color="#346187";r.style.backgroundColor="#f7f7f7";r.style.border="1px solid #ababab";r.style.borderRadius="4px";r.style.outline="none";r.onblur=function(){r._focus=false;r.style.backgroundColor="#f7f7f7";r.style.borderColor="#ababab"};r.onfocus=function(){r._focus=true;r.style.backgroundColor="#bfbfbf";r.style.borderColor="#ababab"};r.onmouseover=function(){if(!r._focus){r.style.backgroundColor="rgba(191, 191, 191, 0.5)";r.style.borderColor="rgba(191, 191, 191, 0.5)"}};r.onmouseout=function(){if(!r._focus){r.style.backgroundColor="#f7f7f7";r.style.borderColor="#ababab"}};const i=document.createTextNode("Cancel");r.appendChild(i);n.appendChild(s);n.appendChild(r);return n}createMain(e,t){const n=document.createElement("div");n.style.width="288px";n.style.margin="0 auto";n.style.padding="8px";n.style.backgroundColor="#daeef8";n.style.border="1px solid #00abfc";n.style.borderRadius="4px";n.style.fontSize="1rem";n.appendChild(this.createHeader());n.appendChild(this.createButtons(e,t));return n}createAlertDialog(e,t){const n=document.createElement("div");n.id=this.dialogId;n.style.position="absolute";n.style.top="0";n.style.left="0";n.style.height="100%";n.style.width="100%";n.style.margin="0";n.style.padding="16px 0";n.style.zIndex="99999";n.appendChild(this.createMain(e,t));return n}show(e,t){this.close();this.alertDialog=this.createAlertDialog(e,t);document.body.appendChild(this.alertDialog)}close(){if(this.alertDialog){this.alertDialog.parentNode.removeChild(this.alertDialog);this.alertDialog=null}}}n.exports=s},"./UrlTimeout.js":function(e,t,n){"use strict";const s=t("./util.js").lowerBound;const o=t("./Log.js").logger;class r{constructor(e){this.defaultTimeout=e;this.timeouts={};this.timeoutIndex=[]}indexTimeouts(){this.timeoutIndex=Object.keys(this.timeouts);this.timeoutIndex.sort()}getTimeout(e){const t=s(e,this.timeoutIndex);if(t>=0){const n=this.timeoutIndex[t];if(e.substring(0,n.length)===n){return this.timeouts[n]}}return this.defaultTimeout}setTimeout(e,t){if(!e||!t){throw new TypeError("Invalid URL prefix or timeout value")}o.info("Setting timeout "+t+" on "+e);this.timeouts[e]=t;this.indexTimeouts()}resetTimeout(e){o.info("Reset timeout to default on "+e);delete this.timeouts[e];this.indexTimeouts()}}n.exports=r},"./util.js":function(e,t,n){"use strict";function s(e,t){let n,s,o=0,r=t.length-1;if(r<0||e<t[0]){return-1}if(e>=t[r]){return r}--r;while(o<r){n=o+r+1>>1;s=t[n];if(e<s){r=n-1}else{o=n}}return o}function o(){}function r(e,t){return String(e).padStart(t,"0")}function i(){const e=new Date;let t=r(e.getHours(),2)+":"+r(e.getMinutes(),2)+":";t+=r(e.getSeconds(),2)+"."+r(e.getMilliseconds(),3);return t}async function a(e){const t=[],n=e.getReader();while(true){const{value:e,done:s}=await n.read();if(s){break}t.push(e)}return new Blob(t)}n.exports={lowerBound:s,nop:o,pad:r,time:i,toBlob:a}},"./WindowLogonManager.js":function(e,t,n){"use strict";const s=t("./LogonManager.js");const o=t("./XHRLogonManager.js");const r=t("./DefaultLogonFrameProvider.js");const i=t("./OpenWindowAlert.js");const a=t("./UrlTimeout.js");const c=t("./Log.js").logger;let h=null;class u{constructor(){c.debug("Creating WindowLogonManager");this.alertDialog=new i;this.frameProvider=new r;this._timeout=new a(u.defaultTimeout);this.pollingInterval=5e3}static getInstance(e){if(!h&&!e){h=new u}return h}static start(){u.getInstance().start()}static shutdown(){if(h){h.shutdown();h=null}}start(){const e=s.getInstance();e.addEventListener(s.LogonEvent.LOGON_COMPLETE,this);e.addEventListener(s.LogonEvent.LOGON_FAILED,this);e.addEventListener(s.LogonEvent.LOGON_ABORTED,this);e.registerAuthHandler(o.logonScheme(o.Scheme.STRICT_WINDOW),this);e.registerAuthHandler(o.logonScheme(o.Scheme.WINDOW),this)}shutdown(){const e=s.getInstance();this.abortLogon();e.removeEventListener(s.LogonEvent.LOGON_COMPLETE,this);e.removeEventListener(s.LogonEvent.LOGON_FAILED,this);e.removeEventListener(s.LogonEvent.LOGON_ABORTED,this);e.unregisterAuthHandler(o.logonScheme(o.Scheme.IFRAME),this);e.unregisterAuthHandler(o.logonScheme(o.Scheme.STRICT_WINDOW),this);e.unregisterAuthHandler(o.logonScheme(o.Scheme.WINDOW),this)}getTimeout(e){return this._timeout.getTimeout(e)}setTimeout(e,t){this._timeout.setTimeout(e,t)}resetTimeout(e){this._timeout.resetTimeout(e)}handleLegacyIFrame(){const e=o.logonScheme(o.Scheme.IFRAME);const t=s.getInstance();t.unregisterAllHandlers(e);t.registerAuthHandler(e,this)}onLogon(e){let t=true;if(this.pending){this.onLogonEnd(this.pending.realm)}c.debug("Processing "+e.scheme+" logon for realm "+e.realm);switch(o.xhrScheme(e.scheme)){case o.Scheme.WINDOW:this.onWindowLogon(e);break;case o.Scheme.STRICT_WINDOW:this.onStrictWindowLogon(e);break;case o.Scheme.IFRAME:this.onWindowLogon(e,true);break;default:t=false;c.warning("WindowLogonManager unsupported request scheme "+e.scheme);break}return t}onWindowLogon(e,t){const n=this;if(t){c.debug("Processing iframe logon as window logon for realm "+e.realm)}else{c.debug("Processing window logon for realm "+e.realm)}const{httpRequest:s}=e;const o=this.getTimeout(s.url);const r=new URL(s.url,window.location);r.searchParams.set("xhr-logon",t?"iframe":"window");const i=this.frameProvider.create();let a;i.onload=function(){if(a){clearTimeout(a)}a=setTimeout(function(){n.createWindow(t)},o)};i.xhrTimeout=o;i.src=r.href;this.pending={request:e,realm:e.realm,frame:i.id,url:r.href}}onStrictWindowLogon(e){const{httpRequest:t}=e;const n=new URL(t.url,window.location);n.searchParams.set("xhr-logon","strict-window");c.debug("Processing strict-window logon for realm "+e.realm);this.pending={request:e,realm:e.realm,url:n.href};this.createWindow()}static openWindow(e,t){return window.open(e,t)}createWindow(e){const t=this;if(!this.pending){return}const n=u.openWindow(this.pending.url,"_blank");if(!n||n.closed){c.warning("Failed to open logon window, alerting user");this.alertDialog.show(function(){t.createWindow(e)},function(){t.abortLogon()});return}this.window=n;try{n.opener=window}catch(e){void e}this.windowMonitorId=setInterval(function(){if(!t.window||t.window.closed){t.abortLogon()}},300);if(e){t.pollIntervalId=setInterval(function(){t.poll()},t.pollingInterval)}n.addEventListener("load",function(){c.info("Logon window opened");if(t.closed){return}if(e){setTimeout(function(){t.poll()},300)}t.windowIntervalId=setInterval(function(){try{if(e&&typeof t.window.notifyParent==="function"){t.poll()}}catch(e){c.warning("Logon polling failed: "+e.message)}},300)});n.addEventListener("close",function(){t.abortLogon()});setTimeout(function(){try{if(t.window){t.window.focus()}}catch(e){c.warning("Failed to switch focus to logon window")}},300)}poll(){if(this.pending){const e=this.frameProvider.create();this.pending.frame=e.id;e.src=this.pending.url}}stopPolling(){if(this.windowMonitorId){clearInterval(this.windowMonitorId);this.windowMonitorId=undefined}if(this.windowIntervalId){clearInterval(this.windowIntervalId);this.windowIntervalId=undefined}if(this.pollIntervalId){clearInterval(this.pollIntervalId);this.pollIntervalId=undefined}}onLogonEnd(e){if(this.pending&&e===this.pending.realm){this.stopPolling();this.frameProvider.destroy();this.alertDialog.close();if(this.window){this.window.close();this.window=undefined}this.pending=undefined}}abortLogon(){if(this.pending){c.debug("Cancelling pending logon for realm "+this.pending.request);s.getInstance().abortLogon(this.pending.realm)}}handleEvent(e){let t=false;switch(e.type){case s.LogonEvent.LOGON:t=this.onLogon(e.request);break;case s.LogonEvent.LOGON_COMPLETE:case s.LogonEvent.LOGON_FAILED:this.onLogonEnd(e.response.realm);break;case s.LogonEvent.LOGON_ABORTED:if(this.pending&&this.pending.request===e.request){this.onLogonEnd(e.request.realm)}break}return t}}n.exports=u;u.defaultTimeout=600},"./xhr.js":function(e,t,n){"use strict";const s="_SAP_ENHANCED";function o(){const e=t("./Log.js");const n=t("./ChannelFactory.js");const o=t("./EventEmitter.js");const r=["loadstart","progress","abort","error","load","timeout","loadend"];const i=r.concat("readystatechange");const a=XMLHttpRequest.prototype;const c=e.logger;let h=0;const u=XMLHttpRequest;XMLHttpRequest[s]=true;XMLHttpRequest.channelFactory=new n;function l(e,t){for(const n of t){const t=e[n];if(t){const s="_"+n;const o=e[s];if(!o){e[s]=t}}}}l(a,["abort","open","setRequestHeader","send","addEventListener","removeEventListener"]);a._getHandlers=function(){let e=this._handlers;if(!e){e=new o(i);this._handlers=e}return e};a.handleEvent=function(e){this._getHandlers().dispatch(e)};a.suspendEvents=function(){this._getHandlers().suspended=true};a.resumeEvents=function(e){const t=this._getHandlers();t.suspended=false;if(e){t.releaseEvents()}else{t.clearEvents()}};a.clearEvents=function(){this._getHandlers().clearEvents()};a.getEventHandler=function(){const e=this;let t=this._fnHandler;if(!t){t=function(t){e.handleEvent(t)};this._fnHandler=t}return t};a._checkEventSubscription=function(e,t){t=t||this._getHandlers();if(!t.subscribed(e)){this._addEventListener(e,this.getEventHandler());t.subscribe(e)}};a._checkEventSubscriptions=function(){const e=this._getHandlers();for(const t of i){this._checkEventSubscription(t,e)}};a.addEventListener=function(e,t){this._getHandlers().add(e,t)};a.removeEventListener=function(e,t){this._getHandlers().remove(e,t)};function d(e){Object.defineProperty(a,"on"+e,{configurable:true,get:function(){return this["_on"+e]||null},set:function(t){const n="_on"+e;if(this[n]){this.removeEventListener(e,this[n])}if(typeof t==="function"||typeof t==="object"){this[n]=t;if(o.isHandler(t)){this.addEventListener(e,t)}}else{this[n]=null}}})}i.forEach(function(e){d(e)});a.abort=function(){let e;try{e=this._channel;if(e){c.debug("Aborting request "+e.method+" "+e.url);e.aborting();this._abort();e.aborted()}else{c.debug("Aborting request");this._abort()}}catch(t){c.warning("Failed to abort request: "+t.message);if(e){e.catch(t)}else{throw t}}};a.open=function(e,t,n,s,o){this._id=++h;c.debug("Opening request #"+this._id+" "+e+" "+t);const r=arguments.length;if(r<=2){n=true}const i=e;const a=t;this._getHandlers().clearEvents();const l=u.channelFactory.create(this,e,t,n,s,o);this._channel=l;try{this._clearParams();l.opening();e=l.method;t=l.url;if(a!==t||i!==e){c.debug("Rewriting request #"+this._id+" to "+e+" "+t)}if(r<=2){this._open(e,t)}else{this._open(e,t,n,s,o)}l.opened();this._checkEventSubscriptions();this._removeEventListener("readystatechange",this.getEventHandler());this._addEventListener("readystatechange",this.getEventHandler())}catch(n){c.warning("Failed to open request #"+this._id+" "+e+" "+t+": "+n.message);l.catch(n)}};a.setRequestHeader=function(e,t){if(typeof t!=="string"){t=String(t)}this._setRequestHeader(e,t);const n=e.toLowerCase();const s=this.headers;if(s[n]===undefined){s[n]=t}else{s[n]+=", "+t}};a.setRequestHeaders=function(e){if(typeof e==="object"){const t=Object.getOwnPropertyNames(e);for(const n of t){this.setRequestHeader(n,e[n])}}};a.send=function(e){let t,n,s;try{t=this._channel;if(t){n=t.method;s=t.url;c.debug("Sending request #"+this._id+" "+n+" "+s);t.sending()}this._saveParams(e);this._send(e);if(t){t.sent()}}catch(e){if(n){c.warning("Failed to send request #"+this._id+" "+n+" "+s+": "+e.message)}else{c.warning("Failed to send request #"+this._id+": "+e.message)}if(t){t.catch(e)}else{throw e}}};a.getRequestHeader=function(e){return this.headers[e.toLowerCase()]};a.deleteRepeatHeader=function(e){delete this.headers[e.toLowerCase()]};a.setRepeatHeader=function(e,t){this.headers[e.toLowerCase()]=t};a.reopen=function(){const e=this._channel;let t,n;if(e){t=e.method;n=e.url;c.debug("Reopening request #"+this._id+" "+t+" "+n)}else{throw new TypeError("Cannot reopen request")}try{e.reopening();e.opening();this._open(t,n,e.async,e.username,e.password);e.opened();this._restoreParams();this.resumeEvents()}catch(s){c.warning("Failed to reopen request #"+this._id+" "+t+" "+n+": "+s.message);e.catch(s)}};a.repeat=function(){const e=this._channel,t=this;if(!e){throw new TypeError("Cannot repeat request")}setTimeout(function(){t.abort();t.reopen();t.send(t._data)},0)};a.toString=function(){const e=this._channel;let t="[object XMLHttpRequest]";if(e){t+=" #"+this._id+" "+e.method+" "+e.url}return t};Object.defineProperties(a,{channel:{get:function(){return this._channel}},headers:{get:function(){let e=this._headers;if(!e){e={};this._headers=e}return e}},id:{get:function(){return this._id}}});a._clearParams=function(){delete this._headers;delete this._withCredentials;delete this._timeout;delete this._data};a._restoreParams=function(){if(this._headers){const e=this._headers;this._headers={};this.setRequestHeaders(e)}if(this._withCredentials){this.withCredentials=true}const e=this._timeout;if(e){this.timeout=e}};a._saveParams=function(e){if(e!==undefined&&e!==null){this._data=e}if(this.withCredentials){this._withCredentials=true}const t=this.timeout;if(t){this._timeout=t}};Object.defineProperties(XMLHttpRequest,{logger:{get:function(){return e.logger},set:function(t){e.logger=t}}})}if(!XMLHttpRequest[s]){o()}n.exports=XMLHttpRequest},"./XHRLogonFilter.js":function(e,t,n){"use strict";const{parseXHRLogonHeader:s}=t("./httpUtil.js");const{X_REQUESTED_WITH:o,X_XHR_LOGON:r}=t("./constants.js");const i=2,a=4;class c{constructor(e,t){this.manager=e;this.channel=t;this.ignore=this.manager.ignore&&this.manager.ignore.ignored(t.url);if(!this.ignore){t.xhr._addEventListener("readystatechange",this)}}sending(e){const t=new URL(e.url,location.href);if(t.origin!==location.origin&&!e.xhr.withCredentials){this.ignore=true}if(this.ignore){return}const n=e.xhr;const s=this.manager.accept().join(",");if(n.getRequestHeader(r)===undefined){n.setRequestHeader(r,"accept="+JSON.stringify(s))}if(n.getRequestHeader(o)===undefined){n.setRequestHeader(o,"XMLHttpRequest")}}handleEvent(){const e=this.channel;const t=e.xhr;if(t.readyState<i||t.status!==403||!e.async){return}const n=t.getResponseHeader(r);let o,c;if(n){t.suspendEvents();const i=s(n);o=i.accept;for(let e=0;e<o.length;++e){if(o[e]==="repeat"){o.splice(e,1);c=true;break}}if(t.readyState===a){if(c&&!e.repeated){e.repeated=true;o=this.manager.accept(o);t.setRepeatHeader(r,'accept="'+o.join(",")+'"');t.repeat()}else{this.manager.requestLogon(e,i)}}}}}n.exports=c},"./XHRLogonManager.js":function(e,t,n){"use strict";const{X_REQUESTED_WITH:s,X_XHR_LOGON:o}=t("./constants.js");const r=t("./xhr.js");const i=t("./IgnoreList.js");const a=t("./XHRLogonFilter.js");const c=t("./LogonManager.js");const h=t("./FetchTransformManager.js");const u=t("./XHRLogonPendingRequest.js");const l=t("./Log.js").logger;const d="xhrlogon.";const f=/^\s*\{\s*"xhrLogon"\s*:/;const g="SAP NetWeaver Application Server [";let p=null;function m(e){return e>=200&&e<300||e===304}function w(){const e=[],t=c.getInstance().schemes;for(const n of t){if(n.startsWith(d)){e.push(n.substring(d.length))}}e.push(b.Scheme.REPEAT);return e}function L(e){if(!e){return""}if(e.startsWith(g)){return e.substring(0,g.length+3)+"]"}return e}class b{constructor(){const e=this;l.info("Creating XHR Logon Manager");this.eventHandler=function(t){e.handleEvent(t)};this.filterFactory=function(t){t.filters.push(new a(e,t))}}static getInstance(e){if(!p&&!e){p=new b}return p}static start(){b.getInstance().start()}static shutdown(){if(p){p.shutdown();p=null}}static logonScheme(e){return d+e}static xhrScheme(e){return e.startsWith(d)?e.substring(d.length):"none"}static async xhrLogonRequestTransform(e){let t;const n=new URL(e.url);if(n.origin===window.location.origin){t=e.credentials==="omit"}else{t=e.credentials!=="include"}if(t){return}const r=b.getInstance().accept().join(",");if(!e.headers.has(o)){e.headers.set(o,"accept="+JSON.stringify(r))}if(!e.headers.has(s)){e.headers.set(s,"XMLHttpRequest")}}static async xhrLogonResponseTransform(e){let t=u.getPendingRequest(e);if(t){return t.onRepeatResponse(e)}if(e.status!==403||!e.headers.has(o)){return null}t=new u(b.getInstance(),e);return t.processResponse()}start(){if(!this.started){l.info("XHR Logon Manager startup");this.ignore=new i;this._initializeTrustedOrigins();this._registerFilterFactory();this.acceptOrder=b.defaultAccept.slice();window.addEventListener("message",this.eventHandler);const e=h.getInstance();e.addTransform("request",b.xhrLogonRequestTransform);e.prependTransform("response",b.xhrLogonResponseTransform);this.started=true}}shutdown(){if(this.started){l.info("XHR Logon Manager shutdown");window.removeEventListener("message",this.eventHandler);this._unregisterFilterFactory();this.started=false}}accept(e){const t=[],n=c.getInstance();e=e||w();if(e.length){for(const s of e){if(n.isSchemeHandled(b.logonScheme(s))){t.push(s)}}}if(!t.length){t.push(b.Scheme.NONE)}return t}acceptScheme(e){if(!e||!e.length){return b.Scheme.NONE}const t={};for(const n of e){t[n]=true}const n=c.getInstance();let s=b.Scheme.NONE;for(const e of this.acceptOrder){if(n.isSchemeHandled(b.logonScheme(e))&&t[e]){s=e;break}}return s}requestLogon(e,t){const n=this.acceptScheme(t.accept);c.getInstance().requestLogon({httpRequest:e,realm:L(t.realm),scheme:b.logonScheme(n)})}registerAuthHandler(e,t){e=b.logonScheme(e);c.getInstance().registerAuthHandler(e,t)}unregisterAuthHandler(e,t){e=b.logonScheme(e);c.getInstance().unregisterAuthHandler(e,t)}handleEvent(e){const t=e.data;if(f.test(t)){try{if(this.isTrusted(e.origin)){const e=JSON.parse(t);if(typeof e.xhrLogon!=="object"){l.warning("Invalid xhrLogon message: "+t)}else{e.xhrLogon.realm=L(e.xhrLogon.realm);e.xhrLogon.success=m(e.xhrLogon.status);c.getInstance().logonCompleted(e.xhrLogon)}}else{l.warning("Received xhrlogon message from untrusted origin "+e.origin)}}catch(e){l.warning("Invalid xhrLogon message: "+t)}}}_initializeTrustedOrigins(){const e={},t=window.location,n=t.protocol;e[n+"//"+t.host]=true;switch(n){case"http:":if(t.port===""){e["http://"+t.hostname+":80"]=true}else if(t.port==="80"){e["http://"+t.hostname]=true}break;case"https:":if(t.port===""){e["https://"+t.hostname+":443"]=true}else if(t.port==="443"){e["https://"+t.hostname]=true}break;default:break}this._trustedOrigins=e}isTrusted(e){return Boolean(this._trustedOrigins[e])}addTrustedOrigin(e){this._trustedOrigins[e]=true}_registerFilterFactory(){if(r.channelFactory){r.channelFactory.addFilterFactory(this.filterFactory)}}_unregisterFilterFactory(){if(r.channelFactory){r.channelFactory.removeFilterFactory(this.filterFactory)}}}n.exports=b;b.Scheme={NONE:"none",REPEAT:"repeat",IFRAME:"iframe",WINDOW:"window",STRICT_WINDOW:"strict-window"};b.defaultAccept=[b.Scheme.REPEAT,b.Scheme.IFRAME,b.Scheme.WINDOW,b.Scheme.STRICT_WINDOW]},"./XHRLogonPendingRequest.js":function(e,t,n){"use strict";const{nop:s}=t("./util.js");const{abortError:o,parseXHRLogonHeader:r}=t("./httpUtil.js");const i=t("./FetchContext.js");const{X_XHR_LOGON:a}=t("./constants.js");class c{constructor(e,t){this.manager=e;this.originalResponse=t;this.context=i.get(t);this.url=this.context.request.url;this.context.xhrLogon={pending:this};this.responsePromise=new Promise((e,t)=>{this.resolve=e;this.reject=t})}static getPendingRequest(e){const{xhrLogon:t}=i.get(e);return t&&t.pending}async processResponse(){const e=r(this.originalResponse.headers.get(a));if(!this.context.xhrLogon.repeat&&e.accept.indexOf("repeat")!==-1){this.context.xhrLogon.repeat=true;this.context.fetchRequest.execute().catch(s)}else{this.manager.requestLogon(this,e)}return this.responsePromise}async onRepeatResponse(e){if(this.context.xhrLogon.repeat&&e.status===403&&e.headers.has(a)){return this.processResponse()}this.resolve(e);throw o()}repeat(){this.context.fetchRequest.execute().catch(s)}resume(){this.resolve(this.originalResponse)}}n.exports=c}};export const xhrlib=r("./index.js");
//# sourceMappingURL=sap-xhrlib-esm-dbg.js.map